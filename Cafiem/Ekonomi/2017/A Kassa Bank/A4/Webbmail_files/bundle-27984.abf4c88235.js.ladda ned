var _gaq=_gaq||[];_gaq.push(['_setAccount','UA-32755516-2']);_gaq.push(['_setDomainName','one.com']);_gaq.push(['_setAllowLinker',true]);_gaq.push(['_trackPageview',document.location.pathname.replace(/[^\/]*(?:@|%40).*$/,'')]);_gaq.push(['_trackPageLoadTime']);_gaq.push(['_gat._anonymizeIp']);(function(){var ga=document.createElement('script');ga.type='text/javascript';ga.async=true;ga.src=('https:'===document.location.protocol?'https://ssl':'http://www')+'.google-analytics.com/ga.js';var s=document.getElementsByTagName('script')[0];s.parentNode.insertBefore(ga,s)}());;(function(window){var characters='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=',fromCharCode=String.fromCharCode,INVALID_CHARACTER_ERR=function(){try{document.createElement('$')}catch(error){return error}}();window.btoa||(window.btoa=function(string){var a,b,b1,b2,b3,b4,c,i=0,len=string.length,max=Math.max,result='';while(i<len){a=string.charCodeAt(i++)||0;b=string.charCodeAt(i++)||0;c=string.charCodeAt(i++)||0;if(max(a,b,c)>255){throw INVALID_CHARACTER_ERR}b1=a>>2&63;b2=(a&3)<<4|b>>4&15;b3=(b&15)<<2|c>>6&3;b4=c&63;if(!b){b3=b4=64}else if(!c){b4=64}result+=characters.charAt(b1)+characters.charAt(b2)+characters.charAt(b3)+characters.charAt(b4)}return result});window.atob||(window.atob=function(string){string=string.replace(/=+$/,'');var a,b,b1,b2,b3,b4,c,i=0,len=string.length,chars=[];if(len%4===1)throw INVALID_CHARACTER_ERR;while(i<len){b1=characters.indexOf(string.charAt(i++));b2=characters.indexOf(string.charAt(i++));b3=characters.indexOf(string.charAt(i++));b4=characters.indexOf(string.charAt(i++));a=(b1&63)<<2|b2>>4&3;b=(b2&15)<<4|b3>>2&15;c=(b3&3)<<6|b4&63;chars.push(fromCharCode(a));b&&chars.push(fromCharCode(b));c&&chars.push(fromCharCode(c))}return chars.join('')})}(this));!function(t){!function(e){'object'==typeof exports?module.exports=e():'function'==typeof t&&t.amd?t(e):'undefined'!=typeof window?window.Promise=e():'undefined'!=typeof global?global.Promise=e():'undefined'!=typeof self&&(self.Promise=e())}(function(){var t;return function e(t,n,o){function r(u,c){if(!n[u]){if(!t[u]){var f='function'==typeof require&&require;if(!c&&f)return f(u,!0);if(i)return i(u,!0);throw new Error('Cannot find module \''+u+'\'')}var s=n[u]={exports:{}};t[u][0].call(s.exports,function(e){var n=t[u][1][e];return r(n?n:e)},s,s.exports,e,t,n,o)}return n[u].exports}for(var i='function'==typeof require&&require,u=0;u<o.length;u++)r(o[u]);return r}({1:[function(t,e,n){var o=t('../lib/decorators/unhandledRejection'),r=o(t('../lib/Promise'));e.exports='undefined'!=typeof global?global.Promise=r:'undefined'!=typeof self?self.Promise=r:r},{'../lib/Promise':2,'../lib/decorators/unhandledRejection':4}],2:[function(e,n,o){!function(t){'use strict';t(function(t){var e=t('./makePromise'),n=t('./Scheduler'),o=t('./env').asap;return e({scheduler:new n(o)})})}('function'==typeof t&&t.amd?t:function(t){n.exports=t(e)})},{'./Scheduler':3,'./env':5,'./makePromise':7}],3:[function(e,n,o){!function(t){'use strict';t(function(){function t(t){this._async=t,this._running=!1,this._queue=this,this._queueLen=0,this._afterQueue={},this._afterQueueLen=0;var e=this;this.drain=function(){e._drain()}}return t.prototype.enqueue=function(t){this._queue[this._queueLen++]=t,this.run()},t.prototype.afterQueue=function(t){this._afterQueue[this._afterQueueLen++]=t,this.run()},t.prototype.run=function(){this._running||(this._running=!0,this._async(this.drain))},t.prototype._drain=function(){for(var t=0;t<this._queueLen;++t)this._queue[t].run(),this._queue[t]=void 0;for(this._queueLen=0,this._running=!1,t=0;t<this._afterQueueLen;++t)this._afterQueue[t].run(),this._afterQueue[t]=void 0;this._afterQueueLen=0},t})}('function'==typeof t&&t.amd?t:function(t){n.exports=t()})},{}],4:[function(e,n,o){!function(t){'use strict';t(function(t){function e(t){throw t}function n(){}var o=t('../env').setTimer,r=t('../format');return function(t){function i(t){t.handled||(l.push(t),a('Potentially unhandled rejection ['+t.id+'] '+r.formatError(t.value)))}function u(t){var e=l.indexOf(t);e>=0&&(l.splice(e,1),h('Handled previous rejection ['+t.id+'] '+r.formatObject(t.value)))}function c(t,e){p.push(t,e),null===d&&(d=o(f,0))}function f(){for(d=null;p.length>0;)p.shift()(p.shift())}var s,a=n,h=n;'undefined'!=typeof console&&(s=console,a='undefined'!=typeof s.error?function(t){s.error(t)}:function(t){s.log(t)},h='undefined'!=typeof s.info?function(t){s.info(t)}:function(t){s.log(t)}),t.onPotentiallyUnhandledRejection=function(t){c(i,t)},t.onPotentiallyUnhandledRejectionHandled=function(t){c(u,t)},t.onFatalRejection=function(t){c(e,t.value)};var p=[],l=[],d=null;return t}})}('function'==typeof t&&t.amd?t:function(t){n.exports=t(e)})},{'../env':5,'../format':6}],5:[function(e,n,o){!function(t){'use strict';t(function(t){function e(){return'undefined'!=typeof process&&'[object process]'===Object.prototype.toString.call(process)}function n(){return'function'==typeof MutationObserver&&MutationObserver||'function'==typeof WebKitMutationObserver&&WebKitMutationObserver}function o(t){function e(){var t=n;n=void 0,t()}var n,o=document.createTextNode(''),r=new t(e);r.observe(o,{characterData:!0});var i=0;return function(t){n=t,o.data=i^=1}}var r,i='undefined'!=typeof setTimeout&&setTimeout,u=function(t,e){return setTimeout(t,e)},c=function(t){return clearTimeout(t)},f=function(t){return i(t,0)};if(e())f=function(t){return process.nextTick(t)};else if(r=n())f=o(r);else if(!i){var s=t,a=s('vertx');u=function(t,e){return a.setTimer(e,t)},c=a.cancelTimer,f=a.runOnLoop||a.runOnContext}return{setTimer:u,clearTimer:c,asap:f}})}('function'==typeof t&&t.amd?t:function(t){n.exports=t(e)})},{}],6:[function(e,n,o){!function(t){'use strict';t(function(){function t(t){var n='object'==typeof t&&null!==t&&(t.stack||t.message)?t.stack||t.message:e(t);return t instanceof Error?n:n+' (WARNING: non-Error used)'}function e(t){var e=String(t);return'[object Object]'===e&&'undefined'!=typeof JSON&&(e=n(t,e)),e}function n(t,e){try{return JSON.stringify(t)}catch(n){return e}}return{formatError:t,formatObject:e,tryStringify:n}})}('function'==typeof t&&t.amd?t:function(t){n.exports=t()})},{}],7:[function(e,n,o){!function(t){'use strict';t(function(){return function(t){function e(t,e){this._handler=t===_?e:n(t)}function n(t){function e(t){r.resolve(t)}function n(t){r.reject(t)}function o(t){r.notify(t)}var r=new b;try{t(e,n,o)}catch(i){n(i)}return r}function o(t){return k(t)?t:new e(_,new x(v(t)))}function r(t){return new e(_,new x(new P(t)))}function i(){return $}function u(){return new e(_,new b)}function c(t,e){var n=new b(t.receiver,t.join().context);return new e(_,n)}function f(t){return a(B,null,t)}function s(t,e){return a(M,t,e)}function a(t,n,o){function r(e,r,u){u.resolved||h(o,i,e,t(n,r,e),u)}function i(t,e,n){a[t]=e,0===--s&&n.become(new q(a))}for(var u,c='function'==typeof n?r:i,f=new b,s=o.length>>>0,a=new Array(s),p=0;p<o.length&&!f.resolved;++p)u=o[p],void 0!==u||p in o?h(o,c,p,u,f):--s;return 0===s&&f.become(new q(a)),new e(_,f)}function h(t,e,n,o,r){if(U(o)){var i=m(o),u=i.state();0===u?i.fold(e,n,void 0,r):u>0?e(n,i.value,r):(r.become(i),p(t,n+1,i))}else e(n,o,r)}function p(t,e,n){for(var o=e;o<t.length;++o)l(v(t[o]),n)}function l(t,e){if(t!==e){var n=t.state();0===n?t.visit(t,void 0,t._unreport):0>n&&t._unreport()}}function d(t){return'object'!=typeof t||null===t?r(new TypeError('non-iterable passed to race()')):0===t.length?i():1===t.length?o(t[0]):y(t)}function y(t){var n,o,r,i=new b;for(n=0;n<t.length;++n)if(o=t[n],void 0!==o||n in t){if(r=v(o),0!==r.state()){i.become(r),p(t,n+1,r);break}r.visit(i,i.resolve,i.reject)}return new e(_,i)}function v(t){return k(t)?t._handler.join():U(t)?j(t):new q(t)}function m(t){return k(t)?t._handler.join():j(t)}function j(t){try{var e=t.then;return'function'==typeof e?new g(e,t):new q(t)}catch(n){return new P(n)}}function _(){}function w(){}function b(t,n){e.createContext(this,n),this.consumers=void 0,this.receiver=t,this.handler=void 0,this.resolved=!1}function x(t){this.handler=t}function g(t,e){b.call(this),G.enqueue(new E(t,e,this))}function q(t){e.createContext(this),this.value=t}function P(t){e.createContext(this),this.id=++Y,this.value=t,this.handled=!1,this.reported=!1,this._report()}function R(t,e){this.rejection=t,this.context=e}function C(t){this.rejection=t}function O(){return new P(new TypeError('Promise cycle'))}function T(t,e){this.continuation=t,this.handler=e}function Q(t,e){this.handler=e,this.value=t}function E(t,e,n){this._then=t,this.thenable=e,this.resolver=n}function L(t,e,n,o,r){try{t.call(e,n,o,r)}catch(i){o(i)}}function S(t,e,n,o){this.f=t,this.z=e,this.c=n,this.to=o,this.resolver=X,this.receiver=this}function k(t){return t instanceof e}function U(t){return('object'==typeof t||'function'==typeof t)&&null!==t}function H(t,n,o,r){return'function'!=typeof t?r.become(n):(e.enterContext(n),F(t,n.value,o,r),void e.exitContext())}function N(t,n,o,r,i){return'function'!=typeof t?i.become(o):(e.enterContext(o),W(t,n,o.value,r,i),void e.exitContext())}function J(t,n,o,r,i){return'function'!=typeof t?i.notify(n):(e.enterContext(o),z(t,n,r,i),void e.exitContext())}function M(t,e,n){try{return t(e,n)}catch(o){return r(o)}}function F(t,e,n,o){try{o.become(v(t.call(n,e)))}catch(r){o.become(new P(r))}}function W(t,e,n,o,r){try{t.call(o,e,n,r)}catch(i){r.become(new P(i))}}function z(t,e,n,o){try{o.notify(t.call(n,e))}catch(r){o.notify(r)}}function A(t,e){e.prototype=V(t.prototype),e.prototype.constructor=e}function B(t,e){return e}function K(){}function D(){return'undefined'!=typeof process&&null!==process&&'function'==typeof process.emit?function(t,e){return'unhandledRejection'===t?process.emit(t,e.value,e):process.emit(t,e)}:'undefined'!=typeof self&&'function'==typeof CustomEvent?function(t,e,n){var o=!1;try{var r=new n('unhandledRejection');o=r instanceof n}catch(i){}return o?function(t,o){var r=new n(t,{detail:{reason:o.value,key:o},bubbles:!1,cancelable:!0});return!e.dispatchEvent(r)}:t}(K,self,CustomEvent):K}var G=t.scheduler,I=D(),V=Object.create||function(t){function e(){}return e.prototype=t,new e};e.resolve=o,e.reject=r,e.never=i,e._defer=u,e._handler=v,e.prototype.then=function(t,e,n){var o=this._handler,r=o.join().state();if('function'!=typeof t&&r>0||'function'!=typeof e&&0>r)return new this.constructor(_,o);var i=this._beget(),u=i._handler;return o.chain(u,o.receiver,t,e,n),i},e.prototype['catch']=function(t){return this.then(void 0,t)},e.prototype._beget=function(){return c(this._handler,this.constructor)},e.all=f,e.race=d,e._traverse=s,e._visitRemaining=p,_.prototype.when=_.prototype.become=_.prototype.notify=_.prototype.fail=_.prototype._unreport=_.prototype._report=K,_.prototype._state=0,_.prototype.state=function(){return this._state},_.prototype.join=function(){for(var t=this;void 0!==t.handler;)t=t.handler;return t},_.prototype.chain=function(t,e,n,o,r){this.when({resolver:t,receiver:e,fulfilled:n,rejected:o,progress:r})},_.prototype.visit=function(t,e,n,o){this.chain(X,t,e,n,o)},_.prototype.fold=function(t,e,n,o){this.when(new S(t,e,n,o))},A(_,w),w.prototype.become=function(t){t.fail()};var X=new w;A(_,b),b.prototype._state=0,b.prototype.resolve=function(t){this.become(v(t))},b.prototype.reject=function(t){this.resolved||this.become(new P(t))},b.prototype.join=function(){if(!this.resolved)return this;for(var t=this;void 0!==t.handler;)if(t=t.handler,t===this)return this.handler=O();return t},b.prototype.run=function(){var t=this.consumers,e=this.handler;this.handler=this.handler.join(),this.consumers=void 0;for(var n=0;n<t.length;++n)e.when(t[n])},b.prototype.become=function(t){this.resolved||(this.resolved=!0,this.handler=t,void 0!==this.consumers&&G.enqueue(this),void 0!==this.context&&t._report(this.context))},b.prototype.when=function(t){this.resolved?G.enqueue(new T(t,this.handler)):void 0===this.consumers?this.consumers=[t]:this.consumers.push(t)},b.prototype.notify=function(t){this.resolved||G.enqueue(new Q(t,this))},b.prototype.fail=function(t){var e='undefined'==typeof t?this.context:t;this.resolved&&this.handler.join().fail(e)},b.prototype._report=function(t){this.resolved&&this.handler.join()._report(t)},b.prototype._unreport=function(){this.resolved&&this.handler.join()._unreport()},A(_,x),x.prototype.when=function(t){G.enqueue(new T(t,this))},x.prototype._report=function(t){this.join()._report(t)},x.prototype._unreport=function(){this.join()._unreport()},A(b,g),A(_,q),q.prototype._state=1,q.prototype.fold=function(t,e,n,o){N(t,e,this,n,o)},q.prototype.when=function(t){H(t.fulfilled,this,t.receiver,t.resolver)};var Y=0;A(_,P),P.prototype._state=-1,P.prototype.fold=function(t,e,n,o){o.become(this)},P.prototype.when=function(t){'function'==typeof t.rejected&&this._unreport(),H(t.rejected,this,t.receiver,t.resolver)},P.prototype._report=function(t){G.afterQueue(new R(this,t))},P.prototype._unreport=function(){this.handled||(this.handled=!0,G.afterQueue(new C(this)))},P.prototype.fail=function(t){this.reported=!0,I('unhandledRejection',this),e.onFatalRejection(this,void 0===t?this.context:t)},R.prototype.run=function(){this.rejection.handled||this.rejection.reported||(this.rejection.reported=!0,I('unhandledRejection',this.rejection)||e.onPotentiallyUnhandledRejection(this.rejection,this.context))},C.prototype.run=function(){this.rejection.reported&&(I('rejectionHandled',this.rejection)||e.onPotentiallyUnhandledRejectionHandled(this.rejection))},e.createContext=e.enterContext=e.exitContext=e.onPotentiallyUnhandledRejection=e.onPotentiallyUnhandledRejectionHandled=e.onFatalRejection=K;var Z=new _,$=new e(_,Z);return T.prototype.run=function(){this.handler.join().when(this.continuation)},Q.prototype.run=function(){var t=this.handler.consumers;if(void 0!==t)for(var e,n=0;n<t.length;++n)e=t[n],J(e.progress,this.value,this.handler,e.receiver,e.resolver)},E.prototype.run=function(){function t(t){o.resolve(t)}function e(t){o.reject(t)}function n(t){o.notify(t)}var o=this.resolver;L(this._then,this.thenable,t,e,n)},S.prototype.fulfilled=function(t){this.f.call(this.c,this.z,t,this.to)},S.prototype.rejected=function(t){this.to.reject(t)},S.prototype.progress=function(t){this.to.notify(t)},e}})}('function'==typeof t&&t.amd?t:function(t){n.exports=t()})},{}]},{},[1])(1)}),'undefined'!=typeof systemJSBootstrap&&systemJSBootstrap()}();!function(){function e(){!function(e){function t(e,n){if('string'!=typeof e)throw new TypeError('URL must be a string');var r=String(e).replace(/^\s+|\s+$/g,'').match(/^([^:\/?#]+:)?(?:\/\/(?:([^:@\/?#]*)(?::([^:@\/?#]*))?@)?(([^:\/?#]*)(?::(\d*))?))?([^?#]*)(\?[^#]*)?(#[\s\S]*)?/);if(!r)throw new RangeError('Invalid URL format');var a=r[1]||'',o=r[2]||'',i=r[3]||'',s=r[4]||'',l=r[5]||'',u=r[6]||'',d=r[7]||'',c=r[8]||'',f=r[9]||'';if(void 0!==n){var m=n instanceof t?n:new t(n),p=!a&&!s&&!o;!p||d||c||(c=m.search),p&&'/'!==d[0]&&(d=d?(!m.host&&!m.username||m.pathname?'':'/')+m.pathname.slice(0,m.pathname.lastIndexOf('/')+1)+d:m.pathname);var h=[];d.replace(/^(\.\.?(\/|$))+/,'').replace(/\/(\.(\/|$))+/g,'/').replace(/\/\.\.$/,'/../').replace(/\/?[^\/]*/g,function(e){'/..'===e?h.pop():h.push(e)}),d=h.join('').replace(/^\//,'/'===d[0]?'/':''),p&&(u=m.port,l=m.hostname,s=m.host,i=m.password,o=m.username),a||(a=m.protocol)}'file:'==a&&(d=d.replace(/\\/g,'/')),this.origin=s?a+(''!==a||''!==s?'//':'')+s:'',this.href=a+(a&&s||'file:'==a?'//':'')+(''!==o?o+(''!==i?':'+i:'')+'@':'')+s+d+c+f,this.protocol=a,this.username=o,this.password=i,this.host=s,this.hostname=l,this.port=u,this.pathname=d,this.search=c,this.hash=f}e.URLPolyfill=t}('undefined'!=typeof self?self:global),function(e){function t(e,t){if(!e.originalErr)for(var n=((e.message||e)+(e.stack?'\n'+e.stack:'')).toString().split('\n'),r=[],a=0;a<n.length;a++)('undefined'==typeof $__curScript||-1==n[a].indexOf($__curScript.src))&&r.push(n[a]);var o='(SystemJS) '+(r?r.join('\n	'):e.message.substr(11))+'\n	'+t;q||(o=o.replace(U?/file:\/\/\//g:/file:\/\//g,''));var i=$?new Error(o,e.fileName,e.lineNumber):new Error(o);return q?i.stack=null:i.stack=o,i.originalErr=e.originalErr||e,i}function n(){}function r(t){this._loader={loaderObj:this,loads:[],modules:{},importPromises:{},moduleRecords:{}},A(this,'global',{get:function(){return e}})}function a(){r.call(this),this.paths={},this._loader.paths={},V.call(this)}function o(){}function i(e,t){a.prototype[e]=t(a.prototype[e]||function(){})}function s(e){V=e(V||function(){})}function l(e){return e.match(Y)}function u(e){return'.'==e[0]&&(!e[1]||'/'==e[1]||'.'==e[1])||'/'==e[0]}function d(e){return!u(e)&&!l(e)}function c(e,t){if('.'==e[0]){if('/'==e[1]&&'.'!=e[2])return(t&&t.substr(0,t.lastIndexOf('/')+1)||N)+e.substr(2)}else if('/'!=e[0]&&-1==e.indexOf(':'))return(t&&t.substr(0,t.lastIndexOf('/')+1)||N)+e;return new X(e,t&&t.replace(/#/g,'%05')||Z).href.replace(/%05/g,'#')}function f(e,t){var n,r='',a=0,o=e.paths,i=e._loader.paths;for(var s in o)if(!o.hasOwnProperty||o.hasOwnProperty(s)){var l=o[s];if(l!==i[s]&&(l=o[s]=i[s]=c(o[s],u(o[s])?N:e.baseURL)),-1===s.indexOf('*')){if(t==s)return o[s];if(t.substr(0,s.length-1)==s.substr(0,s.length-1)&&(t.length<s.length||t[s.length-1]==s[s.length-1])&&('/'==o[s][o[s].length-1]||''==o[s]))return o[s].substr(0,o[s].length-1)+(t.length>s.length?(o[s]&&'/'||'')+t.substr(s.length):'')}else{var d=s.split('*');if(d.length>2)throw new TypeError('Only one wildcard in a path is permitted');var f=d[0].length;f>=a&&t.substr(0,d[0].length)==d[0]&&t.substr(t.length-d[1].length)==d[1]&&(a=f,r=s,n=t.substr(d[0].length,t.length-d[1].length-d[0].length))}}var m=o[r];return'string'==typeof n&&(m=m.replace('*',n)),m}function m(e){for(var t=[],n=[],r=0,a=e.length;a>r;r++){var o=J.call(t,e[r]);-1===o?(t.push(e[r]),n.push([r])):n[o].push(r)}return{names:t,indices:n}}function p(t){var n={};if(('object'==typeof t||'function'==typeof t)&&t!==e)if(K)for(var r in t)'default'!==r&&h(n,t,r);else g(n,t);return n['default']=t,A(n,'__useDefault',{value:!0}),n}function h(e,t,n){try{var r;(r=Object.getOwnPropertyDescriptor(t,n))&&A(e,n,r)}catch(a){return e[n]=t[n],!1}}function g(e,t,n){var r=t&&t.hasOwnProperty;for(var a in t)(!r||t.hasOwnProperty(a))&&(n&&a in e||(e[a]=t[a]));return e}function v(e,t,n){var r=t&&t.hasOwnProperty;for(var a in t)if(!r||t.hasOwnProperty(a)){var o=t[a];a in e?o instanceof Array&&e[a]instanceof Array?e[a]=[].concat(n?o:e[a]).concat(n?e[a]:o):'object'==typeof o&&null!==o&&'object'==typeof e[a]?e[a]=g(g({},e[a]),o,n):n||(e[a]=o):e[a]=o}}function y(e,t,n,r,a){for(var o in t)if(-1!=J.call(['main','format','defaultExtension','basePath'],o))e[o]=t[o];else if('map'==o)g(e.map=e.map||{},t.map);else if('meta'==o)g(e.meta=e.meta||{},t.meta);else if('depCache'==o)for(var i in t.depCache){var s;s='./'==i.substr(0,2)?n+'/'+i.substr(2):_.call(r,i),r.depCache[s]=(r.depCache[s]||[]).concat(t.depCache[i])}else!a||-1!=J.call(['browserConfig','nodeConfig','devConfig','productionConfig'],o)||t.hasOwnProperty&&!t.hasOwnProperty(o)||w.call(r,'"'+o+'" is not a valid package configuration option in package '+n)}function b(e,t,n,r){var a;if(e.packages[t]){var o=e.packages[t];a=e.packages[t]={},y(a,r?n:o,t,e,r),y(a,r?o:n,t,e,!r)}else a=e.packages[t]=n;return'object'==typeof a.main&&(a.map=a.map||{},a.map['./@main']=a.main,a.main['default']=a.main['default']||'./',a.main='@main'),a}function w(e){this.warnings&&'undefined'!=typeof console&&console.warn}function x(e,t){for(var n=e.split('.');n.length;)t=t[n.shift()];return t}function S(e,t){var n,r=0;for(var a in e)if(t.substr(0,a.length)==a&&(t.length==a.length||'/'==t[a.length])){var o=a.split('/').length;if(r>=o)continue;n=a,r=o}return n}function E(e){this._loader.baseURL!==this.baseURL&&('/'!=this.baseURL[this.baseURL.length-1]&&(this.baseURL+='/'),this._loader.baseURL=this.baseURL=new X(this.baseURL,Z).href)}function P(e,t){this.set('@system-env',ee=this.newModule({browser:q,node:!!this._nodeRequire,production:!t&&e,dev:t||!e,build:t,'default':!0}))}function k(e,t){if(!d(e))throw new Error('Node module '+e+' can\'t be loaded as it is not a package require.');if(!te){var n=this._nodeRequire('module'),r=t.substr(U?8:7);te=new n(r),te.paths=n._nodeModulePaths(r)}return te.require(e)}function _(e,t){if(u(e))return c(e,t);if(l(e))return e;var n=S(this.map,e);if(n){if(e=this.map[n]+e.substr(n.length),u(e))return c(e);if(l(e))return e}if(this.has(e))return e;if('@node/'==e.substr(0,6)){if(!this._nodeRequire)throw new TypeError('Error loading '+e+'. Can only load node core modules in Node.');return this.set(e,this.newModule(p(k.call(this,e.substr(6),this.baseURL)))),e}return E.call(this),f(this,e)||this.baseURL+e}function j(e,t,n){ee.browser&&t.browserConfig&&n(t.browserConfig),ee.node&&t.nodeConfig&&n(t.nodeConfig),ee.dev&&t.devConfig&&n(t.devConfig),ee.build&&t.buildConfig&&n(t.buildConfig),ee.production&&t.productionConfig&&n(t.productionConfig)}function O(e){var t=e.match(ae);return t&&'System.register'==e.substr(t[0].length,15)}function R(){return{name:null,deps:null,originalIndices:null,declare:null,execute:null,executingRequire:!1,declarative:!1,normalizedDeps:null,groupIndex:null,evaluated:!1,module:null,esModule:null,esmExports:!1}}function M(t){if('string'==typeof t)return x(t,e);if(!(t instanceof Array))throw new Error('Global exports must be a string or array.');for(var n={},r=!0,a=0;a<t.length;a++){var o=x(t[a],e);r&&(n['default']=o,r=!1),n[t[a].split('.').pop()]=o}return n}function z(e){var t,n,r,r='~'==e[0],a=e.lastIndexOf('|');return-1!=a?(t=e.substr(a+1),n=e.substr(r,a-r),r&&w.call(this,'Condition negation form "'+e+'" is deprecated for "'+n+'|~'+t+'"'),'~'==t[0]&&(r=!0,t=t.substr(1))):(t='default',n=e.substr(r),-1!=oe.indexOf(n)&&(t=n,n=null)),{module:n||'@system-env',prop:t,negate:r}}function I(e){return e.module+'|'+(e.negate?'~':'')+e.prop}function C(e,t,n){var r=this;return this.normalize(e.module,t).then(function(t){return r.load(t).then(function(a){var o=x(e.prop,r.get(t));if(n&&'boolean'!=typeof o)throw new TypeError('Condition '+I(e)+' did not resolve to a boolean.');return e.negate?!o:o})})}function L(e,t){var n=e.match(ie);if(!n)return Promise.resolve(e);var r=z.call(this,n[0].substr(2,n[0].length-3));return this.builder?this.normalize(r.module,t).then(function(t){return r.module=t,e.replace(ie,'#{'+I(r)+'}')}):C.call(this,r,t,!1).then(function(n){if('string'!=typeof n)throw new TypeError('The condition value for '+e+' doesn\'t resolve to a string.');if(-1!=n.indexOf('/'))throw new TypeError('Unabled to interpolate conditional '+e+(t?' in '+t:'')+'\n	The condition value '+n+' cannot contain a "/" separator.');return e.replace(ie,n)})}function T(e,t){var n=e.lastIndexOf('#?');if(-1==n)return Promise.resolve(e);var r=z.call(this,e.substr(n+2));return this.builder?this.normalize(r.module,t).then(function(t){return r.module=t,e.substr(0,n)+'#?'+I(r)}):C.call(this,r,t,!0).then(function(t){return t?e.substr(0,n):'@empty'})}var D='undefined'==typeof window&&'undefined'!=typeof self&&'undefined'!=typeof importScripts,q='undefined'!=typeof window&&'undefined'!=typeof document,U='undefined'!=typeof process&&'undefined'!=typeof process.platform&&!!process.platform.match(/^win/);e.console||(e.console={assert:function(){}});var A,J=Array.prototype.indexOf||function(e){for(var t=0,n=this.length;n>t;t++)if(this[t]===e)return t;return-1};!function(){try{Object.defineProperty({},'a',{})&&(A=Object.defineProperty)}catch(e){A=function(e,t,n){try{e[t]=n.value||n.get.call(e)}catch(r){}}}}();var N,$='_'==new Error(0,'_').fileName;if('undefined'!=typeof document&&document.getElementsByTagName){if(N=document.baseURI,!N){var F=document.getElementsByTagName('base');N=F[0]&&F[0].href||window.location.href}}else'undefined'!=typeof location&&(N=e.location.href);if(N)N=N.split('#')[0].split('?')[0],N=N.substr(0,N.lastIndexOf('/')+1);else{if('undefined'==typeof process||!process.cwd)throw new TypeError('No environment baseURI');N='file://'+(U?'/':'')+process.cwd()+'/',U&&(N=N.replace(/\\/g,'/'))}try{var B='test:'==new e.URL('test:///').protocol}catch(H){}var X=B?e.URL:e.URLPolyfill;A(n.prototype,'toString',{value:function(){return'Module'}}),function(){function e(e){return{status:'loading',name:e||'<Anonymous'+ ++b+'>',linkSets:[],dependencies:[],metadata:{}}}function a(e,t,n){return new Promise(u({step:n.address?'fetch':'locate',loader:e,moduleName:t,moduleMetadata:n&&n.metadata||{},moduleSource:n.source,moduleAddress:n.address}))}function o(t,n,r,a){return new Promise(function(e,o){e(t.loaderObj.normalize(n,r,a))}).then(function(n){var r;if(t.modules[n])return r=e(n),r.status='linked',r.module=t.modules[n],r;for(var a=0,o=t.loads.length;o>a;a++)if(r=t.loads[a],r.name==n)return r;return r=e(n),t.loads.push(r),i(t,r),r})}function i(e,t){s(e,t,Promise.resolve().then(function(){return e.loaderObj.locate({name:t.name,metadata:t.metadata})}))}function s(e,t,n){l(e,t,n.then(function(n){return'loading'==t.status?(t.address=n,e.loaderObj.fetch({name:t.name,metadata:t.metadata,address:n})):void 0}))}function l(e,t,n){n.then(function(n){return'loading'==t.status?(t.address=t.address||t.name,Promise.resolve(e.loaderObj.translate({name:t.name,metadata:t.metadata,address:t.address,source:n})).then(function(n){return t.source=n,e.loaderObj.instantiate({name:t.name,metadata:t.metadata,address:t.address,source:n})}).then(function(e){if(void 0===e)throw new TypeError('Declarative modules unsupported in the polyfill.');if('object'!=typeof e)throw new TypeError('Invalid instantiate return value');t.depsList=e.deps||[],t.execute=e.execute}).then(function(){t.dependencies=[];for(var n=t.depsList,r=[],a=0,i=n.length;i>a;a++)(function(n,a){r.push(o(e,n,t.name,t.address).then(function(e){if(t.dependencies[a]={key:n,value:e.name},'linked'!=e.status)for(var r=t.linkSets.concat([]),o=0,i=r.length;i>o;o++)c(r[o],e)}))}(n[a],a));return Promise.all(r)}).then(function(){t.status='loaded';for(var e=t.linkSets.concat([]),n=0,r=e.length;r>n;n++)m(e[n],t)})):void 0})['catch'](function(e){t.status='failed',t.exception=e;for(var n=t.linkSets.concat([]),r=0,a=n.length;a>r;r++)p(n[r],t,e)})}function u(t){return function(n,r){var a=t.loader,o=t.moduleName,u=t.step;if(a.modules[o])throw new TypeError('"'+o+'" already exists in the module table');for(var c,f=0,m=a.loads.length;m>f;f++)if(a.loads[f].name==o&&(c=a.loads[f],'translate'!=u||c.source||(c.address=t.moduleAddress,l(a,c,Promise.resolve(t.moduleSource))),c.linkSets.length&&c.linkSets[0].loads[0].name==c.name))return c.linkSets[0].done.then(function(){n(c)});var p=c||e(o);p.metadata=t.moduleMetadata;var h=d(a,p);a.loads.push(p),n(h.done),'locate'==u?i(a,p):'fetch'==u?s(a,p,Promise.resolve(t.moduleAddress)):(p.address=t.moduleAddress,l(a,p,Promise.resolve(t.moduleSource)))}}function d(e,t){var n={loader:e,loads:[],startingLoad:t,loadingCount:0};return n.done=new Promise(function(e,t){n.resolve=e,n.reject=t}),c(n,t),n}function c(e,t){if('failed'!=t.status){for(var n=0,r=e.loads.length;r>n;n++)if(e.loads[n]==t)return;e.loads.push(t),t.linkSets.push(e),'loaded'!=t.status&&e.loadingCount++;for(var a=e.loader,n=0,r=t.dependencies.length;r>n;n++)if(t.dependencies[n]){var o=t.dependencies[n].value;if(!a.modules[o])for(var i=0,s=a.loads.length;s>i;i++)if(a.loads[i].name==o){c(e,a.loads[i]);break}}}}function f(e){var t=!1;try{y(e,function(n,r){p(e,n,r),t=!0})}catch(n){p(e,null,n),t=!0}return t}function m(e,t){if(e.loadingCount--,!(e.loadingCount>0)){var n=e.startingLoad;if(e.loader.loaderObj.execute===!1){for(var r=[].concat(e.loads),a=0,o=r.length;o>a;a++){var t=r[a];t.module={name:t.name,module:w({}),evaluated:!0},t.status='linked',h(e.loader,t)}return e.resolve(n)}var i=f(e);i||e.resolve(n)}}function p(e,n,r){var a=e.loader;e:if(n)if(e.loads[0].name==n.name)r=t(r,'Error loading '+n.name);else{for(var o=0;o<e.loads.length;o++)for(var i=e.loads[o],s=0;s<i.dependencies.length;s++){var l=i.dependencies[s];if(l.value==n.name){r=t(r,'Error loading '+n.name+' as "'+l.key+'" from '+i.name);break e}}r=t(r,'Error loading '+n.name+' from '+e.loads[0].name)}else r=t(r,'Error linking '+e.loads[0].name);for(var u=e.loads.concat([]),o=0,d=u.length;d>o;o++){var n=u[o];a.loaderObj.failed=a.loaderObj.failed||[],-1==J.call(a.loaderObj.failed,n)&&a.loaderObj.failed.push(n);var c=J.call(n.linkSets,e);if(n.linkSets.splice(c,1),0==n.linkSets.length){var f=J.call(e.loader.loads,n);-1!=f&&e.loader.loads.splice(f,1)}}e.reject(r)}function h(e,t){if(e.loaderObj.trace){e.loaderObj.loads||(e.loaderObj.loads={});var n={};t.dependencies.forEach(function(e){n[e.key]=e.value}),e.loaderObj.loads[t.name]={name:t.name,deps:t.dependencies.map(function(e){return e.key}),depMap:n,address:t.address,metadata:t.metadata,source:t.source}}t.name&&(e.modules[t.name]=t.module);var r=J.call(e.loads,t);-1!=r&&e.loads.splice(r,1);for(var a=0,o=t.linkSets.length;o>a;a++)r=J.call(t.linkSets[a].loads,t),-1!=r&&t.linkSets[a].loads.splice(r,1);t.linkSets.splice(0,t.linkSets.length)}function g(e,t,r){try{var a=t.execute()}catch(o){return void r(t,o)}return a&&a instanceof n?a:void r(t,new TypeError('Execution must define a Module instance'))}function v(e,t,n){var r=e._loader.importPromises;return r[t]=n.then(function(e){return r[t]=void 0,e},function(e){throw r[t]=void 0,e})}function y(e,t){var n=e.loader;if(e.loads.length)for(var r=e.loads.concat([]),a=0;a<r.length;a++){var o=r[a],i=g(e,o,t);if(!i)return;o.module={name:o.name,module:i},o.status='linked',h(n,o)}}var b=0;r.prototype={constructor:r,define:function(e,t,n){if(this._loader.importPromises[e])throw new TypeError('Module is already loading.');return v(this,e,new Promise(u({step:'translate',loader:this._loader,moduleName:e,moduleMetadata:n&&n.metadata||{},moduleSource:t,moduleAddress:n&&n.address})))},'delete':function(e){var t=this._loader;return delete t.importPromises[e],delete t.moduleRecords[e],t.modules[e]?delete t.modules[e]:!1},get:function(e){return this._loader.modules[e]?this._loader.modules[e].module:void 0},has:function(e){return!!this._loader.modules[e]},'import':function(e,t,n){'object'==typeof t&&(t=t.name);var r=this;return Promise.resolve(r.normalize(e,t)).then(function(e){var t=r._loader;return t.modules[e]?t.modules[e].module:t.importPromises[e]||v(r,e,a(t,e,{}).then(function(n){return delete t.importPromises[e],n.module.module}))})},load:function(e){var t=this._loader;return t.modules[e]?Promise.resolve():t.importPromises[e]||v(this,e,new Promise(u({step:'locate',loader:t,moduleName:e,moduleMetadata:{},moduleSource:void 0,moduleAddress:void 0})).then(function(){delete t.importPromises[e]}))},module:function(t,n){var r=e();r.address=n&&n.address;var a=d(this._loader,r),o=Promise.resolve(t),i=this._loader,s=a.done.then(function(){return r.module.module});return l(i,r,o),s},newModule:function(e){if('object'!=typeof e)throw new TypeError('Expected object');var t=new n,r=[];if(Object.getOwnPropertyNames&&null!=e)r=Object.getOwnPropertyNames(e);else for(var a in e)r.push(a);for(var o=0;o<r.length;o++)(function(n){A(t,n,{configurable:!1,enumerable:!0,get:function(){return e[n]},set:function(){throw new Error('Module exports cannot be changed externally.')}})}(r[o]));return Object.freeze&&Object.freeze(t),t},set:function(e,t){if(!(t instanceof n))throw new TypeError('Loader.set('+e+', module) must be a module');this._loader.modules[e]={module:t}},normalize:function(e,t,n){},locate:function(e){return e.name},fetch:function(e){},translate:function(e){return e.source},instantiate:function(e){}};var w=r.prototype.newModule}();var G;o.prototype=r.prototype,a.prototype=new o,a.prototype.constructor=a;var V,Y=/^[^\/]+:\/\//,Z=new X(N),K=!0;try{Object.getOwnPropertyDescriptor({a:0},'a')}catch(H){K=!1}var Q;if('undefined'!=typeof XMLHttpRequest)Q=function(e,t,n,r){function a(){n(i.responseText)}function o(){r(new Error('XHR error'+(i.status?' ('+i.status+(i.statusText?' '+i.statusText:'')+')':'')+' loading '+e))}var i=new XMLHttpRequest,s=!0,l=!1;if(!('withCredentials'in i)){var u=/^(\w+:)?\/\/([^\/]+)/.exec(e);u&&(s=u[2]===window.location.host,u[1]&&(s&=u[1]===window.location.protocol))}s||'undefined'==typeof XDomainRequest||(i=new XDomainRequest,i.onload=a,i.onerror=o,i.ontimeout=o,i.onprogress=function(){},i.timeout=0,l=!0),i.onreadystatechange=function(){4===i.readyState&&(0==i.status?i.responseText?a():(i.addEventListener('error',o),i.addEventListener('load',a)):200===i.status?a():o())},i.open('GET',e,!0),i.setRequestHeader&&(i.setRequestHeader('Accept','application/x-es-module, */*'),t&&('string'==typeof t&&i.setRequestHeader('Authorization',t),i.withCredentials=!0)),l?setTimeout(function(){i.send()},0):i.send(null)};else if('undefined'!=typeof require&&'undefined'!=typeof process){var W;Q=function(e,t,n,r){if('file:///'!=e.substr(0,8))throw new Error('Unable to fetch "'+e+'". Only file URLs of the form file:/// allowed running in Node.');return W=W||require('fs'),e=U?e.replace(/\//g,'\\').substr(8):e.substr(7),W.readFile(e,function(e,t){if(e)return r(e);var a=t+'';'﻿'===a[0]&&(a=a.substr(1)),n(a)})}}else{if('undefined'==typeof self||'undefined'==typeof self.fetch)throw new TypeError('No environment fetch API available.');Q=function(e,t,n,r){var a={headers:{Accept:'application/x-es-module, */*'}};t&&('string'==typeof t&&(a.headers.Authorization=t),a.credentials='include'),fetch(e,a).then(function(e){if(e.ok)return e.text();throw new Error('Fetch error: '+e.status+' '+e.statusText)}).then(n,r)}}var ee;s(function(e){return function(){e.call(this),this.baseURL=N,this.map={},this.warnings=!1,this.defaultJSExtensions=!1,this.pluginFirst=!1,this.loaderErrorStack=!1,this.set('@empty',this.newModule({})),P.call(this,!1,!1)}}),'undefined'==typeof require||'undefined'==typeof process||process.browser||(a.prototype._nodeRequire=require);var te;i('normalize',function(e){return function(e,t,n){var r=_.call(this,e,t);return!this.defaultJSExtensions||n||'.js'==r.substr(r.length-3,3)||d(r)||(r+='.js'),r}});var ne='undefined'!=typeof XMLHttpRequest;i('locate',function(e){return function(t){return Promise.resolve(e.call(this,t)).then(function(e){return ne?e.replace(/#/g,'%23'):e})}}),i('fetch',function(){return function(e){return new Promise(function(t,n){Q(e.address,e.metadata.authorization,t,n)})}}),i('import',function(e){return function(t,n,r){return n&&n.name&&w.call(this,'SystemJS.import(name, { name: parentName }) is deprecated for SystemJS.import(name, parentName), while importing '+t+' from '+n.name),e.call(this,t,n,r).then(function(e){return e.__useDefault?e['default']:e})}}),i('translate',function(e){return function(t){return'detect'==t.metadata.format&&(t.metadata.format=void 0),e.apply(this,arguments)}}),i('instantiate',function(e){return function(e){if('json'==e.metadata.format&&!this.builder){var t=e.metadata.entry=R();t.deps=[],t.execute=function(){try{return JSON.parse(e.source)}catch(t){throw new Error('Invalid JSON file '+e.name)}}}}}),a.prototype.getConfig=function(e){var t={},n=this;for(var r in n)n.hasOwnProperty&&!n.hasOwnProperty(r)||r in a.prototype&&'transpiler'!=r||-1==J.call(['_loader','amdDefine','amdRequire','defined','failed','version'],r)&&(t[r]=n[r]);return t.production=ee.production,t};var re;a.prototype.config=function(e,t){function n(e){for(var t in e)if(e.hasOwnProperty(t))return!0}var r=this;if('loaderErrorStack'in e&&(re=$__curScript,e.loaderErrorStack?$__curScript=void 0:$__curScript=re),'warnings'in e&&(r.warnings=e.warnings),e.transpilerRuntime===!1&&(r._loader.loadedTranspilerRuntime=!0),('production'in e||'build'in e)&&P.call(r,!!e.production,!!(e.build||ee&&ee.build)),!t){var a;if(j(r,e,function(e){a=a||e.baseURL}),a=a||e.baseURL){if(n(r.packages)||n(r.meta)||n(r.depCache)||n(r.bundles)||n(r.packageConfigPaths))throw new TypeError('Incorrect configuration order. The baseURL must be configured with the first SystemJS.config call.');this.baseURL=a,E.call(this)}if(e.paths&&g(r.paths,e.paths),j(r,e,function(e){e.paths&&g(r.paths,e.paths)}),this.warnings)for(var o in r.paths)-1!=o.indexOf('*')&&w.call(r,'Paths configuration "'+o+'" -> "'+r.paths[o]+'" uses wildcards which are being deprecated for simpler trailing "/" folder paths.')}if(e.defaultJSExtensions&&(r.defaultJSExtensions=e.defaultJSExtensions,w.call(r,'The defaultJSExtensions configuration option is deprecated, use packages configuration instead.')),e.pluginFirst&&(r.pluginFirst=e.pluginFirst),e.map){var i='';for(var o in e.map){var s=e.map[o];if('string'!=typeof s){i+=(i.length?', ':'')+'"'+o+'"';var l=r.defaultJSExtensions&&'.js'!=o.substr(o.length-3,3),u=r.decanonicalize(o);l&&'.js'==u.substr(u.length-3,3)&&(u=u.substr(0,u.length-3));var c='';for(var f in r.packages)u.substr(0,f.length)==f&&(!u[f.length]||'/'==u[f.length])&&c.split('/').length<f.split('/').length&&(c=f);c&&r.packages[c].main&&(u=u.substr(0,u.length-r.packages[c].main.length-1));var f=r.packages[u]=r.packages[u]||{};f.map=s}else r.map[o]=s}i&&w.call(r,'The map configuration for '+i+' uses object submaps, which is deprecated in global map.\nUpdate this to use package contextual map with configs like SystemJS.config({ packages: { "'+o+'": { map: {...} } } }).')}if(e.packageConfigPaths){for(var m=[],p=0;p<e.packageConfigPaths.length;p++){var h=e.packageConfigPaths[p],v=Math.max(h.lastIndexOf('*')+1,h.lastIndexOf('/')),y=_.call(r,h.substr(0,v));m[p]=y+h.substr(v)}r.packageConfigPaths=m}if(e.bundles)for(var o in e.bundles){for(var x=[],p=0;p<e.bundles[o].length;p++){var l=r.defaultJSExtensions&&'.js'!=e.bundles[o][p].substr(e.bundles[o][p].length-3,3),S=r.decanonicalize(e.bundles[o][p]);l&&'.js'==S.substr(S.length-3,3)&&(S=S.substr(0,S.length-3)),x.push(S)}r.bundles[o]=x}if(e.packages)for(var o in e.packages){if(o.match(/^([^\/]+:)?\/\/$/))throw new TypeError('"'+o+'" is not a valid package name.');var u=_.call(r,o);'/'==u[u.length-1]&&(u=u.substr(0,u.length-1)),b(r,u,e.packages[o],!1)}for(var k in e){var s=e[k];if(-1==J.call(['baseURL','map','packages','bundles','paths','warnings','packageConfigPaths','loaderErrorStack','browserConfig','nodeConfig','devConfig','buildConfig','productionConfig'],k))if('object'!=typeof s||s instanceof Array)r[k]=s;else{r[k]=r[k]||{};for(var o in s)if('meta'==k&&'*'==o[0])g(r[k][o]=r[k][o]||{},s[o]);else if('meta'==k){var O=_.call(r,o);r.defaultJSExtensions&&'.js'!=O.substr(O.length-3,3)&&!d(O)&&(O+='.js'),g(r[k][O]=r[k][O]||{},s[o])}else if('depCache'==k){var l=r.defaultJSExtensions&&'.js'!=o.substr(o.length-3,3),u=r.decanonicalize(o);l&&'.js'==u.substr(u.length-3,3)&&(u=u.substr(0,u.length-3)),r[k][u]=[].concat(s[o])}else r[k][o]=s[o]}}j(r,e,function(e){r.config(e,!0)})},function(){function e(e,t){var n,r,a=0;for(var o in e.packages)t.substr(0,o.length)!==o||t.length!==o.length&&'/'!==t[o.length]||(r=o.split('/').length,r>a&&(n=o,a=r));return n}function t(e,t,n,r,a){if(!r||'/'==r[r.length-1]||a||t.defaultExtension===!1)return r;var o=!1;if(t.meta&&p(t.meta,r,function(e,t,n){return 0==n||e.lastIndexOf('*')!=e.length-1?o=!0:void 0}),!o&&e.meta&&p(e.meta,n+'/'+r,function(e,t,n){return 0==n||e.lastIndexOf('*')!=e.length-1?o=!0:void 0}),o)return r;var i='.'+(t.defaultExtension||'js');return r.substr(r.length-i.length)!=i?r+i:r}function n(e,n,r,a,i){if(!a){if(!n.main)return r+(e.defaultJSExtensions?'.js':'');a='./'==n.main.substr(0,2)?n.main.substr(2):n.main}if(n.map){var s='./'+a,l=S(n.map,s);if(l||(s='./'+t(e,n,r,a,i),s!='./'+a&&(l=S(n.map,s))),l){var u=o(e,n,r,l,s,i);if(u)return u}}return r+'/'+t(e,n,r,a,i)}function r(e,t,n,r){if('.'==e)throw new Error('Package '+n+' has a map entry for "." which is not permitted.');return t.substr(0,e.length)==e&&r.length>e.length?!1:!0}function o(e,n,a,o,i,s){'/'==i[i.length-1]&&(i=i.substr(0,i.length-1));var l=n.map[o];if('object'==typeof l)throw new Error('Synchronous conditional normalization not supported sync normalizing '+o+' in '+a);if(r(o,l,a,i)&&'string'==typeof l){if('.'==l)l=a;else if('./'==l.substr(0,2))return a+'/'+t(e,n,a,l.substr(2)+i.substr(o.length),s);return e.normalizeSync(l+i.substr(o.length),a+'/')}}function l(e,n,r,a,o){if(!a){if(!n.main)return Promise.resolve(r+(e.defaultJSExtensions?'.js':''));a='./'==n.main.substr(0,2)?n.main.substr(2):n.main}var i,s;return n.map&&(i='./'+a,s=S(n.map,i),s||(i='./'+t(e,n,r,a,o),i!='./'+a&&(s=S(n.map,i)))),(s?d(e,n,r,s,i,o):Promise.resolve()).then(function(i){return i?Promise.resolve(i):Promise.resolve(r+'/'+t(e,n,r,a,o))})}function u(e,n,r,a,o,i,s){if('.'==o)o=r;else if('./'==o.substr(0,2))return Promise.resolve(r+'/'+t(e,n,r,o.substr(2)+i.substr(a.length),s)).then(function(t){return L.call(e,t,r+'/')});return e.normalize(o+i.substr(a.length),r+'/')}function d(e,t,n,a,o,i){'/'==o[o.length-1]&&(o=o.substr(0,o.length-1));var s=t.map[a];if('string'==typeof s)return r(a,s,n,o)?u(e,t,n,a,s,o,i):Promise.resolve();if(e.builder)return Promise.resolve(n+'/#:'+o);var l=[],d=[];for(var c in s){var f=z(c);d.push({condition:f,map:s[c]}),l.push(e['import'](f.module,n))}return Promise.all(l).then(function(e){for(var t=0;t<d.length;t++){var n=d[t].condition,r=x(n.prop,e[t]);if(!n.negate&&r||n.negate&&!r)return d[t].map}}).then(function(s){if(s){if(!r(a,s,n,o))return;return u(e,t,n,a,s,o,i)}})}function c(e){var t=e.lastIndexOf('*'),n=Math.max(t+1,e.lastIndexOf('/'));return{length:n,regEx:new RegExp('^('+e.substr(0,n).replace(/[.+?^${}()|[\]\\]/g,'\\$&').replace(/\*/g,'[^\\/]+')+')(\\/|$)'),wildcard:-1!=t}}function f(e,t){for(var n,r,a=!1,o=0;o<e.packageConfigPaths.length;o++){var i=e.packageConfigPaths[o],s=h[i]||(h[i]=c(i));if(!(t.length<s.length)){var l=t.match(s.regEx);!l||n&&(a&&s.wildcard||!(n.length<l[1].length))||(n=l[1],a=!s.wildcard,r=n+i.substr(s.length))}}return n?{packageName:n,configPath:r}:void 0}function m(e,t,n){var r=e.pluginLoader||e;return(r.meta[n]=r.meta[n]||{}).format='json',r.meta[n].loader=null,r.load(n).then(function(){var a=r.get(n)['default'];return a.systemjs&&(a=a.systemjs),a.modules&&(a.meta=a.modules,w.call(e,'Package config file '+n+' is configured with "modules", which is deprecated as it has been renamed to "meta".')),b(e,t,a,!0)})}function p(e,t,n){var r;for(var a in e){var o='./'==a.substr(0,2)?'./':'';if(o&&(a=a.substr(2)),r=a.indexOf('*'),-1!==r&&a.substr(0,r)==t.substr(0,r)&&a.substr(r+1)==t.substr(t.length-a.length+r+1)&&n(a,e[o+a],a.split('/').length))return}var i=e[t]&&e.hasOwnProperty&&e.hasOwnProperty(t)?e[t]:e['./'+t];i&&n(i,i,0)}s(function(e){return function(){e.call(this),this.packages={},this.packageConfigPaths=[]}}),a.prototype.normalizeSync=a.prototype.decanonicalize=a.prototype.normalize,i('decanonicalize',function(t){return function(n,r){if(this.builder)return t.call(this,n,r,!0);var a=t.call(this,n,r,!1);if(!this.defaultJSExtensions)return a;var o=e(this,a),i=this.packages[o],s=i&&i.defaultExtension;return void 0==s&&i&&i.meta&&p(i.meta,a.substr(o),function(e,t,n){return 0==n||e.lastIndexOf('*')!=e.length-1?(s=!1,!0):void 0}),(s===!1||s&&'.js'!=s)&&'.js'!=n.substr(n.length-3,3)&&'.js'==a.substr(a.length-3,3)&&(a=a.substr(0,a.length-3)),a}}),i('normalizeSync',function(t){return function(r,a,i){var s=this;if(i=i===!0,a)var l=e(s,a)||s.defaultJSExtensions&&'.js'==a.substr(a.length-3,3)&&e(s,a.substr(0,a.length-3));var u=l&&s.packages[l];if(u&&'.'!=r[0]){var d=u.map,c=d&&S(d,r);if(c&&'string'==typeof d[c]){var m=o(s,u,l,c,r,i);if(m)return m}}var p=s.defaultJSExtensions&&'.js'!=r.substr(r.length-3,3),h=t.call(s,r,a,!1);p&&'.js'!=h.substr(h.length-3,3)&&(p=!1),p&&(h=h.substr(0,h.length-3));var g=f(s,h),v=g&&g.packageName||e(s,h);if(!v)return h+(p?'.js':'');var y=h.substr(v.length+1);return n(s,s.packages[v]||{},v,y,i)}}),i('normalize',function(t){return function(n,r,a){var o=this;return a=a===!0,Promise.resolve().then(function(){if(r)var t=e(o,r)||o.defaultJSExtensions&&'.js'==r.substr(r.length-3,3)&&e(o,r.substr(0,r.length-3));var i=t&&o.packages[t];if(i&&'./'!=n.substr(0,2)){var s=i.map,l=s&&S(s,n);if(l)return d(o,i,t,l,n,a)}return Promise.resolve()}).then(function(i){if(i)return i;var s=o.defaultJSExtensions&&'.js'!=n.substr(n.length-3,3),u=t.call(o,n,r,!1);s&&'.js'!=u.substr(u.length-3,3)&&(s=!1),s&&(u=u.substr(0,u.length-3));var d=f(o,u),c=d&&d.packageName||e(o,u);if(!c)return Promise.resolve(u+(s?'.js':''));var p=o.packages[c],h=p&&(p.configured||!d);return(h?Promise.resolve(p):m(o,c,d.configPath)).then(function(e){var t=u.substr(c.length+1);return l(o,e,c,t,a)})})}});var h={};i('locate',function(t){return function(n){var r=this;return Promise.resolve(t.call(this,n)).then(function(t){var a=e(r,n.name);if(a){var o=r.packages[a],i=n.name.substr(a.length+1),s={};if(o.meta){var l=0;p(o.meta,i,function(e,t,n){n>l&&(l=n),v(s,t,n&&l>n)}),v(n.metadata,s)}o.format&&!n.metadata.loader&&(n.metadata.format=n.metadata.format||o.format)}return t})}})}(),function(){function t(){if(s&&'interactive'===s.script.readyState)return s.load;for(var e=0;e<d.length;e++)if('interactive'==d[e].script.readyState)return s=d[e],s.load}function n(e,t){return new Promise(function(e,n){t.metadata.integrity&&n(new Error('Subresource integrity checking is not supported in web workers.')),l=t;try{importScripts(t.address)}catch(r){l=null,n(r)}l=null,t.metadata.entry||n(new Error(t.address+' did not call System.register or AMD define. If loading a global, ensure the meta format is set to global.')),e('')})}if('undefined'!=typeof document)var r=document.getElementsByTagName('head')[0];var a,o,s,l=null,u=r&&function(){var e=document.createElement('script'),t='undefined'!=typeof opera&&'[object Opera]'===opera.toString();return e.attachEvent&&!(e.attachEvent.toString&&e.attachEvent.toString().indexOf('[native code')<0)&&!t}(),d=[],c=0,f=[];i('pushRegister_',function(e){return function(n){return e.call(this,n)?!1:(l?this.reduceRegister_(l,n):u?this.reduceRegister_(t(),n):c?f.push(n):this.reduceRegister_(null,n),!0)}}),i('fetch',function(t){return function(i){var l=this;return'json'!=i.metadata.format&&i.metadata.scriptLoad&&(q||D)?D?n(l,i):new Promise(function(t,n){function m(e){if(!g.readyState||'loaded'==g.readyState||'complete'==g.readyState){if(c--,i.metadata.entry||f.length){if(!u){for(var r=0;r<f.length;r++)l.reduceRegister_(i,f[r]);f=[]}}else l.reduceRegister_(i);h(),i.metadata.entry||i.metadata.bundle||n(new Error(i.name+' did not call System.register or AMD define. If loading a global module configure the global name via the meta exports property for script injection support.')),t('')}}function p(e){h(),n(new Error('Unable to load script '+i.address))}function h(){if(e.System=a,e.require=o,g.detachEvent){g.detachEvent('onreadystatechange',m);for(var t=0;t<d.length;t++)d[t].script==g&&(s&&s.script==g&&(s=null),d.splice(t,1))}else g.removeEventListener('load',m,!1),g.removeEventListener('error',p,!1);r.removeChild(g)}var g=document.createElement('script');g.async=!0,i.metadata.crossOrigin&&(g.crossOrigin=i.metadata.crossOrigin),i.metadata.integrity&&g.setAttribute('integrity',i.metadata.integrity),u?(g.attachEvent('onreadystatechange',m),d.push({script:g,load:i})):(g.addEventListener('load',m,!1),g.addEventListener('error',p,!1)),c++,a=e.System,o=e.require,g.src=i.address,r.appendChild(g)}):t.call(this,i)}})}();var ae=/^(\s*\/\*[^\*]*(\*(?!\/)[^\*]*)*\*\/|\s*\/\/[^\n]*|\s*"[^"]+"\s*;?|\s*'[^']+'\s*;?)*\s*/;!function(){function t(e,n,r){if(r[e.groupIndex]=r[e.groupIndex]||[],-1==J.call(r[e.groupIndex],e)){r[e.groupIndex].push(e);for(var a=0,o=e.normalizedDeps.length;o>a;a++){var i=e.normalizedDeps[a],s=n.defined[i];if(s&&!s.evaluated){var l=e.groupIndex+(s.declarative!=e.declarative);if(null===s.groupIndex||s.groupIndex<l){if(null!==s.groupIndex&&(r[s.groupIndex].splice(J.call(r[s.groupIndex],s),1),0==r[s.groupIndex].length))throw new Error('Mixed dependency cycle detected');s.groupIndex=l}t(s,n,r)}}}}function r(e,n,r){if(!n.module){n.groupIndex=0;var a=[];t(n,r,a);for(var o=!!n.declarative==a.length%2,i=a.length-1;i>=0;i--){for(var s=a[i],l=0;l<s.length;l++){var d=s[l];o?u(d,r):c(d,r)}o=!o}}}function o(){}function l(e,t){return t[e]||(t[e]={name:e,dependencies:[],exports:new o,importers:[]})}function u(t,n){if(!t.module){var r=n._loader.moduleRecords,a=t.module=l(t.name,r),o=t.module.exports,i=t.declare.call(e,function(e,t){if(a.locked=!0,'object'==typeof e)for(var n in e)o[n]=e[n];else o[e]=t;for(var r=0,i=a.importers.length;i>r;r++){var s=a.importers[r];if(!s.locked){var l=J.call(s.dependencies,a),u=s.setters[l];u&&u(o)}}return a.locked=!1,t},{id:t.name});if(i=i||{setters:[],execute:function(){}},a.setters=i.setters,a.execute=i.execute,!a.setters||!a.execute)throw new TypeError('Invalid System.register form for '+t.name);for(var s=0,d=t.normalizedDeps.length;d>s;s++){var c,f=t.normalizedDeps[s],m=n.defined[f],p=r[f];p?c=p.exports:m&&!m.declarative?c=m.esModule:m?(u(m,n),p=m.module,c=p.exports):c=n.get(f),p&&p.importers?(p.importers.push(a),a.dependencies.push(p)):a.dependencies.push(null);for(var h=t.originalIndices[s],g=0,v=h.length;v>g;++g){var y=h[g];a.setters[y]&&a.setters[y](c)}}}}function d(e,t){var n,r=t.defined[e];if(r)r.declarative?f(e,r,[],t):r.evaluated||c(r,t),n=r.module.exports;else if(n=t.get(e),!n)throw new Error('Unable to load dependency '+e+'.');return(!r||r.declarative)&&n&&n.__useDefault?n['default']:n}function c(t,r){if(!t.module){var a={},o=t.module={exports:a,id:t.name};if(!t.executingRequire)for(var i=0,s=t.normalizedDeps.length;s>i;i++){var l=t.normalizedDeps[i],u=r.defined[l];u&&c(u,r)}t.evaluated=!0;var f=t.execute.call(e,function(e){for(var n=0,a=t.deps.length;a>n;n++)if(t.deps[n]==e)return d(t.normalizedDeps[n],r);var o=r.normalizeSync(e,t.name);if(-1!=J.call(t.normalizedDeps,o))return d(o,r);throw new Error('Module '+e+' not declared as a dependency of '+t.name)},a,o);f&&(o.exports=f),a=o.exports,a&&(a.__esModule||a instanceof n)?t.esModule=r.newModule(a):t.esmExports&&a!==e?t.esModule=r.newModule(p(a)):t.esModule=r.newModule({'default':a})}}function f(t,n,r,a){if(n&&!n.evaluated&&n.declarative){r.push(t);for(var o=0,i=n.normalizedDeps.length;i>o;o++){var s=n.normalizedDeps[o];-1==J.call(r,s)&&(a.defined[s]?f(s,a.defined[s],r,a):a.get(s))}n.evaluated||(n.evaluated=!0,n.module.execute.call(e))}}a.prototype.register=function(e,t,n){if('string'!=typeof e&&(n=t,t=e,e=null),'boolean'==typeof n)return this.registerDynamic.apply(this,arguments);var r=R();r.name=e&&(this.decanonicalize||this.normalize).call(this,e),r.declarative=!0,r.deps=t,r.declare=n,this.pushRegister_({amd:!1,entry:r})},a.prototype.registerDynamic=function(e,t,n,r){'string'!=typeof e&&(r=n,n=t,t=e,e=null);var a=R();a.name=e&&(this.decanonicalize||this.normalize).call(this,e),a.deps=t,a.execute=r,a.executingRequire=n,this.pushRegister_({amd:!1,entry:a})},i('reduceRegister_',function(){return function(e,t){if(t){var n=t.entry,r=e&&e.metadata;if(n.name&&(n.name in this.defined||(this.defined[n.name]=n),r&&(r.bundle=!0)),!n.name||e&&!r.entry&&n.name==e.name){if(!r)throw new TypeError('Invalid System.register call. Anonymous System.register calls can only be made by modules loaded by SystemJS.import and not via script tags.');if(r.entry)throw'register'==r.format?new Error('Multiple anonymous System.register calls in module '+e.name+'. If loading a bundle, ensure all the System.register calls are named.'):new Error('Module '+e.name+' interpreted as '+r.format+' module format, but called System.register.');r.format||(r.format='register'),r.entry=n}}}}),s(function(e){return function(){e.call(this),this.defined={},this._loader.moduleRecords={}}}),A(o,'toString',{value:function(){return'Module'}}),i('delete',function(e){return function(t){return delete this._loader.moduleRecords[t],delete this.defined[t],e.call(this,t)}}),i('fetch',function(e){return function(t){return this.defined[t.name]?(t.metadata.format='defined',''):(t.metadata.deps=t.metadata.deps||[],e.call(this,t))}}),i('translate',function(e){return function(t){return t.metadata.deps=t.metadata.deps||[],Promise.resolve(e.apply(this,arguments)).then(function(e){return('register'==t.metadata.format||!t.metadata.format&&O(t.source))&&(t.metadata.format='register'),e})}}),i('load',function(e){return function(t){var n=this,a=n.defined[t];return!a||a.deps.length?e.apply(this,arguments):(a.originalIndices=a.normalizedDeps=[],r(t,a,n),f(t,a,[],n),a.esModule||(a.esModule=n.newModule(a.module.exports)),n.trace||(n.defined[t]=void 0),n.set(t,a.esModule),Promise.resolve())}}),i('instantiate',function(e){return function(t){'detect'==t.metadata.format&&(t.metadata.format=void 0),e.call(this,t);var n,a=this;if(a.defined[t.name])n=a.defined[t.name],n.declarative||(n.deps=n.deps.concat(t.metadata.deps)),n.deps=n.deps.concat(t.metadata.deps);else if(t.metadata.entry)n=t.metadata.entry,n.deps=n.deps.concat(t.metadata.deps);else if(!(a.builder&&t.metadata.bundle||'register'!=t.metadata.format&&'esm'!=t.metadata.format&&'es6'!=t.metadata.format)){if('undefined'!=typeof __exec&&__exec.call(a,t),!t.metadata.entry&&!t.metadata.bundle)throw new Error(t.name+' detected as '+t.metadata.format+' but didn\'t execute.');n=t.metadata.entry,n&&t.metadata.deps&&(n.deps=n.deps.concat(t.metadata.deps))}n||(n=R(),n.deps=t.metadata.deps,n.execute=function(){}),a.defined[t.name]=n;var o=m(n.deps);n.deps=o.names,n.originalIndices=o.indices,n.name=t.name,n.esmExports=t.metadata.esmExports!==!1;for(var i=[],s=0,l=n.deps.length;l>s;s++)i.push(Promise.resolve(a.normalize(n.deps[s],t.name)));return Promise.all(i).then(function(e){return n.normalizedDeps=e,{deps:n.deps,execute:function(){return r(t.name,n,a),f(t.name,n,[],a),n.esModule||(n.esModule=a.newModule(n.module.exports)),a.trace||(a.defined[t.name]=void 0),n.esModule}}})}})}(),i('reduceRegister_',function(e){return function(t,n){if(n||!t.metadata.exports&&(!D||'global'!=t.metadata.format))return e.call(this,t,n);t.metadata.format='global';var r=t.metadata.entry=R();r.deps=t.metadata.deps;var a=M(t.metadata.exports);r.execute=function(){return a}}}),s(function(t){return function(){function n(t){if(Object.keys)Object.keys(e).forEach(t);else for(var n in e)i.call(e,n)&&t(n)}function r(t){n(function(n){if(-1==J.call(s,n)){try{var r=e[n]}catch(a){s.push(n)}t(n,r)}})}var a=this;t.call(a);var o,i=Object.prototype.hasOwnProperty,s=['_g','sessionStorage','localStorage','clipboardData','frames','frameElement','external','mozAnimationStartTime','webkitStorageInfo','webkitIndexedDB','mozInnerScreenY','mozInnerScreenX'];a.set('@@global-helpers',a.newModule({prepareGlobal:function(t,n,a,i){var s=e.define;e.define=void 0;var l;if(a){l={};for(var u in a)l[u]=e[u],e[u]=a[u]}return n||(o={},r(function(e,t){o[e]=t})),function(){var t,a=n?M(n):{},u=!!n;if((!n||i)&&r(function(r,s){o[r]!==s&&'undefined'!=typeof s&&(i&&(e[r]=void 0),n||(a[r]=s,'undefined'!=typeof t?u||t===s||(u=!0):t=s))}),a=u?a:t,l)for(var d in l)e[d]=l[d];return e.define=s,a}}}))}}),s(function(e){return function(){function t(e){return'file:///'==e.substr(0,8)?e.substr(7+!!U):r&&e.substr(0,r.length)==r?e.substr(r.length):e}var n=this;if(e.call(n),'undefined'!=typeof window&&'undefined'!=typeof document&&window.location)var r=location.protocol+'//'+location.hostname+(location.port?':'+location.port:'');n.set('@@cjs-helpers',n.newModule({requireResolve:function(e,r){return t(n.normalizeSync(e,r))},getPathVars:function(e){var n,r=e.lastIndexOf('!');n=-1!=r?e.substr(0,r):e;var a=n.split('/');return a.pop(),a=a.join('/'),{filename:t(n),dirname:t(a)}}}))}}),i('fetch',function(t){return function(n){return n.metadata.scriptLoad&&q&&(e.define=this.amdDefine),t.call(this,n)}}),s(function(t){return function(){function n(e,t){e=e.replace(s,'');var n=e.match(d),r=(n[1].split(',')[t]||'require').replace(c,''),a=f[r]||(f[r]=new RegExp(l+r+u,'g'));a.lastIndex=0;for(var o,i=[];o=a.exec(e);)i.push(o[2]||o[3]);return i}function r(e,t,n,a){if('object'==typeof e&&!(e instanceof Array))return r.apply(null,Array.prototype.splice.call(arguments,1,arguments.length-1));if('string'==typeof e&&'function'==typeof t&&(e=[e]),!(e instanceof Array)){if('string'==typeof e){var i=o.defaultJSExtensions&&'.js'!=e.substr(e.length-3,3),s=o.decanonicalize(e,a);i&&'.js'==s.substr(s.length-3,3)&&(s=s.substr(0,s.length-3));var l=o.get(s);if(!l)throw new Error('Module not already loaded loading "'+e+'" as '+s+(a?' from "'+a+'".':'.'));return l.__useDefault?l['default']:l}throw new TypeError('Invalid require')}for(var u=[],d=0;d<e.length;d++)u.push(o['import'](e[d],a));Promise.all(u).then(function(e){t&&t.apply(null,e)},n)}function a(t,a,i){function s(t,n,s){function c(e,n,a){return'string'==typeof e&&'function'!=typeof n?t(e):r.call(o,e,n,a,s.id)}for(var f=[],m=0;m<a.length;m++)f.push(t(a[m]));s.uri=s.id,s.config=function(){},-1!=d&&f.splice(d,0,s),-1!=u&&f.splice(u,0,n),-1!=l&&(c.toUrl=function(e){var t=o.defaultJSExtensions&&'.js'!=e.substr(e.length-3,3),n=o.decanonicalize(e,s.id);return t&&'.js'==n.substr(n.length-3,3)&&(n=n.substr(0,n.length-3)),n},f.splice(l,0,c));var p=e.require;e.require=r;var h=i.apply(-1==u?e:n,f);return e.require=p,'undefined'==typeof h&&s&&(h=s.exports),'undefined'!=typeof h?h:void 0}'string'!=typeof t&&(i=a,a=t,t=null),a instanceof Array||(i=a,a=['require','exports','module'].splice(0,i.length)),'function'!=typeof i&&(i=function(e){return function(){return e}}(i)),void 0===a[a.length-1]&&a.pop();var l,u,d;-1!=(l=J.call(a,'require'))&&(a.splice(l,1),t||(a=a.concat(n(i.toString(),l)))),-1!=(u=J.call(a,'exports'))&&a.splice(u,1),-1!=(d=J.call(a,'module'))&&a.splice(d,1);var c=R();c.name=t&&(o.decanonicalize||o.normalize).call(o,t),c.deps=a,c.execute=s,o.pushRegister_({amd:!0,entry:c})}var o=this;t.call(this);var s=/(\/\*([\s\S]*?)\*\/|([^:]|^)\/\/(.*)$)/gm,l='(?:^|[^$_a-zA-Z\\xA0-\\uFFFF.])',u='\\s*\\(\\s*("([^"]+)"|\'([^\']+)\')\\s*\\)',d=/\(([^\)]*)\)/,c=/^\s+|\s+$/g,f={};a.amd={},i('reduceRegister_',function(e){return function(t,n){if(!n||!n.amd)return e.call(this,t,n);var r=t&&t.metadata,a=n.entry;if(r)if(r.format&&'detect'!=r.format){if(!a.name&&'amd'!=r.format)throw new Error('AMD define called while executing '+r.format+' module '+t.name)}else r.format='amd';if(a.name)r&&(r.entry||r.bundle?r.entry&&r.entry.name&&r.entry.name!=t.name&&(r.entry=void 0):r.entry=a,r.bundle=!0),a.name in this.defined||(this.defined[a.name]=a);else{if(!r)throw new TypeError('Unexpected anonymous AMD define.');if(r.entry&&!r.entry.name)throw new Error('Multiple anonymous defines in module '+t.name);r.entry=a}}}),o.amdDefine=a,o.amdRequire=r}}),function(){function e(e,t){if(t){var n;if(e.pluginFirst){if(-1!=(n=t.lastIndexOf('!')))return t.substr(n+1)}else if(-1!=(n=t.indexOf('!')))return t.substr(0,n);return t}}function t(e,t){var n,r,a=t.lastIndexOf('!');return-1!=a?(e.pluginFirst?(n=t.substr(a+1),r=t.substr(0,a)):(n=t.substr(0,a),r=t.substr(a+1)||n.substr(n.lastIndexOf('.')+1)),{argument:n,plugin:r}):void 0}function n(e,t,n,r){return r&&'.js'==t.substr(t.length-3,3)&&(t=t.substr(0,t.length-3)),e.pluginFirst?n+'!'+t:t+'!'+n}function r(e,t){return e.defaultJSExtensions&&'.js'!=t.substr(t.length-3,3)}function a(a){return function(o,i,s){var l=this,u=t(l,o);if(i=e(this,i),!u)return a.call(this,o,i,s);var d=l.normalizeSync(u.argument,i,!0),c=l.normalizeSync(u.plugin,i,!0);return n(l,d,c,r(l,u.argument))}}i('decanonicalize',a),i('normalizeSync',a),i('normalize',function(a){return function(o,i,s){var l=this;i=e(this,i);var u=t(l,o);return u?Promise.all([l.normalize(u.argument,i,!0),l.normalize(u.plugin,i,!1)]).then(function(e){return n(l,e[0],e[1],r(l,u.argument))}):a.call(l,o,i,s)}}),i('locate',function(e){return function(t){var n,r=this,a=t.name;return r.pluginFirst?-1!=(n=a.indexOf('!'))&&(t.metadata.loader=a.substr(0,n),t.name=a.substr(n+1)):-1!=(n=a.lastIndexOf('!'))&&(t.metadata.loader=a.substr(n+1),t.name=a.substr(0,n)),e.call(r,t).then(function(e){return-1==n&&t.metadata.loader?(r.pluginLoader||r).normalize(t.metadata.loader,t.name).then(function(n){return t.metadata.loader=n,e}):e}).then(function(e){var n=t.metadata.loader;if(!n)return e;if(t.name==n)throw new Error('Plugin '+n+' cannot load itself, make sure it is excluded from any wildcard meta configuration via a custom loader: false rule.');if(r.defined&&r.defined[a])return e;var o=r.pluginLoader||r;return o['import'](n).then(function(n){return t.metadata.loaderModule=n,t.address=e,n.locate?n.locate.call(r,t):e})})}}),i('fetch',function(e){return function(t){var n=this;return t.metadata.loaderModule&&t.metadata.loaderModule.fetch&&'defined'!=t.metadata.format?(t.metadata.scriptLoad=!1,t.metadata.loaderModule.fetch.call(n,t,function(t){return e.call(n,t)})):e.call(n,t)}}),i('translate',function(e){return function(t){var n=this,r=arguments;return t.metadata.loaderModule&&t.metadata.loaderModule.translate&&'defined'!=t.metadata.format?Promise.resolve(t.metadata.loaderModule.translate.apply(n,r)).then(function(a){var o=t.metadata.sourceMap;if(o){if('object'!=typeof o)throw new Error('load.metadata.sourceMap must be set to an object.');var i=t.address.split('!')[0];o.file&&o.file!=t.address||(o.file=i+'!transpiled'),(!o.sources||o.sources.length<=1&&(!o.sources[0]||o.sources[0]==t.address))&&(o.sources=[i])}return'string'==typeof a?t.source=a:w.call(this,'Plugin '+t.metadata.loader+' should return the source in translate, instead of setting load.source directly. This support will be deprecated.'),e.apply(n,r)}):e.apply(n,r)}}),i('instantiate',function(e){return function(t){var n=this,r=!1;return t.metadata.loaderModule&&t.metadata.loaderModule.instantiate&&!n.builder&&'defined'!=t.metadata.format?Promise.resolve(t.metadata.loaderModule.instantiate.call(n,t,function(t){if(r)throw new Error('Instantiate must only be called once.');return r=!0,e.call(n,t)})).then(function(a){return r?a:(t.metadata.entry=R(),t.metadata.entry.execute=function(){return a},t.metadata.entry.deps=t.metadata.deps,t.metadata.format='defined',e.call(n,t))}):e.call(n,t)}})}();var oe=['browser','node','dev','build','production','default'],ie=/#\{[^\}]+\}/;i('normalize',function(e){return function(t,n,r){var a=this;return T.call(a,t,n).then(function(t){return e.call(a,t,n,r)}).then(function(e){return L.call(a,e,n)})}}),function(){i('fetch',function(e){return function(t){var n=t.metadata.alias,r=t.metadata.deps||[];if(n){t.metadata.format='defined';var a=R();return this.defined[t.name]=a,a.declarative=!0,a.deps=r.concat([n]),a.declare=function(e){return{setters:[function(t){for(var n in t)e(n,t[n]);t.__useDefault&&(a.module.exports.__useDefault=!0)}],execute:function(){}}},''}return e.call(this,t)}})}(),function(){function e(e,t,n){for(var r,a=t.split('.');a.length>1;)r=a.shift(),e=e[r]=e[r]||{};r=a.shift(),r in e||(e[r]=n)}s(function(e){return function(){this.meta={},e.call(this)}}),i('locate',function(e){return function(t){var n,r=this.meta,a=t.name,o=0;for(var i in r)if(n=i.indexOf('*'),-1!==n&&i.substr(0,n)===a.substr(0,n)&&i.substr(n+1)===a.substr(a.length-i.length+n+1)){var s=i.split('/').length;s>o&&(o=s),v(t.metadata,r[i],o!=s)}return r[a]&&v(t.metadata,r[a]),e.call(this,t)}});var t=/^(\s*\/\*[^\*]*(\*(?!\/)[^\*]*)*\*\/|\s*\/\/[^\n]*|\s*"[^"]+"\s*;?|\s*'[^']+'\s*;?)+/,n=/\/\*[^\*]*(\*(?!\/)[^\*]*)*\*\/|\/\/[^\n]*|"[^"]+"\s*;?|'[^']+'\s*;?/g;i('translate',function(r){return function(a){if('defined'==a.metadata.format)return a.metadata.deps=a.metadata.deps||[],Promise.resolve(a.source);var o=a.source.match(t);if(o)for(var i=o[0].match(n),s=0;s<i.length;s++){var l=i[s],u=l.length,d=l.substr(0,1);if(';'==l.substr(u-1,1)&&u--,'"'==d||'\''==d){var c=l.substr(1,l.length-3),f=c.substr(0,c.indexOf(' '));if(f){var m=c.substr(f.length+1,c.length-f.length-1);'[]'==f.substr(f.length-2,2)?(f=f.substr(0,f.length-2),a.metadata[f]=a.metadata[f]||[],a.metadata[f].push(m)):a.metadata[f]instanceof Array?(w.call(this,'Module '+a.name+' contains deprecated "deps '+m+'" meta syntax.\nThis should be updated to "deps[] '+m+'" for pushing to array meta.'),a.metadata[f].push(m)):e(a.metadata,f,m)}else a.metadata[c]=!0}}return r.apply(this,arguments)}})}(),function(){s(function(e){return function(){e.call(this),this.bundles={},this._loader.loadedBundles={}}}),i('locate',function(e){return function(t){var n=this,r=!1;if(!(t.name in n.defined))for(var a in n.bundles){for(var o=0;o<n.bundles[a].length;o++){var i=n.bundles[a][o];if(i==t.name){r=!0;break}if(-1!=i.indexOf('*')){var s=i.split('*');if(2!=s.length){n.bundles[a].splice(o--,1);continue}if(t.name.substring(0,s[0].length)==s[0]&&t.name.substr(t.name.length-s[1].length,s[1].length)==s[1]&&-1==t.name.substr(s[0].length,t.name.length-s[1].length-s[0].length).indexOf('/')){r=!0;break}}}if(r)return n['import'](a).then(function(){return e.call(n,t)})}return e.call(n,t)}})}(),function(){s(function(e){return function(){e.call(this),this.depCache={}}}),i('locate',function(e){return function(t){var n=this,r=n.depCache[t.name];if(r)for(var a=0;a<r.length;a++)n['import'](r[a],t.name);return e.call(n,t)}})}(),s(function(t){return function(){t.apply(this,arguments),e.define=this.amdDefine}}),i('fetch',function(e){return function(t){return t.metadata.scriptLoad=!0,e.call(this,t)}}),G=new a,e.SystemJS=G,G.version='0.19.35 CSP','object'==typeof module&&module.exports&&'object'==typeof exports&&(module.exports=G),e.System=G}('undefined'!=typeof self?self:global)}var t='undefined'==typeof Promise;if('undefined'!=typeof document){var n=document.getElementsByTagName('script');if($__curScript=n[n.length-1],($__curScript.defer||$__curScript.async)&&($__curScript=document.currentScript),t){var r=$__curScript.src,a=r.substr(0,r.lastIndexOf('/')+1);window.systemJSBootstrap=e,document.write('<script type="text/javascript" src="'+a+'system-polyfills.js"></script>')}else e()}else if('undefined'!=typeof importScripts){var a='';try{throw new Error('_')}catch(o){o.stack.replace(/(?:at|@).*(http.+):[\d]+:[\d]+/,function(e,t){$__curScript={src:t},a=t.replace(/\/[^\/]*$/,'/')})}t&&importScripts(a+'system-polyfills.js'),e()}else $__curScript='undefined'!=typeof __filename?{src:__filename}:null,e()}();System.config({baseURL:'/'});System.config({transpiler:'none',paths:{locale:'common/locale.js',environment:'common/environment.js'},devConfig:{inlineCssSourceMaps:true,cssNano:false,test:{runner:{browser:'test/index.html'},coverage:{outputDir:'coverage',includes:['webmail','calendar','common','components','contacts','onebar','settings','theme','unsupported','upgrade','welcome']}}},packages:{'':{},'node_modules/systemjs-plugin-less':{map:{css:'node_modules/systemjs-plugin-css',lesscss:{node:'@node/less',browser:'node_modules/less/dist/less.min.js'}}},'node_modules/stacktrace-gps':{map:{'source-map':'node_modules/source-map/source-map.js',stackframe:'node_modules/stackframe/stackframe.js'}},'node_modules/error-stack-parser':{map:{stackframe:'node_modules/stackframe/stackframe.js'}}},meta:{'*.ko':{},'*.i18n':{},'*.cjson':{},'*.less':{},'*.css':{}},map:{less:'node_modules/systemjs-plugin-less/less',ActionCancelledError:'3rdparty/action-executor/ActionCancelledError',ErrorTracker:'3rdparty/tracking-analytics/ErrorTracker',Failboat:'3rdparty/Failboat','action-executor':'3rdparty/action-executor/ActionExecutor',hammer:'3rdparty/hammer',hammerjs:'3rdparty/hammer','hammer-jquery':'3rdparty/jquery.hammer',jquery:'node_modules/jquery/dist/jquery','jquery.shinybox':'3rdparty/shinybox/jquery.shinybox',knockout:'node_modules/knockout/build/output/knockout-latest.debug.js',mario:'3rdparty/mario.js',mime:'3rdparty/mime',moment:'3rdparty/moment',mousetrap:'3rdparty/mousetrap','one-validation':'3rdparty/onevalidation/validation',pikaday:'3rdparty/pikaday/pikaday',punycode:'3rdparty/punycode',signals:'3rdparty/signals',sinon:'3rdparty/test/sinon',text:'3rdparty/systemjs-plugin-text.js',tpl:'3rdparty/systemjs-plugin-ko-tpl.js','@one.com/tracking-analytics':'node_modules/@one.com/tracking-analytics',tracking:'node_modules/@one.com/tracking-analytics/lib/tracking',unexpected:'test/unexpected-with-plugins',unicoderegexp:'3rdparty/unicodeRegExp',asset:'node_modules/systemjs-asset-plugin/asset-plugin.js','stacktrace-gps':'node_modules/stacktrace-gps/stacktrace-gps.js','stackframe':'node_modules/stackframe/stackframe.js','error-stack-parser':'node_modules/error-stack-parser/error-stack-parser.js'}});'bundle';(function(){var define=System.amdDefine;define('environment',[],function(){var hostname=location.hostname;if(hostname==='mail.one.com'||/^mail-appspod\d+-\w+\.one\.com$/.test(hostname)){return'mail.one.com'}else if(hostname==='mail-test.one.com'||/mail-appspod-test\d+-\w+\.one\.com$/.test(hostname)){return'mail-test.one.com'}else if(hostname==='mail-next.one.com'||/^mail-appspod-next\d+-\w+\.one\.com$/.test(hostname)){return'mail-next.one.com'}else if(hostname==='mail-staging.one.com'||/^mail-appspod-stg\d+-\w+\.one\.com$/.test(hostname)){return'mail-staging.one.com'}else{return'development'}})}());System.registerDynamic('i18n/lib/tokenizePattern.js',[],true,function($__require,exports,module){var define,global=this||self,GLOBAL=global;module.exports=function tokenizePattern(pattern){if(typeof pattern!=='string'){var valueString=pattern;try{valueString=JSON.stringify(pattern)}catch(e){}throw new Error('i18nTools.tokenizePattern: Value must be a string: '+valueString)}var tokens=[],fragments=pattern.split(/(\{\d+\})/);for(var i=0;i<fragments.length;i+=1){var fragment=fragments[i];if(fragment.length>0){var matchPlaceHolder=fragment.match(/^\{(\d+)\}$/);if(matchPlaceHolder){tokens.push({type:'placeHolder',value:parseInt(matchPlaceHolder[1],10)})}else{tokens.push({type:'text',value:fragment})}}}return tokens};return module.exports});System.registerDynamic('i18n/lib/createI18nTagReplacer.js',['i18n/lib/tokenizePattern.js'],true,function($__require,exports,module){var define,global=this||self,GLOBAL=global;var tokenizePattern=$__require('i18n/lib/tokenizePattern.js');module.exports=function createI18nTagReplacer(options){var TEXT_NODE=3,allKeysForLocale=options.allKeysForLocale,keepI18nAttributes=options.keepI18nAttributes,keepSpans=options.keepSpans;return function i18nTagReplacer(options){var key=options.key,node=options.node,value=allKeysForLocale[key],removeNode=!keepSpans&&options.type!=='i18nTagAttribute'&&key!==null&&node.nodeName.toLowerCase()==='span'&&node.attributes.length===1;if(key!==null){if(/^i18nTag/.test(options.type)&&value===null||typeof value==='undefined'){value=options.defaultValue||'[!'+key+'!]'}if(options.type==='i18nTagAttribute'){node.setAttribute(options.attributeName,value)}else if(options.type==='i18nTagText'){while(node.childNodes.length){node.removeChild(node.firstChild)}tokenizePattern(value).forEach(function(token){var nodeToInsert;if(token.type==='text'){nodeToInsert=node.ownerDocument.createTextNode(token.value)}else{var placeHolder=options.placeHolders[token.value];if(placeHolder){nodeToInsert=placeHolder;if(nodeToInsert.parentNode){nodeToInsert=nodeToInsert.cloneNode(true)}}else{nodeToInsert=node.ownerDocument.createTextNode('[!{'+token.value+'}!]')}}if(removeNode){if(nodeToInsert.nodeType===TEXT_NODE&&node.previousSibling&&node.previousSibling.nodeType===TEXT_NODE){node.previousSibling.nodeValue+=nodeToInsert.nodeValue}else{node.parentNode.insertBefore(nodeToInsert,node)}}else{node.appendChild(nodeToInsert)}})}}if(removeNode){node.parentNode.removeChild(node)}else if(!keepI18nAttributes&&options.type!=='i18nTagAttribute'){node.removeAttribute('data-i18n')}}};return module.exports});System.registerDynamic('i18n/lib/eachI18nTagInHtmlDocument.js',[],true,function($__require,exports,module){var define,global=this||self,GLOBAL=global;module.exports=function eachI18nTagInHtmlDocument(document,lambda,nestedTemplateLambda){var ELEMENT_NODE=1,TEXT_NODE=3,queue=[document],i;while(queue.length){var node=queue.shift(),parentNode=node.parentNode,nodeStillInDocument=true;if(parentNode&&node.nodeType===ELEMENT_NODE){if(node.hasAttribute&&node.hasAttribute('data-i18n')){var i18nStr=node.getAttribute('data-i18n'),i18nObj;if(i18nStr.indexOf(':')!==-1){try{i18nObj=eval('({'+i18nStr+'})')}catch(e){throw new Error('i18nTools.eachI18nTagInHtmlDocument: Error evaluating data-i18n attribute: '+i18nStr+'\n'+e.stack)}}else{i18nObj={text:i18nStr}}if(i18nObj.attr){var attributeNames=Object.keys(i18nObj.attr);for(i=0;i<attributeNames.length;i+=1){var attributeName=attributeNames[i],key=i18nObj.attr[attributeName]||null;if(lambda({type:'i18nTagAttribute',attributeName:attributeName,node:node,key:key,defaultValue:node.getAttribute(attributeName)})===false){return}}}if(typeof i18nObj.text!=='undefined'){var defaultValue='',placeHolders=[],nextPlaceHolderNumber=0;for(i=0;i<node.childNodes.length;i+=1){var childNode=node.childNodes[i];if(childNode.nodeType===TEXT_NODE){defaultValue+=childNode.nodeValue}else{defaultValue+='{'+nextPlaceHolderNumber+'}';nextPlaceHolderNumber+=1;placeHolders.push(childNode)}}defaultValue=defaultValue.replace(/^[ \n\t]+|[ \n\t]+$/g,'');defaultValue=defaultValue.replace(/[ \n\t]+/g,' ');if(lambda({type:'i18nTagText',node:node,key:i18nObj.text||null,defaultValue:defaultValue,placeHolders:placeHolders})===false){return}}else{lambda({node:node})}if(!node.parentNode){nodeStillInDocument=false;queue.unshift(parentNode)}}if(nestedTemplateLambda&&node.nodeName.toLowerCase()==='script'&&node.getAttribute('type')==='text/html'){nestedTemplateLambda(node)}}if(nodeStillInDocument&&node.childNodes){for(i=node.childNodes.length-1;i>=0;i-=1){queue.unshift(node.childNodes[i])}}}};return module.exports});System.registerDynamic('inter/root.js',[],true,function($__require,exports,module){var define,global=this||self,GLOBAL=global;var inter={renderers:{},trQuantity:function(patternByQuantity,number){var pattern=patternByQuantity[this.pluralRule(number)];if(pattern){return this.getPatternRenderer(pattern).call(this,Array.prototype.slice.call(arguments,1))}else{return'[! trQuantity: Missing plural rule for `'+this.pluralRule(number)+'` !]'}},renderList:function(list,type){type=type||'default';var patterns=this.listPatterns[type];switch(list.length){case 0:return'';case 1:return list[0];case 2:if('2'in patterns){return this.renderPattern(list,patterns['2'])}default:var str=this.renderPattern(list.slice(-2),patterns.end||'{0}, {1}');for(var i=list.length-3;i>=0;i-=1){str=this.renderPattern([list[i],str],!i&&patterns.start||patterns.middle||'{0}, {1}')}return str}},tokenizePattern:function(pattern){var tokens=[];pattern.replace(/\{(\d+)\}|([^\{]+)/g,function($0,placeHolderNumber,text){if(text){tokens.push({type:'text',value:text})}else{tokens.push({type:'placeHolder',value:parseInt(placeHolderNumber,10)})}});return tokens},makePatternRenderer:function(pattern){if(pattern){var predefinedCodeFragments=[].slice.call(arguments,1);return new Function('values','return '+this.tokenizePattern(pattern).map(function(token){if(token.type==='placeHolder'){return predefinedCodeFragments[token.value]||'values['+token.value+']'}else{return'"'+token.value.replace(/\"/g,'\\"').replace(/\n/g,'\\n')+'"'}}).join('+')+';')}else{return function(){return'[! makePatternRenderer: No pattern provided !]'}}},makeUnitRenderer:function(unit,unitLength){unitLength=unitLength||'long';var that=this,quantityRenderers={};for(var quantity in that.unitPatterns[unitLength].unit[unit]){if(that.unitPatterns[unitLength].unit[unit].hasOwnProperty(quantity)){quantityRenderers[quantity]=that.makePatternRenderer(that.unitPatterns[unitLength].unit[unit][quantity])}}return function(n){return quantityRenderers[that.pluralRule(n)]([n])}},makeFileSizeRenderer:function(numDecimals,numberSystemId){var numberSymbols=this.numbers[numberSystemId||this.defaultNumberSystemId].symbols;function makeNumberRendererSource(sourceVariableNameOrExpression,numDecimals,suffix){return'('+sourceVariableNameOrExpression+')'+'.toFixed('+(numDecimals||0)+')'+(numberSymbols.decimalPoint==='.'?'':'.replace(\'.\', \''+numberSymbols.decimal.replace(/\'/g,'\\\'')+'\')')+(suffix?'+\''+suffix.replace(/\'/g,'\\\'')+'\'':'')}return new Function('size','if (size < 1000) {'+'return '+makeNumberRendererSource('size',0,' bytes',numberSystemId)+';'+'} else if (size < 1000000) {'+'return '+makeNumberRendererSource('size/1024',numDecimals,' KB',numberSystemId)+';'+'} else if (size < 1000000000) {'+'return '+makeNumberRendererSource('size/1048576',numDecimals,' MB',numberSystemId)+';'+'} else if (size < 1000000000000) {'+'return '+makeNumberRendererSource('size/1073741824',numDecimals,' GB',numberSystemId)+';'+'} else {'+'return '+makeNumberRendererSource('size/1099511627776',numDecimals,' TB',numberSystemId)+';'+'}')},makeNumberRenderer:function(pattern,numberSystemId,currencyCode,numDecimals){pattern=pattern||this.numbers.latn.formats.decimal['default'];var numberSystem=this.numbers[numberSystemId||'latn'],digits=numberSystem.digits;if(typeof digits==='string'){var that=this;return function(number){return that[digits](number)}}var maximumIntegerDigits=40,minimumIntegerDigits=1,maximumFractionDigits=3,minimumFractionDigits=0,minExponentDigits=0,useSignForPositiveExponent=false,positivePrefix='',positiveSuffix='',negativePrefix='-',negativeSuffix='',multiplier=1,groupingSize=3,decimalSeparatorAlwaysShown=false,useExponentialNotation=false,pos=[0];positivePrefix=parseAffix(pattern,pos);var trunkStart=pos[0];parseTrunk(pattern,pos);var trunkLen=pos[0]-trunkStart;positiveSuffix=parseAffix(pattern,pos);if(pos[0]<pattern.length&&pattern.charAt(pos[0])===';'){pos[0]+=1;negativePrefix=parseAffix(pattern,pos);pos[0]+=trunkLen;negativeSuffix=parseAffix(pattern,pos)}else{negativePrefix=positivePrefix+negativePrefix;negativeSuffix+=positiveSuffix}function parseAffix(pattern,pos){var affix='',inQuote=false,len=pattern.length;for(;pos[0]<len;pos[0]+=1){var ch=pattern.charAt(pos[0]);if(ch==='\''){if(pos[0]+1<len&&pattern.charAt(pos[0]+1)==='\''){pos[0]+=1;affix+='\''}else{inQuote=!inQuote}continue}if(inQuote){affix+=ch}else{switch(ch){case'#':case'0':case',':case'.':case';':return affix;case'¤':if(pos[0]+1<len&&pattern.charAt(pos[0]+1)==='¤'){pos[0]+=1;affix+=currencyCode||'¤'}else{affix+=currencyCode||'¤'}break;case'%':if(multiplier!==1){throw Error('Too many percent/permill')}multiplier=100;affix+=numberSystem.symbols.percentSign;break;case'‰':if(multiplier!==1){throw Error('Too many percent/permill')}multiplier=1000;affix+=numberSystem.symbols.perMille;break;default:affix+=ch}}}return affix}function subformatFixed(number,minIntDigits,parts){var power=Math.pow(10,maximumFractionDigits),shiftedNumber=Math.round(number*power),intValue,fracValue;if(isFinite(shiftedNumber)){intValue=Math.floor(shiftedNumber/power);fracValue=Math.floor(shiftedNumber-intValue*power)}else{intValue=number;fracValue=0}var fractionPresent=minimumFractionDigits>0||fracValue>0,intPart='',translatableInt=intValue;while(translatableInt>100000000000000000000){intPart='0'+intPart;translatableInt=Math.round(translatableInt/10)}intPart=translatableInt+intPart;var decimal=numberSystem.symbols.decimal,grouping=numberSystem.symbols.group,zeroCode=digits[0].charCodeAt(0),digitLen=intPart.length,i;if(intValue>0||minIntDigits>0){for(i=digitLen;i<minIntDigits;i+=1){parts.push(String.fromCharCode(zeroCode))}for(i=0;i<digitLen;i+=1){parts.push(String.fromCharCode(zeroCode+intPart.charAt(i)*1));if(digitLen-i>1&&groupingSize>0&&(digitLen-i)%groupingSize===1){parts.push(grouping)}}}else if(!fractionPresent){parts.push(String.fromCharCode(zeroCode))}if(decimalSeparatorAlwaysShown||fractionPresent){parts.push(decimal)}var fracPart=''+(fracValue+power),fracLen=fracPart.length;while(fracPart.charAt(fracLen-1)==='0'&&fracLen>minimumFractionDigits+1){fracLen-=1}for(i=1;i<fracLen;i+=1){parts.push(String.fromCharCode(zeroCode+fracPart.charAt(i)*1))}}function addExponentPart(exponent,parts){parts.push(numberSystem.symbols.exponential);if(exponent<0){exponent=-exponent;parts.push(numberSystem.symbols.minusSign)}else if(useSignForPositiveExponent){parts.push(numberSystem.symbols.plusSign)}var exponentDigits=''+exponent,zeroChar=digits[0];for(var i=exponentDigits.length;i<minExponentDigits;i+=1){parts.push(zeroChar)}parts.push(exponentDigits)}function subformatExponential(number,parts){if(number===0){subformatFixed(number,minimumIntegerDigits,parts);addExponentPart(0,parts);return}var exponent=Math.floor(Math.log(number)/Math.log(10));number/=Math.pow(10,exponent);var minIntDigits=minimumIntegerDigits;if(maximumIntegerDigits>1&&maximumIntegerDigits>minimumIntegerDigits){while(exponent%maximumIntegerDigits!==0){number*=10;exponent-=1}minIntDigits=1}else{if(minimumIntegerDigits<1){exponent+=1;number/=10}else{exponent-=minimumIntegerDigits-1;number*=Math.pow(10,minimumIntegerDigits-1)}}subformatFixed(number,minIntDigits,parts);addExponentPart(exponent,parts)}function parseTrunk(pattern,pos){var decimalPos=-1,digitLeftCount=0,zeroDigitCount=0,digitRightCount=0,groupingCount=-1,len=pattern.length;for(var loop=true;pos[0]<len&&loop;pos[0]+=1){var ch=pattern.charAt(pos[0]);switch(ch){case'#':if(zeroDigitCount>0){digitRightCount+=1}else{digitLeftCount+=1}if(groupingCount>=0&&decimalPos<0){groupingCount+=1}break;case'0':if(digitRightCount>0){throw Error('Unexpected "0" in pattern "'+pattern+'"')}zeroDigitCount+=1;if(groupingCount>=0&&decimalPos<0){groupingCount+=1}break;case',':groupingCount=0;break;case'.':if(decimalPos>=0){throw Error('Multiple decimal separators in pattern "'+pattern+'"')}decimalPos=digitLeftCount+zeroDigitCount+digitRightCount;break;case'E':if(useExponentialNotation){throw Error('Multiple exponential symbols in pattern "'+pattern+'"')}useExponentialNotation=true;minExponentDigits=0;if(pos[0]+1<len&&pattern.charAt(pos[0]+1)==='+'){pos[0]+=1;useSignForPositiveExponent=true}while(pos[0]+1<len&&pattern.charAt(pos[0]+1)==='0'){pos[0]+=1;minExponentDigits+=1}if(digitLeftCount+zeroDigitCount<1||minExponentDigits<1){throw Error('Malformed exponential pattern "'+pattern+'"')}loop=false;break;default:pos[0]-=1;loop=false;break}}if(zeroDigitCount===0&&digitLeftCount>0&&decimalPos>=0){var n=decimalPos;if(n===0){n+=1}digitRightCount=digitLeftCount-n;digitLeftCount=n-1;zeroDigitCount=1}if(decimalPos<0&&digitRightCount>0||decimalPos>=0&&(decimalPos<digitLeftCount||decimalPos>digitLeftCount+zeroDigitCount)||groupingCount===0){throw Error('Malformed pattern "'+pattern+'"')}var totalDigits=digitLeftCount+zeroDigitCount+digitRightCount;if(typeof numDecimals==='number'){minimumFractionDigits=maximumFractionDigits=numDecimals}else{maximumFractionDigits=decimalPos>=0?totalDigits-decimalPos:0;if(decimalPos>=0){minimumFractionDigits=digitLeftCount+zeroDigitCount-decimalPos;if(minimumFractionDigits<0){minimumFractionDigits=0}}}var effectiveDecimalPos=decimalPos>=0?decimalPos:totalDigits;minimumIntegerDigits=effectiveDecimalPos-digitLeftCount;if(useExponentialNotation){maximumIntegerDigits=digitLeftCount+minimumIntegerDigits;if(maximumFractionDigits===0&&minimumIntegerDigits===0){minimumIntegerDigits=1}}groupingSize=Math.max(0,groupingCount);decimalSeparatorAlwaysShown=decimalPos===0||decimalPos===totalDigits}return function format(number){if(isNaN(number)){return numberSystem.symbols.nan}var parts=[],isNegative=number<0||number===0&&1/number<0;parts.push(isNegative?negativePrefix:positivePrefix);if(!isFinite(number)){parts.push(numberSystem.symbols.infinity)}else{number*=isNegative?-1:1;number*=multiplier;if(useExponentialNotation){subformatExponential(number,parts)}else{subformatFixed(number,minimumIntegerDigits,parts)}}parts.push(isNegative?negativeSuffix:positiveSuffix);return parts.join('')}},makePercentageRenderer:function(numDecimals,numberSystemId){numberSystemId=numberSystemId||'latn';var pattern=this.numbers[numberSystemId].formats.percent['default'];return this.makeNumberRenderer(pattern,numberSystemId,undefined,numDecimals)},tokenizeDateFormat:function(format){var tokens=[];format.replace(/([^a-z']+)|'(')|'((?:[^']|'')+)'|(([a-z])\5*)/gi,function($0,unescapedText,escapedSingleQuote,escapedText,fieldToken){if(fieldToken){tokens.push({type:'field',value:fieldToken})}else{if(escapedText){escapedText=escapedText.replace(/''/g,'\'')}tokens.push({type:'text',value:(unescapedText||escapedSingleQuote||escapedText||$0).replace(/"/g,'\\"')})}});return tokens},normalizeDate:function(dateInstance){if(!dateInstance||!dateInstance.getHours){if(dateInstance._time){var icalJsDate=dateInstance;dateInstance={getTimezoneOffset:function(){return-icalJsDate.utcOffset()/60},getTime:function(){return icalJsDate.toUnixTime()*1000},getDay:function(){return icalJsDate.dayOfWeek()-1},getFullYear:function(){return icalJsDate._time.year},getMonth:function(){return icalJsDate._time.month-1},getDate:function(){return icalJsDate._time.day},getHours:function(){return icalJsDate._time.hour},getMinutes:function(){return icalJsDate._time.minute},getSeconds:function(){return icalJsDate._time.second}}}else{dateInstance=new Date(dateInstance)}}return dateInstance},makeDateNormalizerSource:function(variableName){var source=this.normalizeDate.toString();var matchParameterName=source.match(/function[^(]*\((\w+)\)/);var parameterNameRegExp=new RegExp('\\b'+(matchParameterName?matchParameterName[1]:'dateInstance').replace(/[\\\|\.\+\*\{\}\[\]\(\)\?\^\$]/g,'\\$&')+'\\b','g');return source.replace(/^[^\{]+\{|\s*return \w+;?\s*\}$/g,'').replace(parameterNameRegExp,variableName)},getCodeFragmentsByFormatChar:function(){if(!this.codeFragmentsByFormatChar){this.codeFragmentsByFormatChar={G:['{eraNames.abbreviated}[{date}.getFullYear() > 0 ? 1 : 0]'],y:['"0000".slice(String({date}.getFullYear()).length) + {date}.getFullYear()'],Q:['"0" + ({date}.getMonth()/4)','*','{quarterNames.format.abbreviated}[Math.floor({date}.getMonth()/4)]','{quarterNames.format.wide}[Math.floor({date}.getMonth()/4)]'],M:['({date}.getMonth() + 1)','({date}.getMonth() < 9 ? "0" : "") + ({date}.getMonth() + 1)','{monthNames.format.abbreviated}[{date}.getMonth()]','{monthNames.format.wide}[{date}.getMonth()]'],L:['({date}.getMonth() + 1)','({date}.getMonth() < 9 ? "0" : "") + ({date}.getMonth() + 1)','{monthNames.standAlone.abbreviated}[{date}.getMonth()]','{monthNames.standAlone.wide}[{date}.getMonth()]'],d:['{date}.getDate()','({date}.getDate() < 10 ? "0" : "") + {date}.getDate()'],D:['(1 + Math.floor(({date}.getTime() - new Date({date}.getFullYear(), 0, 1).getTime()) / 86400000))'],F:['(1 + Math.floor((date.getDate() - 1) / 7))'],E:['{dayNames.format.abbreviated}[{date}.getDay()]','*','*','{dayNames.format.wide}[{date}.getDay()]'],a:['({date}.getHours() < 12 ? "am" : "pm")'],h:['(({date}.getHours() % 12) ? {date}.getHours() % 12 : 12)'],H:['({date}.getHours() < 10 ? "0" : "") + {date}.getHours()'],m:['({date}.getMinutes() < 10 ? "0" : "") + {date}.getMinutes()'],s:['({date}.getSeconds() < 10 ? "0" : "") + {date}.getSeconds()'],z:[function(){return'({date}.getTimezoneOffset() < 0 ? '+this.makeDateFormatRendererSource('new Date(1970, 0, 1, 0, -{date}.getTimezoneOffset())',this.timeZoneFormats.hour[0])+':'+this.makeDateFormatRendererSource('new Date(1970, 0, 1, 0, {date}.getTimezoneOffset())',this.timeZoneFormats.hour[1])+')'}]}}return this.codeFragmentsByFormatChar},getCodeFragmentForDateField:function(fieldToken,sourceVariableNameOrExpression,calendarId){calendarId=calendarId||'gregorian';var codeFragmentsByFormatChar=this.getCodeFragmentsByFormatChar(),codeFragments=codeFragmentsByFormatChar[fieldToken[0]];if(codeFragments){var codeFragmentNumber=Math.min(fieldToken.length,codeFragments.length)-1;while(codeFragments[codeFragmentNumber]==='*'){codeFragmentNumber-=1}var that=this,codeFragment=codeFragments[codeFragmentNumber];if(typeof codeFragment==='function'){codeFragment=codeFragment.apply(this)}return codeFragment.replace(/\{([^\}]+)\}/g,function($0,varName){if(varName==='date'){return'('+sourceVariableNameOrExpression+')'}else{var fragments=varName.split('.'),obj=that.calendars[calendarId];for(var i=0;i<fragments.length;i+=1){obj=obj[fragments[i]]}return JSON.stringify(obj)}})}},makeDateFormatRendererSource:function(sourceVariableNameOrExpression,format,calendarId){calendarId=calendarId||'gregorian';var expressions=[];this.tokenizeDateFormat(format).forEach(function(token){if(token.type==='text'){expressions.push('"'+token.value.replace(/"/g,'\\"')+'"')}else{var codeFragment=this.getCodeFragmentForDateField(token.value,sourceVariableNameOrExpression,calendarId);if(codeFragment){expressions.push(codeFragment)}}},this);return expressions.join('+')},makeDateRenderer:function(formatId,calendarId){return new Function('d',this.makeDateNormalizerSource('d')+'return '+this.makeDateFormatRendererSource('d',this.getDateFormat(formatId,calendarId),calendarId)+';')},makeDateFormatRenderer:function(format,calendarId){return new Function('d',this.makeDateNormalizerSource('d')+'return '+this.makeDateFormatRendererSource('d',format,calendarId)+';')},getDateFormat:function(formatId,calendarId){calendarId=calendarId||'gregorian';formatId=formatId||'fullDateTime';var icuFormat=this.calendars[calendarId].dateFormats.basic[formatId]||this.calendars[calendarId].dateFormats.cldr[formatId];if(icuFormat){return icuFormat}else{var bestCandidateFormatId=this.getBestICUFormatId(formatId,this.calendars[calendarId].dateFormats.cldr);if(bestCandidateFormatId){return this.calendars[calendarId].dateFormats.cldr[formatId]=this.adaptICUFormat(this.calendars[calendarId].dateFormats.cldr[bestCandidateFormatId],formatId)}else{var matchFormatId=formatId.match(/^y+M+d+$/);if(matchFormatId){return this.calendars[calendarId].dateFormats.cldr[formatId]=this.adaptICUFormat(this.calendars[calendarId].dateFormats.basic.shortDate,formatId)}matchFormatId=formatId.match(/^([yMQEd]+)([Hhms]+)$/);if(matchFormatId){var dateFormat=this.getDateFormat(matchFormatId[1],calendarId),timeFormat=this.getDateFormat(matchFormatId[2],calendarId);return this.renderPattern([timeFormat,dateFormat],'medium')}else{throw new Error('inter.getDateFormat: Cannot find format: '+formatId)}}}},getBestICUFormatId:function(formatId,sourceObject){var bestCandidateFormatId,matcher=new RegExp('^'+formatId.replace(/(([a-zA-Z])\2*)/g,function($0,formatToken,formatChar){return formatChar+'{1,'+formatToken.length+'}'})+'$');for(var candidateFormatId in sourceObject){if(matcher.test(candidateFormatId)){if(!bestCandidateFormatId||candidateFormatId.length>bestCandidateFormatId.length){bestCandidateFormatId=candidateFormatId}}}return bestCandidateFormatId},adaptICUFormat:function(icuFormat,adaptToFormatId){adaptToFormatId.replace(/(([a-zA-Z])\2*)/g,function($0,formatToken,formatChar){if(formatChar==='M'){formatChar='[LM]'}icuFormat=icuFormat.replace(new RegExp(formatChar+'+','g'),function($0){return new Array(formatToken.length+1).join($0.charAt(0))})});return icuFormat},applySpacingToCurrencyString:function(currencyString,currencyFormat,numberSystemId){var beforeCurrency=currencyFormat.currencySpacing.beforeCurrency,afterCurrency=currencyFormat.currencySpacing.afterCurrency;var preRenderedCurrency=this.renderNumber(42,currencyFormat['default'],numberSystemId,'¤');var currencyStartMatched=new RegExp('^'+beforeCurrency.currencyMatch.source).test(currencyString),currencyEndMatched=new RegExp(afterCurrency.currencyMatch.source+'$').test(currencyString);var beforeCurrencySurroundingMatched=new RegExp(beforeCurrency.surroundingMatch.source+'¤').test(preRenderedCurrency),afterCurrencySurroundingMatched=new RegExp('¤'+afterCurrency.surroundingMatch.source).test(preRenderedCurrency);if(currencyStartMatched&&beforeCurrencySurroundingMatched){currencyString=beforeCurrency.insertBetween+currencyString}else if(currencyEndMatched&&afterCurrencySurroundingMatched){currencyString=currencyString+afterCurrency.insertBetween}return currencyString},renderCurrencyLong:function(value,currencyId,numberSystemId,numDecimals){var currency=inter.getCurrency(currencyId);var currencyString=currency?this.trQuantity(currency,value):null;if(!currencyString){currencyString=currencyId}return this.renderCurrency(value,currencyString,numberSystemId,numDecimals)},renderCurrencyShort:function(value,currencyId,numberSystemId,numDecimals){var currency;if(this.currencies){currency=this.getCurrency(currencyId)}var currencyString=currency?currency.symbol:null;if(!currencyString){currencyString=currencyId}return this.renderCurrency(value,currencyString,numberSystemId,numDecimals)},renderCurrency:function(value,currencyString,numberSystemId,numDecimals){numberSystemId=numberSystemId||'latn';numDecimals=typeof numDecimals==='number'?parseInt(numDecimals,10):undefined;currencyString=inter.applySpacingToCurrencyString(currencyString,this.numbers[numberSystemId].formats.currency,numberSystemId);return this.renderNumber(value,this.numbers[numberSystemId].formats.currency['default'],numberSystemId,currencyString,numDecimals)}};['Unit','Number','Percentage','FileSize','Date','DateFormat','DateInterval','Pattern'].forEach(function(rendererType){if('make'+rendererType+'Renderer'in this){this['get'+rendererType+'Renderer']=function(){var rendererId=rendererType+':'+[].join.call(arguments,'/');return this.renderers[rendererId]||(this.renderers[rendererId]=this['make'+rendererType+'Renderer'].apply(this,arguments))};this['render'+rendererType]=function(obj){var makeRendererArgs=[].slice.call(arguments,1);return(this.renderers[rendererType+':'+makeRendererArgs.join('/')]||this['get'+rendererType+'Renderer'].apply(this,makeRendererArgs))(obj)}}},inter);['timeZones','countries','territories','regions','languages','currencies','scripts'].forEach(function(pluralName){var singularName=pluralName.replace(/(ie)?s$/,function($0,ending){return ending?'y':''}),capitalizedSingularName=singularName.replace(/[a-z]/,function($0){return $0.toUpperCase()});this['get'+capitalizedSingularName]=function(id){if(!this.hasOwnProperty(singularName+'byId')){if(!this[pluralName]){throw new Error('inter.get'+capitalizedSingularName+': The library was compiled without --'+pluralName.toLowerCase())}var byId=this[singularName+'byId']={};this[pluralName].forEach(function(obj){byId[obj.id]=obj})}return this[singularName+'byId'][id]}},inter);inter.id='root';inter.delimiters={quotationStart:'“',quotationEnd:'”',alternateQuotationStart:'‘',alternateQuotationEnd:'’'};inter.listPatterns={'default':{'2':'{0}, {1}',start:'{0}, {1}',middle:'{0}, {1}',end:'{0}, {1}'}};inter.unitPatterns={'short':{unit:{accelerationGForce:{other:'{0} G'},accelerationMeterPerSecondSquared:{other:'{0} m/s²'},angleRevolution:{other:'{0} rev'},angleRadian:{other:'{0} rad'},angleDegree:{other:'{0}°'},angleArcMinute:{other:'{0}′'},angleArcSecond:{other:'{0}″'},areaSquareKilometer:{other:'{0} km²'},areaHectare:{other:'{0} ha'},areaSquareMeter:{other:'{0} m²'},areaSquareCentimeter:{other:'{0} cm²'},areaSquareMile:{other:'{0} mi²'},areaAcre:{other:'{0} ac'},areaSquareYard:{other:'{0} yd²'},areaSquareFoot:{other:'{0} ft²'},areaSquareInch:{other:'{0} in²'},concentrKarat:{other:'{0} kt'},concentrMilligramPerDeciliter:{other:'{0} mg/dL'},concentrMillimolePerLiter:{other:'{0} mmol/L'},concentrPartPerMillion:{other:'{0} ppm'},consumptionLiterPerKilometer:{other:'{0} L/km'},'consumptionLiterPer-100kilometers':{other:'{0} L/100km'},consumptionMilePerGallon:{other:'{0} mpg US'},consumptionMilePerGallonImperial:{other:'{0} mpg Imp.'},digitalTerabyte:{other:'{0} TB'},digitalTerabit:{other:'{0} Tb'},digitalGigabyte:{other:'{0} GB'},digitalGigabit:{other:'{0} Gb'},digitalMegabyte:{other:'{0} MB'},digitalMegabit:{other:'{0} Mb'},digitalKilobyte:{other:'{0} kB'},digitalKilobit:{other:'{0} kb'},digitalByte:{other:'{0} byte'},digitalBit:{other:'{0} bit'},durationCentury:{other:'{0} c'},durationYear:{other:'{0} y'},durationMonth:{other:'{0} m'},durationWeek:{other:'{0} w'},durationDay:{other:'{0} d'},durationHour:{other:'{0} h'},durationMinute:{other:'{0} min'},durationSecond:{other:'{0} s'},durationMillisecond:{other:'{0} ms'},durationMicrosecond:{other:'{0} μs'},durationNanosecond:{other:'{0} ns'},electricAmpere:{other:'{0} A'},electricMilliampere:{other:'{0} mA'},electricOhm:{other:'{0} Ω'},electricVolt:{other:'{0} V'},energyKilocalorie:{other:'{0} kcal'},energyCalorie:{other:'{0} cal'},energyFoodcalorie:{other:'{0} Cal'},energyKilojoule:{other:'{0} kJ'},energyJoule:{other:'{0} J'},energyKilowattHour:{other:'{0} kWh'},frequencyGigahertz:{other:'{0} GHz'},frequencyMegahertz:{other:'{0} MHz'},frequencyKilohertz:{other:'{0} kHz'},frequencyHertz:{other:'{0} Hz'},lengthKilometer:{other:'{0} km'},lengthMeter:{other:'{0} m'},lengthDecimeter:{other:'{0} dm'},lengthCentimeter:{other:'{0} cm'},lengthMillimeter:{other:'{0} mm'},lengthMicrometer:{other:'{0} µm'},lengthNanometer:{other:'{0} nm'},lengthPicometer:{other:'{0} pm'},lengthMile:{other:'{0} mi'},lengthYard:{other:'{0} yd'},lengthFoot:{other:'{0} ft'},lengthInch:{other:'{0} in'},lengthParsec:{other:'{0} pc'},lengthLightYear:{other:'{0} ly'},lengthAstronomicalUnit:{other:'{0} au'},lengthFurlong:{other:'{0} fur'},lengthFathom:{other:'{0} fm'},lengthNauticalMile:{other:'{0} nmi'},lengthMileScandinavian:{other:'{0} smi'},lightLux:{other:'{0} lx'},massMetricTon:{other:'{0} t'},massKilogram:{other:'{0} kg'},massGram:{other:'{0} g'},massMilligram:{other:'{0} mg'},massMicrogram:{other:'{0} µg'},massTon:{other:'{0} tn'},massStone:{other:'{0} st'},massPound:{other:'{0} lb'},massOunce:{other:'{0} oz'},massOunceTroy:{other:'{0} oz t'},massCarat:{other:'{0} CD'},powerGigawatt:{other:'{0} GW'},powerMegawatt:{other:'{0} MW'},powerKilowatt:{other:'{0} kW'},powerWatt:{other:'{0} W'},powerMilliwatt:{other:'{0} mW'},powerHorsepower:{other:'{0} hp'},pressureHectopascal:{other:'{0} hPa'},pressureMillimeterOfMercury:{other:'{0} mm Hg'},pressurePoundPerSquareInch:{other:'{0} psi'},pressureInchHg:{other:'{0} inHg'},pressureMillibar:{other:'{0} mbar'},speedKilometerPerHour:{other:'{0} km/h'},speedMeterPerSecond:{other:'{0} m/s'},speedMilePerHour:{other:'{0} mi/h'},speedKnot:{other:'{0} kn'},temperatureGeneric:{other:'{0}°'},temperatureCelsius:{other:'{0}°C'},temperatureFahrenheit:{other:'{0}°F'},temperatureKelvin:{other:'{0} K'},volumeCubicKilometer:{other:'{0} km³'},volumeCubicMeter:{other:'{0} m³'},volumeCubicCentimeter:{other:'{0} cm³'},volumeCubicMile:{other:'{0} mi³'},volumeCubicYard:{other:'{0} yd³'},volumeCubicFoot:{other:'{0} ft³'},volumeCubicInch:{other:'{0} in³'},volumeMegaliter:{other:'{0} ML'},volumeHectoliter:{other:'{0} hL'},volumeLiter:{other:'{0} l'},volumeDeciliter:{other:'{0} dL'},volumeCentiliter:{other:'{0} cL'},volumeMilliliter:{other:'{0} mL'},volumePintMetric:{other:'{0} mpt'},volumeCupMetric:{other:'{0} mc'},volumeAcreFoot:{other:'{0} ac ft'},volumeBushel:{other:'{0} bu'},volumeGallon:{other:'{0} gal US'},volumeGallonImperial:{other:'{0} gal Imp.'},volumeQuart:{other:'{0} qt'},volumePint:{other:'{0} pt'},volumeCup:{other:'{0} c'},volumeFluidOunce:{other:'{0} fl oz'},volumeTablespoon:{other:'{0} tbsp'},volumeTeaspoon:{other:'{0} tsp'}},compoundUnit:{per:'{0}/{1}'}}};inter.timeZoneFormats={hour:['+HH:mm','-HH:mm'],gmt:'GMT{0}',gmtZero:'GMT',region:'{0}',fallback:'{1} ({0})',regions:{daylight:'{0} (+1)',standard:'{0} (+0)'}};inter.characters={exemplar:{'default':[''],auxiliary:[''],punctuation:['\\-',',',';','\\:','!','?','.','(',')','\\[','\\]','\\{','\\}']},ellipsis:{'final':'{0}…',initial:'…{0}',medial:'{0}…{1}','word-final':'{0} …','word-initial':'… {0}','word-medial':'{0} … {1}'},moreInformation:'?'};inter.numbers={latn:{symbols:{decimal:'.',group:',',list:';',percentSign:'%',plusSign:'+',minusSign:'-',exponential:'E',superscriptingExponent:'×',perMille:'‰',infinity:'∞',nan:'NaN',timeSeparator:':'},formats:{scientific:{'default':'#E0'},decimal:{'long':{'1000':{other:'0K'},'10000':{other:'00K'},'100000':{other:'000K'},'1000000':{other:'0M'},'10000000':{other:'00M'},'100000000':{other:'000M'},'1000000000':{other:'0G'},'10000000000':{other:'00G'},'100000000000':{other:'000G'},'1000000000000':{other:'0T'},'10000000000000':{other:'00T'},'100000000000000':{other:'000T'}},'short':{'1000':{other:'0K'},'10000':{other:'00K'},'100000':{other:'000K'},'1000000':{other:'0M'},'10000000':{other:'00M'},'100000000':{other:'000M'},'1000000000':{other:'0G'},'10000000000':{other:'00G'},'100000000000':{other:'000G'},'1000000000000':{other:'0T'},'10000000000000':{other:'00T'},'100000000000000':{other:'000T'}},'default':'#,##0.###'},currency:{'short':{'1000':{other:'¤ 0K'},'10000':{other:'¤ 00K'},'100000':{other:'¤ 000K'},'1000000':{other:'¤ 0M'},'10000000':{other:'¤ 00M'},'100000000':{other:'¤ 000M'},'1000000000':{other:'¤ 0G'},'10000000000':{other:'¤ 00G'},'100000000000':{other:'¤ 000G'},'1000000000000':{other:'¤ 0T'},'10000000000000':{other:'¤ 00T'},'100000000000000':{other:'¤ 000T'}},'default':'¤ #,##0.00',other:'{0} {1}',currencySpacing:{beforeCurrency:{currencyMatch:/[^\u0024+<->\u005E`\u007C~¢-¦¨©¬®-±´¸×÷˂-˅˒-˟˥-˫˭˯-˿͵΄΅϶҂֏؆-؈؋؎؏۞۩۽۾߶৲৳৺৻૱୰௳-௺౿൹฿༁-༃༓༕-༗༚-༟༴༶༸྾-࿅࿇-࿌࿎࿏࿕-࿘႞႟᎐-᎙៛᥀᧞-᧿᭡-᭪᭴-᭼᾽᾿-῁῍-῏῝-῟῭-`´῾⁄⁒⁺-⁼₊-₌₠-₹℀℁℃-℆℈℉℔№-℘℞-℣℥℧℩℮℺℻⅀-⅄⅊-⅍⅏←-⌨⌫-⏳␀-␦⑀-⑊⒜-ⓩ─-⛿✁-❧➔-⟄⟇-⟥⟰-⦂⦙-⧗⧜-⧻⧾-⭌⭐-⭙⳥-⳪⺀-⺙⺛-⻳⼀-⿕⿰-⿻〄〒〓〠〶〷〾〿゛゜㆐㆑㆖-㆟㇀-㇣㈀-㈞㈪-㉇㉐㉠-㉿㊊-㊰㋀-㋾㌀-㏿䷀-䷿꒐-꓆꜀-꜖꜠꜡꞉꞊꠨-꠫꠶-꠹꩷-꩹﬩﮲-﯁﷼﷽﹢﹤-﹦﹩＄＋＜-＞＾｀｜～￠-￦￨-￮￼�]/,surroundingMatch:/[0-9²³¹¼-¾٠-٩۰-۹߀-߉०-९০-৯৴-৹੦-੯૦-૯୦-୯୲-୷௦-௲౦-౯౸-౾೦-೯൦-൵๐-๙໐-໙༠-༳၀-၉႐-႙፩-፼ᛮ-ᛰ០-៩៰-៹᠐-᠙᥆-᥏᧐-᧚᪀-᪉᪐-᪙᭐-᭙᮰-᮹᱀-᱉᱐-᱙⁰⁴-⁹₀-₉⅐-ↂↅ-↉①-⒛⓪-⓿❶-➓⳽〇〡-〩〸-〺㆒-㆕㈠-㈩㉈-㉏㉑-㉟㊀-㊉㊱-㊿꘠-꘩ꛦ-ꛯ꠰-꠵꣐-꣙꤀-꤉꧐-꧙꩐-꩙꯰-꯹０-９]/,insertBetween:' '},afterCurrency:{currencyMatch:/[^\u0024+<->\u005E`\u007C~¢-¦¨©¬®-±´¸×÷˂-˅˒-˟˥-˫˭˯-˿͵΄΅϶҂֏؆-؈؋؎؏۞۩۽۾߶৲৳৺৻૱୰௳-௺౿൹฿༁-༃༓༕-༗༚-༟༴༶༸྾-࿅࿇-࿌࿎࿏࿕-࿘႞႟᎐-᎙៛᥀᧞-᧿᭡-᭪᭴-᭼᾽᾿-῁῍-῏῝-῟῭-`´῾⁄⁒⁺-⁼₊-₌₠-₹℀℁℃-℆℈℉℔№-℘℞-℣℥℧℩℮℺℻⅀-⅄⅊-⅍⅏←-⌨⌫-⏳␀-␦⑀-⑊⒜-ⓩ─-⛿✁-❧➔-⟄⟇-⟥⟰-⦂⦙-⧗⧜-⧻⧾-⭌⭐-⭙⳥-⳪⺀-⺙⺛-⻳⼀-⿕⿰-⿻〄〒〓〠〶〷〾〿゛゜㆐㆑㆖-㆟㇀-㇣㈀-㈞㈪-㉇㉐㉠-㉿㊊-㊰㋀-㋾㌀-㏿䷀-䷿꒐-꓆꜀-꜖꜠꜡꞉꞊꠨-꠫꠶-꠹꩷-꩹﬩﮲-﯁﷼﷽﹢﹤-﹦﹩＄＋＜-＞＾｀｜～￠-￦￨-￮￼�]/,surroundingMatch:/[0-9²³¹¼-¾٠-٩۰-۹߀-߉०-९০-৯৴-৹੦-੯૦-૯୦-୯୲-୷௦-௲౦-౯౸-౾೦-೯൦-൵๐-๙໐-໙༠-༳၀-၉႐-႙፩-፼ᛮ-ᛰ០-៩៰-៹᠐-᠙᥆-᥏᧐-᧚᪀-᪉᪐-᪙᭐-᭙᮰-᮹᱀-᱉᱐-᱙⁰⁴-⁹₀-₉⅐-ↂↅ-↉①-⒛⓪-⓿❶-➓⳽〇〡-〩〸-〺㆒-㆕㈠-㈩㉈-㉏㉑-㉟㊀-㊉㊱-㊿꘠-꘩ꛦ-ꛯ꠰-꠵꣐-꣙꤀-꤉꧐-꧙꩐-꩙꯰-꯹０-９]/,insertBetween:' '}}},percent:{'default':'#,##0%'}},digits:['0','1','2','3','4','5','6','7','8','9']}};inter.defaultNumberSystemId='latn';inter.calendars={gregorian:{dateFormats:{basic:{fullDate:'y MMMM d, EEEE',longDate:'y MMMM d',mediumDate:'y MMM d',shortDate:'y-MM-dd',fullTime:'HH:mm:ss zzzz',longTime:'HH:mm:ss z',mediumTime:'HH:mm:ss',shortTime:'HH:mm',shortDateTime:'y-MM-dd HH:mm',mediumDateTime:'y MMM d HH:mm:ss',longDateTime:'y MMMM d HH:mm:ss z',fullDateTime:'y MMMM d, EEEE HH:mm:ss zzzz'},cldr:{d:'d',E:'ccc',Ed:'d, E',Ehm:'E h:mm a',EHm:'E HH:mm',Ehms:'E h:mm:ss a',EHms:'E HH:mm:ss',Gy:'G y',GyMMM:'G y MMM',GyMMMd:'G y MMM d',GyMMMEd:'G y MMM d, E',h:'h a',H:'HH',hm:'h:mm a',Hm:'HH:mm',hms:'h:mm:ss a',Hms:'HH:mm:ss',hmsv:'h:mm:ss a v',Hmsv:'HH:mm:ss v',hmv:'h:mm a v',Hmv:'HH:mm v',M:'L',Md:'MM-dd',MEd:'MM-dd, E',MMM:'LLL',MMMd:'MMM d',MMMEd:'MMM d, E',MMMMd:'MMMM d',ms:'mm:ss',y:'y',yM:'y-MM',yMd:'y-MM-dd',yMEd:'y-MM-dd, E',yMMM:'y MMM',yMMMd:'y MMM d',yMMMEd:'y MMM d, E',yMMMM:'y MMMM',yQQQ:'y QQQ',yQQQQ:'y QQQQ'}},datePartsOrder:'ymd',dayNames:{format:{abbreviated:['Sun','Mon','Tue','Wed','Thu','Fri','Sat'],narrow:['S','M','T','W','T','F','S'],wide:['Sun','Mon','Tue','Wed','Thu','Fri','Sat'],'short':['Sun','Mon','Tue','Wed','Thu','Fri','Sat']},standAlone:{abbreviated:['Sun','Mon','Tue','Wed','Thu','Fri','Sat'],narrow:['S','M','T','W','T','F','S'],wide:['Sun','Mon','Tue','Wed','Thu','Fri','Sat'],'short':['Sun','Mon','Tue','Wed','Thu','Fri','Sat']}},dayPeriods:{format:{abbreviated:{am:'AM',pm:'PM'},narrow:{am:'AM',pm:'PM'},wide:{am:'AM',pm:'PM'}},standAlone:{abbreviated:{am:'AM',pm:'PM'},narrow:{am:'AM',pm:'PM'},wide:{am:'AM',pm:'PM'}}},monthNames:{format:{abbreviated:['M01','M02','M03','M04','M05','M06','M07','M08','M09','M10','M11','M12'],narrow:['1','2','3','4','5','6','7','8','9','10','11','12'],wide:['M01','M02','M03','M04','M05','M06','M07','M08','M09','M10','M11','M12']},standAlone:{abbreviated:['M01','M02','M03','M04','M05','M06','M07','M08','M09','M10','M11','M12'],narrow:['1','2','3','4','5','6','7','8','9','10','11','12'],wide:['M01','M02','M03','M04','M05','M06','M07','M08','M09','M10','M11','M12']}},eraNames:{wide:['BCE','CE'],abbreviated:['BCE','CE']},quarterNames:{format:{abbreviated:['Q1','Q2','Q3','Q4'],narrow:['1','2','3','4'],wide:['Q1','Q2','Q3','Q4']},standAlone:{abbreviated:['Q1','Q2','Q3','Q4'],narrow:['1','2','3','4'],wide:['Q1','Q2','Q3','Q4']}}}};inter.pluralRule=function(n){return'other'};inter.timeZones=[{id:'Pacific/Midway',utcStandardOffsetSeconds:-39600,displayName:'Midway',countryId:'UM'},{id:'Pacific/Niue',regionId:'061',utcStandardOffsetSeconds:-39600,displayName:'Niue',countryId:'NU'},{id:'Pacific/Pago_Pago',regionId:'061',utcStandardOffsetSeconds:-39600,displayName:'Pago Pago',countryId:'AS'},{id:'America/Adak',regionId:'021',utcStandardOffsetSeconds:-36000,displayName:'Adak',countryId:'US'},{id:'Pacific/Honolulu',regionId:'021',utcStandardOffsetSeconds:-36000,displayName:'Honolulu',countryId:'US'},{id:'Pacific/Rarotonga',regionId:'061',utcStandardOffsetSeconds:-36000,displayName:'Rarotonga',countryId:'CK'},{id:'Pacific/Tahiti',regionId:'061',utcStandardOffsetSeconds:-36000,displayName:'Tahiti',countryId:'PF'},{id:'Pacific/Marquesas',regionId:'061',utcStandardOffsetSeconds:-34200,displayName:'Marquesas',countryId:'PF'},{id:'America/Anchorage',regionId:'021',utcStandardOffsetSeconds:-32400,displayName:'Anchorage',countryId:'US'},{id:'Pacific/Gambier',regionId:'061',utcStandardOffsetSeconds:-32400,displayName:'Gambier',countryId:'PF'},{id:'America/Juneau',regionId:'021',utcStandardOffsetSeconds:-32400,displayName:'Juneau',countryId:'US'},{id:'America/Metlakatla',regionId:'021',utcStandardOffsetSeconds:-32400,displayName:'Metlakatla',countryId:'US'},{id:'America/Nome',regionId:'021',utcStandardOffsetSeconds:-32400,displayName:'Nome',countryId:'US'},{id:'America/Sitka',regionId:'021',utcStandardOffsetSeconds:-32400,displayName:'Sitka',countryId:'US'},{id:'America/Yakutat',regionId:'021',utcStandardOffsetSeconds:-32400,displayName:'Yakutat',countryId:'US'},{id:'America/Dawson',regionId:'021',utcStandardOffsetSeconds:-28800,displayName:'Dawson',countryId:'CA'},{id:'America/Los_Angeles',regionId:'021',utcStandardOffsetSeconds:-28800,displayName:'Los Angeles',countryId:'US'},{id:'Pacific/Pitcairn',regionId:'061',utcStandardOffsetSeconds:-28800,displayName:'Pitcairn',countryId:'PN'},{id:'America/Tijuana',regionId:'013',utcStandardOffsetSeconds:-28800,displayName:'Tijuana',countryId:'MX'},{id:'America/Vancouver',regionId:'021',utcStandardOffsetSeconds:-28800,displayName:'Vancouver',countryId:'CA'},{id:'America/Whitehorse',regionId:'021',utcStandardOffsetSeconds:-28800,displayName:'Whitehorse',countryId:'CA'},{id:'America/Boise',regionId:'021',utcStandardOffsetSeconds:-25200,displayName:'Boise',countryId:'US'},{id:'America/Cambridge_Bay',regionId:'021',utcStandardOffsetSeconds:-25200,displayName:'Cambridge Bay',countryId:'CA'},{id:'America/Chihuahua',regionId:'013',utcStandardOffsetSeconds:-25200,displayName:'Chihuahua',countryId:'MX'},{id:'America/Creston',regionId:'021',utcStandardOffsetSeconds:-25200,displayName:'Creston',countryId:'CA'},{id:'America/Dawson_Creek',regionId:'021',utcStandardOffsetSeconds:-25200,displayName:'Dawson Creek',countryId:'CA'},{id:'America/Denver',regionId:'021',utcStandardOffsetSeconds:-25200,displayName:'Denver',countryId:'US'},{id:'America/Edmonton',regionId:'021',utcStandardOffsetSeconds:-25200,displayName:'Edmonton',countryId:'CA'},{id:'America/Fort_Nelson',regionId:'021',utcStandardOffsetSeconds:-25200,displayName:'Fort Nelson',countryId:'CA'},{id:'America/Hermosillo',regionId:'013',utcStandardOffsetSeconds:-25200,displayName:'Hermosillo',countryId:'MX'},{id:'America/Inuvik',regionId:'021',utcStandardOffsetSeconds:-25200,displayName:'Inuvik',countryId:'CA'},{id:'America/Mazatlan',regionId:'013',utcStandardOffsetSeconds:-25200,displayName:'Mazatlan',countryId:'MX'},{id:'America/Ojinaga',regionId:'013',utcStandardOffsetSeconds:-25200,displayName:'Ojinaga',countryId:'MX'},{id:'America/Phoenix',regionId:'021',utcStandardOffsetSeconds:-25200,displayName:'Phoenix',countryId:'US'},{id:'America/Yellowknife',regionId:'021',utcStandardOffsetSeconds:-25200,displayName:'Yellowknife',countryId:'CA'},{id:'America/Bahia_Banderas',regionId:'013',utcStandardOffsetSeconds:-21600,displayName:'Bahia Banderas',countryId:'MX'},{id:'America/Belize',regionId:'013',utcStandardOffsetSeconds:-21600,displayName:'Belize',countryId:'BZ'},{id:'America/North_Dakota/Beulah',regionId:'021',utcStandardOffsetSeconds:-21600,displayName:'Beulah, North Dakota',countryId:'US'},{id:'America/North_Dakota/Center',regionId:'021',utcStandardOffsetSeconds:-21600,displayName:'Center, North Dakota',countryId:'US'},{id:'America/Chicago',regionId:'021',utcStandardOffsetSeconds:-21600,displayName:'Chicago',countryId:'US'},{id:'America/Costa_Rica',regionId:'013',utcStandardOffsetSeconds:-21600,displayName:'Costa Rica',countryId:'CR'},{id:'Pacific/Easter',regionId:'005',utcStandardOffsetSeconds:-21600,displayName:'Easter',countryId:'CL'},{id:'America/El_Salvador',regionId:'013',utcStandardOffsetSeconds:-21600,displayName:'El Salvador',countryId:'SV'},{id:'Pacific/Galapagos',regionId:'005',utcStandardOffsetSeconds:-21600,displayName:'Galapagos',countryId:'EC'},{id:'America/Guatemala',regionId:'013',utcStandardOffsetSeconds:-21600,displayName:'Guatemala',countryId:'GT'},{id:'America/Indiana/Knox',regionId:'021',utcStandardOffsetSeconds:-21600,displayName:'Knox, Indiana',countryId:'US'},{id:'America/Managua',regionId:'013',utcStandardOffsetSeconds:-21600,displayName:'Managua',countryId:'NI'},{id:'America/Matamoros',regionId:'013',utcStandardOffsetSeconds:-21600,displayName:'Matamoros',countryId:'MX'},{id:'America/Menominee',regionId:'021',utcStandardOffsetSeconds:-21600,displayName:'Menominee',countryId:'US'},{id:'America/Merida',regionId:'013',utcStandardOffsetSeconds:-21600,displayName:'Merida',countryId:'MX'},{id:'America/Mexico_City',regionId:'013',utcStandardOffsetSeconds:-21600,displayName:'Mexico City',countryId:'MX'},{id:'America/Monterrey',regionId:'013',utcStandardOffsetSeconds:-21600,displayName:'Monterrey',countryId:'MX'},{id:'America/North_Dakota/New_Salem',regionId:'021',utcStandardOffsetSeconds:-21600,displayName:'New Salem, North Dakota',countryId:'US'},{id:'America/Rainy_River',regionId:'021',utcStandardOffsetSeconds:-21600,displayName:'Rainy River',countryId:'CA'},{id:'America/Rankin_Inlet',regionId:'021',utcStandardOffsetSeconds:-21600,displayName:'Rankin Inlet',countryId:'CA'},{id:'America/Regina',regionId:'021',utcStandardOffsetSeconds:-21600,displayName:'Regina',countryId:'CA'},{id:'America/Resolute',regionId:'021',utcStandardOffsetSeconds:-21600,displayName:'Resolute',countryId:'CA'},{id:'America/Swift_Current',regionId:'021',utcStandardOffsetSeconds:-21600,displayName:'Swift Current',countryId:'CA'},{id:'America/Tegucigalpa',regionId:'013',utcStandardOffsetSeconds:-21600,displayName:'Tegucigalpa',countryId:'HN'},{id:'America/Indiana/Tell_City',regionId:'021',utcStandardOffsetSeconds:-21600,displayName:'Tell City, Indiana',countryId:'US'},{id:'America/Winnipeg',regionId:'021',utcStandardOffsetSeconds:-21600,displayName:'Winnipeg',countryId:'CA'},{id:'America/Atikokan',regionId:'021',utcStandardOffsetSeconds:-18000,displayName:'Atikokan',countryId:'CA'},{id:'America/Bogota',regionId:'005',utcStandardOffsetSeconds:-18000,displayName:'Bogota',countryId:'CO'},{id:'America/Cancun',regionId:'013',utcStandardOffsetSeconds:-18000,displayName:'Cancun',countryId:'MX'},{id:'America/Cayman',regionId:'029',utcStandardOffsetSeconds:-18000,displayName:'Cayman',countryId:'KY'},{id:'America/Detroit',regionId:'021',utcStandardOffsetSeconds:-18000,displayName:'Detroit',countryId:'US'},{id:'America/Eirunepe',regionId:'005',utcStandardOffsetSeconds:-18000,displayName:'Eirunepe',countryId:'BR'},{id:'America/Grand_Turk',regionId:'029',utcStandardOffsetSeconds:-18000,displayName:'Grand Turk',countryId:'TC'},{id:'America/Guayaquil',regionId:'005',utcStandardOffsetSeconds:-18000,displayName:'Guayaquil',countryId:'EC'},{id:'America/Havana',regionId:'029',utcStandardOffsetSeconds:-18000,displayName:'Havana',countryId:'CU'},{id:'America/Indiana/Indianapolis',regionId:'021',utcStandardOffsetSeconds:-18000,displayName:'Indianapolis',countryId:'US'},{id:'America/Iqaluit',regionId:'021',utcStandardOffsetSeconds:-18000,displayName:'Iqaluit',countryId:'CA'},{id:'America/Jamaica',regionId:'029',utcStandardOffsetSeconds:-18000,displayName:'Jamaica',countryId:'JM'},{id:'America/Lima',regionId:'005',utcStandardOffsetSeconds:-18000,displayName:'Lima',countryId:'PE'},{id:'America/Kentucky/Louisville',regionId:'021',utcStandardOffsetSeconds:-18000,displayName:'Louisville',countryId:'US'},{id:'America/Indiana/Marengo',regionId:'021',utcStandardOffsetSeconds:-18000,displayName:'Marengo, Indiana',countryId:'US'},{id:'America/Kentucky/Monticello',regionId:'021',utcStandardOffsetSeconds:-18000,displayName:'Monticello, Kentucky',countryId:'US'},{id:'America/Nassau',regionId:'029',utcStandardOffsetSeconds:-18000,displayName:'Nassau',countryId:'BS'},{id:'America/New_York',regionId:'021',utcStandardOffsetSeconds:-18000,displayName:'New York',countryId:'US'},{id:'America/Nipigon',regionId:'021',utcStandardOffsetSeconds:-18000,displayName:'Nipigon',countryId:'CA'},{id:'America/Panama',regionId:'013',utcStandardOffsetSeconds:-18000,displayName:'Panama',countryId:'PA'},{id:'America/Pangnirtung',regionId:'021',utcStandardOffsetSeconds:-18000,displayName:'Pangnirtung',countryId:'CA'},{id:'America/Indiana/Petersburg',regionId:'021',utcStandardOffsetSeconds:-18000,displayName:'Petersburg, Indiana',countryId:'US'},{id:'America/Port-au-Prince',regionId:'029',utcStandardOffsetSeconds:-18000,displayName:'Port-au-Prince',countryId:'HT'},{id:'America/Rio_Branco',regionId:'005',utcStandardOffsetSeconds:-18000,displayName:'Rio Branco',countryId:'BR'},{id:'America/Thunder_Bay',regionId:'021',utcStandardOffsetSeconds:-18000,displayName:'Thunder Bay',countryId:'CA'},{id:'America/Toronto',regionId:'021',utcStandardOffsetSeconds:-18000,displayName:'Toronto',countryId:'CA'},{id:'America/Indiana/Vevay',regionId:'021',utcStandardOffsetSeconds:-18000,displayName:'Vevay, Indiana',countryId:'US'},{id:'America/Indiana/Vincennes',regionId:'021',utcStandardOffsetSeconds:-18000,displayName:'Vincennes, Indiana',countryId:'US'},{id:'America/Indiana/Winamac',regionId:'021',utcStandardOffsetSeconds:-18000,displayName:'Winamac, Indiana',countryId:'US'},{id:'America/Anguilla',regionId:'029',utcStandardOffsetSeconds:-14400,displayName:'Anguilla',countryId:'AI'},{id:'America/Antigua',regionId:'029',utcStandardOffsetSeconds:-14400,displayName:'Antigua',countryId:'AG'},{id:'America/Aruba',regionId:'029',utcStandardOffsetSeconds:-14400,displayName:'Aruba',countryId:'AW'},{id:'America/Asuncion',regionId:'005',utcStandardOffsetSeconds:-14400,displayName:'Asuncion',countryId:'PY'},{id:'America/Barbados',regionId:'029',utcStandardOffsetSeconds:-14400,displayName:'Barbados',countryId:'BB'},{id:'Atlantic/Bermuda',regionId:'021',utcStandardOffsetSeconds:-14400,displayName:'Bermuda',countryId:'BM'},{id:'America/Blanc-Sablon',regionId:'021',utcStandardOffsetSeconds:-14400,displayName:'Blanc-Sablon',countryId:'CA'},{id:'America/Boa_Vista',regionId:'005',utcStandardOffsetSeconds:-14400,displayName:'Boa Vista',countryId:'BR'},{id:'America/Campo_Grande',regionId:'005',utcStandardOffsetSeconds:-14400,displayName:'Campo Grande',countryId:'BR'},{id:'America/Caracas',regionId:'005',utcStandardOffsetSeconds:-14400,displayName:'Caracas',countryId:'VE'},{id:'America/Cuiaba',regionId:'005',utcStandardOffsetSeconds:-14400,displayName:'Cuiaba',countryId:'BR'},{id:'America/Curacao',regionId:'029',utcStandardOffsetSeconds:-14400,displayName:'Curacao',countryId:'CW'},{id:'America/Dominica',regionId:'029',utcStandardOffsetSeconds:-14400,displayName:'Dominica',countryId:'DM'},{id:'America/Glace_Bay',regionId:'021',utcStandardOffsetSeconds:-14400,displayName:'Glace Bay',countryId:'CA'},{id:'America/Goose_Bay',regionId:'021',utcStandardOffsetSeconds:-14400,displayName:'Goose Bay',countryId:'CA'},{id:'America/Grenada',regionId:'029',utcStandardOffsetSeconds:-14400,displayName:'Grenada',countryId:'GD'},{id:'America/Guadeloupe',regionId:'029',utcStandardOffsetSeconds:-14400,displayName:'Guadeloupe',countryId:'GP'},{id:'America/Guyana',regionId:'005',utcStandardOffsetSeconds:-14400,displayName:'Guyana',countryId:'GY'},{id:'America/Halifax',regionId:'021',utcStandardOffsetSeconds:-14400,displayName:'Halifax',countryId:'CA'},{id:'America/Kralendijk',regionId:'029',utcStandardOffsetSeconds:-14400,displayName:'Kralendijk',countryId:'BQ'},{id:'America/La_Paz',regionId:'005',utcStandardOffsetSeconds:-14400,displayName:'La Paz',countryId:'BO'},{id:'America/Lower_Princes',regionId:'029',utcStandardOffsetSeconds:-14400,displayName:'Lower Prince’s Quarter',countryId:'SX'},{id:'America/Manaus',regionId:'005',utcStandardOffsetSeconds:-14400,displayName:'Manaus',countryId:'BR'},{id:'America/Marigot',regionId:'029',utcStandardOffsetSeconds:-14400,displayName:'Marigot',countryId:'MF'},{id:'America/Martinique',regionId:'029',utcStandardOffsetSeconds:-14400,displayName:'Martinique',countryId:'MQ'},{id:'America/Moncton',regionId:'021',utcStandardOffsetSeconds:-14400,displayName:'Moncton',countryId:'CA'},{id:'America/Montserrat',regionId:'029',utcStandardOffsetSeconds:-14400,displayName:'Montserrat',countryId:'MS'},{id:'America/Port_of_Spain',regionId:'029',utcStandardOffsetSeconds:-14400,displayName:'Port of Spain',countryId:'TT'},{id:'America/Porto_Velho',regionId:'005',utcStandardOffsetSeconds:-14400,displayName:'Porto Velho',countryId:'BR'},{id:'America/Puerto_Rico',regionId:'029',utcStandardOffsetSeconds:-14400,displayName:'Puerto Rico',countryId:'PR'},{id:'America/Santiago',regionId:'005',utcStandardOffsetSeconds:-14400,displayName:'Santiago',countryId:'CL'},{id:'America/Santo_Domingo',regionId:'029',utcStandardOffsetSeconds:-14400,displayName:'Santo Domingo',countryId:'DO'},{id:'America/St_Barthelemy',regionId:'029',utcStandardOffsetSeconds:-14400,displayName:'St. Barthelemy',countryId:'BL'},{id:'America/St_Kitts',regionId:'029',utcStandardOffsetSeconds:-14400,displayName:'St. Kitts',countryId:'KN'},{id:'America/St_Lucia',regionId:'029',utcStandardOffsetSeconds:-14400,displayName:'St. Lucia',countryId:'LC'},{id:'America/St_Thomas',regionId:'029',utcStandardOffsetSeconds:-14400,displayName:'St. Thomas',countryId:'VI'},{id:'America/St_Vincent',regionId:'029',utcStandardOffsetSeconds:-14400,displayName:'St. Vincent',countryId:'VC'},{id:'America/Thule',regionId:'021',utcStandardOffsetSeconds:-14400,displayName:'Thule',countryId:'GL'},{id:'America/Tortola',regionId:'029',utcStandardOffsetSeconds:-14400,displayName:'Tortola',countryId:'VG'},{id:'America/St_Johns',regionId:'021',utcStandardOffsetSeconds:-12600,displayName:'St. John’s',countryId:'CA'},{id:'America/Araguaina',regionId:'005',utcStandardOffsetSeconds:-10800,displayName:'Araguaina',countryId:'BR'},{id:'America/Bahia',regionId:'005',utcStandardOffsetSeconds:-10800,displayName:'Bahia',countryId:'BR'},{id:'America/Belem',regionId:'005',utcStandardOffsetSeconds:-10800,displayName:'Belem',countryId:'BR'},{id:'America/Argentina/Buenos_Aires',regionId:'005',utcStandardOffsetSeconds:-10800,displayName:'Buenos Aires',countryId:'AR'},{id:'America/Argentina/Catamarca',regionId:'005',utcStandardOffsetSeconds:-10800,displayName:'Catamarca',countryId:'AR'},{id:'America/Cayenne',regionId:'005',utcStandardOffsetSeconds:-10800,displayName:'Cayenne',countryId:'GF'},{id:'America/Argentina/Cordoba',regionId:'005',utcStandardOffsetSeconds:-10800,displayName:'Cordoba',countryId:'AR'},{id:'America/Fortaleza',regionId:'005',utcStandardOffsetSeconds:-10800,displayName:'Fortaleza',countryId:'BR'},{id:'America/Argentina/Jujuy',regionId:'005',utcStandardOffsetSeconds:-10800,displayName:'Jujuy',countryId:'AR'},{id:'America/Argentina/La_Rioja',regionId:'005',utcStandardOffsetSeconds:-10800,displayName:'La Rioja',countryId:'AR'},{id:'America/Maceio',regionId:'005',utcStandardOffsetSeconds:-10800,displayName:'Maceio',countryId:'BR'},{id:'America/Argentina/Mendoza',regionId:'005',utcStandardOffsetSeconds:-10800,displayName:'Mendoza',countryId:'AR'},{id:'America/Miquelon',regionId:'021',utcStandardOffsetSeconds:-10800,displayName:'Miquelon',countryId:'PM'},{id:'America/Montevideo',regionId:'005',utcStandardOffsetSeconds:-10800,displayName:'Montevideo',countryId:'UY'},{id:'America/Godthab',regionId:'021',utcStandardOffsetSeconds:-10800,displayName:'Nuuk',countryId:'GL'},{id:'Antarctica/Palmer',utcStandardOffsetSeconds:-10800,displayName:'Palmer',countryId:'AQ'},{id:'America/Paramaribo',regionId:'005',utcStandardOffsetSeconds:-10800,displayName:'Paramaribo',countryId:'SR'},{id:'America/Punta_Arenas',regionId:'005',utcStandardOffsetSeconds:-10800,displayName:'Punta Arenas',countryId:'CL'},{id:'America/Recife',regionId:'005',utcStandardOffsetSeconds:-10800,displayName:'Recife',countryId:'BR'},{id:'America/Argentina/Rio_Gallegos',regionId:'005',utcStandardOffsetSeconds:-10800,displayName:'Rio Gallegos',countryId:'AR'},{id:'Antarctica/Rothera',utcStandardOffsetSeconds:-10800,displayName:'Rothera',countryId:'AQ'},{id:'America/Argentina/Salta',regionId:'005',utcStandardOffsetSeconds:-10800,displayName:'Salta',countryId:'AR'},{id:'America/Argentina/San_Juan',regionId:'005',utcStandardOffsetSeconds:-10800,displayName:'San Juan',countryId:'AR'},{id:'America/Argentina/San_Luis',regionId:'005',utcStandardOffsetSeconds:-10800,displayName:'San Luis',countryId:'AR'},{id:'America/Santarem',regionId:'005',utcStandardOffsetSeconds:-10800,displayName:'Santarem',countryId:'BR'},{id:'America/Sao_Paulo',regionId:'005',utcStandardOffsetSeconds:-10800,displayName:'Sao Paulo',countryId:'BR'},{id:'Atlantic/Stanley',regionId:'005',utcStandardOffsetSeconds:-10800,displayName:'Stanley',countryId:'FK'},{id:'America/Argentina/Tucuman',regionId:'005',utcStandardOffsetSeconds:-10800,displayName:'Tucuman',countryId:'AR'},{id:'America/Argentina/Ushuaia',regionId:'005',utcStandardOffsetSeconds:-10800,displayName:'Ushuaia',countryId:'AR'},{id:'America/Noronha',regionId:'005',utcStandardOffsetSeconds:-7200,displayName:'Noronha',countryId:'BR'},{id:'Atlantic/South_Georgia',utcStandardOffsetSeconds:-7200,displayName:'South Georgia',countryId:'GS'},{id:'Atlantic/Azores',regionId:'039',utcStandardOffsetSeconds:-3600,displayName:'Azores',countryId:'PT'},{id:'Atlantic/Cape_Verde',regionId:'011',utcStandardOffsetSeconds:-3600,displayName:'Cape Verde',countryId:'CV'},{id:'America/Scoresbysund',regionId:'021',utcStandardOffsetSeconds:-3600,displayName:'Ittoqqortoormiit',countryId:'GL'},{id:'Africa/Abidjan',regionId:'011',utcStandardOffsetSeconds:0,displayName:'Abidjan',countryId:'CI'},{id:'Africa/Accra',regionId:'011',utcStandardOffsetSeconds:0,displayName:'Accra',countryId:'GH'},{id:'Africa/Bamako',regionId:'011',utcStandardOffsetSeconds:0,displayName:'Bamako',countryId:'ML'},{id:'Africa/Banjul',regionId:'011',utcStandardOffsetSeconds:0,displayName:'Banjul',countryId:'GM'},{id:'Africa/Bissau',regionId:'011',utcStandardOffsetSeconds:0,displayName:'Bissau',countryId:'GW'},{id:'Atlantic/Canary',regionId:'039',utcStandardOffsetSeconds:0,displayName:'Canary',countryId:'ES'},{id:'Africa/Casablanca',regionId:'015',utcStandardOffsetSeconds:0,displayName:'Casablanca',countryId:'MA'},{id:'Africa/Conakry',regionId:'011',utcStandardOffsetSeconds:0,displayName:'Conakry',countryId:'GN'},{id:'Africa/Dakar',regionId:'011',utcStandardOffsetSeconds:0,displayName:'Dakar',countryId:'SN'},{id:'America/Danmarkshavn',regionId:'021',utcStandardOffsetSeconds:0,displayName:'Danmarkshavn',countryId:'GL'},{id:'Europe/Dublin',regionId:'154',utcStandardOffsetSeconds:0,displayName:'Dublin',countryId:'IE'},{id:'Africa/El_Aaiun',regionId:'015',utcStandardOffsetSeconds:0,displayName:'El Aaiun',countryId:'EH'},{id:'Atlantic/Faroe',regionId:'154',utcStandardOffsetSeconds:0,displayName:'Faroe',countryId:'FO'},{id:'Africa/Freetown',regionId:'011',utcStandardOffsetSeconds:0,displayName:'Freetown',countryId:'SL'},{id:'Europe/Guernsey',regionId:'154',utcStandardOffsetSeconds:0,displayName:'Guernsey',countryId:'GG'},{id:'Europe/Isle_of_Man',regionId:'154',utcStandardOffsetSeconds:0,displayName:'Isle of Man',countryId:'IM'},{id:'Europe/Jersey',regionId:'154',utcStandardOffsetSeconds:0,displayName:'Jersey',countryId:'JE'},{id:'Europe/Lisbon',regionId:'039',utcStandardOffsetSeconds:0,displayName:'Lisbon',countryId:'PT'},{id:'Africa/Lome',regionId:'011',utcStandardOffsetSeconds:0,displayName:'Lome',countryId:'TG'},{id:'Europe/London',regionId:'154',utcStandardOffsetSeconds:0,displayName:'London',countryId:'GB'},{id:'Atlantic/Madeira',regionId:'039',utcStandardOffsetSeconds:0,displayName:'Madeira',countryId:'PT'},{id:'Africa/Monrovia',regionId:'011',utcStandardOffsetSeconds:0,displayName:'Monrovia',countryId:'LR'},{id:'Africa/Nouakchott',regionId:'011',utcStandardOffsetSeconds:0,displayName:'Nouakchott',countryId:'MR'},{id:'Africa/Ouagadougou',regionId:'011',utcStandardOffsetSeconds:0,displayName:'Ouagadougou',countryId:'BF'},{id:'Atlantic/Reykjavik',regionId:'154',utcStandardOffsetSeconds:0,displayName:'Reykjavik',countryId:'IS'},{id:'Africa/Sao_Tome',regionId:'017',utcStandardOffsetSeconds:0,displayName:'Sao Tome',countryId:'ST'},{id:'Atlantic/St_Helena',regionId:'011',utcStandardOffsetSeconds:0,displayName:'St. Helena',countryId:'SH'},{id:'Antarctica/Troll',utcStandardOffsetSeconds:0,displayName:'Troll',countryId:'AQ'},{id:'Africa/Algiers',regionId:'015',utcStandardOffsetSeconds:3600,displayName:'Algiers',countryId:'DZ'},{id:'Europe/Amsterdam',regionId:'155',utcStandardOffsetSeconds:3600,displayName:'Amsterdam',countryId:'NL'},{id:'Europe/Andorra',regionId:'039',utcStandardOffsetSeconds:3600,displayName:'Andorra',countryId:'AD'},{id:'Africa/Bangui',regionId:'017',utcStandardOffsetSeconds:3600,displayName:'Bangui',countryId:'CF'},{id:'Europe/Belgrade',regionId:'039',utcStandardOffsetSeconds:3600,displayName:'Belgrade',countryId:'RS'},{id:'Europe/Berlin',regionId:'155',utcStandardOffsetSeconds:3600,displayName:'Berlin',countryId:'DE'},{id:'Europe/Bratislava',regionId:'151',utcStandardOffsetSeconds:3600,displayName:'Bratislava',countryId:'SK'},{id:'Africa/Brazzaville',regionId:'017',utcStandardOffsetSeconds:3600,displayName:'Brazzaville',countryId:'CG'},{id:'Europe/Brussels',regionId:'155',utcStandardOffsetSeconds:3600,displayName:'Brussels',countryId:'BE'},{id:'Europe/Budapest',regionId:'151',utcStandardOffsetSeconds:3600,displayName:'Budapest',countryId:'HU'},{id:'Europe/Busingen',regionId:'155',utcStandardOffsetSeconds:3600,displayName:'Busingen',countryId:'DE'},{id:'Africa/Ceuta',regionId:'039',utcStandardOffsetSeconds:3600,displayName:'Ceuta',countryId:'ES'},{id:'Europe/Copenhagen',regionId:'154',utcStandardOffsetSeconds:3600,displayName:'Copenhagen',countryId:'DK'},{id:'Africa/Douala',regionId:'017',utcStandardOffsetSeconds:3600,displayName:'Douala',countryId:'CM'},{id:'Europe/Gibraltar',regionId:'039',utcStandardOffsetSeconds:3600,displayName:'Gibraltar',countryId:'GI'},{id:'Africa/Kinshasa',regionId:'017',utcStandardOffsetSeconds:3600,displayName:'Kinshasa',countryId:'CD'},{id:'Africa/Lagos',regionId:'011',utcStandardOffsetSeconds:3600,displayName:'Lagos',countryId:'NG'},{id:'Africa/Libreville',regionId:'017',utcStandardOffsetSeconds:3600,displayName:'Libreville',countryId:'GA'},{id:'Europe/Ljubljana',regionId:'039',utcStandardOffsetSeconds:3600,displayName:'Ljubljana',countryId:'SI'},{id:'Arctic/Longyearbyen',regionId:'154',utcStandardOffsetSeconds:3600,displayName:'Longyearbyen',countryId:'SJ'},{id:'Africa/Luanda',regionId:'017',utcStandardOffsetSeconds:3600,displayName:'Luanda',countryId:'AO'},{id:'Europe/Luxembourg',regionId:'155',utcStandardOffsetSeconds:3600,displayName:'Luxembourg',countryId:'LU'},{id:'Europe/Madrid',regionId:'039',utcStandardOffsetSeconds:3600,displayName:'Madrid',countryId:'ES'},{id:'Africa/Malabo',regionId:'017',utcStandardOffsetSeconds:3600,displayName:'Malabo',countryId:'GQ'},{id:'Europe/Malta',regionId:'039',utcStandardOffsetSeconds:3600,displayName:'Malta',countryId:'MT'},{id:'Europe/Monaco',regionId:'155',utcStandardOffsetSeconds:3600,displayName:'Monaco',countryId:'MC'},{id:'Africa/Ndjamena',regionId:'017',utcStandardOffsetSeconds:3600,displayName:'Ndjamena',countryId:'TD'},{id:'Africa/Niamey',regionId:'011',utcStandardOffsetSeconds:3600,displayName:'Niamey',countryId:'NE'},{id:'Europe/Oslo',regionId:'154',utcStandardOffsetSeconds:3600,displayName:'Oslo',countryId:'NO'},{id:'Europe/Paris',regionId:'155',utcStandardOffsetSeconds:3600,displayName:'Paris',countryId:'FR'},{id:'Europe/Podgorica',regionId:'039',utcStandardOffsetSeconds:3600,displayName:'Podgorica',countryId:'ME'},{id:'Africa/Porto-Novo',regionId:'011',utcStandardOffsetSeconds:3600,displayName:'Porto-Novo',countryId:'BJ'},{id:'Europe/Prague',regionId:'151',utcStandardOffsetSeconds:3600,displayName:'Prague',countryId:'CZ'},{id:'Europe/Rome',regionId:'039',utcStandardOffsetSeconds:3600,displayName:'Rome',countryId:'IT'},{id:'Europe/San_Marino',regionId:'039',utcStandardOffsetSeconds:3600,displayName:'San Marino',countryId:'SM'},{id:'Europe/Sarajevo',regionId:'039',utcStandardOffsetSeconds:3600,displayName:'Sarajevo',countryId:'BA'},{id:'Europe/Skopje',regionId:'039',utcStandardOffsetSeconds:3600,displayName:'Skopje',countryId:'MK'},{id:'Europe/Stockholm',regionId:'154',utcStandardOffsetSeconds:3600,displayName:'Stockholm',countryId:'SE'},{id:'Europe/Tirane',regionId:'039',utcStandardOffsetSeconds:3600,displayName:'Tirane',countryId:'AL'},{id:'Africa/Tunis',regionId:'015',utcStandardOffsetSeconds:3600,displayName:'Tunis',countryId:'TN'},{id:'Europe/Vaduz',regionId:'155',utcStandardOffsetSeconds:3600,displayName:'Vaduz',countryId:'LI'},{id:'Europe/Vatican',regionId:'039',utcStandardOffsetSeconds:3600,displayName:'Vatican',countryId:'VA'},{id:'Europe/Vienna',regionId:'155',utcStandardOffsetSeconds:3600,displayName:'Vienna',countryId:'AT'},{id:'Europe/Warsaw',regionId:'151',utcStandardOffsetSeconds:3600,displayName:'Warsaw',countryId:'PL'},{id:'Europe/Zagreb',regionId:'039',utcStandardOffsetSeconds:3600,displayName:'Zagreb',countryId:'HR'},{id:'Europe/Zurich',regionId:'155',utcStandardOffsetSeconds:3600,displayName:'Zurich',countryId:'CH'},{id:'Asia/Amman',regionId:'145',utcStandardOffsetSeconds:7200,displayName:'Amman',countryId:'JO'},{id:'Europe/Athens',regionId:'039',utcStandardOffsetSeconds:7200,displayName:'Athens',countryId:'GR'},{id:'Asia/Beirut',regionId:'145',utcStandardOffsetSeconds:7200,displayName:'Beirut',countryId:'LB'},{id:'Africa/Blantyre',regionId:'014',utcStandardOffsetSeconds:7200,displayName:'Blantyre',countryId:'MW'},{id:'Europe/Bucharest',regionId:'151',utcStandardOffsetSeconds:7200,displayName:'Bucharest',countryId:'RO'},{id:'Africa/Bujumbura',regionId:'014',utcStandardOffsetSeconds:7200,displayName:'Bujumbura',countryId:'BI'},{id:'Africa/Cairo',regionId:'015',utcStandardOffsetSeconds:7200,displayName:'Cairo',countryId:'EG'},{id:'Europe/Chisinau',regionId:'151',utcStandardOffsetSeconds:7200,displayName:'Chisinau',countryId:'MD'},{id:'Asia/Damascus',regionId:'145',utcStandardOffsetSeconds:7200,displayName:'Damascus',countryId:'SY'},{id:'Asia/Famagusta',regionId:'145',utcStandardOffsetSeconds:7200,displayName:'Famagusta',countryId:'CY'},{id:'Africa/Gaborone',regionId:'018',utcStandardOffsetSeconds:7200,displayName:'Gaborone',countryId:'BW'},{id:'Asia/Gaza',regionId:'145',utcStandardOffsetSeconds:7200,displayName:'Gaza',countryId:'PS'},{id:'Africa/Harare',regionId:'014',utcStandardOffsetSeconds:7200,displayName:'Harare',countryId:'ZW'},{id:'Asia/Hebron',regionId:'145',utcStandardOffsetSeconds:7200,displayName:'Hebron',countryId:'PS'},{id:'Europe/Helsinki',regionId:'154',utcStandardOffsetSeconds:7200,displayName:'Helsinki',countryId:'FI'},{id:'Asia/Jerusalem',regionId:'145',utcStandardOffsetSeconds:7200,displayName:'Jerusalem',countryId:'IL'},{id:'Africa/Johannesburg',regionId:'018',utcStandardOffsetSeconds:7200,displayName:'Johannesburg',countryId:'ZA'},{id:'Europe/Kaliningrad',regionId:'151',utcStandardOffsetSeconds:7200,displayName:'Kaliningrad',countryId:'RU'},{id:'Africa/Khartoum',regionId:'015',utcStandardOffsetSeconds:7200,displayName:'Khartoum',countryId:'SD'},{id:'Europe/Kiev',regionId:'151',utcStandardOffsetSeconds:7200,displayName:'Kiev',countryId:'UA'},{id:'Africa/Kigali',regionId:'014',utcStandardOffsetSeconds:7200,displayName:'Kigali',countryId:'RW'},{id:'Africa/Lubumbashi',regionId:'017',utcStandardOffsetSeconds:7200,displayName:'Lubumbashi',countryId:'CD'},{id:'Africa/Lusaka',regionId:'014',utcStandardOffsetSeconds:7200,displayName:'Lusaka',countryId:'ZM'},{id:'Africa/Maputo',regionId:'014',utcStandardOffsetSeconds:7200,displayName:'Maputo',countryId:'MZ'},{id:'Europe/Mariehamn',regionId:'154',utcStandardOffsetSeconds:7200,displayName:'Mariehamn',countryId:'AX'},{id:'Africa/Maseru',regionId:'018',utcStandardOffsetSeconds:7200,displayName:'Maseru',countryId:'LS'},{id:'Africa/Mbabane',regionId:'018',utcStandardOffsetSeconds:7200,displayName:'Mbabane',countryId:'SZ'},{id:'Asia/Nicosia',regionId:'145',utcStandardOffsetSeconds:7200,displayName:'Nicosia',countryId:'CY'},{id:'Europe/Riga',regionId:'154',utcStandardOffsetSeconds:7200,displayName:'Riga',countryId:'LV'},{id:'Europe/Sofia',regionId:'151',utcStandardOffsetSeconds:7200,displayName:'Sofia',countryId:'BG'},{id:'Europe/Tallinn',regionId:'154',utcStandardOffsetSeconds:7200,displayName:'Tallinn',countryId:'EE'},{id:'Africa/Tripoli',regionId:'015',utcStandardOffsetSeconds:7200,displayName:'Tripoli',countryId:'LY'},{id:'Europe/Uzhgorod',regionId:'151',utcStandardOffsetSeconds:7200,displayName:'Uzhgorod',countryId:'UA'},{id:'Europe/Vilnius',regionId:'154',utcStandardOffsetSeconds:7200,displayName:'Vilnius',countryId:'LT'},{id:'Africa/Windhoek',regionId:'018',utcStandardOffsetSeconds:7200,displayName:'Windhoek',countryId:'NA'},{id:'Europe/Zaporozhye',regionId:'151',utcStandardOffsetSeconds:7200,displayName:'Zaporozhye',countryId:'UA'},{id:'Africa/Addis_Ababa',regionId:'014',utcStandardOffsetSeconds:10800,displayName:'Addis Ababa',countryId:'ET'},{id:'Asia/Aden',regionId:'145',utcStandardOffsetSeconds:10800,displayName:'Aden',countryId:'YE'},{id:'Indian/Antananarivo',regionId:'014',utcStandardOffsetSeconds:10800,displayName:'Antananarivo',countryId:'MG'},{id:'Africa/Asmara',regionId:'014',utcStandardOffsetSeconds:10800,displayName:'Asmara',countryId:'ER'},{id:'Asia/Baghdad',regionId:'145',utcStandardOffsetSeconds:10800,displayName:'Baghdad',countryId:'IQ'},{id:'Asia/Bahrain',regionId:'145',utcStandardOffsetSeconds:10800,displayName:'Bahrain',countryId:'BH'},{id:'Indian/Comoro',regionId:'014',utcStandardOffsetSeconds:10800,displayName:'Comoro',countryId:'KM'},{id:'Africa/Dar_es_Salaam',regionId:'014',utcStandardOffsetSeconds:10800,displayName:'Dar es Salaam',countryId:'TZ'},{id:'Africa/Djibouti',regionId:'014',utcStandardOffsetSeconds:10800,displayName:'Djibouti',countryId:'DJ'},{id:'Europe/Istanbul',regionId:'145',utcStandardOffsetSeconds:10800,displayName:'Istanbul',countryId:'TR'},{id:'Africa/Juba',regionId:'014',utcStandardOffsetSeconds:10800,displayName:'Juba',countryId:'SS'},{id:'Africa/Kampala',regionId:'014',utcStandardOffsetSeconds:10800,displayName:'Kampala',countryId:'UG'},{id:'Europe/Kirov',regionId:'151',utcStandardOffsetSeconds:10800,displayName:'Kirov',countryId:'RU'},{id:'Asia/Kuwait',regionId:'145',utcStandardOffsetSeconds:10800,displayName:'Kuwait',countryId:'KW'},{id:'Indian/Mayotte',regionId:'014',utcStandardOffsetSeconds:10800,displayName:'Mayotte',countryId:'YT'},{id:'Europe/Minsk',regionId:'151',utcStandardOffsetSeconds:10800,displayName:'Minsk',countryId:'BY'},{id:'Africa/Mogadishu',regionId:'014',utcStandardOffsetSeconds:10800,displayName:'Mogadishu',countryId:'SO'},{id:'Europe/Moscow',regionId:'151',utcStandardOffsetSeconds:10800,displayName:'Moscow',countryId:'RU'},{id:'Africa/Nairobi',regionId:'014',utcStandardOffsetSeconds:10800,displayName:'Nairobi',countryId:'KE'},{id:'Asia/Qatar',regionId:'145',utcStandardOffsetSeconds:10800,displayName:'Qatar',countryId:'QA'},{id:'Asia/Riyadh',regionId:'145',utcStandardOffsetSeconds:10800,displayName:'Riyadh',countryId:'SA'},{id:'Europe/Simferopol',regionId:'151',utcStandardOffsetSeconds:10800,displayName:'Simferopol',countryId:'RU'},{id:'Antarctica/Syowa',utcStandardOffsetSeconds:10800,displayName:'Syowa',countryId:'AQ'},{id:'Europe/Volgograd',regionId:'151',utcStandardOffsetSeconds:10800,displayName:'Volgograd',countryId:'RU'},{id:'Asia/Tehran',regionId:'034',utcStandardOffsetSeconds:12600,displayName:'Tehran',countryId:'IR'},{id:'Europe/Astrakhan',regionId:'151',utcStandardOffsetSeconds:14400,displayName:'Astrakhan',countryId:'RU'},{id:'Asia/Baku',regionId:'145',utcStandardOffsetSeconds:14400,displayName:'Baku',countryId:'AZ'},{id:'Asia/Dubai',regionId:'145',utcStandardOffsetSeconds:14400,displayName:'Dubai',countryId:'AE'},{id:'Indian/Mahe',regionId:'014',utcStandardOffsetSeconds:14400,displayName:'Mahe',countryId:'SC'},{id:'Indian/Mauritius',regionId:'014',utcStandardOffsetSeconds:14400,displayName:'Mauritius',countryId:'MU'},{id:'Asia/Muscat',regionId:'145',utcStandardOffsetSeconds:14400,displayName:'Muscat',countryId:'OM'},{id:'Indian/Reunion',regionId:'014',utcStandardOffsetSeconds:14400,displayName:'Reunion',countryId:'RE'},{id:'Europe/Samara',regionId:'151',utcStandardOffsetSeconds:14400,displayName:'Samara',countryId:'RU'},{id:'Europe/Saratov',regionId:'151',utcStandardOffsetSeconds:14400,displayName:'Saratov',countryId:'RU'},{id:'Asia/Tbilisi',regionId:'145',utcStandardOffsetSeconds:14400,displayName:'Tbilisi',countryId:'GE'},{id:'Europe/Ulyanovsk',regionId:'151',utcStandardOffsetSeconds:14400,displayName:'Ulyanovsk',countryId:'RU'},{id:'Asia/Yerevan',regionId:'145',utcStandardOffsetSeconds:14400,displayName:'Yerevan',countryId:'AM'},{id:'Asia/Kabul',regionId:'034',utcStandardOffsetSeconds:16200,displayName:'Kabul',countryId:'AF'},{id:'Asia/Aqtau',regionId:'143',utcStandardOffsetSeconds:18000,displayName:'Aqtau',countryId:'KZ'},{id:'Asia/Aqtobe',regionId:'143',utcStandardOffsetSeconds:18000,displayName:'Aqtobe',countryId:'KZ'},{id:'Asia/Ashgabat',regionId:'143',utcStandardOffsetSeconds:18000,displayName:'Ashgabat',countryId:'TM'},{id:'Asia/Atyrau',regionId:'143',utcStandardOffsetSeconds:18000,displayName:'Atyrau',countryId:'KZ'},{id:'Asia/Dushanbe',regionId:'143',utcStandardOffsetSeconds:18000,displayName:'Dushanbe',countryId:'TJ'},{id:'Asia/Karachi',regionId:'034',utcStandardOffsetSeconds:18000,displayName:'Karachi',countryId:'PK'},{id:'Indian/Kerguelen',utcStandardOffsetSeconds:18000,displayName:'Kerguelen',countryId:'TF'},{id:'Indian/Maldives',regionId:'034',utcStandardOffsetSeconds:18000,displayName:'Maldives',countryId:'MV'},{id:'Antarctica/Mawson',utcStandardOffsetSeconds:18000,displayName:'Mawson',countryId:'AQ'},{id:'Asia/Oral',regionId:'143',utcStandardOffsetSeconds:18000,displayName:'Oral',countryId:'KZ'},{id:'Asia/Samarkand',regionId:'143',utcStandardOffsetSeconds:18000,displayName:'Samarkand',countryId:'UZ'},{id:'Asia/Tashkent',regionId:'143',utcStandardOffsetSeconds:18000,displayName:'Tashkent',countryId:'UZ'},{id:'Asia/Yekaterinburg',regionId:'151',utcStandardOffsetSeconds:18000,displayName:'Yekaterinburg',countryId:'RU'},{id:'Asia/Colombo',regionId:'034',utcStandardOffsetSeconds:19800,displayName:'Colombo',countryId:'LK'},{id:'Asia/Kolkata',regionId:'034',utcStandardOffsetSeconds:19800,displayName:'Kolkata',countryId:'IN'},{id:'Asia/Kathmandu',regionId:'034',utcStandardOffsetSeconds:20700,displayName:'Kathmandu',countryId:'NP'},{id:'Asia/Almaty',regionId:'143',utcStandardOffsetSeconds:21600,displayName:'Almaty',countryId:'KZ'},{id:'Asia/Bishkek',regionId:'143',utcStandardOffsetSeconds:21600,displayName:'Bishkek',countryId:'KG'},{id:'Indian/Chagos',utcStandardOffsetSeconds:21600,displayName:'Chagos',countryId:'IO'},{id:'Asia/Dhaka',regionId:'034',utcStandardOffsetSeconds:21600,displayName:'Dhaka',countryId:'BD'},{id:'Asia/Omsk',regionId:'151',utcStandardOffsetSeconds:21600,displayName:'Omsk',countryId:'RU'},{id:'Asia/Qyzylorda',regionId:'143',utcStandardOffsetSeconds:21600,displayName:'Qyzylorda',countryId:'KZ'},{id:'Asia/Thimphu',regionId:'034',utcStandardOffsetSeconds:21600,displayName:'Thimphu',countryId:'BT'},{id:'Asia/Urumqi',regionId:'030',utcStandardOffsetSeconds:21600,displayName:'Urumqi',countryId:'CN'},{id:'Antarctica/Vostok',utcStandardOffsetSeconds:21600,displayName:'Vostok',countryId:'AQ'},{id:'Indian/Cocos',utcStandardOffsetSeconds:23400,displayName:'Cocos',countryId:'CC'},{id:'Asia/Yangon',regionId:'035',utcStandardOffsetSeconds:23400,displayName:'Yangon',countryId:'MM'},{id:'Asia/Bangkok',regionId:'035',utcStandardOffsetSeconds:25200,displayName:'Bangkok',countryId:'TH'},{id:'Asia/Barnaul',regionId:'151',utcStandardOffsetSeconds:25200,displayName:'Barnaul',countryId:'RU'},{id:'Indian/Christmas',utcStandardOffsetSeconds:25200,displayName:'Christmas',countryId:'CX'},{id:'Antarctica/Davis',utcStandardOffsetSeconds:25200,displayName:'Davis',countryId:'AQ'},{id:'Asia/Ho_Chi_Minh',regionId:'035',utcStandardOffsetSeconds:25200,displayName:'Ho Chi Minh',countryId:'VN'},{id:'Asia/Hovd',regionId:'030',utcStandardOffsetSeconds:25200,displayName:'Hovd',countryId:'MN'},{id:'Asia/Jakarta',regionId:'035',utcStandardOffsetSeconds:25200,displayName:'Jakarta',countryId:'ID'},{id:'Asia/Krasnoyarsk',regionId:'151',utcStandardOffsetSeconds:25200,displayName:'Krasnoyarsk',countryId:'RU'},{id:'Asia/Novokuznetsk',regionId:'151',utcStandardOffsetSeconds:25200,displayName:'Novokuznetsk',countryId:'RU'},{id:'Asia/Novosibirsk',regionId:'151',utcStandardOffsetSeconds:25200,displayName:'Novosibirsk',countryId:'RU'},{id:'Asia/Phnom_Penh',regionId:'035',utcStandardOffsetSeconds:25200,displayName:'Phnom Penh',countryId:'KH'},{id:'Asia/Pontianak',regionId:'035',utcStandardOffsetSeconds:25200,displayName:'Pontianak',countryId:'ID'},{id:'Asia/Tomsk',regionId:'151',utcStandardOffsetSeconds:25200,displayName:'Tomsk',countryId:'RU'},{id:'Asia/Vientiane',regionId:'035',utcStandardOffsetSeconds:25200,displayName:'Vientiane',countryId:'LA'},{id:'Asia/Brunei',regionId:'035',utcStandardOffsetSeconds:28800,displayName:'Brunei',countryId:'BN'},{id:'Asia/Choibalsan',regionId:'030',utcStandardOffsetSeconds:28800,displayName:'Choibalsan',countryId:'MN'},{id:'Asia/Hong_Kong',regionId:'030',utcStandardOffsetSeconds:28800,displayName:'Hong Kong',countryId:'HK'},{id:'Asia/Irkutsk',regionId:'151',utcStandardOffsetSeconds:28800,displayName:'Irkutsk',countryId:'RU'},{id:'Asia/Kuala_Lumpur',regionId:'035',utcStandardOffsetSeconds:28800,displayName:'Kuala Lumpur',countryId:'MY'},{id:'Asia/Kuching',regionId:'035',utcStandardOffsetSeconds:28800,displayName:'Kuching',countryId:'MY'},{id:'Asia/Macau',regionId:'030',utcStandardOffsetSeconds:28800,displayName:'Macau',countryId:'MO'},{id:'Asia/Makassar',regionId:'035',utcStandardOffsetSeconds:28800,displayName:'Makassar',countryId:'ID'},{id:'Asia/Manila',regionId:'035',utcStandardOffsetSeconds:28800,displayName:'Manila',countryId:'PH'},{id:'Australia/Perth',regionId:'053',utcStandardOffsetSeconds:28800,displayName:'Perth',countryId:'AU'},{id:'Asia/Shanghai',regionId:'030',utcStandardOffsetSeconds:28800,displayName:'Shanghai',countryId:'CN'},{id:'Asia/Singapore',regionId:'035',utcStandardOffsetSeconds:28800,displayName:'Singapore',countryId:'SG'},{id:'Asia/Taipei',regionId:'030',utcStandardOffsetSeconds:28800,displayName:'Taipei',countryId:'TW'},{id:'Asia/Ulaanbaatar',regionId:'030',utcStandardOffsetSeconds:28800,displayName:'Ulaanbaatar',countryId:'MN'},{id:'Asia/Pyongyang',regionId:'030',utcStandardOffsetSeconds:30600,displayName:'Pyongyang',countryId:'KP'},{id:'Australia/Eucla',regionId:'053',utcStandardOffsetSeconds:31500,displayName:'Eucla',countryId:'AU'},{id:'Asia/Chita',regionId:'151',utcStandardOffsetSeconds:32400,displayName:'Chita',countryId:'RU'},{id:'Asia/Dili',regionId:'035',utcStandardOffsetSeconds:32400,displayName:'Dili',countryId:'TL'},{id:'Asia/Jayapura',regionId:'035',utcStandardOffsetSeconds:32400,displayName:'Jayapura',countryId:'ID'},{id:'Asia/Khandyga',regionId:'151',utcStandardOffsetSeconds:32400,displayName:'Khandyga',countryId:'RU'},{id:'Pacific/Palau',regionId:'057',utcStandardOffsetSeconds:32400,displayName:'Palau',countryId:'PW'},{id:'Asia/Seoul',regionId:'030',utcStandardOffsetSeconds:32400,displayName:'Seoul',countryId:'KR'},{id:'Asia/Tokyo',regionId:'030',utcStandardOffsetSeconds:32400,displayName:'Tokyo',countryId:'JP'},{id:'Asia/Yakutsk',regionId:'151',utcStandardOffsetSeconds:32400,displayName:'Yakutsk',countryId:'RU'},{id:'Australia/Adelaide',regionId:'053',utcStandardOffsetSeconds:34200,displayName:'Adelaide',countryId:'AU'},{id:'Australia/Broken_Hill',regionId:'053',utcStandardOffsetSeconds:34200,displayName:'Broken Hill',countryId:'AU'},{id:'Australia/Darwin',regionId:'053',utcStandardOffsetSeconds:34200,displayName:'Darwin',countryId:'AU'},{id:'Australia/Brisbane',regionId:'053',utcStandardOffsetSeconds:36000,displayName:'Brisbane',countryId:'AU'},{id:'Pacific/Chuuk',regionId:'057',utcStandardOffsetSeconds:36000,displayName:'Chuuk',countryId:'FM'},{id:'Australia/Currie',regionId:'053',utcStandardOffsetSeconds:36000,displayName:'Currie',countryId:'AU'},{id:'Antarctica/DumontDUrville',utcStandardOffsetSeconds:36000,displayName:'Dumont d’Urville',countryId:'AQ'},{id:'Pacific/Guam',regionId:'057',utcStandardOffsetSeconds:36000,displayName:'Guam',countryId:'GU'},{id:'Australia/Hobart',regionId:'053',utcStandardOffsetSeconds:36000,displayName:'Hobart',countryId:'AU'},{id:'Australia/Lindeman',regionId:'053',utcStandardOffsetSeconds:36000,displayName:'Lindeman',countryId:'AU'},{id:'Australia/Melbourne',regionId:'053',utcStandardOffsetSeconds:36000,displayName:'Melbourne',countryId:'AU'},{id:'Pacific/Port_Moresby',regionId:'054',utcStandardOffsetSeconds:36000,displayName:'Port Moresby',countryId:'PG'},{id:'Pacific/Saipan',regionId:'057',utcStandardOffsetSeconds:36000,displayName:'Saipan',countryId:'MP'},{id:'Australia/Sydney',regionId:'053',utcStandardOffsetSeconds:36000,displayName:'Sydney',countryId:'AU'},{id:'Asia/Ust-Nera',regionId:'151',utcStandardOffsetSeconds:36000,displayName:'Ust-Nera',countryId:'RU'},{id:'Asia/Vladivostok',regionId:'151',utcStandardOffsetSeconds:36000,displayName:'Vladivostok',countryId:'RU'},{id:'Australia/Lord_Howe',regionId:'053',utcStandardOffsetSeconds:37800,displayName:'Lord Howe',countryId:'AU'},{id:'Pacific/Bougainville',regionId:'054',utcStandardOffsetSeconds:39600,displayName:'Bougainville',countryId:'PG'},{id:'Antarctica/Casey',utcStandardOffsetSeconds:39600,displayName:'Casey',countryId:'AQ'},{id:'Pacific/Efate',regionId:'054',utcStandardOffsetSeconds:39600,displayName:'Efate',countryId:'VU'},{id:'Pacific/Guadalcanal',regionId:'054',utcStandardOffsetSeconds:39600,displayName:'Guadalcanal',countryId:'SB'},{id:'Pacific/Kosrae',regionId:'057',utcStandardOffsetSeconds:39600,displayName:'Kosrae',countryId:'FM'},{id:'Antarctica/Macquarie',regionId:'053',utcStandardOffsetSeconds:39600,displayName:'Macquarie',countryId:'AU'},{id:'Asia/Magadan',regionId:'151',utcStandardOffsetSeconds:39600,displayName:'Magadan',countryId:'RU'},{id:'Pacific/Norfolk',regionId:'053',utcStandardOffsetSeconds:39600,displayName:'Norfolk',countryId:'NF'},{id:'Pacific/Noumea',regionId:'054',utcStandardOffsetSeconds:39600,displayName:'Noumea',countryId:'NC'},{id:'Pacific/Pohnpei',regionId:'057',utcStandardOffsetSeconds:39600,displayName:'Pohnpei',countryId:'FM'},{id:'Asia/Sakhalin',regionId:'151',utcStandardOffsetSeconds:39600,displayName:'Sakhalin',countryId:'RU'},{id:'Asia/Srednekolymsk',regionId:'151',utcStandardOffsetSeconds:39600,displayName:'Srednekolymsk',countryId:'RU'},{id:'Asia/Anadyr',regionId:'151',utcStandardOffsetSeconds:43200,displayName:'Anadyr',countryId:'RU'},{id:'Pacific/Auckland',regionId:'053',utcStandardOffsetSeconds:43200,displayName:'Auckland',countryId:'NZ'},{id:'Pacific/Fiji',regionId:'054',utcStandardOffsetSeconds:43200,displayName:'Fiji',countryId:'FJ'},{id:'Pacific/Funafuti',regionId:'061',utcStandardOffsetSeconds:43200,displayName:'Funafuti',countryId:'TV'},{id:'Asia/Kamchatka',regionId:'151',utcStandardOffsetSeconds:43200,displayName:'Kamchatka',countryId:'RU'},{id:'Pacific/Kwajalein',regionId:'057',utcStandardOffsetSeconds:43200,displayName:'Kwajalein',countryId:'MH'},{id:'Pacific/Majuro',regionId:'057',utcStandardOffsetSeconds:43200,displayName:'Majuro',countryId:'MH'},{id:'Antarctica/McMurdo',utcStandardOffsetSeconds:43200,displayName:'McMurdo',countryId:'AQ'},{id:'Pacific/Nauru',regionId:'057',utcStandardOffsetSeconds:43200,displayName:'Nauru',countryId:'NR'},{id:'Pacific/Tarawa',regionId:'057',utcStandardOffsetSeconds:43200,displayName:'Tarawa',countryId:'KI'},{id:'Pacific/Wake',utcStandardOffsetSeconds:43200,displayName:'Wake',countryId:'UM'},{id:'Pacific/Wallis',regionId:'061',utcStandardOffsetSeconds:43200,displayName:'Wallis',countryId:'WF'},{id:'Pacific/Chatham',regionId:'053',utcStandardOffsetSeconds:45900,displayName:'Chatham',countryId:'NZ'},{id:'Pacific/Apia',regionId:'061',utcStandardOffsetSeconds:46800,displayName:'Apia',countryId:'WS'},{id:'Pacific/Enderbury',regionId:'057',utcStandardOffsetSeconds:46800,displayName:'Enderbury',countryId:'KI'},{id:'Pacific/Fakaofo',regionId:'061',utcStandardOffsetSeconds:46800,displayName:'Fakaofo',countryId:'TK'},{id:'Pacific/Tongatapu',regionId:'061',utcStandardOffsetSeconds:46800,displayName:'Tongatapu',countryId:'TO'},{id:'Pacific/Kiritimati',regionId:'057',utcStandardOffsetSeconds:50400,displayName:'Kiritimati',countryId:'KI'}];inter.territories=[];inter.languages=[];inter.currencies=[];function normalizeLocaleId(localeId){return localeId&&localeId.replace(/-/g,'_').toLowerCase()}inter.load=function(localeId){return $__require('./'+normalizeLocaleId(localeId))};module.exports=inter;return module.exports});System.registerDynamic('3rdparty/crashreporter/crashLogger.js',[],false,function($__require,$__exports,$__module){var _retrieveGlobal=System.get('@@global-helpers').prepareGlobal($__module.id,null,null);(function($__global){window.one=window.one||{};(function(){function CrashLogger(size){this.logSize=size;this.index=0;this.logBuffer=[]}function leftPad(str,length,padChar){str=String(str);while(str.length<length){str=(padChar||' ')+str}return str}CrashLogger.prototype.log=function(){var args=Array.prototype.slice.call(arguments);var d=new Date;var timestamp=d.getHours()+':'+leftPad(d.getMinutes(),2,'0')+':'+leftPad(d.getSeconds(),2,'0')+'.'+leftPad(d.getMilliseconds(),3,'0');this.logBuffer[this.index]=timestamp+': '+args.join(', ');this.index=(this.index+1)%this.logSize};CrashLogger.prototype.getEntries=function(){var result=[];var start=this.index-this.logSize;start=start<0?this.logSize+start:start;for(var i=0;i<this.logSize;i+=1){var entry=this.logBuffer[(start+i)%this.logSize];if(entry){result.push(entry)}}return result};CrashLogger.prototype.toString=function(){return this.getEntries().join('\n')};one.crashLogger=new CrashLogger(60)}())}(this));return _retrieveGlobal()});System.registerDynamic('3rdparty/crashreporter/crashReporter.js',[],false,function($__require,$__exports,$__module){var _retrieveGlobal=System.get('@@global-helpers').prepareGlobal($__module.id,null,null);(function($__global){window.one=window.one||{};(function(){function CrashReporter(options){var that=this;options=options||{};that.hash={};that.reportUrl=options.reportUrl||'/api/crashreporter/';function createApplicationCrash(error,additionalInfo){error=error||new Error;if(additionalInfo){error.additionalInfo=additionalInfo;if(additionalInfo.hasOwnProperty('message')){error.customMessage=additionalInfo.message}}return error}that.provokeScriptError=function(){setTimeout(function(){that.undefinedFunction()},1)};that.reportCrash=function(error,additionalInfo){try{throw createApplicationCrash(error,additionalInfo)}catch(e){if(typeof TraceKit==='undefined'||typeof CONFIG!=='undefined'&&CONFIG.crashReporter&&CONFIG.crashReporter.bypassTraceKit){that.sendReportFromTraceKit(e)}else{TraceKit.report(e)}}};function createTaggedErrorMessage(err,message,clean){message=message?message:'Application error.';if(err.tags){message+=' tags: "'+err.tags.join(' ')+'"'}if(err.status){message+=' ['+err.status+': '+err.statusText+']'}return message.replace(/\n/g,'\\n')}that.reportTaggedCrash=function(err,message){that.reportCrash(err,{message:createTaggedErrorMessage(err,message)})};function isBlacklisted(err){if(!window.JSON){return true}var userAgentString=navigator.userAgent,matchMsieVersion=userAgentString&&userAgentString.match(/msie (\d+(\.\d+)?);/i);if(matchMsieVersion&&parseInt(matchMsieVersion,10)<9){return true}var ignoreUrls=['.cloudfront.net','chrome://','google-analytics.com','extension','superfish','admedia'],url=err.fileName,found=false;if(url){ignoreUrls.forEach(function(ignoreUrl){if(url.match(ignoreUrl)){found=true;return}});if(found){return true}}if(err.message==='Script error.'&&err.fileName===''&&err.lineNumber===0||/TOOLBAR_READY/.test(err.message)||err.message==='RequireJS load error'||/conduitPage/.test(err.message)||false){return true}return false}that.sendReport=function(err){if(isBlacklisted(err)){return}var xhr;try{xhr=new XMLHttpRequest}catch(e){try{xhr=new ActiveXObject('Microsoft.XmlHTTP')}catch(e2){}}if(!xhr){throw new Error('Couldn\'t initialize an XMLHttpRequest object.')}var fileNameMatch=(err.fileName||'').match(/^(?:https?:\/\/)(?:[^\/]+)(\/[^#]*)/);fileNameMatch=fileNameMatch?fileNameMatch[1]:err.fileName;var filePosition=fileNameMatch+':'+err.lineNumber;var message=(err.message||err.customMessage)+' ('+filePosition+')';if(err.name!=='Error'&&message.indexOf(err.name)===-1){message=err.name+': '+message}var now=new Date;var timestamp=now.getTime();var then=that.hash[message];if(then&&timestamp-then<120000){that.hash[message]=timestamp;return}that.hash[message]=timestamp;var crashReport={appData:{location:err.pageName,user:err.user,locale:document.documentElement.getAttribute('lang'),clientLog:one.crashLogger&&one.crashLogger.toString(),sourceMappedStack:err.sourceMappedStack,sourceMappedStackError:err.sourceMappedStackError},browserLocalTime:now.toString(),browserUTCTime:now.toUTCString(),message:message,crashReportId:err.crashReportId};if(err.additionalInfo){crashReport.additionalInfo=err.additionalInfo}if(one.version){crashReport.appData.serverVersion=one.version.serverVersion();crashReport.appData.clientVersion=one.version.clientVersion()}crashReport.err={name:err.name,tags:err.tags,message:err.message,customMessage:err.customMessage,fileName:err.fileName+':'+err.lineNumber};if(typeof err.status!=='undefined'){crashReport.err.request={method:err.requestMethod,url:err.requestUrl};crashReport.err.response={status:err.status,statusText:err.statusText,headers:err.responseHeaders,body:err.response||err.responseText};if(typeof crashReport.err.response.body==='string'&&/<\/html>$/i.test(crashReport.err.response.body)){crashReport.err.response.fromMitmProxy=true}}if(err.hasOwnProperty('stack')){crashReport.err.stack=err.stack}var crashReportStringified;try{crashReportStringified=JSON.stringify(crashReport)}catch(e){var newCrashReport={message:'Failed to stringify crash report: '+e.message};if(typeof crashReport.message==='string'){newCrashReport.err={message:crashReport.message}}crashReportStringified=JSON.stringify(newCrashReport)}xhr.open('post',that.reportUrl,true);xhr.setRequestHeader('Content-Type','application/json');if(oneTimeReadyStateChangeHandler){xhr.onreadystatechange=oneTimeReadyStateChangeHandler;oneTimeReadyStateChangeHandler=undefined}xhr.send(crashReportStringified)};var oneTimeReadyStateChangeHandler;that.subscribeOneTimeOnReadyStateChangeHandler=function(handler){if(typeof handler==='function'){oneTimeReadyStateChangeHandler=handler}};that.sendReportFromTraceKit=function(errorReport){var firstFrame=errorReport.stack&&errorReport.stack.length>0?errorReport.stack[0]:{};var err;if(Object.prototype.toString.call(errorReport)==='[object Error]'){err=errorReport}else{err=errorReport.error||function(){var e=new Error;e.message=errorReport.message;return e}()}err.fileName=firstFrame.url;err.lineNumber=firstFrame.line;err.pageName=errorReport.url;err.sourceMappedStack=errorReport.sourceMappedStack;err.sourceMappedStackError=errorReport.sourceMappedStackError;that.sendReport(err)}}var crashReporterConfig=one.crashReporterConfig||{};one.crashReporter=new CrashReporter(crashReporterConfig)}())}(this));return _retrieveGlobal()});System.registerDynamic('node_modules/source-map/lib/binary-search.js',[],true,function($__require,exports,module){var define,global=this||self,GLOBAL=global;exports.GREATEST_LOWER_BOUND=1;exports.LEAST_UPPER_BOUND=2;function recursiveSearch(aLow,aHigh,aNeedle,aHaystack,aCompare,aBias){var mid=Math.floor((aHigh-aLow)/2)+aLow;var cmp=aCompare(aNeedle,aHaystack[mid],true);if(cmp===0){return mid}else if(cmp>0){if(aHigh-mid>1){return recursiveSearch(mid,aHigh,aNeedle,aHaystack,aCompare,aBias)}if(aBias==exports.LEAST_UPPER_BOUND){return aHigh<aHaystack.length?aHigh:-1}else{return mid}}else{if(mid-aLow>1){return recursiveSearch(aLow,mid,aNeedle,aHaystack,aCompare,aBias)}if(aBias==exports.LEAST_UPPER_BOUND){return mid}else{return aLow<0?-1:aLow}}}exports.search=function search(aNeedle,aHaystack,aCompare,aBias){if(aHaystack.length===0){return-1}var index=recursiveSearch(-1,aHaystack.length,aNeedle,aHaystack,aCompare,aBias||exports.GREATEST_LOWER_BOUND);if(index<0){return-1}while(index-1>=0){if(aCompare(aHaystack[index],aHaystack[index-1],true)!==0){break}--index}return index};return module.exports});System.registerDynamic('node_modules/source-map/lib/quick-sort.js',[],true,function($__require,exports,module){var define,global=this||self,GLOBAL=global;function swap(ary,x,y){var temp=ary[x];ary[x]=ary[y];ary[y]=temp}function randomIntInRange(low,high){return Math.round(low+Math.random()*(high-low))}function doQuickSort(ary,comparator,p,r){if(p<r){var pivotIndex=randomIntInRange(p,r);var i=p-1;swap(ary,pivotIndex,r);var pivot=ary[r];for(var j=p;j<r;j++){if(comparator(ary[j],pivot)<=0){i+=1;swap(ary,i,j)}}swap(ary,i+1,j);var q=i+1;doQuickSort(ary,comparator,p,q-1);doQuickSort(ary,comparator,q+1,r)}}exports.quickSort=function(ary,comparator){doQuickSort(ary,comparator,0,ary.length-1)};return module.exports});System.registerDynamic('node_modules/source-map/lib/source-map-consumer.js',['node_modules/source-map/lib/util.js','node_modules/source-map/lib/binary-search.js','node_modules/source-map/lib/array-set.js','node_modules/source-map/lib/base64-vlq.js','node_modules/source-map/lib/quick-sort.js'],true,function($__require,exports,module){var define,global=this||self,GLOBAL=global;var util=$__require('node_modules/source-map/lib/util.js');var binarySearch=$__require('node_modules/source-map/lib/binary-search.js');var ArraySet=$__require('node_modules/source-map/lib/array-set.js').ArraySet;var base64VLQ=$__require('node_modules/source-map/lib/base64-vlq.js');var quickSort=$__require('node_modules/source-map/lib/quick-sort.js').quickSort;function SourceMapConsumer(aSourceMap){var sourceMap=aSourceMap;if(typeof aSourceMap==='string'){sourceMap=JSON.parse(aSourceMap.replace(/^\)\]\}'/,''))}return sourceMap.sections!=null?new IndexedSourceMapConsumer(sourceMap):new BasicSourceMapConsumer(sourceMap)}SourceMapConsumer.fromSourceMap=function(aSourceMap){return BasicSourceMapConsumer.fromSourceMap(aSourceMap)};SourceMapConsumer.prototype._version=3;SourceMapConsumer.prototype.__generatedMappings=null;Object.defineProperty(SourceMapConsumer.prototype,'_generatedMappings',{get:function(){if(!this.__generatedMappings){this._parseMappings(this._mappings,this.sourceRoot)}return this.__generatedMappings}});SourceMapConsumer.prototype.__originalMappings=null;Object.defineProperty(SourceMapConsumer.prototype,'_originalMappings',{get:function(){if(!this.__originalMappings){this._parseMappings(this._mappings,this.sourceRoot)}return this.__originalMappings}});SourceMapConsumer.prototype._charIsMappingSeparator=function SourceMapConsumer_charIsMappingSeparator(aStr,index){var c=aStr.charAt(index);return c===';'||c===','};SourceMapConsumer.prototype._parseMappings=function SourceMapConsumer_parseMappings(aStr,aSourceRoot){throw new Error('Subclasses must implement _parseMappings')};SourceMapConsumer.GENERATED_ORDER=1;SourceMapConsumer.ORIGINAL_ORDER=2;SourceMapConsumer.GREATEST_LOWER_BOUND=1;SourceMapConsumer.LEAST_UPPER_BOUND=2;SourceMapConsumer.prototype.eachMapping=function SourceMapConsumer_eachMapping(aCallback,aContext,aOrder){var context=aContext||null;var order=aOrder||SourceMapConsumer.GENERATED_ORDER;var mappings;switch(order){case SourceMapConsumer.GENERATED_ORDER:mappings=this._generatedMappings;break;case SourceMapConsumer.ORIGINAL_ORDER:mappings=this._originalMappings;break;default:throw new Error('Unknown order of iteration.')}var sourceRoot=this.sourceRoot;mappings.map(function(mapping){var source=mapping.source===null?null:this._sources.at(mapping.source);if(source!=null&&sourceRoot!=null){source=util.join(sourceRoot,source)}return{source:source,generatedLine:mapping.generatedLine,generatedColumn:mapping.generatedColumn,originalLine:mapping.originalLine,originalColumn:mapping.originalColumn,name:mapping.name===null?null:this._names.at(mapping.name)}},this).forEach(aCallback,context)};SourceMapConsumer.prototype.allGeneratedPositionsFor=function SourceMapConsumer_allGeneratedPositionsFor(aArgs){var line=util.getArg(aArgs,'line');var needle={source:util.getArg(aArgs,'source'),originalLine:line,originalColumn:util.getArg(aArgs,'column',0)};if(this.sourceRoot!=null){needle.source=util.relative(this.sourceRoot,needle.source)}if(!this._sources.has(needle.source)){return[]}needle.source=this._sources.indexOf(needle.source);var mappings=[];var index=this._findMapping(needle,this._originalMappings,'originalLine','originalColumn',util.compareByOriginalPositions,binarySearch.LEAST_UPPER_BOUND);if(index>=0){var mapping=this._originalMappings[index];if(aArgs.column===undefined){var originalLine=mapping.originalLine;while(mapping&&mapping.originalLine===originalLine){mappings.push({line:util.getArg(mapping,'generatedLine',null),column:util.getArg(mapping,'generatedColumn',null),lastColumn:util.getArg(mapping,'lastGeneratedColumn',null)});mapping=this._originalMappings[++index]}}else{var originalColumn=mapping.originalColumn;while(mapping&&mapping.originalLine===line&&mapping.originalColumn==originalColumn){mappings.push({line:util.getArg(mapping,'generatedLine',null),column:util.getArg(mapping,'generatedColumn',null),lastColumn:util.getArg(mapping,'lastGeneratedColumn',null)});mapping=this._originalMappings[++index]}}}return mappings};exports.SourceMapConsumer=SourceMapConsumer;function BasicSourceMapConsumer(aSourceMap){var sourceMap=aSourceMap;if(typeof aSourceMap==='string'){sourceMap=JSON.parse(aSourceMap.replace(/^\)\]\}'/,''))}var version=util.getArg(sourceMap,'version');var sources=util.getArg(sourceMap,'sources');var names=util.getArg(sourceMap,'names',[]);var sourceRoot=util.getArg(sourceMap,'sourceRoot',null);var sourcesContent=util.getArg(sourceMap,'sourcesContent',null);var mappings=util.getArg(sourceMap,'mappings');var file=util.getArg(sourceMap,'file',null);if(version!=this._version){throw new Error('Unsupported version: '+version)}sources=sources.map(String).map(util.normalize).map(function(source){return sourceRoot&&util.isAbsolute(sourceRoot)&&util.isAbsolute(source)?util.relative(sourceRoot,source):source});this._names=ArraySet.fromArray(names.map(String),true);this._sources=ArraySet.fromArray(sources,true);this.sourceRoot=sourceRoot;this.sourcesContent=sourcesContent;this._mappings=mappings;this.file=file}BasicSourceMapConsumer.prototype=Object.create(SourceMapConsumer.prototype);BasicSourceMapConsumer.prototype.consumer=SourceMapConsumer;BasicSourceMapConsumer.fromSourceMap=function SourceMapConsumer_fromSourceMap(aSourceMap){var smc=Object.create(BasicSourceMapConsumer.prototype);var names=smc._names=ArraySet.fromArray(aSourceMap._names.toArray(),true);var sources=smc._sources=ArraySet.fromArray(aSourceMap._sources.toArray(),true);smc.sourceRoot=aSourceMap._sourceRoot;smc.sourcesContent=aSourceMap._generateSourcesContent(smc._sources.toArray(),smc.sourceRoot);smc.file=aSourceMap._file;var generatedMappings=aSourceMap._mappings.toArray().slice();var destGeneratedMappings=smc.__generatedMappings=[];var destOriginalMappings=smc.__originalMappings=[];for(var i=0,length=generatedMappings.length;i<length;i++){var srcMapping=generatedMappings[i];var destMapping=new Mapping;destMapping.generatedLine=srcMapping.generatedLine;destMapping.generatedColumn=srcMapping.generatedColumn;if(srcMapping.source){destMapping.source=sources.indexOf(srcMapping.source);destMapping.originalLine=srcMapping.originalLine;destMapping.originalColumn=srcMapping.originalColumn;if(srcMapping.name){destMapping.name=names.indexOf(srcMapping.name)}destOriginalMappings.push(destMapping)}destGeneratedMappings.push(destMapping)}quickSort(smc.__originalMappings,util.compareByOriginalPositions);return smc};BasicSourceMapConsumer.prototype._version=3;Object.defineProperty(BasicSourceMapConsumer.prototype,'sources',{get:function(){return this._sources.toArray().map(function(s){return this.sourceRoot!=null?util.join(this.sourceRoot,s):s},this)}});function Mapping(){this.generatedLine=0;this.generatedColumn=0;this.source=null;this.originalLine=null;this.originalColumn=null;this.name=null}BasicSourceMapConsumer.prototype._parseMappings=function SourceMapConsumer_parseMappings(aStr,aSourceRoot){var generatedLine=1;var previousGeneratedColumn=0;var previousOriginalLine=0;var previousOriginalColumn=0;var previousSource=0;var previousName=0;var length=aStr.length;var index=0;var cachedSegments={};var temp={};var originalMappings=[];var generatedMappings=[];var mapping,str,segment,end,value;while(index<length){if(aStr.charAt(index)===';'){generatedLine++;index++;previousGeneratedColumn=0}else if(aStr.charAt(index)===','){index++}else{mapping=new Mapping;mapping.generatedLine=generatedLine;for(end=index;end<length;end++){if(this._charIsMappingSeparator(aStr,end)){break}}str=aStr.slice(index,end);segment=cachedSegments[str];if(segment){index+=str.length}else{segment=[];while(index<end){base64VLQ.decode(aStr,index,temp);value=temp.value;index=temp.rest;segment.push(value)}if(segment.length===2){throw new Error('Found a source, but no line and column')}if(segment.length===3){throw new Error('Found a source and line, but no column')}cachedSegments[str]=segment}mapping.generatedColumn=previousGeneratedColumn+segment[0];previousGeneratedColumn=mapping.generatedColumn;if(segment.length>1){mapping.source=previousSource+segment[1];previousSource+=segment[1];mapping.originalLine=previousOriginalLine+segment[2];previousOriginalLine=mapping.originalLine;mapping.originalLine+=1;mapping.originalColumn=previousOriginalColumn+segment[3];previousOriginalColumn=mapping.originalColumn;if(segment.length>4){mapping.name=previousName+segment[4];previousName+=segment[4]}}generatedMappings.push(mapping);if(typeof mapping.originalLine==='number'){originalMappings.push(mapping)}}}quickSort(generatedMappings,util.compareByGeneratedPositionsDeflated);this.__generatedMappings=generatedMappings;quickSort(originalMappings,util.compareByOriginalPositions);this.__originalMappings=originalMappings};BasicSourceMapConsumer.prototype._findMapping=function SourceMapConsumer_findMapping(aNeedle,aMappings,aLineName,aColumnName,aComparator,aBias){if(aNeedle[aLineName]<=0){throw new TypeError('Line must be greater than or equal to 1, got '+aNeedle[aLineName])}if(aNeedle[aColumnName]<0){throw new TypeError('Column must be greater than or equal to 0, got '+aNeedle[aColumnName])}return binarySearch.search(aNeedle,aMappings,aComparator,aBias)};BasicSourceMapConsumer.prototype.computeColumnSpans=function SourceMapConsumer_computeColumnSpans(){for(var index=0;index<this._generatedMappings.length;++index){var mapping=this._generatedMappings[index];if(index+1<this._generatedMappings.length){var nextMapping=this._generatedMappings[index+1];if(mapping.generatedLine===nextMapping.generatedLine){mapping.lastGeneratedColumn=nextMapping.generatedColumn-1;continue}}mapping.lastGeneratedColumn=Infinity}};BasicSourceMapConsumer.prototype.originalPositionFor=function SourceMapConsumer_originalPositionFor(aArgs){var needle={generatedLine:util.getArg(aArgs,'line'),generatedColumn:util.getArg(aArgs,'column')};var index=this._findMapping(needle,this._generatedMappings,'generatedLine','generatedColumn',util.compareByGeneratedPositionsDeflated,util.getArg(aArgs,'bias',SourceMapConsumer.GREATEST_LOWER_BOUND));if(index>=0){var mapping=this._generatedMappings[index];if(mapping.generatedLine===needle.generatedLine){var source=util.getArg(mapping,'source',null);if(source!==null){source=this._sources.at(source);if(this.sourceRoot!=null){source=util.join(this.sourceRoot,source)}}var name=util.getArg(mapping,'name',null);if(name!==null){name=this._names.at(name)}return{source:source,line:util.getArg(mapping,'originalLine',null),column:util.getArg(mapping,'originalColumn',null),name:name}}}return{source:null,line:null,column:null,name:null}};BasicSourceMapConsumer.prototype.hasContentsOfAllSources=function BasicSourceMapConsumer_hasContentsOfAllSources(){if(!this.sourcesContent){return false}return this.sourcesContent.length>=this._sources.size()&&!this.sourcesContent.some(function(sc){return sc==null})};BasicSourceMapConsumer.prototype.sourceContentFor=function SourceMapConsumer_sourceContentFor(aSource,nullOnMissing){if(!this.sourcesContent){return null}if(this.sourceRoot!=null){aSource=util.relative(this.sourceRoot,aSource)}if(this._sources.has(aSource)){return this.sourcesContent[this._sources.indexOf(aSource)]}var url;if(this.sourceRoot!=null&&(url=util.urlParse(this.sourceRoot))){var fileUriAbsPath=aSource.replace(/^file:\/\//,'');if(url.scheme=='file'&&this._sources.has(fileUriAbsPath)){return this.sourcesContent[this._sources.indexOf(fileUriAbsPath)]}if((!url.path||url.path=='/')&&this._sources.has('/'+aSource)){return this.sourcesContent[this._sources.indexOf('/'+aSource)]}}if(nullOnMissing){return null}else{throw new Error('"'+aSource+'" is not in the SourceMap.')}};BasicSourceMapConsumer.prototype.generatedPositionFor=function SourceMapConsumer_generatedPositionFor(aArgs){var source=util.getArg(aArgs,'source');if(this.sourceRoot!=null){source=util.relative(this.sourceRoot,source)}if(!this._sources.has(source)){return{line:null,column:null,lastColumn:null}}source=this._sources.indexOf(source);var needle={source:source,originalLine:util.getArg(aArgs,'line'),originalColumn:util.getArg(aArgs,'column')};var index=this._findMapping(needle,this._originalMappings,'originalLine','originalColumn',util.compareByOriginalPositions,util.getArg(aArgs,'bias',SourceMapConsumer.GREATEST_LOWER_BOUND));if(index>=0){var mapping=this._originalMappings[index];if(mapping.source===needle.source){return{line:util.getArg(mapping,'generatedLine',null),column:util.getArg(mapping,'generatedColumn',null),lastColumn:util.getArg(mapping,'lastGeneratedColumn',null)}}}return{line:null,column:null,lastColumn:null}};exports.BasicSourceMapConsumer=BasicSourceMapConsumer;function IndexedSourceMapConsumer(aSourceMap){var sourceMap=aSourceMap;if(typeof aSourceMap==='string'){sourceMap=JSON.parse(aSourceMap.replace(/^\)\]\}'/,''))}var version=util.getArg(sourceMap,'version');var sections=util.getArg(sourceMap,'sections');if(version!=this._version){throw new Error('Unsupported version: '+version)}this._sources=new ArraySet;this._names=new ArraySet;var lastOffset={line:-1,column:0};this._sections=sections.map(function(s){if(s.url){throw new Error('Support for url field in sections not implemented.')}var offset=util.getArg(s,'offset');var offsetLine=util.getArg(offset,'line');var offsetColumn=util.getArg(offset,'column');if(offsetLine<lastOffset.line||offsetLine===lastOffset.line&&offsetColumn<lastOffset.column){throw new Error('Section offsets must be ordered and non-overlapping.')}lastOffset=offset;return{generatedOffset:{generatedLine:offsetLine+1,generatedColumn:offsetColumn+1},consumer:new SourceMapConsumer(util.getArg(s,'map'))}})}IndexedSourceMapConsumer.prototype=Object.create(SourceMapConsumer.prototype);IndexedSourceMapConsumer.prototype.constructor=SourceMapConsumer;IndexedSourceMapConsumer.prototype._version=3;Object.defineProperty(IndexedSourceMapConsumer.prototype,'sources',{get:function(){var sources=[];for(var i=0;i<this._sections.length;i++){for(var j=0;j<this._sections[i].consumer.sources.length;j++){sources.push(this._sections[i].consumer.sources[j])}}return sources}});IndexedSourceMapConsumer.prototype.originalPositionFor=function IndexedSourceMapConsumer_originalPositionFor(aArgs){var needle={generatedLine:util.getArg(aArgs,'line'),generatedColumn:util.getArg(aArgs,'column')};var sectionIndex=binarySearch.search(needle,this._sections,function(needle,section){var cmp=needle.generatedLine-section.generatedOffset.generatedLine;if(cmp){return cmp}return needle.generatedColumn-section.generatedOffset.generatedColumn});var section=this._sections[sectionIndex];if(!section){return{source:null,line:null,column:null,name:null}}return section.consumer.originalPositionFor({line:needle.generatedLine-(section.generatedOffset.generatedLine-1),column:needle.generatedColumn-(section.generatedOffset.generatedLine===needle.generatedLine?section.generatedOffset.generatedColumn-1:0),bias:aArgs.bias})};IndexedSourceMapConsumer.prototype.hasContentsOfAllSources=function IndexedSourceMapConsumer_hasContentsOfAllSources(){return this._sections.every(function(s){return s.consumer.hasContentsOfAllSources()})};IndexedSourceMapConsumer.prototype.sourceContentFor=function IndexedSourceMapConsumer_sourceContentFor(aSource,nullOnMissing){for(var i=0;i<this._sections.length;i++){var section=this._sections[i];var content=section.consumer.sourceContentFor(aSource,true);if(content){return content}}if(nullOnMissing){return null}else{throw new Error('"'+aSource+'" is not in the SourceMap.')}};IndexedSourceMapConsumer.prototype.generatedPositionFor=function IndexedSourceMapConsumer_generatedPositionFor(aArgs){for(var i=0;i<this._sections.length;i++){var section=this._sections[i];if(section.consumer.sources.indexOf(util.getArg(aArgs,'source'))===-1){continue}var generatedPosition=section.consumer.generatedPositionFor(aArgs);if(generatedPosition){var ret={line:generatedPosition.line+(section.generatedOffset.generatedLine-1),column:generatedPosition.column+(section.generatedOffset.generatedLine===generatedPosition.line?section.generatedOffset.generatedColumn-1:0)};return ret}}return{line:null,column:null}};IndexedSourceMapConsumer.prototype._parseMappings=function IndexedSourceMapConsumer_parseMappings(aStr,aSourceRoot){this.__generatedMappings=[];this.__originalMappings=[];for(var i=0;i<this._sections.length;i++){var section=this._sections[i];var sectionMappings=section.consumer._generatedMappings;for(var j=0;j<sectionMappings.length;j++){var mapping=sectionMappings[j];var source=section.consumer._sources.at(mapping.source);if(section.consumer.sourceRoot!==null){source=util.join(section.consumer.sourceRoot,source)}this._sources.add(source);source=this._sources.indexOf(source);var name=section.consumer._names.at(mapping.name);this._names.add(name);name=this._names.indexOf(name);var adjustedMapping={source:source,generatedLine:mapping.generatedLine+(section.generatedOffset.generatedLine-1),generatedColumn:mapping.generatedColumn+(section.generatedOffset.generatedLine===mapping.generatedLine?section.generatedOffset.generatedColumn-1:0),originalLine:mapping.originalLine,originalColumn:mapping.originalColumn,name:name};this.__generatedMappings.push(adjustedMapping);if(typeof adjustedMapping.originalLine==='number'){this.__originalMappings.push(adjustedMapping)}}}quickSort(this.__generatedMappings,util.compareByGeneratedPositionsDeflated);quickSort(this.__originalMappings,util.compareByOriginalPositions)};exports.IndexedSourceMapConsumer=IndexedSourceMapConsumer;return module.exports});System.registerDynamic('node_modules/source-map/lib/base64.js',[],true,function($__require,exports,module){var define,global=this||self,GLOBAL=global;var intToCharMap='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/'.split('');exports.encode=function(number){if(0<=number&&number<intToCharMap.length){return intToCharMap[number]}throw new TypeError('Must be between 0 and 63: '+number)};exports.decode=function(charCode){var bigA=65;var bigZ=90;var littleA=97;var littleZ=122;var zero=48;var nine=57;var plus=43;var slash=47;var littleOffset=26;var numberOffset=52;if(bigA<=charCode&&charCode<=bigZ){return charCode-bigA}if(littleA<=charCode&&charCode<=littleZ){return charCode-littleA+littleOffset}if(zero<=charCode&&charCode<=nine){return charCode-zero+numberOffset}if(charCode==plus){return 62}if(charCode==slash){return 63}return-1};return module.exports});System.registerDynamic('node_modules/source-map/lib/base64-vlq.js',['node_modules/source-map/lib/base64.js'],true,function($__require,exports,module){var define,global=this||self,GLOBAL=global;var base64=$__require('node_modules/source-map/lib/base64.js');var VLQ_BASE_SHIFT=5;var VLQ_BASE=1<<VLQ_BASE_SHIFT;var VLQ_BASE_MASK=VLQ_BASE-1;var VLQ_CONTINUATION_BIT=VLQ_BASE;function toVLQSigned(aValue){return aValue<0?(-aValue<<1)+1:(aValue<<1)+0}function fromVLQSigned(aValue){var isNegative=(aValue&1)===1;var shifted=aValue>>1;return isNegative?-shifted:shifted}exports.encode=function base64VLQ_encode(aValue){var encoded='';var digit;var vlq=toVLQSigned(aValue);do{digit=vlq&VLQ_BASE_MASK;vlq>>>=VLQ_BASE_SHIFT;if(vlq>0){digit|=VLQ_CONTINUATION_BIT}encoded+=base64.encode(digit)}while(vlq>0);return encoded};exports.decode=function base64VLQ_decode(aStr,aIndex,aOutParam){var strLen=aStr.length;var result=0;var shift=0;var continuation,digit;do{if(aIndex>=strLen){throw new Error('Expected more digits in base 64 VLQ value.')}digit=base64.decode(aStr.charCodeAt(aIndex++));if(digit===-1){throw new Error('Invalid base64 digit: '+aStr.charAt(aIndex-1))}continuation=!!(digit&VLQ_CONTINUATION_BIT);digit&=VLQ_BASE_MASK;result=result+(digit<<shift);shift+=VLQ_BASE_SHIFT}while(continuation);aOutParam.value=fromVLQSigned(result);aOutParam.rest=aIndex};return module.exports});System.registerDynamic('node_modules/source-map/lib/array-set.js',['node_modules/source-map/lib/util.js'],true,function($__require,exports,module){var define,global=this||self,GLOBAL=global;var util=$__require('node_modules/source-map/lib/util.js');var has=Object.prototype.hasOwnProperty;function ArraySet(){this._array=[];this._set=Object.create(null)}ArraySet.fromArray=function ArraySet_fromArray(aArray,aAllowDuplicates){var set=new ArraySet;for(var i=0,len=aArray.length;i<len;i++){set.add(aArray[i],aAllowDuplicates)}return set};ArraySet.prototype.size=function ArraySet_size(){return Object.getOwnPropertyNames(this._set).length};ArraySet.prototype.add=function ArraySet_add(aStr,aAllowDuplicates){var sStr=util.toSetString(aStr);var isDuplicate=has.call(this._set,sStr);var idx=this._array.length;if(!isDuplicate||aAllowDuplicates){this._array.push(aStr)}if(!isDuplicate){this._set[sStr]=idx}};ArraySet.prototype.has=function ArraySet_has(aStr){var sStr=util.toSetString(aStr);return has.call(this._set,sStr)};ArraySet.prototype.indexOf=function ArraySet_indexOf(aStr){var sStr=util.toSetString(aStr);if(has.call(this._set,sStr)){return this._set[sStr]}throw new Error('"'+aStr+'" is not in the set.')};ArraySet.prototype.at=function ArraySet_at(aIdx){if(aIdx>=0&&aIdx<this._array.length){return this._array[aIdx]}throw new Error('No element indexed by '+aIdx)};ArraySet.prototype.toArray=function ArraySet_toArray(){return this._array.slice()};exports.ArraySet=ArraySet;return module.exports});System.registerDynamic('node_modules/source-map/lib/mapping-list.js',['node_modules/source-map/lib/util.js'],true,function($__require,exports,module){var define,global=this||self,GLOBAL=global;var util=$__require('node_modules/source-map/lib/util.js');function generatedPositionAfter(mappingA,mappingB){var lineA=mappingA.generatedLine;var lineB=mappingB.generatedLine;var columnA=mappingA.generatedColumn;var columnB=mappingB.generatedColumn;return lineB>lineA||lineB==lineA&&columnB>=columnA||util.compareByGeneratedPositionsInflated(mappingA,mappingB)<=0}function MappingList(){this._array=[];this._sorted=true;this._last={generatedLine:-1,generatedColumn:0}}MappingList.prototype.unsortedForEach=function MappingList_forEach(aCallback,aThisArg){this._array.forEach(aCallback,aThisArg)};MappingList.prototype.add=function MappingList_add(aMapping){if(generatedPositionAfter(this._last,aMapping)){this._last=aMapping;this._array.push(aMapping)}else{this._sorted=false;this._array.push(aMapping)}};MappingList.prototype.toArray=function MappingList_toArray(){if(!this._sorted){this._array.sort(util.compareByGeneratedPositionsInflated);this._sorted=true}return this._array};exports.MappingList=MappingList;return module.exports});System.registerDynamic('node_modules/source-map/lib/source-map-generator.js',['node_modules/source-map/lib/base64-vlq.js','node_modules/source-map/lib/util.js','node_modules/source-map/lib/array-set.js','node_modules/source-map/lib/mapping-list.js'],true,function($__require,exports,module){var define,global=this||self,GLOBAL=global;var base64VLQ=$__require('node_modules/source-map/lib/base64-vlq.js');var util=$__require('node_modules/source-map/lib/util.js');var ArraySet=$__require('node_modules/source-map/lib/array-set.js').ArraySet;var MappingList=$__require('node_modules/source-map/lib/mapping-list.js').MappingList;function SourceMapGenerator(aArgs){if(!aArgs){aArgs={}}this._file=util.getArg(aArgs,'file',null);this._sourceRoot=util.getArg(aArgs,'sourceRoot',null);this._skipValidation=util.getArg(aArgs,'skipValidation',false);this._sources=new ArraySet;this._names=new ArraySet;this._mappings=new MappingList;this._sourcesContents=null}SourceMapGenerator.prototype._version=3;SourceMapGenerator.fromSourceMap=function SourceMapGenerator_fromSourceMap(aSourceMapConsumer){var sourceRoot=aSourceMapConsumer.sourceRoot;var generator=new SourceMapGenerator({file:aSourceMapConsumer.file,sourceRoot:sourceRoot});aSourceMapConsumer.eachMapping(function(mapping){var newMapping={generated:{line:mapping.generatedLine,column:mapping.generatedColumn}};if(mapping.source!=null){newMapping.source=mapping.source;if(sourceRoot!=null){newMapping.source=util.relative(sourceRoot,newMapping.source)}newMapping.original={line:mapping.originalLine,column:mapping.originalColumn};if(mapping.name!=null){newMapping.name=mapping.name}}generator.addMapping(newMapping)});aSourceMapConsumer.sources.forEach(function(sourceFile){var content=aSourceMapConsumer.sourceContentFor(sourceFile);if(content!=null){generator.setSourceContent(sourceFile,content)}});return generator};SourceMapGenerator.prototype.addMapping=function SourceMapGenerator_addMapping(aArgs){var generated=util.getArg(aArgs,'generated');var original=util.getArg(aArgs,'original',null);var source=util.getArg(aArgs,'source',null);var name=util.getArg(aArgs,'name',null);if(!this._skipValidation){this._validateMapping(generated,original,source,name)}if(source!=null){source=String(source);if(!this._sources.has(source)){this._sources.add(source)}}if(name!=null){name=String(name);if(!this._names.has(name)){this._names.add(name)}}this._mappings.add({generatedLine:generated.line,generatedColumn:generated.column,originalLine:original!=null&&original.line,originalColumn:original!=null&&original.column,source:source,name:name})};SourceMapGenerator.prototype.setSourceContent=function SourceMapGenerator_setSourceContent(aSourceFile,aSourceContent){var source=aSourceFile;if(this._sourceRoot!=null){source=util.relative(this._sourceRoot,source)}if(aSourceContent!=null){if(!this._sourcesContents){this._sourcesContents=Object.create(null)}this._sourcesContents[util.toSetString(source)]=aSourceContent}else if(this._sourcesContents){delete this._sourcesContents[util.toSetString(source)];if(Object.keys(this._sourcesContents).length===0){this._sourcesContents=null}}};SourceMapGenerator.prototype.applySourceMap=function SourceMapGenerator_applySourceMap(aSourceMapConsumer,aSourceFile,aSourceMapPath){var sourceFile=aSourceFile;if(aSourceFile==null){if(aSourceMapConsumer.file==null){throw new Error('SourceMapGenerator.prototype.applySourceMap requires either an explicit source file, '+'or the source map\'s "file" property. Both were omitted.')}sourceFile=aSourceMapConsumer.file}var sourceRoot=this._sourceRoot;if(sourceRoot!=null){sourceFile=util.relative(sourceRoot,sourceFile)}var newSources=new ArraySet;var newNames=new ArraySet;this._mappings.unsortedForEach(function(mapping){if(mapping.source===sourceFile&&mapping.originalLine!=null){var original=aSourceMapConsumer.originalPositionFor({line:mapping.originalLine,column:mapping.originalColumn});if(original.source!=null){mapping.source=original.source;if(aSourceMapPath!=null){mapping.source=util.join(aSourceMapPath,mapping.source)}if(sourceRoot!=null){mapping.source=util.relative(sourceRoot,mapping.source)}mapping.originalLine=original.line;mapping.originalColumn=original.column;if(original.name!=null){mapping.name=original.name}}}var source=mapping.source;if(source!=null&&!newSources.has(source)){newSources.add(source)}var name=mapping.name;if(name!=null&&!newNames.has(name)){newNames.add(name)}},this);this._sources=newSources;this._names=newNames;aSourceMapConsumer.sources.forEach(function(sourceFile){var content=aSourceMapConsumer.sourceContentFor(sourceFile);if(content!=null){if(aSourceMapPath!=null){sourceFile=util.join(aSourceMapPath,sourceFile)}if(sourceRoot!=null){sourceFile=util.relative(sourceRoot,sourceFile)}this.setSourceContent(sourceFile,content)}},this)};SourceMapGenerator.prototype._validateMapping=function SourceMapGenerator_validateMapping(aGenerated,aOriginal,aSource,aName){if(aGenerated&&'line'in aGenerated&&'column'in aGenerated&&aGenerated.line>0&&aGenerated.column>=0&&!aOriginal&&!aSource&&!aName){return}else if(aGenerated&&'line'in aGenerated&&'column'in aGenerated&&aOriginal&&'line'in aOriginal&&'column'in aOriginal&&aGenerated.line>0&&aGenerated.column>=0&&aOriginal.line>0&&aOriginal.column>=0&&aSource){return}else{throw new Error('Invalid mapping: '+JSON.stringify({generated:aGenerated,source:aSource,original:aOriginal,name:aName}))}};SourceMapGenerator.prototype._serializeMappings=function SourceMapGenerator_serializeMappings(){var previousGeneratedColumn=0;var previousGeneratedLine=1;var previousOriginalColumn=0;var previousOriginalLine=0;var previousName=0;var previousSource=0;var result='';var next;var mapping;var nameIdx;var sourceIdx;var mappings=this._mappings.toArray();for(var i=0,len=mappings.length;i<len;i++){mapping=mappings[i];next='';if(mapping.generatedLine!==previousGeneratedLine){previousGeneratedColumn=0;while(mapping.generatedLine!==previousGeneratedLine){next+=';';previousGeneratedLine++}}else{if(i>0){if(!util.compareByGeneratedPositionsInflated(mapping,mappings[i-1])){continue}next+=','}}next+=base64VLQ.encode(mapping.generatedColumn-previousGeneratedColumn);previousGeneratedColumn=mapping.generatedColumn;if(mapping.source!=null){sourceIdx=this._sources.indexOf(mapping.source);next+=base64VLQ.encode(sourceIdx-previousSource);previousSource=sourceIdx;next+=base64VLQ.encode(mapping.originalLine-1-previousOriginalLine);previousOriginalLine=mapping.originalLine-1;next+=base64VLQ.encode(mapping.originalColumn-previousOriginalColumn);previousOriginalColumn=mapping.originalColumn;if(mapping.name!=null){nameIdx=this._names.indexOf(mapping.name);next+=base64VLQ.encode(nameIdx-previousName);previousName=nameIdx}}result+=next}return result};SourceMapGenerator.prototype._generateSourcesContent=function SourceMapGenerator_generateSourcesContent(aSources,aSourceRoot){return aSources.map(function(source){if(!this._sourcesContents){return null}if(aSourceRoot!=null){source=util.relative(aSourceRoot,source)}var key=util.toSetString(source);return Object.prototype.hasOwnProperty.call(this._sourcesContents,key)?this._sourcesContents[key]:null},this)};SourceMapGenerator.prototype.toJSON=function SourceMapGenerator_toJSON(){var map={version:this._version,sources:this._sources.toArray(),names:this._names.toArray(),mappings:this._serializeMappings()};if(this._file!=null){map.file=this._file}if(this._sourceRoot!=null){map.sourceRoot=this._sourceRoot}if(this._sourcesContents){map.sourcesContent=this._generateSourcesContent(map.sources,map.sourceRoot)}return map};SourceMapGenerator.prototype.toString=function SourceMapGenerator_toString(){return JSON.stringify(this.toJSON())};exports.SourceMapGenerator=SourceMapGenerator;return module.exports});System.registerDynamic('node_modules/source-map/lib/util.js',[],true,function($__require,exports,module){var define,global=this||self,GLOBAL=global;function getArg(aArgs,aName,aDefaultValue){if(aName in aArgs){return aArgs[aName]}else if(arguments.length===3){return aDefaultValue}else{throw new Error('"'+aName+'" is a required argument.')}}exports.getArg=getArg;var urlRegexp=/^(?:([\w+\-.]+):)?\/\/(?:(\w+:\w+)@)?([\w.]*)(?::(\d+))?(\S*)$/;var dataUrlRegexp=/^data:.+\,.+$/;function urlParse(aUrl){var match=aUrl.match(urlRegexp);if(!match){return null}return{scheme:match[1],auth:match[2],host:match[3],port:match[4],path:match[5]}}exports.urlParse=urlParse;function urlGenerate(aParsedUrl){var url='';if(aParsedUrl.scheme){url+=aParsedUrl.scheme+':'}url+='//';if(aParsedUrl.auth){url+=aParsedUrl.auth+'@'}if(aParsedUrl.host){url+=aParsedUrl.host}if(aParsedUrl.port){url+=':'+aParsedUrl.port}if(aParsedUrl.path){url+=aParsedUrl.path}return url}exports.urlGenerate=urlGenerate;function normalize(aPath){var path=aPath;var url=urlParse(aPath);if(url){if(!url.path){return aPath}path=url.path}var isAbsolute=exports.isAbsolute(path);var parts=path.split(/\/+/);for(var part,up=0,i=parts.length-1;i>=0;i--){part=parts[i];if(part==='.'){parts.splice(i,1)}else if(part==='..'){up++}else if(up>0){if(part===''){parts.splice(i+1,up);up=0}else{parts.splice(i,2);up--}}}path=parts.join('/');if(path===''){path=isAbsolute?'/':'.'}if(url){url.path=path;return urlGenerate(url)}return path}exports.normalize=normalize;function join(aRoot,aPath){if(aRoot===''){aRoot='.'}if(aPath===''){aPath='.'}var aPathUrl=urlParse(aPath);var aRootUrl=urlParse(aRoot);if(aRootUrl){aRoot=aRootUrl.path||'/'}if(aPathUrl&&!aPathUrl.scheme){if(aRootUrl){aPathUrl.scheme=aRootUrl.scheme}return urlGenerate(aPathUrl)}if(aPathUrl||aPath.match(dataUrlRegexp)){return aPath}if(aRootUrl&&!aRootUrl.host&&!aRootUrl.path){aRootUrl.host=aPath;return urlGenerate(aRootUrl)}var joined=aPath.charAt(0)==='/'?aPath:normalize(aRoot.replace(/\/+$/,'')+'/'+aPath);if(aRootUrl){aRootUrl.path=joined;return urlGenerate(aRootUrl)}return joined}exports.join=join;exports.isAbsolute=function(aPath){return aPath.charAt(0)==='/'||!!aPath.match(urlRegexp)};function relative(aRoot,aPath){if(aRoot===''){aRoot='.'}aRoot=aRoot.replace(/\/$/,'');var level=0;while(aPath.indexOf(aRoot+'/')!==0){var index=aRoot.lastIndexOf('/');if(index<0){return aPath}aRoot=aRoot.slice(0,index);if(aRoot.match(/^([^\/]+:\/)?\/*$/)){return aPath}++level}return Array(level+1).join('../')+aPath.substr(aRoot.length+1)}exports.relative=relative;var supportsNullProto=function(){var obj=Object.create(null);return!('__proto__'in obj)}();function identity(s){return s}function toSetString(aStr){if(isProtoString(aStr)){return'$'+aStr}return aStr}exports.toSetString=supportsNullProto?identity:toSetString;function fromSetString(aStr){if(isProtoString(aStr)){return aStr.slice(1)}return aStr}exports.fromSetString=supportsNullProto?identity:fromSetString;function isProtoString(s){if(!s){return false}var length=s.length;if(length<9){return false}if(s.charCodeAt(length-1)!==95||s.charCodeAt(length-2)!==95||s.charCodeAt(length-3)!==111||s.charCodeAt(length-4)!==116||s.charCodeAt(length-5)!==111||s.charCodeAt(length-6)!==114||s.charCodeAt(length-7)!==112||s.charCodeAt(length-8)!==95||s.charCodeAt(length-9)!==95){return false}for(var i=length-10;i>=0;i--){if(s.charCodeAt(i)!==36){return false}}return true}function compareByOriginalPositions(mappingA,mappingB,onlyCompareOriginal){var cmp=mappingA.source-mappingB.source;if(cmp!==0){return cmp}cmp=mappingA.originalLine-mappingB.originalLine;if(cmp!==0){return cmp}cmp=mappingA.originalColumn-mappingB.originalColumn;if(cmp!==0||onlyCompareOriginal){return cmp}cmp=mappingA.generatedColumn-mappingB.generatedColumn;if(cmp!==0){return cmp}cmp=mappingA.generatedLine-mappingB.generatedLine;if(cmp!==0){return cmp}return mappingA.name-mappingB.name}exports.compareByOriginalPositions=compareByOriginalPositions;function compareByGeneratedPositionsDeflated(mappingA,mappingB,onlyCompareGenerated){var cmp=mappingA.generatedLine-mappingB.generatedLine;if(cmp!==0){return cmp}cmp=mappingA.generatedColumn-mappingB.generatedColumn;if(cmp!==0||onlyCompareGenerated){return cmp}cmp=mappingA.source-mappingB.source;if(cmp!==0){return cmp}cmp=mappingA.originalLine-mappingB.originalLine;if(cmp!==0){return cmp}cmp=mappingA.originalColumn-mappingB.originalColumn;if(cmp!==0){return cmp}return mappingA.name-mappingB.name}exports.compareByGeneratedPositionsDeflated=compareByGeneratedPositionsDeflated;function strcmp(aStr1,aStr2){if(aStr1===aStr2){return 0}if(aStr1>aStr2){return 1}return-1}function compareByGeneratedPositionsInflated(mappingA,mappingB){var cmp=mappingA.generatedLine-mappingB.generatedLine;if(cmp!==0){return cmp}cmp=mappingA.generatedColumn-mappingB.generatedColumn;if(cmp!==0){return cmp}cmp=strcmp(mappingA.source,mappingB.source);if(cmp!==0){return cmp}cmp=mappingA.originalLine-mappingB.originalLine;if(cmp!==0){return cmp}cmp=mappingA.originalColumn-mappingB.originalColumn;if(cmp!==0){return cmp}return strcmp(mappingA.name,mappingB.name)}exports.compareByGeneratedPositionsInflated=compareByGeneratedPositionsInflated;return module.exports});System.registerDynamic('node_modules/source-map/lib/source-node.js',['node_modules/source-map/lib/source-map-generator.js','node_modules/source-map/lib/util.js'],true,function($__require,exports,module){var define,global=this||self,GLOBAL=global;var SourceMapGenerator=$__require('node_modules/source-map/lib/source-map-generator.js').SourceMapGenerator;var util=$__require('node_modules/source-map/lib/util.js');var REGEX_NEWLINE=/(\r?\n)/;var NEWLINE_CODE=10;var isSourceNode='$$$isSourceNode$$$';function SourceNode(aLine,aColumn,aSource,aChunks,aName){this.children=[];this.sourceContents={};this.line=aLine==null?null:aLine;this.column=aColumn==null?null:aColumn;this.source=aSource==null?null:aSource;this.name=aName==null?null:aName;this[isSourceNode]=true;if(aChunks!=null)this.add(aChunks)}SourceNode.fromStringWithSourceMap=function SourceNode_fromStringWithSourceMap(aGeneratedCode,aSourceMapConsumer,aRelativePath){var node=new SourceNode;var remainingLines=aGeneratedCode.split(REGEX_NEWLINE);var shiftNextLine=function(){var lineContents=remainingLines.shift();var newLine=remainingLines.shift()||'';return lineContents+newLine};var lastGeneratedLine=1,lastGeneratedColumn=0;var lastMapping=null;aSourceMapConsumer.eachMapping(function(mapping){if(lastMapping!==null){if(lastGeneratedLine<mapping.generatedLine){addMappingWithCode(lastMapping,shiftNextLine());lastGeneratedLine++;lastGeneratedColumn=0}else{var nextLine=remainingLines[0];var code=nextLine.substr(0,mapping.generatedColumn-lastGeneratedColumn);remainingLines[0]=nextLine.substr(mapping.generatedColumn-lastGeneratedColumn);lastGeneratedColumn=mapping.generatedColumn;addMappingWithCode(lastMapping,code);lastMapping=mapping;return}}while(lastGeneratedLine<mapping.generatedLine){node.add(shiftNextLine());lastGeneratedLine++}if(lastGeneratedColumn<mapping.generatedColumn){var nextLine=remainingLines[0];node.add(nextLine.substr(0,mapping.generatedColumn));remainingLines[0]=nextLine.substr(mapping.generatedColumn);lastGeneratedColumn=mapping.generatedColumn}lastMapping=mapping},this);if(remainingLines.length>0){if(lastMapping){addMappingWithCode(lastMapping,shiftNextLine())}node.add(remainingLines.join(''))}aSourceMapConsumer.sources.forEach(function(sourceFile){var content=aSourceMapConsumer.sourceContentFor(sourceFile);if(content!=null){if(aRelativePath!=null){sourceFile=util.join(aRelativePath,sourceFile)}node.setSourceContent(sourceFile,content)}});return node;function addMappingWithCode(mapping,code){if(mapping===null||mapping.source===undefined){node.add(code)}else{var source=aRelativePath?util.join(aRelativePath,mapping.source):mapping.source;node.add(new SourceNode(mapping.originalLine,mapping.originalColumn,source,code,mapping.name))}}};SourceNode.prototype.add=function SourceNode_add(aChunk){if(Array.isArray(aChunk)){aChunk.forEach(function(chunk){this.add(chunk)},this)}else if(aChunk[isSourceNode]||typeof aChunk==='string'){if(aChunk){this.children.push(aChunk)}}else{throw new TypeError('Expected a SourceNode, string, or an array of SourceNodes and strings. Got '+aChunk)}return this};SourceNode.prototype.prepend=function SourceNode_prepend(aChunk){if(Array.isArray(aChunk)){for(var i=aChunk.length-1;i>=0;i--){this.prepend(aChunk[i])}}else if(aChunk[isSourceNode]||typeof aChunk==='string'){this.children.unshift(aChunk)}else{throw new TypeError('Expected a SourceNode, string, or an array of SourceNodes and strings. Got '+aChunk)}return this};SourceNode.prototype.walk=function SourceNode_walk(aFn){var chunk;for(var i=0,len=this.children.length;i<len;i++){chunk=this.children[i];if(chunk[isSourceNode]){chunk.walk(aFn)}else{if(chunk!==''){aFn(chunk,{source:this.source,line:this.line,column:this.column,name:this.name})}}}};SourceNode.prototype.join=function SourceNode_join(aSep){var newChildren;var i;var len=this.children.length;if(len>0){newChildren=[];for(i=0;i<len-1;i++){newChildren.push(this.children[i]);newChildren.push(aSep)}newChildren.push(this.children[i]);this.children=newChildren}return this};SourceNode.prototype.replaceRight=function SourceNode_replaceRight(aPattern,aReplacement){var lastChild=this.children[this.children.length-1];if(lastChild[isSourceNode]){lastChild.replaceRight(aPattern,aReplacement)}else if(typeof lastChild==='string'){this.children[this.children.length-1]=lastChild.replace(aPattern,aReplacement)}else{this.children.push(''.replace(aPattern,aReplacement))}return this};SourceNode.prototype.setSourceContent=function SourceNode_setSourceContent(aSourceFile,aSourceContent){this.sourceContents[util.toSetString(aSourceFile)]=aSourceContent};SourceNode.prototype.walkSourceContents=function SourceNode_walkSourceContents(aFn){for(var i=0,len=this.children.length;i<len;i++){if(this.children[i][isSourceNode]){this.children[i].walkSourceContents(aFn)}}var sources=Object.keys(this.sourceContents);for(var i=0,len=sources.length;i<len;i++){aFn(util.fromSetString(sources[i]),this.sourceContents[sources[i]])}};SourceNode.prototype.toString=function SourceNode_toString(){var str='';this.walk(function(chunk){str+=chunk});return str};SourceNode.prototype.toStringWithSourceMap=function SourceNode_toStringWithSourceMap(aArgs){var generated={code:'',line:1,column:0};var map=new SourceMapGenerator(aArgs);var sourceMappingActive=false;var lastOriginalSource=null;var lastOriginalLine=null;var lastOriginalColumn=null;var lastOriginalName=null;this.walk(function(chunk,original){generated.code+=chunk;if(original.source!==null&&original.line!==null&&original.column!==null){if(lastOriginalSource!==original.source||lastOriginalLine!==original.line||lastOriginalColumn!==original.column||lastOriginalName!==original.name){map.addMapping({source:original.source,original:{line:original.line,column:original.column},generated:{line:generated.line,column:generated.column},name:original.name})}lastOriginalSource=original.source;lastOriginalLine=original.line;lastOriginalColumn=original.column;lastOriginalName=original.name;sourceMappingActive=true}else if(sourceMappingActive){map.addMapping({generated:{line:generated.line,column:generated.column}});lastOriginalSource=null;sourceMappingActive=false}for(var idx=0,length=chunk.length;idx<length;idx++){if(chunk.charCodeAt(idx)===NEWLINE_CODE){generated.line++;generated.column=0;if(idx+1===length){lastOriginalSource=null;sourceMappingActive=false}else if(sourceMappingActive){map.addMapping({source:original.source,original:{line:original.line,column:original.column},generated:{line:generated.line,column:generated.column},name:original.name})}}else{generated.column++}}});this.walkSourceContents(function(sourceFile,sourceContent){map.setSourceContent(sourceFile,sourceContent)});return{code:generated.code,map:map}};exports.SourceNode=SourceNode;return module.exports});System.registerDynamic('node_modules/source-map/source-map.js',['node_modules/source-map/lib/source-map-generator.js','node_modules/source-map/lib/source-map-consumer.js','node_modules/source-map/lib/source-node.js'],true,function($__require,exports,module){var define,global=this||self,GLOBAL=global;exports.SourceMapGenerator=$__require('node_modules/source-map/lib/source-map-generator.js').SourceMapGenerator;exports.SourceMapConsumer=$__require('node_modules/source-map/lib/source-map-consumer.js').SourceMapConsumer;exports.SourceNode=$__require('node_modules/source-map/lib/source-node.js').SourceNode;return module.exports});(function(){var define=System.amdDefine;(function(root,factory){'use strict';if(typeof define==='function'&&define.amd){define('node_modules/stacktrace-gps/stacktrace-gps.js',['node_modules/source-map/source-map.js','node_modules/stackframe/stackframe.js'],factory)&&define('stacktrace-gps',['node_modules/stacktrace-gps/stacktrace-gps.js'],function(m){return m})}else if(typeof exports==='object'){module.exports=factory(require('source-map/lib/source-map-consumer'),require('stackframe'))}else{root.StackTraceGPS=factory(root.SourceMap||root.sourceMap,root.StackFrame)}}(this,function(SourceMap,StackFrame){'use strict';function _xdr(url){return new Promise(function(resolve,reject){var req=new XMLHttpRequest;req.open('get',url);req.onerror=reject;req.onreadystatechange=function onreadystatechange(){if(req.readyState===4){if(req.status>=200&&req.status<300||url.substr(0,7)==='file://'&&req.responseText){resolve(req.responseText)}else{reject(new Error('HTTP status: '+req.status+' retrieving '+url))}}};req.send()})}function _atob(b64str){if(typeof window!=='undefined'&&window.atob){return window.atob(b64str)}else{throw new Error('You must supply a polyfill for window.atob in this environment')}}function _parseJson(string){if(typeof JSON!=='undefined'&&JSON.parse){return JSON.parse(string)}else{throw new Error('You must supply a polyfill for JSON.parse in this environment')}}function _findFunctionName(source,lineNumber){var syntaxes=[/['"]?([$_A-Za-z][$_A-Za-z0-9]*)['"]?\s*[:=]\s*function\b/,/function\s+([^('"`]*?)\s*\(([^)]*)\)/,/['"]?([$_A-Za-z][$_A-Za-z0-9]*)['"]?\s*[:=]\s*(?:eval|new Function)\b/,/\b(?!(?:if|for|switch|while|with|catch)\b)(?:(?:static)\s+)?(\S+)\s*\(.*?\)\s*\{/,/['"]?([$_A-Za-z][$_A-Za-z0-9]*)['"]?\s*[:=]\s*\(.*?\)\s*=>/];var lines=source.split('\n');var code='';var maxLines=Math.min(lineNumber,20);for(var i=0;i<maxLines;++i){var line=lines[lineNumber-i-1];var commentPos=line.indexOf('//');if(commentPos>=0){line=line.substr(0,commentPos)}if(line){code=line+code;var len=syntaxes.length;for(var index=0;index<len;index++){var m=syntaxes[index].exec(code);if(m&&m[1]){return m[1]}}}}return undefined}function _ensureSupportedEnvironment(){if(typeof Object.defineProperty!=='function'||typeof Object.create!=='function'){throw new Error('Unable to consume source maps in older browsers')}}function _ensureStackFrameIsLegit(stackframe){if(typeof stackframe!=='object'){throw new TypeError('Given StackFrame is not an object')}else if(typeof stackframe.fileName!=='string'){throw new TypeError('Given file name is not a String')}else if(typeof stackframe.lineNumber!=='number'||stackframe.lineNumber%1!==0||stackframe.lineNumber<1){throw new TypeError('Given line number must be a positive integer')}else if(typeof stackframe.columnNumber!=='number'||stackframe.columnNumber%1!==0||stackframe.columnNumber<0){throw new TypeError('Given column number must be a non-negative integer')}return true}function _findSourceMappingURL(source){var sourceMappingUrlRegExp=/\/\/[#@] ?sourceMappingURL=([^\s'"]+)\s*$/mg;var lastSourceMappingUrl;var matchSourceMappingUrl;while(matchSourceMappingUrl=sourceMappingUrlRegExp.exec(source)){lastSourceMappingUrl=matchSourceMappingUrl[1]}if(lastSourceMappingUrl){return lastSourceMappingUrl}else{throw new Error('sourceMappingURL not found')}}function _extractLocationInfoFromSourceMapSource(stackframe,sourceMapConsumer,sourceCache){return new Promise(function(resolve,reject){var loc=sourceMapConsumer.originalPositionFor({line:stackframe.lineNumber,column:stackframe.columnNumber});if(loc.source){var mappedSource=sourceMapConsumer.sourceContentFor(loc.source);if(mappedSource){sourceCache[loc.source]=mappedSource}resolve(new StackFrame({functionName:loc.name||stackframe.functionName,args:stackframe.args,fileName:loc.source,lineNumber:loc.line,columnNumber:loc.column}))}else{reject(new Error('Could not get original source for given stackframe and source map'))}})}return function StackTraceGPS(opts){if(!(this instanceof StackTraceGPS)){return new StackTraceGPS(opts)}opts=opts||{};this.sourceCache=opts.sourceCache||{};this.sourceMapConsumerCache=opts.sourceMapConsumerCache||{};this.ajax=opts.ajax||_xdr;this._atob=opts.atob||_atob;this._get=function _get(location){return new Promise(function(resolve,reject){var isDataUrl=location.substr(0,5)==='data:';if(this.sourceCache[location]){resolve(this.sourceCache[location])}else if(opts.offline&&!isDataUrl){reject(new Error('Cannot make network requests in offline mode'))}else{if(isDataUrl){var supportedEncodingRegexp=/^data:application\/json;([\w=:"-]+;)*base64,/;var match=location.match(supportedEncodingRegexp);if(match){var sourceMapStart=match[0].length;var encodedSource=location.substr(sourceMapStart);var source=this._atob(encodedSource);this.sourceCache[location]=source;resolve(source)}else{reject(new Error('The encoding of the inline sourcemap is not supported'))}}else{var xhrPromise=this.ajax(location,{method:'get'});this.sourceCache[location]=xhrPromise;xhrPromise.then(resolve,reject)}}}.bind(this))};this._getSourceMapConsumer=function _getSourceMapConsumer(sourceMappingURL,defaultSourceRoot){return new Promise(function(resolve,reject){if(this.sourceMapConsumerCache[sourceMappingURL]){resolve(this.sourceMapConsumerCache[sourceMappingURL])}else{var sourceMapConsumerPromise=new Promise(function(resolve,reject){return this._get(sourceMappingURL).then(function(sourceMapSource){if(typeof sourceMapSource==='string'){sourceMapSource=_parseJson(sourceMapSource.replace(/^\)\]\}'/,''))}if(typeof sourceMapSource.sourceRoot==='undefined'){sourceMapSource.sourceRoot=defaultSourceRoot}resolve(new SourceMap.SourceMapConsumer(sourceMapSource))},reject)}.bind(this));this.sourceMapConsumerCache[sourceMappingURL]=sourceMapConsumerPromise;resolve(sourceMapConsumerPromise)}}.bind(this))};this.pinpoint=function StackTraceGPS$$pinpoint(stackframe){return new Promise(function(resolve,reject){this.getMappedLocation(stackframe).then(function(mappedStackFrame){function resolveMappedStackFrame(){resolve(mappedStackFrame)}this.findFunctionName(mappedStackFrame).then(resolve,resolveMappedStackFrame)['catch'](resolveMappedStackFrame)}.bind(this),reject)}.bind(this))};this.findFunctionName=function StackTraceGPS$$findFunctionName(stackframe){return new Promise(function(resolve,reject){_ensureStackFrameIsLegit(stackframe);this._get(stackframe.fileName).then(function getSourceCallback(source){var lineNumber=stackframe.lineNumber;var columnNumber=stackframe.columnNumber;var guessedFunctionName=_findFunctionName(source,lineNumber,columnNumber);if(guessedFunctionName){resolve(new StackFrame({functionName:guessedFunctionName,args:stackframe.args,fileName:stackframe.fileName,lineNumber:lineNumber,columnNumber:columnNumber}))}else{resolve(stackframe)}},reject)['catch'](reject)}.bind(this))};this.getMappedLocation=function StackTraceGPS$$getMappedLocation(stackframe){return new Promise(function(resolve,reject){_ensureSupportedEnvironment();_ensureStackFrameIsLegit(stackframe);var sourceCache=this.sourceCache;var fileName=stackframe.fileName;this._get(fileName).then(function(source){var sourceMappingURL=_findSourceMappingURL(source);var isDataUrl=sourceMappingURL.substr(0,5)==='data:';var defaultSourceRoot=fileName.substring(0,fileName.lastIndexOf('/')+1);if(sourceMappingURL[0]!=='/'&&!isDataUrl&&!/^https?:\/\/|^\/\//i.test(sourceMappingURL)){sourceMappingURL=defaultSourceRoot+sourceMappingURL}return this._getSourceMapConsumer(sourceMappingURL,defaultSourceRoot).then(function(sourceMapConsumer){return _extractLocationInfoFromSourceMapSource(stackframe,sourceMapConsumer,sourceCache).then(resolve)['catch'](function(){resolve(stackframe)})})}.bind(this),reject)['catch'](reject)}.bind(this))}}}))}());(function(){var define=System.amdDefine;(function(root,factory){'use strict';if(typeof define==='function'&&define.amd){define('node_modules/stackframe/stackframe.js',[],factory)&&define('stackframe',['node_modules/stackframe/stackframe.js'],function(m){return m})}else if(typeof exports==='object'){module.exports=factory()}else{root.StackFrame=factory()}}(this,function(){'use strict';function _isNumber(n){return!isNaN(parseFloat(n))&&isFinite(n)}function _capitalize(str){return str[0].toUpperCase()+str.substring(1)}function _getter(p){return function(){return this[p]}}var booleanProps=['isConstructor','isEval','isNative','isToplevel'];var numericProps=['columnNumber','lineNumber'];var stringProps=['fileName','functionName','source'];var arrayProps=['args'];var props=booleanProps.concat(numericProps,stringProps,arrayProps);function StackFrame(obj){if(obj instanceof Object){for(var i=0;i<props.length;i++){if(obj.hasOwnProperty(props[i])&&obj[props[i]]!==undefined){this['set'+_capitalize(props[i])](obj[props[i]])}}}}StackFrame.prototype={getArgs:function(){return this.args},setArgs:function(v){if(Object.prototype.toString.call(v)!=='[object Array]'){throw new TypeError('Args must be an Array')}this.args=v},getEvalOrigin:function(){return this.evalOrigin},setEvalOrigin:function(v){if(v instanceof StackFrame){this.evalOrigin=v}else if(v instanceof Object){this.evalOrigin=new StackFrame(v)}else{throw new TypeError('Eval Origin must be an Object or StackFrame')}},toString:function(){var functionName=this.getFunctionName()||'{anonymous}';var args='('+(this.getArgs()||[]).join(',')+')';var fileName=this.getFileName()?'@'+this.getFileName():'';var lineNumber=_isNumber(this.getLineNumber())?':'+this.getLineNumber():'';var columnNumber=_isNumber(this.getColumnNumber())?':'+this.getColumnNumber():'';return functionName+args+fileName+lineNumber+columnNumber}};for(var i=0;i<booleanProps.length;i++){StackFrame.prototype['get'+_capitalize(booleanProps[i])]=_getter(booleanProps[i]);StackFrame.prototype['set'+_capitalize(booleanProps[i])]=function(p){return function(v){this[p]=Boolean(v)}}(booleanProps[i])}for(var j=0;j<numericProps.length;j++){StackFrame.prototype['get'+_capitalize(numericProps[j])]=_getter(numericProps[j]);StackFrame.prototype['set'+_capitalize(numericProps[j])]=function(p){return function(v){if(!_isNumber(v)){throw new TypeError(p+' must be a Number')}this[p]=Number(v)}}(numericProps[j])}for(var k=0;k<stringProps.length;k++){StackFrame.prototype['get'+_capitalize(stringProps[k])]=_getter(stringProps[k]);StackFrame.prototype['set'+_capitalize(stringProps[k])]=function(p){return function(v){this[p]=String(v)}}(stringProps[k])}return StackFrame}))}());(function(){var define=System.amdDefine;(function(root,factory){'use strict';if(typeof define==='function'&&define.amd){define('node_modules/error-stack-parser/error-stack-parser.js',['node_modules/stackframe/stackframe.js'],factory)&&define('error-stack-parser',['node_modules/error-stack-parser/error-stack-parser.js'],function(m){return m})}else if(typeof exports==='object'){module.exports=factory(require('stackframe'))}else{root.ErrorStackParser=factory(root.StackFrame)}}(this,function ErrorStackParser(StackFrame){'use strict';var FIREFOX_SAFARI_STACK_REGEXP=/(^|@)\S+\:\d+/;var CHROME_IE_STACK_REGEXP=/^\s*at .*(\S+\:\d+|\(native\))/m;var SAFARI_NATIVE_CODE_REGEXP=/^(eval@)?(\[native code\])?$/;return{parse:function ErrorStackParser$$parse(error){if(typeof error.stacktrace!=='undefined'||typeof error['opera#sourceloc']!=='undefined'){return this.parseOpera(error)}else if(error.stack&&error.stack.match(CHROME_IE_STACK_REGEXP)){return this.parseV8OrIE(error)}else if(error.stack){return this.parseFFOrSafari(error)}else{throw new Error('Cannot parse given Error object')}},extractLocation:function ErrorStackParser$$extractLocation(urlLike){if(urlLike.indexOf(':')===-1){return[urlLike]}var regExp=/(.+?)(?:\:(\d+))?(?:\:(\d+))?$/;var parts=regExp.exec(urlLike.replace(/[\(\)]/g,''));return[parts[1],parts[2]||undefined,parts[3]||undefined]},parseV8OrIE:function ErrorStackParser$$parseV8OrIE(error){var filtered=error.stack.split('\n').filter(function(line){return!!line.match(CHROME_IE_STACK_REGEXP)},this);return filtered.map(function(line){if(line.indexOf('(eval ')>-1){line=line.replace(/eval code/g,'eval').replace(/(\(eval at [^\()]*)|(\)\,.*$)/g,'')}var tokens=line.replace(/^\s+/,'').replace(/\(eval code/g,'(').split(/\s+/).slice(1);var locationParts=this.extractLocation(tokens.pop());var functionName=tokens.join(' ')||undefined;var fileName=['eval','<anonymous>'].indexOf(locationParts[0])>-1?undefined:locationParts[0];return new StackFrame({functionName:functionName,fileName:fileName,lineNumber:locationParts[1],columnNumber:locationParts[2],source:line})},this)},parseFFOrSafari:function ErrorStackParser$$parseFFOrSafari(error){var filtered=error.stack.split('\n').filter(function(line){return!line.match(SAFARI_NATIVE_CODE_REGEXP)},this);return filtered.map(function(line){if(line.indexOf(' > eval')>-1){line=line.replace(/ line (\d+)(?: > eval line \d+)* > eval\:\d+\:\d+/g,':$1')}if(line.indexOf('@')===-1&&line.indexOf(':')===-1){return new StackFrame({functionName:line})}else{var tokens=line.split('@');var locationParts=this.extractLocation(tokens.pop());var functionName=tokens.join('@')||undefined;return new StackFrame({functionName:functionName,fileName:locationParts[0],lineNumber:locationParts[1],columnNumber:locationParts[2],source:line})}},this)},parseOpera:function ErrorStackParser$$parseOpera(e){if(!e.stacktrace||e.message.indexOf('\n')>-1&&e.message.split('\n').length>e.stacktrace.split('\n').length){return this.parseOpera9(e)}else if(!e.stack){return this.parseOpera10(e)}else{return this.parseOpera11(e)}},parseOpera9:function ErrorStackParser$$parseOpera9(e){var lineRE=/Line (\d+).*script (?:in )?(\S+)/i;var lines=e.message.split('\n');var result=[];for(var i=2,len=lines.length;i<len;i+=2){var match=lineRE.exec(lines[i]);if(match){result.push(new StackFrame({fileName:match[2],lineNumber:match[1],source:lines[i]}))}}return result},parseOpera10:function ErrorStackParser$$parseOpera10(e){var lineRE=/Line (\d+).*script (?:in )?(\S+)(?:: In function (\S+))?$/i;var lines=e.stacktrace.split('\n');var result=[];for(var i=0,len=lines.length;i<len;i+=2){var match=lineRE.exec(lines[i]);if(match){result.push(new StackFrame({functionName:match[3]||undefined,fileName:match[2],lineNumber:match[1],source:lines[i]}))}}return result},parseOpera11:function ErrorStackParser$$parseOpera11(error){var filtered=error.stack.split('\n').filter(function(line){return!!line.match(FIREFOX_SAFARI_STACK_REGEXP)&&!line.match(/^Error created at/)},this);return filtered.map(function(line){var tokens=line.split('@');var locationParts=this.extractLocation(tokens.pop());var functionCall=tokens.shift()||'';var functionName=functionCall.replace(/<anonymous function(: (\w+))?>/,'$2').replace(/\([^\)]*\)/g,'')||undefined;var argsRaw;if(functionCall.match(/\(([^\)]*)\)/)){argsRaw=functionCall.replace(/^[^\(]+\(([^\)]*)\)$/,'$1')}var args=argsRaw===undefined||argsRaw==='[arguments not available]'?undefined:argsRaw.split(',');return new StackFrame({functionName:functionName,args:args,fileName:locationParts[0],lineNumber:locationParts[1],columnNumber:locationParts[2],source:line})},this)}}}))}());(function(){var define=System.amdDefine;(function(window,undefined){if(!window){return}var TraceKit={};var _oldTraceKit=window.TraceKit;var _slice=[].slice;var UNKNOWN_FUNCTION='?';function _has(object,key){return Object.prototype.hasOwnProperty.call(object,key)}function _isUndefined(what){return typeof what==='undefined'}TraceKit.noConflict=function noConflict(){window.TraceKit=_oldTraceKit;return TraceKit};TraceKit.wrap=function traceKitWrapper(func){function wrapped(){try{return func.apply(this,arguments)}catch(e){TraceKit.report(e);throw e}}return wrapped};TraceKit.report=function reportModuleWrapper(){var handlers=[],lastArgs=null,lastException=null,lastExceptionStack=null;function subscribe(handler){installGlobalHandler();handlers.push(handler)}function unsubscribe(handler){for(var i=handlers.length-1;i>=0;--i){if(handlers[i]===handler){handlers.splice(i,1)}}}function notifyHandlers(stack,isWindowError){var exception=null;if(isWindowError&&!TraceKit.collectWindowErrors){return}for(var i in handlers){if(_has(handlers,i)){try{handlers[i].apply(null,[stack].concat(_slice.call(arguments,2)))}catch(inner){exception=inner}}}if(exception){throw exception}}var _oldOnerrorHandler,_onErrorHandlerInstalled;function traceKitWindowOnError(message,url,lineNo,columnNo,errorObj){var stack=null;if(lastExceptionStack){TraceKit.computeStackTrace.augmentStackTraceWithInitialElement(lastExceptionStack,url,lineNo,message);processLastException()}else if(errorObj){stack=TraceKit.computeStackTrace(errorObj);notifyHandlers(stack,true)}else{var location={'url':url,'line':lineNo,'column':columnNo};location.func=TraceKit.computeStackTrace.guessFunctionName(location.url,location.line);location.context=TraceKit.computeStackTrace.gatherContext(location.url,location.line);stack={'mode':'onerror','message':message,'stack':[location]};notifyHandlers(stack,true)}if(_oldOnerrorHandler){return _oldOnerrorHandler.apply(this,arguments)}return false}function installGlobalHandler(){if(_onErrorHandlerInstalled===true){return}_oldOnerrorHandler=window.onerror;window.onerror=traceKitWindowOnError;_onErrorHandlerInstalled=true}function processLastException(){var _lastExceptionStack=lastExceptionStack,_lastArgs=lastArgs;lastArgs=null;lastExceptionStack=null;lastException=null;notifyHandlers.apply(null,[_lastExceptionStack,false].concat(_lastArgs))}function report(ex){if(lastExceptionStack){if(lastException===ex){return}else{processLastException()}}var stack=TraceKit.computeStackTrace(ex);lastExceptionStack=stack;lastException=ex;lastArgs=_slice.call(arguments,1);window.setTimeout(function(){if(lastException===ex){processLastException()}},stack.incomplete?2000:0);throw ex}report.subscribe=subscribe;report.unsubscribe=unsubscribe;return report}();TraceKit.computeStackTrace=function computeStackTraceWrapper(){var debug=false,sourceCache={};function loadSource(url){if(!TraceKit.remoteFetching){return''}try{var getXHR=function(){try{return new window.XMLHttpRequest}catch(e){return new window.ActiveXObject('Microsoft.XMLHTTP')}};var request=getXHR();request.open('GET',url,false);request.send('');return request.responseText}catch(e){return''}}function getSource(url){if(typeof url!=='string'){return[]}if(!_has(sourceCache,url)){var source='';var domain='';try{domain=window.document.domain}catch(e){}var match=/(.*)\:\/\/([^:\/]+)([:\d]*)\/{0,1}([\s\S]*)/.exec(url);if(match&&match[2]===domain){source=loadSource(url)}sourceCache[url]=source?source.split('\n'):[]}return sourceCache[url]}function guessFunctionName(url,lineNo){var reFunctionArgNames=/function ([^(]*)\(([^)]*)\)/,reGuessFunction=/['"]?([0-9A-Za-z$_]+)['"]?\s*[:=]\s*(function|eval|new Function)/,line='',maxLines=10,source=getSource(url),m;if(!source.length){return UNKNOWN_FUNCTION}for(var i=0;i<maxLines;++i){line=source[lineNo-i]+line;if(!_isUndefined(line)){if(m=reGuessFunction.exec(line)){return m[1]}else if(m=reFunctionArgNames.exec(line)){return m[1]}}}return UNKNOWN_FUNCTION}function gatherContext(url,line){var source=getSource(url);if(!source.length){return null}var context=[],linesBefore=Math.floor(TraceKit.linesOfContext/2),linesAfter=linesBefore+TraceKit.linesOfContext%2,start=Math.max(0,line-linesBefore-1),end=Math.min(source.length,line+linesAfter-1);line-=1;for(var i=start;i<end;++i){if(!_isUndefined(source[i])){context.push(source[i])}}return context.length>0?context:null}function escapeRegExp(text){return text.replace(/[\-\[\]{}()*+?.,\\\^$|#]/g,'\\$&')}function escapeCodeAsRegExpForMatchingInsideHTML(body){return escapeRegExp(body).replace('<','(?:<|&lt;)').replace('>','(?:>|&gt;)').replace('&','(?:&|&amp;)').replace('"','(?:"|&quot;)').replace(/\s+/g,'\\s+')}function findSourceInUrls(re,urls){var source,m;for(var i=0,j=urls.length;i<j;++i){if((source=getSource(urls[i])).length){source=source.join('\n');if(m=re.exec(source)){return{'url':urls[i],'line':source.substring(0,m.index).split('\n').length,'column':m.index-source.lastIndexOf('\n',m.index)-1}}}}return null}function findSourceInLine(fragment,url,line){var source=getSource(url),re=new RegExp('\\b'+escapeRegExp(fragment)+'\\b'),m;line-=1;if(source&&source.length>line&&(m=re.exec(source[line]))){return m.index}return null}function findSourceByFunctionBody(func){if(_isUndefined(window&&window.document)){return}var urls=[window.location.href],scripts=window.document.getElementsByTagName('script'),body,code=''+func,codeRE=/^function(?:\s+([\w$]+))?\s*\(([\w\s,]*)\)\s*\{\s*(\S[\s\S]*\S)\s*\}\s*$/,eventRE=/^function on([\w$]+)\s*\(event\)\s*\{\s*(\S[\s\S]*\S)\s*\}\s*$/,re,parts,result;for(var i=0;i<scripts.length;++i){var script=scripts[i];if(script.src){urls.push(script.src)}}if(!(parts=codeRE.exec(code))){re=new RegExp(escapeRegExp(code).replace(/\s+/g,'\\s+'))}else{var name=parts[1]?'\\s+'+parts[1]:'',args=parts[2].split(',').join('\\s*,\\s*');body=escapeRegExp(parts[3]).replace(/;$/,';?');re=new RegExp('function'+name+'\\s*\\(\\s*'+args+'\\s*\\)\\s*{\\s*'+body+'\\s*}')}if(result=findSourceInUrls(re,urls)){return result}if(parts=eventRE.exec(code)){var event=parts[1];body=escapeCodeAsRegExpForMatchingInsideHTML(parts[2]);re=new RegExp('on'+event+'=[\\\'"]\\s*'+body+'\\s*[\\\'"]','i');if(result=findSourceInUrls(re,urls[0])){return result}re=new RegExp(body);if(result=findSourceInUrls(re,urls)){return result}}return null}function computeStackTraceFromStackProp(ex){if(!ex.stack){return null}var chrome=/^\s*at (.*?) ?\(((?:file|https?|blob|chrome-extension|native|eval).*?)(?::(\d+))?(?::(\d+))?\)?\s*$/i,gecko=/^\s*(.*?)(?:\((.*?)\))?(?:^|@)((?:file|https?|blob|chrome|\[native).*?)(?::(\d+))?(?::(\d+))?\s*$/i,winjs=/^\s*at (?:((?:\[object object\])?.+) )?\(?((?:ms-appx|https?|blob):.*?):(\d+)(?::(\d+))?\)?\s*$/i,lines=ex.stack.split('\n'),stack=[],parts,element,reference=/^(.*) is undefined$/.exec(ex.message);for(var i=0,j=lines.length;i<j;++i){if(parts=chrome.exec(lines[i])){var isNative=parts[2]&&parts[2].indexOf('native')!==-1;element={'url':!isNative?parts[2]:null,'func':parts[1]||UNKNOWN_FUNCTION,'args':isNative?[parts[2]]:[],'line':parts[3]?+parts[3]:null,'column':parts[4]?+parts[4]:null}}else if(parts=winjs.exec(lines[i])){element={'url':parts[2],'func':parts[1]||UNKNOWN_FUNCTION,'args':[],'line':+parts[3],'column':parts[4]?+parts[4]:null}}else if(parts=gecko.exec(lines[i])){element={'url':parts[3],'func':parts[1]||UNKNOWN_FUNCTION,'args':parts[2]?parts[2].split(','):[],'line':parts[4]?+parts[4]:null,'column':parts[5]?+parts[5]:null}}else{continue}if(!element.func&&element.line){element.func=guessFunctionName(element.url,element.line)}if(element.line){element.context=gatherContext(element.url,element.line)}stack.push(element)}if(!stack.length){return null}if(stack[0]&&stack[0].line&&!stack[0].column&&reference){stack[0].column=findSourceInLine(reference[1],stack[0].url,stack[0].line)}else if(!stack[0].column&&!_isUndefined(ex.columnNumber)){stack[0].column=ex.columnNumber+1}return{'mode':'stack','name':ex.name,'message':ex.message,'stack':stack}}function computeStackTraceFromStacktraceProp(ex){var stacktrace=ex.stacktrace;if(!stacktrace){return}var opera10Regex=/ line (\d+).*script (?:in )?(\S+)(?:: in function (\S+))?$/i,opera11Regex=/ line (\d+), column (\d+)\s*(?:in (?:<anonymous function: ([^>]+)>|([^\)]+))\((.*)\))? in (.*):\s*$/i,lines=stacktrace.split('\n'),stack=[],parts;for(var line=0;line<lines.length;line+=2){var element=null;if(parts=opera10Regex.exec(lines[line])){element={'url':parts[2],'line':+parts[1],'column':null,'func':parts[3],'args':[]}}else if(parts=opera11Regex.exec(lines[line])){element={'url':parts[6],'line':+parts[1],'column':+parts[2],'func':parts[3]||parts[4],'args':parts[5]?parts[5].split(','):[]}}if(element){if(!element.func&&element.line){element.func=guessFunctionName(element.url,element.line)}if(element.line){try{element.context=gatherContext(element.url,element.line)}catch(exc){}}if(!element.context){element.context=[lines[line+1]]}stack.push(element)}}if(!stack.length){return null}return{'mode':'stacktrace','name':ex.name,'message':ex.message,'stack':stack}}function computeStackTraceFromOperaMultiLineMessage(ex){var lines=ex.message.split('\n');if(lines.length<4){return null}var lineRE1=/^\s*Line (\d+) of linked script ((?:file|https?|blob)\S+)(?:: in function (\S+))?\s*$/i,lineRE2=/^\s*Line (\d+) of inline#(\d+) script in ((?:file|https?|blob)\S+)(?:: in function (\S+))?\s*$/i,lineRE3=/^\s*Line (\d+) of function script\s*$/i,stack=[],scripts=window&&window.document&&window.document.getElementsByTagName('script'),inlineScriptBlocks=[],parts;for(var s in scripts){if(_has(scripts,s)&&!scripts[s].src){inlineScriptBlocks.push(scripts[s])}}for(var line=2;line<lines.length;line+=2){var item=null;if(parts=lineRE1.exec(lines[line])){item={'url':parts[2],'func':parts[3],'args':[],'line':+parts[1],'column':null}}else if(parts=lineRE2.exec(lines[line])){item={'url':parts[3],'func':parts[4],'args':[],'line':+parts[1],'column':null};var relativeLine=+parts[1];var script=inlineScriptBlocks[parts[2]-1];if(script){var source=getSource(item.url);if(source){source=source.join('\n');var pos=source.indexOf(script.innerText);if(pos>=0){item.line=relativeLine+source.substring(0,pos).split('\n').length}}}}else if(parts=lineRE3.exec(lines[line])){var url=window.location.href.replace(/#.*$/,'');var re=new RegExp(escapeCodeAsRegExpForMatchingInsideHTML(lines[line+1]));var src=findSourceInUrls(re,[url]);item={'url':url,'func':'','args':[],'line':src?src.line:parts[1],'column':null}}if(item){if(!item.func){item.func=guessFunctionName(item.url,item.line)}var context=gatherContext(item.url,item.line);var midline=context?context[Math.floor(context.length/2)]:null;if(context&&midline.replace(/^\s*/,'')===lines[line+1].replace(/^\s*/,'')){item.context=context}else{item.context=[lines[line+1]]}stack.push(item)}}if(!stack.length){return null}return{'mode':'multiline','name':ex.name,'message':lines[0],'stack':stack}}function augmentStackTraceWithInitialElement(stackInfo,url,lineNo,message){var initial={'url':url,'line':lineNo};if(initial.url&&initial.line){stackInfo.incomplete=false;if(!initial.func){initial.func=guessFunctionName(initial.url,initial.line)}if(!initial.context){initial.context=gatherContext(initial.url,initial.line)}var reference=/ '([^']+)' /.exec(message);if(reference){initial.column=findSourceInLine(reference[1],initial.url,initial.line)}if(stackInfo.stack.length>0){if(stackInfo.stack[0].url===initial.url){if(stackInfo.stack[0].line===initial.line){return false}else if(!stackInfo.stack[0].line&&stackInfo.stack[0].func===initial.func){stackInfo.stack[0].line=initial.line;stackInfo.stack[0].context=initial.context;return false}}}stackInfo.stack.unshift(initial);stackInfo.partial=true;return true}else{stackInfo.incomplete=true}return false}function computeStackTraceByWalkingCallerChain(ex,depth){var functionName=/function\s+([_$a-zA-Z\xA0-\uFFFF][_$a-zA-Z0-9\xA0-\uFFFF]*)?\s*\(/i,stack=[],funcs={},recursion=false,parts,item,source;for(var curr=computeStackTraceByWalkingCallerChain.caller;curr&&!recursion;curr=curr.caller){if(curr===computeStackTrace||curr===TraceKit.report){continue}item={'url':null,'func':UNKNOWN_FUNCTION,'args':[],'line':null,'column':null};if(curr.name){item.func=curr.name}else if(parts=functionName.exec(curr.toString())){item.func=parts[1]}if(typeof item.func==='undefined'){try{item.func=parts.input.substring(0,parts.input.indexOf('{'))}catch(e){}}if(source=findSourceByFunctionBody(curr)){item.url=source.url;item.line=source.line;if(item.func===UNKNOWN_FUNCTION){item.func=guessFunctionName(item.url,item.line)}var reference=/ '([^']+)' /.exec(ex.message||ex.description);if(reference){item.column=findSourceInLine(reference[1],source.url,source.line)}}if(funcs[''+curr]){recursion=true}else{funcs[''+curr]=true}stack.push(item)}if(depth){stack.splice(0,depth)}var result={'mode':'callers','name':ex.name,'message':ex.message,'stack':stack};augmentStackTraceWithInitialElement(result,ex.sourceURL||ex.fileName,ex.line||ex.lineNumber,ex.message||ex.description);return result}function computeStackTrace(ex,depth){var stack=null;depth=depth==null?0:+depth;try{stack=computeStackTraceFromStacktraceProp(ex);if(stack){return stack}}catch(e){if(debug){throw e}}try{stack=computeStackTraceFromStackProp(ex);if(stack){return stack}}catch(e){if(debug){throw e}}try{stack=computeStackTraceFromOperaMultiLineMessage(ex);if(stack){return stack}}catch(e){if(debug){throw e}}try{stack=computeStackTraceByWalkingCallerChain(ex,depth+1);if(stack){return stack}}catch(e){if(debug){throw e}}return{'mode':'failed'}}function computeStackTraceOfCaller(depth){depth=(depth==null?0:+depth)+1;try{throw new Error}catch(ex){return computeStackTrace(ex,depth+1)}}computeStackTrace.augmentStackTraceWithInitialElement=augmentStackTraceWithInitialElement;computeStackTrace.guessFunctionName=guessFunctionName;computeStackTrace.gatherContext=gatherContext;computeStackTrace.ofCaller=computeStackTraceOfCaller;computeStackTrace.getSource=getSource;return computeStackTrace}();TraceKit.extendToAsynchronousCallbacks=function(){var _helper=function _helper(fnName){var originalFn=window[fnName];window[fnName]=function traceKitAsyncExtension(){var args=_slice.call(arguments);var originalCallback=args[0];if(typeof originalCallback==='function'){args[0]=TraceKit.wrap(originalCallback)}if(originalFn.apply){return originalFn.apply(this,args)}else{return originalFn(args[0],args[1])}}};_helper('setTimeout');_helper('setInterval')};if(!TraceKit.remoteFetching){TraceKit.remoteFetching=true}if(!TraceKit.collectWindowErrors){TraceKit.collectWindowErrors=true}if(!TraceKit.linesOfContext||TraceKit.linesOfContext<1){TraceKit.linesOfContext=11}if(typeof module!=='undefined'&&module.exports&&this.module!==module){module.exports=TraceKit}else if(typeof define==='function'&&define.amd){define('node_modules/tracekit/tracekit.js',[],TraceKit)&&define('TraceKit',['node_modules/tracekit/tracekit.js'],function(m){return m})}else{window.TraceKit=TraceKit}}(typeof window!=='undefined'?window:global))}());(function(){var define=System.amdDefine;define('3rdparty/knockout.placeholderPolyfill.js',['node_modules/jquery/dist/jquery.js','node_modules/knockout/build/output/knockout-latest.debug.js'],function($,ko){if('placeholder'in $('<input>')[0]&&'placeholder'in $('<textarea>')[0]){return}function attributes(elem){var newAttrs={};var frameworkIdentifiers=/^(jQuery|__ko__)\d+$/;var dataAttribute=/^data-.*/;var disallowedAttributes=/^(id|name)$/;$.each(elem.attributes,function(i,attr){if(attr.specified&&!frameworkIdentifiers.test(attr.name)&&!dataAttribute.test(attr.name)&&!disallowedAttributes.test(attr.name)){newAttrs[attr.name]=attr.value}});if(newAttrs.type==='password'){newAttrs.type='text'}return newAttrs}ko.bindingHandlers.placeholderPolyfill={init:function(element,valueAccessor,allBindingsAccessor,viewModel,bindingContext){var $placeholder;var $input=$(element);$placeholder=$input.is('textarea')?$('<textarea>'):$('<input>');$placeholder.attr(attributes(element)).addClass('placeholder').val($input.attr('placeholder'));$input.before($placeholder);function placeholderToggle(visible){return $placeholder.toggle(visible).next().toggle(!visible)}function showPlaceholderIfValueIsEmpty(){var value=ko.utils.unwrapObservable(valueAccessor())||'';placeholderToggle(value==='')}$placeholder.focus(function(){placeholderToggle(false).focus()});$input.blur(function(){showPlaceholderIfValueIsEmpty()});if(ko.isObservable(valueAccessor())){var subscription=valueAccessor().subscribe(function(newValue){if(!$input.is(':focus')){showPlaceholderIfValueIsEmpty()}});ko.utils.domNodeDisposal.addDisposeCallback(element,function(){subscription.dispose()})}showPlaceholderIfValueIsEmpty()}};var defaultBindingProvider=ko.bindingProvider.instance||new ko.bindingProvider;var ELEMENT_NODE=1;ko.bindingProvider.instance={nodeHasBindings:function(node){return defaultBindingProvider.nodeHasBindings(node)||node.nodeType===ELEMENT_NODE&&node.hasAttribute&&node.hasAttribute('placeholder')},getBindings:function(node,bindingContext){var bindings=defaultBindingProvider.getBindings(node,bindingContext);if(node.nodeType===ELEMENT_NODE&&node.hasAttribute&&node.hasAttribute('placeholder')){bindings=bindings||{};if(!bindings.value){bindings.value=ko.observable()}bindings.placeholderPolyfill=bindings.value}return bindings}}})}());(function(){var define=System.amdDefine;(function(factory){if(typeof define==='function'&&define.amd){define('3rdparty/knockout.dragdrop.js',['node_modules/knockout/build/output/knockout-latest.debug.js'],factory)}else if(typeof module==='object'&&module.exports){module.exports=factory(require('knockout'))}else{factory(ko)}}(function(ko){var dropZones={};var eventZones={};var forEach=ko.utils.arrayForEach;var first=ko.utils.arrayFirst;var filter=ko.utils.arrayFilter;var touchSupport='ontouchstart'in document.documentElement;var dragging=false;function extend(out){out=out||{};for(var i=1;i<arguments.length;i++){if(!arguments[i]){continue}for(var key in arguments[i]){if(arguments[i].hasOwnProperty(key)){out[key]=arguments[i][key]}}}return out}function toggleClass(element,className,addOrRemove){var classes=element.className.split(' ');var existingIndex=classes.indexOf(className);if(existingIndex>=0&&!addOrRemove){classes.splice(existingIndex,1)}if(existingIndex<0&&addOrRemove){classes.push(className)}element.className=classes.join(' ')}function matches(element,selector){if(!element.tagName){return null}var docEl=document.documentElement;var match=docEl.matches||docEl.matchesSelector||docEl.webkitMatchesSelector||docEl.mozMatchesSelector||docEl.msMatchesSelector||docEl.oMatchesSelector;return match.call(element,selector)}function getClosest(element,selector){do{if(matches(element,selector)){return element}element=element.parentNode}while(element);return null}function Zone(args){this.init(args)}function getEventCoord(event,axis){if(event.type.indexOf('touch')>=0){return event.changedTouches[0][axis]}else{return event[axis]}}Zone.prototype.init=function(args){this.element=args.element;this.data=args.data;this.dragEnter=args.dragEnter;this.dragOver=args.dragOver;this.dragLeave=args.dragLeave;this.active=false;this.inside=false;this.dirty=false};Zone.prototype.refreshDomInfo=function(){this.hidden=this.element.style.display==='none';if(!this.hidden){var rect=this.element.getBoundingClientRect();this.top=rect.top+window.pageYOffset-document.documentElement.clientTop;this.left=rect.left+window.pageXOffset-document.documentElement.clientLeft;this.width=rect.width;this.height=rect.height}};Zone.prototype.isInside=function(x,y){if(this.hidden){return false}if(x<this.left||y<this.top){return false}if(this.left+this.width<x){return false}if(this.top+this.height<y){return false}return true};Zone.prototype.update=function(event,data){if(this.isInside(getEventCoord(event,'pageX'),getEventCoord(event,'pageY'))){if(!this.inside){this.enter(event,data)}if(this.dragOver){this.dragOver(event,data,this.data)}}else{this.leave(event)}};Zone.prototype.enter=function(event,data){this.inside=true;if(this.dragEnter){this.active=this.dragEnter(event,data,this.data)!==false}else{this.active=true}this.dirty=true};Zone.prototype.leave=function(event){if(event){event.target=this.element}if(this.inside&&this.dragLeave){this.dragLeave(event,this.data)}this.active=false;this.inside=false;this.dirty=true};function DropZone(args){this.init(args);this.drop=function(data){args.drop(data,args.data)}}DropZone.prototype=Zone.prototype;DropZone.prototype.updateStyling=function(){if(this.dirty){toggleClass(this.element,'drag-over',this.active);toggleClass(this.element,'drop-rejected',this.inside&&!this.active)}this.dirty=false};function DragElement(element){this.element=element;toggleClass(this.element,'drag-element',true);this.element.style.position='fixed';this.element.style.zIndex=9998;this.element.addEventListener('selectstart',function(){return false},true)}DragElement.prototype.updatePosition=function(event){this.element.style.top=event.pageY-window.pageYOffset+'px';this.element.style.left=event.pageX-window.pageXOffset+'px';this.element.style.top=getEventCoord(event,'pageY')-window.pageYOffset+'px';this.element.style.left=getEventCoord(event,'pageX')-window.pageXOffset+'px'};DragElement.prototype.remove=function(){this.element.parentNode.removeChild(this.element)};function Draggable(args){this.element=args.element;this.name=args.name;this.dragStart=args.dragStart;this.dragEnd=args.dragEnd;this.data=args.data}Draggable.prototype.startDrag=function(event){if(this.dragStart&&this.dragStart(this.data,event)===false){return false}toggleClass(document.body,'drag-active',true)};Draggable.prototype.drag=function(event){var that=this;var name=this.name;var zones=dropZones[name].concat(eventZones[name]);forEach(zones,function(zone){zone.refreshDomInfo()});forEach(zones,function(zone){event.target=zone.element;zone.update(event,that.data)});forEach(dropZones[name],function(zone){zone.updateStyling()})};Draggable.prototype.dropRejected=function(){var name=this.name;var insideAZone=first(dropZones[name],function(zone){return zone.inside});if(!insideAZone){return true}var noActiveZone=!first(dropZones[name],function(zone){return zone.active});return noActiveZone};Draggable.prototype.cancelDrag=function(event){if(this.dragEnd){this.dragEnd(this.data,event)}toggleClass(document.body,'drag-active',false)};Draggable.prototype.drop=function(event){var name=this.name;var dropZoneElement=getClosest(event.target,'.drop-zone');var activeZones=filter(dropZones[name],function(zone){return zone.active});var winningDropZone=filter(activeZones,function(zone){return zone.element===dropZoneElement})[0];forEach(dropZones[name].concat(eventZones[name]),function(zone){zone.leave(event)});forEach(dropZones[name],function(zone){zone.updateStyling()});if(winningDropZone&&winningDropZone.drop){winningDropZone.drop(this.data)}if(this.dragEnd){this.dragEnd(this.data,event)}toggleClass(document.body,'drag-active',false)};function ScrollArea(element,delay){var rect=element.getBoundingClientRect();this.element=element;this.scrollMarginHeight=Math.floor(rect.height/10);this.scrollMarginWidth=Math.floor(rect.width/10);this.offset={'top':rect.top+window.pageYOffset-document.documentElement.clientTop,'left':rect.left+window.pageXOffset-document.documentElement.clientLeft};this.innerHeight=rect.height;this.innerWidth=rect.width;this.scrollDeltaMin=5;this.scrollDeltaMax=30;this.delay=delay||0;this.inZone='center';this.scrolling=false}ScrollArea.prototype.scroll=function(x,y){this.x=x;this.y=y;this.topLimit=this.scrollMarginHeight+this.offset.top;this.bottomLimit=this.offset.top+this.innerHeight-this.scrollMarginHeight;this.leftLimit=this.scrollMarginWidth+this.offset.left;this.rightLimit=this.offset.left+this.innerWidth-this.scrollMarginWidth;var activeZone='';if(y<this.topLimit){activeZone+='top'}else if(y>this.bottomLimit){activeZone+='bottom'}if(x<this.leftLimit){activeZone+='left'}else if(x>this.rightLimit){activeZone+='right'}if(activeZone===''){activeZone='center'}this.updateZone(activeZone)};ScrollArea.prototype.enter=function(zone){var that=this;this.delayTimer=setTimeout(function(){that.scrolling=true},this.delay)};ScrollArea.prototype.leave=function(zone){this.scrolling=false;clearTimeout(this.delayTimer)};ScrollArea.prototype.over=function(zone){var speed,scrollDelta=function(speed){return speed*(this.scrollDeltaMax-this.scrollDeltaMin)+this.scrollDeltaMin}.bind(this);if(this.scrolling){if(zone.indexOf('top')!==-1){speed=(this.topLimit-this.y)/this.scrollMarginHeight;this.element.scrollTop-=scrollDelta(speed)}else if(zone.indexOf('bottom')!==-1){speed=(this.y-this.bottomLimit)/this.scrollMarginHeight;this.element.scrollTop+=scrollDelta(speed)}if(zone.indexOf('left')!==-1){speed=(this.leftLimit-this.x)/this.scrollMarginWidth;this.element.scrollLeft-=scrollDelta(speed)}else if(zone.indexOf('right')!==-1){speed=(this.x-this.rightLimit)/this.scrollMarginWidth;this.element.scrollLeft+=scrollDelta(speed)}}};ScrollArea.prototype.updateZone=function(zone){if(this.zone!==zone){this.leave(this.zone);this.enter(zone)}this.zone=zone;this.over(zone)};function getAcceptedDragZones(options){if(options.accepts){return[].concat(options.accepts)}else if(options.name){return[options.name]}else{throw new Error('A drop zone must specify the drag zones it accepts')}}ko.utils.extend(ko.bindingHandlers,{dropZone:{init:function(element,valueAccessor,allBindingsAccessor,viewModel,bindingContext){var options=ko.utils.unwrapObservable(valueAccessor());var accepts=getAcceptedDragZones(options);toggleClass(element,'drop-zone',true);var data=options.data||bindingContext&&bindingContext.$data;var zone=new DropZone({element:element,data:data,drop:options.drop,dragEnter:options.dragEnter,dragOver:options.dragOver,dragLeave:options.dragLeave});accepts.forEach(function(zoneName){dropZones[zoneName]=dropZones[zoneName]||[];dropZones[zoneName].push(zone)});ko.utils.domNodeDisposal.addDisposeCallback(element,function(){zone.leave();accepts.forEach(function(zoneName){dropZones[zoneName].splice(dropZones[zoneName].indexOf(zone),1)})})}},dragEvents:{init:function(element,valueAccessor,allBindingsAccessor,viewModel,bindingContext){var options=ko.utils.unwrapObservable(valueAccessor());var accepts=getAcceptedDragZones(options);var data=options.data||bindingContext&&bindingContext.$data;var zone=new Zone({element:element,data:data,dragEnter:options.dragEnter,dragOver:options.dragOver,dragLeave:options.dragLeave});accepts.forEach(function(zoneName){eventZones[zoneName]=eventZones[zoneName]||[];eventZones[zoneName].push(zone)});ko.utils.domNodeDisposal.addDisposeCallback(element,function(){zone.leave();accepts.forEach(function(zoneName){eventZones[zoneName].splice(eventZones[zoneName].indexOf(zone),1)})})}},dragZone:{init:function(element,valueAccessor,allBindingsAccessor,viewModel,bindingContext){var options=ko.utils.unwrapObservable(valueAccessor());var name=options.name;var dragDistance=typeof options.dragDistance==='number'?options.dragDistance:10;dropZones[name]=dropZones[name]||[];eventZones[name]=eventZones[name]||[];if(!name||typeof name!=='string'){throw new Error('A drag zone must specify a name')}if(options.disabled){return}var data=options.data||bindingContext&&bindingContext.$data;var draggable=new Draggable({element:element,name:name,data:data,dragStart:options.dragStart,dragEnd:options.dragEnd});if(typeof options.longTapDelay==='undefined'){options.longTapDelay=500}function createCloneProxyElement(){var dragProxy=element.cloneNode(true);element.parentNode.appendChild(dragProxy);var style=window.getComputedStyle(element,null);dragProxy.style.height=style.getPropertyValue('height');dragProxy.style.width=style.getPropertyValue('width');dragProxy.style.opacity=70/100;dragProxy.style.filter='alpha(opacity=70)';return dragProxy}function createTemplateProxyElement(){var dragProxy=document.createElement('div');document.body.appendChild(dragProxy);var innerBindingContext='data'in options?bindingContext.createChildContext(options.data):bindingContext;ko.renderTemplate(options.element,innerBindingContext,{},dragProxy);return dragProxy}function onSelectStartDrag(event){event.preventDefault();event.stopPropagation()}element.addEventListener('selectstart',function(event){if(!event.target.tagName||event.target.tagName.toLowerCase()!=='input'&&event.target.tagName.toLowerCase()!=='textarea'){event.preventDefault();event.stopPropagation();return false}return true},true);toggleClass(element,'draggable',true);function beginEvent(downEvent){if(downEvent.button>0){return true}document.addEventListener('selectstart',onSelectStartDrag,true);function startDragging(startEvent){document.removeEventListener('mouseup',onMouseUpStartDrag,true);document.removeEventListener('touchend',onMouseUpStartDrag,true);document.removeEventListener('click',onMouseUpStartDrag,true);document.removeEventListener('mousemove',onMouseMoveStartDrag,true);document.removeEventListener('touchmove',onTouchMoveStartDrag,true);if(dragging){return true}if(draggable.startDrag(downEvent)===false){startEvent.preventDefault();startEvent.stopPropagation();return false}dragging=true;var dragElement=null;if(typeof options.element==='undefined'){dragElement=new DragElement(createCloneProxyElement())}var overlay=document.createElement('div');overlay.className='drag-overlay';overlay.setAttribute('unselectable','on');overlay.style.zIndex=9999;overlay.style.position='fixed';overlay.style.top=0;overlay.style.left=0;overlay.style.right=0;overlay.style.bottom=0;overlay.style.cursor='move';overlay.style.backgroundColor='white';overlay.style.opacity=0;overlay.style.filter='alpha(opacity=0)';overlay.style.userSelect='none';overlay.style.webkitUserSelect='none';overlay.style.MozUserSelect='none';overlay.style.msUserSelect='none';overlay.style.OUserSelect='none';overlay.addEventListener('selectstart',onSelectStartDrag);document.body.appendChild(overlay);if(options.element){dragElement=new DragElement(createTemplateProxyElement())}if(dragElement){dragElement.updatePosition(downEvent)}var dragTimer=null;var dropRejected=false;function drag(event){draggable.drag(event);var draggableDropRejected=draggable.dropRejected();if(draggableDropRejected!==dropRejected){toggleClass(overlay,'drop-rejected',draggableDropRejected);overlay.style.cursor=draggableDropRejected?'no-drop':'move';dropRejected=draggableDropRejected}dragTimer=setTimeout(function(){drag(event)},100)}function cancelDrag(e){dragging=false;clearTimeout(touchDragTimer);clearTimeout(dragTimer);if(dragElement){dragElement.remove()}overlay.parentNode.removeChild(overlay);draggable.cancelDrag(e);document.removeEventListener('touchmove',dragHandler);document.removeEventListener('touchend',finishEvent);e.preventDefault();e.stopPropagation();return true}function dragHandler(moveEvent){if(moveEvent.button>0){return cancelDrag(moveEvent)}clearTimeout(dragTimer);if(dragElement){dragElement.updatePosition(moveEvent)}drag(moveEvent);moveEvent.preventDefault();moveEvent.stopPropagation();return false}if(!touchSupport){overlay.addEventListener('mousedown',cancelDrag)}overlay.addEventListener('mousemove',dragHandler);document.addEventListener('touchmove',dragHandler);function finishEvent(upEvent){dragging=false;clearTimeout(touchDragTimer);clearTimeout(dragTimer);if(dragElement){dragElement.remove()}overlay.parentNode.removeChild(overlay);var cloneEvent=extend({},upEvent);cloneEvent.target=document.elementFromPoint(getEventCoord(upEvent,'clientX'),getEventCoord(upEvent,'clientY'));draggable.drop(cloneEvent);document.removeEventListener('selectstart',onSelectStartDrag,true);document.removeEventListener('touchmove',dragHandler);document.removeEventListener('touchend',finishEvent);upEvent.preventDefault();upEvent.stopPropagation();return false}overlay.addEventListener('mouseup',finishEvent);document.addEventListener('touchend',finishEvent)}function onMouseUpStartDrag(event){document.removeEventListener('mouseup',onMouseUpStartDrag,true);document.removeEventListener('touchend',onMouseUpStartDrag,true);document.removeEventListener('click',onMouseUpStartDrag,true);document.removeEventListener('mousemove',onMouseMoveStartDrag,true);document.removeEventListener('touchmove',onTouchMoveStartDrag,true);document.removeEventListener('selectstart',onSelectStartDrag,true);return true}document.addEventListener('mouseup',onMouseUpStartDrag,true);document.addEventListener('touchend',onMouseUpStartDrag,true);document.addEventListener('click',onMouseUpStartDrag,true);function onMouseMoveStartDrag(event){if(event.target.tagName&&event.target.tagName.toLowerCase()==='input'){return true}var xDifference=getEventCoord(downEvent,'pageX')-getEventCoord(event,'pageX'),yDifference=getEventCoord(downEvent,'pageY')-getEventCoord(event,'pageY'),distance=Math.sqrt(Math.pow(xDifference,2)+Math.pow(yDifference,2));if(distance>dragDistance){startDragging(event)}event.preventDefault();event.stopPropagation();return false}var touchDragTimer;if(downEvent.type==='touchstart'){touchDragTimer=setTimeout(function(){startDragging(downEvent)},ko.unwrap(options.longTapDelay));element.addEventListener('touchend',function(){clearTimeout(touchDragTimer)})}function onTouchMoveStartDrag(event){if(event.target.tagName&&event.target.tagName.toLowerCase()==='input'){return true}var xDifference=getEventCoord(downEvent,'pageX')-getEventCoord(event,'pageX'),yDifference=getEventCoord(downEvent,'pageY')-getEventCoord(event,'pageY'),distance=Math.sqrt(Math.pow(xDifference,2)+Math.pow(yDifference,2));if(distance>dragDistance){clearTimeout(touchDragTimer)}}document.addEventListener('mousemove',onMouseMoveStartDrag,true);document.addEventListener('touchmove',onTouchMoveStartDrag,true);return true}element.addEventListener('mousedown',beginEvent);element.addEventListener('touchstart',beginEvent);ko.utils.domNodeDisposal.addDisposeCallback(element,function(){document.removeEventListener('selectstart',onSelectStartDrag,true)})}},scrollableOnDragOver:{init:function(element,valueAccessor,allBindingAccessor){var options=ko.utils.unwrapObservable(valueAccessor());if(typeof options==='string'||Array.isArray(options)){options={accepts:options}}options.delay=options.delay||0;var accepts=getAcceptedDragZones(options);var scrollArea=null;var x,y;var scrollInterval;function scroll(){scrollArea.scroll(x,y)}function dragEnter(e){scrollArea=new ScrollArea(element,options.delay);scrollInterval=setInterval(scroll,100)}function dragOver(e){x=getEventCoord(e,'pageX');y=getEventCoord(e,'pageY')}function dragLeave(e){clearInterval(scrollInterval)}ko.bindingHandlers.dragEvents.init(element,function(){return{accepts:accepts,dragEnter:dragEnter,dragOver:dragOver,dragLeave:dragLeave}})}}})}))}());(function(){var define=System.amdDefine;define('3rdparty/knockout.dropdown.js',['node_modules/jquery/dist/jquery.js','node_modules/knockout/build/output/knockout-latest.debug.js'],function($,ko){var ie8=!document.addEventListener;function animationInProgress(element){return $(element).filter(':animated').length>0}ko.bindingHandlers.dropdown={init:function(element,valueAccessor){var value=valueAccessor();var menu=$('*[data-dropdown="menu"]',element).filter(':first');menu.toggle(ko.utils.unwrapObservable(value));var anchor=$('*[data-dropdown="anchor"]',element).filter(':first');function dropdownOpener(){if(!ko.utils.unwrapObservable(value)&&!animationInProgress(menu)){value(true);removeDropdownOpener()}}function addDropdownOpener(){anchor.bind('click',dropdownOpener)}function removeDropdownOpener(){anchor.unbind('click',dropdownOpener)}addDropdownOpener();function dropdownCloser(event){if(ko.utils.unwrapObservable(value)){var target=event.target||document.elementFromPoint(event.pageX||event.clientX,event.pageY||event.clientY);var isMenu=menu.is(target)||menu.has(target).length>0;var isAnchor=anchor.is(target)||anchor.has(target).length>0;if(ie8){if(!isAnchor&&!isMenu){value(false)}}else if(!isMenu){value(false);if(isAnchor){event.stopPropagation()}}setTimeout(addDropdownOpener,500)}}function addEventListener(document,callback){if(ie8){document.attachEvent('onmousedown',callback)}else{document.addEventListener('mousedown',callback,true);document.addEventListener('touchstart',callback,true)}}function removeEventListener(document,callback){if(ie8){document.detachEvent('onmousedown',callback)}else{document.removeEventListener('mousedown',callback,true);document.removeEventListener('touchstart',callback,true)}}function eachIFrameContents(callback){$('iframe').each(function(index,iframe){var src=iframe.src;var origin=window.location.origin||location.protocol+'//'+location.host;if(!src||src.indexOf(origin)===0){$(iframe).contents().each(callback)}})}function addDropdownCloser(){eachIFrameContents(function(index,doc){addEventListener(doc,dropdownCloser)});addEventListener(document,dropdownCloser)}function removeDropdownCloser(){eachIFrameContents(function(index,doc){removeEventListener(doc,dropdownCloser)});removeEventListener(document,dropdownCloser)}var subscription=value.subscribe(function(){if(ko.utils.unwrapObservable(value)){addDropdownCloser()}else{removeDropdownCloser()}});ko.utils.domNodeDisposal.addDisposeCallback(element,function(){value(false);subscription.dispose()})},update:function(element,valueAccessor){var value=valueAccessor();var menu=$('*[data-dropdown="menu"]',element).filter(':first');if(ko.utils.unwrapObservable(value)){$(element).addClass('open');if(ie8){$(menu).show()}else{$(menu).slideDown(200)}}else{$(element).removeClass('open');if(ie8){$(menu).hide()}else{$(menu).slideUp(200)}}}}})}());(function(){var define=System.amdDefine;define('3rdparty/knockout.autoExpand.js',['node_modules/jquery/dist/jquery.js','node_modules/knockout/build/output/knockout-latest.debug.js'],function($,ko){var textAreaMimics=['-webkit-box-sizing','-moz-box-sizing','boxSizing','paddingTop','paddingRight','paddingBottom','paddingLeft','fontSize','lineHeight','fontFamily','fontWeight','borderTopWidth','borderTopStyle','borderTopColor','borderRightWidth','borderRightStyle','borderRightColor','borderLeftWidth','borderLeftStyle','borderLeftColor','borderBottomWidth','borderBottomStyle','borderBottomColor'];function copyStyles($target,$source,styles){for(var i=0;i<styles.length;i=i+1){$target.css(styles[i],$source.css(styles[i]))}}var unitRegex=/^(\d+)(\w+)$/;function pixelValue(str){var matches=str.match(unitRegex);if(matches){if(matches[2]!=='px'){return NaN}return parseInt(matches[1],10)}return NaN}function getWidth($element){return pixelValue($element.css('width'))}function getHeight($element){return pixelValue($element.css('height'))}function elasticTextArea($element){var $twin=$('<div />').css({'position':'absolute','display':'none','word-wrap':'break-word','white-space':'pre-wrap'}),lineHeight=parseInt($element.css('line-height'),10)||1.14*parseInt($element.css('font-size'),'10'),minheight=getHeight($element)||lineHeight*3,maxheight=parseInt($element.css('max-height'),10)||Number.MAX_VALUE;if(maxheight<0){maxheight=Number.MAX_VALUE}copyStyles($twin,$element,textAreaMimics);$twin.width(getWidth($element));$twin.appendTo($element.parent());$element.data('elastic-twin',$twin);function setTwinWidth(){var curatedWidth=getWidth($element);if(getWidth($twin)!==curatedWidth){$twin.css('width',curatedWidth);update(true)}}function setHeightAndOverflow(height,overflow){var curratedHeight=Math.floor(height);if(getHeight($element)!==curratedHeight){$element.css({height:curratedHeight,overflow:overflow});setTimeout(function(){$(window).trigger('resize')},0)}}function update(forced){var textareaContent=$element.val().replace(/&/g,'&amp;').replace(/ {2}/g,'&nbsp;').replace(/<|>/g,'&gt;').replace(/\n/g,'<br />');var twinContent=$twin.html().replace(/<br>/ig,'<br />');if(forced||textareaContent+'&nbsp;'!==twinContent){$twin.html(textareaContent+'&nbsp;');var goalheight=getHeight($twin);if(goalheight>=maxheight){setHeightAndOverflow(maxheight,'auto')}else if(goalheight<=minheight){setHeightAndOverflow(minheight,'hidden')}else{setHeightAndOverflow(goalheight,'hidden')}}}$element.css({'overflow':'hidden'});$element.bind('keyup change cut paste',function(){update()});$element.bind('focus',function(e){setTimeout(update,0)});$(window).bind('resize',setTwinWidth);$element.bind('resize',setTwinWidth);$element.bind('update',update);$element.bind('blur',function(){if($twin.css('height')<maxheight){if($twin.css('height')>minheight){$element.css('height',$twin.css('height'))}else{$element.css('height',minheight)}}});$element.bind('input paste',function(e){setTimeout(update,250)});update()}var textFieldMimics=['paddingRight','paddingLeft','fontSize','fontFamily','fontWeight','borderRightWidth','borderRightStyle','borderRightColor','borderLeftWidth','borderLeftStyle','borderLeftColor','-webkit-box-sizing','-moz-box-sizing','boxSizing'];function elasticTextField($element){var $twin=$('<div />').css({'position':'absolute','display':'none','white-space':'pre'});copyStyles($twin,$element,textFieldMimics);$twin.appendTo($element.parent());$element.data('elastic-twin',$twin);var value=null;function update(){var newValue=$element.val();if(newValue!==undefined){$twin.text(newValue);$element.css('width',getWidth($twin)+30);value=newValue}}$element.bind('keyup change cut paste update',function(){update()});$element.bind('focus',function(e){setTimeout(update,0)});$element.bind('input paste',function(e){setTimeout(update,250)});update()}ko.bindingHandlers.autoExpand={init:function(element,valueAccessor){if(valueAccessor()===false){return}var $element=$(element);if(element.type==='textarea'){elasticTextArea($element)}else if(element.type==='text'||element.type==='email'){elasticTextField($element)}else{return}ko.utils.domNodeDisposal.addDisposeCallback(element,function(){var $twin=$element.data('elastic-twin');if($twin){$twin.remove()}})},update:function(element,valueAccessor){if(valueAccessor()===false){return}var $element=$(element);$element.trigger('update')}}})}());(function(){var define=System.amdDefine;define('3rdparty/knockout.splitView.js',['node_modules/jquery/dist/jquery.js','node_modules/knockout/build/output/knockout-latest.debug.js','3rdparty/mario.js'],function($,ko,mario){var oldIE=mario.ie&&parseInt(mario.version,10)<9;var leftButton=oldIE?1:0;function round(n,decimals){var factor=decimals*10;return Math.round(factor*n)/factor}function constrainedBy(n,min,max){return Math.max(min,Math.min(max,n))}function SplitView(data){this.horizontal=!!data.horizontal;this.offset=data.offset;this.size=data.size;this.panel1=data.panel1;this.panel2=data.panel2;this.setHandlePosition(data.handlePosition)}SplitView.prototype.setHandlePosition=function(position){this.handlePosition=constrainedBy(position,this.panel1.minSize,this.size-this.panel2.minSize)};SplitView.prototype.moveHandleTo=function(coordinates){if(this.horizontal){this.setHandlePosition(coordinates.y-this.offset.top)}else{this.setHandlePosition(coordinates.x-this.offset.left)}};SplitView.prototype.handlePositionInPixels=function(){return this.handlePosition+'px'};function toObservableIfNot(value){return ko.isObservable(value)?value:ko.observable(value)}ko.bindingHandlers.splitView={init:function(element,valueAccessor,allBindingsAccessor,viewModel,bindingContext){var value=valueAccessor();var options=ko.utils.unwrapObservable(value);var $element=$(element);var horizontal=toObservableIfNot(options.horizontal);horizontal(!!horizontal());options.panel1.minWidth=options.panel1.minWidth||options.panel1.minSize||0;options.panel1.minHeight=options.panel1.minHeight||options.panel1.minSize||0;options.panel2.minWidth=options.panel2.minWidth||options.panel2.minSize||0;options.panel2.minHeight=options.panel2.minHeight||options.panel2.minSize||0;options.resizablePanel=options.resizablePanel||'panel2';var positions={};if(ko.isObservable(options.position)||typeof options.position==='number'){positions.horizontal=positions.vertical=toObservableIfNot(options.position)}else{positions.horizontal=toObservableIfNot(options.position.horizontal);positions.vertical=toObservableIfNot(options.position.vertical)}var position=ko.computed({read:function(){return horizontal()?positions.horizontal():positions.vertical()},write:function(value){if(horizontal()){positions.horizontal(value)}else{positions.vertical(value)}}});$element.addClass('layout split-view');var children=$element.children();if(children.length!==0){throw new Error('Split view should have no child elements')}var panel1=$('<div>').appendTo(element);var handle=$('<div unselectable="on">').appendTo(element);var panel2=$('<div>').appendTo(element);panel1.addClass('panel1');handle.addClass('resize-handle');panel2.addClass('panel2');function setDirectionalClasses(){$element.toggleClass('horizontal',horizontal());$element.toggleClass('vertical',!horizontal())}setDirectionalClasses();var movingHandle=null;var movingOverlay=null;var splitView=null;var handleSize=Math.min(handle.outerWidth(),handle.outerHeight());function createSplitView(){var size=horizontal()?$element.outerHeight():$element.outerWidth(),handlePosition=position();if(options.resizablePanel==='panel1'){handlePosition=size-handlePosition}splitView=new SplitView({horizontal:horizontal(),offset:$element.offset(),size:size,handlePosition:handlePosition,panel1:{minSize:horizontal()?options.panel1.minHeight:options.panel1.minWidth},panel2:{minSize:horizontal()?options.panel2.minHeight:options.panel2.minWidth}})}function adjustPanels(){if(horizontal()){$(panel1).css({left:0,right:0,width:''});$(handle).css({left:0,right:0,width:''});$(panel2).css({left:0,right:0,width:''});if(options.resizablePanel==='panel1'){$(panel1).css({top:0,bottom:position(),height:'auto'});$(handle).css({bottom:position()-handleSize,top:'auto'});$(panel2).css({top:'auto',height:position(),bottom:0})}else{$(panel1).css({top:0,height:position(),bottom:'auto'});$(handle).css({top:position(),bottom:'auto'});$(panel2).css({height:'auto',top:position(),bottom:0})}}else{$(panel1).css({top:0,bottom:0,height:''});$(handle).css({top:0,bottom:0,height:''});$(panel2).css({top:0,bottom:0,height:''});if(options.resizablePanel==='panel1'){$(panel1).css({left:0,right:position(),width:'auto'});$(handle).css({right:position()-handleSize,left:'auto'});$(panel2).css({left:'auto',width:position(),right:0})}else{$(panel1).css({left:0,width:position(),right:'auto'});$(handle).css({left:position(),right:'auto'});$(panel2).css({width:'auto',left:position(),right:0})}}}createSplitView();if(options.resizablePanel==='panel1'){position(splitView.size-splitView.handlePosition)}else{position(splitView.handlePosition)}adjustPanels();horizontal.subscribe(function(){setDirectionalClasses();adjustPanels()});function placeSplitter(e){$(document).off('mouseup.splitView');$(document).off('mousemove.splitView');movingHandle.remove();movingOverlay.remove();$('body').removeClass('splitter-moving');splitView.moveHandleTo({x:e.pageX,y:e.pageY});if(options.resizablePanel==='panel1'){position(splitView.size-splitView.handlePosition)}else{position(splitView.handlePosition)}setTimeout(function(){$(window).trigger('resize')},0)}function moveSplitter(e){splitView.moveHandleTo({x:e.pageX,y:e.pageY});if(horizontal()){movingHandle.css('top',splitView.handlePositionInPixels())}else{movingHandle.css('left',splitView.handlePositionInPixels())}}$(window).on('resize.splitView',function(){createSplitView(splitView);if(options.resizablePanel==='panel1'){position(splitView.size-splitView.handlePosition)}if(options.resizablePanel==='panel2'||options.isSidebarExtended===true){position(splitView.handlePosition)}});$(handle).on('mousedown.splitView',function(e){if(e.button===leftButton){movingHandle=$(handle).clone().appendTo(element);movingOverlay=$('<div class="split-view-move-overlay '+(horizontal()?'horizontal':'vertical')+'">').appendTo('body');movingHandle.addClass('moving');$('body').addClass('splitter-moving');createSplitView();$(document).on('mouseup.splitView',placeSplitter);$(document).on('mousemove.splitView',moveSplitter)}});var positionSubscription=position.subscribe(function(){adjustPanels()});ko.renderTemplate(options.panel1.template,bindingContext,{afterRender:options.panel1.afterRender},panel1[0]);ko.renderTemplate(options.panel2.template,bindingContext,{afterRender:options.panel2.afterRender},panel2[0]);ko.utils.domNodeDisposal.addDisposeCallback(element,function(){$(window).off('resize.splitView');positionSubscription.dispose()});return{controlsDescendantBindings:true}}}})}());(function(){var define=System.amdDefine;define('3rdparty/knockout.transition.js',['node_modules/knockout/build/output/knockout-latest.debug.js','node_modules/jquery/dist/jquery.js'],function(ko,$){var transitions={'transition':'transitionend','OTransition':'oTransitionEnd','MozTransition':'transitionend','WebkitTransition':'webkitTransitionEnd'};function supportedTransition(){var body=document.body||document.documentElement;var style=body.style;return Object.keys(transitions).filter(function(propertyName){return typeof style[propertyName]==='string'})[0]}var transition=supportedTransition();if(!transition){return}ko.bindingHandlers.transition={init:function(element,valueAccessor){var value=valueAccessor();var observable=value.value||value;var options=value.options||'100ms all ease-in';var eventName=transitions[transition]+'.transtion';var $element=$(element);var subscription=observable.subscribe(function(){$element.css(transition,options);$element.on(eventName,function(){$element.css(transition,'');$element.off(eventName)})},null,'beforeChange');ko.utils.domNodeDisposal.addDisposeCallback(element,function(){subscription.dispose()})}}})}());System.registerDynamic('3rdparty/one-theme/3rdparty/bootstrap/js/bootstrap-tooltip.js',['node_modules/jquery/dist/jquery.js'],false,function($__require,$__exports,$__module){var _retrieveGlobal=System.get('@@global-helpers').prepareGlobal($__module.id,null,{'jQuery':$__require('node_modules/jquery/dist/jquery.js')});(function($__global){!function($){'use strict';var Tooltip=function(element,options){this.init('tooltip',element,options)};Tooltip.prototype={constructor:Tooltip,init:function(type,element,options){var eventIn,eventOut;this.type=type;this.$element=$(element);this.options=this.getOptions(options);this.enabled=true;if(this.options.trigger!='manual'){eventIn=this.options.trigger=='hover'?'mouseenter':'focus';eventOut=this.options.trigger=='hover'?'mouseleave':'blur';this.$element.on(eventIn,this.options.selector,$.proxy(this.enter,this));this.$element.on(eventOut,this.options.selector,$.proxy(this.leave,this))}var that=this;$.event.special.tooltipdestroy={teardown:function(){that.hide()}};this.$element.on('tooltipdestroy',function(){});this.options.selector?this._options=$.extend({},this.options,{trigger:'manual',selector:''}):this.fixTitle()},getOptions:function(options){var toolTipData=this.$element.data();var elementOptions={};Object.keys(toolTipData).forEach(function(key){var match;if(match=/^tooltip([A-Z])(.+)/.exec(key)){elementOptions[match[1].toLowerCase()+match[2]]=toolTipData[key]}});options=$.extend({},$.fn[this.type].defaults,options,elementOptions);if(options.delay&&typeof options.delay=='number'){options.delay={show:options.delay,hide:options.delay}}return options},enter:function(e){var self=$(e.currentTarget)[this.type](this._options).data(this.type);if(!self.options.delay||!self.options.delay.show){self.show()}else{self.hoverState='in';setTimeout(function(){if(self.hoverState=='in'&&$(e.currentTarget).closest('body').length>0){self.show()}},self.options.delay.show)}},leave:function(e){var self=$(e.currentTarget)[this.type](this._options).data(this.type);if(!self.options.delay||!self.options.delay.hide){self.hide()}else{self.hoverState='out';setTimeout(function(){if(self.hoverState=='out'){self.hide()}},self.options.delay.hide)}},show:function(){var that,$tip,inside,pos,actualWidth,actualHeight,placement,tp;if(this.hasContent()&&this.enabled){that=this;$tip=this.tip();this.setContent();if(this.options.animation){$tip.addClass('fade')}placement=typeof this.options.placement=='function'?this.options.placement.call(this,$tip[0],this.$element[0]):this.options.placement;inside=/in/.test(placement);$tip.remove().css({top:0,left:0,display:'block'}).appendTo(inside?this.$element:document.body);pos=this.getPosition(inside);actualWidth=$tip[0].offsetWidth;actualHeight=$tip[0].offsetHeight;switch(inside?placement.split(' ')[1]:placement){case'bottom':tp={top:pos.top+pos.height,left:pos.left+pos.width/2-actualWidth/2};break;case'top':tp={top:pos.top-actualHeight,left:pos.left+pos.width/2-actualWidth/2};break;case'left':tp={top:pos.top+pos.height/2-actualHeight/2,left:pos.left-actualWidth};break;case'right':tp={top:pos.top+pos.height/2-actualHeight/2,left:pos.left+pos.width};break}clearInterval(this.interval);this.interval=setInterval(function(){if(!that.$element.is(':visible')){that.hide()}},500);$tip.css(tp).addClass(placement).addClass('in')}},setContent:function(){var $tip=this.tip();$tip.find('.tooltip-inner').html(this.getTitle());$tip.removeClass('fade in top bottom left right')},hide:function(){var that=this,$tip=this.tip();clearInterval(this.interval);$tip.removeClass('in');function removeWithAnimation(){var timeout=setTimeout(function(){$tip.off($.support.transition.end).remove()},500);$tip.one($.support.transition.end,function(){clearTimeout(timeout);$tip.remove()})}$.support.transition&&this.$tip.hasClass('fade')?removeWithAnimation():$tip.remove()},fixTitle:function(){var $e=this.$element;if($e.attr('title')||typeof $e.attr('data-title')!='string'){$e.attr('data-title',$e.attr('title')||'').removeAttr('title')}},hasContent:function(){return this.getTitle()},getPosition:function(inside){return $.extend({},inside?{top:0,left:0}:this.$element.offset(),{width:this.$element[0].offsetWidth,height:this.$element[0].offsetHeight})},escapeHtml:function(text){var map={'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;','\'':'&#039;'};return text.replace(/[&<>"']/g,function(m){return map[m]})},getTitle:function(){var title,$e=this.$element,o=this.options;title=$e.attr('data-title')||(typeof o.title=='function'?o.title.call($e[0]):o.title);title=this.escapeHtml(title.toString().replace(/(^\s*|\s*$)/,''));return title},tip:function(){return this.$tip=this.$tip||$(this.options.template)},validate:function(){if(!this.$element[0].parentNode){this.hide();this.$element=null;this.options=null}},enable:function(){this.enabled=true},disable:function(){this.enabled=false},toggleEnabled:function(){this.enabled=!this.enabled},toggle:function(){this[this.tip().hasClass('in')?'hide':'show']()}};$.fn.tooltip=function(option){return this.each(function(){var $this=$(this),data=$this.data('tooltip'),options=typeof option=='object'&&option;if(!data)$this.data('tooltip',data=new Tooltip(this,options));if(typeof option=='string')data[option]()})};$.fn.tooltip.Constructor=Tooltip;$.fn.tooltip.defaults={animation:true,delay:0,selector:false,placement:'top',trigger:'hover',title:'',template:'<div class="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>'}}(window.jQuery)}(this));return _retrieveGlobal()});(function(){var define=System.amdDefine;define('theme/tooltip.js',['node_modules/jquery/dist/jquery.js','node_modules/knockout/build/output/knockout-latest.debug.js','3rdparty/one-theme/3rdparty/bootstrap/js/bootstrap-tooltip.js'],function($,ko){$('body').tooltip({animation:true,delay:{show:750,hide:100},selector:'[data-title]'})})}());(function(){var define=System.amdDefine;define('theme/binding/unselectable.js',['node_modules/jquery/dist/jquery.js','node_modules/knockout/build/output/knockout-latest.debug.js'],function($,ko){ko.bindingHandlers.unselectable={init:function(element,valueAccessor){var value=valueAccessor();var bindingValue=ko.utils.unwrapObservable(value);$(element).toggleClass('unselectable',bindingValue);$(element).find('*').add(element).attr('unselectable',bindingValue?'on':'off')},update:function(element,valueAccessor){var value=valueAccessor();var bindingValue=ko.utils.unwrapObservable(value);$(element).toggleClass('unselectable',bindingValue);$(element).find('*').add(element).attr('unselectable',bindingValue?'on':'off')}}})}());(function(){var define=System.amdDefine;define('theme/binding/focusWhen.js',['node_modules/jquery/dist/jquery.js','node_modules/knockout/build/output/knockout-latest.debug.js'],function($,ko){function focusIfVisible(element){var $element=$(element);if($element.is(':visible')&&!$element.is(':focus')){setTimeout(function(){$element.focus()},1)}}ko.bindingHandlers.focusWhen={init:function(element,valueAccessor){var value=valueAccessor();if(ko.utils.unwrapObservable(value)){focusIfVisible(element)}},update:function(element,valueAccessor){var value=valueAccessor();if(ko.utils.unwrapObservable(value)){focusIfVisible(element)}}}})}());(function(){var define=System.amdDefine;define('theme/theme.js',['theme/tooltip.js','theme/binding/unselectable.js','theme/binding/focusWhen.js'],function(){})}());(function(){var define=System.amdDefine;define('3rdparty/knockout.separator.js',['node_modules/knockout/build/output/knockout-latest.debug.js','node_modules/jquery/dist/jquery.js'],function(ko,$){ko.bindingHandlers.separator={init:function(element,valueAccessor,allBindingsAccessor,viewModel,bindingContext){var value=valueAccessor();var bindingValue=ko.utils.unwrapObservable(value);$(element).toggle(bindingContext.$index()<bindingValue.length-1)},update:function(element,valueAccessor,allBindingsAccessor,viewModel,bindingContext){var value=valueAccessor();var bindingValue=ko.utils.unwrapObservable(value);$(element).toggle(bindingContext.$index()<bindingValue.length-1)}}})}());(function(){var define=System.amdDefine;(function(root,factory){if(typeof exports==='object'){module.exports=factory()}else if(typeof define==='function'&&define.amd){define('3rdparty/eventmatcher.js',[],factory)}else{root.EventMatcher=factory()}}(this,function(){function compare(pattern,event){for(var prop in pattern){if(pattern.hasOwnProperty(prop)&&pattern[prop]!==event[prop]){return false}}return true}function EventMatcher(){this.handlers=[]}EventMatcher.prototype.register=function(pattern,callback){for(var i=0;i<arguments.length-1;i+=1){this.handlers.push({pattern:arguments[i],callback:arguments[arguments.length-1]})}};EventMatcher.prototype.match=function(event,item){for(var i=0;i<this.handlers.length;i+=1){if(compare(this.handlers[i].pattern,event)){this.handlers[i].callback.call(this,event,item);return true}}return false};return EventMatcher}))}());(function(){var define=System.amdDefine;(function(root,factory){if(typeof exports==='object'){module.exports=factory(require('knockout'),require('./eventmatcher'))}else if(typeof define==='function'&&define.amd){define('3rdparty/knockout.selection.js',['node_modules/knockout/build/output/knockout-latest.debug.js','3rdparty/eventmatcher.js'],factory)}else{factory(ko,EventMatcher)}}(this,function(ko,EventMatcher){function createRange(foreach,start,end){var items=foreach(),startIndex=ko.utils.arrayIndexOf(items,start),endIndex=ko.utils.arrayIndexOf(items,end),range=[];if(startIndex>endIndex){var tmp=startIndex;startIndex=endIndex;endIndex=tmp}for(var i=startIndex;i<=endIndex;i+=1){range.push(items[i])}return range}function set(item,property,value){if(item&&item.hasOwnProperty(property)&&ko.isObservable(item[property])){item[property](value)}}function setAll(items,property,value){ko.utils.arrayForEach(items,function(item){set(item,property,value)})}function SelectionModel(){this.items=null;this.selection=null;this.focused=null;this.mode=null;this.direction=null;this.anchor=null;this.focusedIndex=-1;this.subscriptions=[]}function hasCssClass(element,className){return!!(element&&element.className&&element.className.indexOf(className)!==-1&&element.className.match('\\b'+className+'\\b'))}function getParentElement(element){return element&&element.parentNode||null}function insideElementWithClass(element,className,stopSearchingAtElement){stopSearchingAtElement=stopSearchingAtElement||null;var currentElement=element;while(currentElement){if(hasCssClass(currentElement,className)){return true}if(currentElement===stopSearchingAtElement){return false}currentElement=getParentElement(currentElement)}return false}SelectionModel.prototype.init=function(config){var that=this;if(!this.items){throw new Error('The selection binding can only be used together with `foreach`, `foreach: { data: ... }`, `template: { foreach: ... }` or like `selection: { data: ... }`.')}if(!ko.isObservable(this.selection)){throw new Error('The selection binding should be bound to either an `observableArray` or a object containing a `selection` `observableArray`.')}setTimeout(function(){that.cleanup()},0);this.subscriptions.push(this.focused.subscribe(function(newFocused){that.focusedIndex=newFocused?ko.utils.arrayIndexOf(that.items(),that.focused()):-1}));this.subscriptions.push(this.selection.subscribe(function(selection){setAll(that.selection(),config.properties.selected,false)},this,'beforeChange'));this.subscriptions.push(this.selection.subscribe(function(newSelection){if(that.mode()==='single'&&newSelection.length>1){that.selection([newSelection.slice(-1)[0]])}else{setAll(newSelection,config.properties.selected,true)}}));this.subscriptions.push(this.items.subscribe(function(newItems){that.cleanup()}));setAll(this.selection(),config.properties.selected,true);this.subscriptions.push(this.focused.subscribe(function(focused){set(focused,config.properties.focused,false)},this,'beforeChange'));this.subscriptions.push(this.focused.subscribe(function(newFocused){set(newFocused,config.properties.focused,true)}));if(this.focused()){set(this.focused(),config.properties.focused,true)}};SelectionModel.prototype.cleanup=function(){var allItems=this.items.peek(),stillPresentSelectedItems=[];if(this.focused.peek()&&ko.utils.arrayIndexOf(allItems,this.focused.peek())===-1){var focusOnIndex=Math.min(this.focusedIndex,allItems.length-1);if(allItems[focusOnIndex]){this.focused(allItems[focusOnIndex])}else{this.focused(null)}}if(this.anchor.peek()&&ko.utils.arrayIndexOf(allItems,this.anchor.peek())===-1){this.anchor(null)}ko.utils.arrayForEach(this.selection.peek(),function(selectedItem){if(ko.utils.arrayIndexOf(allItems,selectedItem)!==-1){stillPresentSelectedItems.push(selectedItem)}});if(stillPresentSelectedItems.length!==this.selection.peek().length){this.selection(stillPresentSelectedItems)}};SelectionModel.prototype.hasHorizontal=function(){return this.direction.peek()==='horizontal'};SelectionModel.prototype.hasVertical=function(){return this.direction.peek()==='vertical'};SelectionModel.prototype.selectAll=function(){this.selection(this.items().slice())};SelectionModel.prototype.selectItem=function(item){var selection=[];if(item){selection.push(item)}this.selection(selection);this.focused(item)};SelectionModel.prototype.firstItem=function(){return this.items()[0]};SelectionModel.prototype.lastItem=function(){return this.items()[this.items().length-1]};SelectionModel.prototype.nextItem=function(item){var position=ko.utils.arrayIndexOf(this.items(),item);return this.items()[Math.min(position+1,this.items().length-1)]};SelectionModel.prototype.previousItem=function(item){var position=ko.utils.arrayIndexOf(this.items(),item);return this.items()[Math.max(position-1,0)]};SelectionModel.prototype.leftItem=function(item){return this.previousItem(item)};SelectionModel.prototype.aboveItem=function(item){return this.previousItem(item)};SelectionModel.prototype.rightItem=function(item){return this.nextItem(item)};SelectionModel.prototype.belowItem=function(item){return this.nextItem(item)};SelectionModel.prototype.isAlreadySelected=function(item){return ko.utils.arrayIndexOf(this.selection(),item)!==-1};SelectionModel.prototype.toggleSelection=function(item){if(this.isAlreadySelected(item)){this.selection.remove(item)}else{this.selection.push(item)}this.focused(item)};SelectionModel.prototype.appendSelectionFromAnchor=function(item){if(!this.anchor()){this.anchor(item)}createRange(this.items,this.anchor(),item).forEach(function(itemToSelect){if(!this.isAlreadySelected(itemToSelect)){this.selection.push(itemToSelect)}},this);this.focused(item)};SelectionModel.prototype.replaceSelectionWithRangeFromAnchor=function(item){if(!this.anchor()){this.anchor(item)}this.selection(createRange(this.items,this.anchor(),item));this.focused(item)};SelectionModel.prototype.findItemData=function(target){var context=ko.contextFor(target);while(context&&ko.utils.arrayIndexOf(this.items(),context.$data)===-1){context=context.$parentContext}return context&&context.$data};ko.bindingHandlers.selection={modes:{single:function(selectionModel){if(selectionModel.focused()){selectionModel.selection([selectionModel.focused()])}else{selectionModel.selection.splice(1)}var matchers=new EventMatcher;var selectItemOnMouseUp=false;matchers.register({type:'mousedown',which:1,hasItem:true,isClickOnToggleElement:false},function(event,item){if(selectionModel.lateSelect||selectionModel.isAlreadySelected(item)){selectItemOnMouseUp=true}else{selectionModel.selectItem(item);selectionModel.anchor(item);selectItemOnMouseUp=false}});matchers.register({type:'mouseup',which:1,hasItem:true,isClickOnToggleElement:false},function(event,item){if(selectItemOnMouseUp){selectionModel.selectItem(item);selectionModel.anchor(item);selectItemOnMouseUp=false}});matchers.register({type:'mousedown',which:1,hasItem:true,isClickOnToggleElement:true},function(event,item){selectionModel.selectItem(item);selectionModel.anchor(item)});matchers.register({type:'keydown',which:32,hasItem:true},function(event,item){selectionModel.toggleSelection(item);selectionModel.anchor(item)});matchers.register({type:'keydown',which:35},function(event,item){var lastItem=selectionModel.lastItem();selectionModel.selectItem(lastItem);selectionModel.anchor(lastItem)});matchers.register({type:'keydown',which:36},function(event,item){var firstItem=selectionModel.firstItem();selectionModel.selectItem(firstItem);selectionModel.anchor(firstItem)});if(selectionModel.hasVertical()){matchers.register({type:'keydown',which:38,hasItem:false},{type:'keydown',which:40,hasItem:false},function(event,item){var first=selectionModel.firstItem();selectionModel.selectItem(first);selectionModel.anchor(first)});matchers.register({type:'keydown',which:38,hasItem:true},function(event,item){var previousItem=selectionModel.aboveItem(item);selectionModel.selectItem(previousItem);selectionModel.anchor(previousItem)});matchers.register({type:'keydown',which:40,hasItem:true},function(event,item){var nextItem=selectionModel.belowItem(item);selectionModel.selectItem(nextItem);selectionModel.anchor(nextItem)})}if(selectionModel.hasHorizontal()){matchers.register({type:'keydown',which:37,hasItem:false},{type:'keydown',which:39,hasItem:false},function(event,item){var first=selectionModel.firstItem();selectionModel.selectItem(first);selectionModel.anchor(first)});matchers.register({type:'keydown',which:37,hasItem:true},function(event,item){var previousItem=selectionModel.leftItem(item);selectionModel.selectItem(previousItem);selectionModel.anchor(previousItem)});matchers.register({type:'keydown',which:39,hasItem:true},function(event,item){var nextItem=selectionModel.rightItem(item);selectionModel.selectItem(nextItem);selectionModel.anchor(nextItem)})}return matchers},toggle:function(selectionModel){var matchers=new EventMatcher;matchers.register({type:'mousedown',which:1,hasItem:true},function(event,item){selectionModel.toggleSelection(item)});matchers.register({type:'keydown',which:32,hasItem:true},function(event,item){selectionModel.toggleSelection(item)});return matchers},off:function(selectionModel){return new EventMatcher},multi:function(selectionModel){var matchers=new EventMatcher;matchers.register({type:'mousedown',which:1,ctrlKey:true,shiftKey:true,hasItem:true},{type:'mousedown',which:1,metaKey:true,shiftKey:true,hasItem:true},function(event,item){selectionModel.appendSelectionFromAnchor(item)});matchers.register({type:'mousedown',which:1,ctrlKey:true,hasItem:true},{type:'mousedown',which:1,metaKey:true,hasItem:true},function(event,item){selectionModel.toggleSelection(item);selectionModel.anchor(item)});matchers.register({type:'mousedown',which:1,shiftKey:true,hasItem:true},function(event,item){selectionModel.replaceSelectionWithRangeFromAnchor(item)});var selectItemOnMouseUp=false;matchers.register({type:'mousedown',which:1,hasItem:true,isClickOnToggleElement:false},function(event,item){if(selectionModel.lateSelect||selectionModel.isAlreadySelected(item)){selectItemOnMouseUp=true}else{selectionModel.selectItem(item);selectionModel.anchor(item)}});matchers.register({type:'mouseup',which:1,hasItem:true,isClickOnToggleElement:false},function(event,item){if(selectItemOnMouseUp){selectionModel.selectItem(item);selectionModel.anchor(item);selectItemOnMouseUp=false}});matchers.register({type:'mousedown',which:1,hasItem:true,isClickOnToggleElement:true},function(event,item){selectionModel.toggleSelection(item);selectionModel.anchor(item)});matchers.register({type:'keydown',which:32,hasItem:true},function(event,item){selectionModel.toggleSelection(item)});matchers.register({type:'keydown',which:35,ctrlKey:true,shiftKey:true},{type:'keydown',which:35,metaKey:true,shiftKey:true},function(event,item){selectionModel.appendSelectionFromAnchor(selectionModel.lastItem())});matchers.register({type:'keydown',which:35,ctrlKey:true},{type:'keydown',which:35,metaKey:true},function(event,item){var last=selectionModel.lastItem();selectionModel.focused(last);selectionModel.anchor(last)});matchers.register({type:'keydown',which:35,shiftKey:true},function(event,item){selectionModel.replaceSelectionWithRangeFromAnchor(selectionModel.lastItem())});matchers.register({type:'keydown',which:35},function(event,item){var last=selectionModel.lastItem();selectionModel.selectItem(last);selectionModel.anchor(last)});matchers.register({type:'keydown',which:36,ctrlKey:true,shiftKey:true},{type:'keydown',which:36,metaKey:true,shiftKey:true},function(event,item){selectionModel.appendSelectionFromAnchor(selectionModel.firstItem())});matchers.register({type:'keydown',which:36,ctrlKey:true},{type:'keydown',which:36,metaKey:true},function(event,item){var first=selectionModel.firstItem();selectionModel.focused(first);selectionModel.anchor(first)});matchers.register({type:'keydown',which:36,shiftKey:true},function(event,item){selectionModel.replaceSelectionWithRangeFromAnchor(selectionModel.firstItem())});matchers.register({type:'keydown',which:36},function(event,item){var first=selectionModel.firstItem();selectionModel.selectItem(first);selectionModel.anchor(first)});if(selectionModel.hasVertical()){matchers.register({type:'keydown',which:38,ctrlKey:false,shiftKey:false,hasItem:false},{type:'keydown',which:38,metaKey:false,shiftKey:false,hasItem:false},{type:'keydown',which:40,ctrlKey:false,shiftKey:false,hasItem:false},{type:'keydown',which:40,metaKey:false,shiftKey:false,hasItem:false},function(event,item){var first=selectionModel.firstItem();selectionModel.selectItem(first);selectionModel.anchor(first)});matchers.register({type:'keydown',which:38,ctrlKey:true,shiftKey:true,hasItem:true},{type:'keydown',which:38,metaKey:true,shiftKey:true,hasItem:true},function(event,item){selectionModel.appendSelectionFromAnchor(selectionModel.aboveItem(item))});matchers.register({type:'keydown',which:38,ctrlKey:true,hasItem:true},{type:'keydown',which:38,metaKey:true,hasItem:true},function(event,item){var prev=selectionModel.aboveItem(item);selectionModel.focused(prev);selectionModel.anchor(prev)});matchers.register({type:'keydown',which:38,shiftKey:true,hasItem:true},function(event,item){selectionModel.replaceSelectionWithRangeFromAnchor(selectionModel.aboveItem(item))});matchers.register({type:'keydown',which:38,hasItem:true},function(event,item){var prev=selectionModel.aboveItem(item);selectionModel.selectItem(prev);selectionModel.anchor(prev)});matchers.register({type:'keydown',which:40,ctrlKey:true,shiftKey:true,hasItem:true},{type:'keydown',which:40,metaKey:true,shiftKey:true,hasItem:true},function(event,item){selectionModel.appendSelectionFromAnchor(selectionModel.belowItem(item))});matchers.register({type:'keydown',which:40,ctrlKey:true,hasItem:true},{type:'keydown',which:40,metaKey:true,hasItem:true},function(event,item){var next=selectionModel.belowItem(item);selectionModel.focused(next);selectionModel.anchor(next)});matchers.register({type:'keydown',which:40,shiftKey:true,hasItem:true},function(event,item){selectionModel.replaceSelectionWithRangeFromAnchor(selectionModel.belowItem(item))});matchers.register({type:'keydown',which:40,hasItem:true},function(event,item){var next=selectionModel.belowItem(item);selectionModel.selectItem(next);selectionModel.anchor(next)})}if(selectionModel.hasHorizontal()){matchers.register({type:'keydown',which:37,ctrlKey:false,shiftKey:false,hasItem:false},{type:'keydown',which:37,metaKey:false,shiftKey:false,hasItem:false},{type:'keydown',which:39,ctrlKey:false,shiftKey:false,hasItem:false},{type:'keydown',which:39,metaKey:false,shiftKey:false,hasItem:false},function(event,item){var first=selectionModel.firstItem();selectionModel.selectItem(first);selectionModel.anchor(first)});matchers.register({type:'keydown',which:37,ctrlKey:true,shiftKey:true,hasItem:true},{type:'keydown',which:37,metaKey:true,shiftKey:true,hasItem:true},function(event,item){selectionModel.appendSelectionFromAnchor(selectionModel.leftItem(item))});matchers.register({type:'keydown',which:37,ctrlKey:true,hasItem:true},{type:'keydown',which:37,metaKey:true,hasItem:true},function(event,item){var prev=selectionModel.leftItem(item);selectionModel.focused(prev);selectionModel.anchor(prev)});matchers.register({type:'keydown',which:37,shiftKey:true,hasItem:true},function(event,item){selectionModel.replaceSelectionWithRangeFromAnchor(selectionModel.leftItem(item))});matchers.register({type:'keydown',which:37,hasItem:true},function(event,item){var prev=selectionModel.leftItem(item);selectionModel.selectItem(prev);selectionModel.anchor(prev)});matchers.register({type:'keydown',which:39,ctrlKey:true,shiftKey:true,hasItem:true},{type:'keydown',which:39,metaKey:true,shiftKey:true,hasItem:true},function(event,item){selectionModel.appendSelectionFromAnchor(selectionModel.rightItem(item))});matchers.register({type:'keydown',which:39,ctrlKey:true,hasItem:true},{type:'keydown',which:39,metaKey:true,hasItem:true},function(event,item){var next=selectionModel.rightItem(item);selectionModel.focused(next);selectionModel.anchor(next)});matchers.register({type:'keydown',which:39,shiftKey:true,hasItem:true},function(event,item){selectionModel.replaceSelectionWithRangeFromAnchor(selectionModel.rightItem(item))});matchers.register({type:'keydown',which:39,hasItem:true},function(event,item){var next=selectionModel.rightItem(item);selectionModel.selectItem(next);selectionModel.anchor(next)})}matchers.register({type:'keydown',which:65,ctrlKey:true},{type:'keydown',which:65,metaKey:true},function(event,item){selectionModel.selectAll()});return matchers}},getMode:function(modeName){var mode=ko.bindingHandlers.selection.modes[modeName];if(!mode){throw new Error('Unknown mode: "'+modeName+'"')}return mode},init:function(element,valueAccessor,allBindingsAccessor,viewModel,bindingContext){var value=valueAccessor(),bindingValue=ko.utils.unwrapObservable(valueAccessor()),allBindings=allBindingsAccessor(),config={mode:'multi',direction:'vertical',properties:{selected:'selected',focused:'focused'}};var selectionModel=new SelectionModel;if(bindingValue.data){selectionModel.items=bindingValue.data}else{selectionModel.items=allBindings.foreach&&allBindings.foreach.data||allBindings.foreach||allBindings.template&&allBindings.template.foreach}if(bindingValue.selection){selectionModel.selection=bindingValue.selection;selectionModel.focused=bindingValue.focused||ko.observable(null);selectionModel.anchor=bindingValue.anchor||ko.observable(null);selectionModel.toggleClass=bindingValue.toggleClass||null;if(ko.isObservable(bindingValue.mode)){selectionModel.mode=bindingValue.mode}else{selectionModel.mode=ko.observable(bindingValue.mode||config.mode)}if(ko.isObservable(bindingValue.direction)){selectionModel.direction=bindingValue.direction}else{selectionModel.direction=ko.observable(bindingValue.direction||config.direction)}ko.utils.extend(config.properties,bindingValue.properties);selectionModel.lateSelect=!!bindingValue.lateSelect}else{selectionModel.selection=value;selectionModel.focused=ko.observable(null);selectionModel.anchor=ko.observable(null);selectionModel.mode=ko.observable(config.mode);selectionModel.direction=ko.observable(config.direction);selectionModel.lateSelect=false}selectionModel.init(config);var matchers=ko.bindingHandlers.selection.getMode(selectionModel.mode())(selectionModel);var modeSubscription=selectionModel.mode.subscribe(function(modeName){matchers=ko.bindingHandlers.selection.getMode(selectionModel.mode())(selectionModel)});var directionSubscription=selectionModel.direction.subscribe(function(direction){matchers=ko.bindingHandlers.selection.getMode(selectionModel.mode.peek())(selectionModel)});function isClickOnToggleElement(element,event){var toggleClass=selectionModel.toggleClass;return toggleClass?insideElementWithClass(event.target,toggleClass,element):false}function matchEventWithItem(e){var item=selectionModel.findItemData(e.target||e.srcElement);e.hasItem=!!item;e.isClickOnToggleElement=isClickOnToggleElement(this,e);matchers.match(e,item)}ko.utils.registerEventHandler(element,'touchstart',matchEventWithItem);ko.utils.registerEventHandler(element,'touchend',matchEventWithItem);ko.utils.registerEventHandler(element,'touchmove',matchEventWithItem);ko.utils.registerEventHandler(element,'mousedown',matchEventWithItem);ko.utils.registerEventHandler(element,'mouseup',matchEventWithItem);ko.utils.registerEventHandler(element,'keydown',function(e){var item=selectionModel.focused();e.hasItem=!!item;if(matchers.match(e,item)){e.stopPropagation();e.preventDefault()}});ko.utils.domNodeDisposal.addDisposeCallback(element,function(){selectionModel.cleanup();ko.utils.arrayForEach(selectionModel.subscriptions,function(subscription){subscription.dispose()});modeSubscription.dispose();directionSubscription.dispose()})}};return ko.bindingHandlers.selection}))}());(function(){var define=System.amdDefine;define('common/bindings/onKeyEnter.js',['node_modules/knockout/build/output/knockout-latest.debug.js'],function(ko){ko.bindingHandlers.onKeyEnter={init:function(element,valueAccessor,allBindings,data,context){var bindings=allBindings();var valueBinding=bindings.value;var handlerFunction,eventUsed;if(typeof valueAccessor()==='function'){handlerFunction=valueAccessor();eventUsed='keydown'}else{handlerFunction=valueAccessor().handler||function(){};eventUsed=valueAccessor().keyup?'keyup':'keydown'}var handler=function(data,event){if(event.which===13){if(valueBinding){var elementValue=ko.selectExtensions.readValue(element);ko.jsonExpressionRewriting.writeValueToProperty(valueBinding,allBindings,'value',elementValue,true)}handlerFunction.call(data,data,event);if(event.preventDefault){event.preventDefault()}return false}return true};var handlerWrapper=function(){var wrapper={};wrapper[eventUsed]=handler;return wrapper};ko.bindingHandlers.event.init(element,handlerWrapper,allBindings,data,context)}}})}());(function(){var define=System.amdDefine;(function(root,factory){if(typeof exports==='object'){module.exports=factory(require('knockout'))}else if(typeof define==='function'&&define.amd){define('3rdparty/knockout.onKeyUp.js',['node_modules/knockout/build/output/knockout-latest.debug.js'],factory)}else{factory(ko)}}(this,function(ko){var _MAP={8:'backspace',9:'tab',13:'enter',16:'shift',17:'ctrl',18:'alt',20:'capslock',27:'esc',32:'space',33:'pageup',34:'pagedown',35:'end',36:'home',37:'left',38:'up',39:'right',40:'down',45:'ins',46:'del',91:'meta',93:'meta',224:'meta'},_KEYCODE_MAP={106:'*',107:'+',109:'-',110:'.',111:'/',186:';',187:'=',188:',',189:'-',190:'.',191:'/',192:'`',219:'[',220:'\\',221:']',222:'\''};for(var i=1;i<20;i+=1){_MAP[111+i]='f'+i}for(i=0;i<=9;i+=1){_MAP[i+96]=i}function _characterFromEvent(e){if(_MAP[e.which]){return _MAP[e.which].toString()}if(_KEYCODE_MAP[e.which]){return _KEYCODE_MAP[e.which].toString()}return String.fromCharCode(e.which).toLowerCase()}var eventToString=function(event){var eventString=_characterFromEvent(event);if(event.altKey){eventString='alt+'+eventString}if(event.shiftKey){eventString='shift+'+eventString}if(event.ctrlKey){eventString='ctrl+'+eventString}if(event.metaKey){eventString='meta+'+eventString}return eventString};var eventComparison=function(patternString,eventString){var pattern=[patternString];if(patternString.indexOf(',')!==-1){pattern=patternString.split(',')}for(var i=0;i<pattern.length;i+=1){if(pattern[i].trim()===eventString.trim()){return true}}return false};function EventMatcher(){this.handlers=[]}EventMatcher.prototype.register=function(eventPattern,callback){for(var i=0;i<arguments.length-1;i+=1){this.handlers.push({eventPattern:arguments[i],callback:arguments[arguments.length-1]})}};EventMatcher.prototype.match=function(event){var eventString=eventToString(event);var match=ko.utils.arrayFirst(this.handlers,function(handler){return eventComparison(handler.eventPattern,eventString)});if(match){if(match.callback){match.callback.apply(this,arguments)}return true}};EventMatcher.prototype.preventDefaultIfMatch=function(event){var eventString=eventToString(event);var match=ko.utils.arrayFirst(this.handlers,function(handler){return eventComparison(handler.eventPattern,eventString)});if(match){if(event.preventDefault){event.preventDefault()}return false}};function wrapHandler(handler,stopPropagation,preventDefault,returnFalse){return function(event,data){if(typeof handler==='function'){handler.call(data,event,data)}else{return handler}if(stopPropagation){event.cancelBubble=true;if(event.stopImmediatePropagation){event.stopImmediatePropagation()}}if(preventDefault&&event.preventDefault){event.preventDefault()}if(returnFalse){return false}}}function wrapAndRegisterHandler(keyMatcher,keyCombo,eventHandlerData){var eventHandler;if(typeof eventHandlerData==='function'){eventHandler=wrapHandler(eventHandlerData,true,true,true)}else if(typeof eventHandlerData==='object'){eventHandler=wrapHandler(eventHandlerData.handler,eventHandlerData.stopPropagation,eventHandlerData.preventDefault,eventHandlerData.returnFalse)}keyMatcher.register(keyCombo,eventHandler)}ko.bindingHandlers.onKeyUp={init:function(element,valueAccessor,allBindings,data,context){var bindings=allBindings();var valueBinding=bindings.value;var bindingValue=valueAccessor();if(typeof bindingValue!=='object'){throw new Error('`onKeyUp` bindingValue has to be of type "object", found "'+typeof bindingValue+'"')}var keyMatcher=new EventMatcher;for(var keyCombo in bindingValue){var eventHandlerOptions=ko.utils.extend({},bindingValue[keyCombo]);if(!('stopPropagation'in eventHandlerOptions)){eventHandlerOptions.stopPropagation=bindings.keyupBubble===false}wrapAndRegisterHandler(keyMatcher,keyCombo,eventHandlerOptions)}ko.utils.domData.set(element,'onKeyUpData',keyMatcher);ko.utils.registerEventHandler(element,'keyup',function(e){if(valueBinding){var elementValue=ko.selectExtensions.readValue(element);ko.jsonExpressionRewriting.writeValueToProperty(valueBinding,allBindings,'value',elementValue,true)}var domKeyMatcher=ko.utils.domData.get(element,'onKeyUpData');domKeyMatcher.match(e,data)});ko.utils.registerEventHandler(element,'keydown',function(e){if(valueBinding){var elementValue=ko.selectExtensions.readValue(element);ko.jsonExpressionRewriting.writeValueToProperty(valueBinding,allBindings,'value',elementValue,true)}var domKeyMatcher=ko.utils.domData.get(element,'onKeyUpData');domKeyMatcher.preventDefaultIfMatch(e,data);if(bindings.keydownBubble===false){e.cancelBubble=true;if(e.stopPropagation){e.stopPropagation()}}});ko.utils.domNodeDisposal.addDisposeCallback(element,function(){ko.utils.domData.clear(element)})},update:function(element,valueAccessor,allBindings,data,context){var bindingValue=valueAccessor();if(typeof bindingValue!=='object'){throw new Error('`onKeyUp` bindingValue has to be of type "object", found "'+typeof bindingValue+'"')}var keyMatcher=new EventMatcher;for(var keyCombo in bindingValue){wrapAndRegisterHandler(keyMatcher,keyCombo,bindingValue[keyCombo])}ko.utils.domData.set(element,'onKeyUpData',keyMatcher)}}}))}());(function(){var define=System.amdDefine;define('common/bindings/knockout.events.js',['node_modules/knockout/build/output/knockout-latest.debug.js'],function(ko){function makeEventHandlerShortcut(eventName){ko.bindingHandlers[eventName]={init:function(element,valueAccessor,allBindingsAccessor,viewModel,bindingContext){var newValueAccessor=function(){var result={};result[eventName]=valueAccessor();return result};return ko.bindingHandlers.event.init.call(this,element,newValueAccessor,allBindingsAccessor,viewModel,bindingContext)}}}makeEventHandlerShortcut('mousedown');makeEventHandlerShortcut('touchstart');ko.bindingHandlers.leftMouseDown={init:function(element,valueAccessor,allBindingsAccessor,viewModel,bindingContext){var value=valueAccessor();var handler=ko.utils.unwrapObservable(value);var newValueAccessor=function(){return function(data,event){if(event.which===1){var argsForHandler=ko.utils.makeArray(arguments);handler.apply(viewModel,argsForHandler)}}};return ko.bindingHandlers.mousedown.init.call(this,element,newValueAccessor,allBindingsAccessor,viewModel,bindingContext)}};ko.bindingHandlers.leftDoubleMouseDown={init:function(element,valueAccessor,allBindingsAccessor,viewModel,bindingContext){var value=valueAccessor();var handler=ko.utils.unwrapObservable(value);var clickedOnce=false;var newValueAccessor=function(){return function(data,event){if(event.which===1){if(clickedOnce){var argsForHandler=ko.utils.makeArray(arguments);handler.apply(viewModel,argsForHandler)}else{if(event.preventDefault){event.preventDefault()}clickedOnce=true;setTimeout(function(){clickedOnce=false},300)}}}};return ko.bindingHandlers.mousedown.init.call(this,element,newValueAccessor,allBindingsAccessor,viewModel,bindingContext)}}})}());System.registerDynamic('3rdparty/shinybox/jquery.shinybox.js',[],false,function($__require,$__exports,$__module){var _retrieveGlobal=System.get('@@global-helpers').prepareGlobal($__module.id,null,null);(function($__global){/*---------------------------------------------------------------------------------------------
        
        @author       Constantin Saguin - @brutaldesign
        @link            http://csag.co
        @github        http://github.com/One-com/shinybox
        @version     1.2.1
        @license      MIT License
        
        ----------------------------------------------------------------------------------------------*/
(function(window,document,$){$.shinybox=function(elem,options){var defaults={useCSS:true,initialIndexOnArray:0,hideBarsDelay:3000,videoMaxWidth:1140,vimeoColor:'CCCCCC',beforeOpen:null,afterClose:null,closePlacement:'bottom',captionPlacement:'top',navigationPlacement:'bottom'},plugin=this,elements=[],$elem,selector=elem.selector,$selector=$(selector),isTouch=typeof document.createTouch!=='undefined'||'ontouchstart'in window||'onmsgesturechange'in window||navigator.msMaxTouchPoints,supportSVG=!!window.SVGSVGElement,winWidth=window.innerWidth?window.innerWidth:$(window).width(),winHeight=window.innerHeight?window.innerHeight:$(window).height(),html='';plugin.settings={};plugin.init=function(){plugin.settings=$.extend({},defaults,options);var htmlTop='',htmlBottom='';if(plugin.settings.closePlacement==='top'){htmlTop+='<a id="shinybox-close"></a>'}else if(plugin.settings.closePlacement==='bottom'){htmlBottom+='<a id="shinybox-close"></a>'}if(plugin.settings.captionPlacement==='top'){htmlTop+='<div id="shinybox-caption"></div>'}else if(plugin.settings.captionPlacement==='bottom'){htmlBottom+='<div id="shinybox-caption"></div>'}if(plugin.settings.navigationPlacement==='top'){htmlTop+='<a id="shinybox-prev"></a>'+'<a id="shinybox-next"></a>'}else if(plugin.settings.navigationPlacement==='bottom'){htmlBottom+='<a id="shinybox-prev"></a>'+'<a id="shinybox-next"></a>'}html='<div id="shinybox-overlay">'+'<div id="shinybox-slider"></div>'+'<div id="shinybox-top">'+htmlTop+'</div>'+'<div id="shinybox-bottom">'+htmlBottom+'</div>'+'</div>';if($.isArray(elem)){elements=elem;ui.target=$(window);ui.init(plugin.settings.initialIndexOnArray)}else{$selector.click(function(e){elements=[];var index,relType,relVal;if(!relVal){relType='rel';relVal=$(this).attr(relType)}if(relVal&&relVal!==''&&relVal!=='nofollow'){$elem=$selector.filter('['+relType+'="'+relVal+'"]')}else{$elem=$(selector)}$elem.each(function(){var title=null,href=null;if($(this).attr('title')){title=$(this).attr('title')}if($(this).attr('href')){href=$(this).attr('href')}elements.push({href:href,title:title})});index=$elem.index($(this));e.preventDefault();e.stopPropagation();ui.target=$(e.target);ui.init(index)})}};plugin.refresh=function(){if(!$.isArray(elem)){ui.destroy();$elem=$(selector);ui.actions()}};var ui={init:function(index){if(plugin.settings.beforeOpen)plugin.settings.beforeOpen();this.target.trigger('shinybox-start');$.shinybox.isOpen=true;this.build();this.openSlide(index);this.openMedia(index);this.preloadMedia(index+1);this.preloadMedia(index-1)},build:function(){var $this=this;$('body').append(html);if($this.doCssTrans()){$('#shinybox-slider').css({'-webkit-transition':'left 0.4s ease','-moz-transition':'left 0.4s ease','-o-transition':'left 0.4s ease','-khtml-transition':'left 0.4s ease','transition':'left 0.4s ease'});$('#shinybox-overlay').css({'-webkit-transition':'opacity 1s ease','-moz-transition':'opacity 1s ease','-o-transition':'opacity 1s ease','-khtml-transition':'opacity 1s ease','transition':'opacity 1s ease'});$('#shinybox-bottom, #shinybox-top').css({'-webkit-transition':'0.5s','-moz-transition':'0.5s','-o-transition':'0.5s','-khtml-transition':'0.5s','transition':'0.5s'})}if(supportSVG){var bg=$('#shinybox-close').css('background-image');bg=bg.replace('png','svg');$('#shinybox-prev,#shinybox-next,#shinybox-close').css({'background-image':bg})}$.each(elements,function(){$('#shinybox-slider').append('<div class="slide"></div>')});$this.setDim();$this.actions();$this.keyboard();$this.gesture();$this.animBars();$this.resize()},setDim:function(){var width,height,sliderCss={};if('onorientationchange'in window){window.addEventListener('orientationchange',function(){if(window.orientation===0){width=winWidth;height=winHeight}else if(window.orientation===90||window.orientation===-90){width=winHeight;height=winWidth}},false)}else{width=window.innerWidth?window.innerWidth:$(window).width();height=window.innerHeight?window.innerHeight:$(window).height()}sliderCss={width:width,height:height};$('#shinybox-overlay').css(sliderCss);if(plugin.settings.hideBarsDelay===0){$('#shinybox-slider').css({top:'50px',height:height-100+'px'})}else{$('#shinybox-slider').css({top:0,height:'100%'})}},resize:function(){var $this=this;$(window).resize(function(){$this.setDim()}).resize()},supportTransition:function(){var prefixes='transition WebkitTransition MozTransition OTransition msTransition KhtmlTransition'.split(' ');for(var i=0;i<prefixes.length;i+=1){if(document.createElement('div').style[prefixes[i]]!==undefined){return prefixes[i]}}return false},doCssTrans:function(){if(plugin.settings.useCSS&&this.supportTransition()){return true}},gesture:function(){if(isTouch){var $this=this,distance=null,swipMinDistance=10,startCoords={},endCoords={};var bars=$('#shinybox-top, #shinybox-bottom');bars.addClass('visible-bars');$this.setTimeout();$('body').bind('touchstart',function(e){$(this).addClass('touching');endCoords=e.originalEvent.targetTouches[0];startCoords.pageX=e.originalEvent.targetTouches[0].pageX;$('.touching').bind('touchmove',function(e){e.preventDefault();e.stopPropagation();endCoords=e.originalEvent.targetTouches[0]});return false}).bind('touchend',function(e){e.preventDefault();e.stopPropagation();distance=endCoords.pageX-startCoords.pageX;if(distance>=swipMinDistance){$this.getPrev()}else if(distance<=-swipMinDistance){$this.getNext()}else{if(!bars.hasClass('visible-bars')){$this.showBars();$this.setTimeout()}else{$this.clearTimeout();$this.hideBars()}}$('.touching').off('touchmove').removeClass('touching')})}},setTimeout:function(){if(plugin.settings.hideBarsDelay>0){var $this=this;$this.clearTimeout();$this.timeout=window.setTimeout(function(){$this.hideBars()},plugin.settings.hideBarsDelay)}},clearTimeout:function(){window.clearTimeout(this.timeout);this.timeout=null},showBars:function(){var bars=$('#shinybox-top, #shinybox-bottom');if(this.doCssTrans()){bars.addClass('visible-bars')}else{$('#shinybox-top').animate({top:0},500);$('#shinybox-bottom').animate({bottom:0},500);setTimeout(function(){bars.addClass('visible-bars')},1000)}},hideBars:function(){var bars=$('#shinybox-top, #shinybox-bottom');if(this.doCssTrans()){bars.removeClass('visible-bars')}else{$('#shinybox-top').animate({top:'-50px'},500);$('#shinybox-bottom').animate({bottom:'-50px'},500);setTimeout(function(){bars.removeClass('visible-bars')},1000)}},animBars:function(){var $this=this;var bars=$('#shinybox-top, #shinybox-bottom');bars.addClass('visible-bars');$this.setTimeout();$('#shinybox-slider').click(function(e){if(!bars.hasClass('visible-bars')){$this.showBars();$this.setTimeout()}});$('#shinybox-bottom').hover(function(){$this.showBars();bars.addClass('force-visible-bars');$this.clearTimeout()},function(){bars.removeClass('force-visible-bars');$this.setTimeout()})},keyboard:function(){var $this=this;$(window).bind('keyup',function(e){e.preventDefault();e.stopPropagation();if(e.keyCode===37){$this.getPrev()}else if(e.keyCode===39){$this.getNext()}else if(e.keyCode===27){$this.closeSlide()}})},actions:function(){var $this=this;if(elements.length<2){$('#shinybox-prev, #shinybox-next').hide()}else{$('#shinybox-prev').bind('click touchend',function(e){e.preventDefault();e.stopPropagation();$this.getPrev();$this.setTimeout()});$('#shinybox-next').bind('click touchend',function(e){e.preventDefault();e.stopPropagation();$this.getNext();$this.setTimeout()})}$('#shinybox-close').bind('click touchend',function(e){$this.closeSlide()});$('#shinybox-slider .slide').bind('click',function(e){if(e.target===this){$this.closeSlide()}})},setSlide:function(index,isFirst){isFirst=isFirst||false;var slider=$('#shinybox-slider');if(this.doCssTrans()){slider.css({left:-index*100+'%'})}else{slider.animate({left:-index*100+'%'})}$('#shinybox-slider .slide').removeClass('current');$('#shinybox-slider .slide').eq(index).addClass('current');this.setTitle(index);if(isFirst){slider.fadeIn()}$('#shinybox-prev, #shinybox-next').removeClass('disabled');if(index===0){$('#shinybox-prev').addClass('disabled')}else if(index===elements.length-1){$('#shinybox-next').addClass('disabled')}},openSlide:function(index){$('html').addClass('shinybox');$(window).trigger('resize');this.setSlide(index,true)},preloadMedia:function(index){var $this=this,src=null;if(elements[index]!==undefined){src=elements[index].href}if(!$this.isVideo(src)){setTimeout(function(){$this.openMedia(index)},300)}else{$this.openMedia(index)}},openMedia:function(index){var $this=this,src=null;if(elements[index]!==undefined){src=elements[index].href}if(index<0||index>=elements.length){return false}var $element=$('#shinybox-slider .slide').eq(index);if($this.isVideo(src)){$element.html($this.getVideo(src))}else if($this.isPDF(src)){$element.html($this.getPDF(src))}else{$element.html('<div class="loading"></div>');$this.loadMedia(src,function(){$element.html(this)})}},setTitle:function(index,isFirst){var title=null;$('#shinybox-caption').empty();if(elements[index]!==undefined){title=elements[index].title}if(title){$('#shinybox-caption').text(title)}},isPDF:function(src){if(src){if(src.match(/\.pdf(?:\?|$)/)){return true}}},getPDF:function(url){var iframe='<iframe src="'+url+'">';return'<div class="shinybox-pdf-container"><div class="shinybox-pdf">'+iframe+'</div></div>'},isVideo:function(src){if(src){if(src.match(/youtube\.com\/watch\?v=([a-zA-Z0-9\-_]+)/)||src.match(/vimeo\.com\/([0-9]*)/)){return true}}},getVideo:function(url){var iframe='';var output='';var youtubeUrl=url.match(/watch\?v=([a-zA-Z0-9\-_]+)/);var vimeoUrl=url.match(/vimeo\.com\/([0-9]*)/);if(youtubeUrl){iframe='<iframe width="560" height="315" src="//www.youtube.com/embed/'+youtubeUrl[1]+'" frameborder="0" allowfullscreen></iframe>'}else if(vimeoUrl){iframe='<iframe width="560" height="315"  src="http://player.vimeo.com/video/'+vimeoUrl[1]+'?byline=0&amp;portrait=0&amp;color='+plugin.settings.vimeoColor+'" frameborder="0" webkitAllowFullScreen mozallowfullscreen allowFullScreen></iframe>'}return'<div class="shinybox-video-container" style="max-width:'+plugin.settings.videomaxWidth+'px"><div class="shinybox-video">'+iframe+'</div></div>'},loadMedia:function(src,callback){if(!this.isVideo(src)){var img=$('<img>').on('load',function(){callback.call(img)});img.attr('src',src)}},getNext:function(){var $this=this,index=$('#shinybox-slider .slide').index($('#shinybox-slider .slide.current'));if(index+1<elements.length){index+=1;$this.setSlide(index);$this.preloadMedia(index+1)}else{$('#shinybox-slider').addClass('rightSpring');setTimeout(function(){$('#shinybox-slider').removeClass('rightSpring')},500)}},getPrev:function(){var index=$('#shinybox-slider .slide').index($('#shinybox-slider .slide.current'));if(index>0){index-=1;this.setSlide(index);this.preloadMedia(index-1)}else{$('#shinybox-slider').addClass('leftSpring');setTimeout(function(){$('#shinybox-slider').removeClass('leftSpring')},500)}},closeSlide:function(){$('html').removeClass('shinybox');$(window).trigger('resize');this.destroy()},destroy:function(){$(window).unbind('keyup');$('body').unbind('touchstart');$('body').unbind('touchmove');$('body').unbind('touchend');$('#shinybox-slider').unbind();$('#shinybox-overlay').remove();if(!$.isArray(elem))elem.removeData('_shinybox');if(this.target)this.target.trigger('shinybox-destroy');$.shinybox.isOpen=false;if(plugin.settings.afterClose)plugin.settings.afterClose()}};plugin.init()};$.fn.shinybox=function(options){if(!$.data(this,'_shinybox')){var shinybox=new $.shinybox(this,options);this.data('_shinybox',shinybox)}return this.data('_shinybox')}}(window,document,jQuery))}(this));return _retrieveGlobal()});(function(){var define=System.amdDefine;define('3rdparty/knockout-lightbox/knockout-lightbox.js',['node_modules/jquery/dist/jquery.js','node_modules/knockout/build/output/knockout-latest.debug.js','3rdparty/shinybox/jquery.shinybox.js'],function($,ko){function cancelEvent(e){if(e.preventDefault){e.preventDefault()}if(e.stopPropagation){e.stopPropagation()}return false}ko.bindingHandlers.lightbox={init:function(element,valueAccessor,allBindings,viewModel,context){var $element=$(element),value=valueAccessor(),options={},name='lightbox',dataSource=null,toggle;if(typeof value==='object'){options=value;if('name'in options){name=options.name;delete options.name}if('dataSource'in options){dataSource=options.dataSource;delete options.dataSource}if('toggle'in options&&ko.isObservable(options.toggle)){toggle=options.toggle}}else if(typeof value==='string'&&value.length){name=value}$element.attr('rel',name);if(dataSource===null){dataSource=function(){var $elem=$('[rel='+name+']'),data=[],foundCurrent=false;$elem.each(function(){var title=null,href=null,current=false;if(!foundCurrent){var itemViewModel=ko.dataFor(this);if(itemViewModel===viewModel){current=true;foundCurrent=true}}if($(this).attr('title')){title=$(this).attr('title')}if($(this).attr('href')){href=$(this).attr('href')}data.push({current:current,href:href,title:title})});return data}}else if(typeof dataSource!=='function'){if(Array.isArray(dataSource)){var dataArray=dataSource;dataSource=function(){return dataArray}}else{throw new Error('options.dataSource has to be a function returning an array')}}var lastToggleTime;function toggleLightbox(){var now=new Date,lightboxInstance=ko.utils.domData.get(element,'lightboxInstance');if(lastToggleTime&&now-lastToggleTime<300){return}lastToggleTime=now;if(lightboxInstance){lightboxInstance.destroy();ko.utils.domData.set(element,'lightboxInstance',null)}else{var data=dataSource(viewModel),current=data.filter(function(file){return file.current===true});if(current&&current.length===1){options.initialIndexOnArray=data.indexOf(current[0])}function unsetToggle(){if(toggle){toggle(false)}}if(options.afterClose){var outsideAfterClose=options.afterClose;options.afterClose=function(){unsetToggle();outsideAfterClose()}}else{options.afterClose=unsetToggle}lightboxInstance=$.shinybox(data,options);ko.utils.domData.set(element,'lightboxInstance',lightboxInstance)}}var subscriptions=[];if(toggle){subscriptions.push(toggle.subscribe(function(value){if(value){toggleLightbox()}}))}else{ko.utils.registerEventHandler(element,'click',function(e){toggleLightbox();cancelEvent(e)})}var tap=false,moveIterator=0,touchId,startTime;$element.on('touchstart',function(e){tap=true;moveIterator=0;touchId=e.originalEvent.touches[0].identifier;startTime=new Date;$element.on('touchmove',function(e){if(e.originalEvent.touches[0].identifier===touchId){moveIterator+=1}else{tap=false}if(moveIterator>3){tap=false}})});$element.on('touchend',function(e){$element.off('touchmove');var now=new Date;if(tap&&now-startTime<150){toggleLightbox()}});ko.utils.domNodeDisposal.addDisposeCallback(element,function(){var lightboxInstance=ko.utils.domData.get(element,'lightboxInstance');if(lightboxInstance){lightboxInstance.destroy()}ko.utils.arrayForEach(subscriptions,function(subscription){subscription.dispose()});if(toggle){toggle(false)}ko.utils.domData.clear(element)})}}})}());(function(){var define=System.amdDefine;'format amd';define('3rdparty/tracking-analytics/knockout.track.js',['node_modules/knockout/build/output/knockout-latest.debug.js','node_modules/jquery/dist/jquery.js','node_modules/@one.com/tracking-analytics/lib/tracking.js'],function(ko,$,tracking){ko.bindingHandlers.trackClick={init:function(element,valueAccessor,allBindingsAccessor,viewModel){$(element).on('click',function(){var args=ko.utils.unwrapObservable(valueAccessor()).map(ko.utils.unwrapObservable);tracking.track.apply(tracking,args)})}};ko.bindingHandlers.trackTap={init:function(element,valueAccessor,allBindingsAccessor,viewModel){$(element).on('tap',function(){var args=ko.utils.unwrapObservable(valueAccessor()).map(ko.utils.unwrapObservable);tracking.track.apply(tracking,args)})}}})}());(function(){var define=System.amdDefine;define('common/bindings/fadeSlideVisible.js',['node_modules/knockout/build/output/knockout-latest.debug.js','node_modules/jquery/dist/jquery.js'],function(ko,$){ko.bindingHandlers.fadeSlideVisible={init:function(element,valueAccessor,allBindingsAccessor,viewModel,bindingContext){$(element).toggle(ko.utils.unwrapObservable(valueAccessor()))},update:function(element,valueAccessor,allBindingsAccessor,viewModel,bindingContext){var value=ko.utils.unwrapObservable(valueAccessor());var isCurrentlyVisible=element.style.display!=='none';if(value&&!isCurrentlyVisible){$(element).css('opacity','0').slideDown(100,function(){$(this).animate({opacity:'1'},100)})}else if(!value&&isCurrentlyVisible){$(element).animate({opacity:'0'},100,function(){$(this).slideUp(100,function(){$(this).hide()})})}}}})}());(function(){var define=System.amdDefine;define('3rdparty/knockout.beforeRemove.js',['node_modules/knockout/build/output/knockout-latest.debug.js'],function(ko){ko.bindingHandlers.beforeRemove={init:function(element,valueAccessor,allBindingsAccessor,viewModel,bindingContext){var value=valueAccessor();var handler=ko.utils.unwrapObservable(value);ko.utils.domNodeDisposal.addDisposeCallback(element,function(){handler.call(viewModel,element,viewModel)})}}})}());(function(){var define=System.amdDefine;define('theme/binding/errormsg.js',['node_modules/jquery/dist/jquery.js','node_modules/knockout/build/output/knockout-latest.debug.js'],function($,ko){ko.bindingHandlers.errormsg={init:function(element,valueAccessor){$(element).hide()},update:function(element,valueAccessor){var content=ko.utils.unwrapObservable(valueAccessor()),msgBox=$(element),dismissable=true,level='error';if(content!==null){if(typeof content!=='string'){dismissable=!!content.dismissable;level=content.level||'error';content=content.message}msgBox.stop().hide().empty();if(dismissable){content='<a class="close" data-dismiss="alert">×</a> '+content}msgBox.append('<div class="alert alert-'+level+'">'+content+'</div>');var closeButtons=$('.close',msgBox);if(closeButtons.length){closeButtons.on('mousedown touchstart',function(e){closeButtons.off('mousedown touchstart');valueAccessor()(null)})}var bodyOuterWidth=$('body').outerWidth(),height=msgBox.outerHeight()+2,width=msgBox.outerWidth()+2,left=Math.floor((bodyOuterWidth-width)/2);msgBox.css({'top':-1*height+'px',left:left+'px'});msgBox.show().animate({top:'50px'},200)}else{msgBox.stop().animate({top:-1*(msgBox.outerHeight()+2)+'px'},400,function(){msgBox.hide().empty()})}}}})}());(function(){var define=System.amdDefine;define('theme/binding/notification.js',['node_modules/jquery/dist/jquery.js','node_modules/knockout/build/output/knockout-latest.debug.js'],function($,ko){ko.bindingHandlers.notification={init:function(element,valueAccessor){var notifyBox=$(element);notifyBox.hide();notifyBox.data('counter',0)},update:function(element,valueAccessor){var value=ko.utils.unwrapObservable(valueAccessor()),notifyBox=$(element),content=value,timeout=1000;notifyBox.data('hide-after-timeout',false);if(value!==null&&typeof value!=='string'){content=value.message;timeout=value.timeout||timeout}if(content!==null){notifyBox.data('timed-out',false);notifyBox.data('hide-after-timeout',true);clearTimeout(notifyBox.data('timer'));notifyBox.stop().hide().empty();notifyBox.append('<div class="alert alert-block">'+content+'</div>');var closeButtons=$('.close',notifyBox);if(closeButtons.length){closeButtons.click(function(e){closeButtons.off('click');valueAccessor()(null)})}var bodyOuterWidth=$('body').outerWidth(),height=notifyBox.outerHeight()+2,width=notifyBox.outerWidth()+2,left=Math.floor((bodyOuterWidth-width)/2);notifyBox.css({'top':-1*height+'px',left:left+'px'});notifyBox.show().animate({top:'-5px'},200);var timer=setTimeout(function(){notifyBox.data('timed-out',true);if(notifyBox.data('hide-after-timeout')){notifyBox.stop().animate({top:-1*(notifyBox.outerHeight()+2)+'px'},400,function(){notifyBox.hide().empty()})}},timeout);notifyBox.data('timer',timer)}else{if(notifyBox.data('timed-out')){notifyBox.stop().animate({top:-1*(notifyBox.outerHeight()+2)+'px'},400,function(){notifyBox.hide().empty()})}else{notifyBox.data('hide-after-timeout',true)}}}}})}());(function(){var define=System.amdDefine;define('common/bindings/knockout.highlightText.js',['node_modules/knockout/build/output/knockout-latest.debug.js'],function(ko){ko.bindingHandlers.highlightText={init:function(element,valueAccessor,allBindingsAccessor,viewModel,bindingContext){return{'controlsDescendantBindings':true}},update:function(element,valueAccessor,allBindingsAccessor,viewModel,bindingContext){var value=valueAccessor();if(!('pattern'in value)||!('text'in value)){throw new Error('highlightText must be given a text and a pattern.')}var regex=ko.utils.unwrapObservable(value.pattern);var text=ko.utils.unwrapObservable(value.text);ko.utils.emptyDomNode(element);if(text){var lastIndex=0;if(regex&&!regex.test('')){var m,strong;regex.lastIndex=0;while((m=regex.exec(text))!==null){element.appendChild(element.ownerDocument.createTextNode(text.substring(lastIndex,m.index)));strong=element.ownerDocument.createElement('strong');if(value.className){strong.className=value.className}strong.appendChild(element.ownerDocument.createTextNode(m[0]));element.appendChild(strong);lastIndex=regex.lastIndex}}element.appendChild(element.ownerDocument.createTextNode(text.substring(lastIndex)))}}}})}());(function(){var define=System.amdDefine;define('common/bindings/knockout.animate.js',['node_modules/knockout/build/output/knockout-latest.debug.js'],function(ko){ko.bindingHandlers.animate={init:function(element,valueAccessor){function removeClass(){ko.utils.toggleDomNodeCssClass(element,'animate',false)}['animationend','animationend','webkitAnimationEnd','oanimationend','MSAnimationEnd'].forEach(function(eventName){ko.utils.registerEventHandler(element,eventName,removeClass)});var subscription=valueAccessor().subscribe(function(){ko.utils.toggleDomNodeCssClass(element,'animate-state',true);setTimeout(function(){ko.utils.toggleDomNodeCssClass(element,'animate-state',false);ko.utils.toggleDomNodeCssClass(element,'animate',true)},1)});ko.utils.domNodeDisposal.addDisposeCallback(element,function(){subscription.dispose()})}}})}());(function(){var define=System.amdDefine;define('common/frontendCrashTracking.js',['node_modules/@one.com/tracking-analytics/lib/tracking.js'],function(tracking){var messageMaxLength=140;var disabled=CONFIG.crashReporter.bypassTraceKit||false;if(!disabled){TraceKit.report.subscribe(function(errorReport){var message=errorReport&&errorReport.message||'no message';if(message.length>messageMaxLength){message=message.substr(0,messageMaxLength-3)+'...'}tracking.track('frontend crash',message)},true)}})}());System.registerDynamic('webmail/view/application.ko',[],true,function($__require,exports,module){var define,global=this||self,GLOBAL=global;module.exports=function injectTemplate(tpl){var s=document.createElement('script');s.id=tpl.id;s.innerHTML=window.TR?TR.HTML(tpl.content):tpl.content;s.type='text/html';document.head.appendChild(s)}({'id':'application','content':'<div class="notification" data-bind="notification: notification"></div>\n<div class="errormsg" data-bind="errormsg: errormsg"></div>\n\n<div class="layout container" data-keydomain="listPanel" data-bind="css: { \'calendar-quick-look\': calendarQuickLookEnabled }">\n    <!-- onebar -->\n    <div class="layout top" data-bind="template: { name: \'onebar\' }"></div>\n\n    <!-- application -->\n    <div class="layout center app" data-bind="css: { \'sidebar-collapsed\': layout.sidebar.collapsed(), \'sidebar-expanded\': !layout.sidebar.collapsed(), animated: layout.sidebar.animated }">\n        <!-- folder list -->\n        <div class="layout left sidebar" data-bind="template: \'sidebar\', afterRender: setupSidebar, keybindDomain: \'sidebar\'" tabindex="-1"></div>\n        <!-- mail list and mail view -->\n        <!-- ko \'if\': layout.currentLayout() === \'splitView\' -->\n        <div class="layout center split-view" data-bind="splitView: layout.splitView"></div>\n        <!-- /ko -->\n        <!-- ko \'if\': layout.currentLayout() === \'stackView\' -->\n        <div class="layout center" data-bind="css: { \'show-mail-tabs-bottom\': mailTabs.tabs().length > 0 && layout.isStackView() }">\n            <div class="layout center stack-view" data-bind="template: { name: layout.stackView.currentView() }"></div>\n            <!-- ko \'if\': mailTabs.tabs().length > 0 && layout.isStackView()  -->\n            <div class="layout bottom mail-tabs-panel" data-bind="template: { name: \'mailTabs\', data: mailTabs, \'if\': mailTabs }"></div>\n            <!-- /ko -->\n        </div>\n        <!-- /ko -->\n\n        <!-- calendar slide in -->\n        <one-calendar-slide-in\n            params="state: state,\n                    pageNavigator: pageNavigator,\n                    actionExecutor: actionExecutor,\n                    errorHandler: errorHandler"\n            data-bind="keybindDomain: \'calendar-slide-in\'"\n            tabindex="-1">\n        </one-calendar-slide-in>\n    </div>\n</div>\n<!-- ko with: welcome -->\n<sequence-dialog params="show: newUserDialogVisible, titleIcon: newUserIcon, title: newUserTitle, pages: newUserPages, finishLabel: settingsLabel, nextLabel: nextLabel, finishHandler: gotoSettings, topColor: \'yellow\'"></sequence-dialog>\n<sequence-dialog params="show: newUIDialogVisible, titleIcon: newUIIcon, title: newUITitle, pages: newUIPages, finishLabel: closeLabel, nextLabel: nextLabel, finishHandler: savePrefs, topColor: \'aqua\'"></sequence-dialog>\n<!-- /ko -->\n\n<!-- ko if: mailListView.showConfirmationDialog -->\n<confirmation-dialog params="show: mailListView.blockSenderDialog, topHeight: \'6px\', buttons: [{label: mailListView.cancelLabel, keepOpen: false}, {label: mailListView.confirmLabel, className: \'primary\', callback: mailListView.confirmBlockingSender}], cornerCloser: true, content: mailListView.dialogueContentOfBlockedSenders">\n</confirmation-dialog>\n\n<confirmation-dialog params="show: mailListView.showDialogWithAlreadyBlockedSenders, topHeight: \'6px\', buttons: [{label: mailListView.closeLabel, keepOpen: false, className: \'primary\'}], cornerCloser: true, content: mailListView.dialogueContentOfBlockedSenders">\n</confirmation-dialog>\n<!-- /ko -->\n\n<!-- ko with: eas -->\n<div data-bind="template: { name: \'eas-dialog\', \'if\': isDialogVisible }"></div>\n<!-- /ko -->\n'});return module.exports});System.registerDynamic('webmail/mailList/listPanel.ko',[],true,function($__require,exports,module){var define,global=this||self,GLOBAL=global;module.exports=function injectTemplate(tpl){var s=document.createElement('script');s.id=tpl.id;s.innerHTML=window.TR?TR.HTML(tpl.content):tpl.content;s.type='text/html';document.head.appendChild(s)}({'id':'listPanel','content':'<div class="list layout" data-bind="with: mailListView, keybindDomain: { name: \'listPanel\', firstFocus: \'.mail--list\', lock: true, noDispose: true }">\n    <div class="layout top maillist-toolbar one-toolbar-style" data-bind="template: \'mailListToolbar\'"></div>\n\n    <div class="layout center list-with-toolbar">\n        <div class="layout top">\n            <div class="mail--folder-list--search">\n                <div class="form-search one-search-with-icon" data-i18n="attr: {\'data-title\': \'mail.SearchInSelectedFolder\'}" data-title="Search in selected folder" data-tooltip-placement="right">\n                    <span class="one-search-box">\n                        <i data-bind="click: querySearch" class="icon-search icon-large"></i>\n                        <input type="text" data-bind="value: searchInputValue, onKeyEnter: querySearch, hasfocus: searchFocus, attr: { placeholder: searchPlaceholder }, css: { hasSearchQuery: hasSearchQuery }, keybindDomain: { name: \'listSearch\', noDispose: true }" class="one-search-field">\n                        <i data-bind="visible: hasSearchQuery, click: resetSearchQuery" class="icon-remove icon-large"></i>\n                    </span>\n                </div>\n            </div>\n            <div class="one-toolbar-style selection-bar" data-bind="template: \'mailListSelectionBar\', css: { \'wide-list\': layout.wideList() }"></div>\n        </div>\n        <!-- ko \'if\': page().length() > 0 -->\n        <div class="mailList layout center">\n            <div class="mail--list knockout-list" data-bind="template: { name: \'mailListItem\', foreach: currentMailList }, selection: { selection: selection, focused: focused, anchor: anchor, toggleClass: \'checkbutton\' }, afterRender: setupMailList, event: {blur: focusIsLost()}" tabindex="-1"></div>\n            <!-- ko \'ifnot\': page().loaded() -->\n            <div class="list-items-loading loading-overlay" data-bind="style: { height: $root.loadingPlaceholderHeight() }"><div></div></div>\n            <!-- /ko -->\n        </div>\n        <!-- /ko -->\n        <!-- ko \'ifnot\': page().length() > 0 -->\n        <div class="layout center centeredMessage">\n            <h1 data-i18n="mail.NoMailsFound" data-bind="visible: !isFolderEmpty() && page().loaded()">No mails found</h1>\n            <h1 data-i18n="mail.FolderIsEmpty" data-bind="visible: isFolderEmpty() && page().loaded()">The folder is empty</h1>\n        </div>\n        <!-- /ko -->\n\n        <div class="layout center loading-overlay solid" data-bind="if: !search().isReady(), visible: !search().isReady()"><div></div></div>\n    </div>\n</div>\n'});return module.exports});System.registerDynamic('webmail/view/contentPanel.ko',[],true,function($__require,exports,module){var define,global=this||self,GLOBAL=global;module.exports=function injectTemplate(tpl){var s=document.createElement('script');s.id=tpl.id;s.innerHTML=window.TR?TR.HTML(tpl.content):tpl.content;s.type='text/html';document.head.appendChild(s)}({'id':'contentPanel','content':'<div class="content-panel" data-bind="css: { \'show-mail-tabs-bottom\': mailTabs.tabs().length > 0 && layout.isSplitView() }">\n    <div class="mail layout center" data-bind="template: { name: layout.contentPanel.template(), data: layout.contentPanel.viewModel, afterRender: layout.contentPanel.afterRender }"></div>\n    <!-- ko \'if\': mailTabs.tabs().length > 0 && layout.isSplitView()  -->\n    <div class="layout bottom mail-tabs-panel" data-bind="template: { name: \'mailTabs\', data: mailTabs, \'if\': mailTabs }"></div>\n    <!-- /ko -->\n</div>\n'});return module.exports});System.registerDynamic('webmail/mailTabs/mailTabs.ko',[],true,function($__require,exports,module){var define,global=this||self,GLOBAL=global;module.exports=function injectTemplate(tpl){var s=document.createElement('script');s.id=tpl.id;s.innerHTML=window.TR?TR.HTML(tpl.content):tpl.content;s.type='text/html';document.head.appendChild(s)}({'id':'mailTabs','content':'<div class="mail-tabs layout" data-bind="foreach: { data: tabs, afterAdd: showTabAnimation, beforeRemove: hideTabAnimation }, afterRender: setup">\n    <div class="mail-tab" data-bind="css: { flash: flash, active: $parent.activeTab() === $data, sending: sending, failedSending: failedSending, failedSaving: failedSaving }, click: $parent.toggleTab, trackClick: [\'navigation\', \'open tab\']">\n        <div class="mail-tab-content">\n            <div class="mail-tab-icon"></div>\n            <!-- ko ifnot: subject -->\n            <span class="mail-tab-label" data-i18n="mail.mailView.NoSubject">(No subject)</span>\n            <!-- /ko -->\n            <!-- ko \'if\': subject -->\n            <span class="mail-tab-label" data-bind="text: subject"></span>\n            <!-- /ko -->\n            <button class="mail-tab-remove" data-bind="click: $parent.remove.bind($parent), clickBubble: false, trackClick: [\'navigation\', \'close tab\']" tabindex="-1"></button>\n            <div class="mail-tab-sending-icon icon-spinner"></div>\n            <div class="mail-tab-failed-sending-icon icon-warning" data-title="The mail could not be sent." data-i18n="attr: { \'data-title\': \'mail.MailCouldNotBeSent\'}"></div>\n            <div class="mail-tab-failed-saving-icon icon-warning" data-title="The draft could not be saved." data-i18n="attr: { \'data-title\': \'mail.DraftCouldNotBeSaved\'}"></div>\n        </div>\n    </div>\n</div>\n'});return module.exports});System.registerDynamic('webmail/moveToFolder/moveToFolder.ko',[],true,function($__require,exports,module){var define,global=this||self,GLOBAL=global;module.exports=function injectTemplate(tpl){var s=document.createElement('script');s.id=tpl.id;s.innerHTML=window.TR?TR.HTML(tpl.content):tpl.content;s.type='text/html';document.head.appendChild(s)}({'id':'moveToFolder','content':'<div class="moveToFolder" data-keydomain="---">\n    <div class="item">\n        <input type="text" id="MoveToFolderFilter"\n               data-bind="value: filterBy,\n                          valueUpdate: \'keyup\',\n                          autocomplete: { data: folders,\n                                          format: format,\n                                          maxItems: maxItems,\n                                          minLength: 0,\n                                          onSelect: onSelect,\n                                          target: \'moveToFolderList\' },\n                          afterRender: afterRender"\n               placeholder="Filter folders..."\n               data-i18n="attr: { placeholder: \'mail.moveToFolderPlaceholder\' }">\n    </div>\n    <div class="autocomplete-folderList" id="moveToFolderList"></div>\n</div>\n'});return module.exports});System.registerDynamic('webmail/mailList/mailListToolbar.ko',[],true,function($__require,exports,module){var define,global=this||self,GLOBAL=global;module.exports=function injectTemplate(tpl){var s=document.createElement('script');s.id=tpl.id;s.innerHTML=window.TR?TR.HTML(tpl.content):tpl.content;s.type='text/html';document.head.appendChild(s)}({'id':'mailListToolbar','content':'<p class="maillist-toolbar--label" data-bind="visible: !hasSearchQuery(), text: folder() ? folder().translatedName() : \'\'"></p>\n<p data-bind="visible: hasSearchQuery()" class="maillist-toolbar--label search-query" data-i18n="mail.SearchInboxFor">Search <span class="label" data-bind="text: folder() ? folder().translatedName() : \'\'"></span> for: <span class="searchTerm" data-bind="text: \'“\' + searchQuery() + \'”\'"></span></p>\n<div class="maillist-toolbar--tools">\n    <!-- ko \'if\': layout.isStackView() && hasSelection() -->\n    <toolbar params="narrow: true, secondaries: minorButtons, tertiaries: moreMenu, moreLabel: TR(\'mail.More\', \'More\')"></toolbar>\n    <!-- /ko -->\n    <pagination style="vertical-align: 22px;" params="page: paginationConfig.page, pageLength: paginationConfig.pageLength, fullLength: paginationConfig.fullLength, goto: paginationConfig.goto, loaded: paginationConfig.loaded"></pagination>\n    </div>\n</div>\n'});return module.exports});System.registerDynamic('webmail/mailList/mailListSelectionBar.ko',[],true,function($__require,exports,module){var define,global=this||self,GLOBAL=global;module.exports=function injectTemplate(tpl){var s=document.createElement('script');s.id=tpl.id;s.innerHTML=window.TR?TR.HTML(tpl.content):tpl.content;s.type='text/html';document.head.appendChild(s)}({'id':'mailListSelectionBar','content':'<div class="selection-bar--item selection-bar--select-menu">\n    <div class="selection-bar--button dropdown-toggle" data-bind="dropdownTemplate: { template: \'MailListSelectionBarSelect\' }" href="#" data-i18n="attr: {\'data-title\': \'mail.SetSelection\'}" data-title="Set selection">\n        <span class="icon-checkbox checked"></span>\n        <span class="caret"></span>\n    </div>\n    <script id="MailListSelectionBarSelect" type="text/html">\n        <ul class="selection-bar--menu popupDropdown" data-keydomain="listpanel">\n            <li class="dropdown-item" data-bind="click: deselectAll, trackClick: [\'mail list\', \'deselect all\']"><span data-i18n="mail.SelectNone">Select none</span></li>\n            <li class="dropdown-item" data-bind="click: selectAll, trackClick: [\'mail list\', \'select all\']"><span data-i18n="mail.SelectAll">Select all</span></li>\n            <li class="dropdown-item" data-bind="click: selectRead, trackClick: [\'mail list\', \'select read\']"><span data-i18n="mail.SelectRead">Select read</span></li>\n            <li class="dropdown-item" data-bind="click: selectUnread, trackClick: [\'mail list\', \'select unread\']"><span data-i18n="mail.SelectUnread">Select unread</span></li>\n            <li class="dropdown-item" data-bind="click: selectFlagged, trackClick: [\'mail list\', \'select starred\']"><span data-i18n="mail.SelectStarred">Select starred</span></li>\n        </ul>\n    </script>\n</div>\n\n<div class="selection-bar--item selection-bar--sort-menu">\n    <div class="selection-bar--button dropdown-toggle" data-bind="dropdownTemplate: { template: \'MailListSelectionBarSort\' }" href="#" data-i18n="attr: { \'data-title\': \'mail.SortShownMails\'}" data-title="Sort shown mails">\n        <span data-bind="visible: search().sortKey === \'ARRIVAL\'" data-i18n="mail.SortByDate">Sort: Date</span>\n        <!-- ko \'if\': $root.folderListView.selected() && $root.folderListView.selected().isOutgoingFolder() -->\n        <span data-bind="visible: search().sortKey === \'TO\'" data-i18n="mail.SortByTo">Sort: To</span>\n        <!-- /ko -->\n        <!-- ko ifnot: $root.folderListView.selected() && $root.folderListView.selected().isOutgoingFolder() -->\n        <span data-bind="visible: search().sortKey === \'FROM\'" data-i18n="mail.SortByFrom">Sort: From</span>\n        <!-- /ko -->\n        <span data-bind="visible: search().sortKey === \'SUBJECT\'" data-i18n="mail.SortBySubject">Sort: Subject</span>\n        <b class="caret"></b>\n    </div>\n    <script id="MailListSelectionBarSort" type="text/html">\n        <ul class="selection-bar--menu popupDropdown" data-keydomain="listpanel">\n            <li class="dropdown-item" data-bind="click: setSortKey.bind($data, \'ARRIVAL\'), trackClick: [\'mail list\', \'sort by arrival\']"><span data-i18n="mail.SortByDate">Sort: Date</span><span data-bind="visible: search().sortKey === \'ARRIVAL\'"> <i class="icon-checkmark"></i></span></li>\n            <!-- ko \'if\': $root.folderListView.selected() && $root.folderListView.selected().isOutgoingFolder() -->\n            <li class="dropdown-item" data-bind="click: setSortKey.bind($data, \'TO\'), trackClick: [\'mail list\', \'sort by to\']"><span data-i18n="mail.SortByTo">Sort: To</span><span data-bind="visible: search().sortKey === \'TO\'"> <i class="icon-checkmark"></i></span></li>\n            <!-- /ko -->\n            <!-- ko ifnot: $root.folderListView.selected() && $root.folderListView.selected().isOutgoingFolder() -->\n            <li class="dropdown-item" data-bind="click: setSortKey.bind($data, \'FROM\'), trackClick: [\'mail list\', \'sort by from\']"><span data-i18n="mail.SortByFrom">Sort: From</span><span data-bind="visible: search().sortKey === \'FROM\'"> <i class="icon-checkmark"></i></span></li>\n            <!-- /ko -->\n            <li class="dropdown-item" data-bind="click: setSortKey.bind($data, \'SUBJECT\'), trackClick: [\'mail list\', \'sort by subject\']"><span data-i18n="mail.SortBySubject">Sort: Subject</span><span data-bind="visible: search().sortKey === \'SUBJECT\'"> <i class="icon-checkmark"></i></span></li>\n            <li class="dropdown-divider"></li>\n            <li class="dropdown-item" data-bind="click: setSortDirection.bind($data, \'ASC\'), trackClick: [\'mail list\', \'sort direction ascending\']"><span data-i18n="mail.SortAscending">Ascending</span><span data-bind="visible: search().sortDirection === \'ASC\'"> <i class="icon-checkmark"></i></span></li>\n            <li class="dropdown-item" data-bind="click: setSortDirection.bind($data, \'DESC\'), trackClick: [\'mail list\', \'sort direction descending\']"><span data-i18n="mail.SortDescending">Descending</span><span data-bind="visible: search().sortDirection === \'DESC\'"> <i class="icon-checkmark"></i></span></li>\n        </ul>\n    </script>\n</div>\n\n<div class="selection-bar--item selection-bar--filter-menu">\n    <div class="selection-bar--button dropdown-toggle" data-bind="dropdownTemplate: { template: \'MailListSelectionBarFilter\', positioning: { horizontal: \'inside-right\' } }" href="#" data-i18n="attr: {\'data-title\': \'mail.FilterShownMails\'}" data-title="Filter shown mails">\n        <span data-bind="visible: search().viewFilter === \'ALL\'" data-i18n="mail.ShowAll">Show: All</span>\n        <span data-bind="visible: search().viewFilter === \'UNSEEN\'" data-i18n="mail.ShowUnseen">Show: Unread</span>\n        <span data-bind="visible: search().viewFilter === \'FLAGGED\'" data-i18n="mail.ShowStarred">Show: With star</span>\n        <b class="caret"></b>\n    </div>\n    <script id="MailListSelectionBarFilter" type="text/html">\n        <ul class="selection-bar--menu popupDropdown" data-keydomain="listpanel">\n            <li class="dropdown-item" data-bind="click: setViewFilter.bind($data, \'ALL\'), trackClick: [\'mail list\', \'show all\']"><span data-i18n="mail.ShowAll">Show: All</span> <span data-bind="visible: search().viewFilter === \'ALL\'"> <i class="icon-checkmark"></i></span></li>\n            <li class="dropdown-item" data-bind="click: setViewFilter.bind($data, \'UNSEEN\'), trackClick: [\'mail list\', \'show unread\']"><span data-i18n="mail.ShowUnseen">Show: Unread</span> <span data-bind="visible: search().viewFilter === \'UNSEEN\'"> <i class="icon-checkmark"></i></span></li>\n            <li class="dropdown-item" data-bind="click: setViewFilter.bind($data, \'FLAGGED\'), trackClick: [\'mail list\', \'show starred\']"><span data-i18n="mail.ShowStarred">Show: With star</span> <span data-bind="visible: search().viewFilter === \'FLAGGED\'"> <i class="icon-checkmark"></i></span></li>\n        </ul>\n    </script>\n</div>\n'});return module.exports});System.registerDynamic('webmail/mailList/mailListItem.ko',[],true,function($__require,exports,module){var define,global=this||self,GLOBAL=global;module.exports=function injectTemplate(tpl){var s=document.createElement('script');s.id=tpl.id;s.innerHTML=window.TR?TR.HTML(tpl.content):tpl.content;s.type='text/html';document.head.appendChild(s)}({'id':'mailListItem','content':'<div class="list-item draggable"\n     data-bind="css: {\n                    unseen: !seen(),\n                    answered: answered,\n                    forwarded: forwarded,\n                    selected: selected,\n                    focused: focused,\n                    flagged: flagged,\n                    attachment: hasAttachments,\n                    dragging: dragging,\n                    \'wide-list\': $root.layout.wideList()\n                },\n                dragZone: {\n                    name: \'mail\',\n                    data: { mail: $data },\n                    element: \'mail-drag-element-template\',\n                    dragStart: $root.dragMailsStart.bind($root),\n                    dragEnd: $root.dragMailsEnd.bind($root)\n                }">\n    <div class="focus-indicator"></div>\n    <div class="draghandle" data-i18n="attr: {\'data-title\': \'mail.DragEmail\'}" data-title="Drag email"></div>\n    <button class="checkbutton" tabindex="-1" autocomplete="off" value="" hidefocus="true" role="checkbox" data-i18n="attr: {\'data-title\': \'mail.ToggleSelected\'}" data-title="Select/Deselect"><i class="check"></i></button>\n    <i class="read" data-i18n="attr: {\'data-title\': \'mail.ToggleRead\'}" data-title="Toggle read/unread"></i>\n    <i class="star" data-i18n="attr: {\'data-title\': \'mail.ToggleStarred\'}" data-title="Toggle starred"></i>\n    <div class="layout center">\n        <!-- ko \'if\': $parent.folder() && $parent.folder().isOutgoingFolder() -->\n        <div data-bind="css: { \'layout left\': $root.layout.wideList() }" class="to" visible="to">\n            <span data-i18n="mail.ToColon">To:</span>\n            <span data-bind="highlightText: { text: to.toDisplayString(), pattern: $parent.toRegex, className: \'searchTerm\' }"></span>\n        </div>\n        <!-- /ko -->\n        <!-- ko ifnot: $parent.folder() && $parent.folder().isOutgoingFolder() -->\n        <div data-bind="highlightText: { text: from.toDisplayString(), pattern: $parent.fromRegex, className: \'searchTerm\' }, css: { \'layout left\': $root.layout.wideList() }" class="from" visible="from"></div>\n        <!-- /ko -->\n        <div data-bind="highlightText: { text: displaySubject(), pattern: $parent.subjectRegex, className: \'searchTerm\' }, css: { \'layout center\': $root.layout.wideList() }" class="subject"></div>\n    </div>\n    <div class="layout right">\n        <!-- ko ifnot: $root.layout.wideList() -->\n        <div data-bind="formatDate: {value: arrivalDate, formatId: \'Hm/shortDate\' }" class="date"></div>\n        <!-- /ko -->\n        <!-- ko \'if\': sending -->\n        <i class="icon-spinner"></i>\n        <!-- /ko -->\n        <i class="answered" data-i18n="attr: {\'data-title\': \'mail.Answered\'}" data-title="Replied"></i>\n        <i class="forwarded" data-i18n="attr: {\'data-title\': \'mail.Forwarded\'}" data-title="Forwarded"></i>\n        <i class="attachment" data-i18n="attr: {\'data-title\': \'mail.HasAttachment\'}" data-title="Has attachment"></i>\n        <!-- ko \'if\': failedSaving() && $parent.folder().isDraftFolder() -->\n        <i class="failed" data-i18n="attr: {\'data-title\': \'mail.NotSaved\'}" data-title="Draft has not been saved"></i>\n        <!-- /ko -->\n        <!-- ko \'if\': failedSending() && $parent.folder().supportResending() -->\n        <i class="failed" data-i18n="attr: {\'data-title\': \'mail.NotSent\' }" data-title="Mail has not been sent"></i>\n        <!-- /ko -->\n        <!-- ko \'if\': $root.layout.wideList() -->\n        <div data-bind="formatDate: {value: arrivalDate, formatId: \'Hm/shortDate\' }" class="date"></div>\n        <!-- /ko -->\n    </div>\n\n    <script type="text/html" id="mail-drag-element-template">\n        <div class="drag-label" data-bind="text: inter.trQuantity(TR(\'mail.MoveMails\', {one: \'Moving {0} mail\', other: \'Moving {0} mails\'}), selection.length)"></div>\n    </script>\n</div>\n'});return module.exports});System.registerDynamic('webmail/mailList/selection.ko',[],true,function($__require,exports,module){var define,global=this||self,GLOBAL=global;module.exports=function injectTemplate(tpl){var s=document.createElement('script');s.id=tpl.id;s.innerHTML=window.TR?TR.HTML(tpl.content):tpl.content;s.type='text/html';document.head.appendChild(s)}({'id':'selection','content':'<!-- ko with: $root.mailListView -->\n<div class="layout top content-toolbar one-toolbar-style">\n    <toolbar params="narrow: layout.isNarrowView, secondaries: minorButtons, tertiaries: moreMenu, moreLabel: TR(\'mail.More\', \'More\')"></toolbar>\n</div>\n<div class="layout center centeredMessage" data-bind="css: {\'aLittleLower\': page().loaded() && page().length() <= 0 }">\n    <h1 data-bind="visible: !hasSelection()" data-i18n="mail.composer.NoEmailSelected">No email selected</h1>\n    <h1 data-bind="visible: hasSelection()">\n        <card-stack params="template: \'mail-selection-icon\', data: selection"></card-stack>\n        <br>\n        <span data-bind="text: inter.trQuantity(TR(\'mail.composer.NumMailsSelected\', { one: \'{0} mail selected\', other: \'{0} mails selected\' }), selection().length)"></span>\n    </h1>\n</div>\n<!-- /ko -->\n\n<script type="text/html" id="mail-selection-icon">\n    <div class="icon-mail-big"></div>\n</script>\n'});return module.exports});System.registerDynamic('webmail/view/sidebar.ko',[],true,function($__require,exports,module){var define,global=this||self,GLOBAL=global;module.exports=function injectTemplate(tpl){var s=document.createElement('script');s.id=tpl.id;s.innerHTML=window.TR?TR.HTML(tpl.content):tpl.content;s.type='text/html';document.head.appendChild(s)}({'id':'sidebar','content':'<div class="layout folder one-sidebar" data-bind="css: { \'failed-drafts\': mailTabs.hasFailedDrafts(), \'has-unsent-mails\': hasUnsentMails }, dragEvents: { accepts: [\'folder\', \'mail\'], dragLeave: layout.sidebar.leave, dragEnter: expandIfCollapsed.bind($root) }">\n    <div class="layout top one-toolbar-style">\n         <div class="one-button-style--primary one-new-mail" data-bind="click: newMail, trackClick: [\'navigation\', \'compose mail\']"><span class="iconWrite compose-button-icon"></span><span data-i18n="mail.ComposeMail" class="compose-button-label">Write Mail</span></div>\n    </div>\n    <div class="layout center folder-list"\n         data-bind="dropZone: {\n                        accepts: \'folder\',\n                        dragEnter: folderListView.dragEnterOnInbox.bind(folderListView),\n                        drop: folderListView.dropOnInbox.bind(folderListView)\n                    }">\n        <div class="layout center one-sidebar--list" data-bind="scrollableOnDragOver: [\'folder\', \'mail\']">\n            <!-- ko template: { name: \'folderList\', data: folderListView } --><!-- /ko -->\n        </div>\n    </div>\n    <div class="layout center loading-overlay solid" data-bind="if: state.folders.loading() && !layout.sidebar.collapsed(), visible: state.folders.loading() && !layout.sidebar.collapsed()"><div></div></div>\n    <div class="layout bottom one-sidebar--options dropup">\n        <button tabindex="-1" data-bind="visible: !layout.verySmall(), dropdownTemplate: { template: \'SidebarLayoutDropdown\', positioning: { vertical: \'outside-top\' } }" data-tooltip-placement="right" data-i18n="attr: {\'data-title\': \'mail.SelectLayout\'}" data-title="Select layout">\n            <span class="icon-layout-open-horizontal" data-bind="visible: layout.isSplitView() && layout.splitView.horizontal()"></span>\n            <span class="icon-layout-open-split" data-bind="visible: layout.isSplitView() && !layout.splitView.horizontal()"></span>\n            <span class="icon-layout-open-stack" data-bind="visible: layout.isStackView()"></span>\n        </button>\n\n        <button tabindex="-1" class="middle-button" data-bind="popupTemplate: { template: \'keybindings\', positioning: { vertical: \'outside-top\', horizontal: \'inside-left\' }, className: \'legendPopup\', data: $root.getKeybindingLegend(), openState: $root.showKeyShortcuts }"><i class="icon-keyboard"></i></button>\n        <button tabindex="-1" class="right-button" data-bind="click: folderListView.refreshFolders.bind(folderListView, false), trackClick: [\'mail list\', \'refresh\']" data-i18n="attr: {\'data-title\': \'mail.Refresh\'}" data-title="Get new mails" data-tooltip-placement="right"><i class="icon-refresh icon-large"></i></button>\n    </div>\n</div>\n\n<script id="SidebarLayoutDropdown" type="text/html">\n    <ul class="popupDropdown one-sidebar--layout-menu" data-bind="visible: !layout.verySmall()" >\n        <li class="dropdown-item one-sidebar--layout-menu-item" data-bind="click: layout.selectOneColumn, trackClick: [\'layout\', \'stack layout\']"><span class="icon-layout-open-stack"></span></li>\n        <li class="dropdown-item one-sidebar--layout-menu-item" data-bind="visible: !layout.isShortView(), click: layout.selectHorizontalSplit, trackClick: [\'layout\', \'horizontal-split layout\']"><span class="icon-layout-open-horizontal"></span></li>\n        <li class="dropdown-item one-sidebar--layout-menu-item" data-bind="visible: !layout.isNarrowView(), click: layout.selectTwoColumn, trackClick: [\'layout\', \'vertical-split layout\']"><span class="icon-layout-open-split"></span></li>\n    </ul>\n</script>\n'});return module.exports});System.registerDynamic('webmail/folderList/folderList.ko',[],true,function($__require,exports,module){var define,global=this||self,GLOBAL=global;module.exports=function injectTemplate(tpl){var s=document.createElement('script');s.id=tpl.id;s.innerHTML=window.TR?TR.HTML(tpl.content):tpl.content;s.type='text/html';document.head.appendChild(s)}({'id':'folderList','content':'<div data-bind="dropZone: ignoreDrop, css: { \'editing-folder\': editing.folder }">\n    <div data-bind="template: {\n                      name: \'folderListItem\',\n                      foreach: state.folders.system\n                    },\n                    selection: {\n                      data: state.folders.list,\n                      selection: selection,\n                      mode: \'single\'\n                    },\n                    afterRender: setupFolderList">\n    </div>\n    <!-- ko ifnot: collapsed -->\n    <div class="one-sidebar--heading" data-bind="dropZone: {\n                  accepts: \'folder\',\n                  dragEnter: dragEnterOnInbox.bind($data),\n                  drop: dropOnInbox.bind($data)\n                }">\n        <span class="one-sidebar--heading--label" data-i18n="mail.CustomFolders">Folders</span>\n    </div>\n    <div class="one-sidebar--list-item folder--blank-slate" data-bind="leftMouseDown: createCustomFolder">\n        <span data-i18n="mail.AddCustomFolder">Create new folder</span>\n        <div class="one-sidebar--list-item--fade">\n            <button class="icon-add-item"></button>\n        </div>\n    </div>\n    <!-- /ko -->\n    <div data-bind="template: {\n                      name: \'folderListItem\',\n                      foreach: state.folders.other\n                    },\n                    selection: {\n                      data: state.folders.list,\n                      selection: selection,\n                      mode: \'single\'\n                    },\n                    afterRender: setupFolderList">\n    </div>\n</div>\n<div data-bind="click: layout.sidebar.expand, css: { active: customSelected() }" data-i18n="attr: { \'data-title\': \'mail.CustomFolders\' }" data-title="Folders" data-tooltip-placement="right" class="one-sidebar--list-item folder-list--custom-folders">\n    <div class="folder-label"><i class="icon-folders"></i></div>\n</div>\n\n<script type="text/html" id="folder-drag-element-template">\n    <div class="drag-label" data-i18n="mail.DragFolder">Moving folder <span data-bind="text: name"></span></div>\n</script>\n'});return module.exports});System.registerDynamic('webmail/folderList/folderListItem.ko',[],true,function($__require,exports,module){var define,global=this||self,GLOBAL=global;module.exports=function injectTemplate(tpl){var s=document.createElement('script');s.id=tpl.id;s.innerHTML=window.TR?TR.HTML(tpl.content):tpl.content;s.type='text/html';document.head.appendChild(s)}({'id':'folderListItem','content':'<div data-bind="css: {\n                    active: selected,\n                    indicator: indicator(),\n                    \'with-options\': !isInbox(),\n                    customFolder: isCustomFolder(),\n                    hidden: hidden(),\n                    animated: animated(),\n                    dragging: dragging\n                },\n                dropZone: {\n                    accepts: [\'folder\', \'mail\'],\n                    drop: $parent.dropOnFolder.bind($parent),\n                    dragEnter: $parent.dragEnterElement.bind($parent),\n                    dragLeave: $parent.dragLeaveElement.bind($parent)\n                },\n                dragZone: {\n                    name: \'folder\',\n                    element: \'folder-drag-element-template\',\n                    data: { folder: $data },\n                    dragStart: $parent.dragStart.bind($parent),\n                    dragEnd: $parent.dragEnd.bind($parent)\n                },\n                attr: {\'data-title\': label}"\n            data-tooltip-placement="right" class="one-sidebar--list-item">\n    <!-- ko \'ifnot\': $parent.editing.folder() === $data -->\n    <div class="one-sidebar--list-item--fade">\n        <button tabindex="-1" class="one-sidebar--list-item--options icon-cog"\n                data-bind="dropdownTemplate: {\n                               template: \'folderListItemDropdown\',\n                               beforeOpen: $parent.onMenuOpen.bind($parent),\n                               beforeClose: $parent.onMenuClose.bind($parent),\n                               positioning: {\n                                   horizontal: \'inside-right\'\n                               }\n                           }"></button>\n        <div class="one-sidebar--list-item--indicator" data-bind="text: indicator() || \'\', css: { \'unsent-warning\': id() === \'INBOX.Sent\' }"></div>\n    </div>\n    <!-- /ko -->\n    <div class="folder-label"\n         data-bind="style: {\n                        marginLeft: (depth() * 10) + \'px\'\n                    },\n                    listItemError: {\n                        data: $parent.editing.errorMessage,\n                        openState: ko.computed(function () {return $parent.editing.folder() === $data && $parent.editing.showError();})\n                    }">\n        <!-- ko \'if\': collapsed() || collapsable() -->\n        <button class="folder-toggle" data-bind="text: collapsed() ? \'+\' : \'−\'" data-i18n="">+</button>\n        <!-- /ko -->\n        <i data-bind="css: iconClass" class="one-sidebar--list-item--icon"></i>\n\n        <!-- ko \'if\': $parent.editing.folder() === $data -->\n        <rename-editor class="folder-list--input"\n                       params="value: $parent.editing.name,\n                               commit: $parent.commitEdit.bind($parent),\n                               cancel: $parent.cancelEdit.bind($parent),\n                               blur: $parent.onRenameBlur.bind($parent),\n                               style: { width: (150 - depth() * 10) + \'px\' },\n                               attr: { placeholder: TR(\'mail.NamePlaceholder\', \'Folder name\') }"></rename-editor>\n        <!-- /ko -->\n        <!-- ko \'ifnot\': $parent.editing.folder() === $data -->\n        <span data-bind="text: translatedName" class="folder-name"></span>\n        <!-- /ko -->\n    </div>\n</div>\n'});return module.exports});System.registerDynamic('webmail/folderList/folderListItemDropdown.ko',[],true,function($__require,exports,module){var define,global=this||self,GLOBAL=global;module.exports=function injectTemplate(tpl){var s=document.createElement('script');s.id=tpl.id;s.innerHTML=window.TR?TR.HTML(tpl.content):tpl.content;s.type='text/html';document.head.appendChild(s)}({'id':'folderListItemDropdown','content':'<ul class="popupDropdown">\n    <li class="dropdown-item" data-bind="visible: supportRename(), click: $parent.renameFolder.bind($parent), trackClick: [\'folder list\', \'rename folder\']" data-i18n="mail.RenameFolder">Rename folder</li>\n    <li class="dropdown-item" data-bind="visible: supportCreateSubfolder(), click: $parent.createSubfolder.bind($parent), trackClick: [\'folder list\', \'create subfolder\']" data-i18n="mail.CreateSubfolder">Create subfolder</li>\n    <li class="dropdown-item" data-bind="visible: supportDelete(), click: $parent.deleteFolder.bind($parent), trackClick: [\'folder list\', \'delete folder\']" data-i18n="mail.DeleteFolder">Delete folder</li>\n    <li class="dropdown-item" data-bind="visible: supportMoveToTrash(), click: $parent.moveToTrash.bind($parent), trackClick: [\'folder list\', \'move to trash\']" data-i18n="mail.MoveToTrash">Move to trash</li>\n    <li class="dropdown-item" data-bind="visible: supportSpamToTrash(), click: $parent.moveSpamToTrash.bind($parent), trackClick: [\'folder list\', \'spam to trash\']" data-i18n="mail.SpamToTrash">Move spam to trash</li>\n    <li class="dropdown-item" data-bind="visible: supportEmptyFolder(), click: $parent.emptyFolder.bind($parent), trackClick: [\'folder list\', \'empty trash\']" data-i18n="mail.EmptyTrash">Empty trash</li>\n</ul>\n'});return module.exports});System.registerDynamic('onebar/onebar.ko',[],true,function($__require,exports,module){var define,global=this||self,GLOBAL=global;module.exports=function injectTemplate(tpl){var s=document.createElement('script');s.id=tpl.id;s.innerHTML=window.TR?TR.HTML(tpl.content):tpl.content;s.type='text/html';document.head.appendChild(s)}({'id':'onebar','content':'<div class="one-bar" data-bind="unselectable: true">\n    <div class="one-bar--logo"><a class="one-bar--logo--link" href="/"></a></div>\n    <ul class="one-bar--controls">\n        <!-- ko if: state.preferences.EAS().available && !state.preferences.EAS().currentSubscription -->\n        <li class="one-bar--controls--item special-offer-button">\n            <a data-bind="attr: { href: \'/settings/\' + state.user() + \'/eas\' }" data-i18n="onebar.ExchangeActiveSync" class="one-bar--controls--item--link">Activate Mobile Sync</a>\n        </li>\n        <!-- /ko -->\n        <li class="one-bar--user one-bar--controls--item"><span data-bind="visible: state.displayUser" class="one-bar--user--avatar"></span><span data-bind="text: state.displayUser"><span data-i18n="onebar.NotLoggedIn">Not logged in</span></span></li>\n        <li class="localeSelector btn-group dropdown one-bar--controls--item" data-bind="dropdownTemplate: { template: \'onebarLanguageDropdown\', positioning: { horizontal: \'inside-right\' } }">\n            <span class="dropdown-toggle">\n                <span data-bind="text: localeSwitcher.getLanguage($root.currentLocaleId).displayName"></span>\n                <b class="caret"></b>\n            </span>\n        </li>\n        <li class="one-bar--controls--item"><a href="#" data-bind="click: logout, trackClick: [\'action\', \'log out\']" class="one-bar--controls--item--link"><span data-i18n="onebar.LogOut">Log out</span></a></li>\n    </ul>\n    <ul class="one-bar--applications">\n        <li data-bind="css: { active: application === \'webmail\' }" class="one-bar--applications--item"><a href="/" data-i18n="onebar.Mail" class="one-bar--applications--item--link">Mail</a></li>\n        <li data-bind="css: { active: application === \'calendar\' }" class="one-bar--applications--item"><a href="/calendar" data-i18n="onebar.Calendar" class="one-bar--applications--item--link">Calendar</a></li>\n        <li data-bind="css: { active: application === \'contacts\' }" class="one-bar--applications--item"><a href="/contacts" data-i18n="onebar.Contacts" class="one-bar--applications--item--link">Contacts</a></li>\n        <li data-bind="css: { active: application === \'settings\' }" class="one-bar--applications--item"><a href="/settings" data-i18n="onebar.Settings" class="one-bar--applications--item--link">Settings</a></li>\n    </ul>\n    <script id="onebarLanguageDropdown" type="text/html">\n        <ul class="popupDropdown one-bar--locale-selector" data-bind="foreach: localeSwitcher.localeInfos">\n            <li class="dropdown-item" data-bind="click: function () { $root.localeSwitcher.switchLocale(id) }">\n                <span data-bind="text: displayName"></span>\n                <span data-bind="visible: id === $root.currentLocaleId"> <i class="icon-checkmark"></i></span>\n                <span data-bind="attr: {\'class\': \'flags flags-\' + id}"></span>\n            </li>\n        </ul>\n    </script>\n</div>\n'});return module.exports});System.registerDynamic('webmail/view/toolbar.ko',[],true,function($__require,exports,module){var define,global=this||self,GLOBAL=global;module.exports=function injectTemplate(tpl){var s=document.createElement('script');s.id=tpl.id;s.innerHTML=window.TR?TR.HTML(tpl.content):tpl.content;s.type='text/html';document.head.appendChild(s)}({'id':'toolbar','content':'<!-- ko \'if\': layout.isStackView() || layout.mailList.visible() -->\n<div class="one-toolbar-item" data-bind="visible: hasSelection()">\n    <button class="one-toolbar-button no-border-button icon-button" data-bind="popupTemplate: moveToFolder">\n        <span class="icon-folder"></span>\n        <span data-i18n="mail.Move">Move</span>\n    </button>\n</div>\n\n<div class="one-toolbar-item" data-bind="visible: hasSelection()">\n    <button class="one-toolbar-button no-border-button icon-button" data-bind="click: deleteSelectedMails, trackClick: [\'mail list\', \'delete mails\', \'count\', selection().length]">\n        <span class="icon-delete"></span>\n        <span data-i18n="mail.Delete">Delete</span>\n    </button>\n</div>\n\n<!-- ko \'if\': $root.mailListView.selection().length > 0 -->\n<div class="one-toolbar-item dropdown-toggle" data-bind="dropdownTemplate: { template: \'toolbarMoreDropdown\', openState: shouldBeOpened, afterClose: onPopupCloseEvent, afterOpen: onPopupOpenEvent, positioning: { horizontal: \'inside-right\', vertical: \'outside-bottom\' } }">\n    <button class="one-toolbar-button no-border-button" href="#">\n        <span data-i18n="mail.More">More</span>\n        <span class="caret"></span>\n    </button>\n</div>\n<!-- /ko -->\n\n<script id="toolbarMoreDropdown" type="text/html">\n    <ul class="popupDropdown">\n        <li class="dropdown-item" data-bind="visible: shownMailView, click: printMail, trackClick: [\'view mail\', \'print\']"><span data-i18n="mail.mailView.Print">Print</span></li>\n        <li class="dropdown-item" data-bind="visible: hasUnseen(), click: markAsSeen, trackClick: [\'mail list\', \'mark as read\']"><span data-i18n="mail.MarkAsRead">Mark as read</span></li>\n        <li class="dropdown-item" data-bind="visible: hasSeen(), click: markAsUnseen, trackClick: [\'mail list\', \'mark as unread\']"><span data-i18n="mail.MarkAsUnread">Mark as unread</span></li>\n        <li class="dropdown-item"  data-bind="visible: hasUnflagged(), click: addFlag, trackClick: [\'mail list\', \'add star\']"><span data-i18n="mail.AddStar">Add star</span></li>\n        <li class="dropdown-item"  data-bind="visible: hasFlagged(), click: removeFlag, trackClick: [\'mail list\', \'remove star\']"><span data-i18n="mail.RemoveStar">Remove star</span></li>\n        <li class="dropdown-item" data-bind="click: createFilter, trackClick: [\'mail list\', \'create filter\']"><span data-i18n="mail.CreateFilter">Create filter</span></li>\n        <li class="dropdown-item"  data-bind="click: blockSenders.bind( $data, $parents[1]), trackClick: [\'mail list\', \'block senders\']"><span data-i18n="mail.BlockSender">Block sender</span></li>\n        <li class="dropdown-item" data-bind="visible: shownMailView, click: viewMailSource, trackClick: [\'view mail\', \'view source\']"><span data-i18n="mail.ViewMailSource">View email source</span></li>\n        <li class="dropdown-item" data-bind="visible: shownMailView, click: openInNewWindow, trackClick: [\'view mail\', \'view in new window\']"><span data-i18n="mail.OpenInNewWindow">Open in new window</span></li>\n        <li class="dropdown-item" data-bind="visible: shownMailView, click: editMailAsNew, trackClick: [\'view mail\', \'edit as new\']"><span data-i18n="mail.EditAsNew">Edit as new</span></li>\n    </ul>\n</script>\n<!-- /ko -->\n'});return module.exports});System.registerDynamic('webmail/view/keybindings.ko',[],true,function($__require,exports,module){var define,global=this||self,GLOBAL=global;module.exports=function injectTemplate(tpl){var s=document.createElement('script');s.id=tpl.id;s.innerHTML=window.TR?TR.HTML(tpl.content):tpl.content;s.type='text/html';document.head.appendChild(s)}({'id':'keybindings','content':'<div class="keybinds-legend--close"><span class="icon-remove" data-bind="click: close"></span></div>\n<div class="keybinds-legend">\n    <h2 class="keybinds-legend--header" data-bind="text: header"></h2>\n    <!-- ko if: enabled -->\n    <hr class="keybinds-legend--spacer">\n    <table class="keybinds-legend--table">\n        <tbody>\n            <tr>\n                <td></td>\n                <th class="keybinds-legend--table-header" data-i18n="mail.keys.ComposeView">Compose view</th>\n            </tr>\n            <!-- ko foreach: composeKeys -->\n            <tr>\n                <td class="keybinds-legend--table-key" data-bind="text: key"></td>\n                <td class="keybinds-legend--table-effect" data-bind="text: effect"></td>\n            </tr>\n            <!-- /ko -->\n            <tr>\n                <td></td>\n                <th class="keybinds-legend--table-header" data-i18n="mail.keys.ListView">List view</th>\n            </tr>\n            <!-- ko foreach: listKeys -->\n            <tr>\n                <td class="keybinds-legend--table-key" data-bind="text: key"></td>\n                <td class="keybinds-legend--table-effect" data-bind="text: effect"></td>\n            </tr>\n            <!-- /ko -->\n        </tbody>\n    </table>\n    <!-- /ko -->\n</div>\n'});return module.exports});System.registerDynamic('webmail/mailView/view.ko',[],true,function($__require,exports,module){var define,global=this||self,GLOBAL=global;module.exports=function injectTemplate(tpl){var s=document.createElement('script');s.id=tpl.id;s.innerHTML=window.TR?TR.HTML(tpl.content):tpl.content;s.type='text/html';document.head.appendChild(s)}({'id':'view','content':'<div class="layout top mailView-toolbar one-toolbar-style" data-keydomain="mailView">\n    <toolbar params="narrow: narrowToolbar, back: backButton, primaries: mainButtons, secondaries: parentView.minorButtons, tertiaries: moreMenu, moreLabel: TR(\'mail.More\', \'More\')" data-bind="afterRender: layout.setDimensions"></toolbar>\n</div>\n<div class="layout center mailView" data-bind="keybindDomain: { name: \'mailView\', firstFocus: \'\', noDispose: true }, afterRender: setupDesktopView" tabindex="-1">\n    <div class="mailView--content-section mailView--subject">\n        <h1 class="text" data-bind="text: mail.displaySubject"></h1>\n        <p class="meta">\n            <!-- ko \'if\': mail.date -->\n                <span data-bind="formatDate: {value: mail.date, formatId: \'longDate\'}"></span>\n                <span class="seperator"></span>\n                <span data-bind="formatDate: {value: mail.date, formatId: \'shortTime\'}"></span>\n                <!-- ko \'if\': mail.size -->\n                    <span class="seperator"></span>\n                <!-- /ko -->\n            <!-- /ko -->\n            <!-- ko \'if\': mail.size > 0 -->\n                <span data-bind="text: mail.displaySize"></span>\n            <!-- /ko -->\n        </p>\n    </div>\n\n    <!-- ko \'if\': isMaybePhishing() -->\n    <div class="mailView--content-section mailView--phishing-warning">\n        <span data-i18n="mail.PhishingWarning">This mail might be a phishing mail. Be careful of clicking any links or replying with personal information.</span>\n        <a class="mailView--close-warning" data-bind="click: disregardSPF" data-i18n="">×</a>\n    </div>\n    <!-- /ko -->\n\n    <div class="mailView--label" data-i18n="mail.FromColon">From:</div>\n    <div class="mailView--content-section mailView--contacts">\n        <div class="value">\n            <truncated-list params="template: \'recipient-list-item\', data: from, truncateAt: truncateAt(from)"></truncated-list>\n            <!-- ko template: { name: \'recipients-for-printing\', data: from, if: printing } --><!-- /ko -->\n        </div>\n    </div>\n\n    <!-- ko \'if\': undisclosedRecipients -->\n    <div class="mailView--label" data-i18n="mail.ToColon">To:</div>\n    <div class="mailView--content-section mailView--contacts">\n        <div class="value">\n            <span data-i18n="mail.UndisclosedRecipients">Undisclosed Recipients</span>\n        </div>\n    </div>\n    <!-- /ko -->\n    <!-- ko \'if\': mail.hasRecipients -->\n    <div class="mailView--label" data-i18n="mail.ToColon">To:</div>\n    <div class="mailView--content-section mailView--contacts">\n        <div class="value">\n            <truncated-list params="template: \'recipient-list-item\', data: to, truncateAt: truncateAt(to)"></truncated-list>\n            <!-- ko template: { name: \'recipients-for-printing\', data: to, if: printing } --><!-- /ko -->\n        </div>\n    </div>\n    <!-- /ko -->\n\n    <!-- ko \'if\': showCcList() -->\n    <div class="mailView--label" data-i18n="mail.CcColon">Cc:</div>\n    <div class="mailView--content-section mailView--contacts">\n        <div class="value">\n            <truncated-list params="template: \'recipient-list-item\', data: cc, truncateAt: truncateAt(cc)"></truncated-list>\n            <!-- ko template: { name: \'recipients-for-printing\', data: cc, if: printing } --><!-- /ko -->\n        </div>\n    </div>\n    <!-- /ko -->\n\n    <!-- ko \'if\': showBccList() -->\n    <div class="mailView--label" data-i18n="mail.BccColon">Bcc:</div>\n    <div class="mailView--content-section mailView--contacts">\n        <div class="value">\n            <truncated-list params="template: \'recipient-list-item\', data: bcc, truncateAt: truncateAt(bcc)"></truncated-list>\n            <!-- ko template: { name: \'recipients-for-printing\', data: bcc, if: printing } --><!-- /ko -->\n        </div>\n    </div>\n    <!-- /ko -->\n\n    <div class="mailView--content-section mail-part">\n    <!-- ko \'if\': mail.hasInlineParts -->\n    <ul>\n        <!-- ko if: unsubscribeLinkType() === \'mail\' -->\n        <li class="mailView--unsubscribe mailView--linksList">\n            <a class="mailView--unsubscribe-link" data-bind="popupTemplate: getUnsubscribeDialogOptions()" data-i18n="mail.Unsubscribe">Unsubscribe</a>\n        </li>\n        <!-- /ko -->\n        <!-- ko if: unsubscribeLinkType() === \'web\' -->\n        <li class="mailView--unsubscribe mailView--linksList">\n            <a class="mailView--unsubscribe-link" data-bind="attr: { href: unsubscribeLink() }" data-i18n="mail.Unsubscribe" target="_blank">Unsubscribe</a>\n        </li>\n        <!-- /ko -->\n        <!-- ko \'if\': showExternalImagesLink -->\n        <li class="mailView--loadExternalImages mailView--linksList" data-bind="click: loadExternalImages">\n            <a class="mailView--loadExternalImages-link" href="#" data-i18n="mail.LoadExternalImages">Load external images</a>\n        </li>\n        <!-- /ko -->\n        <!-- ko \'if\': showExternalImagesFromLink -->\n        <li class="mailView--loadExternalImages mailView--linksList" data-bind="click: loadAlwaysExternalImages">\n            <a class="mailView--loadExternalImages-link" href="#" data-i18n="mail.LoadAlwaysExternalImages">Always load external images from <span data-bind="text: from"></span></a>\n        </li>\n        <!-- /ko -->\n    </ul>\n        <div class="mailFrameLoading loading-overlay solid" data-bind="if: !mail.isLoaded(), visible: !mail.isLoaded()">\n            <div></div>\n        </div>\n        <div class="mailFrame" data-bind="foreach: mail.inlineParts, visible: mail.isLoaded()">\n            <!-- ko template: template --><!-- /ko -->\n        </div>\n    <!-- /ko -->\n    </div>\n\n    <!-- ko \'if\': mail.hasAttachments -->\n\n    <div class="mailView--content-section">\n        <div>\n            <span data-i18n="mail.AttachmentsColon">Attachments:</span>\n            <!-- ko \'if\': mail.shouldDisplayDownloadAllAttachmentsLink -->\n            <a class="mailView--download-all-attachments" data-bind="attr: { href: mail.getDownloadAllAttachmentsUrl() }" download><span data-i18n="mail.DownloadAllAttachments">Download all attachments</span></a>\n            <!-- /ko -->\n        </div>\n        <ul class="mailView--attachments" data-bind="foreach: mail.attachments">\n            <li>\n                <!-- ko \'if\': hasThumbnail -->\n                <div class="attachment-thumbnail">\n                    <a class="preview" data-bind="attr: { href: getImageUrl(), title: displayName }, lightbox: { name: \'attachments-thumbnail\', closePlacement: \'top\', hideBarsDelay: 0 }, style: { backgroundImage: getThumbnailUrlForCSS() }" style="background-repeat: no-repeat; background-size:100%; background-position: 50% 50%;">\n                        <div class="mask">\n                            <div class="displayNameForThumbnail">\n                                <span class="nameOnTop" data-bind="text: displayTopName"></span>\n                                <br>\n                                <span class="displaySize" data-bind="text: displaySize"></span>\n                            </div>\n                        </div>\n                    </a>\n                    <a data-bind="attr: { href: getDownloadUrl() }" target="download">\n                        <i data-i18n="attr: {\'data-title\': \'mail.DownloadAttachment\'}" data-title="Download" class="icon-attachmentsDownload"></i>\n                    </a>\n                </div>\n                <!-- /ko -->\n\n                <!-- ko \'if\': !hasThumbnail && isPreviewable -->\n                 <div data-bind="attr: { \'class\': iconClass + \' mime-medium\' }">\n                    <a class="preview" data-bind="attr: { href: getPreviewUrl() }, lightbox: { name: \'attachments-thumbnail\', closePlacement: \'top\', hideBarsDelay: 0 }">\n                        <div class="displayNameFornotThumbnail">\n                                <span class="nameOnTop" data-bind="text: displayTopName"></span>\n                                <br>\n                                <span class="displaySize" data-bind="text: displaySize"></span>\n                                <span class="nameOnBottom" data-bind="text: displayBottomName"></span>\n                        </div>\n                    </a>\n                    <a data-bind="attr: { href: getDownloadUrl() }" target="download">\n                        <i data-i18n="attr: {\'data-title\': \'mail.DownloadAttachment\'}" data-title="Download" class="icon-attachmentsDownload"></i>\n                    </a>\n                </div>\n                <!-- /ko -->\n\n                <!-- ko \'ifnot\': isPreviewable -->\n                <!-- ko \'if\': isAttachedMail() -->\n                <div data-bind="attr: { \'class\': iconClass + \' mime-medium\' }">\n                    <a class="preview" data-bind="click: viewAttachedMail">\n                        <div class="displayNameFornotThumbnail">\n                                <span id="nameOnTop" class="nameOnTop filename" data-bind="text: displayTopName"></span>\n                                <br>\n                                <span class="displaySize" data-bind="text: displaySize"></span>\n                                <span class="nameOnBottom" data-bind="text: displayBottomName"></span>\n                        </div>\n\n                        <a data-bind="attr: { href: getDownloadUrl() }" target="download">\n                            <i data-i18n="attr: {\'data-title\': \'mail.DownloadAttachment\'}" data-title="Download" class="icon-attachmentsDownload"></i>\n                        </a>\n                    </a>\n                </div>\n                <!-- /ko -->\n                <!-- ko \'ifnot\': isAttachedMail() -->\n                <div data-bind="attr: { \'class\': iconClass + \' mime-medium\' }">\n                    <a class="downloadLink" data-bind="attr: { href: getDownloadUrl() }" target="download">\n                        <div class="displayNameFornotThumbnail">\n                                <span id="nameOnTop" class="nameOnTop filename" data-bind="text: displayTopName"></span>\n                                <br>\n                                <span class="displaySize" data-bind="text: displaySize"></span>\n                                <span class="nameOnBottom" data-bind="text: displayBottomName"></span>\n                        </div>\n\n                        <i data-i18n="attr: {\'data-title\': \'mail.DownloadAttachment\'}" data-title="Download" class="icon-attachmentsDownload"></i>\n                    </a>\n                </div>\n                <!-- /ko -->\n                <!-- /ko -->\n            </li>\n        </ul>\n    </div>\n    <!-- /ko -->\n</div>\n\n<script type="text/html" id="recipient-list-item"><a class="recipient" data-bind="text: toDisplayString(), popupTemplate: { template: \'contactCard\' }"></a></script>\n\n<script type="text/html" id="recipients-for-printing">\n    <span class="recipients-for-printing">\n        <span data-bind="text: $parent.toPrintDisplayString($data)"></span>\n    </span>\n</script>\n'});return module.exports});System.registerDynamic('webmail/mailView/contactCard.ko',[],true,function($__require,exports,module){var define,global=this||self,GLOBAL=global;module.exports=function injectTemplate(tpl){var s=document.createElement('script');s.id=tpl.id;s.innerHTML=window.TR?TR.HTML(tpl.content):tpl.content;s.type='text/html';document.head.appendChild(s)}({'id':'contactCard','content':'<div class="mailView--contact-card js--contact-card" data-bind="with: $parents[1].getContactCard($data)">\n    <div data-i18n="mail.XOfX" data-bind="unselectable: true, visible: hasMultipleContacts" class="mailView--contact-card--count"><span data-bind="text: shownContactIndex"></span> of <span data-bind="text: recipients.length"></span></div>\n    <div class="mailView--contact-card--photo" data-bind="unselectable: true">\n        <span class="icon-back-arrow-bigger mailView--contact-card--switcher" data-bind="click: showPreviousContact, visible: hasMultipleContacts"></span>\n        <img data-bind="attr: { src: photoUrl() }" class="contact-photo">\n        <span class="icon-forward-arrow-bigger mailView--contact-card--switcher" data-bind="click: showNextContact, visible: hasMultipleContacts"></span>\n    </div>\n    <div data-bind="css: showContactCard() ? \'mailView--contact-card--labels\' : \'mailView--contact-card--labelsWithoutButton\'">\n        <div class="mailView--contact-card--displayname" data-bind="visible: shownContact().displayName, text: shownContact().displayName"></div>\n        <div class="mailView--contact-card--email" data-bind="visible: email(), text: displayEmail()"></div>\n    </div>\n    <div class="mailView--contact-card--buttons" data-bind="unselectable: true">\n        <!-- ko \'if\': showContactCard() -->\n        <button class="one-button-style icon-button" data-bind="click: addToMyContacts">\n            <i class="icon-edit"></i>\n            <span data-i18n="contacts.AddContactToMyContacts">Add to my contacts</span>\n        </button>\n        <!-- /ko-->\n        <!-- ko \'ifnot\': contactCardForRecipient() -->\n        <a class="one-button-style" data-bind="attr: { \'href\': \'mailto:\' + mailto() }" data-i18n="mail.SendMail">Send mail</a>\n        <button class="one-button-style" data-bind="text: sendToContactsText, click: toContactApp"></button>\n        <!-- /ko -->\n    </div>\n</div>\n'});return module.exports});System.registerDynamic('webmail/mailView/unsubscribeDialog.ko',[],true,function($__require,exports,module){var define,global=this||self,GLOBAL=global;module.exports=function injectTemplate(tpl){var s=document.createElement('script');s.id=tpl.id;s.innerHTML=window.TR?TR.HTML(tpl.content):tpl.content;s.type='text/html';document.head.appendChild(s)}({'id':'unsubscribeDialog','content':'<div class="mailView--unsubscribe-dialog dialog">\n    <p class="mailView--unsubscribe-label" data-i18n="mail.SendUnsubscribeMail">This will send an unsubscribe mail to sender.</p>\n    <button class="one-button-style solid touch-highlight mailView--unsubscribe-button" data-bind="click: sendMail" data-i18n="mail.Confirm" target="_blank">Confirm</button>\n    <button class="one-button-style touch-highlight mailView--unsubscribe-cancel-button" data-bind="click: function () { open(false); }" data-i18n="mail.Cancel">Cancel</button>\n</div>\n'});return module.exports});System.registerDynamic('webmail/composer/composer.ko',[],true,function($__require,exports,module){var define,global=this||self,GLOBAL=global;module.exports=function injectTemplate(tpl){var s=document.createElement('script');s.id=tpl.id;s.innerHTML=window.TR?TR.HTML(tpl.content):tpl.content;s.type='text/html';document.head.appendChild(s)}({'id':'composer','content':'<div class="layout top composer-toolbar one-toolbar-style" data-keydomain="composer">\n    <toolbar params="primaries: mainButtons, secondaries: minorButtons"></toolbar>\n    <div data-bind="visible: failed" class="failed-save-warning">\n        <i class="icon-warning"></i>\n        <span data-bind="visible: failedSending" data-i18n="mail.MailCouldNotBeSent">The mail could not be sent.</span>\n        <span data-bind="visible: failedSaving" data-i18n="mail.MailCouldNotBeSaved">The mail could not be saved.</span>\n    </div>\n</div>\n<div class="layout center mailComposer" data-bind="keybindDomain: { name: \'composer\', firstFocus: \'input#to\', noDispose: true }">\n    <div class="mailComposer--header">\n        <div data-bind="click: function (data, event) {restoreFocusToComposer($data, event)}">\n        <div class="mailComposer--header-recipients-container">\n            <div class="mailComposer--header-section recipient-input" data-bind="template: { name: \'recipient-input\', data: toView }">\n            </div>\n             <!-- ko \'if\': ccView.visible() -->\n            <div class="mailComposer--header-section recipient-input" data-bind="template: { name: \'recipient-input\', data: ccView }">\n            </div>\n            <!-- /ko -->\n            <!-- ko \'if\': bccView.visible() -->\n            <div class="mailComposer--header-section recipient-input" data-bind="template: { name: \'recipient-input\', data: bccView }">\n            </div>\n            <!-- /ko -->\n        </div>\n            <!-- ko ifnot: (ccView.visible() && bccView.visible()) -->\n            <div class="mailComposer--control">\n                <!-- ko ifnot: ccView.visible() -->\n                <a class="mailComposer--add-field" href="#" tabindex="-1" data-i18n="mail.composer.Cc" data-bind="click: ccView.show">Cc</a>\n                <!-- /ko -->\n                <!-- ko ifnot: bccView.visible() -->\n                <a class="mailComposer--add-field" href="#" tabindex="-1" data-i18n="mail.composer.Bcc" data-bind="click: bccView.show">Bcc</a>\n                <!-- /ko -->\n            </div>\n            <!-- </div> -->\n            <!-- /ko -->\n            <div class="mailComposer--header-section subject-section">\n                <in-place-editor params="value: subject,\n                                placeholder: TR(\'mail.Subject\', \'Subject\'),\n                                id: \'subject\'"\n                                class="mailComposer--subject-field"\n                                data-bind="hasfocus: focusSubject, value: subject, valueUpdate: \'afterkeydown\'" id="subject">\n                </in-place-editor>\n            </div>\n        </div>\n        <div class="mailComposer--header-section attachment-section" tabindex="-1" data-bind="template: { name: \'attachmentView\', data: attachmentView }">\n        </div>\n    </div>\n    <rte class="mailComposer--body-editor" params="config: rteConfig, afterRender: initEditor.bind($data)" data-bind="beforeRemove: flushChanges.bind($data)"></rte>\n</div>\n<div class="layout loading-overlay" data-bind="if: loadingOverlayVisible, visible: loadingOverlayVisible"><div></div></div>\n'});return module.exports});System.registerDynamic('webmail/composer/recipient-input.ko',[],true,function($__require,exports,module){var define,global=this||self,GLOBAL=global;module.exports=function injectTemplate(tpl){var s=document.createElement('script');s.id=tpl.id;s.innerHTML=window.TR?TR.HTML(tpl.content):tpl.content;s.type='text/html';document.head.appendChild(s)}({'id':'recipient-input','content':'<div class="knockout-autocomplete multiple mailComposer--recipient-field" data-bind="css: { focused: focused }, dropZone: { name: \'recipients\', drop: dropRecipient, dragEnter: dragEnter }, afterRender: setup">\n    <input type="input" data-bind="hasfocus: pasteAreaFocused" class="paste-area" value="" tabindex="-1">\n        <span class="recipient-placeholder" data-bind="attr: { \'data-i18n\': label }, css: {\'float\': floatLabel}, text: label"></span>\n    <!-- ko foreach: completed -->\n        <!-- ko \'if\': editing() -->\n        <input type="text" class="label" data-bind="focusWhen: editing, value: value, selectOnFocus: { pattern: /.*/, onlySelectOnFirstFocus: true }, valueUpdate: \'afterkeydown\', autoExpand: value, autocomplete: { data: $parent.dataSource, query: query, noFilter: true, renderSuggestion: $parent.renderSuggestionConcatenated, onSelect: select.bind($data), format: $parent.format, separators: \',;\', maxItems: 8 }, event: { blur: blurHandler, keydown: escapeHandler }" value="">\n        <!-- /ko -->\n        <!-- ko \'if\': !editing() -->\n        <span class="item" data-bind="css: { invalid: $parent.isInvalidEmail(item), dragging: dragging }, dragZone: { name: \'recipients\', dragStart: dragStart, dragEnd: dragEnd }">\n            <span class="label" data-bind="text: item.toDisplayString(), attr: { \'data-title\': item.displayEmail }, popupTemplate: { template: \'contactCard\', data: {recipient: $data.item}, disable: false, anchorHandler: !$parent.isInvalidEmail(item)}, leftDoubleMouseDown: edit, touchstart: edit"></span>\n            <a class="remove" data-bind="leftMouseDown: $parent.removeItem.bind($parent, $index)"></a>\n        </span>\n    <!-- /ko -->\n    <!-- /ko -->\n    <input class="main-input" type="text" data-bind="attr: { id: id }, hasfocus: inputFocused, value: value, valueUpdate: \'afterkeydown\', event: { blur: blurHandler, keydown: keyDown.bind($data, $root) }, autocomplete: { data: dataSource, query: query, noFilter: true, renderSuggestion: renderSuggestionConcatenated, onSelect: select.bind($data), format: format, separators: \',;\', maxItems: 8 }" value="">\n</div>\n'});return module.exports});System.registerDynamic('webmail/composer/attachmentView.ko',[],true,function($__require,exports,module){var define,global=this||self,GLOBAL=global;module.exports=function injectTemplate(tpl){var s=document.createElement('script');s.id=tpl.id;s.innerHTML=window.TR?TR.HTML(tpl.content):tpl.content;s.type='text/html';document.head.appendChild(s)}({'id':'attachmentView','content':'<div class="mailComposer--attachment-add drag-drop" tabindex="-1"\n        data-bind="\n            event:{\n            dragover: function(data, event){event.preventDefault();},\n            drop: addDroppedFiles, dragstart:true,\n            dragleave: function(data, event){event.preventDefault();}\n        }">\n    <div class="attachment" value="" tabindex="-1" data-bind="hasFocus: focus, css: {\'sizeWarning\': attachmentsTooLarge || attachmentIsDirectory, \'expand\': allowExpand}">\n        <span class="placeholder" data-i18n="mail.Attachments" data-bind="css: {\'float\': isLabelUp}">Attachments</span>\n        <div class="drag-drop--scrollList" data-bind="css: {\'expanded-list\': allowExpand}">\n            <div class="mailComposer--attachment drag-drop--field" data-bind="activateFileInput: { handler: attach, tabIndex: -1, offset: { top: inputOffsetTop }, multiple: FormData !== \'undefined\'}">\n                <!-- ko foreach: sizeAnnotatedAttachments -->\n                <div class="mailComposer--attachment-list-item">\n                    <!-- ko ifnot: attachment.isPreviewable -->\n                    <span class="mailComposer--attachment-list-item--view" data-bind="text: attachment.displayName">\n                    </span>\n                        <span class="size" data-bind="text: \'(\' + attachment.displaySize() + \')\'"></span>\n                    <!-- /ko -->\n                    <!-- ko \'if\': attachment.isPreviewable -->\n                    <a class="mailComposer--attachment-list-item--view" data-bind="text: attachment.displayName, attr: { href: attachment.getPreviewUrl(), title: attachment.displayName }, lightbox: { name: \'attachments\', closePlacement: \'top\', hideBarsDelay: 0 }">\n                    </a>\n                        <span class="size" data-bind="text: \'(\' + attachment.displaySize() + \')\'"></span>\n                    <!-- /ko -->\n                    <a class="mailComposer--attachment-list-item-delete" href="#" data-bind="click: $parent.removeAttachment.bind($parent, $index())">\n                        <span class="icon-cancelCross icon"></span>\n                    </a>\n                </div>\n                <!-- /ko -->\n\n            </div>\n            <div class="item drag-drop--info">\n                <a class="upload-link" data-bind="activateFileInput: { handler: attach, tabIndex: -1, multiple: FormData !== \'undefined\'}" data-i18n="text: \'mail.composer.Add\', attr: {\'data-title\': \'mail.composer.AttachFile\'}" data-title="Attach file">Add</a>\n            </div>\n        </div>\n    </div>\n</div>\n<div class="mailComposer--attachment-size-warning" data-bind="visible: attachmentsTooLarge" data-i18n="mail.AttachmentsTooLargePleaseRemove">The total size of your attachments exceeds the limit of <span data-bind="text: inter.renderFileSize(maximumDecodedMailSize)"></span>. Please remove some attachments.</div>\n<div class="mailComposer--attachment-warning" data-bind="visible: attachmentIsDirectory" data-i18n="mail.AttachmentIsDirectory">Folders can\'t be attached to a mail. Please attach the separate files instead.</div>\n'});return module.exports});System.registerDynamic('webmail/composer/mailSent.ko',[],true,function($__require,exports,module){var define,global=this||self,GLOBAL=global;module.exports=function injectTemplate(tpl){var s=document.createElement('script');s.id=tpl.id;s.innerHTML=window.TR?TR.HTML(tpl.content):tpl.content;s.type='text/html';document.head.appendChild(s)}({'id':'mailSent','content':'<div class="layout top content-toolbar one-toolbar-style"></div>\n<div class="layout center centeredMessage">\n    <h1 data-i18n="mail.composer.EmailSent">Email sent</h1>\n</div>\n'});return module.exports});System.registerDynamic('webmail/composer/sendingMail.ko',[],true,function($__require,exports,module){var define,global=this||self,GLOBAL=global;module.exports=function injectTemplate(tpl){var s=document.createElement('script');s.id=tpl.id;s.innerHTML=window.TR?TR.HTML(tpl.content):tpl.content;s.type='text/html';document.head.appendChild(s)}({'id':'sendingMail','content':'<div class="layout top content-toolbar one-toolbar-style"></div>\n<div class="layout center centeredMessage">\n    <h1 data-i18n="mail.composer.SendingEmail">Sending email...</h1>\n</div>\n'});return module.exports});System.registerDynamic('webmail/view/mailPart/mailPartInlineImage.ko',[],true,function($__require,exports,module){var define,global=this||self,GLOBAL=global;module.exports=function injectTemplate(tpl){var s=document.createElement('script');s.id=tpl.id;s.innerHTML=window.TR?TR.HTML(tpl.content):tpl.content;s.type='text/html';document.head.appendChild(s)}({'id':'mailPartInlineImage','content':'<img class="mailPartImage" data-bind="attr: { src: url() }">\n'});return module.exports});System.registerDynamic('webmail/view/mailPart/mailPartText.ko',[],true,function($__require,exports,module){var define,global=this||self,GLOBAL=global;module.exports=function injectTemplate(tpl){var s=document.createElement('script');s.id=tpl.id;s.innerHTML=window.TR?TR.HTML(tpl.content):tpl.content;s.type='text/html';document.head.appendChild(s)}({'id':'mailPartText','content':'<!-- ko \'if\': mailPartTooBig() -->\n<!-- ko template: { name: \'mailPartTooBig\', data: $data} --><!-- /ko -->\n<!-- /ko -->\n<!-- ko \'ifnot\': mailPartTooBig() -->\n<div class="mailPart" data-bind="html: htmlContent, afterRender: setDomReference"></div>\n<!-- /ko -->\n'});return module.exports});System.registerDynamic('webmail/view/mailPart/mailPartTooBig.ko',[],true,function($__require,exports,module){var define,global=this||self,GLOBAL=global;module.exports=function injectTemplate(tpl){var s=document.createElement('script');s.id=tpl.id;s.innerHTML=window.TR?TR.HTML(tpl.content):tpl.content;s.type='text/html';document.head.appendChild(s)}({'id':'mailPartTooBig','content':'<div class="content mailPartTooBig">\n    <h1 data-i18n="mail.PrimaryPartTooBig">This email is too large for the security filters.</h1>\n    <a data-bind="attr: { href: urlWithExternalImagesAllowed() }" target="_blank" data-i18n="mail.PrimaryPartTooBigShowAnyway">View the email without security filters (at your own risk)</a>\n</div>\n'});return module.exports});System.registerDynamic('3rdparty/one-theme/scaffolding.less',[],false,function($__require,$__exports,$__module){var _retrieveGlobal=System.get('@@global-helpers').prepareGlobal($__module.id,null,null);(function($__global){}(this));return _retrieveGlobal()});System.registerDynamic('3rdparty/one-theme/3rdparty/bootstrap/less/type.less',[],false,function($__require,$__exports,$__module){var _retrieveGlobal=System.get('@@global-helpers').prepareGlobal($__module.id,null,null);(function($__global){}(this));return _retrieveGlobal()});System.registerDynamic('3rdparty/one-theme/forms.less',[],false,function($__require,$__exports,$__module){var _retrieveGlobal=System.get('@@global-helpers').prepareGlobal($__module.id,null,null);(function($__global){}(this));return _retrieveGlobal()});System.registerDynamic('3rdparty/one-theme/alerts.less',[],false,function($__require,$__exports,$__module){var _retrieveGlobal=System.get('@@global-helpers').prepareGlobal($__module.id,null,null);(function($__global){}(this));return _retrieveGlobal()});System.registerDynamic('3rdparty/one-theme/tooltip.less',[],false,function($__require,$__exports,$__module){var _retrieveGlobal=System.get('@@global-helpers').prepareGlobal($__module.id,null,null);(function($__global){}(this));return _retrieveGlobal()});System.registerDynamic('3rdparty/shinybox/shinybox.css',[],false,function($__require,$__exports,$__module){var _retrieveGlobal=System.get('@@global-helpers').prepareGlobal($__module.id,null,null);(function($__global){}(this));return _retrieveGlobal()});System.registerDynamic('3rdparty/one-theme/onebar.less',[],false,function($__require,$__exports,$__module){var _retrieveGlobal=System.get('@@global-helpers').prepareGlobal($__module.id,null,null);(function($__global){}(this));return _retrieveGlobal()});System.registerDynamic('onebar/onebar.less',[],false,function($__require,$__exports,$__module){var _retrieveGlobal=System.get('@@global-helpers').prepareGlobal($__module.id,null,null);(function($__global){}(this));return _retrieveGlobal()});System.registerDynamic('3rdparty/one-theme/list.less',[],false,function($__require,$__exports,$__module){var _retrieveGlobal=System.get('@@global-helpers').prepareGlobal($__module.id,null,null);(function($__global){}(this));return _retrieveGlobal()});System.registerDynamic('3rdparty/one-theme/toolbar.less',[],false,function($__require,$__exports,$__module){var _retrieveGlobal=System.get('@@global-helpers').prepareGlobal($__module.id,null,null);(function($__global){}(this));return _retrieveGlobal()});System.registerDynamic('3rdparty/one-theme/buttons.less',[],false,function($__require,$__exports,$__module){var _retrieveGlobal=System.get('@@global-helpers').prepareGlobal($__module.id,null,null);(function($__global){}(this));return _retrieveGlobal()});System.registerDynamic('3rdparty/one-theme/dropdowns.less',[],false,function($__require,$__exports,$__module){var _retrieveGlobal=System.get('@@global-helpers').prepareGlobal($__module.id,null,null);(function($__global){}(this));return _retrieveGlobal()});System.registerDynamic('3rdparty/one-theme/sidebar.less',[],false,function($__require,$__exports,$__module){var _retrieveGlobal=System.get('@@global-helpers').prepareGlobal($__module.id,null,null);(function($__global){}(this));return _retrieveGlobal()});System.registerDynamic('3rdparty/one-theme/rte.less',[],false,function($__require,$__exports,$__module){var _retrieveGlobal=System.get('@@global-helpers').prepareGlobal($__module.id,null,null);(function($__global){}(this));return _retrieveGlobal()});System.registerDynamic('3rdparty/knockout-sequence-dialog/sequenceDialog.less',[],false,function($__require,$__exports,$__module){var _retrieveGlobal=System.get('@@global-helpers').prepareGlobal($__module.id,null,null);(function($__global){}(this));return _retrieveGlobal()});System.registerDynamic('3rdparty/knockout-confirmation-dialog/confirmationDialog.less',[],false,function($__require,$__exports,$__module){var _retrieveGlobal=System.get('@@global-helpers').prepareGlobal($__module.id,null,null);(function($__global){}(this));return _retrieveGlobal()});System.registerDynamic('3rdparty/knockout-toolbar/toolbar.less',[],false,function($__require,$__exports,$__module){var _retrieveGlobal=System.get('@@global-helpers').prepareGlobal($__module.id,null,null);(function($__global){}(this));return _retrieveGlobal()});System.registerDynamic('theme/less/errormsg.less',[],false,function($__require,$__exports,$__module){var _retrieveGlobal=System.get('@@global-helpers').prepareGlobal($__module.id,null,null);(function($__global){}(this));return _retrieveGlobal()});System.registerDynamic('theme/less/notification.less',[],false,function($__require,$__exports,$__module){var _retrieveGlobal=System.get('@@global-helpers').prepareGlobal($__module.id,null,null);(function($__global){}(this));return _retrieveGlobal()});System.registerDynamic('theme/less/loadingScreen.less',[],false,function($__require,$__exports,$__module){var _retrieveGlobal=System.get('@@global-helpers').prepareGlobal($__module.id,null,null);(function($__global){}(this));return _retrieveGlobal()});System.registerDynamic('theme/less/toolbar.less',[],false,function($__require,$__exports,$__module){var _retrieveGlobal=System.get('@@global-helpers').prepareGlobal($__module.id,null,null);(function($__global){}(this));return _retrieveGlobal()});System.registerDynamic('theme/less/icons.less',[],false,function($__require,$__exports,$__module){var _retrieveGlobal=System.get('@@global-helpers').prepareGlobal($__module.id,null,null);(function($__global){}(this));return _retrieveGlobal()});System.registerDynamic('theme/less/forms.less',[],false,function($__require,$__exports,$__module){var _retrieveGlobal=System.get('@@global-helpers').prepareGlobal($__module.id,null,null);(function($__global){}(this));return _retrieveGlobal()});System.registerDynamic('theme/less/buttons.less',[],false,function($__require,$__exports,$__module){var _retrieveGlobal=System.get('@@global-helpers').prepareGlobal($__module.id,null,null);(function($__global){}(this));return _retrieveGlobal()});System.registerDynamic('theme/less/dragdrop.less',[],false,function($__require,$__exports,$__module){var _retrieveGlobal=System.get('@@global-helpers').prepareGlobal($__module.id,null,null);(function($__global){}(this));return _retrieveGlobal()});System.registerDynamic('theme/less/popup-dropdown.less',[],false,function($__require,$__exports,$__module){var _retrieveGlobal=System.get('@@global-helpers').prepareGlobal($__module.id,null,null);(function($__global){}(this));return _retrieveGlobal()});System.registerDynamic('theme/less/dialog.less',[],false,function($__require,$__exports,$__module){var _retrieveGlobal=System.get('@@global-helpers').prepareGlobal($__module.id,null,null);(function($__global){}(this));return _retrieveGlobal()});System.registerDynamic('theme/less/errorDialog.less',[],false,function($__require,$__exports,$__module){var _retrieveGlobal=System.get('@@global-helpers').prepareGlobal($__module.id,null,null);(function($__global){}(this));return _retrieveGlobal()});System.registerDynamic('theme/less/knockout.autocomplete.less',[],false,function($__require,$__exports,$__module){var _retrieveGlobal=System.get('@@global-helpers').prepareGlobal($__module.id,null,null);(function($__global){}(this));return _retrieveGlobal()});System.registerDynamic('theme/less/loading-overlay.less',[],false,function($__require,$__exports,$__module){var _retrieveGlobal=System.get('@@global-helpers').prepareGlobal($__module.id,null,null);(function($__global){}(this));return _retrieveGlobal()});System.registerDynamic('theme/less/knockout.splitView.less',[],false,function($__require,$__exports,$__module){var _retrieveGlobal=System.get('@@global-helpers').prepareGlobal($__module.id,null,null);(function($__global){}(this));return _retrieveGlobal()});System.registerDynamic('theme/less/contacts.less',[],false,function($__require,$__exports,$__module){var _retrieveGlobal=System.get('@@global-helpers').prepareGlobal($__module.id,null,null);(function($__global){}(this));return _retrieveGlobal()});System.registerDynamic('theme/less/sidebar.less',[],false,function($__require,$__exports,$__module){var _retrieveGlobal=System.get('@@global-helpers').prepareGlobal($__module.id,null,null);(function($__global){}(this));return _retrieveGlobal()});System.registerDynamic('theme/less/theme.less',[],false,function($__require,$__exports,$__module){var _retrieveGlobal=System.get('@@global-helpers').prepareGlobal($__module.id,null,null);(function($__global){}(this));return _retrieveGlobal()});System.registerDynamic('webmail/webmail.less',[],false,function($__require,$__exports,$__module){var _retrieveGlobal=System.get('@@global-helpers').prepareGlobal($__module.id,null,null);(function($__global){}(this));return _retrieveGlobal()});System.registerDynamic('webmail/mailList/searchHighlight.less',[],false,function($__require,$__exports,$__module){var _retrieveGlobal=System.get('@@global-helpers').prepareGlobal($__module.id,null,null);(function($__global){}(this));return _retrieveGlobal()});System.registerDynamic('webmail/mailList/mailList.less',[],false,function($__require,$__exports,$__module){var _retrieveGlobal=System.get('@@global-helpers').prepareGlobal($__module.id,null,null);(function($__global){}(this));return _retrieveGlobal()});System.registerDynamic('webmail/folderList/folderList.less',[],false,function($__require,$__exports,$__module){var _retrieveGlobal=System.get('@@global-helpers').prepareGlobal($__module.id,null,null);(function($__global){}(this));return _retrieveGlobal()});System.registerDynamic('webmail/composer/composer.less',[],false,function($__require,$__exports,$__module){var _retrieveGlobal=System.get('@@global-helpers').prepareGlobal($__module.id,null,null);(function($__global){}(this));return _retrieveGlobal()});System.registerDynamic('webmail/mailView/view.less',[],false,function($__require,$__exports,$__module){var _retrieveGlobal=System.get('@@global-helpers').prepareGlobal($__module.id,null,null);(function($__global){}(this));return _retrieveGlobal()});System.registerDynamic('webmail/mailTabs/mailTabs.less',[],false,function($__require,$__exports,$__module){var _retrieveGlobal=System.get('@@global-helpers').prepareGlobal($__module.id,null,null);(function($__global){}(this));return _retrieveGlobal()});System.registerDynamic('webmail/moveToFolder/moveToFolder.less',[],false,function($__require,$__exports,$__module){var _retrieveGlobal=System.get('@@global-helpers').prepareGlobal($__module.id,null,null);(function($__global){}(this));return _retrieveGlobal()});System.registerDynamic('components/pagination/pagination.less',[],false,function($__require,$__exports,$__module){var _retrieveGlobal=System.get('@@global-helpers').prepareGlobal($__module.id,null,null);(function($__global){}(this));return _retrieveGlobal()});System.registerDynamic('components/cardStack/cardStack.less',[],false,function($__require,$__exports,$__module){var _retrieveGlobal=System.get('@@global-helpers').prepareGlobal($__module.id,null,null);(function($__global){}(this));return _retrieveGlobal()});System.registerDynamic('components/inPlaceEditor/inPlaceEditor.less',[],false,function($__require,$__exports,$__module){var _retrieveGlobal=System.get('@@global-helpers').prepareGlobal($__module.id,null,null);(function($__global){}(this));return _retrieveGlobal()});System.registerDynamic('calendar/view/general.less',[],false,function($__require,$__exports,$__module){var _retrieveGlobal=System.get('@@global-helpers').prepareGlobal($__module.id,null,null);(function($__global){}(this));return _retrieveGlobal()});System.registerDynamic('calendar/agenda/agenda.less',[],false,function($__require,$__exports,$__module){var _retrieveGlobal=System.get('@@global-helpers').prepareGlobal($__module.id,null,null);(function($__global){}(this));return _retrieveGlobal()});System.registerDynamic('calendar/dialogs/dialogs.less',[],false,function($__require,$__exports,$__module){var _retrieveGlobal=System.get('@@global-helpers').prepareGlobal($__module.id,null,null);(function($__global){}(this));return _retrieveGlobal()});System.registerDynamic('calendar/dialogs/event/eventDialog.less',[],false,function($__require,$__exports,$__module){var _retrieveGlobal=System.get('@@global-helpers').prepareGlobal($__module.id,null,null);(function($__global){}(this));return _retrieveGlobal()});System.registerDynamic('calendar/components/dateInput/dateInput.less',[],false,function($__require,$__exports,$__module){var _retrieveGlobal=System.get('@@global-helpers').prepareGlobal($__module.id,null,null);(function($__global){}(this));return _retrieveGlobal()});System.registerDynamic('calendar/components/dateSelector/dateSelector.less',[],false,function($__require,$__exports,$__module){var _retrieveGlobal=System.get('@@global-helpers').prepareGlobal($__module.id,null,null);(function($__global){}(this));return _retrieveGlobal()});System.registerDynamic('calendar/components/timeSelector/timeSelector.less',[],false,function($__require,$__exports,$__module){var _retrieveGlobal=System.get('@@global-helpers').prepareGlobal($__module.id,null,null);(function($__global){}(this));return _retrieveGlobal()});System.registerDynamic('calendar/components/dialogHeader/dialogHeader.less',[],false,function($__require,$__exports,$__module){var _retrieveGlobal=System.get('@@global-helpers').prepareGlobal($__module.id,null,null);(function($__global){}(this));return _retrieveGlobal()});System.registerDynamic('calendar/components/miniCalendar/miniCalendar.less',[],false,function($__require,$__exports,$__module){var _retrieveGlobal=System.get('@@global-helpers').prepareGlobal($__module.id,null,null);(function($__global){}(this));return _retrieveGlobal()});System.registerDynamic('webmail/components/calendarSlideIn/calendarSlideIn.less',[],false,function($__require,$__exports,$__module){var _retrieveGlobal=System.get('@@global-helpers').prepareGlobal($__module.id,null,null);(function($__global){}(this));return _retrieveGlobal()});System.registerDynamic('webmail/components/calendarListDropDown/calendarListDropDown.less',[],false,function($__require,$__exports,$__module){var _retrieveGlobal=System.get('@@global-helpers').prepareGlobal($__module.id,null,null);(function($__global){}(this));return _retrieveGlobal()});System.registerDynamic('eas/view/eas-dialog.less',[],false,function($__require,$__exports,$__module){var _retrieveGlobal=System.get('@@global-helpers').prepareGlobal($__module.id,null,null);(function($__global){}(this));return _retrieveGlobal()});System.registerDynamic('eas/view/eas-dialog.ko',[],true,function($__require,exports,module){var define,global=this||self,GLOBAL=global;module.exports=function injectTemplate(tpl){var s=document.createElement('script');s.id=tpl.id;s.innerHTML=window.TR?TR.HTML(tpl.content):tpl.content;s.type='text/html';document.head.appendChild(s)}({'id':'eas-dialog','content':'<modal-dialog class="eas-dialog" params="show: isDialogVisible, topColor: \'#52b0a2\', topHeight: \'173px\', titleIcon: \'/eas/view/images/cloud.svg\'.toString(\'url\'), titleText: TR(\'welcome.ExchangeActiveSync\', \'Mobile Sync\'), cornerCloser: true">\n    <div class="dialog-content">\n        <header>\n            <h1 data-i18n="welcome.ExchangeActiveSync.title">Synchronize your mail, calendar and contacts on all your mobile devices</h1>\n        </header>\n        <p data-i18n="welcome.ExchangeActiveSync.description">Mobile Sync uses Exchange ActiveSync (EAS), a protocol to synchronize email, contacts and calendars. You can use it to set up your email account on mobile devices.</p>\n        <a class="confirm-button" data-bind="attr: { href: \'/settings/\' + state.user() + \'/eas\' }" data-i18n="welcome.ExchangeActiveSync.cta">Learn more</a>\n    </div>\n</modal-dialog>\n'});return module.exports});(function(){var define=System.amdDefine;(function(global,factory){typeof exports==='object'&&typeof module!=='undefined'?module.exports=factory():typeof define==='function'&&define.amd?define('3rdparty/queue.js',[],factory)&&define('queue',['3rdparty/queue.js'],function(m){return m}):global.queue=factory()}(this,function(){'use strict';var slice=[].slice;function noop(){}var noabort={};var success=[null];function newQueue(concurrency){if(!(concurrency>=1))throw new Error;var q,tasks=[],results=[],waiting=0,active=0,ended=0,starting,error,callback=noop,callbackAll=true;function start(){if(starting)return;while(starting=waiting&&active<concurrency){var i=ended+active,t=tasks[i],j=t.length-1,c=t[j];t[j]=end(i);--waiting,++active,tasks[i]=c.apply(null,t)||noabort}}function end(i){return function(e,r){if(!tasks[i])throw new Error;--active,++ended,tasks[i]=null;if(error!=null)return;if(e!=null){abort(e)}else{results[i]=r;if(waiting)start();else if(!active)notify()}}}function abort(e){error=e;waiting=NaN;notify()}function notify(){if(error!=null)callback(error);else if(callbackAll)callback(null,results);else callback.apply(null,success.concat(results))}return q={defer:function(f){if(callback!==noop)throw new Error;var t=slice.call(arguments,1);t.push(f);++waiting,tasks.push(t);start();return q},abort:function(){if(error==null){var i=ended+active,t;while(--i>=0)(t=tasks[i])&&t.abort&&t.abort();abort(new Error('abort'))}return q},await:function(f){if(callback!==noop)throw new Error;callback=f,callbackAll=false;if(!waiting&&!active)notify();return q},awaitAll:function(f){if(callback!==noop)throw new Error;callback=f,callbackAll=true;if(!waiting&&!active)notify();return q}}}function queue(concurrency){return newQueue(arguments.length?+concurrency:Infinity)}queue.version='1.2.1';return queue}))}());(function(){var define=System.amdDefine;define('common/FormBuilder.js',[],function(){function FormBuilder(url){this.form=document.createElement('form');this.form.setAttribute('action',url);this.form.setAttribute('method','post');this.form.setAttribute('enctype','multipart/form-data')}FormBuilder.prototype.append=function(field){this.form.appendChild(field)};FormBuilder.prototype.appendInput=function(name,value){var input=window.document.createElement('input');input.setAttribute('type','hidden');if(typeof name!=='string'){name=JSON.stringify(name)}input.setAttribute('name',encodeURIComponent(name));if(typeof value!=='string'){value=JSON.stringify(value)}input.setAttribute('value',value);this.append(input)};FormBuilder.prototype.create=function(){return this.form};return FormBuilder})}());(function(){var define=System.amdDefine;define('common/FormSubmitter.js',['common/util.js'],function(util){function FormSubmitter(form){var target=encodeURIComponent(util.uuid());this.form=form;this.form.setAttribute('target',target);this.iframe=window.document.createElement('iframe');this.iframe.setAttribute('style','display: none;');this.iframe.setAttribute('id',target);this.iframe.setAttribute('name',target)}function createDefaultParseError(message,responseText){return{status:500,statusText:message,response:null,responseText:responseText}}function createVarnishError(responseText){var err=createDefaultParseError('Failed to parse Varnish error.',responseText),errorCodeMatch=responseText.match(/<h1>Error\s(\d+)\s([a-zA-Z ]+)/);if(errorCodeMatch){err.status=parseInt(errorCodeMatch[1],10);err.statusText=errorCodeMatch[2]}return err}function createNginxError(responseText){var err=createDefaultParseError('Failed to parse nginx error.',responseText),errorCodeMatch=responseText.match(/<h1>(\d+)\s([a-zA-Z ]+)/);if(errorCodeMatch){err.status=parseInt(errorCodeMatch[1],10);err.statusText=errorCodeMatch[2]}return err}function createParseError(responseText){if(/<p>Varnish\scache\sserver<\/p>/.test(responseText)){return createVarnishError(responseText)}else if(/>nginx\//.test(responseText)){return createNginxError(responseText)}else{return createDefaultParseError('Parse error',responseText)}}function createServiceUnavailableError(){return{status:502,responseText:'IFRAME denied access to response document.'}}function createErrorFromResponse(response){return{status:response.statusCode,statusText:response.error,response:response,responseText:JSON.stringify(response)}}function getIFrameDocument(iframe){var doc=null;try{doc=iframe.contentWindow.document||iframe.contentDocument}catch(e){one.crashLogger.log('Error: Could not get hold of IFrame')}if(doc&&doc.body){return doc}else{throw createServiceUnavailableError()}}function getResponseText(doc){try{return doc.getElementById('response').innerHTML.replace(/&lt;/g,'<').replace(/&gt;/g,'>').replace(/&amp;/g,'&')}catch(e){throw createParseError(doc.body.innerHTML)}}function parseResponse(responseText){var response=null;try{response=JSON.parse(responseText)}catch(e){throw createParseError(responseText)}if(response&&response.error){throw createErrorFromResponse(response)}else{return response}}FormSubmitter.prototype.submit=function(onResponse){var iframe=this.iframe;var form=this.form;window.document.body.appendChild(form);window.document.body.appendChild(iframe);function cleanUpDOM(){window.document.body.removeChild(form);form=null;window.document.body.removeChild(iframe);iframe=null}$(iframe).load(function(){var response=null;var err=null;try{var doc=getIFrameDocument(iframe);if(!doc.body.innerHTML){return}response=parseResponse(getResponseText(doc))}catch(e){err={status:e.status,statusText:e.statusText,response:e.response,responseText:e.responseText}}setTimeout(function(){cleanUpDOM();if(err){onResponse(err,null)}else{onResponse(null,response)}},0)});form.submit()};return FormSubmitter})}());(function(){var define=System.amdDefine;(function(root,factory){if(typeof exports==='object'){module.exports=factory()}else if(typeof define==='function'&&define.amd){define('3rdparty/BeforeUnload.js',[],factory)}else{root.BeforeUnload=factory()}}(this,function(){function BeforeUnload(message,conditions,register){this.message=this.validateMessage(message);this.conditions=this.validateConditions(conditions);this.handlerReference=null;if(typeof register==='undefined'||register){this.register()}}BeforeUnload.prototype.validateConditions=function(conditions){if(typeof conditions==='function'){return[conditions]}else if(Array.isArray(conditions)){return conditions}else{this.throwException('You must provide either a list of functions, a function, or nothing as the second parameter.')}};BeforeUnload.prototype.validateMessage=function(message){if(typeof message!=='string'){this.throwException('You must provide a message.')}return message};BeforeUnload.prototype.check=function(){var result=false;this.conditions.some(function(condition){var conditionResult=condition();if(conditionResult){result=conditionResult}return conditionResult});return result};BeforeUnload.prototype.handler=function(e){var check=this.check();var message=check&&typeof check==='string'?check:this.message;if(check){(e||window.event).returnValue=message;return message}return void 0};BeforeUnload.prototype.register=function(target,handler){target=target?target:window;this.handlerReference=handler?handler:this.handler.bind(this);if(target.addEventListener){target.addEventListener('beforeunload',this.handlerReference)}else{target.attachEvent('onbeforeunload',this.handlerReference)}};BeforeUnload.prototype.unregister=function(target){target=target?target:window;if(this.handlerReference!==null){if(target.removeEventListener){target.removeEventListener('beforeunload',this.handlerReference)}else{target.detachEvent('onbeforeunload',this.handlerReference)}this.handlerReference=null}};BeforeUnload.prototype.confirmedIfNecessary=function(callback,preserveHandlers){var conditions=this.check();if(!conditions||window.confirm(typeof conditions==='string'?conditions:this.message)){if(!preserveHandlers){this.unregister()}callback()}};BeforeUnload.prototype.throwException=function(message){throw new Error('before-unload: '+message)};return BeforeUnload}))}());(function(){var define=System.amdDefine;(function(root,factory){if(typeof exports==='object'){module.exports=factory()}else if(typeof define==='function'&&define.amd){define('3rdparty/sha256hex.js',[],factory)}else{root.sha256hex=factory()}}(this,function(tracking,ErrorTracker){var hexcase=0;var b64pad='';function hex_sha256(s){return rstr2hex(rstr_sha256(str2rstr_utf8(s)))}function b64_sha256(s){return rstr2b64(rstr_sha256(str2rstr_utf8(s)))}function any_sha256(s,e){return rstr2any(rstr_sha256(str2rstr_utf8(s)),e)}function hex_hmac_sha256(k,d){return rstr2hex(rstr_hmac_sha256(str2rstr_utf8(k),str2rstr_utf8(d)))}function b64_hmac_sha256(k,d){return rstr2b64(rstr_hmac_sha256(str2rstr_utf8(k),str2rstr_utf8(d)))}function any_hmac_sha256(k,d,e){return rstr2any(rstr_hmac_sha256(str2rstr_utf8(k),str2rstr_utf8(d)),e)}function sha256_vm_test(){return hex_sha256('abc').toLowerCase()=='ba7816bf8f01cfea414140de5dae2223b00361a396177a9cb410ff61f20015ad'}function rstr_sha256(s){return binb2rstr(binb_sha256(rstr2binb(s),s.length*8))}function rstr_hmac_sha256(key,data){var bkey=rstr2binb(key);if(bkey.length>16)bkey=binb_sha256(bkey,key.length*8);var ipad=Array(16),opad=Array(16);for(var i=0;i<16;i++){ipad[i]=bkey[i]^909522486;opad[i]=bkey[i]^1549556828}var hash=binb_sha256(ipad.concat(rstr2binb(data)),512+data.length*8);return binb2rstr(binb_sha256(opad.concat(hash),512+256))}function rstr2hex(input){try{hexcase}catch(e){hexcase=0}var hex_tab=hexcase?'0123456789ABCDEF':'0123456789abcdef';var output='';var x;for(var i=0;i<input.length;i++){x=input.charCodeAt(i);output+=hex_tab.charAt(x>>>4&15)+hex_tab.charAt(x&15)}return output}function rstr2b64(input){try{b64pad}catch(e){b64pad=''}var tab='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/';var output='';var len=input.length;for(var i=0;i<len;i+=3){var triplet=input.charCodeAt(i)<<16|(i+1<len?input.charCodeAt(i+1)<<8:0)|(i+2<len?input.charCodeAt(i+2):0);for(var j=0;j<4;j++){if(i*8+j*6>input.length*8)output+=b64pad;else output+=tab.charAt(triplet>>>6*(3-j)&63)}}return output}function rstr2any(input,encoding){var divisor=encoding.length;var remainders=Array();var i,q,x,quotient;var dividend=Array(Math.ceil(input.length/2));for(i=0;i<dividend.length;i++){dividend[i]=input.charCodeAt(i*2)<<8|input.charCodeAt(i*2+1)}while(dividend.length>0){quotient=Array();x=0;for(i=0;i<dividend.length;i++){x=(x<<16)+dividend[i];q=Math.floor(x/divisor);x-=q*divisor;if(quotient.length>0||q>0)quotient[quotient.length]=q}remainders[remainders.length]=x;dividend=quotient}var output='';for(i=remainders.length-1;i>=0;i--)output+=encoding.charAt(remainders[i]);var full_length=Math.ceil(input.length*8/(Math.log(encoding.length)/Math.log(2)));for(i=output.length;i<full_length;i++)output=encoding[0]+output;return output}function str2rstr_utf8(input){var output='';var i=-1;var x,y;while(++i<input.length){x=input.charCodeAt(i);y=i+1<input.length?input.charCodeAt(i+1):0;if(55296<=x&&x<=56319&&56320<=y&&y<=57343){x=65536+((x&1023)<<10)+(y&1023);i++}if(x<=127)output+=String.fromCharCode(x);else if(x<=2047)output+=String.fromCharCode(192|x>>>6&31,128|x&63);else if(x<=65535)output+=String.fromCharCode(224|x>>>12&15,128|x>>>6&63,128|x&63);else if(x<=2097151)output+=String.fromCharCode(240|x>>>18&7,128|x>>>12&63,128|x>>>6&63,128|x&63)}return output}function str2rstr_utf16le(input){var output='';for(var i=0;i<input.length;i++)output+=String.fromCharCode(input.charCodeAt(i)&255,input.charCodeAt(i)>>>8&255);return output}function str2rstr_utf16be(input){var output='';for(var i=0;i<input.length;i++)output+=String.fromCharCode(input.charCodeAt(i)>>>8&255,input.charCodeAt(i)&255);return output}function rstr2binb(input){var output=Array(input.length>>2);for(var i=0;i<output.length;i++)output[i]=0;for(var i=0;i<input.length*8;i+=8)output[i>>5]|=(input.charCodeAt(i/8)&255)<<24-i%32;return output}function binb2rstr(input){var output='';for(var i=0;i<input.length*32;i+=8)output+=String.fromCharCode(input[i>>5]>>>24-i%32&255);return output}function sha256_S(X,n){return X>>>n|X<<32-n}function sha256_R(X,n){return X>>>n}function sha256_Ch(x,y,z){return x&y^~x&z}function sha256_Maj(x,y,z){return x&y^x&z^y&z}function sha256_Sigma0256(x){return sha256_S(x,2)^sha256_S(x,13)^sha256_S(x,22)}function sha256_Sigma1256(x){return sha256_S(x,6)^sha256_S(x,11)^sha256_S(x,25)}function sha256_Gamma0256(x){return sha256_S(x,7)^sha256_S(x,18)^sha256_R(x,3)}function sha256_Gamma1256(x){return sha256_S(x,17)^sha256_S(x,19)^sha256_R(x,10)}function sha256_Sigma0512(x){return sha256_S(x,28)^sha256_S(x,34)^sha256_S(x,39)}function sha256_Sigma1512(x){return sha256_S(x,14)^sha256_S(x,18)^sha256_S(x,41)}function sha256_Gamma0512(x){return sha256_S(x,1)^sha256_S(x,8)^sha256_R(x,7)}function sha256_Gamma1512(x){return sha256_S(x,19)^sha256_S(x,61)^sha256_R(x,6)}var sha256_K=new Array(1116352408,1899447441,-1245643825,-373957723,961987163,1508970993,-1841331548,-1424204075,-670586216,310598401,607225278,1426881987,1925078388,-2132889090,-1680079193,-1046744716,-459576895,-272742522,264347078,604807628,770255983,1249150122,1555081692,1996064986,-1740746414,-1473132947,-1341970488,-1084653625,-958395405,-710438585,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,-2117940946,-1838011259,-1564481375,-1474664885,-1035236496,-949202525,-778901479,-694614492,-200395387,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,-2067236844,-1933114872,-1866530822,-1538233109,-1090935817,-965641998);function binb_sha256(m,l){var HASH=new Array(1779033703,-1150833019,1013904242,-1521486534,1359893119,-1694144372,528734635,1541459225);var W=new Array(64);var a,b,c,d,e,f,g,h;var i,j,T1,T2;m[l>>5]|=128<<24-l%32;m[(l+64>>9<<4)+15]=l;for(i=0;i<m.length;i+=16){a=HASH[0];b=HASH[1];c=HASH[2];d=HASH[3];e=HASH[4];f=HASH[5];g=HASH[6];h=HASH[7];for(j=0;j<64;j++){if(j<16)W[j]=m[j+i];else W[j]=safe_add(safe_add(safe_add(sha256_Gamma1256(W[j-2]),W[j-7]),sha256_Gamma0256(W[j-15])),W[j-16]);T1=safe_add(safe_add(safe_add(safe_add(h,sha256_Sigma1256(e)),sha256_Ch(e,f,g)),sha256_K[j]),W[j]);T2=safe_add(sha256_Sigma0256(a),sha256_Maj(a,b,c));h=g;g=f;f=e;e=safe_add(d,T1);d=c;c=b;b=a;a=safe_add(T1,T2)}HASH[0]=safe_add(a,HASH[0]);HASH[1]=safe_add(b,HASH[1]);HASH[2]=safe_add(c,HASH[2]);HASH[3]=safe_add(d,HASH[3]);HASH[4]=safe_add(e,HASH[4]);HASH[5]=safe_add(f,HASH[5]);HASH[6]=safe_add(g,HASH[6]);HASH[7]=safe_add(h,HASH[7])}return HASH}function safe_add(x,y){var lsw=(x&65535)+(y&65535);var msw=(x>>16)+(y>>16)+(lsw>>16);return msw<<16|lsw&65535}return hex_sha256}))}());(function(){var define=System.amdDefine;define('common/migrations/migrateContactsCityToLocality.js',[],function(){function migrateContactsCityToLocality(data){if(!data){return}data.forEach(function(contact){(contact.addresses||[]).forEach(function(address){if(!address.locality&&address.city){address.locality=address.city}delete address.city})})}return migrateContactsCityToLocality})}());System.registerDynamic('calendar/timezones/**/*.ics!node_modules/systemjs-asset-plugin/asset-plugin.js',[],true,function($__require,exports,module){var define,global=this||self,GLOBAL=global;var obj={'Africa/Abidjan':'/static/Abidjan.dc9468decb.ics','Africa/Accra':'/static/Accra.86ddbc676c.ics','Africa/Addis_Ababa':'/static/Addis_Ababa.3c5906f619.ics','Africa/Algiers':'/static/Algiers.f240a1491a.ics','Africa/Asmara':'/static/Asmara.876b2a9cb1.ics','Africa/Asmera':'/static/Asmera.bf999f0361.ics','Africa/Bamako':'/static/Bamako.37ed4bfb23.ics','Africa/Bangui':'/static/Bangui.a535e7787c.ics','Africa/Banjul':'/static/Banjul.db57889d81.ics','Africa/Bissau':'/static/Bissau.d663fa03f0.ics','Africa/Blantyre':'/static/Blantyre.bd4f1c7015.ics','Africa/Brazzaville':'/static/Brazzaville.e32f24d245.ics','Africa/Bujumbura':'/static/Bujumbura.f100cb163e.ics','Africa/Cairo':'/static/Cairo.d3ff6cea9b.ics','Africa/Casablanca':'/static/Casablanca.0e6bfe0253.ics','Africa/Ceuta':'/static/Ceuta.8269343ee4.ics','Africa/Conakry':'/static/Conakry.700b9ead56.ics','Africa/Dakar':'/static/Dakar.deccdd6324.ics','Africa/Dar_es_Salaam':'/static/Dar_es_Salaam.83d4830f4d.ics','Africa/Djibouti':'/static/Djibouti.acc5e49e74.ics','Africa/Douala':'/static/Douala.a81ee6fe62.ics','Africa/El_Aaiun':'/static/El_Aaiun.562ac43ed7.ics','Africa/Freetown':'/static/Freetown.8da670d12c.ics','Africa/Gaborone':'/static/Gaborone.9bfc97aef6.ics','Africa/Harare':'/static/Harare.a4a32e9785.ics','Africa/Johannesburg':'/static/Johannesburg.a39046b0f3.ics','Africa/Juba':'/static/Juba.3f633cfde1.ics','Africa/Kampala':'/static/Kampala.69e4f167d0.ics','Africa/Khartoum':'/static/Khartoum.e4a944da17.ics','Africa/Kigali':'/static/Kigali.9c2beaea37.ics','Africa/Kinshasa':'/static/Kinshasa.6f0817402c.ics','Africa/Lagos':'/static/Lagos.c22edde6eb.ics','Africa/Libreville':'/static/Libreville.cec7e6e2ca.ics','Africa/Lome':'/static/Lome.4dd50f2ae0.ics','Africa/Luanda':'/static/Luanda.8c7d918745.ics','Africa/Lubumbashi':'/static/Lubumbashi.70fefbbf92.ics','Africa/Lusaka':'/static/Lusaka.06813effc2.ics','Africa/Malabo':'/static/Malabo.b1d825d648.ics','Africa/Maputo':'/static/Maputo.6c35a7afdb.ics','Africa/Maseru':'/static/Maseru.8896adae8c.ics','Africa/Mbabane':'/static/Mbabane.cb73246c06.ics','Africa/Mogadishu':'/static/Mogadishu.aeb9544650.ics','Africa/Monrovia':'/static/Monrovia.25533dd158.ics','Africa/Nairobi':'/static/Nairobi.0f834f9942.ics','Africa/Ndjamena':'/static/Ndjamena.e42e7efb88.ics','Africa/Niamey':'/static/Niamey.f360b823e1.ics','Africa/Nouakchott':'/static/Nouakchott.0f9508cd3e.ics','Africa/Ouagadougou':'/static/Ouagadougou.c0aaef7f39.ics','Africa/Porto-Novo':'/static/Porto-Novo.f44b3e7916.ics','Africa/Sao_Tome':'/static/Sao_Tome.1ac2bdc003.ics','Africa/Timbuktu':'/static/Timbuktu.2379a50ce0.ics','Africa/Tripoli':'/static/Tripoli.6e8040bfd8.ics','Africa/Tunis':'/static/Tunis.ae5e2a52ff.ics','Africa/Windhoek':'/static/Windhoek.f289f3354d.ics','America/Adak':'/static/Adak.5c8a69164c.ics','America/Anchorage':'/static/Anchorage.de9f2f0cfb.ics','America/Anguilla':'/static/Anguilla.dbe16a1225.ics','America/Antigua':'/static/Antigua.69e3a7a174.ics','America/Araguaina':'/static/Araguaina.4d0786c2a5.ics','America/Argentina/Buenos_Aires':'/static/Buenos_Aires.7c55847413.ics','America/Argentina/Catamarca':'/static/Catamarca.dd84a9f200.ics','America/Argentina/ComodRivadavia':'/static/ComodRivadavia.fa2eb8a113.ics','America/Argentina/Cordoba':'/static/Cordoba.1d379d81a3.ics','America/Argentina/Jujuy':'/static/Jujuy.0dc8dcd87b.ics','America/Argentina/La_Rioja':'/static/La_Rioja.072849b212.ics','America/Argentina/Mendoza':'/static/Mendoza.96329a35a4.ics','America/Argentina/Rio_Gallegos':'/static/Rio_Gallegos.f8212b0766.ics','America/Argentina/Salta':'/static/Salta.d957cf76d4.ics','America/Argentina/San_Juan':'/static/San_Juan.72a2df029c.ics','America/Argentina/San_Luis':'/static/San_Luis.31db41adcf.ics','America/Argentina/Tucuman':'/static/Tucuman.97cc8fdae1.ics','America/Argentina/Ushuaia':'/static/Ushuaia.e03471715d.ics','America/Aruba':'/static/Aruba.877fdd70d2.ics','America/Asuncion':'/static/Asuncion.b6d9cc532c.ics','America/Atikokan':'/static/Atikokan.e4eebf7057.ics','America/Atka':'/static/Atka.3518b4e404.ics','America/Bahia_Banderas':'/static/Bahia_Banderas.d53625addc.ics','America/Bahia':'/static/Bahia.2d34d74119.ics','America/Barbados':'/static/Barbados.30bd971666.ics','America/Belem':'/static/Belem.7ee3514e27.ics','America/Belize':'/static/Belize.9ee73b369b.ics','America/Blanc-Sablon':'/static/Blanc-Sablon.1b4b74fdfd.ics','America/Boa_Vista':'/static/Boa_Vista.a55f4d01f1.ics','America/Bogota':'/static/Bogota.cca1c4cc5d.ics','America/Boise':'/static/Boise.0652f8de49.ics','America/Buenos_Aires':'/static/Buenos_Aires.8814f42968.ics','America/Cambridge_Bay':'/static/Cambridge_Bay.de9bb35f5c.ics','America/Campo_Grande':'/static/Campo_Grande.b1a5e9641e.ics','America/Cancun':'/static/Cancun.d90fe699b6.ics','America/Caracas':'/static/Caracas.d905a6b904.ics','America/Catamarca':'/static/Catamarca.3205d14837.ics','America/Cayenne':'/static/Cayenne.298d74a012.ics','America/Cayman':'/static/Cayman.8319a9f7d2.ics','America/Chicago':'/static/Chicago.afaa6e4df3.ics','America/Chihuahua':'/static/Chihuahua.43622e982e.ics','America/Coral_Harbour':'/static/Coral_Harbour.714d0ae269.ics','America/Cordoba':'/static/Cordoba.9608ec5834.ics','America/Costa_Rica':'/static/Costa_Rica.146002314c.ics','America/Creston':'/static/Creston.9c9826b4bd.ics','America/Cuiaba':'/static/Cuiaba.33cbb21d48.ics','America/Curacao':'/static/Curacao.0b270fa38a.ics','America/Danmarkshavn':'/static/Danmarkshavn.a3175f6b91.ics','America/Dawson_Creek':'/static/Dawson_Creek.74079eb0ff.ics','America/Dawson':'/static/Dawson.92cc3b9eb6.ics','America/Denver':'/static/Denver.436e14808b.ics','America/Detroit':'/static/Detroit.719084f025.ics','America/Dominica':'/static/Dominica.7a07f99ab5.ics','America/Edmonton':'/static/Edmonton.a02dac4fc5.ics','America/Eirunepe':'/static/Eirunepe.cc34b66260.ics','America/El_Salvador':'/static/El_Salvador.15a3874396.ics','America/Ensenada':'/static/Ensenada.6d84d01016.ics','America/Fort_Nelson':'/static/Fort_Nelson.b87796b610.ics','America/Fort_Wayne':'/static/Fort_Wayne.89d10c6899.ics','America/Fortaleza':'/static/Fortaleza.5bb469255b.ics','America/Glace_Bay':'/static/Glace_Bay.f0d7bfeb83.ics','America/Godthab':'/static/Godthab.b164983aee.ics','America/Goose_Bay':'/static/Goose_Bay.401fd812f6.ics','America/Grand_Turk':'/static/Grand_Turk.0e97a322d3.ics','America/Grenada':'/static/Grenada.ed3d7b7bb0.ics','America/Guadeloupe':'/static/Guadeloupe.7b37cd74d6.ics','America/Guatemala':'/static/Guatemala.3f5dcae7aa.ics','America/Guayaquil':'/static/Guayaquil.21ed9dff66.ics','America/Guyana':'/static/Guyana.e141f56ad7.ics','America/Halifax':'/static/Halifax.2bb9574897.ics','America/Havana':'/static/Havana.84655476c0.ics','America/Hermosillo':'/static/Hermosillo.da0d9289c3.ics','America/Indiana/Indianapolis':'/static/Indianapolis.d6c5e69d3f.ics','America/Indiana/Knox':'/static/Knox.183979417f.ics','America/Indiana/Marengo':'/static/Marengo.407883b0b9.ics','America/Indiana/Petersburg':'/static/Petersburg.6042c39581.ics','America/Indiana/Tell_City':'/static/Tell_City.150951054e.ics','America/Indiana/Vevay':'/static/Vevay.554d78ee1f.ics','America/Indiana/Vincennes':'/static/Vincennes.c536774aa4.ics','America/Indiana/Winamac':'/static/Winamac.7401e1b6e0.ics','America/Indianapolis':'/static/Indianapolis.6e96ffc0ee.ics','America/Inuvik':'/static/Inuvik.75b287d7fa.ics','America/Iqaluit':'/static/Iqaluit.02462e190e.ics','America/Jamaica':'/static/Jamaica.6223651527.ics','America/Jujuy':'/static/Jujuy.9af342d45a.ics','America/Juneau':'/static/Juneau.14a98f49f1.ics','America/Kentucky/Louisville':'/static/Louisville.dc14d1f327.ics','America/Kentucky/Monticello':'/static/Monticello.5a10d04a0a.ics','America/Knox_IN':'/static/Knox_IN.f1c0a5a9b7.ics','America/Kralendijk':'/static/Kralendijk.532609ea9f.ics','America/La_Paz':'/static/La_Paz.098e905a3d.ics','America/Lima':'/static/Lima.435eabd8a0.ics','America/Los_Angeles':'/static/Los_Angeles.780e53b44c.ics','America/Louisville':'/static/Louisville.8846f514b0.ics','America/Lower_Princes':'/static/Lower_Princes.7f4a0d78d4.ics','America/Maceio':'/static/Maceio.f1d1e125c6.ics','America/Managua':'/static/Managua.a42c67a869.ics','America/Manaus':'/static/Manaus.bc91b57f39.ics','America/Marigot':'/static/Marigot.219cf3ff91.ics','America/Martinique':'/static/Martinique.decdff5a68.ics','America/Matamoros':'/static/Matamoros.72a80a6d46.ics','America/Mazatlan':'/static/Mazatlan.24c68eb3d8.ics','America/Mendoza':'/static/Mendoza.8a6109cd33.ics','America/Menominee':'/static/Menominee.9fb30be5fe.ics','America/Merida':'/static/Merida.a0fae46b60.ics','America/Metlakatla':'/static/Metlakatla.12976c8a70.ics','America/Mexico_City':'/static/Mexico_City.2bf2d4a670.ics','America/Miquelon':'/static/Miquelon.9544c4a062.ics','America/Moncton':'/static/Moncton.454d97d9f3.ics','America/Monterrey':'/static/Monterrey.972d0a68dc.ics','America/Montevideo':'/static/Montevideo.bc71b44f01.ics','America/Montreal':'/static/Montreal.f3818a6930.ics','America/Montserrat':'/static/Montserrat.33c697bb4f.ics','America/Nassau':'/static/Nassau.316623059a.ics','America/New_York':'/static/New_York.7f02ecc0b9.ics','America/Nipigon':'/static/Nipigon.3ac6a11d04.ics','America/Nome':'/static/Nome.630b48d08b.ics','America/Noronha':'/static/Noronha.1ecec7d8ed.ics','America/North_Dakota/Beulah':'/static/Beulah.060d3de8fa.ics','America/North_Dakota/Center':'/static/Center.7b99f45af7.ics','America/North_Dakota/New_Salem':'/static/New_Salem.e363646cd3.ics','America/Ojinaga':'/static/Ojinaga.158306a6a0.ics','America/Panama':'/static/Panama.ac55fd15a3.ics','America/Pangnirtung':'/static/Pangnirtung.14dcab83ce.ics','America/Paramaribo':'/static/Paramaribo.13f0d12b04.ics','America/Phoenix':'/static/Phoenix.36f6704008.ics','America/Port_of_Spain':'/static/Port_of_Spain.e0bb07b4ce.ics','America/Port-au-Prince':'/static/Port-au-Prince.a9d3c599c2.ics','America/Porto_Acre':'/static/Porto_Acre.b2b04e3c9c.ics','America/Porto_Velho':'/static/Porto_Velho.f78c4e4a4b.ics','America/Puerto_Rico':'/static/Puerto_Rico.e8b25a2b23.ics','America/Rainy_River':'/static/Rainy_River.d619aec7cf.ics','America/Rankin_Inlet':'/static/Rankin_Inlet.a10b819963.ics','America/Recife':'/static/Recife.20321ae3fd.ics','America/Regina':'/static/Regina.2a81ea7d4c.ics','America/Resolute':'/static/Resolute.7cb27278d7.ics','America/Rio_Branco':'/static/Rio_Branco.51273c4521.ics','America/Rosario':'/static/Rosario.4283b20ea1.ics','America/Santa_Isabel':'/static/Santa_Isabel.5f4f9171ee.ics','America/Santarem':'/static/Santarem.b8f9580b31.ics','America/Santiago':'/static/Santiago.bfadaf3598.ics','America/Santo_Domingo':'/static/Santo_Domingo.47d3a2d59a.ics','America/Sao_Paulo':'/static/Sao_Paulo.2259ef5c2f.ics','America/Scoresbysund':'/static/Scoresbysund.b77ab8f21a.ics','America/Shiprock':'/static/Shiprock.0d1376f4dd.ics','America/Sitka':'/static/Sitka.3471ced20f.ics','America/St_Barthelemy':'/static/St_Barthelemy.282f73e528.ics','America/St_Johns':'/static/St_Johns.08674807ec.ics','America/St_Kitts':'/static/St_Kitts.40a657ac17.ics','America/St_Lucia':'/static/St_Lucia.76cf7c0ae9.ics','America/St_Thomas':'/static/St_Thomas.0dac89af79.ics','America/St_Vincent':'/static/St_Vincent.6aae72797c.ics','America/Swift_Current':'/static/Swift_Current.6a3d40f3be.ics','America/Tegucigalpa':'/static/Tegucigalpa.4ccca02752.ics','America/Thule':'/static/Thule.8407b37986.ics','America/Thunder_Bay':'/static/Thunder_Bay.aca23e8da3.ics','America/Tijuana':'/static/Tijuana.b4f2486c5f.ics','America/Toronto':'/static/Toronto.6f3ca13503.ics','America/Tortola':'/static/Tortola.c19dd4b874.ics','America/Vancouver':'/static/Vancouver.df39037620.ics','America/Virgin':'/static/Virgin.7f6b5b25ec.ics','America/Whitehorse':'/static/Whitehorse.550b160273.ics','America/Winnipeg':'/static/Winnipeg.bd1a4e7ccb.ics','America/Yakutat':'/static/Yakutat.a7d1c7f8aa.ics','America/Yellowknife':'/static/Yellowknife.5d5d8c3106.ics','Antarctica/Casey':'/static/Casey.3308795470.ics','Antarctica/Davis':'/static/Davis.b1e9fc34bd.ics','Antarctica/DumontDUrville':'/static/DumontDUrville.86b0798b0a.ics','Antarctica/Macquarie':'/static/Macquarie.22cf8fd0c1.ics','Antarctica/Mawson':'/static/Mawson.c4c48c5496.ics','Antarctica/McMurdo':'/static/McMurdo.3e1599b00f.ics','Antarctica/Palmer':'/static/Palmer.caa20e26e6.ics','Antarctica/Rothera':'/static/Rothera.bf685ca594.ics','Antarctica/South_Pole':'/static/South_Pole.01586fbc05.ics','Antarctica/Syowa':'/static/Syowa.414e5b8cef.ics','Antarctica/Troll':'/static/Troll.6c9015fce7.ics','Antarctica/Vostok':'/static/Vostok.80678f0408.ics','Arctic/Longyearbyen':'/static/Longyearbyen.40145ed84d.ics','Asia/Aden':'/static/Aden.5a0d022ed2.ics','Asia/Almaty':'/static/Almaty.88feb91cce.ics','Asia/Amman':'/static/Amman.ba1a51f6f6.ics','Asia/Anadyr':'/static/Anadyr.a19f48017b.ics','Asia/Aqtau':'/static/Aqtau.b4c4906955.ics','Asia/Aqtobe':'/static/Aqtobe.c1af34b4f8.ics','Asia/Ashgabat':'/static/Ashgabat.c0d6c6c760.ics','Asia/Ashkhabad':'/static/Ashkhabad.8effbf320a.ics','Asia/Baghdad':'/static/Baghdad.6b989fb5fc.ics','Asia/Bahrain':'/static/Bahrain.246ef3782f.ics','Asia/Baku':'/static/Baku.15a8ad80ea.ics','Asia/Bangkok':'/static/Bangkok.0ee6b61e4d.ics','Asia/Barnaul':'/static/Barnaul.a53eb2b99b.ics','Asia/Beirut':'/static/Beirut.ec07a7c21e.ics','Asia/Bishkek':'/static/Bishkek.4940b2b66e.ics','Asia/Brunei':'/static/Brunei.21ce0c633c.ics','Asia/Calcutta':'/static/Calcutta.43bbd7aad1.ics','Asia/Chita':'/static/Chita.aa3cf97a83.ics','Asia/Choibalsan':'/static/Choibalsan.5c5e9107e6.ics','Asia/Chongqing':'/static/Chongqing.f27728f7cc.ics','Asia/Chungking':'/static/Chungking.29688a8d83.ics','Asia/Colombo':'/static/Colombo.db90d93971.ics','Asia/Dacca':'/static/Dacca.0b4afb7a42.ics','Asia/Damascus':'/static/Damascus.725cbf5cac.ics','Asia/Dhaka':'/static/Dhaka.e206110113.ics','Asia/Dili':'/static/Dili.f846195e2b.ics','Asia/Dubai':'/static/Dubai.e762e58c96.ics','Asia/Dushanbe':'/static/Dushanbe.ce2ef437c1.ics','Asia/Gaza':'/static/Gaza.c391cc0f79.ics','Asia/Harbin':'/static/Harbin.8cb255c03a.ics','Asia/Hebron':'/static/Hebron.500e308342.ics','Asia/Ho_Chi_Minh':'/static/Ho_Chi_Minh.c5cce4b0ba.ics','Asia/Hong_Kong':'/static/Hong_Kong.2d71d21ac4.ics','Asia/Hovd':'/static/Hovd.ef08e41133.ics','Asia/Irkutsk':'/static/Irkutsk.1f6d999bab.ics','Asia/Istanbul':'/static/Istanbul.4d7596ed78.ics','Asia/Jakarta':'/static/Jakarta.37eb197c79.ics','Asia/Jayapura':'/static/Jayapura.8872e943a4.ics','Asia/Jerusalem':'/static/Jerusalem.85a1cb333e.ics','Asia/Kabul':'/static/Kabul.aed7a26e32.ics','Asia/Kamchatka':'/static/Kamchatka.1b733d7fef.ics','Asia/Karachi':'/static/Karachi.0f86f0a833.ics','Asia/Kashgar':'/static/Kashgar.50f9b83adc.ics','Asia/Kathmandu':'/static/Kathmandu.2d26857827.ics','Asia/Katmandu':'/static/Katmandu.dfcdb151e1.ics','Asia/Khandyga':'/static/Khandyga.e1042a6d31.ics','Asia/Kolkata':'/static/Kolkata.262f867727.ics','Asia/Krasnoyarsk':'/static/Krasnoyarsk.11240abeb7.ics','Asia/Kuala_Lumpur':'/static/Kuala_Lumpur.71f566a1dd.ics','Asia/Kuching':'/static/Kuching.1825fa4a57.ics','Asia/Kuwait':'/static/Kuwait.95c52f4d07.ics','Asia/Macao':'/static/Macao.9c403f1990.ics','Asia/Macau':'/static/Macau.97b56bc1c1.ics','Asia/Magadan':'/static/Magadan.35b30282bd.ics','Asia/Makassar':'/static/Makassar.d34ae21548.ics','Asia/Manila':'/static/Manila.9d4ffa5583.ics','Asia/Muscat':'/static/Muscat.4fef950b4b.ics','Asia/Nicosia':'/static/Nicosia.89053abb8d.ics','Asia/Novokuznetsk':'/static/Novokuznetsk.7301fd3c16.ics','Asia/Novosibirsk':'/static/Novosibirsk.aa90f2f061.ics','Asia/Omsk':'/static/Omsk.a894c96d9d.ics','Asia/Oral':'/static/Oral.dd8cc94814.ics','Asia/Phnom_Penh':'/static/Phnom_Penh.72952edd70.ics','Asia/Pontianak':'/static/Pontianak.257fd7f7bf.ics','Asia/Pyongyang':'/static/Pyongyang.f1a688c28c.ics','Asia/Qatar':'/static/Qatar.1f5766aa37.ics','Asia/Qyzylorda':'/static/Qyzylorda.4bd677b92a.ics','Asia/Rangoon':'/static/Rangoon.c0defadd7d.ics','Asia/Riyadh':'/static/Riyadh.02593ad914.ics','Asia/Saigon':'/static/Saigon.189a1c810e.ics','Asia/Sakhalin':'/static/Sakhalin.0c8deda971.ics','Asia/Samarkand':'/static/Samarkand.9849795547.ics','Asia/Seoul':'/static/Seoul.597564d369.ics','Asia/Shanghai':'/static/Shanghai.b062a101bd.ics','Asia/Singapore':'/static/Singapore.f2f8be5108.ics','Asia/Srednekolymsk':'/static/Srednekolymsk.af06cde7ed.ics','Asia/Taipei':'/static/Taipei.30a11bdf61.ics','Asia/Tashkent':'/static/Tashkent.02a3e88487.ics','Asia/Tbilisi':'/static/Tbilisi.5ff7e94fcb.ics','Asia/Tehran':'/static/Tehran.a11dd9983f.ics','Asia/Tel_Aviv':'/static/Tel_Aviv.a5c3bc9524.ics','Asia/Thimbu':'/static/Thimbu.895c0dfb8f.ics','Asia/Thimphu':'/static/Thimphu.3b523bb3f7.ics','Asia/Tokyo':'/static/Tokyo.11f1afc021.ics','Asia/Tomsk':'/static/Tomsk.7b0857f05a.ics','Asia/Ujung_Pandang':'/static/Ujung_Pandang.8a094c3a68.ics','Asia/Ulaanbaatar':'/static/Ulaanbaatar.1c9543f5d5.ics','Asia/Ulan_Bator':'/static/Ulan_Bator.b322fe39ce.ics','Asia/Urumqi':'/static/Urumqi.6dc92a1533.ics','Asia/Ust-Nera':'/static/Ust-Nera.8c9b3bfc61.ics','Asia/Vientiane':'/static/Vientiane.9cbe3d1ef1.ics','Asia/Vladivostok':'/static/Vladivostok.0225dac991.ics','Asia/Yakutsk':'/static/Yakutsk.96e54bb596.ics','Asia/Yangon':'/static/Yangon.6a3bdef83f.ics','Asia/Yekaterinburg':'/static/Yekaterinburg.ff65b039ed.ics','Asia/Yerevan':'/static/Yerevan.47acbd0505.ics','Atlantic/Azores':'/static/Azores.5048d535c5.ics','Atlantic/Bermuda':'/static/Bermuda.c06818f966.ics','Atlantic/Canary':'/static/Canary.95fc965719.ics','Atlantic/Cape_Verde':'/static/Cape_Verde.486c6cca31.ics','Atlantic/Faeroe':'/static/Faeroe.b494bcd3f5.ics','Atlantic/Faroe':'/static/Faroe.0b8454be6b.ics','Atlantic/Jan_Mayen':'/static/Jan_Mayen.fd246a3cc9.ics','Atlantic/Madeira':'/static/Madeira.bcc7285c8b.ics','Atlantic/Reykjavik':'/static/Reykjavik.86b16bc311.ics','Atlantic/South_Georgia':'/static/South_Georgia.a39b381162.ics','Atlantic/St_Helena':'/static/St_Helena.106bfe228e.ics','Atlantic/Stanley':'/static/Stanley.75e381c168.ics','Australia/ACT':'/static/ACT.a122be16c6.ics','Australia/Adelaide':'/static/Adelaide.03c14d2911.ics','Australia/Brisbane':'/static/Brisbane.bf3ea8a247.ics','Australia/Broken_Hill':'/static/Broken_Hill.cade9fa08e.ics','Australia/Canberra':'/static/Canberra.4b31678133.ics','Australia/Currie':'/static/Currie.89eb08746b.ics','Australia/Darwin':'/static/Darwin.4928a869fd.ics','Australia/Eucla':'/static/Eucla.3c57079b8b.ics','Australia/Hobart':'/static/Hobart.406bdd9695.ics','Australia/LHI':'/static/LHI.3a697f264f.ics','Australia/Lindeman':'/static/Lindeman.309abd74a2.ics','Australia/Lord_Howe':'/static/Lord_Howe.b2a5e3d36d.ics','Australia/Melbourne':'/static/Melbourne.4af8e05e72.ics','Australia/North':'/static/North.1b75d25627.ics','Australia/NSW':'/static/NSW.a9123b7446.ics','Australia/Perth':'/static/Perth.5d1780e94d.ics','Australia/Queensland':'/static/Queensland.59585c90de.ics','Australia/South':'/static/South.fee294dea3.ics','Australia/Sydney':'/static/Sydney.6937b3ce5e.ics','Australia/Tasmania':'/static/Tasmania.3d961e6442.ics','Australia/Victoria':'/static/Victoria.ffd795f3a8.ics','Australia/West':'/static/West.02c7fba7a6.ics','Australia/Yancowinna':'/static/Yancowinna.7d72dd3649.ics','Brazil/Acre':'/static/Acre.ad33124888.ics','Brazil/DeNoronha':'/static/DeNoronha.076a9732c2.ics','Brazil/East':'/static/East.91a64115d6.ics','Brazil/West':'/static/West.0418c9a738.ics','Canada/Atlantic':'/static/Atlantic.2cbf7a81ab.ics','Canada/Central':'/static/Central.6d646828ac.ics','Canada/East-Saskatchewan':'/static/East-Saskatchewan.20b7d26855.ics','Canada/Eastern':'/static/Eastern.18dfd0e4b1.ics','Canada/Mountain':'/static/Mountain.00d54a5424.ics','Canada/Newfoundland':'/static/Newfoundland.28502a1271.ics','Canada/Pacific':'/static/Pacific.b090adfacf.ics','Canada/Saskatchewan':'/static/Saskatchewan.264893463e.ics','Canada/Yukon':'/static/Yukon.d72dbe952c.ics','Chile/Continental':'/static/Continental.2195b14d49.ics','Chile/EasterIsland':'/static/EasterIsland.a1d69fef37.ics','Etc/GMT-0':'/static/GMT-0.744c1800ff.ics','Etc/GMT-1':'/static/GMT-1.5ca94bda37.ics','Etc/GMT-10':'/static/GMT-10.f9cca574ee.ics','Etc/GMT-11':'/static/GMT-11.afb6ab0adb.ics','Etc/GMT-12':'/static/GMT-12.73edf89659.ics','Etc/GMT-13':'/static/GMT-13.e47c2b5193.ics','Etc/GMT-14':'/static/GMT-14.ca2e29f324.ics','Etc/GMT-2':'/static/GMT-2.5cc1547197.ics','Etc/GMT-3':'/static/GMT-3.305b8d9dba.ics','Etc/GMT-4':'/static/GMT-4.2453338f77.ics','Etc/GMT-5':'/static/GMT-5.7115571a9b.ics','Etc/GMT-6':'/static/GMT-6.4dcf16670e.ics','Etc/GMT-7':'/static/GMT-7.645bb9fe3e.ics','Etc/GMT-8':'/static/GMT-8.aa79f78107.ics','Etc/GMT-9':'/static/GMT-9.01d7e0cd4e.ics','Etc/GMT':'/static/GMT.ab58ab7e40.ics','Etc/GMT+0':'/static/GMT+0.31ae129ddb.ics','Etc/GMT+1':'/static/GMT+1.15db1644b1.ics','Etc/GMT+10':'/static/GMT+10.3a0a6ccab3.ics','Etc/GMT+11':'/static/GMT+11.84011890bb.ics','Etc/GMT+12':'/static/GMT+12.a66155e453.ics','Etc/GMT+2':'/static/GMT+2.23dc2c5471.ics','Etc/GMT+3':'/static/GMT+3.3240b3eff4.ics','Etc/GMT+4':'/static/GMT+4.0f6e75574f.ics','Etc/GMT+5':'/static/GMT+5.34135750aa.ics','Etc/GMT+6':'/static/GMT+6.833c1ebcec.ics','Etc/GMT+7':'/static/GMT+7.70d6066e8e.ics','Etc/GMT+8':'/static/GMT+8.db8038230c.ics','Etc/GMT+9':'/static/GMT+9.b8026f23a2.ics','Etc/GMT0':'/static/GMT0.220f0fe227.ics','Etc/Greenwich':'/static/Greenwich.c19e43fa0d.ics','Etc/UCT':'/static/UCT.9d822cf62e.ics','Etc/Universal':'/static/Universal.9ecca00823.ics','Etc/UTC':'/static/UTC.d50331d2de.ics','Etc/Zulu':'/static/Zulu.760f08d7ad.ics','Europe/Amsterdam':'/static/Amsterdam.c9008d7c6b.ics','Europe/Andorra':'/static/Andorra.3b455db928.ics','Europe/Astrakhan':'/static/Astrakhan.02a3eb6490.ics','Europe/Athens':'/static/Athens.a6b491efd7.ics','Europe/Belfast':'/static/Belfast.39a8054113.ics','Europe/Belgrade':'/static/Belgrade.01899f70ed.ics','Europe/Berlin':'/static/Berlin.7eff1fef65.ics','Europe/Bratislava':'/static/Bratislava.4c177543b6.ics','Europe/Brussels':'/static/Brussels.947ee56d6d.ics','Europe/Bucharest':'/static/Bucharest.06f5949f16.ics','Europe/Budapest':'/static/Budapest.7d42315fc9.ics','Europe/Busingen':'/static/Busingen.7e93edc4d9.ics','Europe/Chisinau':'/static/Chisinau.b609dfd5bc.ics','Europe/Copenhagen':'/static/Copenhagen.2623d7ea24.ics','Europe/Dublin':'/static/Dublin.e1a3557f80.ics','Europe/Gibraltar':'/static/Gibraltar.c6ee0d8632.ics','Europe/Guernsey':'/static/Guernsey.cc746c3c4e.ics','Europe/Helsinki':'/static/Helsinki.7af522c8e3.ics','Europe/Isle_of_Man':'/static/Isle_of_Man.a9d43de943.ics','Europe/Istanbul':'/static/Istanbul.300a145bd8.ics','Europe/Jersey':'/static/Jersey.0d7a5c63ac.ics','Europe/Kaliningrad':'/static/Kaliningrad.afd265f294.ics','Europe/Kiev':'/static/Kiev.e8d3adb6ed.ics','Europe/Kirov':'/static/Kirov.582bd88206.ics','Europe/Lisbon':'/static/Lisbon.1bf3cd0335.ics','Europe/Ljubljana':'/static/Ljubljana.f19fdf5fae.ics','Europe/London':'/static/London.d9c25d5b2e.ics','Europe/Luxembourg':'/static/Luxembourg.7abe6541de.ics','Europe/Madrid':'/static/Madrid.8e6ef7994f.ics','Europe/Malta':'/static/Malta.e6e445c712.ics','Europe/Mariehamn':'/static/Mariehamn.1a9a5556ae.ics','Europe/Minsk':'/static/Minsk.7b7713393f.ics','Europe/Monaco':'/static/Monaco.b9c2a904bd.ics','Europe/Moscow':'/static/Moscow.235d105099.ics','Europe/Nicosia':'/static/Nicosia.c7d45824eb.ics','Europe/Oslo':'/static/Oslo.dc0867bc64.ics','Europe/Paris':'/static/Paris.8dcfe790e2.ics','Europe/Podgorica':'/static/Podgorica.189746d0f1.ics','Europe/Prague':'/static/Prague.66c9d95e26.ics','Europe/Riga':'/static/Riga.810e546078.ics','Europe/Rome':'/static/Rome.6045fad13f.ics','Europe/Samara':'/static/Samara.3ec712f5e7.ics','Europe/San_Marino':'/static/San_Marino.73432e03ba.ics','Europe/Sarajevo':'/static/Sarajevo.1fadc0b163.ics','Europe/Simferopol':'/static/Simferopol.1e5058bc4f.ics','Europe/Skopje':'/static/Skopje.169bf6247d.ics','Europe/Sofia':'/static/Sofia.8e4d124d87.ics','Europe/Stockholm':'/static/Stockholm.30ce2f0780.ics','Europe/Tallinn':'/static/Tallinn.dc9718f85e.ics','Europe/Tirane':'/static/Tirane.477f6423bb.ics','Europe/Tiraspol':'/static/Tiraspol.db87d59b6a.ics','Europe/Ulyanovsk':'/static/Ulyanovsk.f1a76bdfea.ics','Europe/Uzhgorod':'/static/Uzhgorod.63a3843a52.ics','Europe/Vaduz':'/static/Vaduz.f751185606.ics','Europe/Vatican':'/static/Vatican.02695f2268.ics','Europe/Vienna':'/static/Vienna.d4657964f7.ics','Europe/Vilnius':'/static/Vilnius.8ea8a80909.ics','Europe/Volgograd':'/static/Volgograd.01b0891b84.ics','Europe/Warsaw':'/static/Warsaw.9011dff96a.ics','Europe/Zagreb':'/static/Zagreb.28a36cb8a4.ics','Europe/Zaporozhye':'/static/Zaporozhye.dddd16fdfb.ics','Europe/Zurich':'/static/Zurich.f4cfe31d99.ics','Indian/Antananarivo':'/static/Antananarivo.917c44a801.ics','Indian/Chagos':'/static/Chagos.567365fd5a.ics','Indian/Christmas':'/static/Christmas.78e32232b4.ics','Indian/Cocos':'/static/Cocos.3ab1a4b77f.ics','Indian/Comoro':'/static/Comoro.4489773149.ics','Indian/Kerguelen':'/static/Kerguelen.b070832e03.ics','Indian/Mahe':'/static/Mahe.eecf72296c.ics','Indian/Maldives':'/static/Maldives.f72bd0ab06.ics','Indian/Mauritius':'/static/Mauritius.1ef668c409.ics','Indian/Mayotte':'/static/Mayotte.b167c17a0d.ics','Indian/Reunion':'/static/Reunion.741555128a.ics','Mexico/BajaNorte':'/static/BajaNorte.d43037b590.ics','Mexico/BajaSur':'/static/BajaSur.8d51778693.ics','Mexico/General':'/static/General.3b33093afd.ics','Pacific/Apia':'/static/Apia.26019758f8.ics','Pacific/Auckland':'/static/Auckland.31b52d1557.ics','Pacific/Bougainville':'/static/Bougainville.abf6675f63.ics','Pacific/Chatham':'/static/Chatham.0eb2a5bd48.ics','Pacific/Chuuk':'/static/Chuuk.e27f3d7591.ics','Pacific/Easter':'/static/Easter.7e6fa64c73.ics','Pacific/Efate':'/static/Efate.9be7cc4691.ics','Pacific/Enderbury':'/static/Enderbury.0cc659854c.ics','Pacific/Fakaofo':'/static/Fakaofo.4c2841faa2.ics','Pacific/Fiji':'/static/Fiji.c570712fbd.ics','Pacific/Funafuti':'/static/Funafuti.8151c0448f.ics','Pacific/Galapagos':'/static/Galapagos.36c139cfb7.ics','Pacific/Gambier':'/static/Gambier.146cdb3c57.ics','Pacific/Guadalcanal':'/static/Guadalcanal.ac17a77c46.ics','Pacific/Guam':'/static/Guam.77d1448c52.ics','Pacific/Honolulu':'/static/Honolulu.be013195b9.ics','Pacific/Johnston':'/static/Johnston.82a4fca854.ics','Pacific/Kiritimati':'/static/Kiritimati.8f91b87bd5.ics','Pacific/Kosrae':'/static/Kosrae.d7026bbafd.ics','Pacific/Kwajalein':'/static/Kwajalein.3f9fde4ba2.ics','Pacific/Majuro':'/static/Majuro.0ba8b75760.ics','Pacific/Marquesas':'/static/Marquesas.c0b76e212c.ics','Pacific/Midway':'/static/Midway.2ea18044fa.ics','Pacific/Nauru':'/static/Nauru.0a61ad27da.ics','Pacific/Niue':'/static/Niue.104f51b652.ics','Pacific/Norfolk':'/static/Norfolk.95d48120ce.ics','Pacific/Noumea':'/static/Noumea.5a2e4e6bab.ics','Pacific/Pago_Pago':'/static/Pago_Pago.28462857ff.ics','Pacific/Palau':'/static/Palau.e47c8195ec.ics','Pacific/Pitcairn':'/static/Pitcairn.1edbcbc683.ics','Pacific/Pohnpei':'/static/Pohnpei.a35aee50c7.ics','Pacific/Ponape':'/static/Ponape.dfcf75fdd4.ics','Pacific/Port_Moresby':'/static/Port_Moresby.042a04dfc5.ics','Pacific/Rarotonga':'/static/Rarotonga.09807d21db.ics','Pacific/Saipan':'/static/Saipan.c851af47e8.ics','Pacific/Samoa':'/static/Samoa.4d144eb4f7.ics','Pacific/Tahiti':'/static/Tahiti.9ea877f5d4.ics','Pacific/Tarawa':'/static/Tarawa.f081bd2e38.ics','Pacific/Tongatapu':'/static/Tongatapu.2124717920.ics','Pacific/Truk':'/static/Truk.f57c9c7a7b.ics','Pacific/Wake':'/static/Wake.9ccddcd556.ics','Pacific/Wallis':'/static/Wallis.bc5d9160c9.ics','Pacific/Yap':'/static/Yap.721ea1e811.ics','US/Alaska':'/static/Alaska.0079a04f2e.ics','US/Aleutian':'/static/Aleutian.2e13d22a6f.ics','US/Arizona':'/static/Arizona.37d8a4aaa8.ics','US/Central':'/static/Central.bbd226d028.ics','US/East-Indiana':'/static/East-Indiana.38b5608b46.ics','US/Eastern':'/static/Eastern.6857581108.ics','US/Hawaii':'/static/Hawaii.ec730fd926.ics','US/Indiana-Starke':'/static/Indiana-Starke.4af4814790.ics','US/Michigan':'/static/Michigan.cae1c31df8.ics','US/Mountain':'/static/Mountain.85f5a54d3d.ics','US/Pacific':'/static/Pacific.5867a98849.ics','US/Samoa':'/static/Samoa.c3c91d4c59.ics'};module.exports=function(){var output=obj;for(var i=0;i<arguments.length;i++){if(typeof obj[arguments[i]]!=='object'&&i!==arguments.length-1)throw new TypeError('Unable to read argument "'+arguments[i]+'" from glob in '+module.id);output=output[arguments[i]]}return output};return module.exports});(function(){var define=System.amdDefine;define('common/Backend.js',['node_modules/jquery/dist/jquery.js','node_modules/knockout/build/output/knockout-latest.debug.js','3rdparty/queue.js','common/util.js','3rdparty/mario.js','common/TraceLogging.js','3rdparty/htmlEmailToText.js','3rdparty/onevalidation/validation.js','common/FormBuilder.js','common/FormSubmitter.js','3rdparty/Failboat.js','3rdparty/BeforeUnload.js','3rdparty/sha256hex.js','common/migrations/migrateContactsCityToLocality.js','calendar/timezones/**/*.ics!node_modules/systemjs-asset-plugin/asset-plugin.js','3rdparty/jquery.cookie.js'],function($,ko,queue,util,mario,TraceLogging,htmlEmailToText,validation,FormBuilder,FormSubmitter,Failboat,BeforeUnload,sha256hex,migrateContactsCityToLocality,timeZoneAssetUrlGetter){var winInetMapping={12002:503,12007:0,12017:503,12019:0,12029:503,12030:503,12031:503,12152:500,342:502,343:503,444:404};function createError(xhr,url,options){var error=new Error;var response=null;try{response=xhr.response||JSON.parse(xhr.responseText)}catch(e){response={}}var mappedStatus=winInetMapping[xhr.status];Failboat.tag(error,typeof mappedStatus==='number'?mappedStatus:xhr.status);if(response.error){Failboat.tag(error,response.error)}return ko.utils.extend(error,{status:xhr.status,statusText:xhr.statusText,requestMethod:options&&options.type||'GET',requestUrl:url,response:response,responseHeaders:xhr.getAllResponseHeaders&&xhr.getAllResponseHeaders()||null,responseText:xhr.responseText||''})}function createRequest(url,options,callback){var cb=callback;if(typeof options==='function'){cb=options;options={}}if(options.hasOwnProperty('formdata')){options.data=options.formdata;options.processData=false;options.contentType=false;options.formdata=undefined}if(options.hasOwnProperty('fileobject')){options.data=options.fileobject;options.processData=false;options.contentType=false;options.fileobject=undefined}return function(done){options.url=url;options.success=function(data,status,xhr){cb(null,data,status,xhr);done()};options.error=function(xhr,status,error){cb(createError(xhr,url,options),null,status,xhr);done()};$.ajax(options)}}function createUrl(template,context){return template.replace(/\{([^\}]+)\}/g,function(param,key){var queries=[];if(key.charAt(0)==='?'){key.substr(1).split(',').forEach(function(subkey){if(subkey in context){var type=typeof context[subkey];if(type==='string'||type==='number'||type==='boolean'){queries.push(encodeURIComponent(subkey)+'='+encodeURIComponent(context[subkey]))}else if(Array.isArray(context[subkey])){context[subkey].forEach(function(value){queries.push(encodeURIComponent(subkey)+'='+encodeURIComponent(value))})}}});return queries.length===0?'':'?'+queries.join('&')}else{if(context[key]){if(typeof context[key]==='string'){return encodeURIComponent(context[key])}else if(typeof context[key]==='number'){return context[key]}}}})}function stringifyObservables(key,value){return ko.isObservable(value)?value():value}function Backend(){var that=this;if(CONFIG.auth.useOneComAuth){if($.cookie('MailAuth')){that.authMethod='standard'}else{that.authMethod='authv2'}}else{that.authMethod='standard'}if(that.authMethod==='authv2'){that.cookie='ou';that.cookieVersion='1'}else{that.cookie='MailAuth';that.cookieVersion='5'}this.oldAuthRecentlyChangedPassword=this.authMethod==='standard'&&!!$.cookie('nextMailAuth');that.cookieTimeout=60*60*24*1000;that.queue=queue();that.syncQueue=queue(1);that.beforeUnloadConditions=[];that.beforeUnloadHandler=new BeforeUnload(TR('common.OnBeforeUnload','You have unsaved changes. Do you want to leave the page?'),that.beforeUnloadConditions)}Backend.prototype.hasAuthentication=function(){var cookie=$.cookie(this.cookie);return cookie&&cookie.trim()!==''};function redirectTo(url,hashParams){if(hashParams){url+='#'+util.encodePairs(hashParams)}window.location.replace(url)}function redirectToLogin(specifySelfAsSuccessUrl){if(CONFIG.auth.useOneComAuth){redirectTo('/api/auth/2/login'+(specifySelfAsSuccessUrl?'?successUrl='+encodeURIComponent(window.location.href):''))}else{var hashParams={};var windowLocationHostname=window.location.hostname;if(windowLocationHostname==='webmail.one.com'){windowLocationHostname='mail.one.com'}if(specifySelfAsSuccessUrl){var search=window.location.search;if(search){search+='&login=1'}else{search='?login=1'}hashParams.successUrl=window.location.protocol+'//'+windowLocationHostname+(window.location.port?':'+window.location.port:'')+window.location.pathname+search}if(windowLocationHostname!=='mail.one.com'){hashParams.loginUrl=window.location.protocol+'//'+windowLocationHostname+(window.location.port?':'+window.location.port:'')+'/api/auth/1/login'}if(window.location.pathname.length>4){var hashParts=window.location.pathname.substring(1).split('/');if(/^(calendar|contacts|settings)$/.test(hashParts[0])){hashParts.shift()}hashParams.username=hashParts.shift();if(!validation.email.test(hashParams.username)){delete hashParams.username}}var rt=encodeURIComponent('RGV0IGVyIG1pZyBkZXIgc3TDpXIgaGVydWRlIG9nIGJhbmtlciBww6UKb2cgYmVkZXIgZGlnIG9tIGF0IHByw7h2ZSBhdCBmb3JzdMOlCmplZyBreXNzZWRlIGhlbmRlIGt1biBww6UgaGVuZGVzIGtpbmQKc2lnIGF0IGRldCBlciBva2F5IG9nIGx1ayBtaWcgaW5k');var st=encodeURIComponent('TmV2ZXIgZ29ubmEgZ2l2ZSB5b3UgdXAKTmV2ZXIgZ29ubmEgbGV0IHlvdSBkb3duCk5ldmVyIGdvbm5hIHJ1biBhcm91bmQgYW5kIGRlc2VydCB5b3UKTmV2ZXIgZ29ubmEgbWFrZSB5b3UgY3J5Ck5ldmVyIGdvbm5hIHNheSBnb29kYnllCk5ldmVyIGdvbm5hIHRlbGwgYSBsaWUgYW5kIGh1cnQgeW91');redirectTo(CONFIG.auth.loginUrl+'?rt='+rt+'&st='+st,hashParams)}}Backend.prototype.logout=function(userInitialized){var that=this;function performLogoutRedirection(){$.cookie(that.cookie,'',{path:'/',expires:-1});if(CONFIG.auth.useOneComAuth&&that.authMethod==='authv2'){if(userInitialized){redirectTo('/api/auth/2/logout')}else{redirectToLogin()}}else{redirectToLogin(true)}}if(userInitialized){that.beforeUnloadHandler.confirmedIfNecessary(performLogoutRedirection)}else{that.beforeUnloadConditions.length=0;performLogoutRedirection()}};Backend.prototype.redirectIfNotAuthenticated=function(){var that=this;if(!that.hasAuthentication()){redirectToLogin(true);return true}return false};Backend.prototype.refreshLogin=function(){redirectToLogin(true)};Backend.prototype.redirectToUpgradePage=function(){redirectTo('/upgrade',{successUrl:window.location.href})};Backend.prototype.getAuthenticationData=function(){var that=this,data=null,payload=null,cookie=$.cookie(that.cookie);if(that.authMethod==='authv2'){if(cookie&&cookie.trim()!==''){cookie=JSON.parse(decodeURIComponent(cookie));return cookie}return null}else{if(cookie&&cookie.trim()!==''){cookie=cookie.split('|');if(cookie.length===3&&cookie[0]===that.cookieVersion){data=cookie[2].split(':').map(window.atob);payload=data[1].split(';');return{user:data[0],expires:parseInt(payload[0],10)+that.cookieTimeout}}}}};Backend.prototype.listFolders=function(username,callback){var that=this,url=createUrl('/api/{username}/mail/1/',{username:username});that.queue.defer(createRequest(url,callback))};Backend.prototype.getInbox=function(username,callback){var that=this,url=createUrl('/api/{username}/mail/1/?inbox=true',{username:username});that.queue.defer(createRequest(url,callback))};Backend.prototype.createFolder=function(username,folderName,callback){var that=this,url=createUrl('/api/{username}/mail/1/{folderName}/',{username:username,folderName:folderName});that.queue.defer(createRequest(url,{type:'PUT'},callback))};Backend.prototype.deleteFolder=function(username,folderName,folderUidValidity,callback){var that=this,url=createUrl('/api/{username}/mail/1/{folderName}/{folderUidValidity}/',{username:username,folderName:folderName,folderUidValidity:folderUidValidity});that.queue.defer(createRequest(url,{type:'DELETE'},callback))};Backend.prototype.emptyFolder=function(username,folderName,folderUidValidity,callback){var that=this;var urlTemplate='/api/{username}/mail/1/{folderName}/'+(typeof folderUidValidity==='number'?'{folderUidValidity}/':'');var url=createUrl(urlTemplate,{username:username,folderName:folderName,folderUidValidity:folderUidValidity});that.queue.defer(createRequest(url,{type:'POST',data:JSON.stringify({action:'empty'}),contentType:'application/json'},callback))};Backend.prototype.moveMails=function(username,folderName,folderUidValidity,destFolderName,uids,callback){var that=this,url=createUrl('/api/{username}/mail/1/{folderName}/{folderUidValidity}/',{username:username,folderName:folderName,folderUidValidity:folderUidValidity});that.queue.defer(createRequest(url,{type:'POST',data:JSON.stringify({action:'move',dest:destFolderName,uids:uids}),contentType:'application/json'},callback))};Backend.prototype.getMailPart=function(username,folderName,folderUidValidity,uid,part,headers,allowExternalImages,callback){var that=this,url=createUrl('/api/{username}/mail/1/{folderName}/{folderUidValidity}/{uid}/{part}{?headers,allowexternalimages}',{username:username,folderName:folderName,folderUidValidity:folderUidValidity,uid:uid,part:part,headers:headers,allowexternalimages:allowExternalImages});that.queue.defer(createRequest(url,callback))};Backend.prototype.renameFolder=function(username,folderName,folderUidValidity,destFolderName,callback){var that=this,url=createUrl('/api/{username}/mail/1/{folderName}/{folderUidValidity}/',{username:username,folderName:folderName,folderUidValidity:folderUidValidity});that.queue.defer(createRequest(url,{type:'POST',data:JSON.stringify({action:'rename',dest:destFolderName}),contentType:'application/json'},callback))};Backend.prototype.deleteMails=function(username,folderName,folderUidValidity,uids,callback){var that=this,url=createUrl('/api/{username}/mail/1/{folderName}/{folderUidValidity}/',{username:username,folderName:folderName,folderUidValidity:folderUidValidity});that.queue.defer(createRequest(url,{type:'POST',data:JSON.stringify({action:'del',uids:uids}),contentType:'application/json'},callback))};Backend.prototype.removeFlags=function(username,folderName,folderUidValidity,uids,flags,callback){var that=this,url=createUrl('/api/{username}/mail/1/{folderName}/{folderUidValidity}/flags',{username:username,folderName:folderName,folderUidValidity:folderUidValidity});that.syncQueue.defer(createRequest(url,{type:'DELETE',data:JSON.stringify({uids:uids,flags:flags}),contentType:'application/json'},callback))};Backend.prototype.addFlags=function(username,folderName,folderUidValidity,uids,flags,callback){var that=this,url=createUrl('/api/{username}/mail/1/{folderName}/{folderUidValidity}/flags',{username:username,folderName:folderName,folderUidValidity:folderUidValidity});that.syncQueue.defer(createRequest(url,{type:'PUT',data:JSON.stringify({uids:uids,flags:flags}),contentType:'application/json'},callback))};Backend.prototype.queryFolder=function(username,folderName,folderUidValidity,sortExpression,filters,searchWord,first,last,headers,callback){var that=this;var sortKeys=sortExpression&&sortExpression.map(function(e){return Object.keys(e)[0]})||[],sortDirs=sortExpression&&sortExpression.map(function(e){return e[Object.keys(e)[0]]})||[],url=createUrl('/api/{username}/mail/1/{folderName}/{folderUidValidity}/{?sort,dir,filter,search,first,last,headers}',{username:username,folderName:folderName,folderUidValidity:folderUidValidity,first:first,last:last,'sort':sortKeys,dir:sortDirs,filter:filters,search:searchWord,headers:headers});that.queue.defer(createRequest(url,callback))};Backend.prototype.resyncFolder=function(username,folderName,folderUidValidity,resync,headers,callback){var url=createUrl('/api/{username}/mail/1/{folderName}/{folderUidValidity}/{?headers,resync}',{username:username,folderName:folderName,folderUidValidity:folderUidValidity,resync:resync,headers:headers});this.queue.defer(createRequest(url,callback))};Backend.prototype.getContactsAndGroups=function(username,callback){var that=this,url=createUrl('/api/{username}/contacts/2/',{username:username});that.queue.defer(createRequest(url,function(err,data){if(!err){migrateContactsCityToLocality(data)}callback(err,data)}))};Backend.prototype.getContactStubsAndGroups=function(username,callback){var that=this,url=createUrl('/api/{username}/contacts/2/?stubs=true',{username:username});that.queue.defer(createRequest(url,function(err,data){if(!err){migrateContactsCityToLocality(data)}callback(err,data)}))};Backend.prototype.getContactOrGroup=function(username,identifier,callback){var that=this,url=createUrl('/api/{username}/contacts/2/{identifier}',{username:username,identifier:identifier});that.queue.defer(createRequest(url,callback))};Backend.prototype.saveContactsOrGroups=function(username,contacts,callback){var that=this;var data={};if(!Array.isArray(contacts)){return}contacts.forEach(function(contact){contact.id=contact.id||util.uuid();data[contact.id]=contact});var url=createUrl('/api/{username}/contacts/2/',{username:username});that.queue.defer(createRequest(url,{type:'POST',data:JSON.stringify(data),contentType:'application/json'},function(err,responseObj){if(err){return callback(err)}callback(null,responseObj)}))};Backend.prototype.saveContactOrGroup=function(username,contact,callback){var that=this;contact.id=contact.id||util.uuid();var url=createUrl('/api/{username}/contacts/2/{identifier}',{username:username,identifier:contact.id});that.queue.defer(createRequest(url,{type:'PUT',data:JSON.stringify(contact),contentType:'application/json'},function(err,responseObj){if(err){return callback(err)}callback(null,responseObj._rev,responseObj.id)}))};Backend.prototype.deleteContactOrGroup=function(username,identifier,callback){var that=this,url=createUrl('/api/{username}/contacts/2/{identifier}',{username:username,identifier:identifier});that.queue.defer(createRequest(url,{type:'DELETE'},callback))};Backend.prototype.deleteContactsOrGroups=function(username,contacts,callback){var that=this;var data=contacts.map(function(contact){return{id:ko.utils.unwrapObservable(contact.id),_rev:ko.utils.unwrapObservable(contact._rev)}});var url=createUrl('/api/{username}/contacts/2/',{username:username});that.queue.defer(createRequest(url,{type:'DELETE',data:JSON.stringify(data),contentType:'application/json'},function(err,responseObj){if(err){return callback(err)}callback(null,responseObj)}))};Backend.prototype.importContactFile=function(username,file,callback){var url=createUrl('/api/{username}/contacts/2/?format=csv',{username:username});this.queue.defer(createRequest(url,{type:'POST',fileobject:file},function(err,result){if(err){return callback(err)}callback(null,result)}))};Backend.prototype.importContactData=function(username,importData,callback){var url=createUrl('/api/{username}/contacts/2/?format=csv',{username:username});this.queue.defer(createRequest(url,{type:'POST',data:JSON.stringify(importData),contentType:'application/json'},callback))};Backend.prototype.countAutocompletions=function(username,callback){var url=createUrl('/api/{username}/autocomplete/1/count',{username:username});this.queue.defer(createRequest(url,callback))};Backend.prototype.saveAutocompletions=function(username,recipients,callback){var url=createUrl('/api/{username}/autocomplete/1/',{username:username});this.queue.defer(createRequest(url,{type:'POST',data:JSON.stringify({recipients:recipients}),contentType:'application/json'},callback))};Backend.prototype.queryAutocompletions=function(username,searchQuery,callback){var url=createUrl('/api/{username}/autocomplete/1/0/8/?query={query}',{username:username,query:searchQuery});this.queue.defer(createRequest(url,callback))};Backend.prototype.fetchAutocompletions=function(username,page,query,order,callback){var pageStart=page*CONFIG.webmail.autocompleter.pageSize;var pageEnd=pageStart+CONFIG.webmail.autocompleter.pageSize;var params={username:username,pageStart:pageStart+'',pageEnd:pageEnd+'',order:order};var urlTemplate='/api/{username}/autocomplete/1/{pageStart}/{pageEnd}/?order={order}';if(query){params.query=query.toLowerCase();urlTemplate+='&query={query}'}var url=createUrl(urlTemplate,params);this.queue.defer(createRequest(url,callback))};Backend.prototype.deleteAutocompletions=function(username,emails,callback){var url=createUrl('/api/{username}/autocomplete/1/',{username:username});this.queue.defer(createRequest(url,{type:'DELETE',data:JSON.stringify({emails:emails}),contentType:'application/json'},callback))};Backend.prototype.setAddOnProductCoolOffCookie=function(username){var addonCookie=this.hasAddOnProductCoolOffCookie();if(!addonCookie){$.cookie('addonProductBlocker/'+username,true,{path:'/',expires:2})}};Backend.prototype.hasAddOnProductCoolOffCookie=function(username){return!!$.cookie('addonProductBlocker/'+username)};Backend.prototype.savePreference=function(username,namespace,preference,callback){var that=this,tmpl=namespace?'/api/{username}/preferences/1/{namespace}':'/api/{username}/preferences/1/',context={username:username};if(namespace){context.namespace=namespace}var url=createUrl(tmpl,context);that.queue.defer(createRequest(url,{type:'PUT',data:JSON.stringify(preference,stringifyObservables),contentType:'application/json'},callback))};Backend.prototype.saveFilterData=function(username,filterData,rollbackData,callback){var that=this,url=createUrl('/api/{username}/filters/3/',{username:username});that.syncQueue.defer(createRequest(url,{type:'PUT',data:JSON.stringify({filterData:filterData,rollbackData:rollbackData}),contentType:'application/json'},callback))};Backend.prototype.getFilterData=function(username,callback){var that=this,url=createUrl('/api/{username}/filters/1/',{username:username});that.syncQueue.defer(createRequest(url,function(err,result){if(err){callback(err)}else{callback(null,result.filterData||{blocked:[],filters:[]})}}))};Backend.prototype.uploadSignatureImage=function(username,preferenceId,imageId,preferenceRev,file,callback){var url;if(preferenceRev){url=createUrl('/api/{username}/preferences/1/{preferenceId}/photo/{imageId}?_rev={rev}',{username:username,preferenceId:preferenceId,rev:preferenceRev,imageId:imageId})}else{url=createUrl('/api/{username}/preferences/1/{preferenceId}/photo/{imageId}',{username:username,preferenceId:preferenceId,imageId:imageId})}this.queue.defer(createRequest(url,{data:file,contentType:file.type,processData:false,type:'PUT'},callback))};Backend.prototype.copyImageFromMailToSignature=function(username,folder,uidvalidity,uid,partId,photoId,preferenceId,preferenceRev,callback){var url=createUrl('/api/{username}/mail/1/{folderName}/{uidvalidity}/',{username:username,folderName:folder,uidvalidity:uidvalidity});this.syncQueue.defer(createRequest(url,{type:'POST',data:JSON.stringify({action:'copyMailPartToPreferences',uid:uid,part:partId,preferenceId:preferenceId,photoId:photoId,'_rev':preferenceRev}),contentType:'application/json'},callback))};var defaultPreferences={global:{id:'global',locale:'en_US',country:'GB',displayName:null,timeZone:'Europe/London',weekStart:1,weekendStart:6,weekNumbering:'firstFourDayWeek'},mail:{id:'mail',replyTo:null,signature:null,showUIUpdate:0,showIntroScreen:true},trustedSenders:{id:'trustedSenders',sources:[]},calendar:{id:'calendar',defaultView:'week'}};Backend.prototype.getPreferences=function(username,namespaces,callback){var that=this,url=createUrl('/api/{username}/preferences/1/{?id}',{id:namespaces,username:username});that.queue.defer(createRequest(url,function(err,result){if(err){return callback(err)}namespaces.forEach(function(namespace){if(!result[namespace]){result[namespace]={};if(defaultPreferences[namespace]){util.extend(result[namespace],defaultPreferences[namespace])}}});if(result.global){if(typeof result.global.weekStart!=='number'){result.global.weekStart=1}if(typeof result.global.weekendStart!=='number'){result.global.weekStart=6}if(typeof result.global.weekNumbering!=='string'){result.global.weekNumbering='firstFourDayWeek'}}callback(null,result)}))};Backend.prototype.saveMail=function(username,folder,outgoingMail,callback){one.crashLogger.log('Backend.sendMail start');var headers=outgoingMail.headers;var attachments=outgoingMail.attachments;var emailHeader={};['from','to','cc','bcc','replyTo','subject','deleteOtherEmailUponSuccess','draftInfo','flags','date'].forEach(function(field){if(headers[field]&&(field!=='replyTo'||validation.email.test(headers[field].email))){emailHeader[field]=headers[field]}});['inReplyTo','references'].forEach(function(field){if(/^[ -~]+$/.test(headers[field])){emailHeader[field]=headers[field]}});emailHeader.numPrimaryParts=2;emailHeader.hasAttachments=!!attachments.length;var folderUidValidity=folder.uidvalidity();var url='/api/{username}/mail/1/{folderName}';if(typeof folderUidValidity==='number'){url+='/{folderUidValidity}'}url+='{?headers}';var urlParameters={username:username,folderName:folder.id(),folderUidValidity:folderUidValidity,headers:['References','X-OneCom-Draft-Info']};function sendCallback(err,response){one.crashLogger.log('Backend.sendMail: response');if(!err){one.crashLogger.log('Backend.sendMail: success!')}else{err=createError(err,url,{type:'POST'})}callback(err,response)}one.crashLogger.log('Backend.sendMail: request');url=createUrl(url,urlParameters);var formData=new FormData;formData.append('headers',JSON.stringify(emailHeader));if(outgoingMail.text!==undefined){formData.append(encodeURIComponent(JSON.stringify({type:'primary',contentType:'text/plain',id:1})),outgoingMail.text)}else{formData.append(encodeURIComponent(JSON.stringify({type:'primary',contentType:'text/plain',id:1})),htmlEmailToText.htmlEmailToText(outgoingMail.html));formData.append(encodeURIComponent(JSON.stringify({type:'primary',contentType:'text/html',id:2})),outgoingMail.html);if(outgoingMail.newRelated){outgoingMail.newRelated.forEach(function(related){formData.append(related.input.name,related.input.files[0],related.displayName)})}}attachments.forEach(function(attachment,index){if(attachment.justAdded){formData.append(attachment.input.name,attachment.input.files[0],attachment.input.value.replace(/^.*[/\\]/,''))}else{formData.append(encodeURIComponent(JSON.stringify({type:'attachment',id:attachment.id,isExisting:true})),JSON.stringify({folderName:attachment.mail.folder().id(),uid:attachment.mail.uid,part:attachment.part}))}});this.queue.defer(createRequest(url,{formdata:formData,type:'POST'},sendCallback))};Backend.prototype.sendMail=function(username,mail,callback){var that=this;function proceed(){var c=that.c;var s=0;(function solveAndSend(){var count=100;while(--count>0){s+=1;if(/^00/.test(sha256hex(c+String(s)))){var url=createUrl('/api/{username}/mail/1/{folderName}/{uidvalidity}/{uid}?s={s}',{username:username,folderName:mail.folder().id(),uidvalidity:mail.folder().uidvalidity(),uid:mail.uid,s:s});that.queue.defer(createRequest(url,{type:'POST',contentType:'application/json'},callback));return}}setTimeout(solveAndSend,25)}())}if(that.cAt>Date.now()-15*60*1000){proceed()}else{that.getTtl(proceed)}};Backend.prototype.migrateLangCookie=function(){var MailLang=$.cookie('MailLang'),OneLang=$.cookie('OneLang');if(MailLang){$.cookie('MailLang',null);if(!OneLang){var hostname=location.hostname;var cookieDomain='';if(hostname!=='localhost'){cookieDomain='.'+hostname.split('.').splice(-2,2).join('.')}$.cookie('OneLang',MailLang,{expires:365*2,path:'/',domain:cookieDomain});document.location.reload(true);return true}}return false};Backend.prototype.getMailAccountSettings=function(username,callback){var that=this,url=createUrl('/api/{username}/account/1/',{username:username});that.queue.defer(createRequest(url,callback))};Backend.prototype.saveMailAccountSettings=function(username,accountData,callback){var that=this,url=createUrl('/api/{username}/account/1/',{username:username});that.queue.defer(createRequest(url,{type:'POST',data:JSON.stringify(accountData),contentType:'application/json'},callback))};Backend.prototype.getTimeZone=function(username,tzid,callback){this.queue.defer(createRequest(timeZoneAssetUrlGetter(tzid),{},callback))};Backend.prototype.getCalendars=function(username,filter,callback){var that=this,url=createUrl('/api/{username}/calendars/2/own/{?events,start,end}',util.extend(filter,{username:username,events:true}));that.queue.defer(createRequest(url,callback))};Backend.prototype.getCalendar=function(username,calendarId,options,callback){var that=this,url=createUrl('/api/{username}/calendars/2/own/{calendarId}/{?events}',util.extend({username:username,events:false,calendarId:calendarId},options));that.queue.defer(createRequest(url,callback))};Backend.prototype.saveCalendarResource=function(username,calendarId,resource,data,callback){var that=this,url=createUrl('/api/{username}/calendars/1/own/{calendarId}/components/{resourceId}',{username:username,calendarId:calendarId,resourceId:resource.id});var headers={};if(resource.etag){headers['If-Match']=resource.etag}that.queue.defer(createRequest(url,{type:'PUT',data:data,contentType:'text/calendar',headers:headers},function(err,data,status,xhr){callback(err,{headers:{'etag':!err&&xhr.getResponseHeader('ETag')}})}))};Backend.prototype.deleteCalendarResource=function(username,calendarId,resource,callback){var that=this,url=createUrl('/api/{username}/calendars/1/own/{calendarId}/components/{resourceId}',{username:username,calendarId:calendarId,resourceId:resource.id});that.queue.defer(createRequest(url,{type:'DELETE'},function(err,data,status,xhr){callback(err)}))};Backend.prototype.saveCalendar=function(username,calendarId,data,callback){var that=this;var url=createUrl('/api/{username}/calendars/1/own/{calendarId}',{username:username,calendarId:calendarId});that.queue.defer(createRequest(url,{type:'POST',data:JSON.stringify(data),contentType:'application/json'},function(err,data,status,xhr){callback(err)}))};Backend.prototype.createCalendar=function(username,calendarId,data,callback){var that=this;var url=createUrl('/api/{username}/calendars/1/own/{calendarId}',{username:username,calendarId:calendarId});that.queue.defer(createRequest(url,{type:'PUT',data:JSON.stringify(data),contentType:'application/json'},function(err,data,status,xhr){callback(err)}))};Backend.prototype.deleteCalendar=function(username,calendarId,callback){var that=this,url=createUrl('/api/{username}/calendars/1/own/{calendarId}',{username:username,calendarId:calendarId});that.queue.defer(createRequest(url,{type:'DELETE'},function(err,data,status,xhr){callback(err)}))};Backend.prototype.importCalendarFile=function(username,calendarId,file,callback){var url=createUrl('/api/{username}/calendars/1/own/{calendarId}/ics/',{username:username,calendarId:calendarId});var formData=new FormData;formData.append('icalfile',file);this.queue.defer(createRequest(url,{type:'POST',fileobject:formData,contentType:false},function(err,result){if(err){return callback(err)}callback(null,result)}))};Backend.prototype.getTtl=function(callback){var that=this;var url=createUrl('/api/session/1');that.queue.defer(createRequest(url,{type:'GET'},function(err,data,status,xhr){if(data){that.c=data.c;that.cAt=Date.now()}callback(err,data&&data.ttl)}))};Backend.prototype.exportCalendar=function(username,calendarId,filename,callback){var that=this;var url=createUrl('/api/{username}/calendars/1/own/{calendarId}/ics/{filename}',{username:username,calendarId:calendarId,filename:filename});that.queue.defer(createRequest(url,{type:'GET'},function(err,data,status,xhr){callback(err,data);location.href=url}))};Backend.prototype.getExternalCalendar=function(urlOrToken,callback){var that=this,url=createUrl('/api/externalCalendars/2/{urlOrToken}',{urlOrToken:urlOrToken});that.queue.defer(createRequest(url,callback))};Backend.prototype.getCalendarSharedLinks=function(username,calendarId,callback){var that=this;var url=createUrl('/api/{username}/calendars/1/publications/{calendarId}',{username:username,calendarId:calendarId});that.queue.defer(createRequest(url,{type:'GET'},function(err,data,status,xhr){callback(err,data)}))};Backend.prototype.createCalendarSharedLink=function(username,calendarId,callback){var that=this;var url=createUrl('/api/{username}/calendars/1/publications/{calendarId}',{username:username,calendarId:calendarId});var data={method:'create',params:{calendarId:calendarId,permanent:false,active:true}};that.queue.defer(createRequest(url,{type:'POST',data:JSON.stringify(data),contentType:'application/json'},function(err,data,status,xhr){callback(err,data)}))};Backend.prototype.updateCalendarSharedLink=function(username,calendarId,linkId,data,callback){var that=this;var url=createUrl('/api/{username}/calendars/1/publications/{calendarId}/{linkId}',{username:username,calendarId:calendarId,linkId:linkId});var postData={method:'update',params:{id:linkId,calendarId:calendarId,permanent:false,active:data&&(data.hasOwnProperty('active')?data.active:true),comment:data&&data.comment}};that.queue.defer(createRequest(url,{type:'PUT',data:JSON.stringify(postData),contentType:'application/json'},function(err,data,status,xhr){callback(err,data)}))};Backend.prototype.deleteCalendarSharedLink=function(username,calendarId,linkId,callback){var that=this;var url=createUrl('/api/{username}/calendars/1/publications/{calendarId}/{linkId}',{username:username,calendarId:calendarId,linkId:linkId});var data={method:'destroy',params:{id:linkId}};that.queue.defer(createRequest(url,{type:'DELETE',data:JSON.stringify(data),contentType:'application/json'},function(err,data,status,xhr){callback(err,data)}))};Backend.prototype.addTrustedSender=function(username,sender,callback){var that=this,url=createUrl('/api/{username}/trusted_senders/1/',{username:username});that.queue.defer(createRequest(url,{type:'POST',data:JSON.stringify(sender),contentType:'application/json'},callback))};Backend.prototype.queryAddOnProduct=function(username,productName,callback){var that=this,url=createUrl('/api/{username}/addOnProducts/1/{productName}',{username:username,productName:productName});that.queue.defer(createRequest(url,callback))};Backend.prototype.activateAddOnProduct=function(username,productName,callback){var that=this,url=createUrl('/api/{username}/addOnProducts/1/{productName}/activate',{username:username,productName:productName});that.queue.defer(createRequest(url,{type:'POST'},callback))};Backend.prototype.deactivateAddOnProduct=function(username,productName,callback){var that=this,url=createUrl('/api/{username}/addOnProducts/1/{productName}/deactivate',{username:username,productName:productName});that.queue.defer(createRequest(url,{type:'POST'},callback))};TraceLogging.injectTracing(Backend);return Backend})}());(function(){var define=System.amdDefine;define('webmail/PageNavigator.js',['common/util.js','3rdparty/page.js','3rdparty/url-template.js'],function(util,page,urlTemplate){function PageNavigator(options){this.user=options.user;if(options.page){this.page=options.page}this.showAfterLoad=null}PageNavigator.prototype.page=page;var queryParams=['search','filter','sortKey','sortDirection','compose','restore','folder','moving','standalone','part'];var url=urlTemplate.parse('/{user}/{mailFolder}/{page}/{uid}{?'+queryParams.join(',')+'}');function makeUrl(user,folder,page,uid,options){var addressInfo={user:user,mailFolder:folder,page:page,uid:uid};return url.expand(util.extend(addressInfo,options)).replace(/%40/g,'@')}PageNavigator.prototype.show=function(folder,page,uid,options,showAfterLoad){var targetUrl=makeUrl(this.user(),folder,page,uid,options);this.showAfterLoad=showAfterLoad;this.page.show(targetUrl);this.showAfterLoad=null};PageNavigator.prototype.redirect=function(folder,page,uid,options){var targetUrl=makeUrl(this.user(),folder,page,uid,options);this.page.redirect(targetUrl)};PageNavigator.prototype.removeLoginFlag=function(){var cleanUrl=this.page.current.replace(/login(?:=1)?&?/,'').replace(/[\?&]$/,'');this.page.redirect(cleanUrl)};return PageNavigator})}());(function(){var define=System.amdDefine;define('common/model/Inbox.js',['node_modules/knockout/build/output/knockout-latest.debug.js','common/model/Folder.js'],function(ko,Folder){function Inbox(){var that=this;Folder.call(that,{id:'INBOX'});that.iconClass='icon-inbox';that.supportDelete=ko.computed(function(){return false});that.collapsable=function(){return false}}Inbox.prototype=Object.create(Folder.prototype);Inbox.prototype.isInbox=function(){return true};Inbox.prototype.isDraftFolder=function(){return false};Inbox.prototype.isSentFolder=function(){return false};Inbox.prototype.isTrashFolder=function(){return false};Inbox.prototype.isSpamFolder=function(){return false};Inbox.prototype.supportCreateSubfolder=function(){return false};Inbox.prototype.isOutgoingFolder=function(){return false};Inbox.prototype.isSystemFolder=function(){return true};Inbox.prototype.isCustomFolder=function(){return false};return Inbox})}());(function(){var define=System.amdDefine;define('common/model/DraftFolder.js',['node_modules/knockout/build/output/knockout-latest.debug.js','common/model/Folder.js'],function(ko,Folder){function DraftFolder(inbox){var that=this;Folder.call(that,{id:'INBOX.Drafts'},inbox);that.iconClass='icon-inbox-drafts';that.supportDelete=ko.computed(function(){return false})}DraftFolder.prototype=Object.create(Folder.prototype);DraftFolder.prototype.isInbox=function(){return false};DraftFolder.prototype.isDraftFolder=function(){return true};DraftFolder.prototype.isSentFolder=function(){return false};DraftFolder.prototype.isTrashFolder=function(){return false};DraftFolder.prototype.isSpamFolder=function(){return false};DraftFolder.prototype.isSystemFolder=function(){return true};DraftFolder.prototype.isOutgoingFolder=function(){return true};DraftFolder.prototype.isCustomFolder=function(){return false};return DraftFolder})}());(function(){var define=System.amdDefine;define('common/model/SentFolder.js',['node_modules/knockout/build/output/knockout-latest.debug.js','common/model/Folder.js'],function(ko,Folder){function SentFolder(inbox){var that=this;Folder.call(that,{id:'INBOX.Sent'},inbox);that.iconClass='icon-inbox-sent';that.supportDelete=ko.computed(function(){return false});that.unsentCount=ko.observable(0);that.indicator=ko.pureComputed(function(){return that.unsentCount()?inter.trQuantity(TR('mail.NumUnsent',{one:'1 unsent',other:'{0} unsent'}),that.unsentCount()):''})}SentFolder.prototype=Object.create(Folder.prototype);SentFolder.prototype.isInbox=function(){return false};SentFolder.prototype.isDraftFolder=function(){return false};SentFolder.prototype.isSentFolder=function(){return true};SentFolder.prototype.isTrashFolder=function(){return false};SentFolder.prototype.isSpamFolder=function(){return false};SentFolder.prototype.isOutgoingFolder=function(){return true};SentFolder.prototype.isSystemFolder=function(){return true};SentFolder.prototype.isCustomFolder=function(){return false};SentFolder.prototype.supportResending=function(){return true};return SentFolder})}());(function(){var define=System.amdDefine;define('common/model/TrashFolder.js',['node_modules/knockout/build/output/knockout-latest.debug.js','common/model/Folder.js'],function(ko,Folder){function TrashFolder(inbox){var that=this;Folder.call(that,{id:'INBOX.Trash'},inbox);that.iconClass='icon-inbox-trash';that.supportDelete=ko.computed(function(){return false})}TrashFolder.prototype=Object.create(Folder.prototype);TrashFolder.prototype.supportEmptyFolder=ko.computed(function(){return true});TrashFolder.prototype.isInbox=function(){return false};TrashFolder.prototype.isDraftFolder=function(){return false};TrashFolder.prototype.isSentFolder=function(){return false};TrashFolder.prototype.isTrashFolder=function(){return true};TrashFolder.prototype.isSpamFolder=function(){return false};TrashFolder.prototype.isSystemFolder=function(){return true};TrashFolder.prototype.isOutgoingFolder=function(){return false};TrashFolder.prototype.isCustomFolder=function(){return false};return TrashFolder})}());(function(){var define=System.amdDefine;define('common/model/FolderList.js',['node_modules/knockout/build/output/knockout-latest.debug.js','3rdparty/signals.js','common/model/Folder.js','common/model/Inbox.js','common/model/DraftFolder.js','common/model/SentFolder.js','common/model/TrashFolder.js','common/model/SpamFolder.js','common/localeStringComparator.js'],function(ko,signals,Folder,Inbox,DraftFolder,SentFolder,TrashFolder,SpamFolder,localeStringComparator){var Signal=signals.Signal;var compare=localeStringComparator;function forEachFolder(folders,callback){folders.sort(function(a,b){return compare(a.translatedName().toLowerCase(),b.translatedName().toLowerCase())});folders.forEach(function(folder){callback(folder);forEachFolder(folder.children(),callback)})}function FolderList(){var that=this;that.defaults=['INBOX','INBOX.Drafts','INBOX.Sent','INBOX.Trash','INBOX.Spam'];that.inbox=new Inbox;that.drafts=new DraftFolder(that.inbox);that.sent=new SentFolder(that.inbox);that.trash=new TrashFolder(that.inbox);that.spam=new SpamFolder(that.inbox);that.inbox.children([that.drafts,that.sent,that.trash,that.spam]);that.loading=ko.observable(true);that.dirty=false;that.system=ko.pureComputed(function(){var systemRoots=that.inbox.children().filter(function(folder){return folder.isSystemFolder()});var items=[that.inbox];systemRoots.forEach(function(folder){items.push(folder);forEachFolder(folder.children(),function(child){items.push(child)})});return items});that.other=ko.pureComputed(function(){var items=[],otherGroup=that.inbox.children().filter(function(folder){return!folder.isSystemFolder()});forEachFolder(otherGroup,function(folder){items.push(folder)});return items});that.list=ko.pureComputed(function(){return that.system().concat(that.other())});that.signals={folderMoved:new Signal,folderDeleted:new Signal,folderEmptied:new Signal}}FolderList.prototype.moveFolder=function(folder,destination){if(folder.parent()===destination){return}var isSelected=folder.selected();var inbox=this.inbox;if(!destination){destination=inbox}folder.remove();var destinationId=(destination||inbox).id();var newId=destinationId+'.'+folder.name();folder.changeIdRecursively(newId);folder.parent(destination);destination.children.push(folder);this.signals.folderMoved.dispatch(folder,isSelected)};FolderList.prototype.emptyFolder=function(folder){folder.dirty=true;folder.children([]);folder.messages(0);folder.unseen(0);this.signals.folderEmptied.dispatch(folder)};FolderList.prototype.deleteFolder=function(folder){var isSelected=folder.selected();var parent=folder.parent();folder.remove();folder.parent(null);this.signals.folderDeleted.dispatch(folder,isSelected,parent)};FolderList.prototype.getById=function(folderId){var foundFolder;this.list().some(function(folder){if(folder.id()===folderId){foundFolder=folder;return true}else{return false}});return foundFolder||this.inbox};return FolderList})}());(function(){var define=System.amdDefine;define('calendar/model/Calendars.js',['node_modules/knockout/build/output/knockout-latest.debug.js','common/util.js','calendar/Sort.js'],function(ko,util,Sort){function Calendars(){var that=this;that.byId=ko.observable({});that.version=ko.computed(function(){return Object.keys(that.byId()).map(function(key){return that.get(key).version()}).join(',')}).extend({pause:false});that.busy=ko.observable(false)}Calendars.prototype.hasCalendar=function(id){return id in this.byId.peek()};Calendars.prototype.add=function(calendar){var byId=this.byId.peek();byId[calendar.id]=calendar;this.byId(byId)};Calendars.prototype.get=function(id){return this.byId.peek()[id]};Calendars.prototype.remove=function(calendar){var byId=this.byId.peek();delete byId[calendar.id];this.byId(byId)};Calendars.prototype.all=function(){var that=this;return Object.keys(that.byId.peek()).map(function(key){return that.get(key)})};Calendars.prototype.hasEventInstances=function(startDate,endDate){return this.all().filter(function(calendar){return calendar.enabled()}).some(function(calendar){return calendar.hasEventInstances(startDate,endDate)})};Calendars.prototype.getEventInstances=function(startDate,endDate){var that=this;var result=[];that.all().filter(function(calendar){return calendar.enabled()}).forEach(function(calendar){calendar.getEventInstances(startDate,endDate).forEach(function(eventInstance){result.push(eventInstance)})});return result};Calendars.prototype.getDefault=function(){var defaultCalendar;this.all().some(function(calendar){var isDefault=calendar.defaultCalendar();if(isDefault){defaultCalendar=calendar}return isDefault});return defaultCalendar};Calendars.prototype.getFirstVisible=function(){var sortedCalendars=Sort.calendars.byDefaultThenByName(this.all().filter(function(calendar){return calendar.writable&&calendar.enabled()}));return sortedCalendars[0]};return Calendars})}());(function(){var define=System.amdDefine;(function(factory){if(typeof exports==='object'){module.exports=factory(require('knockout'))}else if(typeof define==='function'&&define.amd){define('3rdparty/knockout.observableSortedArray.js',['node_modules/knockout/build/output/knockout-latest.debug.js'],factory)}else{factory(ko)}}(function(ko){var defaultComparefn=function(x,y){var xString=String(x);var yString=String(y);if(xString<yString){return-1}if(xString>yString){return 1}return 0};function isFunction(functionToCheck){return functionToCheck&&{}.toString.call(functionToCheck)==='[object Function]'}ko.observableSortedArray=function(initialValues,comparefn){if(isFunction(initialValues)&&!comparefn){comparefn=initialValues;initialValues=[]}comparefn=comparefn||defaultComparefn;initialValues=initialValues||[];initialValues.sort(comparefn);var result=ko.observableArray(initialValues);result.comparefn=comparefn;['indexOf','push','splice','sort'].forEach(function(method){delete result[method]});ko.utils.extend(result,ko.observableSortedArray.fn);return result};var insertItem=function(newItem){var items=this(),left=-1,right=items.length,mid;while(right-left>1){mid=left+right>>>1;if(this.comparefn(items[mid],newItem)<0){left=mid}else{right=mid}}Array.prototype.splice.call(items,right,0,newItem)};var findItem=function(item){var items=this(),left=-1,right=items.length,mid;while(right-left>1){mid=left+right>>>1;var c=this.comparefn(items[mid],item);if(c<0){left=mid}else{right=mid;if(!c){break}}}return right===items.length||this.comparefn(items[right],item)?-right-1:right};ko.observableSortedArray.fn={add:function(){var that=this;var args=Array.prototype.slice.call(arguments);that.valueWillMutate();args.forEach(function(arg){insertItem.call(that,arg)});that.valueHasMutated()},addAll:function(items){var that=this;that.valueWillMutate();items.forEach(function(item){insertItem.call(that,item)});that.valueHasMutated()},replaceAll:function(items){items.sort(this.comparefn);this(items)},sort:function(){this.valueWillMutate();this().sort(this.comparefn);this.valueHasMutated()},updatePosition:function(item){var index=this.peek().indexOf(item);if(index!==-1){this.valueWillMutate();this.peek().splice(index,1);insertItem.call(this,item);this.valueHasMutated()}},indexOf:function(item){var items=this.peek();var index=findItem.call(this,item);if(index<0||items.length<=index||this.comparefn(items[index],item)!==0){return-1}else{var startIndex=index;while(index-1>=0&&this.comparefn(items[index-1],item)===0){index-=1}while(index<=startIndex){if(items[index]===item){return index}index+=1}while(index<items.length){if(this.comparefn(items[index],item)!==0){return-1}if(items[index]===item){return index}index+=1}return-1}},remove:function(item){var index=this.indexOf(item);if(index!==-1){this.valueWillMutate();this.peek().splice(index,1);this.valueHasMutated()}},removeAll:function(arrayOfValues){if(arrayOfValues===undefined){var underlyingArray=this.peek();var allValues=underlyingArray.slice(0);this.valueWillMutate();underlyingArray.splice(0,underlyingArray.length);this.valueHasMutated();return allValues}if(!arrayOfValues)return[];var index;this.valueWillMutate();for(var i=0;i<arrayOfValues.length;i+=1){index=this.indexOf(arrayOfValues[i]);if(index!==-1){this.peek().splice(index,1)}}this.valueHasMutated()}};return ko.observableSortedArray}))}());(function(){var define=System.amdDefine;define('webmail/model/State.js',['node_modules/knockout/build/output/knockout-latest.debug.js','common/model/FolderList.js','common/util.js','common/Cache.js','common/model/Flag.js','3rdparty/onevalidation/validation.js','3rdparty/signals.js','3rdparty/purify.js','calendar/ical/Time.js','calendar/model/Calendars.js','3rdparty/insection.js','3rdparty/knockout.observableSortedArray.js'],function(ko,FolderList,util,Cache,Flag,validation,signals,purify,Time,Calendars,insection){var Signal=signals.Signal;function State(){var that=this;that.user=ko.observable(undefined);that.displayUser=ko.computed(function(){return purify.emailIdn(that.user())});that.preferences={busy:ko.observable(false),global:ko.observable(null),mail:ko.observable(null),trustedSenders:ko.observable(null),plainTextMode:ko.observable(false),calendar:ko.observable(null)};that.filterData={filters:ko.observableArray(),blocked:ko.observableArray(),original:ko.observable(null),revision:ko.observable(),busy:ko.observable(false)};that.timeZone=ko.observable(null);that.calendars=new Calendars;that.cacheIndex=insection();that.nowVersion=ko.observable(1);that.now=ko.pureComputed(function(){that.nowVersion();var now=new Date;var time=Time.fromJSDate(now,true);if(that.timeZone()){time=time.convertToZone(that.timeZone())}return time});that.filterData.current=ko.computed(function(){return{_rev:that.filterData.revision(),filters:that.filterData.filters().map(function(filter){return filter.toJS()}),blocked:util.unique(that.filterData.blocked().map(function(pattern){return pattern.toJS()})).filter(function(email){return validation.email.test(email)})}});that.folders=new FolderList;that.contacts={all:ko.observableArray(),groups:ko.observableArray(),busy:ko.observable(false),loaded:ko.observable(false)};that.contacts.byEmail=ko.computed(function(){var contactsWithEmail=that.contacts.all().filter(function(recipient){return recipient.email});return util.indexBy(contactsWithEmail,function(recipient){return recipient.email.toLowerCase()})}).extend({throttle:100});that.notification=ko.observable(null);that.signals={preferencesLoaded:new Signal,queueMailForSending:new Signal,queueMailForSendingFailed:new Signal,mailSent:new Signal,sendingMail:new Signal,sendingMailFailed:new Signal,mailsLoaded:new Signal,mailDiscarded:new Signal,mailSaved:new Signal,savingMailFailed:new Signal,movingMails:new Signal,removingMails:new Signal,mailDisappeared:new Signal,composerOpened:new Signal,composerClosing:new Signal,contentPanelReplaced:new Signal,closeErrorMessage:new Signal,addNewContact:new Signal};that.myEmails=ko.computed(function(){var emails=[];if(that.user()){emails.push(that.user().toLowerCase())}var mailPreferences=that.preferences.mail();if(mailPreferences&&mailPreferences.replyTo){emails.push(mailPreferences.replyTo.toLowerCase())}return emails});that.containsMe=function(recipients){var myEmails=that.myEmails();return recipients.some(function(recipient){return myEmails.some(function(email){return recipient.email&&recipient.email.toLowerCase()===email.toLowerCase()})})}}return State})}());(function(){var define=System.amdDefine;(function(root,factory){if(typeof exports==='object'){module.exports=factory(require('./ActionNotReadyError'))}else if(typeof define==='function'&&define.amd){define('3rdparty/action-executor/ActionExecutor.js',['3rdparty/action-executor/ActionNotReadyError.js'],factory)}else{root.com=root.com||{};root.com.one=root.com.one||{};root.com.one.ActionExecutor=factory(root.com.one.ActionNotReadyError)}}(this,function(ActionNotReadyError){function ActionExecutor(options){var that=this;that.onEmptyQueue=options.onEmptyQueue;that.onStatusChange=options.onStatusChange;that.shouldRetryOnError=options.shouldRetryOnError;that.interceptor=options.interceptor;that.context=options.context;that.queue=[]}ActionExecutor.prototype.setTaskStatus=function(task,status){task.status=status;if(this.onStatusChange){this.onStatusChange.apply(this,arguments)}};ActionExecutor.prototype.executeQueuedActions=function(){var that=this;this.queue=this.queue.filter(function(task){return task.status!=='done'&&task.status!=='failed'});if(this.queue.length===0&&this.onEmptyQueue){this.onEmptyQueue()}this.queue.filter(function(task){return task.status==='not ready'||task.status==='retrying'}).forEach(function(task){that.execute(task)})};ActionExecutor.prototype.shouldRetry=function(task,err){return err&&typeof task.retries==='number'&&task.retries>0&&this.shouldRetryOnError&&this.shouldRetryOnError(err)};ActionExecutor.prototype.intercept=function(task,args,cb){if(this.interceptor){this.interceptor.call(null,task.action,args,cb)}else{cb()}};ActionExecutor.prototype.callTaskCallback=function(task,args,cb){this.intercept(task,args,function(){if(task.callback){task.callback.apply(null,args)}cb()})};function fib(n){var i;var fibTable=[];fibTable[0]=0;fibTable[1]=1;for(i=2;i<=n;i+=1){fibTable[i]=fibTable[i-2]+fibTable[i-1]}return fibTable[n]}ActionExecutor.prototype.queueForRetryTask=function(task,err){var that=this;var retriesLeft=task.action.retries-task.retries;var timeout=fib(retriesLeft+14);this.setTaskStatus(task,'queued for retrying',err);task.retries-=1;setTimeout(function(){that.setTaskStatus(task,'retrying');that.executeQueuedActions()},timeout)};ActionExecutor.prototype.execute=function(task){var that=this;this.setTaskStatus(task,'running');task.action.execute(this.context,function(err){var args=Array.prototype.slice.call(arguments);if(err instanceof ActionNotReadyError){that.setTaskStatus(task,'not ready')}else if(that.shouldRetry(task,err)){that.intercept(task,args,function(){that.queueForRetryTask(task,err);that.executeQueuedActions()})}else{that.callTaskCallback(task,args,function(){if(err){that.setTaskStatus(task,'failed',err)}else{that.setTaskStatus(task,'done')}that.executeQueuedActions()})}})};ActionExecutor.prototype.validateAction=function(action){if(action===null||typeof action!=='object'){throw new Error('Expect actions to be objects. '+action)}var name=action.name;if(typeof name!=='string'||name.length===0){throw new Error('Expect actions to have an unique name. '+action)}if(typeof action.execute!=='function'){throw new Error('Expect actions to have an execute method. '+action.name)}};ActionExecutor.prototype.enqueue=function(action,cb){this.validateAction(action);var task={action:action,callback:cb,retries:action.retries};this.queue.push(task);this.execute(task)};return ActionExecutor}))}());(function(){var define=System.amdDefine;(function(root,factory){if(typeof exports==='object'){module.exports=factory()}else if(typeof define==='function'&&define.amd){define('3rdparty/action-executor/ActionCancelledError.js',[],factory)}else{root.com=root.com||{};root.com.one=root.com.one||{};root.com.one.ActionCancelledError=factory()}}(this,function(){function ActionCancelledError(){}ActionCancelledError.prototype=new Error;return ActionCancelledError}))}());(function(){var define=System.amdDefine;(function(root,factory){if(typeof exports==='object'){module.exports=factory(require('Failboat'),require('ActionCancelledError'))}else if(typeof define==='function'&&define.amd){define('3rdparty/actionInterceptor.js',['3rdparty/Failboat.js','3rdparty/action-executor/ActionCancelledError.js'],factory)}else{root.com=root.com||{};root.com.one=root.com.one||{};root.com.one.actionInterceptor=factory(root.com.one.Failboat,root.com.one.ActionCancelledError)}}(this,function(Failboat,ActionCancelledError){return function(action,args,next){var err=args[0];if(err){if(err instanceof ActionCancelledError){Failboat.tag(err,'CANCELLED')}Failboat.tag(err,action.name);err.action=action}next()}}))}());(function(){var define=System.amdDefine;(function(root,factory){if(typeof exports==='object'){module.exports=factory(require('tracking'),require('ErrorTracker'))}else if(typeof define==='function'&&define.amd){define('3rdparty/retryTracker.js',['node_modules/@one.com/tracking-analytics/lib/tracking.js','3rdparty/tracking-analytics/ErrorTracker.js'],factory)}else{root.com=root.com||{};root.com.one=root.com.one||{};root.com.one.tracking=factory(root.com.one.tracking,root.com.one.ErrorTracker)}}(this,function(tracking,ErrorTracker){return function(task,status,err){if(task&&'action'in task&&typeof task.action.retries!=='undefined'){var usedRetries=Math.abs(task.retries-task.action.retries);if(status==='queued for retrying'){ErrorTracker.track(err);tracking.track('retries',task.action.name,'retrying',usedRetries)}else if(status==='failed'&&usedRetries>0){tracking.track('retries',task.action.name,'failed',usedRetries)}else if(status==='done'&&usedRetries>0){tracking.track('retries',task.action.name,'success',usedRetries)}}}}))}());(function(){var define=System.amdDefine;define('common/shouldRetryActionOnError.js',[],function(){return function(err){return err.status===503||err.status===502}})}());(function(){var define=System.amdDefine;define('webmail/model/Sidebar.js',['node_modules/jquery/dist/jquery.js','node_modules/knockout/build/output/knockout-latest.debug.js'],function($,ko){function Sidebar(layout){var that=this;that.temporarilyExpanded=ko.observable(false);var sidebarCollapsed=ko.observable(false);that.collapsed=ko.computed({read:function(){if(that.temporarilyExpanded()){layout.splitView.isSidebarExtended=true;return false}if(layout.isSplitView()&&!layout.splitView.horizontal()){return!layout.isWideView()}else{return layout.isNarrowView()||sidebarCollapsed()}},write:function(collapsed){sidebarCollapsed(collapsed)}});that.show=ko.observable(false);that.closeWhenLeaving=ko.observable(false);that.animated=ko.observable(false);that.toggle=function(){that.animated(true);that.closeWhenLeaving(false);that.temporarilyExpanded(!that.temporarilyExpanded())};that.expand=function(){if(that.collapsed()){that.animated(true);that.closeWhenLeaving(true);that.temporarilyExpanded(true)}};that.mouseOver=ko.observable(false);that.leave=function(){layout.splitView.isSidebarExtended=false;that.mouseOver(false);clearTimeout(that.leaveTimer);if(that.autoClosingEnabled()&&that.closeWhenLeaving()){that.leaveTimer=setTimeout(function(){if(that.autoClosingEnabled()&&that.closeWhenLeaving()){that.animated(true);that.closeWhenLeaving(false);that.temporarilyExpanded(false)}},400)}};that.enter=function(){that.mouseOver(true);clearTimeout(that.leaveTimer)};that.autoClosingEnabled=ko.observable(true);ko.computed(function(){return that.closeWhenLeaving()&&that.autoClosingEnabled()&&!that.mouseOver()}).subscribe(function(value){if(value){that.leave()}});that.animated.subscribe(function(active){if(active){setTimeout(function(){that.animated(false)},1000)}});that.collapsed.subscribe(function(){setTimeout(function(){$(window).trigger('resize')},0)})}return Sidebar})}());(function(){var define=System.amdDefine;define('webmail/model/Layout.js',['node_modules/jquery/dist/jquery.js','node_modules/knockout/build/output/knockout-latest.debug.js','webmail/model/Sidebar.js'],function($,ko,Sidebar){var LIST_MIN_WIDTH=250;var LIST_MIN_HEIGHT=210;var LIST_WIDE=800;var CONTENT_MIN_WIDTH=770;var CONTENT_MIN_HEIGHT=400;var SIDEBAR_EXPANDED=223;var SIDEBAR_COLLAPSED=60;var TOUCH_WIDE=1024;var LAYOUT_NARROW=SIDEBAR_COLLAPSED+LIST_MIN_WIDTH+CONTENT_MIN_WIDTH;var LAYOUT_WIDE=SIDEBAR_EXPANDED+LIST_MIN_WIDTH+CONTENT_MIN_WIDTH;var LAYOUT_TALL=LIST_MIN_HEIGHT+CONTENT_MIN_HEIGHT;function Layout(state){var that=this;var defaultContentPanel={template:'selection'};that.contentPanel={viewModel:defaultContentPanel,template:ko.observable(defaultContentPanel.template).extend({notify:'always'}),afterRender:function(){var viewModel=that.contentPanel.viewModel;if(viewModel.init){viewModel.init.apply(viewModel,arguments)}},reset:function(){that.setContentPanel(null)}};that.dimensions={window:{width:ko.observable(),height:ko.observable()},view:{width:ko.observable(),height:ko.observable()},sidebarWidth:ko.observable(),contentPanelWidth:ko.observable()};that.isWideView=ko.computed(function(){return that.dimensions.window.width()>=LAYOUT_WIDE});that.isNarrowView=ko.computed(function(){return that.dimensions.window.width()<LAYOUT_NARROW});that.isShortView=ko.computed(function(){return that.dimensions.window.height()<LAYOUT_TALL});that.verySmall=ko.computed(function(){return that.isNarrowView()&&that.isShortView()});that.setDimensions=function(){that.dimensions.view.height($('.app').outerHeight());that.dimensions.view.width(that.dimensions.window.width()-that.dimensions.sidebarWidth());that.dimensions.sidebarWidth($('.sidebar').outerWidth()||0);that.dimensions.contentPanelWidth($('.content-panel').parent().outerWidth()||0)};that.dimensions.window.width($(window).width());that.dimensions.window.height($(window).height());$(window).resize(function(){that.dimensions.window.width($(window).width());that.dimensions.window.height($(window).height());if(that.isNarrowView()&&that.stackView.currentView()==='contentPanel'){that.sidebar.show(false)}that.observableEventHappend.notifySubscribers()});that.contentPanel.template.subscribe(function(template){if(defaultContentPanel.template===template){that.stackView.showListPanel()}else{that.stackView.showContentPanel()}});that.setContentPanel=function(viewModel,done){viewModel=viewModel||defaultContentPanel;var panel=that.contentPanel;var oldViewModel=panel.viewModel;if(viewModel===oldViewModel){if(done){done()}return}if(panel.viewModel&&panel.viewModel.close){panel.viewModel.close()}panel.viewModel=viewModel;panel.template(viewModel.template);state.signals.contentPanelReplaced.dispatch(oldViewModel,viewModel);if(done){done()}};var horizontal=ko.observable(false);that.splitView={horizontal:horizontal,resizablePanel:'panel1',isSidebarExtended:false,position:{horizontal:ko.observable(CONTENT_MIN_HEIGHT),vertical:ko.observable(CONTENT_MIN_WIDTH)},panel1:{template:'listPanel',minWidth:LIST_MIN_WIDTH,minHeight:LIST_MIN_HEIGHT},panel2:{template:'contentPanel',minWidth:CONTENT_MIN_WIDTH,minHeight:CONTENT_MIN_HEIGHT}};that.stackView={currentView:ko.observable('listPanel'),showListPanel:function(){that.stackView.currentView('listPanel')},showContentPanel:function(){that.stackView.currentView('contentPanel')}};that.stackView.isListPanelVisible=ko.pureComputed(function(){return that.stackView.currentView()==='listPanel'});that.stackView.isContentPanelVisible=ko.pureComputed(function(){return that.stackView.currentView()==='contentPanel'});that.selectedLayout=ko.observable(that.isNarrowView()?'stackView':'splitView');if(state.isTouch){that.currentLayout=ko.computed(function(){if(that.dimensions.window.width()<TOUCH_WIDE){return'stackView'}else{return'splitView'}})}else{that.currentLayout=ko.computed(function(){if(that.selectedLayout()==='stackView'||that.splitView.horizontal()&&that.isShortView()||!that.splitView.horizontal()&&that.isNarrowView()){return'stackView'}else{return'splitView'}})}that.currentLayout.subscribe(function(){var viewModel=that.contentPanel.viewModel;if(viewModel.flushChanges){viewModel.flushChanges()}},null,'beforeChange');that.selectStackView=function(){that.selectedLayout('stackView')};that.selectSplitView=function(){that.selectedLayout('splitView')};that.isStackView=ko.computed(function(){return that.currentLayout()==='stackView'});that.isSplitView=ko.computed(function(){return that.currentLayout()==='splitView'});that.observableEventHappend=ko.observable();that.wideList=ko.computed(function(){var width,panelsWidth=Math.floor($(window).width()-SIDEBAR_EXPANDED);that.observableEventHappend();if(that.isStackView()||horizontal()){width=that.dimensions.view.width()}else{if(that.splitView.resizablePanel==='panel1'){width=panelsWidth-that.splitView.position.vertical()}else{width=that.splitView.position.vertical()}}return width>LIST_WIDE});that.mailList={visible:ko.pureComputed(function(){return!that.isStackView()||that.stackView.isListPanelVisible()}),scrollTop:0};that.selectHorizontalSplit=function(){that.splitView.horizontal(true);that.selectSplitView()};that.selectTwoColumn=function(){that.splitView.horizontal(false);that.selectSplitView()};that.selectOneColumn=function(){that.selectStackView()};that.sidebar=new Sidebar(this);that.dimensions.window.width.subscribe(that.setDimensions);that.dimensions.window.height.subscribe(that.setDimensions);that.splitView.position.vertical.subscribe(function(){setTimeout(that.setDimensions,0)});that.currentLayout.subscribe(that.setDimensions);that.sidebar.collapsed.subscribe(that.setDimensions)}return Layout})}());(function(){var define=System.amdDefine;define('webmail/composer/MailSent.js',[],function(){function MailSent(parentView){this.parentView=parentView}MailSent.prototype.template='mailSent';MailSent.prototype.clearView=function(){this.parentView.viewMail(null)};return MailSent})}());(function(){var define=System.amdDefine;define('webmail/composer/SendingMail.js',[],function(){function SendingMail(){}SendingMail.prototype.template='sendingMail';return SendingMail})}());(function(){var define=System.amdDefine;define('webmail/mailTabs/MailTab.js',['node_modules/knockout/build/output/knockout-latest.debug.js'],function(ko){function MailTab(composer){var that=this;this.flash=ko.observable(false);this.composer=ko.observable(composer);this.subject=ko.computed(function(){return ko.utils.unwrapObservable(that.composer().subject)});this.sending=ko.computed(function(){return ko.utils.unwrapObservable(that.composer().sendingMail)});this.failedSending=ko.computed(function(){return ko.utils.unwrapObservable(that.composer().failedSending)});this.failedSaving=ko.computed(function(){return ko.utils.unwrapObservable(that.composer().failedSaving)});this.failed=ko.computed(function(){return that.failedSaving()||that.failedSending()})}MailTab.prototype.folder=function(){var composer=this.composer();if(composer.draftBeingEdited&&composer.draftBeingEdited()){var folder=composer.draftBeingEdited().folder();return{id:folder.id(),uidValidity:folder.uidvalidity()}}else if(composer.folder){return composer.folder}else{return null}};MailTab.prototype.uid=function(){var composer=this.composer();if(typeof composer.uid!=='undefined'){return composer.uid}else if(composer.draftBeingEdited()){return composer.draftBeingEdited().uid}else{return null}};MailTab.prototype.toJS=function(){var result={subject:this.subject(),uid:this.uid(),folder:this.folder()};return result};return MailTab})}());(function(){var define=System.amdDefine;define('webmail/mailTabs/MailTabs.js',['node_modules/knockout/build/output/knockout-latest.debug.js','node_modules/jquery/dist/jquery.js','webmail/mailTabs/MailTab.js','webmail/composer/Composer.js','webmail/mailView/MailView.js','common/util.js','3rdparty/signals.js'],function(ko,$,MailTab,Composer,MailView,util,signals){function MailTabs(state){var that=this;var maxNumberOfTabs=6;this.state=state;this.tabs=ko.observableArray([]);this.showComposer=new signals.Signal;this.closeComposer=new signals.Signal;this.tabsChanged=new signals.Signal;this.activeViewModel=ko.observable(null);this.justClicked=false;var mailTabDrafts=this.tabs.filter(function(tab){return tab.composer()instanceof Composer&&tab.composer().draftBeingEdited()}).map(function(tab){return tab.composer().draftBeingEdited()});var prevDrafts;mailTabDrafts.subscribe(function(drafts){prevDrafts=[].concat(drafts)},null,'beforeChange');mailTabDrafts.subscribe(function(drafts){drafts.forEach(function(draft){draft.incrementReferences()});prevDrafts.forEach(function(draft){draft.decrementReferences()})});this.activeTab=ko.pureComputed(function(){var viewModel=that.activeViewModel();if(viewModel instanceof Composer){var tab=findTabByComposer(viewModel);if(tab){return tab}}return null}).extend({throttle:100});function fallbackForMissingFolder(composer){if('uid'in composer&&typeof composer.folder==='undefined'){var folder=that.state.folders.drafts;composer.folder={id:folder.id(),uidValidity:folder.uidvalidity()}}}function findTabsByMails(mails){return that.tabs().filter(function(tab){var tabFolder=tab.folder();return mails.some(function(mail){return tab.uid()===mail.uid&&mail.folder().id()===tabFolder.id&&mail.folder().uidvalidity()===tabFolder.uidValidity})})}function findTabByUidAndFolder(uid,folder){return that.tabs().filter(function(tab){var tabFolder=tab.folder();return tab.uid()===uid&&folder.id===tabFolder.id&&folder.uidValidity===tabFolder.uidValidity})[0]}function findTabByComposer(composer){var matchingTab;if(typeof composer.uid!=='undefined'){fallbackForMissingFolder(composer);return findTabByUidAndFolder(composer.uid,composer.folder)}else if(composer.draftBeingEdited()){matchingTab=that.tabs().filter(function(tab){return tab.composer()===composer})[0];if(matchingTab){return matchingTab}var draft=composer.draftBeingEdited();if(!draft){return null}return that.tabs().filter(function(tab){return draft.uid===tab.uid()&&draft.folder().id()===tab.folder().id&&draft.folder().uidvalidity()===tab.folder().uidValidity})[0]}else{matchingTab=that.tabs().filter(function(tab){return!(tab.composer().uid||tab.composer().draftBeingEdited())})[0];if(matchingTab){return matchingTab}}}function moveTabToFront(tab){if(that.tabs.indexOf(tab)>0){that.tabs.remove(tab);if(tab.failed()){that.tabs.splice(0,0,tab)}else{var i=0;while(that.tabs()[i]&&that.tabs()[i].failed()){i+=1}that.tabs.splice(i,0,tab)}}}function replaceViewWithComposer(oldViewModel,viewModel){if(oldViewModel instanceof Composer){var newTab=findTabByComposer(viewModel);if(!that.justClicked&&that.tabs.indexOf(newTab)>0){moveTabToFront(newTab);that.tabsChanged.dispatch()}}}function replaceComposerView(oldViewModel,viewModel){if(!that.justClicked){var oldTab=findTabByComposer(oldViewModel);if(oldTab){oldTab.flash(true)}}}state.signals.contentPanelReplaced.add(function(oldViewModel,viewModel){if(viewModel instanceof Composer){replaceViewWithComposer(oldViewModel,viewModel)}else if(oldViewModel instanceof Composer){replaceComposerView(oldViewModel,viewModel)}that.justClicked=false;that.activeViewModel(viewModel)});this.add=function(composer){var tab=findTabByComposer(composer);if(!tab){tab=new MailTab(composer);var tabs=that.tabs();if(tab.failed()){tabs.splice(0,0,tab)}else{var i=0;while(tabs[i]&&tabs[i].failed()){i+=1}tabs.splice(i,0,tab)}var count=0;tabs=tabs.filter(function(tab){if(tab.failed()||tab.sending()){return true}var keep=count<maxNumberOfTabs;count+=1;return keep});that.tabs(tabs);that.tabsChanged.dispatch()}return tab};this.replaceAll=function(composers){var tabs=composers.map(function(composer){fallbackForMissingFolder(composer);return new MailTab(composer)});that.tabs(tabs);that.tabsChanged.dispatch()};this.remove=function(tab){that.tabs.remove(tab);that.closeComposer.dispatch(tab.composer());that.tabsChanged.dispatch()};this.removeComposer=function(composer){var tab=findTabByComposer(composer);if(tab){that.remove(tab)}};this.removeAll=function(tabs){that.tabs.removeAll(tabs);tabs.forEach(function(tab){that.closeComposer.dispatch(tab.composer())});that.tabsChanged.dispatch()};this.toggleTab=function(tab){that.justClicked=true;if(tab===that.activeTab()){that.closeComposer.dispatch(tab.composer());that.tabsChanged.dispatch()}else{that.showComposer.dispatch(tab.composer())}};function removeTabsForMails(mails){var tabs=findTabsByMails(mails);that.removeAll(tabs)}state.signals.movingMails.add(function(mails,source,destination){if(!destination.isDraftFolder()){removeTabsForMails(mails)}});state.signals.removingMails.add(removeTabsForMails);state.signals.mailSaved.add(function(mail){that.tabsChanged.dispatch()});state.signals.mailDisappeared.add(function(uid,folder){var tab=findTabByUidAndFolder(uid,folder.toJS());if(tab){that.remove(tab)}});function moveComposerToFront(composer){var tab=findTabByComposer(composer);if(tab){moveTabToFront(tab);that.tabsChanged.dispatch();setTimeout(function(){tab.flash(true)},700)}}state.signals.queueMailForSendingFailed.add(moveComposerToFront);state.signals.savingMailFailed.add(moveComposerToFront);state.signals.composerOpened.add(function(composer){var tab=findTabByComposer(composer);if(tab){composer.failedSending(tab.failedSending());composer.failedSaving(tab.failedSaving());tab.composer(composer)}else{that.add(composer)}});function removeComposerTab(composer){var tab=findTabByComposer(composer);if(tab){that.remove(tab)}}state.signals.queueMailForSending.add(removeComposerTab);state.signals.mailDiscarded.add(removeComposerTab);that.findComposerForDraft=function(draft){var tab=findTabsByMails([draft])[0];return tab&&tab.composer()instanceof Composer?tab.composer():null};that.hasFailedDrafts=ko.pureComputed(function(){return mailTabDrafts().some(function(draft){return draft.failed()})});that.findUnsavedTab=function(){var newTabs=that.tabs().filter(function(tab){return tab.composer()&&tab.composer()instanceof Composer&&!tab.composer().draftBeingEdited()});return newTabs[0]||null}}MailTabs.prototype.showTabAnimation=function(element){var $mailTab=$(element).filter('.mail-tab');$mailTab.css('width','0px').delay(200).animate({width:'197px'},200)};MailTabs.prototype.hideTabAnimation=function(element){var $mailTab=$(element).filter('.mail-tab');$mailTab.animate({width:'0px'},200,function(){$(element).remove()})};MailTabs.prototype.composersSending=function(){return this.tabs().filter(function(tab){return tab.sending()}).length};MailTabs.prototype.composersFailedSending=function(){return this.tabs().filter(function(tab){return tab.failedSending()}).length};MailTabs.prototype.composersFailedSaving=function(){return this.tabs().filter(function(tab){return tab.failedSaving()}).length};MailTabs.prototype.setup=function(element){$(element).on('webkitAnimationEnd oanimationend msAnimationEnd animationend',function(e){if(typeof ko.dataFor(e.target).flash==='function'){ko.dataFor(e.target).flash(false)}})};MailTabs.prototype.toJS=function(){return this.tabs().filter(function(tab){return tab.uid()!==null}).map(function(tab){return tab.toJS()})};return MailTabs})}());(function(){var define=System.amdDefine;define('common/model/SpamFolder.js',['node_modules/knockout/build/output/knockout-latest.debug.js','common/model/Folder.js'],function(ko,Folder){function SpamFolder(inbox){var that=this;Folder.call(that,{id:'INBOX.Spam'},inbox);that.iconClass='icon-inbox-spam';that.supportDelete=ko.computed(function(){return false})}SpamFolder.prototype=Object.create(Folder.prototype);SpamFolder.prototype.supportMoveToTrash=function(){return false};SpamFolder.prototype.supportSpamToTrash=ko.computed(function(){return true});SpamFolder.prototype.isInbox=function(){return false};SpamFolder.prototype.isDraftFolder=function(){return false};SpamFolder.prototype.isSentFolder=function(){return false};SpamFolder.prototype.isTrashFolder=function(){return false};SpamFolder.prototype.isSpamFolder=function(){return true};SpamFolder.prototype.isOutgoingFolder=function(){return false};SpamFolder.prototype.isSystemFolder=function(){return true};SpamFolder.prototype.isCustomFolder=function(){return false};return SpamFolder})}());(function(){var define=System.amdDefine;define('webmail/actions/DeleteFolderAction.js',['3rdparty/async.js','common/util.js','common/ActionBehavior.js'],function(async,util,ActionBehavior){function DeleteFolderAction(options){util.extend(this,util.pick(options,'folder'));ActionBehavior.installInto(this)}DeleteFolderAction.prototype.name='DeleteFolderAction';DeleteFolderAction.prototype.validate=function(){if(!this.folder){throw new Error('A folder must be specified')}};DeleteFolderAction.prototype.models=function(){return this.folder.allChildren().concat(this.folder)};DeleteFolderAction.prototype.execute=function(context,cb){var that=this;var state=context.state;var backend=context.backend;that.setBusyFlags();var folder=this.folder;var oldParent=folder.parent();state.folders.deleteFolder(folder);var tasks=[];if(oldParent&&!oldParent.uidvalidity()){tasks.push(function(callback){backend.createFolder(state.user(),oldParent.id(),function(err,data){if(!err){oldParent.uidvalidity(data.uidValidity)}callback(err)})})}if(!folder.uidvalidity()){tasks.push(function(callback){backend.createFolder(state.user(),folder.id(),function(err,data){if(!err){folder.uidvalidity(data.uidValidity)}callback(err)})})}tasks.push(function(callback){backend.deleteFolder(state.user(),folder.id(),folder.uidvalidity(),function(err){if(err&&err.status!==404){callback(err)}else{callback(null)}})});async.series(tasks,function(err){that.removeBusyFlags();if(err){if(oldParent){oldParent.children.push(folder);folder.parent(oldParent)}else{state.folders.inbox.children.push(folder)}}else{folder.dispose()}cb(err)})};return DeleteFolderAction})}());(function(){var define=System.amdDefine;define('webmail/actions/CreateFolderAction.js',['common/util.js','common/ActionBehavior.js'],function(util,ActionBehavior){function CreateFolderAction(options){util.extend(this,util.pick(options,'folder','newName'));ActionBehavior.installInto(this)}CreateFolderAction.prototype.name='CreateFolderAction';CreateFolderAction.prototype.validate=function(){if(!this.folder){throw new Error('A folder must be specified')}var name=this.folder.name();if(!name||name.trim()===''){throw new Error('The folder name must not be empty')}if(this.folder.children().length>0){throw new Error('The folder must not have any children')}};CreateFolderAction.prototype.models=function(){return this.folder};CreateFolderAction.prototype.execute=function(context,cb){var that=this;var state=context.state;var backend=context.backend;that.setBusyFlags();var folder=this.folder;backend.createFolder(state.user(),folder.id(),function(err,data){that.removeBusyFlags();if(err){folder.remove()}else{folder.uidvalidity(data.uidValidity);folder.isNew(false)}cb(err)})};return CreateFolderAction})}());(function(){var define=System.amdDefine;define('webmail/actions/MoveFolderAction.js',['3rdparty/async.js','common/util.js','common/ActionBehavior.js'],function(async,util,ActionBehavior){function MoveFolderAction(options){util.extend(this,util.pick(options,'newName','folder','destination'));ActionBehavior.installInto(this)}MoveFolderAction.prototype.name='MoveFolderAction';MoveFolderAction.prototype.validate=function(){if(!this.folder){throw new Error('A folder must be specified')}};MoveFolderAction.prototype.models=function(context){var folder=this.folder;var oldParent=folder.parent();var destination='destination'in this?this.destination:oldParent;return[].concat(folder,oldParent,destination,folder.allChildren()).filter(function(item){return item})};MoveFolderAction.prototype.execute=function(context,cb){var that=this;var state=context.state;var backend=context.backend;that.setBusyFlags();var folder=this.folder;var newName=this.newName||folder.name();var oldParent=folder.parent();var destination=this.destination||oldParent||context.state.folders.inbox;var destinationChildren=destination.children();var nameCollision=destinationChildren.some(function(child){return child.name()===newName});if(nameCollision){var highestCollisionNumber=0;destinationChildren.forEach(function(child){var match;if(child.name().indexOf(newName+'-')===0&&(match=/^[^-]+-(\d+)$/.exec(child.name()))){var folderNumber=match[1];highestCollisionNumber=Math.max(highestCollisionNumber,folderNumber)}});newName=newName+'-'+(highestCollisionNumber+1)}var folderId=folder.id();var oldName=folder.name();state.folders.moveFolder(folder,destination);folder.name(newName);var tasks=[];if(!oldParent.uidvalidity()){tasks.push(function(callback){backend.createFolder(state.user(),oldParent.id(),function(err,data){if(!err){oldParent.uidvalidity(data.uidValidity)}callback(err)})})}if(!folder.uidvalidity()){tasks.push(function(callback){backend.createFolder(state.user(),folderId,function(err,data){if(!err){folder.uidvalidity(data.uidValidity)}callback(err)})})}tasks.push(function(callback){backend.renameFolder(state.user(),folderId,folder.uidvalidity(),folder.id(),function(err){callback(err)})});async.series(tasks,function(err,results){that.removeBusyFlags();if(err){state.folders.moveFolder(folder,oldParent);folder.name(oldName)}cb(err)})};return MoveFolderAction})}());(function(){var define=System.amdDefine;define('webmail/actions/MoveSpamToTrashAction.js',['common/util.js','3rdparty/uidRanger.js','common/ActionBehavior.js'],function(util,uidRanger,ActionBehavior){function MoveSpamToTrash(){ActionBehavior.installInto(this)}MoveSpamToTrash.prototype.name='MoveSpamToTrash';MoveSpamToTrash.prototype.isBlocking=true;MoveSpamToTrash.prototype.models=function(context){return[context.state.folders.spam,context.state.folders.trash].concat(context.state.folders.spam.mailCache.getAll())};MoveSpamToTrash.prototype.execute=function(context,cb){var that=this;var state=context.state;var backend=context.backend;that.setBusyFlags();var destination=state.folders.trash;var folder=state.folders.spam;var mails=folder.mailCache.getAll();if(mails.length===0){cb();return}state.signals.movingMails.dispatch(mails,folder,destination);folder.removeMails(mails);destination.addMails(mails);backend.moveMails(state.user(),folder.id(),folder.uidvalidity(),destination.id(),'*',function(err,data){that.removeBusyFlags();if(!err){if(typeof destination.uidvalidity()!=='number'){destination.uidvalidity(data.uidValidity)}if('from'in data&&'to'in data){var mailIndex=util.uniqueIndexBy(mails,'uid');var fromUidRange=uidRanger.parse(String(data.from));var toUidRange=uidRanger.parse(String(data.to));for(var i=0;i<fromUidRange.length();i+=1){var oldUid=fromUidRange.get(i);var newUid=toUidRange.get(i);var movedMail=mailIndex[oldUid];if(movedMail){movedMail.uid=newUid;movedMail.folder(destination);destination.mailCache.store(movedMail)}}}}cb(err)})};return MoveSpamToTrash})}());(function(){var define=System.amdDefine;define('webmail/actions/EmptyFolderAction.js',['common/util.js','common/ActionBehavior.js'],function(util,ActionBehavior){function EmptyFolderAction(options){util.extend(this,util.pick(options,'folder'));ActionBehavior.installInto(this)}EmptyFolderAction.prototype.name='EmptyFolderAction';EmptyFolderAction.prototype.isBlocking=true;EmptyFolderAction.prototype.validate=function(){if(!this.folder){throw new Error('A folder must be specified')}if(this.folder.id()!=='INBOX.Trash'){throw new Error('Only the trash folder can be emptied')}};EmptyFolderAction.prototype.models=function(){return this.folder.allChildren().concat(this.folder)};EmptyFolderAction.prototype.execute=function(context,cb){var that=this;var state=context.state;var backend=context.backend;that.setBusyFlags();var folder=this.folder;state.folders.emptyFolder(folder);backend.emptyFolder(state.user(),folder.id(),folder.uidvalidity(),function(err){that.removeBusyFlags();cb(err)})};return EmptyFolderAction})}());System.registerDynamic('common/view/listItemErrorDialog.ko',[],true,function($__require,exports,module){var define,global=this||self,GLOBAL=global;module.exports=function injectTemplate(tpl){var s=document.createElement('script');s.id=tpl.id;s.innerHTML=window.TR?TR.HTML(tpl.content):tpl.content;s.type='text/html';document.head.appendChild(s)}({'id':'listItemErrorDialog','content':'<div class="error-dialog">\n    <span class="error-text" data-bind="text: $data" data-i18n="">Error message</span>\n</div>\n'});return module.exports});(function(){var define=System.amdDefine;define('common/bindings/knockout.listItemError.js',['node_modules/knockout/build/output/knockout-latest.debug.js','common/util.js','3rdparty/knockout.popupTemplate.js','common/view/listItemErrorDialog.ko'],function(ko,util){ko.bindingHandlers.listItemError={init:function(element,valueAccessor,allBindingsAccessor,viewModel,bindingContext){var config=valueAccessor();if(typeof config!=='object'||!ko.isObservable(config.openState)||!config.data){throw new Error('listItemError must have data and openState')}util.extend(config,{template:'listItemErrorDialog',closeOnEsc:false,anchorHandler:false,outsideHandler:false,positioning:{vertical:'middle',horizontal:'outside-right'}});ko.bindingHandlers.popupTemplate.init(element,function(){return config},allBindingsAccessor,viewModel,bindingContext)}}})}());System.registerDynamic('components/renameEditor/renameEditor.ko',[],true,function($__require,exports,module){var define,global=this||self,GLOBAL=global;module.exports=function injectTemplate(tpl){var s=document.createElement('script');s.id=tpl.id;s.innerHTML=window.TR?TR.HTML(tpl.content):tpl.content;s.type='text/html';document.head.appendChild(s)}({'id':'renameEditor','content':'<input type="text"\n       data-bind="value: value,\n                  focusWhen: true,\n                  selectOnFocus: true,\n                  valueUpdate: \'keyup\',\n                  onKeyUp: {\n                      enter: commit,\n                      esc: cancel\n                  },\n                  event: {\n                      blur: blur\n                  },\n                  autoExpand: autoExpand,\n                  keydownBubble: false,\n                  keyupBubble: false,\n                  style: style,\n                  attr: attr">\n'});return module.exports});(function(){var define=System.amdDefine;define('components/renameEditor/renameEditor.js',['node_modules/knockout/build/output/knockout-latest.debug.js','components/renameEditor/renameEditor.ko'],function(ko){ko.components.register('rename-editor',{template:{element:'renameEditor'},viewModel:function(params){this.value=params.value;this.commit=params.commit;this.cancel=params.cancel;this.blur=params.blur;this.style=params.style||{};this.attr=params.attr||{};this.autoExpand=params.autoExpand?this.value:false}})})}());(function(){var define=System.amdDefine;define('webmail/folderList/FolderListView.js',['node_modules/jquery/dist/jquery.js','node_modules/knockout/build/output/knockout-latest.debug.js','common/util.js','node_modules/@one.com/tracking-analytics/lib/tracking.js','common/ViewBehavior.js','common/model/Folder.js','common/model/SpamFolder.js','common/KeyHandler.js','common/ScrollPane.js','webmail/model/Mail.js','webmail/actions/RefreshFoldersAction.js','webmail/actions/DeleteFolderAction.js','webmail/actions/CreateFolderAction.js','webmail/actions/MoveFolderAction.js','webmail/actions/MoveMailsAction.js','webmail/actions/MoveSpamToTrashAction.js','webmail/actions/EmptyFolderAction.js','common/bindings/knockout.listItemError.js','components/renameEditor/renameEditor.js'],function($,ko,util,tracking,ViewBehavior,Folder,SpamFolder,getKeyHandler,ScrollPane,Mail,RefreshFoldersAction,DeleteFolderAction,CreateFolderAction,MoveFolderAction,MoveMailsAction,MoveSpamToTrashAction,EmptyFolderAction){function FolderListView(options){var that=this;util.extend(this,util.pick(options,['state','layout','pageNavigator','actionExecutor','errorHandler']));that.selection=ko.observableArray([this.state.folders.inbox]);that.selected=ko.computed({read:function(){return that.selection()[0]||that.state.folders.inbox},write:function(folder){if(that.selection()[0]!==folder){that.selection([folder])}}});that.folder=ko.observable(that.state.folders.inbox);that.selected.equalityComparer=function(a,b){if(a===null||b===null){return a===b}return a.id()===b.id()};this.sidebar=this.layout.sidebar;this.collapsed=this.sidebar.collapsed;ViewBehavior.installInto(this);this.editing={name:ko.observable(''),folder:ko.observable(null),showError:ko.observable(false),errorMessage:ko.observable('')};this.editing.folder.subscribe(function(folder){if(folder&&getNameError(that.editing.name(),folder)){if(!folder.uidvalidity()){folder.remove();folder.dispose()}}},null,'beforeChange');this.addByPlusIcon=false;this.shouldInputBeOpened=ko.observable(true);this.editing.folder.subscribe(function(folder){that.sidebar.autoClosingEnabled(!folder)});this.editing.name.subscribe(function(name){that.editing.showError(false)});this.state.folders.signals.folderMoved.add(function(folder,isSelected){if(isSelected){that.selected(folder)}});this.state.folders.signals.folderDeleted.add(function(folder,wasSelected,parent){if(wasSelected){that.selected(parent||that.state.folders.inbox)}})}FolderListView.prototype.registerKeys=function(){var that=this;var keyhandler=getKeyHandler();keyhandler.register('sidebar','up',function(){var list=that.state.folders.list();var selectIndex=list.indexOf(that.selected())-1;if(selectIndex<0){return false}var newSelect=list[selectIndex];while(newSelect.hidden()){newSelect=newSelect.parent()}that.selected(newSelect);return false});keyhandler.register('sidebar','down',function(){var list=that.state.folders.list();var selectIndex=list.indexOf(that.selected())+1;if(selectIndex>=list.length){return false}var newSelect=list[selectIndex];while(newSelect&&newSelect.hidden()){selectIndex+=1;newSelect=list[selectIndex]}if(newSelect){that.selected(newSelect)}return false});keyhandler.register('sidebar','right',function(){var folder=that.selected();if(folder.collapsed()){folder.animateSelfAndChildren();folder.collapsed(false)}else if(folder.collapsable()){that.selected(folder.children()[0])}return false});keyhandler.register('sidebar','left',function(){var folder=that.selected();if(folder.collapsable()){folder.animateSelfAndChildren();folder.collapsed(true)}else if(folder.parent()&&!folder.parent().isInbox()){that.selected(folder.parent())}});keyhandler.register('sidebar','tab',function(){var domains=keyhandler.listDomains();if(domains.indexOf('listPanel')!==-1){that.childView.setFocusInMailView(true);keyhandler.focusDomain('listPanel')}else if(domains.indexOf('composer')!==-1){that.childView.setFocusInMailView(false);keyhandler.focusDomain('composer')}else if(domains.indexOf('mailView')!==-1){that.childView.setFocusInMailView(true);keyhandler.focusDomain('mailView')}return false});keyhandler.register('sidebar','shift+tab',function(){var domains=keyhandler.listDomains();if(domains.indexOf('mailView')!==-1){keyhandler.focusDomain('mailView')}else if(domains.indexOf('composer')!==-1){keyhandler.focusDomain('composer')}else{keyhandler.focusDomain('listPanel')}return false});keyhandler.register('sidebar','mod+a',function(){return false})};FolderListView.prototype.refreshFolders=function(silent,cb){var that=this;if(that.isCurrentlyRefreshing){return}that.isCurrentlyRefreshing=true;if(!silent){this.state.notification(TR('mail.Loading','Loading...'))}var selectedFolder=that.selected();var selectedFolderId=selectedFolder&&selectedFolder.id();var selectedFolderName=selectedFolder&&selectedFolder.translatedName();this.executeAction(new RefreshFoldersAction({silent:silent}),function(err){if(!silent){that.state.notification(null)}if(err){if(silent&&that.state.folders.list().length>0){that.handleError(err,{'0':function(){},'502 ACCOUNTCREATIONPENDING':'ACCOUNTCREATIONPENDING','500, 502, 503, 200':function(){this.reportTaggedCrashWithUser(err,'Auto refresh folder failed')}})}else{that.handleError(err)}}else if(selectedFolderId&&!that.selected()){var selectedFolderReplacement=selectedFolderId&&that.state.folders.list().filter(function(folder){return folder.id()===selectedFolderId})[0];if(selectedFolderReplacement){that.selectFolder(selectedFolderReplacement);if(selectedFolder.uidvalidity()==='number'){that.showWarning(TR('mail.error.UidValidityConflictFolderHasBeenReloaded','Another program has changed the open folder. It has therefore been reloaded. Sorry for any inconvenience.'))}}else{that.selectFolder(that.state.folders.inbox);that.showWarning(TR.PAT('mail.WatchedFolderDeleted','The folder "{0}", which you were watching, has been deleted.')(selectedFolderName))}}that.isCurrentlyRefreshing=false;if(typeof cb==='function'){cb(err)}})};FolderListView.prototype.customSelected=function(){var selected=this.selected();return!!selected&&this.state.folders.system().indexOf(selected)===-1};FolderListView.prototype.renameFolder=function(folder){this.editing.folder(folder);this.editing.name(folder.name())};FolderListView.prototype.moveToTrash=function(folder){var that=this;var trashFolder=this.state.folders.trash;this.executeAction(new MoveFolderAction({folder:folder,destination:trashFolder}),function(err){if(err){that.handleError(err)}})};FolderListView.prototype.moveSpamToTrash=function(folder){var that=this;this.executeAction(new MoveSpamToTrashAction,function(err){if(err){that.handleError(err)}})};var deleteConfirmMessage=TR.PAT('mail.DeleteFolderConfirmation','Are you sure you want to delete the folder {0}?\n'+'This will permanently delete its emails and subfolders.');FolderListView.prototype.deleteFolder=function(folder){var that=this;if(window.confirm(deleteConfirmMessage(folder.name()))){this.executeAction(new DeleteFolderAction({folder:folder}),function(err){if(err){that.handleError(err)}})}that.sidebar.autoClosingEnabled(false);that.sidebar.mouseOver(false);setTimeout(function(){that.sidebar.autoClosingEnabled(true)},1000)};FolderListView.prototype.showErrorMessage=function(message){this.editing.errorMessage(message);this.editing.showError(true)};function getNameError(name,folder){if(folder.id()==='INBOX'){return false}var siblings=folder.parent().children();function isDuplicate(){return siblings.some(function(child){return name===child.name()&&child!==folder})}if(name.length>200){return TR('mail.FolderNameTooLong','Folder names must be 200 characters or less.')}else if(name.match(/^~/)){return TR('mail.FolderNameCantStartWithTilde','Folder names starting with the character tilde (~) are not allowed.')}else if(name.match(/[.\/]/)){return TR('mail.InvalidFolderName','Full stops and slashes are not allowed in folder names.')}else if(name.trim()===''){return TR('mail.EmptyFolderNameNotAllowed','Empty folder names are not allowed.')}else if(isDuplicate()){return TR('mail.FolderAlreadyExists','A folder with this name already exists.')}else{return false}}FolderListView.prototype.validateName=function(){var newName=this.editing.name();var folder=this.editing.folder();var errorMessage=getNameError(newName,folder);if(errorMessage){this.showErrorMessage(errorMessage)}else{this.editing.showError(false)}};FolderListView.prototype.commitEdit=function(){var that=this;var folder=this.editing.folder();var oldName=folder.name().trim();var newName=this.editing.name().trim();this.editing.name(newName);this.validateName();if(!this.editing.showError()){if(folder.isNew()){folder.name(newName);this.executeAction(new CreateFolderAction({folder:folder}),function(err){if(err){that.handleError(err)}else{that.selected(folder)}})}else{if(folder&&oldName!==newName){this.executeAction(new MoveFolderAction({newName:newName,folder:folder}),function(err){if(err){that.handleError(err)}})}}this.editing.folder(null);this.shouldInputBeOpened(true);if(this.addByPlusIcon===true){this.createCustomFolder()}}else{this.editing.errorMessage();this.shouldInputBeOpened(false)}};FolderListView.prototype.cancelEdit=function(){var folder=this.editing.folder(),parent=folder.parent();if(folder.isNew()){if(parent){folder.remove()}else{this.state.folders.inbox.children.remove(folder)}}this.editing.showError(false);this.editing.folder(null);this.shouldInputBeOpened(true)};FolderListView.prototype.onRenameBlur=function(folder,e){if(this.editing.showError()){this.cancelEdit();this.shouldInputBeOpened(true)}else{this.validateName();if(!this.editing.showError()){this.addByPlusIcon=false;this.commitEdit()}else{setTimeout(function(){e.target.focus()},1)}}};FolderListView.prototype.setupFolderList=function(element){var that=this;var $element=$(element);var folderScrollPane=new ScrollPane($('.one-sidebar--list'));function scrollSelectedIntoView(){var selected=$('.active',$element);if(selected.length>0){folderScrollPane.scrollIntoView(selected)}}this.selection.subscribe(scrollSelectedIntoView);$element.on('mousedown','.folder-toggle',function(e){if(e.which===1){var folder=ko.dataFor(this);tracking.track('navigation','collapse/expand folder');folder.toggleCollapsed();e.stopPropagation();return false}});$element.on('mousedown','.one-sidebar--list-item',function(e){if(e.which===1){tracking.track('navigation','select folder');var folder=ko.dataFor(this);if(folder.selected()){if(that.folder()===folder){that.refreshFolders(false);var composerOptions=util.pick(that.childView.getOptions(),['composer','folder']);var mailUid=that.layout.isStackView()?null:that.childView.getMailUID();that.pageNavigator.show(folder.id(),1,mailUid,composerOptions)}else{that.pageNavigator.show(folder.id(),1)}}}})};FolderListView.prototype.toggleSideBar=function(){var sideBarVissible=this.layout.sidebar.show();this.layout.sidebar.show(!sideBarVissible)};FolderListView.prototype.showSidebar=function(){this.layout.sidebar.show(true)};FolderListView.prototype.hideSidebar=function(){this.layout.sidebar.show(false)};FolderListView.prototype.setupTouchFolderList=function(element){var that=this;$(element).on('mouseup','li',function(e){if(e.which===1){tracking.track('navigation (touch)','select folder');that.hideSidebar()}})};FolderListView.prototype.createSubfolder=function(folder){var newFolder=new Folder({name:'',isNew:true},folder);folder.collapsed(false);folder.children.unshift(newFolder);this.renameFolder(newFolder)};FolderListView.prototype.createCustomFolder=function(){if(this.shouldInputBeOpened()){this.createSubfolder(this.state.folders.inbox);this.shouldInputBeOpened(false)}else{this.addByPlusIcon=true;this.commitEdit()}};FolderListView.prototype.dropMails=function(mails,destination){var that=this;tracking.track('action','move mails','drag and drop');if(mails[0].folder().id()!==destination.id()){this.executeAction(new MoveMailsAction({mails:mails,destination:destination}),function(err){if(err){that.handleError(err)}})}};FolderListView.prototype.dropFolder=function(folder,destination){var that=this;tracking.track('action','drop folder');this.executeAction(new MoveFolderAction({folder:folder,destination:destination}),function(err){if(err){that.handleError(err)}})};FolderListView.prototype.dropOnFolder=function(payload,destination){var editFolderFail=getNameError(destination.name(),destination);if(editFolderFail){return false}if(payload.mail){if(payload.selection.length===0){payload.selection=[payload.mail]}this.dropMails(payload.selection,destination)}else if(payload.folder){this.dropFolder(payload.folder,destination)}};var folderBeingDragged;var dragOverTimers={};function startDragoverTimer(folder){clearTimeout(dragOverTimers[folder.id()]);dragOverTimers[folder.id()]=setTimeout(function(){folder.collapsed(false)},700)}FolderListView.prototype.dragMailEnter=function(e,data,folder){if(data.mail.folder().id()===folder.id()){return false}if(folder.hidden()){return false}startDragoverTimer(folder);return true};FolderListView.prototype.dragEnterElement=function(e,data,folder){if(data.folder){return this.dragEnter(e,data,folder)}else{return this.dragMailEnter(e,data,folder)}};FolderListView.prototype.dragLeaveElement=function(e,folder){clearTimeout(dragOverTimers[folder.id()]);return false};FolderListView.prototype.dragEnter=function(e,data,folder){if(!folderBeingDragged&&folder.isInbox()){return true}if(folder.isInbox()){return false}if(folder.hidden()){return false}startDragoverTimer(folder);if(!folderBeingDragged){return true}if(folderBeingDragged===folder){return false}var parent=folderBeingDragged.parent();if(parent&&parent===folder){return false}var hasEnteredChildFolder=folderBeingDragged.allChildren().some(function(child){return folder===child});return!hasEnteredChildFolder};FolderListView.prototype.dragStart=function(data){var folder=data.folder;var editFolderFail=getNameError(folder.name(),folder);if(folder.isSystemFolder()||editFolderFail){return false}this.sidebar.autoClosingEnabled(false);folderBeingDragged=folder;folder.allChildren().concat(folder).forEach(function(child){child.dragging(true)})};FolderListView.prototype.dragEnd=function(data){var folder=data.folder;folderBeingDragged=null;folder.allChildren().concat(folder).forEach(function(child){child.dragging(false)});this.sidebar.autoClosingEnabled(true)};FolderListView.prototype.dragEnterOnInbox=function(e,data){var folder=data.folder;if(!folder.parent()||folder.parent().isInbox()){return false}return true};var closeSidebarWhenLeaving=false;FolderListView.prototype.onMenuOpen=function(){closeSidebarWhenLeaving=this.sidebar.closeWhenLeaving();this.sidebar.closeWhenLeaving(false)};FolderListView.prototype.onMenuClose=function(){this.sidebar.closeWhenLeaving(closeSidebarWhenLeaving);this.sidebar.enter()};FolderListView.prototype.dropOnInbox=function(data){var folder=data.folder;this.dropFolder(folder,this.state.folders.inbox||null)};FolderListView.prototype.ignoreDrop={name:'folder',drop:function(){}};FolderListView.prototype.emptyFolder=function(folder){var that=this;var children=folder.children().map(function(child){return child.translatedName()});var confirmed,subfolders;var confirmationMessage=TR('mail.EmptyTrashConfirmation','Are you sure you want to empty the trash folder?');if(children.length>0){subfolders=inter.trQuantity(TR('mail.EmptyTrashPermanentlyRemoveSubfolders',{one:'This will permanently delete all mails in the folder and delete this subfolder:',other:'This will permanently delete all mails in the folder and delete these {0} subfolders:'}),children.length);if(folder.collapsed()){folder.collapsed(false)}confirmed=window.confirm(confirmationMessage+'\n'+subfolders+'\n\n'+inter.renderList(children))}else{subfolders=TR('mail.EmptyTrashPermanentlyRemove','This will permanently delete all mails in the folder.');confirmed=window.confirm(confirmationMessage+'\n'+subfolders)}if(confirmed){that.executeAction(new EmptyFolderAction({folder:folder}),function(err){if(err){that.handleError(err)}})}};return FolderListView})}());(function(){var define=System.amdDefine;(function(window,undefined){'use strict';var Hammer=function(element,options){return new Hammer.Instance(element,options||{})};Hammer.VERSION='1.0.11';Hammer.defaults={stop_browser_behavior:{userSelect:'none',touchAction:'pan-y',touchCallout:'none',contentZooming:'none',userDrag:'none',tapHighlightColor:'rgba(0,0,0,0)'}};Hammer.HAS_POINTEREVENTS=window.navigator.pointerEnabled||window.navigator.msPointerEnabled;Hammer.HAS_TOUCHEVENTS='ontouchstart'in window;Hammer.MOBILE_REGEX=/mobile|tablet|ip(ad|hone|od)|android|silk/i;Hammer.NO_MOUSEEVENTS=Hammer.HAS_TOUCHEVENTS&&window.navigator.userAgent.match(Hammer.MOBILE_REGEX);Hammer.EVENT_TYPES={};Hammer.UPDATE_VELOCITY_INTERVAL=16;Hammer.DOCUMENT=window.document;var DIRECTION_DOWN=Hammer.DIRECTION_DOWN='down';var DIRECTION_LEFT=Hammer.DIRECTION_LEFT='left';var DIRECTION_UP=Hammer.DIRECTION_UP='up';var DIRECTION_RIGHT=Hammer.DIRECTION_RIGHT='right';var POINTER_MOUSE=Hammer.POINTER_MOUSE='mouse';var POINTER_TOUCH=Hammer.POINTER_TOUCH='touch';var POINTER_PEN=Hammer.POINTER_PEN='pen';var EVENT_START=Hammer.EVENT_START='start';var EVENT_MOVE=Hammer.EVENT_MOVE='move';var EVENT_END=Hammer.EVENT_END='end';Hammer.plugins=Hammer.plugins||{};Hammer.gestures=Hammer.gestures||{};Hammer.READY=false;function setup(){if(Hammer.READY){return}Event.determineEventTypes();Utils.each(Hammer.gestures,function(gesture){Detection.register(gesture)});Event.onTouch(Hammer.DOCUMENT,EVENT_MOVE,Detection.detect);Event.onTouch(Hammer.DOCUMENT,EVENT_END,Detection.detect);Hammer.READY=true}var Utils=Hammer.utils={extend:function extend(dest,src,merge){for(var key in src){if(dest[key]!==undefined&&merge){continue}dest[key]=src[key]}return dest},each:function each(obj,iterator,context){var i,o;if('forEach'in obj){obj.forEach(iterator,context)}else if(obj.length!==undefined){for(i=-1;o=obj[++i];){if(iterator.call(context,o,i,obj)===false){return}}}else{for(i in obj){if(obj.hasOwnProperty(i)&&iterator.call(context,obj[i],i,obj)===false){return}}}},inStr:function inStr(src,needle){return src.indexOf(needle)>-1},hasParent:function hasParent(node,parent){while(node){if(node==parent){return true}node=node.parentNode}return false},getCenter:function getCenter(touches){var pageX=[],pageY=[],clientX=[],clientY=[],min=Math.min,max=Math.max;if(touches.length===1){return{pageX:touches[0].pageX,pageY:touches[0].pageY,clientX:touches[0].clientX,clientY:touches[0].clientY}}Utils.each(touches,function(touch){pageX.push(touch.pageX);pageY.push(touch.pageY);clientX.push(touch.clientX);clientY.push(touch.clientY)});return{pageX:(min.apply(Math,pageX)+max.apply(Math,pageX))/2,pageY:(min.apply(Math,pageY)+max.apply(Math,pageY))/2,clientX:(min.apply(Math,clientX)+max.apply(Math,clientX))/2,clientY:(min.apply(Math,clientY)+max.apply(Math,clientY))/2}},getVelocity:function getVelocity(delta_time,delta_x,delta_y){return{x:Math.abs(delta_x/delta_time)||0,y:Math.abs(delta_y/delta_time)||0}},getAngle:function getAngle(touch1,touch2){var x=touch2.clientX-touch1.clientX,y=touch2.clientY-touch1.clientY;return Math.atan2(y,x)*180/Math.PI},getDirection:function getDirection(touch1,touch2){var x=Math.abs(touch1.clientX-touch2.clientX),y=Math.abs(touch1.clientY-touch2.clientY);if(x>=y){return touch1.clientX-touch2.clientX>0?DIRECTION_LEFT:DIRECTION_RIGHT}return touch1.clientY-touch2.clientY>0?DIRECTION_UP:DIRECTION_DOWN},getDistance:function getDistance(touch1,touch2){var x=touch2.clientX-touch1.clientX,y=touch2.clientY-touch1.clientY;return Math.sqrt(x*x+y*y)},getScale:function getScale(start,end){if(start.length>=2&&end.length>=2){return this.getDistance(end[0],end[1])/this.getDistance(start[0],start[1])}return 1},getRotation:function getRotation(start,end){if(start.length>=2&&end.length>=2){return this.getAngle(end[1],end[0])-this.getAngle(start[1],start[0])}return 0},isVertical:function isVertical(direction){return direction==DIRECTION_UP||direction==DIRECTION_DOWN},toggleDefaultBehavior:function toggleDefaultBehavior(element,css_props,toggle){if(!css_props||!element||!element.style){return}Utils.each(['webkit','moz','Moz','ms','o',''],function setStyle(vendor){Utils.each(css_props,function(value,prop){if(vendor){prop=vendor+prop.substring(0,1).toUpperCase()+prop.substring(1)}if(prop in element.style){element.style[prop]=!toggle&&value}})});var false_fn=function(){return false};if(css_props.userSelect=='none'){element.onselectstart=!toggle&&false_fn}if(css_props.userDrag=='none'){element.ondragstart=!toggle&&false_fn}}};Hammer.Instance=function(element,options){var self=this;setup();this.element=element;this.enabled=true;this.options=Utils.extend(Utils.extend({},Hammer.defaults),options||{});if(this.options.stop_browser_behavior){Utils.toggleDefaultBehavior(this.element,this.options.stop_browser_behavior,false)}this.eventStartHandler=Event.onTouch(element,EVENT_START,function(ev){if(self.enabled){Detection.startDetect(self,ev)}});this.eventHandlers=[];return this};Hammer.Instance.prototype={on:function onEvent(gesture,handler){var gestures=gesture.split(' ');Utils.each(gestures,function(gesture){this.element.addEventListener(gesture,handler,false);this.eventHandlers.push({gesture:gesture,handler:handler})},this);return this},off:function offEvent(gesture,handler){var gestures=gesture.split(' '),i,eh;Utils.each(gestures,function(gesture){this.element.removeEventListener(gesture,handler,false);for(i=-1;eh=this.eventHandlers[++i];){if(eh.gesture===gesture&&eh.handler===handler){this.eventHandlers.splice(i,1)}}},this);return this},trigger:function triggerEvent(gesture,eventData){if(!eventData){eventData={}}var event=Hammer.DOCUMENT.createEvent('Event');event.initEvent(gesture,true,true);event.gesture=eventData;var element=this.element;if(Utils.hasParent(eventData.target,element)){element=eventData.target}element.dispatchEvent(event);return this},enable:function enable(state){this.enabled=state;return this},dispose:function dispose(){var i,eh;if(this.options.stop_browser_behavior){Utils.toggleDefaultBehavior(this.element,this.options.stop_browser_behavior,true)}for(i=-1;eh=this.eventHandlers[++i];){this.element.removeEventListener(eh.gesture,eh.handler,false)}this.eventHandlers=[];Event.unbindDom(this.element,Hammer.EVENT_TYPES[EVENT_START],this.eventStartHandler);return null}};var last_move_event=null;var should_detect=false;var touch_triggered=false;var Event=Hammer.event={bindDom:function(element,type,handler){var types=type.split(' ');Utils.each(types,function(type){element.addEventListener(type,handler,false)})},unbindDom:function(element,type,handler){var types=type.split(' ');Utils.each(types,function(type){element.removeEventListener(type,handler,false)})},onTouch:function onTouch(element,eventType,handler){var self=this;var bindDomOnTouch=function bindDomOnTouch(ev){var srcEventType=ev.type.toLowerCase();if(Utils.inStr(srcEventType,'mouse')&&touch_triggered){return}else if(Utils.inStr(srcEventType,'touch')||Utils.inStr(srcEventType,'pointerdown')||Utils.inStr(srcEventType,'mouse')&&ev.which===1){should_detect=true}else if(Utils.inStr(srcEventType,'mouse')&&!ev.which){should_detect=false}if(Utils.inStr(srcEventType,'touch')||Utils.inStr(srcEventType,'pointer')){touch_triggered=true}var count_touches=0;if(should_detect){if(Hammer.HAS_POINTEREVENTS&&eventType!=EVENT_END){count_touches=PointerEvent.updatePointer(eventType,ev)}else if(Utils.inStr(srcEventType,'touch')){count_touches=ev.touches.length}else if(!touch_triggered){count_touches=Utils.inStr(srcEventType,'up')?0:1}if(count_touches>0&&eventType==EVENT_END){eventType=EVENT_MOVE}else if(!count_touches){eventType=EVENT_END}if(count_touches||last_move_event===null){last_move_event=ev}handler.call(Detection,self.collectEventData(element,eventType,self.getTouchList(last_move_event,eventType),ev));if(Hammer.HAS_POINTEREVENTS&&eventType==EVENT_END){count_touches=PointerEvent.updatePointer(eventType,ev)}}if(!count_touches){last_move_event=null;should_detect=false;touch_triggered=false;PointerEvent.reset()}};this.bindDom(element,Hammer.EVENT_TYPES[eventType],bindDomOnTouch);return bindDomOnTouch},determineEventTypes:function determineEventTypes(){var types;if(Hammer.HAS_POINTEREVENTS){types=PointerEvent.getEvents()}else if(Hammer.NO_MOUSEEVENTS){types=['touchstart','touchmove','touchend touchcancel']}else{types=['touchstart mousedown','touchmove mousemove','touchend touchcancel mouseup']}Hammer.EVENT_TYPES[EVENT_START]=types[0];Hammer.EVENT_TYPES[EVENT_MOVE]=types[1];Hammer.EVENT_TYPES[EVENT_END]=types[2]},getTouchList:function getTouchList(ev){if(Hammer.HAS_POINTEREVENTS){return PointerEvent.getTouchList()}if(ev.touches){return ev.touches}ev.identifier=1;return[ev]},collectEventData:function collectEventData(element,eventType,touches,ev){var pointerType=POINTER_TOUCH;if(Utils.inStr(ev.type,'mouse')||PointerEvent.matchType(POINTER_MOUSE,ev)){pointerType=POINTER_MOUSE}return{center:Utils.getCenter(touches),timeStamp:Date.now(),target:ev.target,touches:touches,eventType:eventType,pointerType:pointerType,srcEvent:ev,preventDefault:function(){var srcEvent=this.srcEvent;srcEvent.preventManipulation&&srcEvent.preventManipulation();srcEvent.preventDefault&&srcEvent.preventDefault()},stopPropagation:function(){this.srcEvent.stopPropagation()},stopDetect:function(){return Detection.stopDetect()}}}};var PointerEvent=Hammer.PointerEvent={pointers:{},getTouchList:function getTouchList(){var touchlist=[];Utils.each(this.pointers,function(pointer){touchlist.push(pointer)});return touchlist},updatePointer:function updatePointer(type,pointerEvent){if(type==EVENT_END){delete this.pointers[pointerEvent.pointerId]}else{pointerEvent.identifier=pointerEvent.pointerId;this.pointers[pointerEvent.pointerId]=pointerEvent}return Object.keys(this.pointers).length},matchType:function matchType(pointerType,ev){if(!ev.pointerType){return false}var pt=ev.pointerType,types={};types[POINTER_MOUSE]=pt===POINTER_MOUSE;types[POINTER_TOUCH]=pt===POINTER_TOUCH;types[POINTER_PEN]=pt===POINTER_PEN;return types[pointerType]},getEvents:function getEvents(){return['pointerdown MSPointerDown','pointermove MSPointerMove','pointerup pointercancel MSPointerUp MSPointerCancel']},reset:function resetList(){this.pointers={}}};var Detection=Hammer.detection={gestures:[],current:null,previous:null,stopped:false,startDetect:function startDetect(inst,eventData){if(this.current){return}this.stopped=false;this.current={inst:inst,startEvent:Utils.extend({},eventData),lastEvent:false,lastVelocityEvent:false,velocity:false,name:''};this.detect(eventData)},detect:function detect(eventData){if(!this.current||this.stopped){return}eventData=this.extendEventData(eventData);var inst=this.current.inst,inst_options=inst.options;Utils.each(this.gestures,function triggerGesture(gesture){if(!this.stopped&&inst_options[gesture.name]!==false&&inst.enabled!==false){if(gesture.handler.call(gesture,eventData,inst)===false){this.stopDetect();return false}}},this);if(this.current){this.current.lastEvent=eventData}if(eventData.eventType==EVENT_END&&!eventData.touches.length-1){this.stopDetect()}return eventData},stopDetect:function stopDetect(){this.previous=Utils.extend({},this.current);this.current=null;this.stopped=true},getVelocityData:function getVelocityData(ev,delta_time,delta_x,delta_y){var cur=this.current,velocityEv=cur.lastVelocityEvent,velocity=cur.velocity;if(velocityEv&&ev.timeStamp-velocityEv.timeStamp>Hammer.UPDATE_VELOCITY_INTERVAL){velocity=Utils.getVelocity(ev.timeStamp-velocityEv.timeStamp,ev.center.clientX-velocityEv.center.clientX,ev.center.clientY-velocityEv.center.clientY);cur.lastVelocityEvent=ev}else if(!cur.velocity){velocity=Utils.getVelocity(delta_time,delta_x,delta_y);cur.lastVelocityEvent=ev}cur.velocity=velocity;ev.velocityX=velocity.x;ev.velocityY=velocity.y},getInterimData:function getInterimData(ev){var lastEvent=this.current.lastEvent,angle,direction;if(ev.eventType==EVENT_END){angle=lastEvent&&lastEvent.interimAngle;direction=lastEvent&&lastEvent.interimDirection}else{angle=lastEvent&&Utils.getAngle(lastEvent.center,ev.center);direction=lastEvent&&Utils.getDirection(lastEvent.center,ev.center)}ev.interimAngle=angle;ev.interimDirection=direction},extendEventData:function extendEventData(ev){var cur=this.current,startEv=cur.startEvent;if(ev.touches.length!=startEv.touches.length||ev.touches===startEv.touches){startEv.touches=[];Utils.each(ev.touches,function(touch){startEv.touches.push(Utils.extend({},touch))})}var delta_time=ev.timeStamp-startEv.timeStamp,delta_x=ev.center.clientX-startEv.center.clientX,delta_y=ev.center.clientY-startEv.center.clientY;this.getVelocityData(ev,delta_time,delta_x,delta_y);this.getInterimData(ev);Utils.extend(ev,{startEvent:startEv,deltaTime:delta_time,deltaX:delta_x,deltaY:delta_y,distance:Utils.getDistance(startEv.center,ev.center),angle:Utils.getAngle(startEv.center,ev.center),direction:Utils.getDirection(startEv.center,ev.center),scale:Utils.getScale(startEv.touches,ev.touches),rotation:Utils.getRotation(startEv.touches,ev.touches)});return ev},register:function register(gesture){var options=gesture.defaults||{};if(options[gesture.name]===undefined){options[gesture.name]=true}Utils.extend(Hammer.defaults,options,true);gesture.index=gesture.index||1000;this.gestures.push(gesture);this.gestures.sort(function(a,b){if(a.index<b.index){return-1}if(a.index>b.index){return 1}return 0});return this.gestures}};Hammer.gestures.Drag={name:'drag',index:50,defaults:{drag_min_distance:10,correct_for_drag_min_distance:true,drag_max_touches:1,drag_block_horizontal:false,drag_block_vertical:false,drag_lock_to_axis:false,drag_lock_min_distance:25},triggered:false,handler:function dragGesture(ev,inst){var cur=Detection.current;if(cur.name!=this.name&&this.triggered){inst.trigger(this.name+'end',ev);this.triggered=false;return}if(inst.options.drag_max_touches>0&&ev.touches.length>inst.options.drag_max_touches){return}switch(ev.eventType){case EVENT_START:this.triggered=false;break;case EVENT_MOVE:if(ev.distance<inst.options.drag_min_distance&&cur.name!=this.name){return}var startCenter=cur.startEvent.center;if(cur.name!=this.name){cur.name=this.name;if(inst.options.correct_for_drag_min_distance&&ev.distance>0){var factor=Math.abs(inst.options.drag_min_distance/ev.distance);startCenter.pageX+=ev.deltaX*factor;startCenter.pageY+=ev.deltaY*factor;startCenter.clientX+=ev.deltaX*factor;startCenter.clientY+=ev.deltaY*factor;ev=Detection.extendEventData(ev)}}if(cur.lastEvent.drag_locked_to_axis||inst.options.drag_lock_to_axis&&inst.options.drag_lock_min_distance<=ev.distance){ev.drag_locked_to_axis=true}var last_direction=cur.lastEvent.direction;if(ev.drag_locked_to_axis&&last_direction!==ev.direction){if(Utils.isVertical(last_direction)){ev.direction=ev.deltaY<0?DIRECTION_UP:DIRECTION_DOWN}else{ev.direction=ev.deltaX<0?DIRECTION_LEFT:DIRECTION_RIGHT}}if(!this.triggered){inst.trigger(this.name+'start',ev);this.triggered=true}inst.trigger(this.name,ev);inst.trigger(this.name+ev.direction,ev);var is_vertical=Utils.isVertical(ev.direction);if(inst.options.drag_block_vertical&&is_vertical||inst.options.drag_block_horizontal&&!is_vertical){ev.preventDefault()}break;case EVENT_END:if(this.triggered){inst.trigger(this.name+'end',ev)}this.triggered=false;break}}};Hammer.gestures.Hold={name:'hold',index:10,defaults:{hold_timeout:500,hold_threshold:2},timer:null,handler:function holdGesture(ev,inst){switch(ev.eventType){case EVENT_START:clearTimeout(this.timer);Detection.current.name=this.name;this.timer=setTimeout(function(){if(Detection.current.name=='hold'){inst.trigger('hold',ev)}},inst.options.hold_timeout);break;case EVENT_MOVE:if(ev.distance>inst.options.hold_threshold){clearTimeout(this.timer)}break;case EVENT_END:clearTimeout(this.timer);break}}};Hammer.gestures.Release={name:'release',index:Infinity,handler:function releaseGesture(ev,inst){if(ev.eventType==EVENT_END){inst.trigger(this.name,ev)}}};Hammer.gestures.Swipe={name:'swipe',index:40,defaults:{swipe_min_touches:1,swipe_max_touches:1,swipe_velocity:0.7},handler:function swipeGesture(ev,inst){if(ev.eventType==EVENT_END){if(ev.touches.length<inst.options.swipe_min_touches||ev.touches.length>inst.options.swipe_max_touches){return}if(ev.velocityX>inst.options.swipe_velocity||ev.velocityY>inst.options.swipe_velocity){inst.trigger(this.name,ev);inst.trigger(this.name+ev.direction,ev)}}}};Hammer.gestures.Tap={name:'tap',index:100,defaults:{tap_max_touchtime:250,tap_max_distance:10,tap_always:true,doubletap_distance:20,doubletap_interval:300},has_moved:false,handler:function tapGesture(ev,inst){var prev,since_prev,did_doubletap;if(ev.eventType==EVENT_START){this.has_moved=false}else if(ev.eventType==EVENT_MOVE&&!this.moved){this.has_moved=ev.distance>inst.options.tap_max_distance}else if(ev.eventType==EVENT_END&&ev.srcEvent.type!='touchcancel'&&ev.deltaTime<inst.options.tap_max_touchtime&&!this.has_moved){prev=Detection.previous;since_prev=prev&&prev.lastEvent&&ev.timeStamp-prev.lastEvent.timeStamp;did_doubletap=false;if(prev&&prev.name=='tap'&&(since_prev&&since_prev<inst.options.doubletap_interval)&&ev.distance<inst.options.doubletap_distance){inst.trigger('doubletap',ev);did_doubletap=true}if(!did_doubletap||inst.options.tap_always){Detection.current.name='tap';inst.trigger(Detection.current.name,ev)}}}};Hammer.gestures.Touch={name:'touch',index:-Infinity,defaults:{prevent_default:false,prevent_mouseevents:false},handler:function touchGesture(ev,inst){if(inst.options.prevent_mouseevents&&ev.pointerType==POINTER_MOUSE){ev.stopDetect();return}if(inst.options.prevent_default){ev.preventDefault()}if(ev.eventType==EVENT_START){inst.trigger(this.name,ev)}}};Hammer.gestures.Transform={name:'transform',index:45,defaults:{transform_min_scale:0.01,transform_min_rotation:1,transform_always_block:false,transform_within_instance:false},triggered:false,handler:function transformGesture(ev,inst){if(Detection.current.name!=this.name&&this.triggered){inst.trigger(this.name+'end',ev);this.triggered=false;return}if(ev.touches.length<2){return}if(inst.options.transform_always_block){ev.preventDefault()}if(inst.options.transform_within_instance){for(var i=-1;ev.touches[++i];){if(!Utils.hasParent(ev.touches[i].target,inst.element)){return}}}switch(ev.eventType){case EVENT_START:this.triggered=false;break;case EVENT_MOVE:var scale_threshold=Math.abs(1-ev.scale);var rotation_threshold=Math.abs(ev.rotation);if(scale_threshold<inst.options.transform_min_scale&&rotation_threshold<inst.options.transform_min_rotation){return}Detection.current.name=this.name;if(!this.triggered){inst.trigger(this.name+'start',ev);this.triggered=true}inst.trigger(this.name,ev);if(rotation_threshold>inst.options.transform_min_rotation){inst.trigger('rotate',ev)}if(scale_threshold>inst.options.transform_min_scale){inst.trigger('pinch',ev);inst.trigger('pinch'+(ev.scale<1?'in':'out'),ev)}break;case EVENT_END:if(this.triggered){inst.trigger(this.name+'end',ev)}this.triggered=false;break}}};if(typeof define=='function'&&define.amd){define('3rdparty/hammer.js',[],function(){return Hammer})}else if(typeof module=='object'&&module.exports){module.exports=Hammer}else{window.Hammer=Hammer}}(window))}());(function(){var define=System.amdDefine;(function(window,undefined){'use strict';function setupPlugin(Hammer,$){if(!Date.now){Date.now=function now(){return new Date().getTime()}}Hammer.event.bindDom=function(element,eventTypes,handler){$(element).on(eventTypes,function($ev){var data=$ev.originalEvent||$ev;var props=['pageX','pageY','clientX','clientY','target','preventDefault','stopPropagation'];Hammer.utils.each(props,function(prop){if(data[prop]==null){data[prop]=$ev[prop]}});if(data.which===undefined){data.which=data.button}handler.call(this,data)})};Hammer.utils.each(['on','off'],function(method){Hammer.Instance.prototype[method]=function(types,handler){return $(this.element)[method](types,handler)}});Hammer.Instance.prototype.trigger=function(gesture,eventData){var el=$(this.element);if(el.has(eventData.target).length){el=$(eventData.target)}return el.trigger({type:gesture,gesture:eventData})};$.fn.hammer=function(options){return this.each(function(){var el=$(this);var inst=el.data('hammer');if(!inst){el.data('hammer',new Hammer(this,options||{}))}else if(inst&&options){Hammer.utils.extend(inst.options,options)}})}}if(typeof define=='function'&&define.amd){define('3rdparty/jquery.hammer.js',['3rdparty/hammer.js','node_modules/jquery/dist/jquery.js'],setupPlugin)}else{setupPlugin(window.Hammer,window.jQuery||window.Zepto)}}(window))}());(function(){var define=System.amdDefine;define('webmail/Zoom.js',['node_modules/jquery/dist/jquery.js','3rdparty/jquery.hammer.js'],function($,Hammer){function Zoom($scrollable){var that=this;this.$scrollable=$scrollable;this.$container=$('.zoomContainer',$scrollable);this.$wrap=$('.zoomWrap',$scrollable);this.$header=$('.zoomHeader',$scrollable);this.$footer=$('.zoomFooter',$scrollable);this.$zoomContent=$('.zoomContent',$scrollable);this.scrollable=this.$scrollable.get(0);this.container=this.$container.get(0);this.zoomContent=this.$zoomContent.get(0);this.zoomTarget=$('.mailFrame',$scrollable).get(0);this.minimumScale=1;this.maximumScale=2;this.state={translate:{x:0,y:0},origin:{x:0,y:0},scale:1,lastScale:1,pinching:false};this.updateHeaderAndFooterDimensions=function(){that.headerHeight=that.$header.height();that.headerWidth=that.$header.width();that.footerHeight=that.$footer.height();that.footerWidth=that.$footer.width()};this.updateHeaderAndFooterDimensions();this.$scrollable.css({overflow:'auto'});this.$zoomContent.css({overflow:'visible'});this.$scrollable.hammer({prevent_default:false,stop_browser_behavior:false,transform_always_block:false});this.render(true);this.$header.css({'transform-origin-x':0,'transform-origin-y':'100%','transform-style':'preserve-3d'});this.$footer.css({'transform-origin-x':0,'transform-origin-y':0,'transform-style':'preserve-3d'});this.$container.css({'transform-origin-x':0,'transform-origin-y':0,'transform-style':'preserve-3d'});this.$zoomContent.css({'transform-origin-x':0,'transform-origin-y':0,'transform-style':'preserve-3d'});this.$container.css({'position':'absolute'});this.$wrap.css({'position':'relative','overflow':'visible','transform':'translate3d(0, 0, 0)'});this.scrollablePaddingLeft=this.container.getBoundingClientRect().left-this.scrollable.getBoundingClientRect().left}Zoom.prototype.toFit=function(){return Math.min(1.5,this.$scrollable.width()/this.$zoomContent.outerWidth())};Zoom.prototype.adjustDimensionsOfContainer=function(lockZoomContentWidth){var emptySpaceBeforeHeader=this.headerHeight*this.state.scale-this.headerHeight,emptySpaceAfterFooter=this.footerHeight*this.state.scale-this.footerHeight;this.$wrap.height(this.container.getBoundingClientRect().height-emptySpaceBeforeHeader-emptySpaceAfterFooter);this.$wrap.width(Math.max(this.zoomTarget.getBoundingClientRect().width,this.headerWidth));if(lockZoomContentWidth){this.$zoomContent.width(this.$zoomContent.width())}};Zoom.prototype.afterLoad=function(setupHandlers){var that=this;that.minimumScale=that.toFit();var images=$('img',this.$container);images.load(function(){that.adjustDimensionsOfContainer(true);if(!this.hasAttribute('width')){that.$zoomContent.css('width','auto');that.minimumScale=that.toFit();that.scale(that.minimumScale).transformEnd(null,true)}});that.scale(that.minimumScale).transformEnd(function(){that.$wrap.css('overflow','hidden');that.headerWidth=that.zoomContent.getBoundingClientRect().width;that.$header.width(that.headerWidth);if(setupHandlers){that.setupHandlers()}},true);that.adjustDimensionsOfContainer(true)};Zoom.prototype.setupHandlers=function(){var that=this,initScale;that.$scrollable.on('touchstart',function(e){if(e.originalEvent.touches.length>1){e.preventDefault()}}).on('doubletap',function(e){window.getSelection().removeAllRanges();that.state.origin=that.getCoordinates(e.gesture.center);if(Math.abs(that.minimumScale-that.state.scale)<0.1){that.scale(1).render(true).transformEnd()}else{that.scale(that.minimumScale).render(true).transformEnd()}e.preventDefault();return false}).on('transformstart',function(e){that.$scrollable.on('selectstart.zoom',false);e.preventDefault();that.$wrap.css('user-select','none');window.getSelection().removeAllRanges()}).on('pinch',function(e){if(!that.state.pinching){that.state.pinching=true;initScale=that.state.scale;that.state.origin=that.getCoordinates(e.gesture.center);that.$wrap.css('overflow','visible')}var scale=initScale*e.gesture.scale;that.scale(scale).render();e.preventDefault();e.gesture.preventDefault()}).on('transformend',function(e){that.transformEnd(function(){that.state.pinching=false;that.$scrollable.off('selectstart.zoom');that.$wrap.css('user-select','')})});$(window).on('orientationchange',function(){that.afterLoad();that.transformEnd()})};Zoom.prototype.transformEnd=function(cb,lockZoomContentWidth){var that=this;function adjustViewport(){var emptySpaceAboveHeader=that.headerHeight*that.state.scale-that.headerHeight;var offsets=that.container.getBoundingClientRect();offsets={top:offsets.top*-1-emptySpaceAboveHeader,left:offsets.left*-1};that.state.translate={x:0,y:emptySpaceAboveHeader*-1};that.render(true);that.adjustDimensionsOfContainer(lockZoomContentWidth);that.$wrap.css('overflow','hidden');if(!lockZoomContentWidth){that.adjustScrollBars(offsets)}if(cb){cb()}}adjustViewport()};Zoom.prototype.adjustScrollBars=function(offsets){var scrollableOffset=this.scrollable.getBoundingClientRect();this.scrollable.scrollLeft=offsets.left+scrollableOffset.left+this.scrollablePaddingLeft;this.scrollable.scrollTop=offsets.top+scrollableOffset.top};Zoom.prototype.scale=function(scale){scale=Math.max(scale,this.minimumScale);scale=Math.min(scale,this.maximumScale);var lastScale=this.state.scale;this.state.scale=scale;var scaleDifference=1-(lastScale-scale);this.state.translate={x:this.state.translate.x+(this.state.origin.x-this.state.origin.x*scaleDifference),y:this.state.translate.y+(this.state.origin.y-this.state.origin.y*scaleDifference)};return this};Zoom.prototype.render=function(render2d){var state=this.state,transform,transformContra;if(render2d){transform='translate('+state.translate.x+'px, '+state.translate.y+'px) '+'scale('+state.scale+')';transformContra='scale('+1/state.scale+')'}else{transform='translate3d('+state.translate.x+'px, '+state.translate.y+'px, 0px) '+'scale3d('+state.scale+','+state.scale+', 1)';transformContra='scale3d('+1/state.scale+', '+1/state.scale+', 1)'}this.$container.css('transform',transform);this.$header.css('transform',transformContra);this.$footer.css('transform',transformContra);return this};Zoom.prototype.getCoordinates=function(center){var boundingRect=this.container.getBoundingClientRect();return{x:(center.pageX-boundingRect.left)/this.state.scale,y:(center.pageY-boundingRect.top)/this.state.scale}};return Zoom})}());System.registerDynamic('components/truncatedList/truncatedList.ko',[],true,function($__require,exports,module){var define,global=this||self,GLOBAL=global;module.exports=function injectTemplate(tpl){var s=document.createElement('script');s.id=tpl.id;s.innerHTML=window.TR?TR.HTML(tpl.content):tpl.content;s.type='text/html';document.head.appendChild(s)}({'id':'truncatedList','content':'<!-- ko \'if\': (truncated() && hiddenCount() > 0) -->\n    <!-- ko foreach: abbreviated -->\n        <!-- ko template: $parent.template --><!-- /ko --><span data-bind="separator: $parent.abbreviated" data-i18n="">, </span>\n    <!-- /ko -->\n    <a class="showLink" data-bind="click: truncated.bind(null, false)" data-i18n="truncatedList.XMoreRecipientsParenthesized">(<span data-bind="text: hiddenCount"></span> more)</a>\n<!-- /ko -->\n<!-- ko \'ifnot\': (truncated() && hiddenCount() > 0) -->\n    <!-- ko foreach: all -->\n        <!-- ko template: $parent.template --><!-- /ko --><span data-bind="separator: $parent.all" data-i18n="">, </span>\n    <!-- /ko -->\n    <!-- ko \'if\': hiddenCount() > 0 -->\n        <a class="hideLink" data-bind="click: truncated.bind(null, true)" data-i18n="truncatedList.LessParenthesized">(less)</a>\n    <!-- /ko -->\n<!-- /ko -->\n'});return module.exports});(function(){var define=System.amdDefine;define('components/truncatedList/truncatedList.js',['node_modules/knockout/build/output/knockout-latest.debug.js','components/truncatedList/truncatedList.ko'],function(ko){ko.components.register('truncated-list',{template:{element:'truncatedList'},viewModel:function(params){this.template=params.template;var truncateAt=params.truncateAt||5;this.all=params.data;this.abbreviated=ko.pureComputed(function(){return this.all.slice(0,ko.unwrap(truncateAt))},this);this.hiddenCount=ko.pureComputed(function(){return ko.unwrap(this.all).length-this.abbreviated().length},this);if(ko.isObservable(params.truncated)){this.truncated=params.truncated}else{this.truncated=ko.observable('truncated'in params?!!params.truncated:true)}}})})}());(function(){var define=System.amdDefine;define('webmail/mailView/MailView.js',['node_modules/jquery/dist/jquery.js','node_modules/knockout/build/output/knockout-latest.debug.js','webmail/mailView/ContactCard.js','webmail/composer/Composer.js','webmail/composer/OutgoingMail.js','webmail/model/Recipient.js','common/model/Flag.js','webmail/actions/SetFlagAction.js','webmail/actions/LoadMailPartsAction.js','webmail/actions/SaveMailAction.js','webmail/actions/SendMailAction.js','common/actions/SavePreferencesAction.js','common/actions/LoadPreferencesAction.js','webmail/Zoom.js','common/util.js','common/ViewBehavior.js','common/KeyHandler.js','3rdparty/mario.js','3rdparty/onevalidation/validation.js','theme/LoadingScreen.js','3rdparty/knockout-toolbar/toolbar.js','components/truncatedList/truncatedList.js'],function($,ko,ContactCard,Composer,OutgoingMail,Recipient,Flag,SetFlagAction,LoadMailPartsAction,SaveMailAction,SendMailAction,SavePreferencesAction,LoadPreferencesAction,Zoom,util,ViewBehavior,getKeyHandler,mario,validation,LoadingScreen){var shouldZoom=mario.ios&&parseInt(mario.osversion,10)>5||mario.android&&mario.chrome;var hideAfterCharCount=60;function indexBeforeCharCount(list,charCount){var i=0;var count=0;var length=list.length;while(i<length&&count<=charCount){count+=list[i].toString().length;i+=1}return i}function MailView(options){var that=this;util.extend(that,util.pick(options,['state','layout','actionExecutor','errorHandler','parentView','mail','standalone']));ViewBehavior.installInto(that);that.mail.incrementReferences();that.from=that.mail.from;that.to=that.mail.to;that.cc=that.mail.cc;that.bcc=that.mail.bcc;that.undisclosedRecipients=that.mail.undisclosedRecipients;['to','from','cc','bcc'].forEach(function(fieldName){that[fieldName+'Truncated']=ko.observable(true)});that.truncateAt=function(items){return ko.pureComputed(function(){return that.standalone?Infinity:indexBeforeCharCount(ko.unwrap(items),hideAfterCharCount)})};that.showCcList=ko.pureComputed(function(){return that.mail.cc().length>0});that.showBccList=ko.pureComputed(function(){return that.mail.bcc().length>0});that.showExternalImagesLink=ko.pureComputed(function(){return that.mail.hasExternalImages()&&!that.mail.oneComLoadImg()});that.showExternalImagesFromLink=ko.pureComputed(function(){return that.mail.showLink()});that.showReply=ko.observable(false);that.showMark=ko.observable(false);that.starActionText=ko.pureComputed(function(){if(that.mail.flagged()){return TR('mail.RemoveStar','Remove star')}else{return TR('mail.AddStar','Add star')}});that.readActionText=ko.pureComputed(function(){if(that.mail.seen()){return TR('mail.MarkAsUnread','Mark as unread')}else{return TR('mail.MarkAsRead','Mark as read')}});that.loadMailParts=function(){that.executeAction(new LoadMailPartsAction({mail:that.mail,force:true}),function(err){if(err){that.handleError(err)}})};that.addTrustedSender=function(){var that=this,trustedSenders=that.state.preferences.trustedSenders(),fromEmail=that.mail.from()[0].getEmail();trustedSenders.sources.push(fromEmail);that.state.preferences.trustedSenders(trustedSenders);that.mail.showLink(false);that.actionExecutor.enqueue(new SavePreferencesAction({page:'trustedSenders'}),function(err){that.state.notification(null);that.errorHandler.handleError(err,{409:function(){that.actionExecutor.enqueue(new LoadPreferencesAction,function(err){that.errorHandler.handleError(err)})}})})};if(!that.mail.isLoaded()){that.loadMailParts()}that.isMaybePhishing=ko.pureComputed(function(){if(that.mail.oneComDisregardSPF()){return false}else{return/^softfail/.test(that.mail.headers&&that.mail.headers['Received-SPF'])}});that.pagePosition=ko.pureComputed(function(){return that.parentView.page()&&that.parentView.page().mails().indexOf(that.mail)});that.onShownPage=ko.pureComputed(function(){return typeof that.pagePosition()==='number'&&that.pagePosition()!==-1});that.searchPosition=ko.pureComputed(function(){return that.parentView.page()&&that.pagePosition()+that.parentView.page().firstMailIndex()});that.hasPrevious=ko.pureComputed(function(){return that.searchPosition()>1});that.hasNext=ko.pureComputed(function(){return that.parentView.search()&&that.parentView.search().length()>that.searchPosition()});var unsubKeywords=['unsubscribe','avbryta? pren','avregistrera','cancelar assinatura','anular (?:a )?subscrição','meld av nyhetsbrev','stopp abonnement','afmelden','opzeggen','annulla sottoscriz','annulla abbonamento','désabonner','annuler l\'abonnement','anular suscripcion','abbestellen','austragen','kündigen','afmelde? nyhedsbrev','ophæve? abonnement','opsige? abonnement'];var unsubscribeRegexp=new RegExp(unsubKeywords.join('|'),'i');function findUnsubscribeElement(element){var children=element.children;var i;for(i=0;i<children.length;i+=1){if(unsubscribeRegexp.test(children[i].textContent)){return findUnsubscribeElement(children[i])}}if(unsubscribeRegexp.test(element.textContent)){return element}}that.unsubscribeLink=ko.pureComputed(function(){if(!that.mail.isLoaded()||!('List-Unsubscribe'in that.mail.headers)||that.isMaybePhishing()){return null}if(that.mail.headers['List-Unsubscribe'].length!==1){return null}var listUnsubscribeOptions=that.mail.headers['List-Unsubscribe'][0].split(/, */);var listUnsubscribeLink;var listUnsubscribeMail;listUnsubscribeOptions.some(function(address){address=address.replace(/^<|>,?$/g,'');if(/^mailto:/.test(address)){listUnsubscribeMail=address}if(/^https?/.test(address)){listUnsubscribeLink=address}});if(validation.fragments.mailtoUrlIdn.test(listUnsubscribeMail)){return listUnsubscribeMail}if(validation.fragments.httpUrlIdn.test(listUnsubscribeLink)){return listUnsubscribeLink}var foundLink=searchForUnsubscribeLink(that.mail.inlineParts());if(validation.fragments.httpUrlIdn.test(foundLink)){return foundLink}});that.unsubscribeLinkType=ko.pureComputed(function(){if(/^mailto/.test(that.unsubscribeLink())){return'mail'}else if(/^http/.test(that.unsubscribeLink())){return'web'}else{return null}});function searchForUnsubscribeLink(parts){var link='';var unsubElement;parts.some(function(part){if(part.isLoaded()){var content=findUnsubscribeElement($('<div>'+part.htmlContent()+'</div>')[0]);if(content){unsubElement=$(content);return true}}return false});var find;if(!unsubElement||unsubElement.length===0){return''}if((find=unsubElement.closest('a'))&&find.length>0){link=find.attr('href')}else{var node=unsubElement[0].firstChild;var keyMatcher=unsubscribeRegexp;do{if(node.nodeName==='#text'){var text=node.textContent;if(keyMatcher.test(text)){break}}}while(node=node.nextSibling);if(node){var prevNode=node.previousSibling;var nextNode=node.nextSibling;if(nextNode&&(nextNode.nodeName==='A'||(nextNode=nextNode.querySelector('a')))){link=nextNode.href}else if(prevNode&&(prevNode.nodeName==='A'||(prevNode=prevNode.querySelector('a')))){link=prevNode.href}}}return link}function activateComposer(composer,focusTo){composer.afterInit=function(){if(focusTo){if(!(mario.version<=10&&mario.msie)){composer.toView.focusInput();if(mario.touch){var topDivContainer=document.getElementById('topLayout').scrollIntoView;if(topDivContainer){document.getElementById('topLayout').scrollIntoView()}}}}that.state.signals.composerOpened.dispatch(composer)};var list=that.parentView;var tabs=list.mailTabs;composer.saveMail({silent:true},function(){tabs.add(composer);var draft=composer.draftBeingEdited();if(list.folder().id()===draft.folder().id()){list.pageNavigator.show(list.folder().id(),list.page().index,draft.uid,list.getOptions())}else{var options=list.getOptions();options.compose=draft.uid;options.folder=draft.folder().id();list.pageNavigator.show(list.folder().id(),list.page().index,list.getMailUID(),options)}})}that.supportsResend=ko.pureComputed(function(){return that.mail.failedSending()&&that.mail.submitPending()&&that.mail.folder().isSentFolder()});that.resend=function(){that.mail.failedSaving(false);that.mail.failedSending(false);that.executeAction(new SendMailAction({mail:that.mail}),function(err){that.handleError(err)})};var toolbarButtonWidths={commonSet:{cz:592,da:512,de:653,'en_gb':501,'en_us':501,es:609,fr:630,it:551,nl:707,nb:491,pl:633,pt:648,'pt_br':613,se:547,fi:553},resend:{cz:132,da:100,de:134,'en_gb':90,'en_us':90,es:137,fr:102,it:105,nl:162,nb:121,pl:144,pt:98,'pt_br':98,se:112,fi:150},back:{cz:73,da:89,de:87,'en_gb':74,'en_us':74,es:77,fr:86,it:93,nl:80,nb:88,pl:88,pt:81,'pt_br':81,se:92,fi:87}};that.narrowToolbar=ko.pureComputed(function(){var minWidth=toolbarButtonWidths.commonSet[inter.id]||600;if(that.supportsResend()){minWidth+=toolbarButtonWidths.resend[inter.id]||100}if(that.layout.isStackView()){minWidth+=toolbarButtonWidths.back[inter.id]||80}return that.layout.dimensions.contentPanelWidth()<minWidth+100});that.reply=function(all){if(all!==true){all=false}var composer=Composer.reply(that.state,that.errorHandler,that.actionExecutor,that.mail,all);activateComposer(composer,false)};that.replyAll=function(){that.reply(true)};that.forward=function(){var composer=Composer.forward(that.state,that.errorHandler,that.actionExecutor,that.mail);activateComposer(composer,true)};MailView.prototype.toPrintDisplayString=function(data){var recipients=[],recipientsToDisplay;data.forEach(function(recipient){if(recipient.displayName&&recipient.displayEmail&&recipient.displayName!==recipient.displayEmail){recipients.push(recipient.displayName+' <'+recipient.displayEmail+'>')}else{recipients.push(recipient.displayEmail||recipient.displayName)}});recipientsToDisplay=recipients.join(', ');return recipientsToDisplay};that.printing=ko.observable(false);window.onbeforeprint=function(){that.printing(true)};window.onafterprint=function(){that.printing(false)};that.shouldOpenDownloadsInNewTab=!!mario.ios;that.backButton=ko.pureComputed(function(){if(that.layout.isStackView()){return{label:TR('mail.mailView.Back','Back'),handler:that.clearView}}else{return null}});var disableButtons=ko.computed(function(){return!that.mail.isLoaded()});that.subscriptions=[];that.mainButtons=ko.observableArray([{label:TR('mail.mailView.Reply','Reply'),icon:'reply',track:['navigation','open reply','click'],disabled:disableButtons,handler:that.reply},{label:TR('mail.mailView.ReplyAll','Reply all'),icon:'reply-all',track:['navigation','open reply all','click'],disabled:disableButtons,handler:that.replyAll},{label:TR('mail.mailView.Forward','Forward'),icon:'forward',track:['navigation','open forward','click'],disabled:disableButtons,handler:that.forward}]);var resendButton={disabled:disableButtons,handler:that.resend,track:['mail view','resend'],icon:'send',label:TR('mail.mailView.Resend','Resend')};if(that.supportsResend()){that.mainButtons.unshift(resendButton)}that.subscriptions.push(that.supportsResend.subscribe(function(stacked){if(stacked){if(that.mainButtons().length<4){that.mainButtons.unshift(resendButton)}}else{if(that.mainButtons().length>3){that.mainButtons.remove(resendButton)}}}));var startBaseMoreMenu=[{handler:that.parentView.printMail.bind(that.parentView),track:['view mail','print'],label:TR('mail.mailView.Print','Print')}];var endBaseMoreMenu=[{handler:that.parentView.viewMailSource.bind(that.parentView),track:['view mail','view source'],label:TR('mail.ViewMailSource','View email source')},{handler:that.parentView.openInNewWindow.bind(that.parentView),track:['view mail','view in new window'],label:TR('mail.OpenInNewWindow','Open in new window')},{handler:that.parentView.editMailAsNew.bind(that.parentView),track:['view mail','edit as new'],label:TR('mail.EditAsNew','Edit as new')}];that.moreMenu=ko.observableArray(startBaseMoreMenu.concat(that.parentView.moreMenu(),endBaseMoreMenu));that.subscriptions.push(that.parentView.moreMenu.subscribe(function(){that.moreMenu(startBaseMoreMenu.concat(that.parentView.moreMenu(),endBaseMoreMenu))}));that.clearView=function(){that.parentView.pageNavigator.show(that.mail.folder().id(),that.parentView.page().index,null,that.parentView.getOptions())}}MailView.registerKeys=function(){var keyhandler=getKeyHandler();keyhandler.register('mailView','tab',function(){keyhandler.focusDomain('sidebar');return false});keyhandler.register('mailView','shift+tab',function(){if(keyhandler.listDomains().indexOf('listPanel')!==-1){keyhandler.focusDomain('listPanel')}else{keyhandler.focusDomain('sidebar')}return false});keyhandler.register('mailView','mod+a',function(){var range=document.createRange();var mailBody=document.querySelector('.mailFrame');range.setStartBefore(mailBody.firstChild);range.setEndAfter(mailBody.lastChild);var selection=window.getSelection();selection.removeAllRanges();selection.addRange(range);return false})};MailView.prototype.setupSubscriptionDisposal=function(element){var that=this;ko.utils.domNodeDisposal.addDisposeCallback(element,function(){that.subscriptions.forEach(function(subscription){subscription.dispose()})})};MailView.prototype.setupDesktopView=function(element){LoadingScreen.hide();this.setupSubscriptionDisposal(element)};MailView.prototype.setupTouchZoom=function(element){var that=this;$('.mailView .zoomContainer > .content').addClass('zoomContent');this.zoom=new Zoom($('.scrollable',element));function adjustZoomAfterHeaderChange(){setTimeout(function(){that.zoom.updateHeaderAndFooterDimensions();that.zoom.transformEnd()},0)}['to','from','cc','bcc'].forEach(function(fieldName){that.subscriptions.push(that[fieldName+'Truncated'].subscribe(adjustZoomAfterHeaderChange))});that.subscriptions.push(that.showExternalImagesLink.subscribe(adjustZoomAfterHeaderChange));if(this.mail.isLoaded()){this.zoom.afterLoad(true)}else{that.subscriptions.push(this.mail.isLoaded.subscribe(function(newValue){if(newValue){that.zoom.afterLoad(true)}}))}that.setupSubscriptionDisposal(element)};MailView.prototype.getUnsubscribeDialogOptions=function(){var that=this;var open=ko.observable(false);return{template:'unsubscribeDialog',data:{url:that.unsubscribeLink,sendMail:function(){that.sendUnsubscribeMail();open(false)},open:open},openState:open,renderOnInit:true,positioning:{horizontal:'inside-left',vertical:'inside-top'}}};MailView.prototype.sendUnsubscribeMail=function(){var that=this;var mailLinkData=util.composerOptionsFromMailto(that.unsubscribeLink());var outgoingData={};outgoingData.headers={};['to','cc','bcc'].forEach(function(header){if(mailLinkData[header]){outgoingData.headers[header]=mailLinkData[header].split(',').map(function(address){var recipient=Recipient.from(address);return Recipient.toJS(recipient)})}});outgoingData.headers.subject=mailLinkData.subject||'Unsubscribe';outgoingData.headers.flags=[Flag.SEEN.imap,Flag.SUBMITPENDING.imap];outgoingData.text=mailLinkData.body||'';outgoingData.html=mailLinkData.body||'';outgoingData.destination=that.state.folders.sent;that.state.notification({message:TR('mail.SendingUnsubscribeMail','Sending unsubscribe mail'),timeout:3000});that.executeAction(new SaveMailAction({outgoingMail:new OutgoingMail(outgoingData)}),function(err,data,savedMail){if(err){that.state.notification(null);that.handleError(err,{'0, 500, 502, 503, 200':function(){var message=TR('mail.UnsubscribeUnsuccessful','The unsubscribe mail could not be sent.');this.showError(message);one.crashReporter.reportCrash(err,{message:message})}})}else{that.executeAction(new SendMailAction({mail:savedMail}),function(err,data){that.state.notification(null);if(err){that.handleError(err)}})}})};MailView.prototype.setupZoom=function(element){$(element).on('mouseenter','.mailPartImage',function(){$(this).toggleClass('zoomAble',$(this).parent().width()<this.naturalWidth)});$(element).on('click','.mailPartImage',function(){if($(this).hasClass('zoomAble')){$(this).toggleClass('zoomed')}})};MailView.prototype.init=function(element){if(this.state.isTouch){if(shouldZoom&&this.mail.inlineParts().length>0){this.setupTouchZoom(element)}}else{this.setupZoom(element)}};MailView.prototype.print=function(){var that=this;that.printing(true);that.state.signals.closeErrorMessage.dispatch();setTimeout(function(){window.print()},1000)};MailView.prototype.loadExternalImages=function(){var that=this;var mail=this.mail;mail.loadExternalImages();mail.setLoadImagesFlag();this.executeAction(new SetFlagAction({mails:[mail],flag:Flag.ONECOMLOADIMG,value:true}),function(err){if(err){that.handleError(err)}});that.loadMailParts();if(shouldZoom&&$('body').hasClass('touch')){this.zoom.afterLoad()}};MailView.prototype.loadAlwaysExternalImages=function(){var that=this;that.state.notification({message:TR('mail.PreferencesHaveBeenUpdated','Your preferences have been updated'),timeout:3000});that.addTrustedSender()};MailView.prototype.disregardSPF=function(){var that=this;var mail=this.mail;mail.setDisregardSPFFlag();this.executeAction(new SetFlagAction({mails:[mail],flag:Flag.ONECOMDISREGARDSPF,value:true}),function(err){if(err){that.handleError(err)}})};MailView.prototype.getContactCard=function(recipient){return new ContactCard(this.state.user(),this.state.contacts.byEmail(),recipient)};MailView.prototype.close=function(){this.mail.decrementReferences()};MailView.prototype.template='view';return MailView})}());System.registerDynamic('3rdparty/moment.js',[],true,function($__require,exports,module){var define,global=this||self,GLOBAL=global;//! moment.js
                                           //! version : 2.19.3
                                           //! authors : Tim Wood, Iskren Chernev, Moment.js contributors
                                           //! license : MIT
                                           //! momentjs.com
//! moment.js
//! version : 2.19.3
//! authors : Tim Wood, Iskren Chernev, Moment.js contributors
//! license : MIT
//! momentjs.com
;(function(global,factory){typeof exports==='object'&&typeof module!=='undefined'?module.exports=factory():typeof define==='function'&&define.amd?define(factory):global.moment=factory()}(this,function(){'use strict';var hookCallback;function hooks(){return hookCallback.apply(null,arguments)}function setHookCallback(callback){hookCallback=callback}function isArray(input){return input instanceof Array||Object.prototype.toString.call(input)==='[object Array]'}function isObject(input){return input!=null&&Object.prototype.toString.call(input)==='[object Object]'}function isObjectEmpty(obj){if(Object.getOwnPropertyNames){return Object.getOwnPropertyNames(obj).length===0}else{var k;for(k in obj){if(obj.hasOwnProperty(k)){return false}}return true}}function isUndefined(input){return input===void 0}function isNumber(input){return typeof input==='number'||Object.prototype.toString.call(input)==='[object Number]'}function isDate(input){return input instanceof Date||Object.prototype.toString.call(input)==='[object Date]'}function map(arr,fn){var res=[],i;for(i=0;i<arr.length;++i){res.push(fn(arr[i],i))}return res}function hasOwnProp(a,b){return Object.prototype.hasOwnProperty.call(a,b)}function extend(a,b){for(var i in b){if(hasOwnProp(b,i)){a[i]=b[i]}}if(hasOwnProp(b,'toString')){a.toString=b.toString}if(hasOwnProp(b,'valueOf')){a.valueOf=b.valueOf}return a}function createUTC(input,format,locale,strict){return createLocalOrUTC(input,format,locale,strict,true).utc()}function defaultParsingFlags(){return{empty:false,unusedTokens:[],unusedInput:[],overflow:-2,charsLeftOver:0,nullInput:false,invalidMonth:null,invalidFormat:false,userInvalidated:false,iso:false,parsedDateParts:[],meridiem:null,rfc2822:false,weekdayMismatch:false}}function getParsingFlags(m){if(m._pf==null){m._pf=defaultParsingFlags()}return m._pf}var some;if(Array.prototype.some){some=Array.prototype.some}else{some=function(fun){var t=Object(this);var len=t.length>>>0;for(var i=0;i<len;i++){if(i in t&&fun.call(this,t[i],i,t)){return true}}return false}}function isValid(m){if(m._isValid==null){var flags=getParsingFlags(m);var parsedParts=some.call(flags.parsedDateParts,function(i){return i!=null});var isNowValid=!isNaN(m._d.getTime())&&flags.overflow<0&&!flags.empty&&!flags.invalidMonth&&!flags.invalidWeekday&&!flags.weekdayMismatch&&!flags.nullInput&&!flags.invalidFormat&&!flags.userInvalidated&&(!flags.meridiem||flags.meridiem&&parsedParts);if(m._strict){isNowValid=isNowValid&&flags.charsLeftOver===0&&flags.unusedTokens.length===0&&flags.bigHour===undefined}if(Object.isFrozen==null||!Object.isFrozen(m)){m._isValid=isNowValid}else{return isNowValid}}return m._isValid}function createInvalid(flags){var m=createUTC(NaN);if(flags!=null){extend(getParsingFlags(m),flags)}else{getParsingFlags(m).userInvalidated=true}return m}var momentProperties=hooks.momentProperties=[];function copyConfig(to,from){var i,prop,val;if(!isUndefined(from._isAMomentObject)){to._isAMomentObject=from._isAMomentObject}if(!isUndefined(from._i)){to._i=from._i}if(!isUndefined(from._f)){to._f=from._f}if(!isUndefined(from._l)){to._l=from._l}if(!isUndefined(from._strict)){to._strict=from._strict}if(!isUndefined(from._tzm)){to._tzm=from._tzm}if(!isUndefined(from._isUTC)){to._isUTC=from._isUTC}if(!isUndefined(from._offset)){to._offset=from._offset}if(!isUndefined(from._pf)){to._pf=getParsingFlags(from)}if(!isUndefined(from._locale)){to._locale=from._locale}if(momentProperties.length>0){for(i=0;i<momentProperties.length;i++){prop=momentProperties[i];val=from[prop];if(!isUndefined(val)){to[prop]=val}}}return to}var updateInProgress=false;function Moment(config){copyConfig(this,config);this._d=new Date(config._d!=null?config._d.getTime():NaN);if(!this.isValid()){this._d=new Date(NaN)}if(updateInProgress===false){updateInProgress=true;hooks.updateOffset(this);updateInProgress=false}}function isMoment(obj){return obj instanceof Moment||obj!=null&&obj._isAMomentObject!=null}function absFloor(number){if(number<0){return Math.ceil(number)||0}else{return Math.floor(number)}}function toInt(argumentForCoercion){var coercedNumber=+argumentForCoercion,value=0;if(coercedNumber!==0&&isFinite(coercedNumber)){value=absFloor(coercedNumber)}return value}function compareArrays(array1,array2,dontConvert){var len=Math.min(array1.length,array2.length),lengthDiff=Math.abs(array1.length-array2.length),diffs=0,i;for(i=0;i<len;i++){if(dontConvert&&array1[i]!==array2[i]||!dontConvert&&toInt(array1[i])!==toInt(array2[i])){diffs++}}return diffs+lengthDiff}function warn(msg){if(hooks.suppressDeprecationWarnings===false&&typeof console!=='undefined'&&console.warn){;}}function deprecate(msg,fn){var firstTime=true;return extend(function(){if(hooks.deprecationHandler!=null){hooks.deprecationHandler(null,msg)}if(firstTime){var args=[];var arg;for(var i=0;i<arguments.length;i++){arg='';if(typeof arguments[i]==='object'){arg+='\n['+i+'] ';for(var key in arguments[0]){arg+=key+': '+arguments[0][key]+', '}arg=arg.slice(0,-2)}else{arg=arguments[i]}args.push(arg)}warn(msg+'\nArguments: '+Array.prototype.slice.call(args).join('')+'\n'+new Error().stack);firstTime=false}return fn.apply(this,arguments)},fn)}var deprecations={};function deprecateSimple(name,msg){if(hooks.deprecationHandler!=null){hooks.deprecationHandler(name,msg)}if(!deprecations[name]){warn(msg);deprecations[name]=true}}hooks.suppressDeprecationWarnings=false;hooks.deprecationHandler=null;function isFunction(input){return input instanceof Function||Object.prototype.toString.call(input)==='[object Function]'}function set(config){var prop,i;for(i in config){prop=config[i];if(isFunction(prop)){this[i]=prop}else{this['_'+i]=prop}}this._config=config;this._dayOfMonthOrdinalParseLenient=new RegExp((this._dayOfMonthOrdinalParse.source||this._ordinalParse.source)+'|'+/\d{1,2}/.source)}function mergeConfigs(parentConfig,childConfig){var res=extend({},parentConfig),prop;for(prop in childConfig){if(hasOwnProp(childConfig,prop)){if(isObject(parentConfig[prop])&&isObject(childConfig[prop])){res[prop]={};extend(res[prop],parentConfig[prop]);extend(res[prop],childConfig[prop])}else if(childConfig[prop]!=null){res[prop]=childConfig[prop]}else{delete res[prop]}}}for(prop in parentConfig){if(hasOwnProp(parentConfig,prop)&&!hasOwnProp(childConfig,prop)&&isObject(parentConfig[prop])){res[prop]=extend({},res[prop])}}return res}function Locale(config){if(config!=null){this.set(config)}}var keys;if(Object.keys){keys=Object.keys}else{keys=function(obj){var i,res=[];for(i in obj){if(hasOwnProp(obj,i)){res.push(i)}}return res}}var defaultCalendar={sameDay:'[Today at] LT',nextDay:'[Tomorrow at] LT',nextWeek:'dddd [at] LT',lastDay:'[Yesterday at] LT',lastWeek:'[Last] dddd [at] LT',sameElse:'L'};function calendar(key,mom,now){var output=this._calendar[key]||this._calendar['sameElse'];return isFunction(output)?output.call(mom,now):output}var defaultLongDateFormat={LTS:'h:mm:ss A',LT:'h:mm A',L:'MM/DD/YYYY',LL:'MMMM D, YYYY',LLL:'MMMM D, YYYY h:mm A',LLLL:'dddd, MMMM D, YYYY h:mm A'};function longDateFormat(key){var format=this._longDateFormat[key],formatUpper=this._longDateFormat[key.toUpperCase()];if(format||!formatUpper){return format}this._longDateFormat[key]=formatUpper.replace(/MMMM|MM|DD|dddd/g,function(val){return val.slice(1)});return this._longDateFormat[key]}var defaultInvalidDate='Invalid date';function invalidDate(){return this._invalidDate}var defaultOrdinal='%d';var defaultDayOfMonthOrdinalParse=/\d{1,2}/;function ordinal(number){return this._ordinal.replace('%d',number)}var defaultRelativeTime={future:'in %s',past:'%s ago',s:'a few seconds',ss:'%d seconds',m:'a minute',mm:'%d minutes',h:'an hour',hh:'%d hours',d:'a day',dd:'%d days',M:'a month',MM:'%d months',y:'a year',yy:'%d years'};function relativeTime(number,withoutSuffix,string,isFuture){var output=this._relativeTime[string];return isFunction(output)?output(number,withoutSuffix,string,isFuture):output.replace(/%d/i,number)}function pastFuture(diff,output){var format=this._relativeTime[diff>0?'future':'past'];return isFunction(format)?format(output):format.replace(/%s/i,output)}var aliases={};function addUnitAlias(unit,shorthand){var lowerCase=unit.toLowerCase();aliases[lowerCase]=aliases[lowerCase+'s']=aliases[shorthand]=unit}function normalizeUnits(units){return typeof units==='string'?aliases[units]||aliases[units.toLowerCase()]:undefined}function normalizeObjectUnits(inputObject){var normalizedInput={},normalizedProp,prop;for(prop in inputObject){if(hasOwnProp(inputObject,prop)){normalizedProp=normalizeUnits(prop);if(normalizedProp){normalizedInput[normalizedProp]=inputObject[prop]}}}return normalizedInput}var priorities={};function addUnitPriority(unit,priority){priorities[unit]=priority}function getPrioritizedUnits(unitsObj){var units=[];for(var u in unitsObj){units.push({unit:u,priority:priorities[u]})}units.sort(function(a,b){return a.priority-b.priority});return units}function zeroFill(number,targetLength,forceSign){var absNumber=''+Math.abs(number),zerosToFill=targetLength-absNumber.length,sign=number>=0;return(sign?forceSign?'+':'':'-')+Math.pow(10,Math.max(0,zerosToFill)).toString().substr(1)+absNumber}var formattingTokens=/(\[[^\[]*\])|(\\)?([Hh]mm(ss)?|Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|Qo?|YYYYYY|YYYYY|YYYY|YY|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|kk?|mm?|ss?|S{1,9}|x|X|zz?|ZZ?|.)/g;var localFormattingTokens=/(\[[^\[]*\])|(\\)?(LTS|LT|LL?L?L?|l{1,4})/g;var formatFunctions={};var formatTokenFunctions={};function addFormatToken(token,padded,ordinal,callback){var func=callback;if(typeof callback==='string'){func=function(){return this[callback]()}}if(token){formatTokenFunctions[token]=func}if(padded){formatTokenFunctions[padded[0]]=function(){return zeroFill(func.apply(this,arguments),padded[1],padded[2])}}if(ordinal){formatTokenFunctions[ordinal]=function(){return this.localeData().ordinal(func.apply(this,arguments),token)}}}function removeFormattingTokens(input){if(input.match(/\[[\s\S]/)){return input.replace(/^\[|\]$/g,'')}return input.replace(/\\/g,'')}function makeFormatFunction(format){var array=format.match(formattingTokens),i,length;for(i=0,length=array.length;i<length;i++){if(formatTokenFunctions[array[i]]){array[i]=formatTokenFunctions[array[i]]}else{array[i]=removeFormattingTokens(array[i])}}return function(mom){var output='',i;for(i=0;i<length;i++){output+=isFunction(array[i])?array[i].call(mom,format):array[i]}return output}}function formatMoment(m,format){if(!m.isValid()){return m.localeData().invalidDate()}format=expandFormat(format,m.localeData());formatFunctions[format]=formatFunctions[format]||makeFormatFunction(format);return formatFunctions[format](m)}function expandFormat(format,locale){var i=5;function replaceLongDateFormatTokens(input){return locale.longDateFormat(input)||input}localFormattingTokens.lastIndex=0;while(i>=0&&localFormattingTokens.test(format)){format=format.replace(localFormattingTokens,replaceLongDateFormatTokens);localFormattingTokens.lastIndex=0;i-=1}return format}var match1=/\d/;var match2=/\d\d/;var match3=/\d{3}/;var match4=/\d{4}/;var match6=/[+-]?\d{6}/;var match1to2=/\d\d?/;var match3to4=/\d\d\d\d?/;var match5to6=/\d\d\d\d\d\d?/;var match1to3=/\d{1,3}/;var match1to4=/\d{1,4}/;var match1to6=/[+-]?\d{1,6}/;var matchUnsigned=/\d+/;var matchSigned=/[+-]?\d+/;var matchOffset=/Z|[+-]\d\d:?\d\d/gi;var matchShortOffset=/Z|[+-]\d\d(?::?\d\d)?/gi;var matchTimestamp=/[+-]?\d+(\.\d{1,3})?/;var matchWord=/[0-9]{0,256}['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]{1,256}|[\u0600-\u06FF\/]{1,256}(\s*?[\u0600-\u06FF]{1,256}){1,2}/i;var regexes={};function addRegexToken(token,regex,strictRegex){regexes[token]=isFunction(regex)?regex:function(isStrict,localeData){return isStrict&&strictRegex?strictRegex:regex}}function getParseRegexForToken(token,config){if(!hasOwnProp(regexes,token)){return new RegExp(unescapeFormat(token))}return regexes[token](config._strict,config._locale)}function unescapeFormat(s){return regexEscape(s.replace('\\','').replace(/\\(\[)|\\(\])|\[([^\]\[]*)\]|\\(.)/g,function(matched,p1,p2,p3,p4){return p1||p2||p3||p4}))}function regexEscape(s){return s.replace(/[-\/\\^$*+?.()|[\]{}]/g,'\\$&')}var tokens={};function addParseToken(token,callback){var i,func=callback;if(typeof token==='string'){token=[token]}if(isNumber(callback)){func=function(input,array){array[callback]=toInt(input)}}for(i=0;i<token.length;i++){tokens[token[i]]=func}}function addWeekParseToken(token,callback){addParseToken(token,function(input,array,config,token){config._w=config._w||{};callback(input,config._w,config,token)})}function addTimeToArrayFromToken(token,input,config){if(input!=null&&hasOwnProp(tokens,token)){tokens[token](input,config._a,config,token)}}var YEAR=0;var MONTH=1;var DATE=2;var HOUR=3;var MINUTE=4;var SECOND=5;var MILLISECOND=6;var WEEK=7;var WEEKDAY=8;addFormatToken('Y',0,0,function(){var y=this.year();return y<=9999?''+y:'+'+y});addFormatToken(0,['YY',2],0,function(){return this.year()%100});addFormatToken(0,['YYYY',4],0,'year');addFormatToken(0,['YYYYY',5],0,'year');addFormatToken(0,['YYYYYY',6,true],0,'year');addUnitAlias('year','y');addUnitPriority('year',1);addRegexToken('Y',matchSigned);addRegexToken('YY',match1to2,match2);addRegexToken('YYYY',match1to4,match4);addRegexToken('YYYYY',match1to6,match6);addRegexToken('YYYYYY',match1to6,match6);addParseToken(['YYYYY','YYYYYY'],YEAR);addParseToken('YYYY',function(input,array){array[YEAR]=input.length===2?hooks.parseTwoDigitYear(input):toInt(input)});addParseToken('YY',function(input,array){array[YEAR]=hooks.parseTwoDigitYear(input)});addParseToken('Y',function(input,array){array[YEAR]=parseInt(input,10)});function daysInYear(year){return isLeapYear(year)?366:365}function isLeapYear(year){return year%4===0&&year%100!==0||year%400===0}hooks.parseTwoDigitYear=function(input){return toInt(input)+(toInt(input)>68?1900:2000)};var getSetYear=makeGetSet('FullYear',true);function getIsLeapYear(){return isLeapYear(this.year())}function makeGetSet(unit,keepTime){return function(value){if(value!=null){set$1(this,unit,value);hooks.updateOffset(this,keepTime);return this}else{return get(this,unit)}}}function get(mom,unit){return mom.isValid()?mom._d['get'+(mom._isUTC?'UTC':'')+unit]():NaN}function set$1(mom,unit,value){if(mom.isValid()&&!isNaN(value)){if(unit==='FullYear'&&isLeapYear(mom.year())&&mom.month()===1&&mom.date()===29){mom._d['set'+(mom._isUTC?'UTC':'')+unit](value,mom.month(),daysInMonth(value,mom.month()))}else{mom._d['set'+(mom._isUTC?'UTC':'')+unit](value)}}}function stringGet(units){units=normalizeUnits(units);if(isFunction(this[units])){return this[units]()}return this}function stringSet(units,value){if(typeof units==='object'){units=normalizeObjectUnits(units);var prioritized=getPrioritizedUnits(units);for(var i=0;i<prioritized.length;i++){this[prioritized[i].unit](units[prioritized[i].unit])}}else{units=normalizeUnits(units);if(isFunction(this[units])){return this[units](value)}}return this}function mod(n,x){return(n%x+x)%x}var indexOf;if(Array.prototype.indexOf){indexOf=Array.prototype.indexOf}else{indexOf=function(o){var i;for(i=0;i<this.length;++i){if(this[i]===o){return i}}return-1}}function daysInMonth(year,month){if(isNaN(year)||isNaN(month)){return NaN}var modMonth=mod(month,12);year+=(month-modMonth)/12;return modMonth===1?isLeapYear(year)?29:28:31-modMonth%7%2}addFormatToken('M',['MM',2],'Mo',function(){return this.month()+1});addFormatToken('MMM',0,0,function(format){return this.localeData().monthsShort(this,format)});addFormatToken('MMMM',0,0,function(format){return this.localeData().months(this,format)});addUnitAlias('month','M');addUnitPriority('month',8);addRegexToken('M',match1to2);addRegexToken('MM',match1to2,match2);addRegexToken('MMM',function(isStrict,locale){return locale.monthsShortRegex(isStrict)});addRegexToken('MMMM',function(isStrict,locale){return locale.monthsRegex(isStrict)});addParseToken(['M','MM'],function(input,array){array[MONTH]=toInt(input)-1});addParseToken(['MMM','MMMM'],function(input,array,config,token){var month=config._locale.monthsParse(input,token,config._strict);if(month!=null){array[MONTH]=month}else{getParsingFlags(config).invalidMonth=input}});var MONTHS_IN_FORMAT=/D[oD]?(\[[^\[\]]*\]|\s)+MMMM?/;var defaultLocaleMonths='January_February_March_April_May_June_July_August_September_October_November_December'.split('_');function localeMonths(m,format){if(!m){return isArray(this._months)?this._months:this._months['standalone']}return isArray(this._months)?this._months[m.month()]:this._months[(this._months.isFormat||MONTHS_IN_FORMAT).test(format)?'format':'standalone'][m.month()]}var defaultLocaleMonthsShort='Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec'.split('_');function localeMonthsShort(m,format){if(!m){return isArray(this._monthsShort)?this._monthsShort:this._monthsShort['standalone']}return isArray(this._monthsShort)?this._monthsShort[m.month()]:this._monthsShort[MONTHS_IN_FORMAT.test(format)?'format':'standalone'][m.month()]}function handleStrictParse(monthName,format,strict){var i,ii,mom,llc=monthName.toLocaleLowerCase();if(!this._monthsParse){this._monthsParse=[];this._longMonthsParse=[];this._shortMonthsParse=[];for(i=0;i<12;++i){mom=createUTC([2000,i]);this._shortMonthsParse[i]=this.monthsShort(mom,'').toLocaleLowerCase();this._longMonthsParse[i]=this.months(mom,'').toLocaleLowerCase()}}if(strict){if(format==='MMM'){ii=indexOf.call(this._shortMonthsParse,llc);return ii!==-1?ii:null}else{ii=indexOf.call(this._longMonthsParse,llc);return ii!==-1?ii:null}}else{if(format==='MMM'){ii=indexOf.call(this._shortMonthsParse,llc);if(ii!==-1){return ii}ii=indexOf.call(this._longMonthsParse,llc);return ii!==-1?ii:null}else{ii=indexOf.call(this._longMonthsParse,llc);if(ii!==-1){return ii}ii=indexOf.call(this._shortMonthsParse,llc);return ii!==-1?ii:null}}}function localeMonthsParse(monthName,format,strict){var i,mom,regex;if(this._monthsParseExact){return handleStrictParse.call(this,monthName,format,strict)}if(!this._monthsParse){this._monthsParse=[];this._longMonthsParse=[];this._shortMonthsParse=[]}for(i=0;i<12;i++){mom=createUTC([2000,i]);if(strict&&!this._longMonthsParse[i]){this._longMonthsParse[i]=new RegExp('^'+this.months(mom,'').replace('.','')+'$','i');this._shortMonthsParse[i]=new RegExp('^'+this.monthsShort(mom,'').replace('.','')+'$','i')}if(!strict&&!this._monthsParse[i]){regex='^'+this.months(mom,'')+'|^'+this.monthsShort(mom,'');this._monthsParse[i]=new RegExp(regex.replace('.',''),'i')}if(strict&&format==='MMMM'&&this._longMonthsParse[i].test(monthName)){return i}else if(strict&&format==='MMM'&&this._shortMonthsParse[i].test(monthName)){return i}else if(!strict&&this._monthsParse[i].test(monthName)){return i}}}function setMonth(mom,value){var dayOfMonth;if(!mom.isValid()){return mom}if(typeof value==='string'){if(/^\d+$/.test(value)){value=toInt(value)}else{value=mom.localeData().monthsParse(value);if(!isNumber(value)){return mom}}}dayOfMonth=Math.min(mom.date(),daysInMonth(mom.year(),value));mom._d['set'+(mom._isUTC?'UTC':'')+'Month'](value,dayOfMonth);return mom}function getSetMonth(value){if(value!=null){setMonth(this,value);hooks.updateOffset(this,true);return this}else{return get(this,'Month')}}function getDaysInMonth(){return daysInMonth(this.year(),this.month())}var defaultMonthsShortRegex=matchWord;function monthsShortRegex(isStrict){if(this._monthsParseExact){if(!hasOwnProp(this,'_monthsRegex')){computeMonthsParse.call(this)}if(isStrict){return this._monthsShortStrictRegex}else{return this._monthsShortRegex}}else{if(!hasOwnProp(this,'_monthsShortRegex')){this._monthsShortRegex=defaultMonthsShortRegex}return this._monthsShortStrictRegex&&isStrict?this._monthsShortStrictRegex:this._monthsShortRegex}}var defaultMonthsRegex=matchWord;function monthsRegex(isStrict){if(this._monthsParseExact){if(!hasOwnProp(this,'_monthsRegex')){computeMonthsParse.call(this)}if(isStrict){return this._monthsStrictRegex}else{return this._monthsRegex}}else{if(!hasOwnProp(this,'_monthsRegex')){this._monthsRegex=defaultMonthsRegex}return this._monthsStrictRegex&&isStrict?this._monthsStrictRegex:this._monthsRegex}}function computeMonthsParse(){function cmpLenRev(a,b){return b.length-a.length}var shortPieces=[],longPieces=[],mixedPieces=[],i,mom;for(i=0;i<12;i++){mom=createUTC([2000,i]);shortPieces.push(this.monthsShort(mom,''));longPieces.push(this.months(mom,''));mixedPieces.push(this.months(mom,''));mixedPieces.push(this.monthsShort(mom,''))}shortPieces.sort(cmpLenRev);longPieces.sort(cmpLenRev);mixedPieces.sort(cmpLenRev);for(i=0;i<12;i++){shortPieces[i]=regexEscape(shortPieces[i]);longPieces[i]=regexEscape(longPieces[i])}for(i=0;i<24;i++){mixedPieces[i]=regexEscape(mixedPieces[i])}this._monthsRegex=new RegExp('^('+mixedPieces.join('|')+')','i');this._monthsShortRegex=this._monthsRegex;this._monthsStrictRegex=new RegExp('^('+longPieces.join('|')+')','i');this._monthsShortStrictRegex=new RegExp('^('+shortPieces.join('|')+')','i')}function createDate(y,m,d,h,M,s,ms){var date=new Date(y,m,d,h,M,s,ms);if(y<100&&y>=0&&isFinite(date.getFullYear())){date.setFullYear(y)}return date}function createUTCDate(y){var date=new Date(Date.UTC.apply(null,arguments));if(y<100&&y>=0&&isFinite(date.getUTCFullYear())){date.setUTCFullYear(y)}return date}function firstWeekOffset(year,dow,doy){var fwd=7+dow-doy,fwdlw=(7+createUTCDate(year,0,fwd).getUTCDay()-dow)%7;return-fwdlw+fwd-1}function dayOfYearFromWeeks(year,week,weekday,dow,doy){var localWeekday=(7+weekday-dow)%7,weekOffset=firstWeekOffset(year,dow,doy),dayOfYear=1+7*(week-1)+localWeekday+weekOffset,resYear,resDayOfYear;if(dayOfYear<=0){resYear=year-1;resDayOfYear=daysInYear(resYear)+dayOfYear}else if(dayOfYear>daysInYear(year)){resYear=year+1;resDayOfYear=dayOfYear-daysInYear(year)}else{resYear=year;resDayOfYear=dayOfYear}return{year:resYear,dayOfYear:resDayOfYear}}function weekOfYear(mom,dow,doy){var weekOffset=firstWeekOffset(mom.year(),dow,doy),week=Math.floor((mom.dayOfYear()-weekOffset-1)/7)+1,resWeek,resYear;if(week<1){resYear=mom.year()-1;resWeek=week+weeksInYear(resYear,dow,doy)}else if(week>weeksInYear(mom.year(),dow,doy)){resWeek=week-weeksInYear(mom.year(),dow,doy);resYear=mom.year()+1}else{resYear=mom.year();resWeek=week}return{week:resWeek,year:resYear}}function weeksInYear(year,dow,doy){var weekOffset=firstWeekOffset(year,dow,doy),weekOffsetNext=firstWeekOffset(year+1,dow,doy);return(daysInYear(year)-weekOffset+weekOffsetNext)/7}addFormatToken('w',['ww',2],'wo','week');addFormatToken('W',['WW',2],'Wo','isoWeek');addUnitAlias('week','w');addUnitAlias('isoWeek','W');addUnitPriority('week',5);addUnitPriority('isoWeek',5);addRegexToken('w',match1to2);addRegexToken('ww',match1to2,match2);addRegexToken('W',match1to2);addRegexToken('WW',match1to2,match2);addWeekParseToken(['w','ww','W','WW'],function(input,week,config,token){week[token.substr(0,1)]=toInt(input)});function localeWeek(mom){return weekOfYear(mom,this._week.dow,this._week.doy).week}var defaultLocaleWeek={dow:0,doy:6};function localeFirstDayOfWeek(){return this._week.dow}function localeFirstDayOfYear(){return this._week.doy}function getSetWeek(input){var week=this.localeData().week(this);return input==null?week:this.add((input-week)*7,'d')}function getSetISOWeek(input){var week=weekOfYear(this,1,4).week;return input==null?week:this.add((input-week)*7,'d')}addFormatToken('d',0,'do','day');addFormatToken('dd',0,0,function(format){return this.localeData().weekdaysMin(this,format)});addFormatToken('ddd',0,0,function(format){return this.localeData().weekdaysShort(this,format)});addFormatToken('dddd',0,0,function(format){return this.localeData().weekdays(this,format)});addFormatToken('e',0,0,'weekday');addFormatToken('E',0,0,'isoWeekday');addUnitAlias('day','d');addUnitAlias('weekday','e');addUnitAlias('isoWeekday','E');addUnitPriority('day',11);addUnitPriority('weekday',11);addUnitPriority('isoWeekday',11);addRegexToken('d',match1to2);addRegexToken('e',match1to2);addRegexToken('E',match1to2);addRegexToken('dd',function(isStrict,locale){return locale.weekdaysMinRegex(isStrict)});addRegexToken('ddd',function(isStrict,locale){return locale.weekdaysShortRegex(isStrict)});addRegexToken('dddd',function(isStrict,locale){return locale.weekdaysRegex(isStrict)});addWeekParseToken(['dd','ddd','dddd'],function(input,week,config,token){var weekday=config._locale.weekdaysParse(input,token,config._strict);if(weekday!=null){week.d=weekday}else{getParsingFlags(config).invalidWeekday=input}});addWeekParseToken(['d','e','E'],function(input,week,config,token){week[token]=toInt(input)});function parseWeekday(input,locale){if(typeof input!=='string'){return input}if(!isNaN(input)){return parseInt(input,10)}input=locale.weekdaysParse(input);if(typeof input==='number'){return input}return null}function parseIsoWeekday(input,locale){if(typeof input==='string'){return locale.weekdaysParse(input)%7||7}return isNaN(input)?null:input}var defaultLocaleWeekdays='Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday'.split('_');function localeWeekdays(m,format){if(!m){return isArray(this._weekdays)?this._weekdays:this._weekdays['standalone']}return isArray(this._weekdays)?this._weekdays[m.day()]:this._weekdays[this._weekdays.isFormat.test(format)?'format':'standalone'][m.day()]}var defaultLocaleWeekdaysShort='Sun_Mon_Tue_Wed_Thu_Fri_Sat'.split('_');function localeWeekdaysShort(m){return m?this._weekdaysShort[m.day()]:this._weekdaysShort}var defaultLocaleWeekdaysMin='Su_Mo_Tu_We_Th_Fr_Sa'.split('_');function localeWeekdaysMin(m){return m?this._weekdaysMin[m.day()]:this._weekdaysMin}function handleStrictParse$1(weekdayName,format,strict){var i,ii,mom,llc=weekdayName.toLocaleLowerCase();if(!this._weekdaysParse){this._weekdaysParse=[];this._shortWeekdaysParse=[];this._minWeekdaysParse=[];for(i=0;i<7;++i){mom=createUTC([2000,1]).day(i);this._minWeekdaysParse[i]=this.weekdaysMin(mom,'').toLocaleLowerCase();this._shortWeekdaysParse[i]=this.weekdaysShort(mom,'').toLocaleLowerCase();this._weekdaysParse[i]=this.weekdays(mom,'').toLocaleLowerCase()}}if(strict){if(format==='dddd'){ii=indexOf.call(this._weekdaysParse,llc);return ii!==-1?ii:null}else if(format==='ddd'){ii=indexOf.call(this._shortWeekdaysParse,llc);return ii!==-1?ii:null}else{ii=indexOf.call(this._minWeekdaysParse,llc);return ii!==-1?ii:null}}else{if(format==='dddd'){ii=indexOf.call(this._weekdaysParse,llc);if(ii!==-1){return ii}ii=indexOf.call(this._shortWeekdaysParse,llc);if(ii!==-1){return ii}ii=indexOf.call(this._minWeekdaysParse,llc);return ii!==-1?ii:null}else if(format==='ddd'){ii=indexOf.call(this._shortWeekdaysParse,llc);if(ii!==-1){return ii}ii=indexOf.call(this._weekdaysParse,llc);if(ii!==-1){return ii}ii=indexOf.call(this._minWeekdaysParse,llc);return ii!==-1?ii:null}else{ii=indexOf.call(this._minWeekdaysParse,llc);if(ii!==-1){return ii}ii=indexOf.call(this._weekdaysParse,llc);if(ii!==-1){return ii}ii=indexOf.call(this._shortWeekdaysParse,llc);return ii!==-1?ii:null}}}function localeWeekdaysParse(weekdayName,format,strict){var i,mom,regex;if(this._weekdaysParseExact){return handleStrictParse$1.call(this,weekdayName,format,strict)}if(!this._weekdaysParse){this._weekdaysParse=[];this._minWeekdaysParse=[];this._shortWeekdaysParse=[];this._fullWeekdaysParse=[]}for(i=0;i<7;i++){mom=createUTC([2000,1]).day(i);if(strict&&!this._fullWeekdaysParse[i]){this._fullWeekdaysParse[i]=new RegExp('^'+this.weekdays(mom,'').replace('.','.?')+'$','i');this._shortWeekdaysParse[i]=new RegExp('^'+this.weekdaysShort(mom,'').replace('.','.?')+'$','i');this._minWeekdaysParse[i]=new RegExp('^'+this.weekdaysMin(mom,'').replace('.','.?')+'$','i')}if(!this._weekdaysParse[i]){regex='^'+this.weekdays(mom,'')+'|^'+this.weekdaysShort(mom,'')+'|^'+this.weekdaysMin(mom,'');this._weekdaysParse[i]=new RegExp(regex.replace('.',''),'i')}if(strict&&format==='dddd'&&this._fullWeekdaysParse[i].test(weekdayName)){return i}else if(strict&&format==='ddd'&&this._shortWeekdaysParse[i].test(weekdayName)){return i}else if(strict&&format==='dd'&&this._minWeekdaysParse[i].test(weekdayName)){return i}else if(!strict&&this._weekdaysParse[i].test(weekdayName)){return i}}}function getSetDayOfWeek(input){if(!this.isValid()){return input!=null?this:NaN}var day=this._isUTC?this._d.getUTCDay():this._d.getDay();if(input!=null){input=parseWeekday(input,this.localeData());return this.add(input-day,'d')}else{return day}}function getSetLocaleDayOfWeek(input){if(!this.isValid()){return input!=null?this:NaN}var weekday=(this.day()+7-this.localeData()._week.dow)%7;return input==null?weekday:this.add(input-weekday,'d')}function getSetISODayOfWeek(input){if(!this.isValid()){return input!=null?this:NaN}if(input!=null){var weekday=parseIsoWeekday(input,this.localeData());return this.day(this.day()%7?weekday:weekday-7)}else{return this.day()||7}}var defaultWeekdaysRegex=matchWord;function weekdaysRegex(isStrict){if(this._weekdaysParseExact){if(!hasOwnProp(this,'_weekdaysRegex')){computeWeekdaysParse.call(this)}if(isStrict){return this._weekdaysStrictRegex}else{return this._weekdaysRegex}}else{if(!hasOwnProp(this,'_weekdaysRegex')){this._weekdaysRegex=defaultWeekdaysRegex}return this._weekdaysStrictRegex&&isStrict?this._weekdaysStrictRegex:this._weekdaysRegex}}var defaultWeekdaysShortRegex=matchWord;function weekdaysShortRegex(isStrict){if(this._weekdaysParseExact){if(!hasOwnProp(this,'_weekdaysRegex')){computeWeekdaysParse.call(this)}if(isStrict){return this._weekdaysShortStrictRegex}else{return this._weekdaysShortRegex}}else{if(!hasOwnProp(this,'_weekdaysShortRegex')){this._weekdaysShortRegex=defaultWeekdaysShortRegex}return this._weekdaysShortStrictRegex&&isStrict?this._weekdaysShortStrictRegex:this._weekdaysShortRegex}}var defaultWeekdaysMinRegex=matchWord;function weekdaysMinRegex(isStrict){if(this._weekdaysParseExact){if(!hasOwnProp(this,'_weekdaysRegex')){computeWeekdaysParse.call(this)}if(isStrict){return this._weekdaysMinStrictRegex}else{return this._weekdaysMinRegex}}else{if(!hasOwnProp(this,'_weekdaysMinRegex')){this._weekdaysMinRegex=defaultWeekdaysMinRegex}return this._weekdaysMinStrictRegex&&isStrict?this._weekdaysMinStrictRegex:this._weekdaysMinRegex}}function computeWeekdaysParse(){function cmpLenRev(a,b){return b.length-a.length}var minPieces=[],shortPieces=[],longPieces=[],mixedPieces=[],i,mom,minp,shortp,longp;for(i=0;i<7;i++){mom=createUTC([2000,1]).day(i);minp=this.weekdaysMin(mom,'');shortp=this.weekdaysShort(mom,'');longp=this.weekdays(mom,'');minPieces.push(minp);shortPieces.push(shortp);longPieces.push(longp);mixedPieces.push(minp);mixedPieces.push(shortp);mixedPieces.push(longp)}minPieces.sort(cmpLenRev);shortPieces.sort(cmpLenRev);longPieces.sort(cmpLenRev);mixedPieces.sort(cmpLenRev);for(i=0;i<7;i++){shortPieces[i]=regexEscape(shortPieces[i]);longPieces[i]=regexEscape(longPieces[i]);mixedPieces[i]=regexEscape(mixedPieces[i])}this._weekdaysRegex=new RegExp('^('+mixedPieces.join('|')+')','i');this._weekdaysShortRegex=this._weekdaysRegex;this._weekdaysMinRegex=this._weekdaysRegex;this._weekdaysStrictRegex=new RegExp('^('+longPieces.join('|')+')','i');this._weekdaysShortStrictRegex=new RegExp('^('+shortPieces.join('|')+')','i');this._weekdaysMinStrictRegex=new RegExp('^('+minPieces.join('|')+')','i')}function hFormat(){return this.hours()%12||12}function kFormat(){return this.hours()||24}addFormatToken('H',['HH',2],0,'hour');addFormatToken('h',['hh',2],0,hFormat);addFormatToken('k',['kk',2],0,kFormat);addFormatToken('hmm',0,0,function(){return''+hFormat.apply(this)+zeroFill(this.minutes(),2)});addFormatToken('hmmss',0,0,function(){return''+hFormat.apply(this)+zeroFill(this.minutes(),2)+zeroFill(this.seconds(),2)});addFormatToken('Hmm',0,0,function(){return''+this.hours()+zeroFill(this.minutes(),2)});addFormatToken('Hmmss',0,0,function(){return''+this.hours()+zeroFill(this.minutes(),2)+zeroFill(this.seconds(),2)});function meridiem(token,lowercase){addFormatToken(token,0,0,function(){return this.localeData().meridiem(this.hours(),this.minutes(),lowercase)})}meridiem('a',true);meridiem('A',false);addUnitAlias('hour','h');addUnitPriority('hour',13);function matchMeridiem(isStrict,locale){return locale._meridiemParse}addRegexToken('a',matchMeridiem);addRegexToken('A',matchMeridiem);addRegexToken('H',match1to2);addRegexToken('h',match1to2);addRegexToken('k',match1to2);addRegexToken('HH',match1to2,match2);addRegexToken('hh',match1to2,match2);addRegexToken('kk',match1to2,match2);addRegexToken('hmm',match3to4);addRegexToken('hmmss',match5to6);addRegexToken('Hmm',match3to4);addRegexToken('Hmmss',match5to6);addParseToken(['H','HH'],HOUR);addParseToken(['k','kk'],function(input,array,config){var kInput=toInt(input);array[HOUR]=kInput===24?0:kInput});addParseToken(['a','A'],function(input,array,config){config._isPm=config._locale.isPM(input);config._meridiem=input});addParseToken(['h','hh'],function(input,array,config){array[HOUR]=toInt(input);getParsingFlags(config).bigHour=true});addParseToken('hmm',function(input,array,config){var pos=input.length-2;array[HOUR]=toInt(input.substr(0,pos));array[MINUTE]=toInt(input.substr(pos));getParsingFlags(config).bigHour=true});addParseToken('hmmss',function(input,array,config){var pos1=input.length-4;var pos2=input.length-2;array[HOUR]=toInt(input.substr(0,pos1));array[MINUTE]=toInt(input.substr(pos1,2));array[SECOND]=toInt(input.substr(pos2));getParsingFlags(config).bigHour=true});addParseToken('Hmm',function(input,array,config){var pos=input.length-2;array[HOUR]=toInt(input.substr(0,pos));array[MINUTE]=toInt(input.substr(pos))});addParseToken('Hmmss',function(input,array,config){var pos1=input.length-4;var pos2=input.length-2;array[HOUR]=toInt(input.substr(0,pos1));array[MINUTE]=toInt(input.substr(pos1,2));array[SECOND]=toInt(input.substr(pos2))});function localeIsPM(input){return(input+'').toLowerCase().charAt(0)==='p'}var defaultLocaleMeridiemParse=/[ap]\.?m?\.?/i;function localeMeridiem(hours,minutes,isLower){if(hours>11){return isLower?'pm':'PM'}else{return isLower?'am':'AM'}}var getSetHour=makeGetSet('Hours',true);var baseConfig={calendar:defaultCalendar,longDateFormat:defaultLongDateFormat,invalidDate:defaultInvalidDate,ordinal:defaultOrdinal,dayOfMonthOrdinalParse:defaultDayOfMonthOrdinalParse,relativeTime:defaultRelativeTime,months:defaultLocaleMonths,monthsShort:defaultLocaleMonthsShort,week:defaultLocaleWeek,weekdays:defaultLocaleWeekdays,weekdaysMin:defaultLocaleWeekdaysMin,weekdaysShort:defaultLocaleWeekdaysShort,meridiemParse:defaultLocaleMeridiemParse};var locales={};var localeFamilies={};var globalLocale;function normalizeLocale(key){return key?key.toLowerCase().replace('_','-'):key}function chooseLocale(names){var i=0,j,next,locale,split;while(i<names.length){split=normalizeLocale(names[i]).split('-');j=split.length;next=normalizeLocale(names[i+1]);next=next?next.split('-'):null;while(j>0){locale=loadLocale(split.slice(0,j).join('-'));if(locale){return locale}if(next&&next.length>=j&&compareArrays(split,next,true)>=j-1){break}j--}i++}return null}function loadLocale(name){var oldLocale=null;if(!locales[name]&&typeof module!=='undefined'&&module&&module.exports){try{oldLocale=globalLocale._abbr;var aliasedRequire=$__require;aliasedRequire('./locale/'+name);getSetGlobalLocale(oldLocale)}catch(e){}}return locales[name]}function getSetGlobalLocale(key,values){var data;if(key){if(isUndefined(values)){data=getLocale(key)}else{data=defineLocale(key,values)}if(data){globalLocale=data}}return globalLocale._abbr}function defineLocale(name,config){if(config!==null){var parentConfig=baseConfig;config.abbr=name;if(locales[name]!=null){deprecateSimple('defineLocaleOverride','use moment.updateLocale(localeName, config) to change '+'an existing locale. moment.defineLocale(localeName, '+'config) should only be used for creating a new locale '+'See http://momentjs.com/guides/#/warnings/define-locale/ for more info.');parentConfig=locales[name]._config}else if(config.parentLocale!=null){if(locales[config.parentLocale]!=null){parentConfig=locales[config.parentLocale]._config}else{if(!localeFamilies[config.parentLocale]){localeFamilies[config.parentLocale]=[]}localeFamilies[config.parentLocale].push({name:name,config:config});return null}}locales[name]=new Locale(mergeConfigs(parentConfig,config));if(localeFamilies[name]){localeFamilies[name].forEach(function(x){defineLocale(x.name,x.config)})}getSetGlobalLocale(name);return locales[name]}else{delete locales[name];return null}}function updateLocale(name,config){if(config!=null){var locale,tmpLocale,parentConfig=baseConfig;tmpLocale=loadLocale(name);if(tmpLocale!=null){parentConfig=tmpLocale._config}config=mergeConfigs(parentConfig,config);locale=new Locale(config);locale.parentLocale=locales[name];locales[name]=locale;getSetGlobalLocale(name)}else{if(locales[name]!=null){if(locales[name].parentLocale!=null){locales[name]=locales[name].parentLocale}else if(locales[name]!=null){delete locales[name]}}}return locales[name]}function getLocale(key){var locale;if(key&&key._locale&&key._locale._abbr){key=key._locale._abbr}if(!key){return globalLocale}if(!isArray(key)){locale=loadLocale(key);if(locale){return locale}key=[key]}return chooseLocale(key)}function listLocales(){return keys(locales)}function checkOverflow(m){var overflow;var a=m._a;if(a&&getParsingFlags(m).overflow===-2){overflow=a[MONTH]<0||a[MONTH]>11?MONTH:a[DATE]<1||a[DATE]>daysInMonth(a[YEAR],a[MONTH])?DATE:a[HOUR]<0||a[HOUR]>24||a[HOUR]===24&&(a[MINUTE]!==0||a[SECOND]!==0||a[MILLISECOND]!==0)?HOUR:a[MINUTE]<0||a[MINUTE]>59?MINUTE:a[SECOND]<0||a[SECOND]>59?SECOND:a[MILLISECOND]<0||a[MILLISECOND]>999?MILLISECOND:-1;if(getParsingFlags(m)._overflowDayOfYear&&(overflow<YEAR||overflow>DATE)){overflow=DATE}if(getParsingFlags(m)._overflowWeeks&&overflow===-1){overflow=WEEK}if(getParsingFlags(m)._overflowWeekday&&overflow===-1){overflow=WEEKDAY}getParsingFlags(m).overflow=overflow}return m}function defaults(a,b,c){if(a!=null){return a}if(b!=null){return b}return c}function currentDateArray(config){var nowValue=new Date(hooks.now());if(config._useUTC){return[nowValue.getUTCFullYear(),nowValue.getUTCMonth(),nowValue.getUTCDate()]}return[nowValue.getFullYear(),nowValue.getMonth(),nowValue.getDate()]}function configFromArray(config){var i,date,input=[],currentDate,yearToUse;if(config._d){return}currentDate=currentDateArray(config);if(config._w&&config._a[DATE]==null&&config._a[MONTH]==null){dayOfYearFromWeekInfo(config)}if(config._dayOfYear!=null){yearToUse=defaults(config._a[YEAR],currentDate[YEAR]);if(config._dayOfYear>daysInYear(yearToUse)||config._dayOfYear===0){getParsingFlags(config)._overflowDayOfYear=true}date=createUTCDate(yearToUse,0,config._dayOfYear);config._a[MONTH]=date.getUTCMonth();config._a[DATE]=date.getUTCDate()}for(i=0;i<3&&config._a[i]==null;++i){config._a[i]=input[i]=currentDate[i]}for(;i<7;i++){config._a[i]=input[i]=config._a[i]==null?i===2?1:0:config._a[i]}if(config._a[HOUR]===24&&config._a[MINUTE]===0&&config._a[SECOND]===0&&config._a[MILLISECOND]===0){config._nextDay=true;config._a[HOUR]=0}config._d=(config._useUTC?createUTCDate:createDate).apply(null,input);if(config._tzm!=null){config._d.setUTCMinutes(config._d.getUTCMinutes()-config._tzm)}if(config._nextDay){config._a[HOUR]=24}if(config._w&&typeof config._w.d!=='undefined'&&config._w.d!==config._d.getDay()){getParsingFlags(config).weekdayMismatch=true}}function dayOfYearFromWeekInfo(config){var w,weekYear,week,weekday,dow,doy,temp,weekdayOverflow;w=config._w;if(w.GG!=null||w.W!=null||w.E!=null){dow=1;doy=4;weekYear=defaults(w.GG,config._a[YEAR],weekOfYear(createLocal(),1,4).year);week=defaults(w.W,1);weekday=defaults(w.E,1);if(weekday<1||weekday>7){weekdayOverflow=true}}else{dow=config._locale._week.dow;doy=config._locale._week.doy;var curWeek=weekOfYear(createLocal(),dow,doy);weekYear=defaults(w.gg,config._a[YEAR],curWeek.year);week=defaults(w.w,curWeek.week);if(w.d!=null){weekday=w.d;if(weekday<0||weekday>6){weekdayOverflow=true}}else if(w.e!=null){weekday=w.e+dow;if(w.e<0||w.e>6){weekdayOverflow=true}}else{weekday=dow}}if(week<1||week>weeksInYear(weekYear,dow,doy)){getParsingFlags(config)._overflowWeeks=true}else if(weekdayOverflow!=null){getParsingFlags(config)._overflowWeekday=true}else{temp=dayOfYearFromWeeks(weekYear,week,weekday,dow,doy);config._a[YEAR]=temp.year;config._dayOfYear=temp.dayOfYear}}var extendedIsoRegex=/^\s*((?:[+-]\d{6}|\d{4})-(?:\d\d-\d\d|W\d\d-\d|W\d\d|\d\d\d|\d\d))(?:(T| )(\d\d(?::\d\d(?::\d\d(?:[.,]\d+)?)?)?)([\+\-]\d\d(?::?\d\d)?|\s*Z)?)?$/;var basicIsoRegex=/^\s*((?:[+-]\d{6}|\d{4})(?:\d\d\d\d|W\d\d\d|W\d\d|\d\d\d|\d\d))(?:(T| )(\d\d(?:\d\d(?:\d\d(?:[.,]\d+)?)?)?)([\+\-]\d\d(?::?\d\d)?|\s*Z)?)?$/;var tzRegex=/Z|[+-]\d\d(?::?\d\d)?/;var isoDates=[['YYYYYY-MM-DD',/[+-]\d{6}-\d\d-\d\d/],['YYYY-MM-DD',/\d{4}-\d\d-\d\d/],['GGGG-[W]WW-E',/\d{4}-W\d\d-\d/],['GGGG-[W]WW',/\d{4}-W\d\d/,false],['YYYY-DDD',/\d{4}-\d{3}/],['YYYY-MM',/\d{4}-\d\d/,false],['YYYYYYMMDD',/[+-]\d{10}/],['YYYYMMDD',/\d{8}/],['GGGG[W]WWE',/\d{4}W\d{3}/],['GGGG[W]WW',/\d{4}W\d{2}/,false],['YYYYDDD',/\d{7}/]];var isoTimes=[['HH:mm:ss.SSSS',/\d\d:\d\d:\d\d\.\d+/],['HH:mm:ss,SSSS',/\d\d:\d\d:\d\d,\d+/],['HH:mm:ss',/\d\d:\d\d:\d\d/],['HH:mm',/\d\d:\d\d/],['HHmmss.SSSS',/\d\d\d\d\d\d\.\d+/],['HHmmss,SSSS',/\d\d\d\d\d\d,\d+/],['HHmmss',/\d\d\d\d\d\d/],['HHmm',/\d\d\d\d/],['HH',/\d\d/]];var aspNetJsonRegex=/^\/?Date\((\-?\d+)/i;function configFromISO(config){var i,l,string=config._i,match=extendedIsoRegex.exec(string)||basicIsoRegex.exec(string),allowTime,dateFormat,timeFormat,tzFormat;if(match){getParsingFlags(config).iso=true;for(i=0,l=isoDates.length;i<l;i++){if(isoDates[i][1].exec(match[1])){dateFormat=isoDates[i][0];allowTime=isoDates[i][2]!==false;break}}if(dateFormat==null){config._isValid=false;return}if(match[3]){for(i=0,l=isoTimes.length;i<l;i++){if(isoTimes[i][1].exec(match[3])){timeFormat=(match[2]||' ')+isoTimes[i][0];break}}if(timeFormat==null){config._isValid=false;return}}if(!allowTime&&timeFormat!=null){config._isValid=false;return}if(match[4]){if(tzRegex.exec(match[4])){tzFormat='Z'}else{config._isValid=false;return}}config._f=dateFormat+(timeFormat||'')+(tzFormat||'');configFromStringAndFormat(config)}else{config._isValid=false}}var rfc2822=/^(?:(Mon|Tue|Wed|Thu|Fri|Sat|Sun),?\s)?(\d{1,2})\s(Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Oct|Nov|Dec)\s(\d{2,4})\s(\d\d):(\d\d)(?::(\d\d))?\s(?:(UT|GMT|[ECMP][SD]T)|([Zz])|([+-]\d{4}))$/;function extractFromRFC2822Strings(yearStr,monthStr,dayStr,hourStr,minuteStr,secondStr){var result=[untruncateYear(yearStr),defaultLocaleMonthsShort.indexOf(monthStr),parseInt(dayStr,10),parseInt(hourStr,10),parseInt(minuteStr,10)];if(secondStr){result.push(parseInt(secondStr,10))}return result}function untruncateYear(yearStr){var year=parseInt(yearStr,10);if(year<=49){return 2000+year}else if(year<=999){return 1900+year}return year}function preprocessRFC2822(s){return s.replace(/\([^)]*\)|[\n\t]/g,' ').replace(/(\s\s+)/g,' ').trim()}function checkWeekday(weekdayStr,parsedInput,config){if(weekdayStr){var weekdayProvided=defaultLocaleWeekdaysShort.indexOf(weekdayStr),weekdayActual=new Date(parsedInput[0],parsedInput[1],parsedInput[2]).getDay();if(weekdayProvided!==weekdayActual){getParsingFlags(config).weekdayMismatch=true;config._isValid=false;return false}}return true}var obsOffsets={UT:0,GMT:0,EDT:-4*60,EST:-5*60,CDT:-5*60,CST:-6*60,MDT:-6*60,MST:-7*60,PDT:-7*60,PST:-8*60};function calculateOffset(obsOffset,militaryOffset,numOffset){if(obsOffset){return obsOffsets[obsOffset]}else if(militaryOffset){return 0}else{var hm=parseInt(numOffset,10);var m=hm%100,h=(hm-m)/100;return h*60+m}}function configFromRFC2822(config){var match=rfc2822.exec(preprocessRFC2822(config._i));if(match){var parsedArray=extractFromRFC2822Strings(match[4],match[3],match[2],match[5],match[6],match[7]);if(!checkWeekday(match[1],parsedArray,config)){return}config._a=parsedArray;config._tzm=calculateOffset(match[8],match[9],match[10]);config._d=createUTCDate.apply(null,config._a);config._d.setUTCMinutes(config._d.getUTCMinutes()-config._tzm);getParsingFlags(config).rfc2822=true}else{config._isValid=false}}function configFromString(config){var matched=aspNetJsonRegex.exec(config._i);if(matched!==null){config._d=new Date(+matched[1]);return}configFromISO(config);if(config._isValid===false){delete config._isValid}else{return}configFromRFC2822(config);if(config._isValid===false){delete config._isValid}else{return}hooks.createFromInputFallback(config)}hooks.createFromInputFallback=deprecate('value provided is not in a recognized RFC2822 or ISO format. moment construction falls back to js Date(), '+'which is not reliable across all browsers and versions. Non RFC2822/ISO date formats are '+'discouraged and will be removed in an upcoming major release. Please refer to '+'http://momentjs.com/guides/#/warnings/js-date/ for more info.',function(config){config._d=new Date(config._i+(config._useUTC?' UTC':''))});hooks.ISO_8601=function(){};hooks.RFC_2822=function(){};function configFromStringAndFormat(config){if(config._f===hooks.ISO_8601){configFromISO(config);return}if(config._f===hooks.RFC_2822){configFromRFC2822(config);return}config._a=[];getParsingFlags(config).empty=true;var string=''+config._i,i,parsedInput,tokens,token,skipped,stringLength=string.length,totalParsedInputLength=0;tokens=expandFormat(config._f,config._locale).match(formattingTokens)||[];for(i=0;i<tokens.length;i++){token=tokens[i];parsedInput=(string.match(getParseRegexForToken(token,config))||[])[0];if(parsedInput){skipped=string.substr(0,string.indexOf(parsedInput));if(skipped.length>0){getParsingFlags(config).unusedInput.push(skipped)}string=string.slice(string.indexOf(parsedInput)+parsedInput.length);totalParsedInputLength+=parsedInput.length}if(formatTokenFunctions[token]){if(parsedInput){getParsingFlags(config).empty=false}else{getParsingFlags(config).unusedTokens.push(token)}addTimeToArrayFromToken(token,parsedInput,config)}else if(config._strict&&!parsedInput){getParsingFlags(config).unusedTokens.push(token)}}getParsingFlags(config).charsLeftOver=stringLength-totalParsedInputLength;if(string.length>0){getParsingFlags(config).unusedInput.push(string)}if(config._a[HOUR]<=12&&getParsingFlags(config).bigHour===true&&config._a[HOUR]>0){getParsingFlags(config).bigHour=undefined}getParsingFlags(config).parsedDateParts=config._a.slice(0);getParsingFlags(config).meridiem=config._meridiem;config._a[HOUR]=meridiemFixWrap(config._locale,config._a[HOUR],config._meridiem);configFromArray(config);checkOverflow(config)}function meridiemFixWrap(locale,hour,meridiem){var isPm;if(meridiem==null){return hour}if(locale.meridiemHour!=null){return locale.meridiemHour(hour,meridiem)}else if(locale.isPM!=null){isPm=locale.isPM(meridiem);if(isPm&&hour<12){hour+=12}if(!isPm&&hour===12){hour=0}return hour}else{return hour}}function configFromStringAndArray(config){var tempConfig,bestMoment,scoreToBeat,i,currentScore;if(config._f.length===0){getParsingFlags(config).invalidFormat=true;config._d=new Date(NaN);return}for(i=0;i<config._f.length;i++){currentScore=0;tempConfig=copyConfig({},config);if(config._useUTC!=null){tempConfig._useUTC=config._useUTC}tempConfig._f=config._f[i];configFromStringAndFormat(tempConfig);if(!isValid(tempConfig)){continue}currentScore+=getParsingFlags(tempConfig).charsLeftOver;currentScore+=getParsingFlags(tempConfig).unusedTokens.length*10;getParsingFlags(tempConfig).score=currentScore;if(scoreToBeat==null||currentScore<scoreToBeat){scoreToBeat=currentScore;bestMoment=tempConfig}}extend(config,bestMoment||tempConfig)}function configFromObject(config){if(config._d){return}var i=normalizeObjectUnits(config._i);config._a=map([i.year,i.month,i.day||i.date,i.hour,i.minute,i.second,i.millisecond],function(obj){return obj&&parseInt(obj,10)});configFromArray(config)}function createFromConfig(config){var res=new Moment(checkOverflow(prepareConfig(config)));if(res._nextDay){res.add(1,'d');res._nextDay=undefined}return res}function prepareConfig(config){var input=config._i,format=config._f;config._locale=config._locale||getLocale(config._l);if(input===null||format===undefined&&input===''){return createInvalid({nullInput:true})}if(typeof input==='string'){config._i=input=config._locale.preparse(input)}if(isMoment(input)){return new Moment(checkOverflow(input))}else if(isDate(input)){config._d=input}else if(isArray(format)){configFromStringAndArray(config)}else if(format){configFromStringAndFormat(config)}else{configFromInput(config)}if(!isValid(config)){config._d=null}return config}function configFromInput(config){var input=config._i;if(isUndefined(input)){config._d=new Date(hooks.now())}else if(isDate(input)){config._d=new Date(input.valueOf())}else if(typeof input==='string'){configFromString(config)}else if(isArray(input)){config._a=map(input.slice(0),function(obj){return parseInt(obj,10)});configFromArray(config)}else if(isObject(input)){configFromObject(config)}else if(isNumber(input)){config._d=new Date(input)}else{hooks.createFromInputFallback(config)}}function createLocalOrUTC(input,format,locale,strict,isUTC){var c={};if(locale===true||locale===false){strict=locale;locale=undefined}if(isObject(input)&&isObjectEmpty(input)||isArray(input)&&input.length===0){input=undefined}c._isAMomentObject=true;c._useUTC=c._isUTC=isUTC;c._l=locale;c._i=input;c._f=format;c._strict=strict;return createFromConfig(c)}function createLocal(input,format,locale,strict){return createLocalOrUTC(input,format,locale,strict,false)}var prototypeMin=deprecate('moment().min is deprecated, use moment.max instead. http://momentjs.com/guides/#/warnings/min-max/',function(){var other=createLocal.apply(null,arguments);if(this.isValid()&&other.isValid()){return other<this?this:other}else{return createInvalid()}});var prototypeMax=deprecate('moment().max is deprecated, use moment.min instead. http://momentjs.com/guides/#/warnings/min-max/',function(){var other=createLocal.apply(null,arguments);if(this.isValid()&&other.isValid()){return other>this?this:other}else{return createInvalid()}});function pickBy(fn,moments){var res,i;if(moments.length===1&&isArray(moments[0])){moments=moments[0]}if(!moments.length){return createLocal()}res=moments[0];for(i=1;i<moments.length;++i){if(!moments[i].isValid()||moments[i][fn](res)){res=moments[i]}}return res}function min(){var args=[].slice.call(arguments,0);return pickBy('isBefore',args)}function max(){var args=[].slice.call(arguments,0);return pickBy('isAfter',args)}var now=function(){return Date.now?Date.now():+new Date};var ordering=['year','quarter','month','week','day','hour','minute','second','millisecond'];function isDurationValid(m){for(var key in m){if(!(indexOf.call(ordering,key)!==-1&&(m[key]==null||!isNaN(m[key])))){return false}}var unitHasDecimal=false;for(var i=0;i<ordering.length;++i){if(m[ordering[i]]){if(unitHasDecimal){return false}if(parseFloat(m[ordering[i]])!==toInt(m[ordering[i]])){unitHasDecimal=true}}}return true}function isValid$1(){return this._isValid}function createInvalid$1(){return createDuration(NaN)}function Duration(duration){var normalizedInput=normalizeObjectUnits(duration),years=normalizedInput.year||0,quarters=normalizedInput.quarter||0,months=normalizedInput.month||0,weeks=normalizedInput.week||0,days=normalizedInput.day||0,hours=normalizedInput.hour||0,minutes=normalizedInput.minute||0,seconds=normalizedInput.second||0,milliseconds=normalizedInput.millisecond||0;this._isValid=isDurationValid(normalizedInput);this._milliseconds=+milliseconds+seconds*1000+minutes*60000+hours*1000*60*60;this._days=+days+weeks*7;this._months=+months+quarters*3+years*12;this._data={};this._locale=getLocale();this._bubble()}function isDuration(obj){return obj instanceof Duration}function absRound(number){if(number<0){return Math.round(-1*number)*-1}else{return Math.round(number)}}function offset(token,separator){addFormatToken(token,0,0,function(){var offset=this.utcOffset();var sign='+';if(offset<0){offset=-offset;sign='-'}return sign+zeroFill(~~(offset/60),2)+separator+zeroFill(~~offset%60,2)})}offset('Z',':');offset('ZZ','');addRegexToken('Z',matchShortOffset);addRegexToken('ZZ',matchShortOffset);addParseToken(['Z','ZZ'],function(input,array,config){config._useUTC=true;config._tzm=offsetFromString(matchShortOffset,input)});var chunkOffset=/([\+\-]|\d\d)/gi;function offsetFromString(matcher,string){var matches=(string||'').match(matcher);if(matches===null){return null}var chunk=matches[matches.length-1]||[];var parts=(chunk+'').match(chunkOffset)||['-',0,0];var minutes=+(parts[1]*60)+toInt(parts[2]);return minutes===0?0:parts[0]==='+'?minutes:-minutes}function cloneWithOffset(input,model){var res,diff;if(model._isUTC){res=model.clone();diff=(isMoment(input)||isDate(input)?input.valueOf():createLocal(input).valueOf())-res.valueOf();res._d.setTime(res._d.valueOf()+diff);hooks.updateOffset(res,false);return res}else{return createLocal(input).local()}}function getDateOffset(m){return-Math.round(m._d.getTimezoneOffset()/15)*15}hooks.updateOffset=function(){};function getSetOffset(input,keepLocalTime,keepMinutes){var offset=this._offset||0,localAdjust;if(!this.isValid()){return input!=null?this:NaN}if(input!=null){if(typeof input==='string'){input=offsetFromString(matchShortOffset,input);if(input===null){return this}}else if(Math.abs(input)<16&&!keepMinutes){input=input*60}if(!this._isUTC&&keepLocalTime){localAdjust=getDateOffset(this)}this._offset=input;this._isUTC=true;if(localAdjust!=null){this.add(localAdjust,'m')}if(offset!==input){if(!keepLocalTime||this._changeInProgress){addSubtract(this,createDuration(input-offset,'m'),1,false)}else if(!this._changeInProgress){this._changeInProgress=true;hooks.updateOffset(this,true);this._changeInProgress=null}}return this}else{return this._isUTC?offset:getDateOffset(this)}}function getSetZone(input,keepLocalTime){if(input!=null){if(typeof input!=='string'){input=-input}this.utcOffset(input,keepLocalTime);return this}else{return-this.utcOffset()}}function setOffsetToUTC(keepLocalTime){return this.utcOffset(0,keepLocalTime)}function setOffsetToLocal(keepLocalTime){if(this._isUTC){this.utcOffset(0,keepLocalTime);this._isUTC=false;if(keepLocalTime){this.subtract(getDateOffset(this),'m')}}return this}function setOffsetToParsedOffset(){if(this._tzm!=null){this.utcOffset(this._tzm,false,true)}else if(typeof this._i==='string'){var tZone=offsetFromString(matchOffset,this._i);if(tZone!=null){this.utcOffset(tZone)}else{this.utcOffset(0,true)}}return this}function hasAlignedHourOffset(input){if(!this.isValid()){return false}input=input?createLocal(input).utcOffset():0;return(this.utcOffset()-input)%60===0}function isDaylightSavingTime(){return this.utcOffset()>this.clone().month(0).utcOffset()||this.utcOffset()>this.clone().month(5).utcOffset()}function isDaylightSavingTimeShifted(){if(!isUndefined(this._isDSTShifted)){return this._isDSTShifted}var c={};copyConfig(c,this);c=prepareConfig(c);if(c._a){var other=c._isUTC?createUTC(c._a):createLocal(c._a);this._isDSTShifted=this.isValid()&&compareArrays(c._a,other.toArray())>0}else{this._isDSTShifted=false}return this._isDSTShifted}function isLocal(){return this.isValid()?!this._isUTC:false}function isUtcOffset(){return this.isValid()?this._isUTC:false}function isUtc(){return this.isValid()?this._isUTC&&this._offset===0:false}var aspNetRegex=/^(\-|\+)?(?:(\d*)[. ])?(\d+)\:(\d+)(?:\:(\d+)(\.\d*)?)?$/;var isoRegex=/^(-|\+)?P(?:([-+]?[0-9,.]*)Y)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)W)?(?:([-+]?[0-9,.]*)D)?(?:T(?:([-+]?[0-9,.]*)H)?(?:([-+]?[0-9,.]*)M)?(?:([-+]?[0-9,.]*)S)?)?$/;function createDuration(input,key){var duration=input,match=null,sign,ret,diffRes;if(isDuration(input)){duration={ms:input._milliseconds,d:input._days,M:input._months}}else if(isNumber(input)){duration={};if(key){duration[key]=input}else{duration.milliseconds=input}}else if(!!(match=aspNetRegex.exec(input))){sign=match[1]==='-'?-1:1;duration={y:0,d:toInt(match[DATE])*sign,h:toInt(match[HOUR])*sign,m:toInt(match[MINUTE])*sign,s:toInt(match[SECOND])*sign,ms:toInt(absRound(match[MILLISECOND]*1000))*sign}}else if(!!(match=isoRegex.exec(input))){sign=match[1]==='-'?-1:match[1]==='+'?1:1;duration={y:parseIso(match[2],sign),M:parseIso(match[3],sign),w:parseIso(match[4],sign),d:parseIso(match[5],sign),h:parseIso(match[6],sign),m:parseIso(match[7],sign),s:parseIso(match[8],sign)}}else if(duration==null){duration={}}else if(typeof duration==='object'&&('from'in duration||'to'in duration)){diffRes=momentsDifference(createLocal(duration.from),createLocal(duration.to));duration={};duration.ms=diffRes.milliseconds;duration.M=diffRes.months}ret=new Duration(duration);if(isDuration(input)&&hasOwnProp(input,'_locale')){ret._locale=input._locale}return ret}createDuration.fn=Duration.prototype;createDuration.invalid=createInvalid$1;function parseIso(inp,sign){var res=inp&&parseFloat(inp.replace(',','.'));return(isNaN(res)?0:res)*sign}function positiveMomentsDifference(base,other){var res={milliseconds:0,months:0};res.months=other.month()-base.month()+(other.year()-base.year())*12;if(base.clone().add(res.months,'M').isAfter(other)){--res.months}res.milliseconds=+other-+base.clone().add(res.months,'M');return res}function momentsDifference(base,other){var res;if(!(base.isValid()&&other.isValid())){return{milliseconds:0,months:0}}other=cloneWithOffset(other,base);if(base.isBefore(other)){res=positiveMomentsDifference(base,other)}else{res=positiveMomentsDifference(other,base);res.milliseconds=-res.milliseconds;res.months=-res.months}return res}function createAdder(direction,name){return function(val,period){var dur,tmp;if(period!==null&&!isNaN(+period)){deprecateSimple(name,'moment().'+name+'(period, number) is deprecated. Please use moment().'+name+'(number, period). '+'See http://momentjs.com/guides/#/warnings/add-inverted-param/ for more info.');tmp=val;val=period;period=tmp}val=typeof val==='string'?+val:val;dur=createDuration(val,period);addSubtract(this,dur,direction);return this}}function addSubtract(mom,duration,isAdding,updateOffset){var milliseconds=duration._milliseconds,days=absRound(duration._days),months=absRound(duration._months);if(!mom.isValid()){return}updateOffset=updateOffset==null?true:updateOffset;if(months){setMonth(mom,get(mom,'Month')+months*isAdding)}if(days){set$1(mom,'Date',get(mom,'Date')+days*isAdding)}if(milliseconds){mom._d.setTime(mom._d.valueOf()+milliseconds*isAdding)}if(updateOffset){hooks.updateOffset(mom,days||months)}}var add=createAdder(1,'add');var subtract=createAdder(-1,'subtract');function getCalendarFormat(myMoment,now){var diff=myMoment.diff(now,'days',true);return diff<-6?'sameElse':diff<-1?'lastWeek':diff<0?'lastDay':diff<1?'sameDay':diff<2?'nextDay':diff<7?'nextWeek':'sameElse'}function calendar$1(time,formats){var now=time||createLocal(),sod=cloneWithOffset(now,this).startOf('day'),format=hooks.calendarFormat(this,sod)||'sameElse';var output=formats&&(isFunction(formats[format])?formats[format].call(this,now):formats[format]);return this.format(output||this.localeData().calendar(format,this,createLocal(now)))}function clone(){return new Moment(this)}function isAfter(input,units){var localInput=isMoment(input)?input:createLocal(input);if(!(this.isValid()&&localInput.isValid())){return false}units=normalizeUnits(!isUndefined(units)?units:'millisecond');if(units==='millisecond'){return this.valueOf()>localInput.valueOf()}else{return localInput.valueOf()<this.clone().startOf(units).valueOf()}}function isBefore(input,units){var localInput=isMoment(input)?input:createLocal(input);if(!(this.isValid()&&localInput.isValid())){return false}units=normalizeUnits(!isUndefined(units)?units:'millisecond');if(units==='millisecond'){return this.valueOf()<localInput.valueOf()}else{return this.clone().endOf(units).valueOf()<localInput.valueOf()}}function isBetween(from,to,units,inclusivity){inclusivity=inclusivity||'()';return(inclusivity[0]==='('?this.isAfter(from,units):!this.isBefore(from,units))&&(inclusivity[1]===')'?this.isBefore(to,units):!this.isAfter(to,units))}function isSame(input,units){var localInput=isMoment(input)?input:createLocal(input),inputMs;if(!(this.isValid()&&localInput.isValid())){return false}units=normalizeUnits(units||'millisecond');if(units==='millisecond'){return this.valueOf()===localInput.valueOf()}else{inputMs=localInput.valueOf();return this.clone().startOf(units).valueOf()<=inputMs&&inputMs<=this.clone().endOf(units).valueOf()}}function isSameOrAfter(input,units){return this.isSame(input,units)||this.isAfter(input,units)}function isSameOrBefore(input,units){return this.isSame(input,units)||this.isBefore(input,units)}function diff(input,units,asFloat){var that,zoneDelta,delta,output;if(!this.isValid()){return NaN}that=cloneWithOffset(input,this);if(!that.isValid()){return NaN}zoneDelta=(that.utcOffset()-this.utcOffset())*60000;units=normalizeUnits(units);switch(units){case'year':output=monthDiff(this,that)/12;break;case'month':output=monthDiff(this,that);break;case'quarter':output=monthDiff(this,that)/3;break;case'second':output=(this-that)/1000;break;case'minute':output=(this-that)/60000;break;case'hour':output=(this-that)/3600000;break;case'day':output=(this-that-zoneDelta)/86400000;break;case'week':output=(this-that-zoneDelta)/604800000;break;default:output=this-that}return asFloat?output:absFloor(output)}function monthDiff(a,b){var wholeMonthDiff=(b.year()-a.year())*12+(b.month()-a.month()),anchor=a.clone().add(wholeMonthDiff,'months'),anchor2,adjust;if(b-anchor<0){anchor2=a.clone().add(wholeMonthDiff-1,'months');adjust=(b-anchor)/(anchor-anchor2)}else{anchor2=a.clone().add(wholeMonthDiff+1,'months');adjust=(b-anchor)/(anchor2-anchor)}return-(wholeMonthDiff+adjust)||0}hooks.defaultFormat='YYYY-MM-DDTHH:mm:ssZ';hooks.defaultFormatUtc='YYYY-MM-DDTHH:mm:ss[Z]';function toString(){return this.clone().locale('en').format('ddd MMM DD YYYY HH:mm:ss [GMT]ZZ')}function toISOString(){if(!this.isValid()){return null}var m=this.clone().utc();if(m.year()<0||m.year()>9999){return formatMoment(m,'YYYYYY-MM-DD[T]HH:mm:ss.SSS[Z]')}if(isFunction(Date.prototype.toISOString)){return this.toDate().toISOString()}return formatMoment(m,'YYYY-MM-DD[T]HH:mm:ss.SSS[Z]')}function inspect(){if(!this.isValid()){return'moment.invalid(/* '+this._i+' */)'}var func='moment';var zone='';if(!this.isLocal()){func=this.utcOffset()===0?'moment.utc':'moment.parseZone';zone='Z'}var prefix='['+func+'("]';var year=0<=this.year()&&this.year()<=9999?'YYYY':'YYYYYY';var datetime='-MM-DD[T]HH:mm:ss.SSS';var suffix=zone+'[")]';return this.format(prefix+year+datetime+suffix)}function format(inputString){if(!inputString){inputString=this.isUtc()?hooks.defaultFormatUtc:hooks.defaultFormat}var output=formatMoment(this,inputString);return this.localeData().postformat(output)}function from(time,withoutSuffix){if(this.isValid()&&(isMoment(time)&&time.isValid()||createLocal(time).isValid())){return createDuration({to:this,from:time}).locale(this.locale()).humanize(!withoutSuffix)}else{return this.localeData().invalidDate()}}function fromNow(withoutSuffix){return this.from(createLocal(),withoutSuffix)}function to(time,withoutSuffix){if(this.isValid()&&(isMoment(time)&&time.isValid()||createLocal(time).isValid())){return createDuration({from:this,to:time}).locale(this.locale()).humanize(!withoutSuffix)}else{return this.localeData().invalidDate()}}function toNow(withoutSuffix){return this.to(createLocal(),withoutSuffix)}function locale(key){var newLocaleData;if(key===undefined){return this._locale._abbr}else{newLocaleData=getLocale(key);if(newLocaleData!=null){this._locale=newLocaleData}return this}}var lang=deprecate('moment().lang() is deprecated. Instead, use moment().localeData() to get the language configuration. Use moment().locale() to change languages.',function(key){if(key===undefined){return this.localeData()}else{return this.locale(key)}});function localeData(){return this._locale}function startOf(units){units=normalizeUnits(units);switch(units){case'year':this.month(0);case'quarter':case'month':this.date(1);case'week':case'isoWeek':case'day':case'date':this.hours(0);case'hour':this.minutes(0);case'minute':this.seconds(0);case'second':this.milliseconds(0)}if(units==='week'){this.weekday(0)}if(units==='isoWeek'){this.isoWeekday(1)}if(units==='quarter'){this.month(Math.floor(this.month()/3)*3)}return this}function endOf(units){units=normalizeUnits(units);if(units===undefined||units==='millisecond'){return this}if(units==='date'){units='day'}return this.startOf(units).add(1,units==='isoWeek'?'week':units).subtract(1,'ms')}function valueOf(){return this._d.valueOf()-(this._offset||0)*60000}function unix(){return Math.floor(this.valueOf()/1000)}function toDate(){return new Date(this.valueOf())}function toArray(){var m=this;return[m.year(),m.month(),m.date(),m.hour(),m.minute(),m.second(),m.millisecond()]}function toObject(){var m=this;return{years:m.year(),months:m.month(),date:m.date(),hours:m.hours(),minutes:m.minutes(),seconds:m.seconds(),milliseconds:m.milliseconds()}}function toJSON(){return this.isValid()?this.toISOString():null}function isValid$2(){return isValid(this)}function parsingFlags(){return extend({},getParsingFlags(this))}function invalidAt(){return getParsingFlags(this).overflow}function creationData(){return{input:this._i,format:this._f,locale:this._locale,isUTC:this._isUTC,strict:this._strict}}addFormatToken(0,['gg',2],0,function(){return this.weekYear()%100});addFormatToken(0,['GG',2],0,function(){return this.isoWeekYear()%100});function addWeekYearFormatToken(token,getter){addFormatToken(0,[token,token.length],0,getter)}addWeekYearFormatToken('gggg','weekYear');addWeekYearFormatToken('ggggg','weekYear');addWeekYearFormatToken('GGGG','isoWeekYear');addWeekYearFormatToken('GGGGG','isoWeekYear');addUnitAlias('weekYear','gg');addUnitAlias('isoWeekYear','GG');addUnitPriority('weekYear',1);addUnitPriority('isoWeekYear',1);addRegexToken('G',matchSigned);addRegexToken('g',matchSigned);addRegexToken('GG',match1to2,match2);addRegexToken('gg',match1to2,match2);addRegexToken('GGGG',match1to4,match4);addRegexToken('gggg',match1to4,match4);addRegexToken('GGGGG',match1to6,match6);addRegexToken('ggggg',match1to6,match6);addWeekParseToken(['gggg','ggggg','GGGG','GGGGG'],function(input,week,config,token){week[token.substr(0,2)]=toInt(input)});addWeekParseToken(['gg','GG'],function(input,week,config,token){week[token]=hooks.parseTwoDigitYear(input)});function getSetWeekYear(input){return getSetWeekYearHelper.call(this,input,this.week(),this.weekday(),this.localeData()._week.dow,this.localeData()._week.doy)}function getSetISOWeekYear(input){return getSetWeekYearHelper.call(this,input,this.isoWeek(),this.isoWeekday(),1,4)}function getISOWeeksInYear(){return weeksInYear(this.year(),1,4)}function getWeeksInYear(){var weekInfo=this.localeData()._week;return weeksInYear(this.year(),weekInfo.dow,weekInfo.doy)}function getSetWeekYearHelper(input,week,weekday,dow,doy){var weeksTarget;if(input==null){return weekOfYear(this,dow,doy).year}else{weeksTarget=weeksInYear(input,dow,doy);if(week>weeksTarget){week=weeksTarget}return setWeekAll.call(this,input,week,weekday,dow,doy)}}function setWeekAll(weekYear,week,weekday,dow,doy){var dayOfYearData=dayOfYearFromWeeks(weekYear,week,weekday,dow,doy),date=createUTCDate(dayOfYearData.year,0,dayOfYearData.dayOfYear);this.year(date.getUTCFullYear());this.month(date.getUTCMonth());this.date(date.getUTCDate());return this}addFormatToken('Q',0,'Qo','quarter');addUnitAlias('quarter','Q');addUnitPriority('quarter',7);addRegexToken('Q',match1);addParseToken('Q',function(input,array){array[MONTH]=(toInt(input)-1)*3});function getSetQuarter(input){return input==null?Math.ceil((this.month()+1)/3):this.month((input-1)*3+this.month()%3)}addFormatToken('D',['DD',2],'Do','date');addUnitAlias('date','D');addUnitPriority('date',9);addRegexToken('D',match1to2);addRegexToken('DD',match1to2,match2);addRegexToken('Do',function(isStrict,locale){return isStrict?locale._dayOfMonthOrdinalParse||locale._ordinalParse:locale._dayOfMonthOrdinalParseLenient});addParseToken(['D','DD'],DATE);addParseToken('Do',function(input,array){array[DATE]=toInt(input.match(match1to2)[0],10)});var getSetDayOfMonth=makeGetSet('Date',true);addFormatToken('DDD',['DDDD',3],'DDDo','dayOfYear');addUnitAlias('dayOfYear','DDD');addUnitPriority('dayOfYear',4);addRegexToken('DDD',match1to3);addRegexToken('DDDD',match3);addParseToken(['DDD','DDDD'],function(input,array,config){config._dayOfYear=toInt(input)});function getSetDayOfYear(input){var dayOfYear=Math.round((this.clone().startOf('day')-this.clone().startOf('year'))/86400000)+1;return input==null?dayOfYear:this.add(input-dayOfYear,'d')}addFormatToken('m',['mm',2],0,'minute');addUnitAlias('minute','m');addUnitPriority('minute',14);addRegexToken('m',match1to2);addRegexToken('mm',match1to2,match2);addParseToken(['m','mm'],MINUTE);var getSetMinute=makeGetSet('Minutes',false);addFormatToken('s',['ss',2],0,'second');addUnitAlias('second','s');addUnitPriority('second',15);addRegexToken('s',match1to2);addRegexToken('ss',match1to2,match2);addParseToken(['s','ss'],SECOND);var getSetSecond=makeGetSet('Seconds',false);addFormatToken('S',0,0,function(){return~~(this.millisecond()/100)});addFormatToken(0,['SS',2],0,function(){return~~(this.millisecond()/10)});addFormatToken(0,['SSS',3],0,'millisecond');addFormatToken(0,['SSSS',4],0,function(){return this.millisecond()*10});addFormatToken(0,['SSSSS',5],0,function(){return this.millisecond()*100});addFormatToken(0,['SSSSSS',6],0,function(){return this.millisecond()*1000});addFormatToken(0,['SSSSSSS',7],0,function(){return this.millisecond()*10000});addFormatToken(0,['SSSSSSSS',8],0,function(){return this.millisecond()*100000});addFormatToken(0,['SSSSSSSSS',9],0,function(){return this.millisecond()*1000000});addUnitAlias('millisecond','ms');addUnitPriority('millisecond',16);addRegexToken('S',match1to3,match1);addRegexToken('SS',match1to3,match2);addRegexToken('SSS',match1to3,match3);var token;for(token='SSSS';token.length<=9;token+='S'){addRegexToken(token,matchUnsigned)}function parseMs(input,array){array[MILLISECOND]=toInt(('0.'+input)*1000)}for(token='S';token.length<=9;token+='S'){addParseToken(token,parseMs)}var getSetMillisecond=makeGetSet('Milliseconds',false);addFormatToken('z',0,0,'zoneAbbr');addFormatToken('zz',0,0,'zoneName');function getZoneAbbr(){return this._isUTC?'UTC':''}function getZoneName(){return this._isUTC?'Coordinated Universal Time':''}var proto=Moment.prototype;proto.add=add;proto.calendar=calendar$1;proto.clone=clone;proto.diff=diff;proto.endOf=endOf;proto.format=format;proto.from=from;proto.fromNow=fromNow;proto.to=to;proto.toNow=toNow;proto.get=stringGet;proto.invalidAt=invalidAt;proto.isAfter=isAfter;proto.isBefore=isBefore;proto.isBetween=isBetween;proto.isSame=isSame;proto.isSameOrAfter=isSameOrAfter;proto.isSameOrBefore=isSameOrBefore;proto.isValid=isValid$2;proto.lang=lang;proto.locale=locale;proto.localeData=localeData;proto.max=prototypeMax;proto.min=prototypeMin;proto.parsingFlags=parsingFlags;proto.set=stringSet;proto.startOf=startOf;proto.subtract=subtract;proto.toArray=toArray;proto.toObject=toObject;proto.toDate=toDate;proto.toISOString=toISOString;proto.inspect=inspect;proto.toJSON=toJSON;proto.toString=toString;proto.unix=unix;proto.valueOf=valueOf;proto.creationData=creationData;proto.year=getSetYear;proto.isLeapYear=getIsLeapYear;proto.weekYear=getSetWeekYear;proto.isoWeekYear=getSetISOWeekYear;proto.quarter=proto.quarters=getSetQuarter;proto.month=getSetMonth;proto.daysInMonth=getDaysInMonth;proto.week=proto.weeks=getSetWeek;proto.isoWeek=proto.isoWeeks=getSetISOWeek;proto.weeksInYear=getWeeksInYear;proto.isoWeeksInYear=getISOWeeksInYear;proto.date=getSetDayOfMonth;proto.day=proto.days=getSetDayOfWeek;proto.weekday=getSetLocaleDayOfWeek;proto.isoWeekday=getSetISODayOfWeek;proto.dayOfYear=getSetDayOfYear;proto.hour=proto.hours=getSetHour;proto.minute=proto.minutes=getSetMinute;proto.second=proto.seconds=getSetSecond;proto.millisecond=proto.milliseconds=getSetMillisecond;proto.utcOffset=getSetOffset;proto.utc=setOffsetToUTC;proto.local=setOffsetToLocal;proto.parseZone=setOffsetToParsedOffset;proto.hasAlignedHourOffset=hasAlignedHourOffset;proto.isDST=isDaylightSavingTime;proto.isLocal=isLocal;proto.isUtcOffset=isUtcOffset;proto.isUtc=isUtc;proto.isUTC=isUtc;proto.zoneAbbr=getZoneAbbr;proto.zoneName=getZoneName;proto.dates=deprecate('dates accessor is deprecated. Use date instead.',getSetDayOfMonth);proto.months=deprecate('months accessor is deprecated. Use month instead',getSetMonth);proto.years=deprecate('years accessor is deprecated. Use year instead',getSetYear);proto.zone=deprecate('moment().zone is deprecated, use moment().utcOffset instead. http://momentjs.com/guides/#/warnings/zone/',getSetZone);proto.isDSTShifted=deprecate('isDSTShifted is deprecated. See http://momentjs.com/guides/#/warnings/dst-shifted/ for more information',isDaylightSavingTimeShifted);function createUnix(input){return createLocal(input*1000)}function createInZone(){return createLocal.apply(null,arguments).parseZone()}function preParsePostFormat(string){return string}var proto$1=Locale.prototype;proto$1.calendar=calendar;proto$1.longDateFormat=longDateFormat;proto$1.invalidDate=invalidDate;proto$1.ordinal=ordinal;proto$1.preparse=preParsePostFormat;proto$1.postformat=preParsePostFormat;proto$1.relativeTime=relativeTime;proto$1.pastFuture=pastFuture;proto$1.set=set;proto$1.months=localeMonths;proto$1.monthsShort=localeMonthsShort;proto$1.monthsParse=localeMonthsParse;proto$1.monthsRegex=monthsRegex;proto$1.monthsShortRegex=monthsShortRegex;proto$1.week=localeWeek;proto$1.firstDayOfYear=localeFirstDayOfYear;proto$1.firstDayOfWeek=localeFirstDayOfWeek;proto$1.weekdays=localeWeekdays;proto$1.weekdaysMin=localeWeekdaysMin;proto$1.weekdaysShort=localeWeekdaysShort;proto$1.weekdaysParse=localeWeekdaysParse;proto$1.weekdaysRegex=weekdaysRegex;proto$1.weekdaysShortRegex=weekdaysShortRegex;proto$1.weekdaysMinRegex=weekdaysMinRegex;proto$1.isPM=localeIsPM;proto$1.meridiem=localeMeridiem;function get$1(format,index,field,setter){var locale=getLocale();var utc=createUTC().set(setter,index);return locale[field](utc,format)}function listMonthsImpl(format,index,field){if(isNumber(format)){index=format;format=undefined}format=format||'';if(index!=null){return get$1(format,index,field,'month')}var i;var out=[];for(i=0;i<12;i++){out[i]=get$1(format,i,field,'month')}return out}function listWeekdaysImpl(localeSorted,format,index,field){if(typeof localeSorted==='boolean'){if(isNumber(format)){index=format;format=undefined}format=format||''}else{format=localeSorted;index=format;localeSorted=false;if(isNumber(format)){index=format;format=undefined}format=format||''}var locale=getLocale(),shift=localeSorted?locale._week.dow:0;if(index!=null){return get$1(format,(index+shift)%7,field,'day')}var i;var out=[];for(i=0;i<7;i++){out[i]=get$1(format,(i+shift)%7,field,'day')}return out}function listMonths(format,index){return listMonthsImpl(format,index,'months')}function listMonthsShort(format,index){return listMonthsImpl(format,index,'monthsShort')}function listWeekdays(localeSorted,format,index){return listWeekdaysImpl(localeSorted,format,index,'weekdays')}function listWeekdaysShort(localeSorted,format,index){return listWeekdaysImpl(localeSorted,format,index,'weekdaysShort')}function listWeekdaysMin(localeSorted,format,index){return listWeekdaysImpl(localeSorted,format,index,'weekdaysMin')}getSetGlobalLocale('en',{dayOfMonthOrdinalParse:/\d{1,2}(th|st|nd|rd)/,ordinal:function(number){var b=number%10,output=toInt(number%100/10)===1?'th':b===1?'st':b===2?'nd':b===3?'rd':'th';return number+output}});hooks.lang=deprecate('moment.lang is deprecated. Use moment.locale instead.',getSetGlobalLocale);hooks.langData=deprecate('moment.langData is deprecated. Use moment.localeData instead.',getLocale);var mathAbs=Math.abs;function abs(){var data=this._data;this._milliseconds=mathAbs(this._milliseconds);this._days=mathAbs(this._days);this._months=mathAbs(this._months);data.milliseconds=mathAbs(data.milliseconds);data.seconds=mathAbs(data.seconds);data.minutes=mathAbs(data.minutes);data.hours=mathAbs(data.hours);data.months=mathAbs(data.months);data.years=mathAbs(data.years);return this}function addSubtract$1(duration,input,value,direction){var other=createDuration(input,value);duration._milliseconds+=direction*other._milliseconds;duration._days+=direction*other._days;duration._months+=direction*other._months;return duration._bubble()}function add$1(input,value){return addSubtract$1(this,input,value,1)}function subtract$1(input,value){return addSubtract$1(this,input,value,-1)}function absCeil(number){if(number<0){return Math.floor(number)}else{return Math.ceil(number)}}function bubble(){var milliseconds=this._milliseconds;var days=this._days;var months=this._months;var data=this._data;var seconds,minutes,hours,years,monthsFromDays;if(!(milliseconds>=0&&days>=0&&months>=0||milliseconds<=0&&days<=0&&months<=0)){milliseconds+=absCeil(monthsToDays(months)+days)*86400000;days=0;months=0}data.milliseconds=milliseconds%1000;seconds=absFloor(milliseconds/1000);data.seconds=seconds%60;minutes=absFloor(seconds/60);data.minutes=minutes%60;hours=absFloor(minutes/60);data.hours=hours%24;days+=absFloor(hours/24);monthsFromDays=absFloor(daysToMonths(days));months+=monthsFromDays;days-=absCeil(monthsToDays(monthsFromDays));years=absFloor(months/12);months%=12;data.days=days;data.months=months;data.years=years;return this}function daysToMonths(days){return days*4800/146097}function monthsToDays(months){return months*146097/4800}function as(units){if(!this.isValid()){return NaN}var days;var months;var milliseconds=this._milliseconds;units=normalizeUnits(units);if(units==='month'||units==='year'){days=this._days+milliseconds/86400000;months=this._months+daysToMonths(days);return units==='month'?months:months/12}else{days=this._days+Math.round(monthsToDays(this._months));switch(units){case'week':return days/7+milliseconds/604800000;case'day':return days+milliseconds/86400000;case'hour':return days*24+milliseconds/3600000;case'minute':return days*1440+milliseconds/60000;case'second':return days*86400+milliseconds/1000;case'millisecond':return Math.floor(days*86400000)+milliseconds;default:throw new Error('Unknown unit '+units)}}}function valueOf$1(){if(!this.isValid()){return NaN}return this._milliseconds+this._days*86400000+this._months%12*2592000000+toInt(this._months/12)*31536000000}function makeAs(alias){return function(){return this.as(alias)}}var asMilliseconds=makeAs('ms');var asSeconds=makeAs('s');var asMinutes=makeAs('m');var asHours=makeAs('h');var asDays=makeAs('d');var asWeeks=makeAs('w');var asMonths=makeAs('M');var asYears=makeAs('y');function clone$1(){return createDuration(this)}function get$2(units){units=normalizeUnits(units);return this.isValid()?this[units+'s']():NaN}function makeGetter(name){return function(){return this.isValid()?this._data[name]:NaN}}var milliseconds=makeGetter('milliseconds');var seconds=makeGetter('seconds');var minutes=makeGetter('minutes');var hours=makeGetter('hours');var days=makeGetter('days');var months=makeGetter('months');var years=makeGetter('years');function weeks(){return absFloor(this.days()/7)}var round=Math.round;var thresholds={ss:44,s:45,m:45,h:22,d:26,M:11};function substituteTimeAgo(string,number,withoutSuffix,isFuture,locale){return locale.relativeTime(number||1,!!withoutSuffix,string,isFuture)}function relativeTime$1(posNegDuration,withoutSuffix,locale){var duration=createDuration(posNegDuration).abs();var seconds=round(duration.as('s'));var minutes=round(duration.as('m'));var hours=round(duration.as('h'));var days=round(duration.as('d'));var months=round(duration.as('M'));var years=round(duration.as('y'));var a=seconds<=thresholds.ss&&['s',seconds]||seconds<thresholds.s&&['ss',seconds]||minutes<=1&&['m']||minutes<thresholds.m&&['mm',minutes]||hours<=1&&['h']||hours<thresholds.h&&['hh',hours]||days<=1&&['d']||days<thresholds.d&&['dd',days]||months<=1&&['M']||months<thresholds.M&&['MM',months]||years<=1&&['y']||['yy',years];a[2]=withoutSuffix;a[3]=+posNegDuration>0;a[4]=locale;return substituteTimeAgo.apply(null,a)}function getSetRelativeTimeRounding(roundingFunction){if(roundingFunction===undefined){return round}if(typeof roundingFunction==='function'){round=roundingFunction;return true}return false}function getSetRelativeTimeThreshold(threshold,limit){if(thresholds[threshold]===undefined){return false}if(limit===undefined){return thresholds[threshold]}thresholds[threshold]=limit;if(threshold==='s'){thresholds.ss=limit-1}return true}function humanize(withSuffix){if(!this.isValid()){return this.localeData().invalidDate()}var locale=this.localeData();var output=relativeTime$1(this,!withSuffix,locale);if(withSuffix){output=locale.pastFuture(+this,output)}return locale.postformat(output)}var abs$1=Math.abs;function sign(x){return(x>0)-(x<0)||+x}function toISOString$1(){if(!this.isValid()){return this.localeData().invalidDate()}var seconds=abs$1(this._milliseconds)/1000;var days=abs$1(this._days);var months=abs$1(this._months);var minutes,hours,years;minutes=absFloor(seconds/60);hours=absFloor(minutes/60);seconds%=60;minutes%=60;years=absFloor(months/12);months%=12;var Y=years;var M=months;var D=days;var h=hours;var m=minutes;var s=seconds?seconds.toFixed(3).replace(/\.?0+$/,''):'';var total=this.asSeconds();if(!total){return'P0D'}var totalSign=total<0?'-':'';var ymSign=sign(this._months)!==sign(total)?'-':'';var daysSign=sign(this._days)!==sign(total)?'-':'';var hmsSign=sign(this._milliseconds)!==sign(total)?'-':'';return totalSign+'P'+(Y?ymSign+Y+'Y':'')+(M?ymSign+M+'M':'')+(D?daysSign+D+'D':'')+(h||m||s?'T':'')+(h?hmsSign+h+'H':'')+(m?hmsSign+m+'M':'')+(s?hmsSign+s+'S':'')}var proto$2=Duration.prototype;proto$2.isValid=isValid$1;proto$2.abs=abs;proto$2.add=add$1;proto$2.subtract=subtract$1;proto$2.as=as;proto$2.asMilliseconds=asMilliseconds;proto$2.asSeconds=asSeconds;proto$2.asMinutes=asMinutes;proto$2.asHours=asHours;proto$2.asDays=asDays;proto$2.asWeeks=asWeeks;proto$2.asMonths=asMonths;proto$2.asYears=asYears;proto$2.valueOf=valueOf$1;proto$2._bubble=bubble;proto$2.clone=clone$1;proto$2.get=get$2;proto$2.milliseconds=milliseconds;proto$2.seconds=seconds;proto$2.minutes=minutes;proto$2.hours=hours;proto$2.days=days;proto$2.weeks=weeks;proto$2.months=months;proto$2.years=years;proto$2.humanize=humanize;proto$2.toISOString=toISOString$1;proto$2.toString=toISOString$1;proto$2.toJSON=toISOString$1;proto$2.locale=locale;proto$2.localeData=localeData;proto$2.toIsoString=deprecate('toIsoString() is deprecated. Please use toISOString() instead (notice the capitals)',toISOString$1);proto$2.lang=lang;addFormatToken('X',0,0,'unix');addFormatToken('x',0,0,'valueOf');addRegexToken('x',matchSigned);addRegexToken('X',matchTimestamp);addParseToken('X',function(input,array,config){config._d=new Date(parseFloat(input,10)*1000)});addParseToken('x',function(input,array,config){config._d=new Date(toInt(input))});hooks.version='2.19.3';setHookCallback(createLocal);hooks.fn=proto;hooks.min=min;hooks.max=max;hooks.now=now;hooks.utc=createUTC;hooks.unix=createUnix;hooks.months=listMonths;hooks.isDate=isDate;hooks.locale=getSetGlobalLocale;hooks.invalid=createInvalid;hooks.duration=createDuration;hooks.isMoment=isMoment;hooks.weekdays=listWeekdays;hooks.parseZone=createInZone;hooks.localeData=getLocale;hooks.isDuration=isDuration;hooks.monthsShort=listMonthsShort;hooks.weekdaysMin=listWeekdaysMin;hooks.defineLocale=defineLocale;hooks.updateLocale=updateLocale;hooks.locales=listLocales;hooks.weekdaysShort=listWeekdaysShort;hooks.normalizeUnits=normalizeUnits;hooks.relativeTimeRounding=getSetRelativeTimeRounding;hooks.relativeTimeThreshold=getSetRelativeTimeThreshold;hooks.calendarFormat=getCalendarFormat;hooks.prototype=proto;return hooks}));return module.exports});(function(){var define=System.amdDefine;define('webmail/actions/SaveMailAction.js',['common/util.js','3rdparty/onevalidation/validation.js','webmail/model/Mail.js','common/ActionBehavior.js'],function(util,validation,Mail,ActionBehavior){function SaveMailAction(options){util.extend(this,util.pick(options,['outgoingMail']));ActionBehavior.installInto(this)}SaveMailAction.prototype.name='SaveMailAction';SaveMailAction.prototype.isBlocking=true;SaveMailAction.prototype.validate=function(){if(!this.outgoingMail){throw new Error('The outgoing mail must be specified')}};function moveInvalidEmailToDisplayName(recipient){if(validation.email.test(recipient.email)){return recipient}return{displayName:recipient.displayName?(recipient.displayName+' '+(recipient.email||'')).trim():recipient.email}}function removeEmptyDisplayNames(recipient){if(typeof recipient.displayName!=='string'||recipient.displayName.trim()===''){return{email:recipient.email}}else{return recipient}}function recipientWithDisplayNameOrEmail(recipient){return recipient.displayName||recipient.email}SaveMailAction.prototype.models=function(){var draft=this.outgoingMail.original;return draft?[draft]:[]};SaveMailAction.prototype.execute=function(context,cb){var that=this;var state=context.state;var backend=context.backend;that.setBusyFlags();var outgoingMail=this.outgoingMail;var originalMail=outgoingMail.original;var draftFolder=originalMail?originalMail.folder():state.folders.drafts;var destination=outgoingMail.destination||draftFolder;var headers=this.outgoingMail.headers||{};['to','cc','bcc'].forEach(function(header){if(headers[header]){headers[header]=headers[header].map(moveInvalidEmailToDisplayName).map(removeEmptyDisplayNames).filter(recipientWithDisplayNameOrEmail)}});var foldersToCheck=[];if(destination){foldersToCheck.push(destination)}if(originalMail){originalMail.subject(outgoingMail.headers.subject);foldersToCheck.push(draftFolder)}var foldersBefore=foldersToCheck.reduce(function(result,current){result[current.id()]=current.toJS();return result},{});backend.saveMail(state.user(),destination,outgoingMail,function(err,data){that.removeBusyFlags();if(err){cb(err)}else{var foldersChanged=foldersToCheck.some(function(f){var folderBefore=foldersBefore[f.id()];return f.highestmodseq()!==folderBefore.highestmodseq||f.messages()!==folderBefore.messages||f.unseen()!==folderBefore.unseen});var draftInfo=outgoingMail.headers.draftInfo;if(draftInfo&&destination===state.folders.sent){var relatedMailFolder=state.folders.list().filter(function(folder){return folder.id()===draftInfo.folderName&&(folder.uidvalidity()===draftInfo.uidValidity||folder.isSystemFolder())})[0];if(relatedMailFolder){var relatedMail=relatedMailFolder.mailCache.get(draftInfo.uid);if(relatedMail){if(!('type'in draftInfo)||draftInfo.type==='reply'){relatedMail.answered(true)}else if(draftInfo.type==='forward'){relatedMail.forwarded(true)}}}}var newMail=destination.mailCache.get(data.mailInfo.uid);if(newMail){destination.mailCache.remove(newMail);state.signals.mailDisappeared.dispatch(data.mailInfo.uid,destination);destination.dirty=true;state.folders.dirty=true}if(originalMail){if(originalMail.folder()!==destination){originalMail.folder().removeMails([originalMail]);destination.addMails([originalMail]);originalMail.folder(destination)}var oldUid=originalMail.uid;originalMail.updateWith(data.mailInfo);destination.mailUidUpdated(oldUid,originalMail);newMail=originalMail}else{newMail=new Mail(state.user(),destination,data.mailInfo);destination.addMails([newMail]);destination.mailCache.store(newMail)}if(foldersChanged||typeof destination.uidvalidity()!=='number'){state.folders.dirty=true}cb(null,data,newMail)}})};return SaveMailAction})}());(function(){var define=System.amdDefine;define('webmail/actions/SendMailAction.js',['common/util.js','webmail/model/Mail.js','common/ActionBehavior.js','3rdparty/Failboat.js'],function(util,Mail,ActionBehavior,Failboat){function SendMailAction(options){util.extend(this,util.pick(options,['mail']));ActionBehavior.installInto(this)}SendMailAction.prototype.name='SendMailAction';SendMailAction.prototype.isBlocking=true;SendMailAction.prototype.validate=function(){if(!this.mail){throw new Error('SendMailAction requires a mail to be specified')}if(!this.mail.submitPending()){throw new Error('SendMailAction can only send mails with the flag submitPending')}};SendMailAction.prototype.models=function(){return this.mail};SendMailAction.prototype.execute=function(context,cb){var that=this;var state=context.state;var backend=context.backend;that.setBusyFlags();var mail=this.mail;mail.sending(true);mail.failedSaving(false);mail.failedSending(false);mail.submitPending(false);backend.sendMail(state.user(),mail,function(err){var errorHandler=new Failboat;var ignoreError=errorHandler.handleError(err,{'409 SUBMITPENDINGFLAGNOTPRESENT':function(){}});err=ignoreError?null:err;mail.sending(false);that.removeBusyFlags();mail.failedSending(!!err);mail.submitPending(!!err);cb(err);if(err){state.signals.sendingMailFailed.dispatch(mail)}else{state.signals.mailSent.dispatch(mail)}})};return SendMailAction})}());(function(){var define=System.amdDefine;define('webmail/actions/SaveAutocompleteAction.js',['node_modules/knockout/build/output/knockout-latest.debug.js','common/util.js','common/ActionBehavior.js'],function(ko,util,ActionBehavior){function SaveAutocompleteAction(options){util.extend(this,util.pick(options,['recipients']));ActionBehavior.installInto(this)}SaveAutocompleteAction.prototype.name='SaveAutocompleteAction';SaveAutocompleteAction.prototype.validate=function(){if(!this.recipients){throw new Error('The recipients must be specified')}};SaveAutocompleteAction.prototype.execute=function(context,cb){var state=context.state;var backend=context.backend;this.validate();if(!this.recipients.length){cb();return}var recipients=this.recipients.map(function(recipient){return{email:recipient.displayEmail||'',displayName:recipient.displayName||''}});backend.saveAutocompletions(state.user(),recipients,function(err,data){cb(err)})};return SaveAutocompleteAction})}());(function(){var define=System.amdDefine;define('common/actions/QueryAutocompleteAction.js',['node_modules/knockout/build/output/knockout-latest.debug.js','common/util.js','webmail/model/Recipient.js','common/ActionBehavior.js'],function(ko,util,Recipient,ActionBehavior){function QueryAutocompleteAction(options){util.extend(this,util.pick(options,['query','recipients','filter']));ActionBehavior.installInto(this);if(typeof this.filter!=='function'){this.filter=function(){return true}}}QueryAutocompleteAction.prototype.name='QueryAutocompleteAction';QueryAutocompleteAction.prototype.execute=function(context,cb){var that=this;var state=context.state;var backend=context.backend;if(!this.query.trim()){cb(null,{recipients:[]});that.recipients([]);return}var query=this.query.trim().toLocaleLowerCase();backend.queryAutocompletions(state.user(),query,function(err,data){if(!err){that.recipients(data.recipients.map(function(item){return new Recipient(item)}).filter(function(item){return item&&that.filter(item)}))}cb(err,data)})};return QueryAutocompleteAction})}());(function(){var define=System.amdDefine;define('webmail/actions/GetMailPartAction.js',['common/util.js'],function(util){function GetMailPartAction(options){util.extend(this,util.pick(options,'mail','partId'))}GetMailPartAction.prototype.name='GetMailPartAction';GetMailPartAction.prototype.validate=function(){if(!this.mail){throw new Error('Mail must be specified')}if(!this.partId){throw new Error('PartId must be specified')}};GetMailPartAction.prototype.execute=function(context,cb){this.validate();var state=context.state,backend=context.backend,mail=this.mail,trustedSenders=state.preferences.trustedSenders()&&state.preferences.trustedSenders().sources||[],allowExternalImages,senderIsTrusted,headers,folder=mail.folder(),partId=this.partId,from=mail.from()[0]&&mail.from()[0].getEmail()||'';if(trustedSenders.length>0){senderIsTrusted=trustedSenders.indexOf(from);if(senderIsTrusted===-1){allowExternalImages=mail.oneComLoadImg()||folder.isDraftFolder()}else{allowExternalImages=true}}else{allowExternalImages=mail.oneComLoadImg()||folder.isDraftFolder()}headers=[];backend.getMailPart(state.user(),folder.id(),folder.uidvalidity(),mail.uid,partId,headers,allowExternalImages,cb)};return GetMailPartAction})}());(function(){var define=System.amdDefine;define('webmail/actions/LoadMailPartsAction.js',['webmail/actions/GetMailPartAction.js','webmail/model/mailparts/TextPart.js','common/ActionBehavior.js','common/util.js','3rdparty/async.js'],function(GetMailPartAction,TextPart,ActionBehavior,util,async){function LoadMailPartsAction(options){util.extend(this,{retries:1,force:false},util.pick(options,'mail','force'));ActionBehavior.installInto(this)}LoadMailPartsAction.prototype.name='LoadMailPartsAction';LoadMailPartsAction.prototype.validate=function(){if(!this.mail){throw new Error('Mail must be specified')}};LoadMailPartsAction.prototype.models=function(){return this.mail};LoadMailPartsAction.prototype.execute=function(context,cb){var that=this;var mail=this.mail;that.setBusyFlags();async.eachLimit(mail.parts().filter(function(part){return part instanceof TextPart&&(that.force||!part.isLoaded())}),2,function(part,next){if(!part.mailPartTooBig()){var getMailPartAction=new GetMailPartAction({mail:mail,partId:part.partId});getMailPartAction.execute(context,function(err,data){if(!err){part.afterLoad(data)}next(err)})}else{part.afterLoad('');next()}},function(err){that.removeBusyFlags();cb(err)})};return LoadMailPartsAction})}());(function(){var define=System.amdDefine;define('webmail/composer/AttachmentView.js',['node_modules/jquery/dist/jquery.js','node_modules/knockout/build/output/knockout-latest.debug.js','webmail/model/mailparts/Attachment.js','common/util.js','node_modules/@one.com/tracking-analytics/lib/tracking.js'],function($,ko,Attachment,util,tracking){function AttachmentView(){var that=this;this.maximumMailSize=99000000;this.maximumDecodedMailSize=this.maximumMailSize*3/4;this.attachments=ko.observableArray([]);this.inlineSize=ko.observable(0);this.attachmentsTooLarge=ko.computed(function(){var totalSize=that.inlineSize();(that.attachments()||[]).forEach(function(attachment){totalSize+=attachment.rawSize()||0});return totalSize>that.maximumMailSize});this.focus=ko.observable(false);this.allowExpand=ko.observable(false);this.inputOffsetTop=ko.observable(0);this.attachmentsWidth=ko.observable(0);this.widthOfAttachmentsContainer=ko.observable(0);this.showLess=ko.observable(false);this.sizeAnnotatedAttachments=ko.computed(function(){var totalSize=0;return(that.attachments()||[]).map(function(attachment){totalSize+=attachment.size()||0;return{attachment:attachment,rejected:totalSize>that.maximumDecodedMailSize}})});this.attachmentIsDirectory=ko.observable(false);this.attachmentsBelowSizeLimit=ko.computed(function(){return that.sizeAnnotatedAttachments().filter(function(annotatedAttachment){return!annotatedAttachment.rejected}).map(function(annotatedAttachment){return annotatedAttachment.attachment})});this.createAttachments=function(fileList){var fileObj,attachments=[],attachment;for(var i=0;i<fileList.length;i+=1){fileObj=fileList[i];attachment=Attachment.createFromFile(fileObj);attachments.push(attachment)}attachments=that.attachments().concat(attachments);this.attachments(attachments);return attachments};that.isLabelUp=ko.computed(function(){return that.attachments().length>0||that.focus()});that.scrollToLastAttachedFile=function(attachments){var $scrollListContainer=$('.drag-drop--scrollList'),heightOfScrollList=$scrollListContainer.height(),heightOfAttachmentsContainer=$scrollListContainer.children().first().height();if(heightOfAttachmentsContainer>heightOfScrollList){$scrollListContainer.scrollTop(heightOfAttachmentsContainer);var offsetTop=$scrollListContainer.scrollTop();this.inputOffsetTop(offsetTop)}}}AttachmentView.prototype.attach=function(input){var attachments=this.createAttachments(input.files);tracking.track('action','attach file','dialog');this.scrollToLastAttachedFile(attachments);$(input).mouseleave();return attachments};AttachmentView.prototype.addDroppedFiles=function(data,event){event.preventDefault();var that=this,droppedFiles=event.originalEvent.dataTransfer.files;that.attachmentIsDirectory(false);util.distinguishFileFromDirectory(droppedFiles,function(files,directories){if(directories.length>0){that.attachmentIsDirectory(true)}that.createAttachments(files);tracking.track('action','attach file','drag and drop')})};AttachmentView.prototype.removeAttachment=function(index){var inputElem=this.attachments()[index].input;if(inputElem){$(inputElem).remove()}this.attachments.splice(index,1)};AttachmentView.prototype.resetView=function(){this.attachments([])};AttachmentView.prototype.addExistingAttachments=function(attachments){var that=this;that.attachments(attachments.concat([]))};AttachmentView.prototype.updateAttachments=function(partMap,mail){var attachments=this.attachments(this.attachments()||[]),result;function modifyAttachments(attachment){if(partMap[attachment.id]){var part=partMap[attachment.id][0];attachment=attachment.attachToNewMail(mail);attachment.part=part.id;attachment.uid=part.uid;if(attachment.justAdded){attachment.justAdded=false;attachment.input=null;attachment.contentType=part.contentType;attachment.size(part.rawSize)}attachment.checkForThumbnail()}return attachment}result=attachments.attachments().map(modifyAttachments);return result};return AttachmentView})}());(function(){var define=System.amdDefine;(function(root,factory){if(typeof exports==='object'){module.exports=factory()}else if(typeof define==='function'&&define.amd){define('3rdparty/htmlEmailToText.js',[],factory)}else{root.text=factory()}}(this,function(){var blockLevelNodeNameRegExp=/^(?:h[1-6]|pre|p|blockquote|div|ol|ul|li|table)$/i;function isLineBreakNode(node){return node.nodeName.toLowerCase()==='br'}function isWhiteSpaceNode(node){return node.nodeType===3&&node.nodeValue.match(/^[\n\r\s]*$/)!==null}function splitIntoLines(text){return text.split(/\r\n?|\n\r?/)}function reflowText(text,maxLineWidth){var lines=splitIntoLines(text),wrappedLines=[];maxLineWidth=maxLineWidth||72;while(lines.length){var line=lines.shift(),prefix=line.match(/^(>[ >]*|)/)[1];if(prefix.length>=maxLineWidth){prefix=''}if(line.length>maxLineWidth){var spacePos=line.lastIndexOf(' ',maxLineWidth);if(spacePos===-1||spacePos<prefix.length){spacePos=maxLineWidth}wrappedLines.push(line.slice(0,spacePos));lines.unshift(prefix+line.substring(spacePos).replace(/^\s+/,''))}else{wrappedLines.push(line)}}return wrappedLines.join('\n')}function blockLevelNodeToText(node,maxLineWidth){var nodeName=node.nodeName.toLowerCase(),generalPrefix='',firstLinePrefix,text,i;if(nodeName==='blockquote'){generalPrefix='> '}else if(nodeName==='li'&&node.parentNode){if(node.parentNode.nodeName.toLowerCase()==='ol'){var listLength=0,siblingNodes=node.parentNode.childNodes;for(i=0;i<siblingNodes.length;i+=1){if(siblingNodes[i].nodeName.toLowerCase()==='li'){listLength+=1;if(siblingNodes[i]===node){firstLinePrefix=listLength+'. '}}}generalPrefix='  ';for(i=0;i<listLength.toString().length;i+=1){generalPrefix+=' '}while(generalPrefix.length>firstLinePrefix.length){firstLinePrefix+=' '}}else if(node.parentNode.nodeName.toLowerCase()==='ul'){firstLinePrefix='* ';generalPrefix='  '}}if(nodeName==='pre'){var html=node.innerHTML.toString();text='';if(html.match(/^-- [\r\n]/)){text+='-- \n';html=html.replace(/^-- [\r\n]/,'')}if(html){text+=htmlEmailToText(html.replace(/\n/g,'<br>'),maxLineWidth)}}else{text='';for(i=0;i<node.childNodes.length;i+=1){text+=htmlNodeToText(node.childNodes[i],maxLineWidth&&maxLineWidth-generalPrefix.length)}}if(maxLineWidth){maxLineWidth-=generalPrefix.length;if(maxLineWidth>10){text=reflowText(text,maxLineWidth)}}if(generalPrefix){text=splitIntoLines(text).map(function(line,i){return(!i&&firstLinePrefix||generalPrefix)+line}).join('\n')}var isFirstNode=!node.parentNode||blockLevelNodeNameRegExp.test(node.parentNode.nodeName)&&(!node.previousSibling||isWhiteSpaceNode(node.previousSibling)&&!node.previousSibling.previousSibling);var isLastNode=!node.parentNode||blockLevelNodeNameRegExp.test(node.parentNode.nodeName)&&(!node.nextSibling||isWhiteSpaceNode(node.nextSibling)&&!node.nextSibling.nextSibling);var hadDiv=false,hadBr=false,hadSpace=false;for(i=0;i<node.childNodes.length;i+=1){var n1=node.childNodes[i],name=n1.nodeName.toLowerCase();if(name==='#text'){if(/^\s*$/.test(n1.nodeValue)){hadSpace=true}}else if(name==='br'){hadBr=true}else if(name==='div'){hadDiv=true}}if(!isFirstNode&&!hadBr){text='\n'+text}else if(!isLastNode&&hadSpace&&!hadDiv){text+='\n'}else if(node.nodeName.toLowerCase()==='blockquote'){text+='\n'}return text}function htmlNodeToText(node,maxLineWidth){var nodeName=node.nodeType===3?'text':node.nodeName.toLowerCase();if(nodeName==='script'||nodeName==='style'||nodeName==='title'){return''}else{var text='';if(blockLevelNodeNameRegExp.test(node.nodeName)){return blockLevelNodeToText(node,maxLineWidth)}else{var out='';for(var i=0;i<node.childNodes.length;i+=1){text+=htmlNodeToText(node.childNodes[i],maxLineWidth)}if(nodeName==='a'){var href=node.getAttribute('href');if(href){if(href.match(/^mailto:/i)){href=href.replace(/^mailto:([a-z0-9_\+\-\.]+\@(?:[a-z0-9][\w\.+\-]+\.[a-z]{2,}))/i,'$1')}if(href.match(/^\#/)){out=text}else if(href===text||'<'+href+'>'===text||href==='http://'+text||href==='http://'+text+'/'||href==='mailto:'+text||text.match(/^[\r\n\s]*$/)){out='<'+href+'>'}else{out=text+' <'+href+'>'}}}else if(nodeName==='img'){out=node.alt||node.title||''}else if(nodeName==='br'){return'\n'}else if(nodeName==='text'){var textContents=node.nodeValue||'';if(textContents.match(/^-- (?:\r|\n|$)/)){out='-- \n';textContents=textContents.replace(/^-- (?:\r|\n|$)/,'')}out+=textContents.replace(/[\r\n]+/g,' ').replace(/\s{2,}/g,' ')}else{out=text||''}if(!node.previousSibling||isLineBreakNode(node.previousSibling)||blockLevelNodeNameRegExp.test(node.previousSibling.nodeName)||!node.previousSibling.previousSibling&&isWhiteSpaceNode(node.previousSibling)){out=out.replace(/^\s+/,'')}else{out=out.replace(/^\s+/,' ')}if(!node.nextSibling||isLineBreakNode(node.nextSibling)||blockLevelNodeNameRegExp.test(node.nextSibling.nodeName)||!node.nextSibling.nextSibling&&isWhiteSpaceNode(node.nextSibling)){out=out.replace(/(^|[^\-]|[^\-]-)\s+$/,'$1')}else{out=out.replace(/\s+$/,' ')}return out}}}function htmlEmailToText(html,maxLineWidth,noDoubleLines){var tempDiv=document.createElement('div');tempDiv.innerHTML=html.replace(/\r?\n|\r\n?/g,'\n');return htmlNodeToText(tempDiv,maxLineWidth)}return{htmlEmailToText:htmlEmailToText}}))}());(function(){var define=System.amdDefine;define('common/highlightAutocompletion.js',['node_modules/jquery/dist/jquery.js','common/util.js'],function($,util){function renderHighlights(suggestion,index,suggestionSections){var queryString=util.escapeRegExp(suggestion.query.trim().replace(/(^@|@$)/,'')).replace(/"+/g,'').split(/\s+/).join('|');var query=new RegExp('(?:^|\\s|@|")('+queryString+')','i');var $result=$('<div class="suggestion-result-item"></div>');suggestionSections.forEach(function(suggestionSection){var remainingLabel=suggestionSection.value;var $section=$('<div></div>');$section.addClass(suggestionSection.className);var labelParts;if(/\S@\S/.test(suggestion.query)){labelParts=suggestionSection.value.split(/>| <?/)}else{labelParts=suggestionSection.value.split(/>| <?|@/)}labelParts.forEach(function(part){if(!part){return}var partIndex=remainingLabel.indexOf(part);$section.append(document.createTextNode(remainingLabel.substr(0,partIndex)));remainingLabel=remainingLabel.slice(partIndex+part.length);if(query.test(part)){var match=part.match(query)[1].replace(/^"+/g,'');var prependedQuotes=0;while(part[prependedQuotes]==='"'){$section.append(document.createTextNode('"'));prependedQuotes++}$section.append($('<strong>'+match+'</strong>'));$section.append(document.createTextNode(part.slice(match.length+prependedQuotes)))}else{$section.append(document.createTextNode(part))}});$section.append(document.createTextNode(remainingLabel));$result.append($section);$('<li></li>').attr('data-index',index).append($result)});return $result}return{nameEmailSplit:function(suggestion,index){var suggestionSections;if(suggestion.item.constructor.name==='Recipient'){suggestionSections=[{className:'display-name',value:suggestion.item.displayName===undefined?'':suggestion.item.displayName},{className:'display-email',value:suggestion.item.displayEmail}]}else{suggestionSections=[{className:'display-name',value:suggestion.label}]}return renderHighlights(suggestion,index,suggestionSections)},concatenated:function(suggestion,index){var suggestionSection=[{className:'display-label',value:suggestion.label}];return renderHighlights(suggestion,index,suggestionSection)}}})}());(function(){var define=System.amdDefine;(function(root,factory){if(typeof exports==='object'){module.exports=factory(require('knockout'),require('./map'))}else if(typeof define==='function'&&define.amd){define('3rdparty/knockout-transformations/filter.js',['node_modules/knockout/build/output/knockout-latest.debug.js','3rdparty/knockout-transformations/map.js'],factory)}else{var ko=root.ko;factory(ko,ko.transformations.fn.map)}}(this,function(ko,map){ko.observable.fn.filter=ko.transformations.fn.filter=function filter(mappingOptions){if(typeof mappingOptions==='function'){mappingOptions={mapping:mappingOptions}}var predicate=mappingOptions.mapping;var exclusionMarker={};mappingOptions.mapping=function(item){return predicate(item)?item:exclusionMarker};mappingOptions.exclusionMarker=exclusionMarker;return map.call(this,mappingOptions)};return ko.transformations.fn.filter}))}());(function(){var define=System.amdDefine;(function(root,factory){if(typeof exports==='object'){module.exports=factory(require('knockout'))}else if(typeof define==='function'&&define.amd){define('3rdparty/knockout-transformations/sortBy.js',['node_modules/knockout/build/output/knockout-latest.debug.js'],factory)}else{factory(root.ko)}}(this,function(ko){ko.transformations=ko.transformations||{fn:{}};function sortingKeysEquals(aSortKeys,bSortKeys){var Descending=SortByTransformation.Descending;if(!Array.isArray(aSortKeys)){aSortKeys=[aSortKeys];bSortKeys=[bSortKeys]}var aSortKey,bSortKey;for(var i=0;i<aSortKeys.length;i+=1){aSortKey=aSortKeys[i];bSortKey=bSortKeys[i];if(aSortKey instanceof Descending){if(bSortKey instanceof Descending){aSortKey=aSortKey.value;bSortKey=bSortKey.value}else{return false}}if(aSortKey!==bSortKey){return false}}return true}function compareSortingKeys(aSortKeys,bSortKeys,comparator){var Descending=SortByTransformation.Descending;if(!Array.isArray(aSortKeys)){aSortKeys=[aSortKeys];bSortKeys=[bSortKeys]}var aSortKey,bSortKey,comparison;for(var i=0;i<aSortKeys.length;i+=1){aSortKey=aSortKeys[i];bSortKey=bSortKeys[i];if(aSortKey instanceof Descending){comparison=comparator(bSortKey.value,aSortKey.value)}else{comparison=comparator(aSortKey,bSortKey)}if(comparison!==0){return comparison}}return 0}function mappingToComparefn(mapping,comparator){var Descending=SortByTransformation.Descending;return function(a,b){var aSortKeys=mapping(a,Descending.create);var bSortKeys=mapping(b,Descending.create);return compareSortingKeys(aSortKeys,bSortKeys,comparator)}}function binarySearch(items,item,comparefn){var left=-1,right=items.length,mid;while(right-left>1){mid=left+right>>>1;var c=comparefn(items[mid],item);if(c<0){left=mid}else{right=mid;if(!c){break}}}return right===items.length||comparefn(items[right],item)?-right-1:right}function findInsertionIndex(items,newItem,comparefn){var left=-1,right=items.length,mid;while(right-left>1){mid=left+right>>>1;if(comparefn(items[mid],newItem)<0){left=mid}else{right=mid}}return right}function binaryIndexOf(items,item,comparefn){var index=binarySearch(items,item,comparefn);if(index<0||items.length<=index||comparefn(items[index],item)!==0){return-1}else{var startIndex=index;while(index-1>=0&&comparefn(items[index-1],item)===0){index-=1}while(index<=startIndex){if(items[index]===item){return index}index+=1}while(index<items.length){if(comparefn(items[index],item)!==0){return-1}if(items[index]===item){return index}index+=1}return-1}}function SortedStateItem(transformation,inputItem){this.transformation=transformation;this.inputItem=inputItem;this.mappedValueComputed=ko.computed(this.mappingEvaluator,this);this.mappedValueComputed.subscribe(this.onMappingResultChanged,this);this.previousMappedValue=this.mappedValueComputed.peek()}SortedStateItem.prototype.dispose=function(){var mappedItem=this.mappedValueComputed();this.mappedValueComputed.dispose();if(this.transformation.options.disposeItem){this.transformation.options.disposeItem(mappedItem)}};SortedStateItem.prototype.mappingEvaluator=function(){return this.transformation.mapping(this.inputItem,SortByTransformation.Descending.create)};SortedStateItem.prototype.onMappingResultChanged=function(newValue){if(!sortingKeysEquals(newValue,this.previousMappedValue)){var transformation=this.transformation;var outputObservable=transformation.outputObservable;var outputArray=outputObservable.peek();var stateItems=transformation.stateItems;var oldIndex=binaryIndexOf(stateItems,this,mappingToComparefn(function(stateItem){return stateItem.previousMappedValue},transformation.comparator));if(stateItems[oldIndex]===this){outputObservable.valueWillMutate();outputArray.splice(oldIndex,1);stateItems.splice(oldIndex,1);var index=findInsertionIndex(outputArray,this.inputItem,transformation.comparefn);outputArray.splice(index,0,this.inputItem);stateItems.splice(index,0,this);this.previousMappedValue=newValue;outputObservable.valueHasMutated()}else{ko.utils.arrayForEach(stateItems,function(stateItem){stateItem.previousMappedValue=stateItem.mappingEvaluator()});stateItems.sort(mappingToComparefn(function(stateItem){return stateItem.previousMappedValue},transformation.comparator));outputArray=[];ko.utils.arrayForEach(stateItems,function(stateItem){outputArray.push(stateItem.inputItem)});outputObservable(outputArray)}}};function SortByTransformation(inputObservableArray,options){var that=this;this.options=options;this.mapping=options.mapping;if(options.comparator){this.comparator=options.comparator}else{this.comparator=function(a,b){if(a>b){return 1}else if(b>a){return-1}else{return 0}}}this.comparefn=mappingToComparefn(this.mapping,this.comparator);this.stateItems=ko.utils.arrayMap(inputObservableArray.peek(),function(inputItem){return new SortedStateItem(that,inputItem)});this.stateItems.sort(function(a,b){return compareSortingKeys(a.mappedValueComputed(),b.mappedValueComputed(),that.comparator)});this.outputObservable=ko.observable(ko.utils.arrayMap(this.stateItems,function(stateItem){return stateItem.inputItem}));var inputArraySubscription=inputObservableArray.subscribe(this.onStructuralChange,this,'arrayChange');var outputComputed=ko.computed(this.outputObservable);if('throttle'in options){outputComputed=outputComputed.extend({throttle:options.throttle})}this.output=outputComputed.extend({trackArrayChanges:true});var originalDispose=this.output.dispose;this.output.dispose=function(){inputArraySubscription.dispose();ko.utils.arrayForEach(that.stateItems,function(stateItem){stateItem.dispose()});originalDispose.call(this,arguments)};ko.utils.extend(this.output,ko.transformations.fn)}SortByTransformation.Descending=function Descending(value){this.value=value};SortByTransformation.Descending.create=function(value){return new SortByTransformation.Descending(value)};SortByTransformation.prototype.onStructuralChange=function(diff){if(!diff.length){return}this.outputObservable.valueWillMutate();var that=this;var addQueue=[];var deleteQueue=[];ko.utils.arrayForEach(diff,function(diffEntry){if(typeof diffEntry.moved!=='number'){switch(diffEntry.status){case'added':addQueue.push(diffEntry);break;case'deleted':deleteQueue.push(diffEntry);break}}});var outputArray=this.outputObservable.peek();ko.utils.arrayForEach(deleteQueue,function(diffEntry){var index=binaryIndexOf(outputArray,diffEntry.value,that.comparefn);if(index!==-1){outputArray.splice(index,1);that.stateItems[index].dispose();that.stateItems.splice(index,1)}});if(deleteQueue.length===0&&this.stateItems.length===0){this.stateItems=ko.utils.arrayMap(addQueue,function(diffEntry){return new SortedStateItem(that,diffEntry.value)});this.stateItems.sort(function(a,b){return compareSortingKeys(a.mappedValueComputed(),b.mappedValueComputed(),that.comparator)});ko.utils.arrayForEach(this.stateItems,function(stateItem){outputArray.push(stateItem.inputItem)})}else{ko.utils.arrayForEach(addQueue,function(diffEntry){var index=findInsertionIndex(outputArray,diffEntry.value,that.comparefn);var stateItem=new SortedStateItem(that,diffEntry.value);outputArray.splice(index,0,stateItem.inputItem);that.stateItems.splice(index,0,stateItem)})}this.outputObservable.valueHasMutated()};ko.observableArray.fn.sortBy=ko.transformations.fn.sortBy=function sortBy(options){if(typeof options==='function'){options={mapping:options}}var transformation=new SortByTransformation(this,options);return transformation.output};return ko.transformations.fn.sortBy}))}());(function(){var define=System.amdDefine;(function(root,factory){if(typeof exports==='object'){module.exports=factory(require('knockout'))}else if(typeof define==='function'&&define.amd){define('3rdparty/knockout-transformations/indexBy.js',['node_modules/knockout/build/output/knockout-latest.debug.js'],factory)}else{factory(root.ko)}}(this,function(ko){ko.transformations=ko.transformations||{fn:{}};function IndexByTransformation(inputObservableArray,options){var that=this;this.options=options;this.outputObservable=ko.observable({});this.stateItems={};this.mapping=function(item){return[].concat(options.mapping(item))};var inputArray=inputObservableArray.peek();for(var i=0;i<inputArray.length;i+=1){this.addToIndex(inputArray[i],i)}var inputArraySubscription=inputObservableArray.subscribe(this.onStructuralChange,this,'arrayChange');var outputComputed=ko.computed(this.outputObservable);if('throttle'in options){outputComputed=outputComputed.extend({throttle:options.throttle})}this.output=outputComputed;var originalDispose=this.output.dispose;this.output.dispose=function(){inputArraySubscription.dispose();for(var prop in that.stateItems){if(that.stateItems.hasOwnProperty(prop)){that.stateItems[prop].dispose()}}originalDispose.call(this,arguments)};ko.utils.extend(this.output,ko.transformations.fn)}IndexByTransformation.prototype.arraysEqual=function(a,b){if(a===b){return true}if(typeof a==='undefined'||typeof b==='undefined'){return false}if(a.length!==b.length){return false}for(var i=0;i<a.length;i+=1){if(ko.observable.fn.equalityComparer&&ko.isObservable(a[i])&&!ko.observable.fn.equalityComparer(a[i],b[i])||a[i]!==b[i]){return false}}return true};IndexByTransformation.prototype.appendToEntry=function(obj,key,item){var entry=obj[key];if(!entry){entry=obj[key]=[]}entry.push(item)};IndexByTransformation.prototype.removeFromEntry=function(obj,key,item){var entry=obj[key];if(entry){var index=entry.indexOf(item);if(index!==-1){if(entry.length===1){delete obj[key]}else{entry.splice(index,1)}}}};IndexByTransformation.prototype.insertByKeyAndItem=function(indexMapping,key,item){this.appendToEntry(indexMapping,key,item)};IndexByTransformation.prototype.removeByKeyAndItem=function(indexMapping,key,item){this.removeFromEntry(indexMapping,key,item)};IndexByTransformation.prototype.addStateItemToIndex=function(stateItem){var key=this.mapping(stateItem.inputItem)[0];this.appendToEntry(this.stateItems,key,stateItem)};IndexByTransformation.prototype.findStateItem=function(inputItem){var key=this.mapping(inputItem)[0];var entry=this.stateItems[key];if(!entry){return null}var result=ko.utils.arrayFilter(entry,function(stateItem){return stateItem.inputItem===inputItem});return result[0]||null};IndexByTransformation.prototype.removeStateItem=function(stateItem){var key=stateItem.mappedValueComputed()[0];this.removeFromEntry(this.stateItems,key,stateItem);stateItem.dispose()};IndexByTransformation.prototype.addToIndex=function(inputItem){var that=this;var keys=this.mapping(inputItem);var output=this.outputObservable.peek();ko.utils.arrayForEach(keys,function(key){that.insertByKeyAndItem(output,key,inputItem)});var stateItem=new IndexedStateItem(this,inputItem);this.addStateItemToIndex(stateItem)};IndexByTransformation.prototype.removeItem=function(inputItem){var that=this;var stateItem=this.findStateItem(inputItem);if(stateItem){var keys=stateItem.mappedValueComputed();var output=this.outputObservable.peek();ko.utils.arrayForEach(keys,function(key){that.removeByKeyAndItem(output,key,inputItem)});this.removeStateItem(stateItem)}};IndexByTransformation.prototype.onStructuralChange=function(diff){var that=this;if(!diff.length){return}var addQueue=[];var deleteQueue=[];ko.utils.arrayForEach(diff,function(diffEntry){if(typeof diffEntry.moved!=='number'){switch(diffEntry.status){case'added':addQueue.push(diffEntry);break;case'deleted':deleteQueue.push(diffEntry);break}}});ko.utils.arrayForEach(deleteQueue,function(diffEntry){that.removeItem(diffEntry.value,diffEntry.index)});ko.utils.arrayForEach(addQueue,function(diffEntry){that.addToIndex(diffEntry.value,diffEntry.index)});this.outputObservable.valueHasMutated()};function IndexedStateItem(transformation,inputItem){this.transformation=transformation;this.inputItem=inputItem;this.mappedValueComputed=ko.computed(this.mappingEvaluator,this);this.mappedValueComputed.subscribe(this.onMappingResultChanged,this);this.previousMappedValue=this.mappedValueComputed.peek()}IndexedStateItem.prototype.dispose=function(){var mappedItem=this.mappedValueComputed();this.mappedValueComputed.dispose();if(this.transformation.options.disposeItem){this.transformation.options.disposeItem(mappedItem)}};IndexedStateItem.prototype.mappingEvaluator=function(){return this.transformation.mapping(this.inputItem)};function toArray(value){return Array.isArray(value)?value:[value]}IndexedStateItem.prototype.onMappingResultChanged=function(newValue){var transformation=this.transformation;if(!transformation.arraysEqual(this.newValue,this.previousMappedValue)){var outputObservable=transformation.outputObservable;var output=outputObservable.peek();outputObservable.valueWillMutate();var that=this;ko.utils.arrayForEach(toArray(this.previousMappedValue),function(key){transformation.removeByKeyAndItem(output,key,that.inputItem);transformation.removeByKeyAndItem(transformation.stateItems,key,that)});ko.utils.arrayForEach(toArray(newValue),function(key){transformation.insertByKeyAndItem(output,key,that.inputItem)});transformation.addStateItemToIndex(this);this.previousMappedValue=newValue;outputObservable.valueHasMutated()}};function UniqueIndexByTransformation(inputObservableArray,options){IndexByTransformation.call(this,inputObservableArray,options)}ko.utils.extend(UniqueIndexByTransformation.prototype,IndexByTransformation.prototype);UniqueIndexByTransformation.prototype.insertByKeyAndItem=function(indexMapping,key,item){if(key in indexMapping){throw new Error('Unique indexes requires items must map to different keys; duplicate key: '+key)}indexMapping[key]=item};UniqueIndexByTransformation.prototype.removeByKeyAndItem=function(indexMapping,key){delete indexMapping[key]};UniqueIndexByTransformation.prototype.addStateItemToIndex=function(stateItem){var key=stateItem.mappedValueComputed()[0];this.stateItems[key]=stateItem};UniqueIndexByTransformation.prototype.findStateItem=function(inputItem){var key=this.mapping(inputItem)[0];return this.stateItems[key]||null};UniqueIndexByTransformation.prototype.removeStateItem=function(stateItem){var key=stateItem.mappedValueComputed()[0];if(this.stateItems[key]===stateItem){delete this.stateItems[key]}stateItem.dispose()};UniqueIndexByTransformation.prototype.addToIndex=function(inputItem){var that=this;var keys=this.mapping(inputItem);var output=this.outputObservable.peek();ko.utils.arrayForEach(keys,function(key){that.insertByKeyAndItem(output,key,inputItem)});var stateItem=new UniqueIndexedStateItem(this,inputItem);this.addStateItemToIndex(stateItem)};UniqueIndexByTransformation.prototype.removeItem=function(inputItem){var that=this;var stateItem=this.findStateItem(inputItem);if(stateItem){var keys=stateItem.mappedValueComputed();var output=this.outputObservable.peek();ko.utils.arrayForEach(keys,function(key){that.removeByKeyAndItem(output,key,inputItem)});this.removeStateItem(stateItem)}};function UniqueIndexedStateItem(transformation,inputItem){IndexedStateItem.call(this,transformation,inputItem)}ko.utils.extend(UniqueIndexedStateItem.prototype,IndexedStateItem.prototype);ko.observableArray.fn.indexBy=ko.transformations.fn.indexBy=function indexBy(options){if(typeof options==='function'){options={mapping:options,unique:false}}var transformation=options.unique?new UniqueIndexByTransformation(this,options):new IndexByTransformation(this,options);return transformation.output};ko.observableArray.fn.uniqueIndexBy=ko.transformations.fn.uniqueIndexBy=function uniqueIndexBy(options){if(typeof options==='function'){options={mapping:options}}options.unique=true;var transformation=new UniqueIndexByTransformation(this,options);return transformation.output};return ko.transformations.fn.indexBy}))}());(function(){var define=System.amdDefine;(function(root,factory){if(typeof exports==='object'){module.exports=factory(require('knockout'),require('./map'),require('./filter'),require('./sortBy'),require('./indexBy'))}else if(typeof define==='function'&&define.amd){define('3rdparty/knockout-transformations/index.js',['node_modules/knockout/build/output/knockout-latest.debug.js','3rdparty/knockout-transformations/map.js','3rdparty/knockout-transformations/filter.js','3rdparty/knockout-transformations/sortBy.js','3rdparty/knockout-transformations/indexBy.js'],factory)}else{var ko=root.ko;factory(ko,ko.transformations.fn.map,ko.transformations.fn.filter,ko.transformations.fn.sortBy,ko.transformations.fn.indexBy)}}(this,function(ko,map,filter,sortBy,indexBy){return ko.transformations.fn}))}());(function(){var define=System.amdDefine;define('webmail/composer/RecipientInput.js',['node_modules/knockout/build/output/knockout-latest.debug.js','node_modules/jquery/dist/jquery.js','webmail/model/Recipient.js','webmail/model/RecipientGroup.js','3rdparty/onevalidation/validation.js','common/highlightAutocompletion.js','common/KeyHandler.js','3rdparty/knockout-transformations/index.js'],function(ko,$,Recipient,RecipientGroup,validation,highlightAutocompletion,getKeyHandler){var backspace=8;var escape=27;var emailRegExp=new RegExp('<?('+validation.fragments.emailIdn.source+')>?','ig');function SelectedItem(recipientInput,item){this.recipientInput=recipientInput;this.item=item;this.editing=ko.observable(false);this.value=ko.observable(item.email);this.dragging=ko.observable(false);this.query=recipientInput.editQuery||recipientInput.query}SelectedItem.prototype.dragStart=function(item){item.dragging(true)};SelectedItem.prototype.dragEnd=function(item){item.dragging(false)};SelectedItem.prototype.escapeHandler=function(data,event){if(event.which===escape){data.editing(false);data.recipientInput.focusInput();return false}return true};SelectedItem.prototype.moveTo=function(recipientInput){var item=this.item;this.recipientInput.selected.remove(item);recipientInput.selected.push(item)};SelectedItem.prototype.replaceWith=function(recipients){this.editing(false);var recipientInput=this.recipientInput;var index=recipientInput.selected.indexOf(this.item);var args=[index,1].concat(recipients);ko.observableArray.fn.splice.apply(recipientInput.selected,args)};SelectedItem.prototype.blurHandler=function(data,event){if(this.editing()){if(this.value()!==this.item.toEditDisplayString()){this.replaceWith(this.recipientInput.toRecipients([this.value()]))}else{this.editing(false)}}};SelectedItem.prototype.edit=function(data,event){this.value(this.item.toEditDisplayString());this.editing(true);if(event.preventDefault){event.preventDefault()}return false};SelectedItem.prototype.select=function(items){this.replaceWith(this.recipientInput.toRecipients(items));this.editing(false);this.recipientInput.focusInput()};function RecipientInput(options){var that=this;if(typeof options==='string'){var newOptions={};var args=arguments;['id','dataSource','query','recipients','editQuery','isContactInMyContactFunc','contactCardFactoryFunc','label'].forEach(function(argName,index){newOptions[argName]=args[index]});options=newOptions}this.id=options.id;this.dataSource=options.dataSource;this.query=options.query||ko.observable('');this.editQuery=options.editQuery||null;this.selected=options.recipients;this.value=ko.observable('');this.inputFocused=ko.observable(false);this.pasteAreaFocused=ko.observable(false);this.isContactInMyContactFunc=options.isContactInMyContactFunc;this.contactCardFactoryFunc=options.contactCardFactoryFunc;this.completed=that.selected.map(function(item){return new SelectedItem(that,item)});this.focused=ko.computed(function(){return this.inputFocused()||this.pasteAreaFocused()||this.completed().some(function(completed){return completed.editing()})},this);this.label=options.label;this.floatLabel=ko.pureComputed(function(){return that.selected().length>0||that.focused()})}RecipientInput.prototype.checkIfRecipientIsInContacts=function(recipient){if(recipient.email){return this.isContactInMyContactFunc(recipient.email.toLowerCase())}return false};RecipientInput.prototype.getContactCard=function(data){var recipient=data.recipient;var contactCardWithLink=!this.checkIfRecipientIsInContacts(recipient);return this.contactCardFactoryFunc(recipient,contactCardWithLink)};RecipientInput.prototype.toRecipients=function(items){var result=[];(items||[]).forEach(function(item){if(item instanceof Recipient){result.push(item)}else if(item instanceof RecipientGroup){result.push.apply(result,item.recipients)}else{item.trim().replace(emailRegExp,function(text,email){return email+','}).split(',').map(function(text){return text.trim()}).filter(function(text){return text}).forEach(function(text){result.push(Recipient.from(text))})}});return result};RecipientInput.prototype.renderSuggestionNameEmailSplit=highlightAutocompletion.nameEmailSplit;RecipientInput.prototype.renderSuggestionConcatenated=highlightAutocompletion.concatenated;RecipientInput.prototype.select=function(items,pasted){var that=this;items=items||[];if(pasted&&items.length===1&&typeof items[0]==='string'&&!items[0].trim().match(emailRegExp)){return items[0]}that.selected.push.apply(that.selected,that.toRecipients(items));return''};RecipientInput.prototype.flushChanges=function(){var email=this.value();if(email){ko.utils.arrayPushAll(this.selected,this.toRecipients([email]));this.value('')}};RecipientInput.prototype.isInvalidEmail=function(recipient){return recipient.isInvalidEmail()};RecipientInput.prototype.keyDown=function(data,recipient,event){var that=this;var keyhandler=getKeyHandler();var fields=['to','cc','bcc','subject'];if(event){if(that.value().length===0&&event.which===backspace){that.selected.pop()}var keyCode=event.which;if(event.shiftKey&&keyCode===9){var id=document.activeElement.id;if(id==='to'){data.mailListView.setFocusInMailView(true);setTimeout(function(){keyhandler.focusDomain('listPanel')},1)}else{var index=fields.indexOf(id);if(index===-1){keyhandler.focusDomain('listPanel')}else{var lastField;while(!lastField){index-=1;lastField=$('#'+fields[index])[0]}setTimeout(function(){lastField.focus()},1)}}}}return true};RecipientInput.prototype.setup=function(element){var $element=$(element);var $mainInput=$('.main-input',element);var $pasteArea=$('.paste-area',element);var repositionTimeout=null;function repositionMainInput(){$mainInput.width(30);clearTimeout(repositionTimeout);repositionTimeout=setTimeout(function(){var fullWidth=$element.innerWidth()-10;var leftOffset=$mainInput.offset().left-$element.offset().left;var inputWidth=fullWidth-leftOffset;$mainInput.width(Math.floor(inputWidth))},100)}var completed=this.completed;var editingItemValue=ko.computed(function(){return completed().reduce(function(previous,item){if(item.editing()){return item.value()}else{return previous}},null)});editingItemValue.subscribe(repositionMainInput);$(window).on('resize',repositionMainInput);this.selected.subscribe(repositionMainInput);repositionMainInput();$pasteArea.on('mousedown',function(e){var inputField=ko.dataFor(e.target);if(e.which===1){inputField.focusInput();return false}});$pasteArea.on('paste',function(e){var text;var cancelPaste=false;if(window.clipboardData){var clipped=window.clipboardData.getData('Text');text=clipped.replace(/(\r\n|\n|\r)/gm,' ');cancelPaste=true}setTimeout(function(){if(typeof text==='undefined'){text=$pasteArea.val()}var inputField=ko.dataFor(e.target);inputField.flushChanges();inputField.select(text.split(/[,;]/));$pasteArea.val('');inputField.focusInput()},1);return!cancelPaste})};RecipientInput.prototype.blurHandler=function(data,event){this.flushChanges()};RecipientInput.prototype.focusInput=function(){this.inputFocused(true)};RecipientInput.prototype.removeItem=function(index,data,event){var that=this;that.selected.splice(index(),1)};RecipientInput.prototype.format=function(item){if(item instanceof RecipientGroup){return item.toString()+' ('+item.recipients.length+')'}var displayName=item.displayName;if(!displayName||displayName===item.displayEmail){return item.displayEmail}return displayName+(item.displayEmail?' <'+item.displayEmail+'>':'')};RecipientInput.prototype.reset=function(){var that=this;that.selected([]);that.value('')};RecipientInput.prototype.dropRecipient=function(selectedItem,recipientInput){selectedItem.moveTo(recipientInput)};RecipientInput.prototype.dragEnter=function(event,selectedItem,recipientInput){return selectedItem.recipientInput!==recipientInput};return RecipientInput})}());(function(){var define=System.amdDefine;define('webmail/composer/OutgoingMail.js',[],function(){function OutgoingMail(data){this.headers=data.headers;this.html=data.html;this.text=data.text;this.attachments=data.attachments||[];this.original=data.original||null;this.destination=data.destination||null}return OutgoingMail})}());(function(){var define=System.amdDefine;define('webmail/mailView/ContactCard.js',['node_modules/knockout/build/output/knockout-latest.debug.js','common/util.js','3rdparty/ContactModel.js','3rdparty/purify.js','3rdparty/page.js','common/AppCourier.js'],function(ko,util,ContactModel,purify,page,AppCourier){function ContactCard(username,recipientIndex,recipient,contactCardWithLink){var that=this;that.contactCardForRecipient=ko.observable(false);that.showContactCard=ko.observable(contactCardWithLink);if(that.showContactCard()||contactCardWithLink===false){that.contactCardForRecipient(true)}if(!recipient.email){that.recipients=[recipient];that.backed=false}else{that.recipients=recipientIndex[recipient.email.toLowerCase()];that.backed=!!that.recipients;that.recipients=that.recipients||[recipient]}that.shownContact=ko.observable(that.recipients[0]);that.shownContactIndex=ko.computed(function(){return that.recipients.indexOf(that.shownContact())+1});that.hasMultipleContacts=that.recipients.length>1;that.photoUrl=ko.computed(function(){if(that.showContactCard()||that.backed===false){return'https://mail-static.cdn-one.com/user.inkscape--export-width92,--export-area0-0-18-18.6dbce39d24.png'}if(!that.shownContact().photoUrl||that.backed===true){if(!that.shownContact().photoUrl){return'https://mail-static.cdn-one.com/user.inkscape--export-width92,--export-area0-0-18-18.6dbce39d24.png'}}var url=that.shownContact().photoUrl;return url+(url.indexOf('?')===-1?'?':'&')+'height=92&width=92&crop=true&gravity=North&repage=true'});that.email=function(){return recipient.email};that.displayEmail=function(){return purify.emailIdn(recipient.email)};that.username=username;that.mailto=ko.computed(function(){var displayName=that.shownContact().displayName;var mailto;if(displayName){mailto='"'+displayName+'" <'+that.email()+'>'}else{mailto=that.email()}return encodeURIComponent(mailto)});that.sendEmail=function(){location.go('mailto:'+that.mailto())};that.sendToContactsText=that.backed?TR('mail.EditContact','Edit contact'):TR('contacts.AddContactToMyContacts','Add to my contacts')}ContactCard.prototype.showNextContact=function(){var index=this.recipients.indexOf(this.shownContact());index+=1;if(index===this.recipients.length){index=0}this.shownContact(this.recipients[index])};ContactCard.prototype.showPreviousContact=function(){var index=this.recipients.indexOf(this.shownContact());index-=1;if(index===-1){index=this.recipients.length-1}this.shownContact(this.recipients[index])};ContactCard.prototype.setState=function(state){this.state=state};ContactCard.prototype.addToMyContacts=function(){var data=this.shownContact();var displayName=data.displayName,email=data.email;if(displayName===undefined){displayName=null}var contactData={};if(email){contactData.emails=[{value:email}]}if(displayName){contactData.displayName=displayName}var contactModel=new ContactModel(contactData,true);this.state.notification({message:TR('mail.ContactAddedToMyContacts','Contact added to my contacts'),timeout:3000});this.state.signals.addNewContact.dispatch(contactModel,data);this.showContactCard(null)};ContactCard.prototype.toContactApp=function(){if(this.backed){page.show('/contacts/'+this.username+'/all/edit/'+this.shownContact().id)}else{var message={displayName:this.shownContact().displayName,email:this.email()};AppCourier.depart('/contacts/'+this.username+'/all/new',message)}};return ContactCard})}());System.registerDynamic('3rdparty/squire.js',[],false,function($__require,$__exports,$__module){var _retrieveGlobal=System.get('@@global-helpers').prepareGlobal($__module.id,'Squire',null);(function($__global){(function(doc,undefined){'use strict';var DOCUMENT_POSITION_PRECEDING=2;var ELEMENT_NODE=1;var TEXT_NODE=3;var DOCUMENT_NODE=9;var DOCUMENT_FRAGMENT_NODE=11;var SHOW_ELEMENT=1;var SHOW_TEXT=4;var START_TO_START=0;var START_TO_END=1;var END_TO_END=2;var END_TO_START=3;var HIGHLIGHT_CLASS='highlight';var COLOUR_CLASS='colour';var FONT_FAMILY_CLASS='font';var FONT_SIZE_CLASS='size';var ZWS='​';var win=doc.defaultView;var ua=navigator.userAgent;var isAndroid=/Android/.test(ua);var isIOS=/iP(?:ad|hone|od)/.test(ua);var isMac=/Mac OS X/.test(ua);var isWin=/Windows NT/.test(ua);var isGecko=/Gecko\//.test(ua);var isIElt11=/Trident\/[456]\./.test(ua);var isPresto=!!win.opera;var isEdge=/Edge\//.test(ua);var isWebKit=!isEdge&&/WebKit\//.test(ua);var isIE=/Trident\/[4567]\./.test(ua);var ctrlKey=isMac?'meta-':'ctrl-';var useTextFixer=isIElt11||isPresto;var cantFocusEmptyTextNodes=isIElt11||isWebKit;var losesSelectionOnBlur=isIElt11;var canObserveMutations=typeof MutationObserver!=='undefined';var canWeakMap=typeof WeakMap!=='undefined';var notWS=/[^ \t\r\n]/;var indexOf=Array.prototype.indexOf;if(!Object.create){Object.create=function(proto){var F=function(){};F.prototype=proto;return new F}}var typeToBitArray={1:1,2:2,3:4,8:128,9:256,11:1024};function TreeWalker(root,nodeType,filter){this.root=this.currentNode=root;this.nodeType=nodeType;this.filter=filter}TreeWalker.prototype.nextNode=function(){var current=this.currentNode,root=this.root,nodeType=this.nodeType,filter=this.filter,node;while(true){node=current.firstChild;while(!node&&current){if(current===root){break}node=current.nextSibling;if(!node){current=current.parentNode}}if(!node){return null}if(typeToBitArray[node.nodeType]&nodeType&&filter(node)){this.currentNode=node;return node}current=node}};TreeWalker.prototype.previousNode=function(){var current=this.currentNode,root=this.root,nodeType=this.nodeType,filter=this.filter,node;while(true){if(current===root){return null}node=current.previousSibling;if(node){while(current=node.lastChild){node=current}}else{node=current.parentNode}if(!node){return null}if(typeToBitArray[node.nodeType]&nodeType&&filter(node)){this.currentNode=node;return node}current=node}};TreeWalker.prototype.previousPONode=function(){var current=this.currentNode,root=this.root,nodeType=this.nodeType,filter=this.filter,node;while(true){node=current.lastChild;while(!node&&current){if(current===root){break}node=current.previousSibling;if(!node){current=current.parentNode}}if(!node){return null}if(typeToBitArray[node.nodeType]&nodeType&&filter(node)){this.currentNode=node;return node}current=node}};var inlineNodeNames=/^(?:#text|A(?:BBR|CRONYM)?|B(?:R|D[IO])?|C(?:ITE|ODE)|D(?:ATA|EL|FN)|EM|FONT|HR|I(?:FRAME|MG|NPUT|NS)?|KBD|Q|R(?:P|T|UBY)|S(?:AMP|MALL|PAN|TR(?:IKE|ONG)|U[BP])?|TIME|U|VAR|WBR)$/;var leafNodeNames={BR:1,HR:1,IFRAME:1,IMG:1,INPUT:1};function every(nodeList,fn){var l=nodeList.length;while(l--){if(!fn(nodeList[l])){return false}}return true}var UNKNOWN=0;var INLINE=1;var BLOCK=2;var CONTAINER=3;var nodeCategoryCache=canWeakMap?new WeakMap:null;function isLeaf(node){return node.nodeType===ELEMENT_NODE&&!!leafNodeNames[node.nodeName]}function getNodeCategory(node){switch(node.nodeType){case TEXT_NODE:return INLINE;case ELEMENT_NODE:case DOCUMENT_FRAGMENT_NODE:if(canWeakMap&&nodeCategoryCache.has(node)){return nodeCategoryCache.get(node)}break;default:return UNKNOWN}var nodeCategory;if(!every(node.childNodes,isInline)){nodeCategory=CONTAINER}else if(inlineNodeNames.test(node.nodeName)){nodeCategory=INLINE}else{nodeCategory=BLOCK}if(canWeakMap){nodeCategoryCache.set(node,nodeCategory)}return nodeCategory}function isInline(node){return getNodeCategory(node)===INLINE}function isBlock(node){return getNodeCategory(node)===BLOCK}function isContainer(node){return getNodeCategory(node)===CONTAINER}function getBlockWalker(node,root){var walker=new TreeWalker(root,SHOW_ELEMENT,isBlock);walker.currentNode=node;return walker}function getPreviousBlock(node,root){node=getBlockWalker(node,root).previousNode();return node!==root?node:null}function getNextBlock(node,root){node=getBlockWalker(node,root).nextNode();return node!==root?node:null}function isEmptyBlock(block){return!block.textContent&&!block.querySelector('IMG')}function areAlike(node,node2){return!isLeaf(node)&&node.nodeType===node2.nodeType&&node.nodeName===node2.nodeName&&node.nodeName!=='A'&&node.className===node2.className&&(!node.style&&!node2.style||node.style.cssText===node2.style.cssText)}function hasTagAttributes(node,tag,attributes){if(node.nodeName!==tag){return false}for(var attr in attributes){if(node.getAttribute(attr)!==attributes[attr]){return false}}return true}function getNearest(node,root,tag,attributes){while(node&&node!==root){if(hasTagAttributes(node,tag,attributes)){return node}node=node.parentNode}return null}function isOrContains(parent,node){while(node){if(node===parent){return true}node=node.parentNode}return false}function getPath(node,root){var path='';var id,className,classNames,dir;if(node&&node!==root){path=getPath(node.parentNode,root);if(node.nodeType===ELEMENT_NODE){path+=(path?'>':'')+node.nodeName;if(id=node.id){path+='#'+id}if(className=node.className.trim()){classNames=className.split(/\s\s*/);classNames.sort();path+='.';path+=classNames.join('.')}if(dir=node.dir){path+='[dir='+dir+']'}if(classNames){if(indexOf.call(classNames,HIGHLIGHT_CLASS)>-1){path+='[backgroundColor='+node.style.backgroundColor.replace(/ /g,'')+']'}if(indexOf.call(classNames,COLOUR_CLASS)>-1){path+='[color='+node.style.color.replace(/ /g,'')+']'}if(indexOf.call(classNames,FONT_FAMILY_CLASS)>-1){path+='[fontFamily='+node.style.fontFamily.replace(/ /g,'')+']'}if(indexOf.call(classNames,FONT_SIZE_CLASS)>-1){path+='[fontSize='+node.style.fontSize+']'}}}}return path}function getLength(node){var nodeType=node.nodeType;return nodeType===ELEMENT_NODE||nodeType===DOCUMENT_FRAGMENT_NODE?node.childNodes.length:node.length||0}function detach(node){var parent=node.parentNode;if(parent){parent.removeChild(node)}return node}function replaceWith(node,node2){var parent=node.parentNode;if(parent){parent.replaceChild(node2,node)}}function empty(node){var frag=node.ownerDocument.createDocumentFragment(),childNodes=node.childNodes,l=childNodes?childNodes.length:0;while(l--){frag.appendChild(node.firstChild)}return frag}function createElement(doc,tag,props,children){var el=doc.createElement(tag),attr,value,i,l;if(props instanceof Array){children=props;props=null}if(props){for(attr in props){value=props[attr];if(value!==undefined){el.setAttribute(attr,props[attr])}}}if(children){for(i=0,l=children.length;i<l;i+=1){el.appendChild(children[i])}}return el}function fixCursor(node,root){var self=root.__squire__;var doc=node.ownerDocument;var originalNode=node;var fixer,child;if(node===root){if(!(child=node.firstChild)||child.nodeName==='BR'){fixer=self.createDefaultBlock();if(child){node.replaceChild(fixer,child)}else{node.appendChild(fixer)}node=fixer;fixer=null}}if(node.nodeType===TEXT_NODE){return originalNode}if(isInline(node)){child=node.firstChild;while(cantFocusEmptyTextNodes&&child&&child.nodeType===TEXT_NODE&&!child.data){node.removeChild(child);child=node.firstChild}if(!child){if(cantFocusEmptyTextNodes){fixer=doc.createTextNode(ZWS);self._didAddZWS()}else{fixer=doc.createTextNode('')}}}else{if(useTextFixer){while(node.nodeType!==TEXT_NODE&&!isLeaf(node)){child=node.firstChild;if(!child){fixer=doc.createTextNode('');break}node=child}if(node.nodeType===TEXT_NODE){if(/^ +$/.test(node.data)){node.data=''}}else if(isLeaf(node)){node.parentNode.insertBefore(doc.createTextNode(''),node)}}else if(!node.querySelector('BR')){fixer=createElement(doc,'BR');while((child=node.lastElementChild)&&!isInline(child)){node=child}}}if(fixer){try{node.appendChild(fixer)}catch(error){self.didError({name:'Squire: fixCursor – '+error,message:'Parent: '+node.nodeName+'/'+node.innerHTML+' appendChild: '+fixer.nodeName})}}return originalNode}function fixContainer(container,root){var children=container.childNodes;var doc=container.ownerDocument;var wrapper=null;var i,l,child,isBR;var config=root.__squire__._config;for(i=0,l=children.length;i<l;i+=1){child=children[i];isBR=child.nodeName==='BR';if(!isBR&&isInline(child)){if(!wrapper){wrapper=createElement(doc,config.blockTag,config.blockAttributes)}wrapper.appendChild(child);i-=1;l-=1}else if(isBR||wrapper){if(!wrapper){wrapper=createElement(doc,config.blockTag,config.blockAttributes)}fixCursor(wrapper,root);if(isBR){container.replaceChild(wrapper,child)}else{container.insertBefore(wrapper,child);i+=1;l+=1}wrapper=null}if(isContainer(child)){fixContainer(child,root)}}if(wrapper){container.appendChild(fixCursor(wrapper,root))}return container}function split(node,offset,stopNode,root){var nodeType=node.nodeType,parent,clone,next;if(nodeType===TEXT_NODE&&node!==stopNode){return split(node.parentNode,node.splitText(offset),stopNode,root)}if(nodeType===ELEMENT_NODE){if(typeof offset==='number'){offset=offset<node.childNodes.length?node.childNodes[offset]:null}if(node===stopNode){return offset}parent=node.parentNode;clone=node.cloneNode(false);while(offset){next=offset.nextSibling;clone.appendChild(offset);offset=next}if(node.nodeName==='OL'&&getNearest(node,root,'BLOCKQUOTE')){clone.start=(+node.start||1)+node.childNodes.length-1}fixCursor(node,root);fixCursor(clone,root);if(next=node.nextSibling){parent.insertBefore(clone,next)}else{parent.appendChild(clone)}return split(parent,clone,stopNode,root)}return offset}function _mergeInlines(node,fakeRange){var children=node.childNodes,l=children.length,frags=[],child,prev,len;while(l--){child=children[l];prev=l&&children[l-1];if(l&&isInline(child)&&areAlike(child,prev)&&!leafNodeNames[child.nodeName]){if(fakeRange.startContainer===child){fakeRange.startContainer=prev;fakeRange.startOffset+=getLength(prev)}if(fakeRange.endContainer===child){fakeRange.endContainer=prev;fakeRange.endOffset+=getLength(prev)}if(fakeRange.startContainer===node){if(fakeRange.startOffset>l){fakeRange.startOffset-=1}else if(fakeRange.startOffset===l){fakeRange.startContainer=prev;fakeRange.startOffset=getLength(prev)}}if(fakeRange.endContainer===node){if(fakeRange.endOffset>l){fakeRange.endOffset-=1}else if(fakeRange.endOffset===l){fakeRange.endContainer=prev;fakeRange.endOffset=getLength(prev)}}detach(child);if(child.nodeType===TEXT_NODE){prev.appendData(child.data)}else{frags.push(empty(child))}}else if(child.nodeType===ELEMENT_NODE){len=frags.length;while(len--){child.appendChild(frags.pop())}_mergeInlines(child,fakeRange)}}}function mergeInlines(node,range){if(node.nodeType===TEXT_NODE){node=node.parentNode}if(node.nodeType===ELEMENT_NODE){var fakeRange={startContainer:range.startContainer,startOffset:range.startOffset,endContainer:range.endContainer,endOffset:range.endOffset};_mergeInlines(node,fakeRange);range.setStart(fakeRange.startContainer,fakeRange.startOffset);range.setEnd(fakeRange.endContainer,fakeRange.endOffset)}}function mergeWithBlock(block,next,range,root){var container=next;var parent,last,offset;while((parent=container.parentNode)&&parent!==root&&parent.nodeType===ELEMENT_NODE&&parent.childNodes.length===1){container=parent}detach(container);offset=block.childNodes.length;last=block.lastChild;if(last&&last.nodeName==='BR'){block.removeChild(last);offset-=1}block.appendChild(empty(next));range.setStart(block,offset);range.collapse(true);mergeInlines(block,range);if(isPresto&&(last=block.lastChild)&&last.nodeName==='BR'){block.removeChild(last)}}function mergeContainers(node,root){var prev=node.previousSibling,first=node.firstChild,doc=node.ownerDocument,isListItem=node.nodeName==='LI',needsFix,block;if(isListItem&&(!first||!/^[OU]L$/.test(first.nodeName))){return}if(prev&&areAlike(prev,node)){if(!isContainer(prev)){if(isListItem){block=createElement(doc,'DIV');block.appendChild(empty(prev));prev.appendChild(block)}else{return}}detach(node);needsFix=!isContainer(node);prev.appendChild(empty(node));if(needsFix){fixContainer(prev,root)}if(first){mergeContainers(first,root)}}else if(isListItem){prev=createElement(doc,'DIV');node.insertBefore(prev,first);fixCursor(prev,root)}}var getNodeBefore=function(node,offset){var children=node.childNodes;while(offset&&node.nodeType===ELEMENT_NODE){node=children[offset-1];children=node.childNodes;offset=children.length}return node};var getNodeAfter=function(node,offset){if(node.nodeType===ELEMENT_NODE){var children=node.childNodes;if(offset<children.length){node=children[offset]}else{while(node&&!node.nextSibling){node=node.parentNode}if(node){node=node.nextSibling}}}return node};var insertNodeInRange=function(range,node){var startContainer=range.startContainer,startOffset=range.startOffset,endContainer=range.endContainer,endOffset=range.endOffset,parent,children,childCount,afterSplit;if(startContainer.nodeType===TEXT_NODE){parent=startContainer.parentNode;children=parent.childNodes;if(startOffset===startContainer.length){startOffset=indexOf.call(children,startContainer)+1;if(range.collapsed){endContainer=parent;endOffset=startOffset}}else{if(startOffset){afterSplit=startContainer.splitText(startOffset);if(endContainer===startContainer){endOffset-=startOffset;endContainer=afterSplit}else if(endContainer===parent){endOffset+=1}startContainer=afterSplit}startOffset=indexOf.call(children,startContainer)}startContainer=parent}else{children=startContainer.childNodes}childCount=children.length;if(startOffset===childCount){startContainer.appendChild(node)}else{startContainer.insertBefore(node,children[startOffset])}if(startContainer===endContainer){endOffset+=children.length-childCount}range.setStart(startContainer,startOffset);range.setEnd(endContainer,endOffset)};var extractContentsOfRange=function(range,common,root){var startContainer=range.startContainer,startOffset=range.startOffset,endContainer=range.endContainer,endOffset=range.endOffset;if(!common){common=range.commonAncestorContainer}if(common.nodeType===TEXT_NODE){common=common.parentNode}var endNode=split(endContainer,endOffset,common,root),startNode=split(startContainer,startOffset,common,root),frag=common.ownerDocument.createDocumentFragment(),next,before,after;while(startNode!==endNode){next=startNode.nextSibling;frag.appendChild(startNode);startNode=next}startContainer=common;startOffset=endNode?indexOf.call(common.childNodes,endNode):common.childNodes.length;after=common.childNodes[startOffset];before=after&&after.previousSibling;if(before&&before.nodeType===TEXT_NODE&&after.nodeType===TEXT_NODE){startContainer=before;startOffset=before.length;before.appendData(after.data);detach(after)}range.setStart(startContainer,startOffset);range.collapse(true);fixCursor(common,root);return frag};var deleteContentsOfRange=function(range,root){var startBlock=getStartBlockOfRange(range,root);var endBlock=getEndBlockOfRange(range,root);var needsMerge=startBlock!==endBlock;var frag,child;moveRangeBoundariesDownTree(range);moveRangeBoundariesUpTree(range,startBlock,endBlock,root);frag=extractContentsOfRange(range,null,root);moveRangeBoundariesDownTree(range);if(needsMerge){endBlock=getEndBlockOfRange(range,root);if(startBlock&&endBlock&&startBlock!==endBlock){mergeWithBlock(startBlock,endBlock,range,root)}}if(startBlock){fixCursor(startBlock,root)}child=root.firstChild;if(!child||child.nodeName==='BR'){fixCursor(root,root);range.selectNodeContents(root.firstChild)}else{range.collapse(true)}return frag};var insertTreeFragmentIntoRange=function(range,frag,root){var node,block,blockContentsAfterSplit,stopPoint,container,offset;var firstBlockInFrag,nodeAfterSplit,nodeBeforeSplit,tempRange;fixContainer(frag,root);node=frag;while(node=getNextBlock(node,root)){fixCursor(node,root)}if(!range.collapsed){deleteContentsOfRange(range,root)}moveRangeBoundariesDownTree(range);range.collapse(false);stopPoint=getNearest(range.endContainer,root,'BLOCKQUOTE')||root;block=getStartBlockOfRange(range,root);firstBlockInFrag=getNextBlock(frag,frag);if(block&&firstBlockInFrag&&!getNearest(firstBlockInFrag,frag,'PRE')&&!getNearest(firstBlockInFrag,frag,'TABLE')){moveRangeBoundariesUpTree(range,block,block,root);range.collapse(true);container=range.endContainer;offset=range.endOffset;cleanupBRs(block,root,false);if(isInline(container)){nodeAfterSplit=split(container,offset,getPreviousBlock(container,root),root);container=nodeAfterSplit.parentNode;offset=indexOf.call(container.childNodes,nodeAfterSplit)}if(offset!==getLength(container)){blockContentsAfterSplit=root.ownerDocument.createDocumentFragment();while(node=container.childNodes[offset]){blockContentsAfterSplit.appendChild(node)}}mergeWithBlock(container,firstBlockInFrag,range,root);offset=indexOf.call(container.parentNode.childNodes,container)+1;container=container.parentNode;range.setEnd(container,offset)}if(getLength(frag)){moveRangeBoundariesUpTree(range,stopPoint,stopPoint,root);nodeAfterSplit=split(range.endContainer,range.endOffset,stopPoint,root);nodeBeforeSplit=nodeAfterSplit?nodeAfterSplit.previousSibling:stopPoint.lastChild;stopPoint.insertBefore(frag,nodeAfterSplit);if(nodeAfterSplit){range.setEndBefore(nodeAfterSplit)}else{range.setEnd(stopPoint,getLength(stopPoint))}block=getEndBlockOfRange(range,root);moveRangeBoundariesDownTree(range);container=range.endContainer;offset=range.endOffset;if(nodeAfterSplit&&isContainer(nodeAfterSplit)){mergeContainers(nodeAfterSplit,root)}nodeAfterSplit=nodeBeforeSplit&&nodeBeforeSplit.nextSibling;if(nodeAfterSplit&&isContainer(nodeAfterSplit)){mergeContainers(nodeAfterSplit,root)}range.setEnd(container,offset)}if(blockContentsAfterSplit){tempRange=range.cloneRange();mergeWithBlock(block,blockContentsAfterSplit,tempRange,root);range.setEnd(tempRange.endContainer,tempRange.endOffset)}moveRangeBoundariesDownTree(range)};var isNodeContainedInRange=function(range,node,partial){var nodeRange=node.ownerDocument.createRange();nodeRange.selectNode(node);if(partial){var nodeEndBeforeStart=range.compareBoundaryPoints(END_TO_START,nodeRange)>-1,nodeStartAfterEnd=range.compareBoundaryPoints(START_TO_END,nodeRange)<1;return!nodeEndBeforeStart&&!nodeStartAfterEnd}else{var nodeStartAfterStart=range.compareBoundaryPoints(START_TO_START,nodeRange)<1,nodeEndBeforeEnd=range.compareBoundaryPoints(END_TO_END,nodeRange)>-1;return nodeStartAfterStart&&nodeEndBeforeEnd}};var moveRangeBoundariesDownTree=function(range){var startContainer=range.startContainer,startOffset=range.startOffset,endContainer=range.endContainer,endOffset=range.endOffset,maySkipBR=true,child;while(startContainer.nodeType!==TEXT_NODE){child=startContainer.childNodes[startOffset];if(!child||isLeaf(child)){break}startContainer=child;startOffset=0}if(endOffset){while(endContainer.nodeType!==TEXT_NODE){child=endContainer.childNodes[endOffset-1];if(!child||isLeaf(child)){if(maySkipBR&&child&&child.nodeName==='BR'){endOffset-=1;maySkipBR=false;continue}break}endContainer=child;endOffset=getLength(endContainer)}}else{while(endContainer.nodeType!==TEXT_NODE){child=endContainer.firstChild;if(!child||isLeaf(child)){break}endContainer=child}}if(range.collapsed){range.setStart(endContainer,endOffset);range.setEnd(startContainer,startOffset)}else{range.setStart(startContainer,startOffset);range.setEnd(endContainer,endOffset)}};var moveRangeBoundariesUpTree=function(range,startMax,endMax,root){var startContainer=range.startContainer;var startOffset=range.startOffset;var endContainer=range.endContainer;var endOffset=range.endOffset;var maySkipBR=true;var parent;if(!startMax){startMax=range.commonAncestorContainer}if(!endMax){endMax=startMax}while(!startOffset&&startContainer!==startMax&&startContainer!==root){parent=startContainer.parentNode;startOffset=indexOf.call(parent.childNodes,startContainer);startContainer=parent}while(true){if(maySkipBR&&endContainer.nodeType!==TEXT_NODE&&endContainer.childNodes[endOffset]&&endContainer.childNodes[endOffset].nodeName==='BR'){endOffset+=1;maySkipBR=false}if(endContainer===endMax||endContainer===root||endOffset!==getLength(endContainer)){break}parent=endContainer.parentNode;endOffset=indexOf.call(parent.childNodes,endContainer)+1;endContainer=parent}range.setStart(startContainer,startOffset);range.setEnd(endContainer,endOffset)};var getStartBlockOfRange=function(range,root){var container=range.startContainer,block;if(isInline(container)){block=getPreviousBlock(container,root)}else if(container!==root&&isBlock(container)){block=container}else{block=getNodeBefore(container,range.startOffset);block=getNextBlock(block,root)}return block&&isNodeContainedInRange(range,block,true)?block:null};var getEndBlockOfRange=function(range,root){var container=range.endContainer,block,child;if(isInline(container)){block=getPreviousBlock(container,root)}else if(container!==root&&isBlock(container)){block=container}else{block=getNodeAfter(container,range.endOffset);if(!block||!isOrContains(root,block)){block=root;while(child=block.lastChild){block=child}}block=getPreviousBlock(block,root)}return block&&isNodeContainedInRange(range,block,true)?block:null};var contentWalker=new TreeWalker(null,SHOW_TEXT|SHOW_ELEMENT,function(node){return node.nodeType===TEXT_NODE?notWS.test(node.data):node.nodeName==='IMG'});var rangeDoesStartAtBlockBoundary=function(range,root){var startContainer=range.startContainer;var startOffset=range.startOffset;var nodeAfterCursor;contentWalker.root=null;if(startContainer.nodeType===TEXT_NODE){if(startOffset){return false}nodeAfterCursor=startContainer}else{nodeAfterCursor=getNodeAfter(startContainer,startOffset);if(nodeAfterCursor&&!isOrContains(root,nodeAfterCursor)){nodeAfterCursor=null}if(!nodeAfterCursor){nodeAfterCursor=getNodeBefore(startContainer,startOffset);if(nodeAfterCursor.nodeType===TEXT_NODE&&nodeAfterCursor.length){return false}}}contentWalker.currentNode=nodeAfterCursor;contentWalker.root=getStartBlockOfRange(range,root);return!contentWalker.previousNode()};var rangeDoesEndAtBlockBoundary=function(range,root){var endContainer=range.endContainer,endOffset=range.endOffset,length;contentWalker.root=null;if(endContainer.nodeType===TEXT_NODE){length=endContainer.data.length;if(length&&endOffset<length){return false}contentWalker.currentNode=endContainer}else{contentWalker.currentNode=getNodeBefore(endContainer,endOffset)}contentWalker.root=getEndBlockOfRange(range,root);return!contentWalker.nextNode()};var expandRangeToBlockBoundaries=function(range,root){var start=getStartBlockOfRange(range,root),end=getEndBlockOfRange(range,root),parent;if(start&&end){parent=start.parentNode;range.setStart(parent,indexOf.call(parent.childNodes,start));parent=end.parentNode;range.setEnd(parent,indexOf.call(parent.childNodes,end)+1)}};var keys={8:'backspace',9:'tab',13:'enter',32:'space',33:'pageup',34:'pagedown',37:'left',39:'right',46:'delete',219:'[',221:']'};var onKey=function(event){var code=event.keyCode,key=keys[code],modifiers='',range=this.getSelection();if(event.defaultPrevented){return}if(!key){key=String.fromCharCode(code).toLowerCase();if(!/^[A-Za-z0-9]$/.test(key)){key=''}}if(isPresto&&event.which===46){key='.'}if(111<code&&code<124){key='f'+(code-111)}if(key!=='backspace'&&key!=='delete'){if(event.altKey){modifiers+='alt-'}if(event.ctrlKey){modifiers+='ctrl-'}if(event.metaKey){modifiers+='meta-'}}if(event.shiftKey){modifiers+='shift-'}key=modifiers+key;if(this._keyHandlers[key]){this._keyHandlers[key](this,event,range)}else if(key.length===1&&!range.collapsed){this.saveUndoState(range);deleteContentsOfRange(range,this._root);this._ensureBottomLine();this.setSelection(range);this._updatePath(range,true)}};var mapKeyTo=function(method){return function(self,event){event.preventDefault();self[method]()}};var mapKeyToFormat=function(tag,remove){remove=remove||null;return function(self,event){event.preventDefault();var range=self.getSelection();if(self.hasFormat(tag,null,range)){self.changeFormat(null,{tag:tag},range)}else{self.changeFormat({tag:tag},remove,range)}}};var afterDelete=function(self,range){try{if(!range){range=self.getSelection()}var node=range.startContainer,parent;if(node.nodeType===TEXT_NODE){node=node.parentNode}parent=node;while(isInline(parent)&&(!parent.textContent||parent.textContent===ZWS)){node=parent;parent=node.parentNode}if(node!==parent){range.setStart(parent,indexOf.call(parent.childNodes,node));range.collapse(true);parent.removeChild(node);if(!isBlock(parent)){parent=getPreviousBlock(parent,self._root)}fixCursor(parent,self._root);moveRangeBoundariesDownTree(range)}if(node===self._root&&(node=node.firstChild)&&node.nodeName==='BR'){detach(node)}self._ensureBottomLine();self.setSelection(range);self._updatePath(range,true)}catch(error){self.didError(error)}};var keyHandlers={enter:function(self,event,range){var root=self._root;var block,parent,nodeAfterSplit;event.preventDefault();self._recordUndoState(range);addLinks(range.startContainer,root,self);self._removeZWS();self._getRangeAndRemoveBookmark(range);if(!range.collapsed){deleteContentsOfRange(range,root)}block=getStartBlockOfRange(range,root);if(!block||/^T[HD]$/.test(block.nodeName)){parent=getNearest(range.endContainer,root,'A');if(parent){parent=parent.parentNode;moveRangeBoundariesUpTree(range,parent,parent,root);range.collapse(false)}insertNodeInRange(range,self.createElement('BR'));range.collapse(false);self.setSelection(range);self._updatePath(range,true);return}if(parent=getNearest(block,root,'LI')){block=parent}if(isEmptyBlock(block)){if(getNearest(block,root,'UL')||getNearest(block,root,'OL')){return self.decreaseListLevel(range)}else if(getNearest(block,root,'BLOCKQUOTE')){return self.modifyBlocks(removeBlockQuote,range)}}nodeAfterSplit=splitBlock(self,block,range.startContainer,range.startOffset);removeZWS(block);removeEmptyInlines(block);fixCursor(block,root);while(nodeAfterSplit.nodeType===ELEMENT_NODE){var child=nodeAfterSplit.firstChild,next;if(nodeAfterSplit.nodeName==='A'&&(!nodeAfterSplit.textContent||nodeAfterSplit.textContent===ZWS)){child=self._doc.createTextNode('');replaceWith(nodeAfterSplit,child);nodeAfterSplit=child;break}while(child&&child.nodeType===TEXT_NODE&&!child.data){next=child.nextSibling;if(!next||next.nodeName==='BR'){break}detach(child);child=next}if(!child||child.nodeName==='BR'||child.nodeType===TEXT_NODE&&!isPresto){break}nodeAfterSplit=child}range=self._createRange(nodeAfterSplit,0);self.setSelection(range);self._updatePath(range,true)},backspace:function(self,event,range){var root=self._root;self._removeZWS();self.saveUndoState(range);if(!range.collapsed){event.preventDefault();deleteContentsOfRange(range,root);afterDelete(self,range)}else if(rangeDoesStartAtBlockBoundary(range,root)){event.preventDefault();var current=getStartBlockOfRange(range,root);var previous;if(!current){return}fixContainer(current.parentNode,root);previous=getPreviousBlock(current,root);if(previous){if(!previous.isContentEditable){detach(previous);return}mergeWithBlock(previous,current,range,root);current=previous.parentNode;while(current!==root&&!current.nextSibling){current=current.parentNode}if(current!==root&&(current=current.nextSibling)){mergeContainers(current,root)}self.setSelection(range)}else if(current){if(getNearest(current,root,'UL')||getNearest(current,root,'OL')){return self.decreaseListLevel(range)}else if(getNearest(current,root,'BLOCKQUOTE')){return self.modifyBlocks(decreaseBlockQuoteLevel,range)}self.setSelection(range);self._updatePath(range,true)}}else{self.setSelection(range);setTimeout(function(){afterDelete(self)},0)}},'delete':function(self,event,range){var root=self._root;var current,next,originalRange,cursorContainer,cursorOffset,nodeAfterCursor;self._removeZWS();self.saveUndoState(range);if(!range.collapsed){event.preventDefault();deleteContentsOfRange(range,root);afterDelete(self,range)}else if(rangeDoesEndAtBlockBoundary(range,root)){event.preventDefault();current=getStartBlockOfRange(range,root);if(!current){return}fixContainer(current.parentNode,root);next=getNextBlock(current,root);if(next){if(!next.isContentEditable){detach(next);return}mergeWithBlock(current,next,range,root);next=current.parentNode;while(next!==root&&!next.nextSibling){next=next.parentNode}if(next!==root&&(next=next.nextSibling)){mergeContainers(next,root)}self.setSelection(range);self._updatePath(range,true)}}else{originalRange=range.cloneRange();moveRangeBoundariesUpTree(range,root,root,root);cursorContainer=range.endContainer;cursorOffset=range.endOffset;if(cursorContainer.nodeType===ELEMENT_NODE){nodeAfterCursor=cursorContainer.childNodes[cursorOffset];if(nodeAfterCursor&&nodeAfterCursor.nodeName==='IMG'){event.preventDefault();detach(nodeAfterCursor);moveRangeBoundariesDownTree(range);afterDelete(self,range);return}}self.setSelection(originalRange);setTimeout(function(){afterDelete(self)},0)}},tab:function(self,event,range){var root=self._root;var node,parent;self._removeZWS();if(range.collapsed&&rangeDoesStartAtBlockBoundary(range,root)){node=getStartBlockOfRange(range,root);while(parent=node.parentNode){if(parent.nodeName==='UL'||parent.nodeName==='OL'){event.preventDefault();self.increaseListLevel(range);break}node=parent}}},'shift-tab':function(self,event,range){var root=self._root;var node;self._removeZWS();if(range.collapsed&&rangeDoesStartAtBlockBoundary(range,root)){node=range.startContainer;if(getNearest(node,root,'UL')||getNearest(node,root,'OL')){event.preventDefault();self.decreaseListLevel(range)}}},space:function(self,_,range){var node,parent;self._recordUndoState(range);addLinks(range.startContainer,self._root,self);self._getRangeAndRemoveBookmark(range);node=range.endContainer;parent=node.parentNode;if(range.collapsed&&parent.nodeName==='A'&&!node.nextSibling&&range.endOffset===getLength(node)){range.setStartAfter(parent)}else if(!range.collapsed){deleteContentsOfRange(range,self._root);self._ensureBottomLine();self.setSelection(range);self._updatePath(range,true)}self.setSelection(range)},left:function(self){self._removeZWS()},right:function(self){self._removeZWS()}};if(isMac&&isGecko){keyHandlers['meta-left']=function(self,event){event.preventDefault();var sel=getWindowSelection(self);if(sel&&sel.modify){sel.modify('move','backward','lineboundary')}};keyHandlers['meta-right']=function(self,event){event.preventDefault();var sel=getWindowSelection(self);if(sel&&sel.modify){sel.modify('move','forward','lineboundary')}}}if(!isMac){keyHandlers.pageup=function(self){self.moveCursorToStart()};keyHandlers.pagedown=function(self){self.moveCursorToEnd()}}keyHandlers[ctrlKey+'b']=mapKeyToFormat('B');keyHandlers[ctrlKey+'i']=mapKeyToFormat('I');keyHandlers[ctrlKey+'u']=mapKeyToFormat('U');keyHandlers[ctrlKey+'shift-7']=mapKeyToFormat('S');keyHandlers[ctrlKey+'shift-5']=mapKeyToFormat('SUB',{tag:'SUP'});keyHandlers[ctrlKey+'shift-6']=mapKeyToFormat('SUP',{tag:'SUB'});keyHandlers[ctrlKey+'shift-8']=mapKeyTo('makeUnorderedList');keyHandlers[ctrlKey+'shift-9']=mapKeyTo('makeOrderedList');keyHandlers[ctrlKey+'[']=mapKeyTo('decreaseQuoteLevel');keyHandlers[ctrlKey+']']=mapKeyTo('increaseQuoteLevel');keyHandlers[ctrlKey+'y']=mapKeyTo('redo');keyHandlers[ctrlKey+'z']=mapKeyTo('undo');keyHandlers[ctrlKey+'shift-z']=mapKeyTo('redo');var fontSizes={1:10,2:13,3:16,4:18,5:24,6:32,7:48};var styleToSemantic={backgroundColor:{regexp:notWS,replace:function(doc,colour){return createElement(doc,'SPAN',{'class':HIGHLIGHT_CLASS,style:'background-color:'+colour})}},color:{regexp:notWS,replace:function(doc,colour){return createElement(doc,'SPAN',{'class':COLOUR_CLASS,style:'color:'+colour})}},fontWeight:{regexp:/^bold|^700/i,replace:function(doc){return createElement(doc,'B')}},fontStyle:{regexp:/^italic/i,replace:function(doc){return createElement(doc,'I')}},fontFamily:{regexp:notWS,replace:function(doc,family){return createElement(doc,'SPAN',{'class':FONT_FAMILY_CLASS,style:'font-family:'+family})}},fontSize:{regexp:notWS,replace:function(doc,size){return createElement(doc,'SPAN',{'class':FONT_SIZE_CLASS,style:'font-size:'+size})}},textDecoration:{regexp:/^underline/i,replace:function(doc){return createElement(doc,'U')}}};var replaceWithTag=function(tag){return function(node,parent){var el=createElement(node.ownerDocument,tag);parent.replaceChild(el,node);el.appendChild(empty(node));return el}};var replaceStyles=function(node,parent){var style=node.style;var doc=node.ownerDocument;var attr,converter,css,newTreeBottom,newTreeTop,el;for(attr in styleToSemantic){converter=styleToSemantic[attr];css=style[attr];if(css&&converter.regexp.test(css)){el=converter.replace(doc,css);if(!newTreeTop){newTreeTop=el}if(newTreeBottom){newTreeBottom.appendChild(el)}newTreeBottom=el;node.style[attr]=''}}if(newTreeTop){newTreeBottom.appendChild(empty(node));if(node.nodeName==='SPAN'){parent.replaceChild(newTreeTop,node)}else{node.appendChild(newTreeTop)}}return newTreeBottom||node};var stylesRewriters={P:replaceStyles,SPAN:replaceStyles,STRONG:replaceWithTag('B'),EM:replaceWithTag('I'),INS:replaceWithTag('U'),STRIKE:replaceWithTag('S'),FONT:function(node,parent){var face=node.face,size=node.size,colour=node.color,doc=node.ownerDocument,fontSpan,sizeSpan,colourSpan,newTreeBottom,newTreeTop;if(face){fontSpan=createElement(doc,'SPAN',{'class':FONT_FAMILY_CLASS,style:'font-family:'+face});newTreeTop=fontSpan;newTreeBottom=fontSpan}if(size){sizeSpan=createElement(doc,'SPAN',{'class':FONT_SIZE_CLASS,style:'font-size:'+fontSizes[size]+'px'});if(!newTreeTop){newTreeTop=sizeSpan}if(newTreeBottom){newTreeBottom.appendChild(sizeSpan)}newTreeBottom=sizeSpan}if(colour&&/^#?([\dA-F]{3}){1,2}$/i.test(colour)){if(colour.charAt(0)!=='#'){colour='#'+colour}colourSpan=createElement(doc,'SPAN',{'class':COLOUR_CLASS,style:'color:'+colour});if(!newTreeTop){newTreeTop=colourSpan}if(newTreeBottom){newTreeBottom.appendChild(colourSpan)}newTreeBottom=colourSpan}if(!newTreeTop){newTreeTop=newTreeBottom=createElement(doc,'SPAN')}parent.replaceChild(newTreeTop,node);newTreeBottom.appendChild(empty(node));return newTreeBottom},TT:function(node,parent){var el=createElement(node.ownerDocument,'SPAN',{'class':FONT_FAMILY_CLASS,style:'font-family:menlo,consolas,"courier new",monospace'});parent.replaceChild(el,node);el.appendChild(empty(node));return el}};var allowedBlock=/^(?:A(?:DDRESS|RTICLE|SIDE|UDIO)|BLOCKQUOTE|CAPTION|D(?:[DLT]|IV)|F(?:IGURE|IGCAPTION|OOTER)|H[1-6]|HEADER|L(?:ABEL|EGEND|I)|O(?:L|UTPUT)|P(?:RE)?|SECTION|T(?:ABLE|BODY|D|FOOT|H|HEAD|R)|COL(?:GROUP)?|UL)$/;var blacklist=/^(?:HEAD|META|STYLE)/;var walker=new TreeWalker(null,SHOW_TEXT|SHOW_ELEMENT,function(){return true});var cleanTree=function cleanTree(node,preserveWS){var children=node.childNodes,nonInlineParent,i,l,child,nodeName,nodeType,rewriter,childLength,startsWithWS,endsWithWS,data,sibling;nonInlineParent=node;while(isInline(nonInlineParent)){nonInlineParent=nonInlineParent.parentNode}walker.root=nonInlineParent;for(i=0,l=children.length;i<l;i+=1){child=children[i];nodeName=child.nodeName;nodeType=child.nodeType;rewriter=stylesRewriters[nodeName];if(nodeType===ELEMENT_NODE){childLength=child.childNodes.length;if(rewriter){child=rewriter(child,node)}else if(blacklist.test(nodeName)){node.removeChild(child);i-=1;l-=1;continue}else if(!allowedBlock.test(nodeName)&&!isInline(child)){i-=1;l+=childLength-1;node.replaceChild(empty(child),child);continue}if(childLength){cleanTree(child,preserveWS||nodeName==='PRE')}}else{if(nodeType===TEXT_NODE){data=child.data;startsWithWS=!notWS.test(data.charAt(0));endsWithWS=!notWS.test(data.charAt(data.length-1));if(preserveWS||!startsWithWS&&!endsWithWS){continue}if(startsWithWS){walker.currentNode=child;while(sibling=walker.previousPONode()){nodeName=sibling.nodeName;if(nodeName==='IMG'||nodeName==='#text'&&notWS.test(sibling.data)){break}if(!isInline(sibling)){sibling=null;break}}data=data.replace(/^[ \t\r\n]+/g,sibling?' ':'')}if(endsWithWS){walker.currentNode=child;while(sibling=walker.nextNode()){if(nodeName==='IMG'||nodeName==='#text'&&notWS.test(sibling.data)){break}if(!isInline(sibling)){sibling=null;break}}data=data.replace(/[ \t\r\n]+$/g,sibling?' ':'')}if(data){child.data=data;continue}}node.removeChild(child);i-=1;l-=1}}return node};var removeEmptyInlines=function removeEmptyInlines(node){var children=node.childNodes,l=children.length,child;while(l--){child=children[l];if(child.nodeType===ELEMENT_NODE&&!isLeaf(child)){removeEmptyInlines(child);if(isInline(child)&&!child.firstChild){node.removeChild(child)}}else if(child.nodeType===TEXT_NODE&&!child.data){node.removeChild(child)}}};var notWSTextNode=function(node){return node.nodeType===ELEMENT_NODE?node.nodeName==='BR':notWS.test(node.data)};var isLineBreak=function(br,isLBIfEmptyBlock){var block=br.parentNode;var walker;while(isInline(block)){block=block.parentNode}walker=new TreeWalker(block,SHOW_ELEMENT|SHOW_TEXT,notWSTextNode);walker.currentNode=br;return!!walker.nextNode()||isLBIfEmptyBlock&&!walker.previousNode()};var cleanupBRs=function(node,root,keepForBlankLine){var brs=node.querySelectorAll('BR');var brBreaksLine=[];var l=brs.length;var i,br,parent;for(i=0;i<l;i+=1){brBreaksLine[i]=isLineBreak(brs[i],keepForBlankLine)}while(l--){br=brs[l];parent=br.parentNode;if(!parent){continue}if(!brBreaksLine[l]){detach(br)}else if(!isInline(parent)){fixContainer(parent,root)}}};var setClipboardData=function(clipboardData,node,root){var body=node.ownerDocument.body;var html,text;cleanupBRs(node,root,true);node.setAttribute('style','position:fixed;overflow:hidden;bottom:100%;right:100%;');body.appendChild(node);html=node.innerHTML;text=node.innerText||node.textContent;if(isWin){text=text.replace(/\r?\n/g,'\r\n')}clipboardData.setData('text/html',html);clipboardData.setData('text/plain',text);body.removeChild(node)};var onCut=function(event){var clipboardData=event.clipboardData;var range=this.getSelection();var root=this._root;var self=this;var startBlock,endBlock,copyRoot,contents,parent,newContents,node;if(range.collapsed){event.preventDefault();return}this.saveUndoState(range);if(!isEdge&&!isIOS&&clipboardData){startBlock=getStartBlockOfRange(range,root);endBlock=getEndBlockOfRange(range,root);copyRoot=startBlock===endBlock&&startBlock||root;contents=deleteContentsOfRange(range,root);parent=range.commonAncestorContainer;if(parent.nodeType===TEXT_NODE){parent=parent.parentNode}while(parent&&parent!==copyRoot){newContents=parent.cloneNode(false);newContents.appendChild(contents);contents=newContents;parent=parent.parentNode}node=this.createElement('div');node.appendChild(contents);setClipboardData(clipboardData,node,root);event.preventDefault()}else{setTimeout(function(){try{self._ensureBottomLine()}catch(error){self.didError(error)}},0)}this.setSelection(range)};var onCopy=function(event){var clipboardData=event.clipboardData;var range=this.getSelection();var root=this._root;var startBlock,endBlock,copyRoot,contents,parent,newContents,node;if(!isEdge&&!isIOS&&clipboardData){startBlock=getStartBlockOfRange(range,root);endBlock=getEndBlockOfRange(range,root);copyRoot=startBlock===endBlock&&startBlock||root;range=range.cloneRange();moveRangeBoundariesDownTree(range);moveRangeBoundariesUpTree(range,copyRoot,copyRoot,root);contents=range.cloneContents();parent=range.commonAncestorContainer;if(parent.nodeType===TEXT_NODE){parent=parent.parentNode}while(parent&&parent!==copyRoot){newContents=parent.cloneNode(false);newContents.appendChild(contents);contents=newContents;parent=parent.parentNode}node=this.createElement('div');node.appendChild(contents);setClipboardData(clipboardData,node,root);event.preventDefault()}};function monitorShiftKey(event){this.isShiftDown=event.shiftKey}var onPaste=function(event){var clipboardData=event.clipboardData;var items=clipboardData&&clipboardData.items;var choosePlain=this.isShiftDown;var fireDrop=false;var hasImage=false;var plainItem=null;var self=this;var l,item,type,types,data;if(!isEdge&&items){event.preventDefault();l=items.length;while(l--){item=items[l];type=item.type;if(!choosePlain&&type==='text/html'){item.getAsString(function(html){self.insertHTML(html,true)});return}if(type==='text/plain'){plainItem=item}if(!choosePlain&&/^image\/.*/.test(type)){hasImage=true}}if(hasImage){this.fireEvent('dragover',{dataTransfer:clipboardData,preventDefault:function(){fireDrop=true}});if(fireDrop){this.fireEvent('drop',{dataTransfer:clipboardData})}}else if(plainItem){plainItem.getAsString(function(text){self.insertPlainText(text,true)})}return}types=clipboardData&&clipboardData.types;if(!isEdge&&types&&(indexOf.call(types,'text/html')>-1||!isGecko&&indexOf.call(types,'text/plain')>-1&&indexOf.call(types,'text/rtf')<0)){event.preventDefault();if(!choosePlain&&(data=clipboardData.getData('text/html'))){this.insertHTML(data,true)}else if((data=clipboardData.getData('text/plain'))||(data=clipboardData.getData('text/uri-list'))){this.insertPlainText(data,true)}return}this._awaitingPaste=true;var body=this._doc.body,range=this.getSelection(),startContainer=range.startContainer,startOffset=range.startOffset,endContainer=range.endContainer,endOffset=range.endOffset;var pasteArea=this.createElement('DIV',{contenteditable:'true',style:'position:fixed; overflow:hidden; top:0; right:100%; width:1px; height:1px;'});body.appendChild(pasteArea);range.selectNodeContents(pasteArea);this.setSelection(range);setTimeout(function(){try{self._awaitingPaste=false;var html='',next=pasteArea,first,range;while(pasteArea=next){next=pasteArea.nextSibling;detach(pasteArea);first=pasteArea.firstChild;if(first&&first===pasteArea.lastChild&&first.nodeName==='DIV'){pasteArea=first}html+=pasteArea.innerHTML}range=self._createRange(startContainer,startOffset,endContainer,endOffset);self.setSelection(range);if(html){self.insertHTML(html,true)}}catch(error){self.didError(error)}},0)};var onDrop=function(event){var types=event.dataTransfer.types;var l=types.length;var hasPlain=false;var hasHTML=false;while(l--){switch(types[l]){case'text/plain':hasPlain=true;break;case'text/html':hasHTML=true;break;default:return}}if(hasHTML||hasPlain){this.saveUndoState()}};function mergeObjects(base,extras,mayOverride){var prop,value;if(!base){base={}}if(extras){for(prop in extras){if(mayOverride||!(prop in base)){value=extras[prop];base[prop]=value&&value.constructor===Object?mergeObjects(base[prop],value,mayOverride):value}}}return base}function Squire(root,config){if(root.nodeType===DOCUMENT_NODE){root=root.body}var doc=root.ownerDocument;var win=doc.defaultView;var mutation;this._win=win;this._doc=doc;this._root=root;this._events={};this._isFocused=false;this._lastSelection=null;if(losesSelectionOnBlur){this.addEventListener('beforedeactivate',this.getSelection)}this._hasZWS=false;this._lastAnchorNode=null;this._lastFocusNode=null;this._path='';this._willUpdatePath=false;if('onselectionchange'in doc){this.addEventListener('selectionchange',this._updatePathOnEvent)}else{this.addEventListener('keyup',this._updatePathOnEvent);this.addEventListener('mouseup',this._updatePathOnEvent)}this._undoIndex=-1;this._undoStack=[];this._undoStackLength=0;this._isInUndoState=false;this._ignoreChange=false;this._ignoreAllChanges=false;if(canObserveMutations){mutation=new MutationObserver(this._docWasChanged.bind(this));mutation.observe(root,{childList:true,attributes:true,characterData:true,subtree:true});this._mutation=mutation}else{this.addEventListener('keyup',this._keyUpDetectChange)}this._restoreSelection=false;this.addEventListener('blur',enableRestoreSelection);this.addEventListener('mousedown',disableRestoreSelection);this.addEventListener('touchstart',disableRestoreSelection);this.addEventListener('focus',restoreSelection);this._awaitingPaste=false;this.addEventListener(isIElt11?'beforecut':'cut',onCut);this.addEventListener('copy',onCopy);this.addEventListener('keydown',monitorShiftKey);this.addEventListener('keyup',monitorShiftKey);this.addEventListener(isIElt11?'beforepaste':'paste',onPaste);this.addEventListener('drop',onDrop);this.addEventListener(isPresto?'keypress':'keydown',onKey);this._keyHandlers=Object.create(keyHandlers);this.setConfig(config);if(isIElt11){win.Text.prototype.splitText=function(offset){var afterSplit=this.ownerDocument.createTextNode(this.data.slice(offset)),next=this.nextSibling,parent=this.parentNode,toDelete=this.length-offset;if(next){parent.insertBefore(afterSplit,next)}else{parent.appendChild(afterSplit)}if(toDelete){this.deleteData(offset,toDelete)}return afterSplit}}root.setAttribute('contenteditable','true');try{doc.execCommand('enableObjectResizing',false,'false');doc.execCommand('enableInlineTableEditing',false,'false')}catch(error){}root.__squire__=this;this.setHTML('')}var proto=Squire.prototype;var sanitizeToDOMFragment=function(html,isPaste,self){var doc=self._doc;var frag=html?DOMPurify.sanitize(html,{ALLOW_UNKNOWN_PROTOCOLS:true,WHOLE_DOCUMENT:false,RETURN_DOM:true,RETURN_DOM_FRAGMENT:true}):null;return frag?doc.importNode(frag,true):doc.createDocumentFragment()};proto.setConfig=function(config){config=mergeObjects({blockTag:'DIV',blockAttributes:null,tagAttributes:{blockquote:null,ul:null,ol:null,li:null,a:null},leafNodeNames:leafNodeNames,undo:{documentSizeThreshold:-1,undoLimit:-1},isInsertedHTMLSanitized:true,isSetHTMLSanitized:true,sanitizeToDOMFragment:typeof DOMPurify!=='undefined'&&DOMPurify.isSupported?sanitizeToDOMFragment:null},config,true);config.blockTag=config.blockTag.toUpperCase();this._config=config;return this};proto.createElement=function(tag,props,children){return createElement(this._doc,tag,props,children)};proto.createDefaultBlock=function(children){var config=this._config;return fixCursor(this.createElement(config.blockTag,config.blockAttributes,children),this._root)};proto.didError=function(error){;};proto.getDocument=function(){return this._doc};proto.getRoot=function(){return this._root};proto.modifyDocument=function(modificationCallback){var mutation=this._mutation;if(mutation){if(mutation.takeRecords().length){this._docWasChanged()}mutation.disconnect()}this._ignoreAllChanges=true;modificationCallback();this._ignoreAllChanges=false;if(mutation){mutation.observe(this._root,{childList:true,attributes:true,characterData:true,subtree:true});this._ignoreChange=false}};var customEvents={pathChange:1,select:1,input:1,undoStateChange:1};proto.fireEvent=function(type,event){var handlers=this._events[type];var isFocused,l,obj;if(/^(?:focus|blur)/.test(type)){isFocused=this._root===this._doc.activeElement;if(type==='focus'){if(!isFocused||this._isFocused){return this}this._isFocused=true}else{if(isFocused||!this._isFocused){return this}this._isFocused=false}}if(handlers){if(!event){event={}}if(event.type!==type){event.type=type}handlers=handlers.slice();l=handlers.length;while(l--){obj=handlers[l];try{if(obj.handleEvent){obj.handleEvent(event)}else{obj.call(this,event)}}catch(error){error.details='Squire: fireEvent error. Event type: '+type;this.didError(error)}}}return this};proto.destroy=function(){var events=this._events;var type;for(type in events){this.removeEventListener(type)}if(this._mutation){this._mutation.disconnect()}delete this._root.__squire__;this._undoIndex=-1;this._undoStack=[];this._undoStackLength=0};proto.handleEvent=function(event){this.fireEvent(event.type,event)};proto.addEventListener=function(type,fn){var handlers=this._events[type];var target=this._root;if(!fn){this.didError({name:'Squire: addEventListener with null or undefined fn',message:'Event type: '+type});return this}if(!handlers){handlers=this._events[type]=[];if(!customEvents[type]){if(type==='selectionchange'){target=this._doc}target.addEventListener(type,this,true)}}handlers.push(fn);return this};proto.removeEventListener=function(type,fn){var handlers=this._events[type];var target=this._root;var l;if(handlers){if(fn){l=handlers.length;while(l--){if(handlers[l]===fn){handlers.splice(l,1)}}}else{handlers.length=0}if(!handlers.length){delete this._events[type];if(!customEvents[type]){if(type==='selectionchange'){target=this._doc}target.removeEventListener(type,this,true)}}}return this};proto._createRange=function(range,startOffset,endContainer,endOffset){if(range instanceof this._win.Range){return range.cloneRange()}var domRange=this._doc.createRange();domRange.setStart(range,startOffset);if(endContainer){domRange.setEnd(endContainer,endOffset)}else{domRange.setEnd(range,startOffset)}return domRange};proto.getCursorPosition=function(range){if(!range&&!(range=this.getSelection())||!range.getBoundingClientRect){return null}var rect=range.getBoundingClientRect();var node,parent;if(rect&&!rect.top){this._ignoreChange=true;node=this._doc.createElement('SPAN');node.textContent=ZWS;insertNodeInRange(range,node);rect=node.getBoundingClientRect();parent=node.parentNode;parent.removeChild(node);mergeInlines(parent,range)}return rect};proto._moveCursorTo=function(toStart){var root=this._root,range=this._createRange(root,toStart?0:root.childNodes.length);moveRangeBoundariesDownTree(range);this.setSelection(range);return this};proto.moveCursorToStart=function(){return this._moveCursorTo(true)};proto.moveCursorToEnd=function(){return this._moveCursorTo(false)};var getWindowSelection=function(self){return self._win.getSelection()||null};proto.setSelection=function(range){if(range){this._lastSelection=range;if(!this._isFocused){enableRestoreSelection.call(this)}else if(isAndroid&&!this._restoreSelection){enableRestoreSelection.call(this);this.blur();this.focus()}else{if(isIOS){this._win.focus()}var sel=getWindowSelection(this);if(sel){sel.removeAllRanges();sel.addRange(range)}}}return this};proto.getSelection=function(){var sel=getWindowSelection(this);var root=this._root;var selection,startContainer,endContainer,node;if(this._isFocused&&sel&&sel.rangeCount){selection=sel.getRangeAt(0).cloneRange();startContainer=selection.startContainer;endContainer=selection.endContainer;if(startContainer&&isLeaf(startContainer)){selection.setStartBefore(startContainer)}if(endContainer&&isLeaf(endContainer)){selection.setEndBefore(endContainer)}}if(selection&&isOrContains(root,selection.commonAncestorContainer)){this._lastSelection=selection}else{selection=this._lastSelection;node=selection.commonAncestorContainer;if(!isOrContains(node.ownerDocument,node)){selection=null}}if(!selection){selection=this._createRange(root.firstChild,0)}return selection};function enableRestoreSelection(){this._restoreSelection=true}function disableRestoreSelection(){this._restoreSelection=false}function restoreSelection(){if(this._restoreSelection){this.setSelection(this._lastSelection)}}proto.getSelectedText=function(){var range=this.getSelection();if(!range||range.collapsed){return''}var walker=new TreeWalker(range.commonAncestorContainer,SHOW_TEXT|SHOW_ELEMENT,function(node){return isNodeContainedInRange(range,node,true)});var startContainer=range.startContainer;var endContainer=range.endContainer;var node=walker.currentNode=startContainer;var textContent='';var addedTextInBlock=false;var value;if(!walker.filter(node)){node=walker.nextNode()}while(node){if(node.nodeType===TEXT_NODE){value=node.data;if(value&&/\S/.test(value)){if(node===endContainer){value=value.slice(0,range.endOffset)}if(node===startContainer){value=value.slice(range.startOffset)}textContent+=value;addedTextInBlock=true}}else if(node.nodeName==='BR'||addedTextInBlock&&!isInline(node)){textContent+='\n';addedTextInBlock=false}node=walker.nextNode()}return textContent};proto.getPath=function(){return this._path};var removeZWS=function(root,keepNode){var walker=new TreeWalker(root,SHOW_TEXT,function(){return true},false),parent,node,index;while(node=walker.nextNode()){while((index=node.data.indexOf(ZWS))>-1&&(!keepNode||node.parentNode!==keepNode)){if(node.length===1){do{parent=node.parentNode;parent.removeChild(node);node=parent;walker.currentNode=parent}while(isInline(node)&&!getLength(node));break}else{node.deleteData(index,1)}}}};proto._didAddZWS=function(){this._hasZWS=true};proto._removeZWS=function(){if(!this._hasZWS){return}removeZWS(this._root);this._hasZWS=false};proto._updatePath=function(range,force){if(!range){return}var anchor=range.startContainer,focus=range.endContainer,newPath;if(force||anchor!==this._lastAnchorNode||focus!==this._lastFocusNode){this._lastAnchorNode=anchor;this._lastFocusNode=focus;newPath=anchor&&focus?anchor===focus?getPath(focus,this._root):'(selection)':'';if(this._path!==newPath){this._path=newPath;this.fireEvent('pathChange',{path:newPath})}}this.fireEvent(range.collapsed?'cursor':'select',{range:range})};proto._updatePathOnEvent=function(event){var self=this;if(self._isFocused&&!self._willUpdatePath){self._willUpdatePath=true;setTimeout(function(){self._willUpdatePath=false;self._updatePath(self.getSelection())},0)}};proto.focus=function(){this._root.focus();if(isIE){this.fireEvent('focus')}return this};proto.blur=function(){this._root.blur();if(isIE){this.fireEvent('blur')}return this};var startSelectionId='squire-selection-start';var endSelectionId='squire-selection-end';proto._saveRangeToBookmark=function(range){var startNode=this.createElement('INPUT',{id:startSelectionId,type:'hidden'}),endNode=this.createElement('INPUT',{id:endSelectionId,type:'hidden'}),temp;insertNodeInRange(range,startNode);range.collapse(false);insertNodeInRange(range,endNode);if(startNode.compareDocumentPosition(endNode)&DOCUMENT_POSITION_PRECEDING){startNode.id=endSelectionId;endNode.id=startSelectionId;temp=startNode;startNode=endNode;endNode=temp}range.setStartAfter(startNode);range.setEndBefore(endNode)};proto._getRangeAndRemoveBookmark=function(range){var root=this._root,start=root.querySelector('#'+startSelectionId),end=root.querySelector('#'+endSelectionId);if(start&&end){var startContainer=start.parentNode,endContainer=end.parentNode,startOffset=indexOf.call(startContainer.childNodes,start),endOffset=indexOf.call(endContainer.childNodes,end);if(startContainer===endContainer){endOffset-=1}detach(start);detach(end);if(!range){range=this._doc.createRange()}range.setStart(startContainer,startOffset);range.setEnd(endContainer,endOffset);mergeInlines(startContainer,range);if(startContainer!==endContainer){mergeInlines(endContainer,range)}if(range.collapsed){startContainer=range.startContainer;if(startContainer.nodeType===TEXT_NODE){endContainer=startContainer.childNodes[range.startOffset];if(!endContainer||endContainer.nodeType!==TEXT_NODE){endContainer=startContainer.childNodes[range.startOffset-1]}if(endContainer&&endContainer.nodeType===TEXT_NODE){range.setStart(endContainer,0);range.collapse(true)}}}}return range||null};proto._keyUpDetectChange=function(event){var code=event.keyCode;if(!event.ctrlKey&&!event.metaKey&&!event.altKey&&(code<16||code>20)&&(code<33||code>45)){this._docWasChanged()}};proto._docWasChanged=function(){if(canWeakMap){nodeCategoryCache=new WeakMap}if(this._ignoreAllChanges){return}if(canObserveMutations&&this._ignoreChange){this._ignoreChange=false;return}if(this._isInUndoState){this._isInUndoState=false;this.fireEvent('undoStateChange',{canUndo:true,canRedo:false})}this.fireEvent('input')};proto._recordUndoState=function(range,replace){if(!this._isInUndoState||replace){var undoIndex=this._undoIndex;var undoStack=this._undoStack;var undoConfig=this._config.undo;var undoThreshold=undoConfig.documentSizeThreshold;var undoLimit=undoConfig.undoLimit;var html;if(!replace){undoIndex+=1}if(undoIndex<this._undoStackLength){undoStack.length=this._undoStackLength=undoIndex}if(range){this._saveRangeToBookmark(range)}html=this._getHTML();if(undoThreshold>-1&&html.length*2>undoThreshold){if(undoLimit>-1&&undoIndex>undoLimit){undoStack.splice(0,undoIndex-undoLimit);undoIndex=undoLimit;this._undoStackLength=undoLimit}}undoStack[undoIndex]=html;this._undoIndex=undoIndex;this._undoStackLength+=1;this._isInUndoState=true}};proto.saveUndoState=function(range){if(range===undefined){range=this.getSelection()}this._recordUndoState(range,this._isInUndoState);this._getRangeAndRemoveBookmark(range);return this};proto.undo=function(){if(this._undoIndex!==0||!this._isInUndoState){this._recordUndoState(this.getSelection(),false);this._undoIndex-=1;this._setHTML(this._undoStack[this._undoIndex]);var range=this._getRangeAndRemoveBookmark();if(range){this.setSelection(range)}this._isInUndoState=true;this.fireEvent('undoStateChange',{canUndo:this._undoIndex!==0,canRedo:true});this.fireEvent('input')}return this};proto.redo=function(){var undoIndex=this._undoIndex,undoStackLength=this._undoStackLength;if(undoIndex+1<undoStackLength&&this._isInUndoState){this._undoIndex+=1;this._setHTML(this._undoStack[this._undoIndex]);var range=this._getRangeAndRemoveBookmark();if(range){this.setSelection(range)}this.fireEvent('undoStateChange',{canUndo:true,canRedo:undoIndex+2<undoStackLength});this.fireEvent('input')}return this};proto.hasFormat=function(tag,attributes,range){tag=tag.toUpperCase();if(!attributes){attributes={}}if(!range&&!(range=this.getSelection())){return false}if(!range.collapsed&&range.startContainer.nodeType===TEXT_NODE&&range.startOffset===range.startContainer.length&&range.startContainer.nextSibling){range.setStartBefore(range.startContainer.nextSibling)}if(!range.collapsed&&range.endContainer.nodeType===TEXT_NODE&&range.endOffset===0&&range.endContainer.previousSibling){range.setEndAfter(range.endContainer.previousSibling)}var root=this._root;var common=range.commonAncestorContainer;var walker,node;if(getNearest(common,root,tag,attributes)){return true}if(common.nodeType===TEXT_NODE){return false}walker=new TreeWalker(common,SHOW_TEXT,function(node){return isNodeContainedInRange(range,node,true)},false);var seenNode=false;while(node=walker.nextNode()){if(!getNearest(node,root,tag,attributes)){return false}seenNode=true}return seenNode};proto.getFontInfo=function(range){var fontInfo={color:undefined,backgroundColor:undefined,family:undefined,size:undefined};var seenAttributes=0;var element,style,attr;if(!range&&!(range=this.getSelection())){return fontInfo}element=range.commonAncestorContainer;if(range.collapsed||element.nodeType===TEXT_NODE){if(element.nodeType===TEXT_NODE){element=element.parentNode}while(seenAttributes<4&&element){if(style=element.style){if(!fontInfo.color&&(attr=style.color)){fontInfo.color=attr;seenAttributes+=1}if(!fontInfo.backgroundColor&&(attr=style.backgroundColor)){fontInfo.backgroundColor=attr;seenAttributes+=1}if(!fontInfo.family&&(attr=style.fontFamily)){fontInfo.family=attr;seenAttributes+=1}if(!fontInfo.size&&(attr=style.fontSize)){fontInfo.size=attr;seenAttributes+=1}}element=element.parentNode}}return fontInfo};proto._addFormat=function(tag,attributes,range){var root=this._root;var el,walker,startContainer,endContainer,startOffset,endOffset,node,needsFormat,block;if(range.collapsed){el=fixCursor(this.createElement(tag,attributes),root);insertNodeInRange(range,el);range.setStart(el.firstChild,el.firstChild.length);range.collapse(true);block=el;while(isInline(block)){block=block.parentNode}removeZWS(block,el)}else{walker=new TreeWalker(range.commonAncestorContainer,SHOW_TEXT|SHOW_ELEMENT,function(node){return(node.nodeType===TEXT_NODE||node.nodeName==='BR'||node.nodeName==='IMG')&&isNodeContainedInRange(range,node,true)},false);startContainer=range.startContainer;startOffset=range.startOffset;endContainer=range.endContainer;endOffset=range.endOffset;walker.currentNode=startContainer;if(!walker.filter(startContainer)){startContainer=walker.nextNode();startOffset=0}if(!startContainer){return range}do{node=walker.currentNode;needsFormat=!getNearest(node,root,tag,attributes);if(needsFormat){if(node===endContainer&&node.length>endOffset){node.splitText(endOffset)}if(node===startContainer&&startOffset){node=node.splitText(startOffset);if(endContainer===startContainer){endContainer=node;endOffset-=startOffset}startContainer=node;startOffset=0}el=this.createElement(tag,attributes);replaceWith(node,el);el.appendChild(node)}}while(walker.nextNode());if(endContainer.nodeType!==TEXT_NODE){if(node.nodeType===TEXT_NODE){endContainer=node;endOffset=node.length}else{endContainer=node.parentNode;endOffset=1}}range=this._createRange(startContainer,startOffset,endContainer,endOffset)}return range};proto._removeFormat=function(tag,attributes,range,partial){this._saveRangeToBookmark(range);var doc=this._doc,fixer;if(range.collapsed){if(cantFocusEmptyTextNodes){fixer=doc.createTextNode(ZWS);this._didAddZWS()}else{fixer=doc.createTextNode('')}insertNodeInRange(range,fixer)}var root=range.commonAncestorContainer;while(isInline(root)){root=root.parentNode}var startContainer=range.startContainer,startOffset=range.startOffset,endContainer=range.endContainer,endOffset=range.endOffset,toWrap=[],examineNode=function(node,exemplar){if(isNodeContainedInRange(range,node,false)){return}var isText=node.nodeType===TEXT_NODE,child,next;if(!isNodeContainedInRange(range,node,true)){if(node.nodeName!=='INPUT'&&(!isText||node.data)){toWrap.push([exemplar,node])}return}if(isText){if(node===endContainer&&endOffset!==node.length){toWrap.push([exemplar,node.splitText(endOffset)])}if(node===startContainer&&startOffset){node.splitText(startOffset);toWrap.push([exemplar,node])}}else{for(child=node.firstChild;child;child=next){next=child.nextSibling;examineNode(child,exemplar)}}},formatTags=Array.prototype.filter.call(root.getElementsByTagName(tag),function(el){return isNodeContainedInRange(range,el,true)&&hasTagAttributes(el,tag,attributes)});if(!partial){formatTags.forEach(function(node){examineNode(node,node)})}toWrap.forEach(function(item){var el=item[0].cloneNode(false),node=item[1];replaceWith(node,el);el.appendChild(node)});formatTags.forEach(function(el){replaceWith(el,empty(el))});this._getRangeAndRemoveBookmark(range);if(fixer){range.collapse(false)}mergeInlines(root,range);return range};proto.changeFormat=function(add,remove,range,partial){if(!range&&!(range=this.getSelection())){return this}this.saveUndoState(range);if(remove){range=this._removeFormat(remove.tag.toUpperCase(),remove.attributes||{},range,partial)}if(add){range=this._addFormat(add.tag.toUpperCase(),add.attributes||{},range)}this.setSelection(range);this._updatePath(range,true);if(!canObserveMutations){this._docWasChanged()}return this};var tagAfterSplit={DT:'DD',DD:'DT',LI:'LI',PRE:'PRE'};var splitBlock=function(self,block,node,offset){var splitTag=tagAfterSplit[block.nodeName],splitProperties=null,nodeAfterSplit=split(node,offset,block.parentNode,self._root),config=self._config;if(!splitTag){splitTag=config.blockTag;splitProperties=config.blockAttributes}if(!hasTagAttributes(nodeAfterSplit,splitTag,splitProperties)){block=createElement(nodeAfterSplit.ownerDocument,splitTag,splitProperties);if(nodeAfterSplit.dir){block.dir=nodeAfterSplit.dir}replaceWith(nodeAfterSplit,block);block.appendChild(empty(nodeAfterSplit));nodeAfterSplit=block}return nodeAfterSplit};proto.forEachBlock=function(fn,mutates,range){if(!range&&!(range=this.getSelection())){return this}if(mutates){this.saveUndoState(range)}var root=this._root;var start=getStartBlockOfRange(range,root);var end=getEndBlockOfRange(range,root);if(start&&end){do{if(fn(start)||start===end){break}}while(start=getNextBlock(start,root))}if(mutates){this.setSelection(range);this._updatePath(range,true);if(!canObserveMutations){this._docWasChanged()}}return this};proto.modifyBlocks=function(modify,range){if(!range&&!(range=this.getSelection())){return this}this._recordUndoState(range,this._isInUndoState);var root=this._root;var frag;expandRangeToBlockBoundaries(range,root);moveRangeBoundariesUpTree(range,root,root,root);frag=extractContentsOfRange(range,root,root);insertNodeInRange(range,modify.call(this,frag));if(range.endOffset<range.endContainer.childNodes.length){mergeContainers(range.endContainer.childNodes[range.endOffset],root)}mergeContainers(range.startContainer.childNodes[range.startOffset],root);this._getRangeAndRemoveBookmark(range);this.setSelection(range);this._updatePath(range,true);if(!canObserveMutations){this._docWasChanged()}return this};var increaseBlockQuoteLevel=function(frag){return this.createElement('BLOCKQUOTE',this._config.tagAttributes.blockquote,[frag])};var decreaseBlockQuoteLevel=function(frag){var root=this._root;var blockquotes=frag.querySelectorAll('blockquote');Array.prototype.filter.call(blockquotes,function(el){return!getNearest(el.parentNode,root,'BLOCKQUOTE')}).forEach(function(el){replaceWith(el,empty(el))});return frag};var removeBlockQuote=function(){return this.createDefaultBlock([this.createElement('INPUT',{id:startSelectionId,type:'hidden'}),this.createElement('INPUT',{id:endSelectionId,type:'hidden'})])};var makeList=function(self,frag,type){var walker=getBlockWalker(frag,self._root),node,tag,prev,newLi,tagAttributes=self._config.tagAttributes,listAttrs=tagAttributes[type.toLowerCase()],listItemAttrs=tagAttributes.li;while(node=walker.nextNode()){if(node.parentNode.nodeName==='LI'){node=node.parentNode;walker.currentNode=node.lastChild}if(node.nodeName!=='LI'){newLi=self.createElement('LI',listItemAttrs);if(node.dir){newLi.dir=node.dir}if((prev=node.previousSibling)&&prev.nodeName===type){prev.appendChild(newLi);detach(node)}else{replaceWith(node,self.createElement(type,listAttrs,[newLi]))}newLi.appendChild(empty(node));walker.currentNode=newLi}else{node=node.parentNode;tag=node.nodeName;if(tag!==type&&/^[OU]L$/.test(tag)){replaceWith(node,self.createElement(type,listAttrs,[empty(node)]))}}}};var makeUnorderedList=function(frag){makeList(this,frag,'UL');return frag};var makeOrderedList=function(frag){makeList(this,frag,'OL');return frag};var removeList=function(frag){var lists=frag.querySelectorAll('UL, OL'),items=frag.querySelectorAll('LI'),root=this._root,i,l,list,listFrag,item;for(i=0,l=lists.length;i<l;i+=1){list=lists[i];listFrag=empty(list);fixContainer(listFrag,root);replaceWith(list,listFrag)}for(i=0,l=items.length;i<l;i+=1){item=items[i];if(isBlock(item)){replaceWith(item,this.createDefaultBlock([empty(item)]))}else{fixContainer(item,root);replaceWith(item,empty(item))}}return frag};var getListSelection=function(range,root){var list=range.commonAncestorContainer;var startLi=range.startContainer;var endLi=range.endContainer;while(list&&list!==root&&!/^[OU]L$/.test(list.nodeName)){list=list.parentNode}if(!list||list===root){return null}if(startLi===list){startLi=startLi.childNodes[range.startOffset]}if(endLi===list){endLi=endLi.childNodes[range.endOffset]}while(startLi&&startLi.parentNode!==list){startLi=startLi.parentNode}while(endLi&&endLi.parentNode!==list){endLi=endLi.parentNode}return[list,startLi,endLi]};proto.increaseListLevel=function(range){if(!range&&!(range=this.getSelection())){return this.focus()}var root=this._root;var listSelection=getListSelection(range,root);if(!listSelection){return this.focus()}var list=listSelection[0];var startLi=listSelection[1];var endLi=listSelection[2];if(!startLi||startLi===list.firstChild){return this.focus()}this._recordUndoState(range,this._isInUndoState);var type=list.nodeName;var newParent=startLi.previousSibling;var listAttrs,next;if(newParent.nodeName!==type){listAttrs=this._config.tagAttributes[type.toLowerCase()];newParent=this.createElement(type,listAttrs);list.insertBefore(newParent,startLi)}do{next=startLi===endLi?null:startLi.nextSibling;newParent.appendChild(startLi)}while(startLi=next);next=newParent.nextSibling;if(next){mergeContainers(next,root)}this._getRangeAndRemoveBookmark(range);this.setSelection(range);this._updatePath(range,true);if(!canObserveMutations){this._docWasChanged()}return this.focus()};proto.decreaseListLevel=function(range){if(!range&&!(range=this.getSelection())){return this.focus()}var root=this._root;var listSelection=getListSelection(range,root);if(!listSelection){return this.focus()}var list=listSelection[0];var startLi=listSelection[1];var endLi=listSelection[2];if(!startLi){startLi=list.firstChild}if(!endLi){endLi=list.lastChild}this._recordUndoState(range,this._isInUndoState);var newParent=list.parentNode;var next;var insertBefore=!endLi.nextSibling?list.nextSibling:split(list,endLi.nextSibling,newParent,root);if(newParent!==root&&newParent.nodeName==='LI'){newParent=newParent.parentNode;while(insertBefore){next=insertBefore.nextSibling;endLi.appendChild(insertBefore);insertBefore=next}insertBefore=list.parentNode.nextSibling}var makeNotList=!/^[OU]L$/.test(newParent.nodeName);do{next=startLi===endLi?null:startLi.nextSibling;list.removeChild(startLi);if(makeNotList&&startLi.nodeName==='LI'){startLi=this.createDefaultBlock([empty(startLi)])}newParent.insertBefore(startLi,insertBefore)}while(startLi=next);if(!list.firstChild){detach(list)}if(insertBefore){mergeContainers(insertBefore,root)}this._getRangeAndRemoveBookmark(range);this.setSelection(range);this._updatePath(range,true);if(!canObserveMutations){this._docWasChanged()}return this.focus()};proto._ensureBottomLine=function(){var root=this._root;var last=root.lastElementChild;if(!last||last.nodeName!==this._config.blockTag||!isBlock(last)){root.appendChild(this.createDefaultBlock())}};proto.setKeyHandler=function(key,fn){this._keyHandlers[key]=fn;return this};proto._getHTML=function(){return this._root.innerHTML};proto._setHTML=function(html){var root=this._root;var node=root;node.innerHTML=html;do{fixCursor(node,root)}while(node=getNextBlock(node,root));this._ignoreChange=true};proto.getHTML=function(withBookMark){var brs=[],root,node,fixer,html,l,range;if(withBookMark&&(range=this.getSelection())){this._saveRangeToBookmark(range)}if(useTextFixer){root=this._root;node=root;while(node=getNextBlock(node,root)){if(!node.textContent&&!node.querySelector('BR')){fixer=this.createElement('BR');node.appendChild(fixer);brs.push(fixer)}}}html=this._getHTML().replace(/\u200B/g,'');if(useTextFixer){l=brs.length;while(l--){detach(brs[l])}}if(range){this._getRangeAndRemoveBookmark(range)}return html};proto.setHTML=function(html){var config=this._config;var sanitizeToDOMFragment=config.isSetHTMLSanitized?config.sanitizeToDOMFragment:null;var root=this._root;var div,frag,child;if(typeof sanitizeToDOMFragment==='function'){frag=sanitizeToDOMFragment(html,false,this)}else{div=this.createElement('DIV');div.innerHTML=html;frag=this._doc.createDocumentFragment();frag.appendChild(empty(div))}cleanTree(frag);cleanupBRs(frag,root,false);fixContainer(frag,root);var node=frag;while(node=getNextBlock(node,root)){fixCursor(node,root)}this._ignoreChange=true;while(child=root.lastChild){root.removeChild(child)}root.appendChild(frag);fixCursor(root,root);this._undoIndex=-1;this._undoStack.length=0;this._undoStackLength=0;this._isInUndoState=false;var range=this._getRangeAndRemoveBookmark()||this._createRange(root.firstChild,0);this.saveUndoState(range);this._lastSelection=range;enableRestoreSelection.call(this);this._updatePath(range,true);return this};proto.insertElement=function(el,range){if(!range){range=this.getSelection()}range.collapse(true);if(isInline(el)){insertNodeInRange(range,el);range.setStartAfter(el)}else{var root=this._root;var splitNode=getStartBlockOfRange(range,root)||root;var parent,nodeAfterSplit;while(splitNode!==root&&!splitNode.nextSibling){splitNode=splitNode.parentNode}if(splitNode!==root){parent=splitNode.parentNode;nodeAfterSplit=split(parent,splitNode.nextSibling,root,root)}if(nodeAfterSplit){root.insertBefore(el,nodeAfterSplit)}else{root.appendChild(el);nodeAfterSplit=this.createDefaultBlock();root.appendChild(nodeAfterSplit)}range.setStart(nodeAfterSplit,0);range.setEnd(nodeAfterSplit,0);moveRangeBoundariesDownTree(range)}this.focus();this.setSelection(range);this._updatePath(range);if(!canObserveMutations){this._docWasChanged()}return this};proto.insertImage=function(src,attributes){var img=this.createElement('IMG',mergeObjects({src:src},attributes,true));this.insertElement(img);return img};var linkRegExp=/\b((?:(?:ht|f)tps?:\/\/|www\d{0,3}[.]|[a-z0-9.\-]+[.][a-z]{2,}\/)(?:[^\s()<>]+|\([^\s()<>]+\))+(?:\((?:[^\s()<>]+|(?:\([^\s()<>]+\)))*\)|[^\s`!()\[\]{};:'".,<>?«»“”‘’]))|([\w\-.%+]+@(?:[\w\-]+\.)+[A-Z]{2,}\b)/i;var addLinks=function(frag,root,self){var doc=frag.ownerDocument,walker=new TreeWalker(frag,SHOW_TEXT,function(node){return!getNearest(node,root,'A')},false),defaultAttributes=self._config.tagAttributes.a,node,data,parent,match,index,endIndex,child;while(node=walker.nextNode()){data=node.data;parent=node.parentNode;while(match=linkRegExp.exec(data)){index=match.index;endIndex=index+match[0].length;if(index){child=doc.createTextNode(data.slice(0,index));parent.insertBefore(child,node)}child=self.createElement('A',mergeObjects({href:match[1]?/^(?:ht|f)tps?:/.test(match[1])?match[1]:'http://'+match[1]:'mailto:'+match[2]},defaultAttributes,false));child.textContent=data.slice(index,endIndex);parent.insertBefore(child,node);node.data=data=data.slice(endIndex)}}};proto.insertHTML=function(html,isPaste){var config=this._config;var sanitizeToDOMFragment=config.isInsertedHTMLSanitized?config.sanitizeToDOMFragment:null;var range=this.getSelection();var doc=this._doc;var startFragmentIndex,endFragmentIndex;var div,frag,root,node,event;if(typeof sanitizeToDOMFragment==='function'){frag=sanitizeToDOMFragment(html,isPaste,this)}else{if(isPaste){startFragmentIndex=html.indexOf('<!--StartFragment-->');endFragmentIndex=html.lastIndexOf('<!--EndFragment-->');if(startFragmentIndex>-1&&endFragmentIndex>-1){html=html.slice(startFragmentIndex+20,endFragmentIndex)}}if(/<\/td>((?!<\/tr>)[\s\S])*$/i.test(html)){html='<TR>'+html+'</TR>'}if(/<\/tr>((?!<\/table>)[\s\S])*$/i.test(html)){html='<TABLE>'+html+'</TABLE>'}div=this.createElement('DIV');div.innerHTML=html;frag=doc.createDocumentFragment();frag.appendChild(empty(div))}this.saveUndoState(range);try{root=this._root;node=frag;event={fragment:frag,preventDefault:function(){this.defaultPrevented=true},defaultPrevented:false};addLinks(frag,frag,this);cleanTree(frag);cleanupBRs(frag,root,false);removeEmptyInlines(frag);frag.normalize();while(node=getNextBlock(node,frag)){fixCursor(node,root)}if(isPaste){this.fireEvent('willPaste',event)}if(!event.defaultPrevented){insertTreeFragmentIntoRange(range,event.fragment,root);if(!canObserveMutations){this._docWasChanged()}range.collapse(false);this._ensureBottomLine()}this.setSelection(range);this._updatePath(range,true);if(isPaste){this.focus()}}catch(error){this.didError(error)}return this};var escapeHTMLFragement=function(text){return text.split('&').join('&amp;').split('<').join('&lt;').split('>').join('&gt;').split('"').join('&quot;')};proto.insertPlainText=function(plainText,isPaste){var lines=plainText.split('\n');var config=this._config;var tag=config.blockTag;var attributes=config.blockAttributes;var closeBlock='</'+tag+'>';var openBlock='<'+tag;var attr,i,l,line;for(attr in attributes){openBlock+=' '+attr+'="'+escapeHTMLFragement(attributes[attr])+'"'}openBlock+='>';for(i=0,l=lines.length;i<l;i+=1){line=lines[i];line=escapeHTMLFragement(line).replace(/ (?= )/g,'&nbsp;');lines[i]=openBlock+(line||'<BR>')+closeBlock}return this.insertHTML(lines.join(''),isPaste)};var command=function(method,arg,arg2){return function(){this[method](arg,arg2);return this.focus()}};proto.addStyles=function(styles){if(styles){var head=this._doc.documentElement.firstChild,style=this.createElement('STYLE',{type:'text/css'});style.appendChild(this._doc.createTextNode(styles));head.appendChild(style)}return this};proto.bold=command('changeFormat',{tag:'B'});proto.italic=command('changeFormat',{tag:'I'});proto.underline=command('changeFormat',{tag:'U'});proto.strikethrough=command('changeFormat',{tag:'S'});proto.subscript=command('changeFormat',{tag:'SUB'},{tag:'SUP'});proto.superscript=command('changeFormat',{tag:'SUP'},{tag:'SUB'});proto.removeBold=command('changeFormat',null,{tag:'B'});proto.removeItalic=command('changeFormat',null,{tag:'I'});proto.removeUnderline=command('changeFormat',null,{tag:'U'});proto.removeStrikethrough=command('changeFormat',null,{tag:'S'});proto.removeSubscript=command('changeFormat',null,{tag:'SUB'});proto.removeSuperscript=command('changeFormat',null,{tag:'SUP'});proto.makeLink=function(url,attributes){var range=this.getSelection();if(range.collapsed){var protocolEnd=url.indexOf(':')+1;if(protocolEnd){while(url[protocolEnd]==='/'){protocolEnd+=1}}insertNodeInRange(range,this._doc.createTextNode(url.slice(protocolEnd)))}attributes=mergeObjects(mergeObjects({href:url},attributes,true),this._config.tagAttributes.a,false);this.changeFormat({tag:'A',attributes:attributes},{tag:'A'},range);return this.focus()};proto.removeLink=function(){this.changeFormat(null,{tag:'A'},this.getSelection(),true);return this.focus()};proto.setFontFace=function(name){this.changeFormat(name?{tag:'SPAN',attributes:{'class':FONT_FAMILY_CLASS,style:'font-family: '+name+', sans-serif;'}}:null,{tag:'SPAN',attributes:{'class':FONT_FAMILY_CLASS}});return this.focus()};proto.setFontSize=function(size){this.changeFormat(size?{tag:'SPAN',attributes:{'class':FONT_SIZE_CLASS,style:'font-size: '+(typeof size==='number'?size+'px':size)}}:null,{tag:'SPAN',attributes:{'class':FONT_SIZE_CLASS}});return this.focus()};proto.setTextColour=function(colour){this.changeFormat(colour?{tag:'SPAN',attributes:{'class':COLOUR_CLASS,style:'color:'+colour}}:null,{tag:'SPAN',attributes:{'class':COLOUR_CLASS}});return this.focus()};proto.setHighlightColour=function(colour){this.changeFormat(colour?{tag:'SPAN',attributes:{'class':HIGHLIGHT_CLASS,style:'background-color:'+colour}}:colour,{tag:'SPAN',attributes:{'class':HIGHLIGHT_CLASS}});return this.focus()};proto.setTextAlignment=function(alignment){this.forEachBlock(function(block){var className=block.className.split(/\s+/).filter(function(klass){return!!klass&&!/^align/.test(klass)}).join(' ');if(alignment){block.className=className+' align-'+alignment;block.style.textAlign=alignment}else{block.className=className;block.style.textAlign=''}},true);return this.focus()};proto.setTextDirection=function(direction){this.forEachBlock(function(block){if(direction){block.dir=direction}else{block.removeAttribute('dir')}},true);return this.focus()};function removeFormatting(self,root,clean){var node,next;for(node=root.firstChild;node;node=next){next=node.nextSibling;if(isInline(node)){if(node.nodeType===TEXT_NODE||node.nodeName==='BR'||node.nodeName==='IMG'){clean.appendChild(node);continue}}else if(isBlock(node)){clean.appendChild(self.createDefaultBlock([removeFormatting(self,node,self._doc.createDocumentFragment())]));continue}removeFormatting(self,node,clean)}return clean}proto.removeAllFormatting=function(range){if(!range&&!(range=this.getSelection())||range.collapsed){return this}var root=this._root;var stopNode=range.commonAncestorContainer;while(stopNode&&!isBlock(stopNode)){stopNode=stopNode.parentNode}if(!stopNode){expandRangeToBlockBoundaries(range,root);stopNode=root}if(stopNode.nodeType===TEXT_NODE){return this}this.saveUndoState(range);moveRangeBoundariesUpTree(range,stopNode,stopNode,root);var doc=stopNode.ownerDocument;var startContainer=range.startContainer;var startOffset=range.startOffset;var endContainer=range.endContainer;var endOffset=range.endOffset;var formattedNodes=doc.createDocumentFragment();var cleanNodes=doc.createDocumentFragment();var nodeAfterSplit=split(endContainer,endOffset,stopNode,root);var nodeInSplit=split(startContainer,startOffset,stopNode,root);var nextNode,childNodes;while(nodeInSplit!==nodeAfterSplit){nextNode=nodeInSplit.nextSibling;formattedNodes.appendChild(nodeInSplit);nodeInSplit=nextNode}removeFormatting(this,formattedNodes,cleanNodes);cleanNodes.normalize();nodeInSplit=cleanNodes.firstChild;nextNode=cleanNodes.lastChild;childNodes=stopNode.childNodes;if(nodeInSplit){stopNode.insertBefore(cleanNodes,nodeAfterSplit);startOffset=indexOf.call(childNodes,nodeInSplit);endOffset=indexOf.call(childNodes,nextNode)+1}else{startOffset=indexOf.call(childNodes,nodeAfterSplit);endOffset=startOffset}range.setStart(stopNode,startOffset);range.setEnd(stopNode,endOffset);mergeInlines(stopNode,range);moveRangeBoundariesDownTree(range);this.setSelection(range);this._updatePath(range,true);return this.focus()};proto.increaseQuoteLevel=command('modifyBlocks',increaseBlockQuoteLevel);proto.decreaseQuoteLevel=command('modifyBlocks',decreaseBlockQuoteLevel);proto.makeUnorderedList=command('modifyBlocks',makeUnorderedList);proto.makeOrderedList=command('modifyBlocks',makeOrderedList);proto.removeList=command('modifyBlocks',removeList);Squire.isInline=isInline;Squire.isBlock=isBlock;Squire.isContainer=isContainer;Squire.getBlockWalker=getBlockWalker;Squire.getPreviousBlock=getPreviousBlock;Squire.getNextBlock=getNextBlock;Squire.areAlike=areAlike;Squire.hasTagAttributes=hasTagAttributes;Squire.getNearest=getNearest;Squire.isOrContains=isOrContains;Squire.detach=detach;Squire.replaceWith=replaceWith;Squire.empty=empty;Squire.getNodeBefore=getNodeBefore;Squire.getNodeAfter=getNodeAfter;Squire.insertNodeInRange=insertNodeInRange;Squire.extractContentsOfRange=extractContentsOfRange;Squire.deleteContentsOfRange=deleteContentsOfRange;Squire.insertTreeFragmentIntoRange=insertTreeFragmentIntoRange;Squire.isNodeContainedInRange=isNodeContainedInRange;Squire.moveRangeBoundariesDownTree=moveRangeBoundariesDownTree;Squire.moveRangeBoundariesUpTree=moveRangeBoundariesUpTree;Squire.getStartBlockOfRange=getStartBlockOfRange;Squire.getEndBlockOfRange=getEndBlockOfRange;Squire.contentWalker=contentWalker;Squire.rangeDoesStartAtBlockBoundary=rangeDoesStartAtBlockBoundary;Squire.rangeDoesEndAtBlockBoundary=rangeDoesEndAtBlockBoundary;Squire.expandRangeToBlockBoundaries=expandRangeToBlockBoundaries;Squire.onPaste=onPaste;Squire.addLinks=addLinks;Squire.splitBlock=splitBlock;Squire.startSelectionId=startSelectionId;Squire.endSelectionId=endSelectionId;if(typeof exports==='object'){module.exports=Squire}else if(typeof define==='function'&&define.amd){define(function(){return Squire})}else{win.Squire=Squire;if(top!==win&&doc.documentElement.getAttribute('data-squireinit')==='true'){win.editor=new Squire(doc);if(win.onEditorLoad){win.onEditorLoad(win.editor);win.onEditorLoad=null}}}}(document))}(this));return _retrieveGlobal()});(function(){var define=System.amdDefine;define('components/richTextEditor/FontSizeDropdown.js',['node_modules/knockout/build/output/knockout-latest.debug.js','components/richTextEditor/Hideable.js'],function(ko,Hideable){function FontSizeDropdown(callback){Hideable.mixin(this);var that=this;this.sizes=[{label:TR('mail.composer.FontSmall','Small'),cssClass:'rte-toolbar--sizeMenu--small-sample',value:'8px'},{label:TR('mail.composer.FontNormal','Normal'),cssClass:'rte-toolbar--sizeMenu--medium-sample',value:'13px'},{label:TR('mail.composer.FontLarge','Large'),cssClass:'rte-toolbar--sizeMenu--large-sample',value:'20px'},{label:TR('mail.composer.FontHuge','Huge'),cssClass:'rte-toolbar--sizeMenu--huge-sample',value:'36px'}];this.select=function(fontSize){that.hide();callback(fontSize)}}return FontSizeDropdown})}());(function(){var define=System.amdDefine;define('components/richTextEditor/FontDropdown.js',['node_modules/knockout/build/output/knockout-latest.debug.js','components/richTextEditor/Hideable.js'],function(ko,Hideable){function FontDropdown(callback){Hideable.mixin(this);var that=this;this.fonts=[{label:'Normal',family:'\'Open Sans\', helvetica, arial, sans-serif'},{label:'Normal / serif',family:'\'times new roman\', serif'},{label:'Courier New',family:'\'courier new\', monospace'},{label:'Georgia',family:'georgia, serif'},{label:'Trebuchet',family:'\'trebuchet ms\', sans-serif'},{label:'Verdana',family:'verdana, sans-serif'}];this.selected=ko.observable(this.fonts[0].label);this.select=function(font){that.hide();that.selected(font.label);callback(font)}}FontDropdown.prototype.selectFont=function(fontFamily){if(!fontFamily){return}var result=this.fonts.filter(function(font){return-1!==font.family.toLowerCase().indexOf(fontFamily.toLowerCase())});if(result.length!==0){this.selected(result[0].label)}};return FontDropdown})}());(function(){var define=System.amdDefine;define('components/richTextEditor/LinkDialog.js',['node_modules/jquery/dist/jquery.js','node_modules/knockout/build/output/knockout-latest.debug.js','components/richTextEditor/Hideable.js','common/util.js','3rdparty/onevalidation/validation.js'],function($,ko,Hideable,util,validation){function validUrl(url){return validation.mailtoUrlIdn.test(url)||validation.emailIdn.test(url)||validation.httpUrlIdn.test(url)||validation.httpUrlIdn.test('http://'+url)}function LinkDialog(toolbar,callback){Hideable.mixin(this);var that=this;this.link=ko.observable('');this.textOverLink=ko.observable('');this.element='';this.editMode=false;this.warnInvalid=ko.observable(false);this.link.subscribe(function(){this.warnInvalid(false)},this);this.isImgSelected=ko.observable(false);this.close=function(){this.link('');this.textOverLink('');this.hide();toolbar.editor.focus();this.editMode=false};this.checkSelection=function(selection){this.isImgSelected=ko.observable(false);if(selection.commonAncestorContainer.firstChild){that.isImgSelected(selection.commonAncestorContainer.firstChild.nodeName==='IMG')}};this.getSelectedText=function(){var selectedText=toolbar.editor.getSelectedText();that.checkSelection(toolbar.editor.getSelection());that.textOverLink(selectedText)};this.clearWarning=function(){that.close();that.warnInvalid(false)};this.save=function(){var url=this.link().trim(),textOverLink,tmpLink=document.createElement('a');tmpLink.href=decodeURI(url);tmpLink.pathname=encodeURI(tmpLink.pathname);if(validUrl(tmpLink)){if(this.textOverLink()===''&&that.isImgSelected()===false){textOverLink=url}else{textOverLink=util.htmlEncode(this.textOverLink()).trim()}callback(url,textOverLink);this.close()}else{this.warnInvalid(true)}};this.selected=ko.observable()}LinkDialog.prototype.keyDown=function(data,event){if(event.which===13){this.save();return false}return true};return LinkDialog})}());(function(){var define=System.amdDefine;define('components/richTextEditor/ImageDialog.js',['node_modules/knockout/build/output/knockout-latest.debug.js','components/richTextEditor/Hideable.js'],function(ko,Hideable){function ImageDialog(callback,acceptSources){var that=this;that.imageUrl=ko.observable('');that.imageFile=ko.observable();that.imageFiles=ko.observableArray([]);that.imageFileName=ko.computed(function(){var fileInput=that.imageFile(),imageFileNames=[];if(fileInput&&fileInput.files&&fileInput.files.length){for(var i=0;i<fileInput.files.length;i+=1){imageFileNames.push(fileInput.files[i].name);that.imageFiles.push(fileInput.files[i])}return imageFileNames}else if(fileInput&&fileInput.value){return fileInput.value.replace(/.*[\/\\]/,'')}return''});that.sources=acceptSources.map(function(source){return{name:source}});that.selectedSource=ko.observable(that.sources[0].name);that.reverseSources=that.sources.reverse();that.save=function(){switch(that.selectedSource()){case'url':callback({url:that.imageUrl()});that.close();break;case'disk':if(!that.imageFiles().length){that.close()}else{callback({file:that.imageFiles()});that.close();break}}};that.close=function(){that.hide();that.imageUrl('');that.imageFiles([]);that.imageFile(null);that.selectedSource(that.sources[that.sources.length-1].name)};that.remove=function(data){for(var i=0;i<that.imageFiles().length;i+=1){if(that.imageFiles()[i].name===data.name){that.imageFiles.splice(i,1)}}if(!that.imageFiles().length){that.imageFile(null)}};Hideable.mixin(that)}return ImageDialog})}());(function(){var define=System.amdDefine;define('components/richTextEditor/ColorDropdown.js',['node_modules/knockout/build/output/knockout-latest.debug.js','components/richTextEditor/Hideable.js'],function(ko,Hideable){function ColorDropdown(callback){var that=this;Hideable.mixin(this);this.select=function(color){that.hide();callback(color)}}ColorDropdown.prototype.colors=['#000000','#444444','#666666','#999999','#cccccc','#eeeeee','#f3f3f3','#ffffff','#ff0000','#ff9900','#ffff00','#00ff00','#00ffff','#0000ff','#9900ff','#ff00ff','#f4cccc','#fce5cd','#fff2cc','#d9ead3','#d0e0e3','#cfe2f3','#d9d2e9','#ead1dc','#ea9999','#f9cb9c','#ffe599','#b6d7a8','#a2c4c9','#9fc5e8','#b4a7d6','#d5a6bd','#e06666','#f6b26b','#ffd966','#93c47d','#76a5af','#6fa8dc','#8e7cc3','#c27ba0','#cc0000','#e69138','#f1c232','#6aa84f','#45818e','#3d85c6','#674ea7','#a64d79','#990000','#b45f06','#bf9000','#38761d','#134f5c','#0b5394','#351c75','#741b47','#660000','#783f04','#7f6000','#274e13','#0c343d','#073763','#20124d','#4c1130'];return ColorDropdown})}());(function(){var define=System.amdDefine;define('components/richTextEditor/Hideable.js',['node_modules/knockout/build/output/knockout-latest.debug.js'],function(ko){function show(){this.visible(true)}function hide(){this.visible(false)}var Hideable={mixin:function(target){target.visible=ko.observable(false);target.show=show;target.hide=hide}};return Hideable})}());(function(){var define=System.amdDefine;define('components/richTextEditor/RteToolbar.js',['node_modules/knockout/build/output/knockout-latest.debug.js','components/richTextEditor/FontSizeDropdown.js','components/richTextEditor/FontDropdown.js','components/richTextEditor/LinkDialog.js','components/richTextEditor/ImageDialog.js','components/richTextEditor/ColorDropdown.js','components/richTextEditor/Hideable.js'],function(ko,FontSizeDropdown,FontDropdown,LinkDialog,ImageDialog,ColorDropdown,Hideable){function SelectableButton(toolbar,definition){var that=this;that.selected=ko.observable(false);that.id=definition.id;if(definition.spec.toggleable){that.action=function(){if(that.selected()){toolbar.editor[definition.spec.off]()}else{toolbar.editor[definition.spec.on]()}};that.detect=function(){return toolbar.editor.hasFormat(definition.spec.tag)}}else{that.action=definition.spec.fire;that.detect=definition.spec.detect||null}}function RteToolbar(options){Hideable.mixin(this);var that=this;options.images=options.images||{};options.images.accept=options.images.accept||['url'];that.insertImage=function(urlOrData){var imageElement;if(typeof urlOrData==='string'){imageElement=that.editor.insertImage(urlOrData);if(that.imageHandler){that.imageHandler.maxWidth(that.defaultImageSize,imageElement)}}else{var placeholder=urlOrData.placeholderUrl;delete urlOrData.placeholderUrl;var attributes={};Object.keys(urlOrData).forEach(function(key){attributes['data-'+key]=urlOrData[key]});imageElement=that.editor.insertImage(placeholder||'placeholder.png',attributes);if(that.imageHandler){var handler=function(){that.imageHandler.maxWidth(that.defaultImageSize,imageElement);imageElement.removeEventListener('load',handler)};imageElement.addEventListener('load',handler)}}imageElement.oncontrolselect=function(){return false};return imageElement};function fixPartialUrl(url){var fixedUrl=url;if(fixedUrl.indexOf('://')===-1&&fixedUrl.indexOf('mailto:')!==0&&fixedUrl.indexOf('data:')!==0){if(/^\S+@\S+\.\S+/.test(fixedUrl)){fixedUrl='mailto:'+fixedUrl}else{fixedUrl='http://'+fixedUrl}}return fixedUrl}var commands={'bold':{toggleable:true,on:'bold',off:'removeBold',tag:'b'},'italic':{toggleable:true,on:'italic',off:'removeItalic',tag:'i'},'underline':{toggleable:true,on:'underline',off:'removeUnderline',tag:'u'},'justify-left':{toggleable:false,fire:function(){that.editor.setTextAlignment('left')}},'justify-center':{toggleable:false,fire:function(){that.editor.setTextAlignment('center')}},'justify-right':{toggleable:false,fire:function(){that.editor.setTextAlignment('right')}},'justify-full':{toggleable:false,fire:function(){that.editor.setTextAlignment('justify')}},'indent':{toggleable:false,fire:function(){if(that.editor.hasFormat('ul')||that.editor.hasFormat('ol')){that.editor.increaseListLevel()}else{that.editor.increaseQuoteLevel()}}},'outdent':{toggleable:false,fire:function(){if(that.editor.hasFormat('ul')||that.editor.hasFormat('ol')){that.editor.decreaseListLevel()}else{that.editor.decreaseQuoteLevel()}}},'ulist':{toggleable:true,on:'makeUnorderedList',off:'removeList',tag:'ul'},'olist':{toggleable:true,on:'makeOrderedList',off:'removeList',tag:'ol'},'remove-format':{toggleable:false,fire:function(){that.editor.removeAllFormatting()}}};that.defaultButtons=['bold','italic','underline','font','font-size','text-color','background-color','link','image','olist','ulist','indent','outdent','justify-left','justify-center','justify-right','justify-full','remove-format'];that.dialogText=options.dialogText||{link:{title:'Link to:',invalid:'Invalid link address',save:'Save',close:'Close',textToDisplay:'Text to display:'},image:{title:'Insert image from:',url:'Web',disk:'Computer',selectFile:'Select a file',save:'Save',close:'Close'}};if(!Array.isArray(options.buttonSet)||options.buttonSet.length<1){options.buttonSet=that.defaultButtons}that.buttonSet=[];that.buttons={};that.selectableButtons=[];options.buttonSet.forEach(function(button){var name=button.id||button;that.buttonSet.push(name);if(name==='text-color'||name==='background-color'){var action=name==='text-color'?'setTextColour':'setHighlightColour';that.buttons[name]={model:new ColorDropdown(function(color){that.editor[action](color)}),template:'colorPalette'}}else if(name==='font'){that.buttons[name]={model:new FontDropdown(function(font){that.editor.setFontFace(font.family)}),template:'fontDropdown'}}else if(name==='font-size'){that.buttons[name]={model:new FontSizeDropdown(function(fontSize){that.editor.setFontSize(fontSize.value)}),template:'fontSizeDropdown'}}else if(name==='link'){var model=new LinkDialog(that,function(url,textOverLink){var html,fixUrl=fixPartialUrl(url);if(textOverLink){html='<a href=\''+fixUrl+'\''+' target=\'_blank\''+'>'+textOverLink+'</a>';that.editor.insertHTML(html)}else{that.editor.makeLink(fixUrl)}});model.action=function(){if(this.detect()){that.editor.removeLink()}};model.text=that.dialogText.link;model.detect=function(){return that.editor.hasFormat('a')};that.buttons[name]={model:model,template:'linkDialog'};that.selectableButtons.push(model)}else if(name==='image'&&options.images.accept.length){that.buttons[name]={model:new ImageDialog(function(data){if(data.url){that.insertImage(fixPartialUrl(data.url))}else if(data.file&&typeof options.images.upload==='function'){options.disabled(true);options.images.upload(data.file,function(urlOrData){if(!urlOrData){options.disabled(false);return}that.insertImage(urlOrData);options.disabled(false)})}},options.images.accept),template:'imageDialog'};that.buttons[name].model.text=that.dialogText.image;that.buttons[name].model.multiple=!!options.images.multiple;that.defaultImageSize=options.images&&options.images.defaultSize||'large'}else{that.buttons[name]={model:new SelectableButton(that,{id:name,spec:commands[name]}),template:'rteToolbarButton'};that.selectableButtons.push(that.buttons[name].model)}that.buttons[name].model.tooltip=button.tooltip||'';that.buttons[name].model.icon='icon-rte-'+(button.icon||name)});that.setupImageHandler=function(imageHandler){that.imageHandler=imageHandler};that.setupLinkHandler=function(linkHandler){that.linkHandler=linkHandler}}RteToolbar.prototype.hasButton=function(name){return!!this.buttonSet.indexOf(name)};RteToolbar.prototype.isSelected=function(buttonName){return this.buttons[buttonName]&&this.buttons[buttonName].model.selected()};RteToolbar.prototype.enact=function(buttonName){if(this.buttons[buttonName]){this.buttons[buttonName].model.action()}};RteToolbar.prototype.updateButtonSelection=function(){var that=this;var buttons=that.selectableButtons.filter(function(button){return typeof button.detect==='function'});buttons.forEach(function(button){button.selected(button.detect())});var fontInfo=that.editor.getFontInfo();if(fontInfo.family){that.buttons.font.model.selectFont(fontInfo.family.replace(/,.*/,'').replace(/["']/g,''))}else{that.buttons.font.model.selectFont('helvetica')}};RteToolbar.prototype.setEditor=function(editor){var that=this;that.editor=editor;that.updateButtonSelection();var throttle=false;var updater=function(){if(throttle){return}throttle=true;setTimeout(function(){that.updateButtonSelection();throttle=false},100)};editor.getDocument().addEventListener('mouseup',updater);editor.getDocument().addEventListener('keydown',updater);editor.addEventListener('input',updater);that.show()};return RteToolbar})}());(function(){var define=System.amdDefine;(function(root,factory){if(typeof exports==='object'){module.exports=factory(require('knockout'))}else if(typeof define==='function'&&define.amd){define('3rdparty/knockout.activateFileInput.js',['node_modules/knockout/build/output/knockout-latest.debug.js'],factory)}else{factory(ko)}}(this,function(ko){var useAttachEvent=!document.addEventListener;function addEventListener(element,callback){if(useAttachEvent){element.attachEvent('onchange',callback)}else{element.addEventListener('change',callback,true)}}function removeEventListener(element,callback){if(useAttachEvent){element.detachEvent('onchange',callback)}else{element.removeEventListener('change',callback,true)}}function FileInputModel(){var that=this;that.fileInput=null;that.onChangeHandler=null;function setupFileInput(options){var fileInput=document.createElement('input'),style=fileInput.style;fileInput.type='file';style.position='absolute';style.top=options.offset.top||0;style.right=options.offset.right||0;style.margin=0;style.opacity=0;style.filter='alpha(opacity=0)';style['-webkit-transform']='translate(-300px, 0) scale(3)';style['-moz-transform']='translate(-300px, 0) scale(3)';style['-ms-transform']='translate(-300px, 0) scale(3)';style['-o-transform']='translate(-300px, 0) scale(3)';style.transform='translate(-300px, 0) scale(3)';style.fontSize='23px';style.direction='ltr';style.height='auto';style.width='auto';style.cursor='pointer';if(options.multiple){fileInput.setAttribute('multiple','multiple')}else{fileInput.removeAttribute('multiple')}if(options.accept){fileInput.setAttribute('accept',options.accept)}else{fileInput.removeAttribute('accept')}if(options.tabIndex){fileInput.setAttribute('tabindex',options.tabIndex)}else{fileInput.removeAttribute('tabindex')}if('disabled'in options){var isDisabled=ko.utils.unwrapObservable(options.disabled);if(isDisabled){fileInput.setAttribute('disabled',isDisabled);fileInput.style.cursor='default'}else{fileInput.removeAttribute('disabled');fileInput.style.cursor='pointer'}}return fileInput}that.attach=function(element,options,viewModel){that.fileInput=setupFileInput(options);that.onChangeHandler=function(){options.handler.call(viewModel,this);that.detach(element,options,viewModel);that.attach(element,options,viewModel)};element.style.position='relative';element.style.overflow='hidden';if(element.style.display==='inline'){element.style.display='inline-block'}element.appendChild(that.fileInput);addEventListener(that.fileInput,that.onChangeHandler)};that.detach=function(element,options,viewModel){removeEventListener(that.fileInput,that.onChangeHandler);if(that.fileInput.parentNode===element){element.removeChild(that.fileInput)}that.fileInput=null;that.onChangeHandler=null}}ko.bindingHandlers.activateFileInput={init:function(element,valueAccessor,allBindingsAccessor,viewModel){return true},update:function(element,valueAccessor,allBindingsAccessor,viewModel){var value=valueAccessor(),options={multiple:false,offset:{}},fileInputModel=ko.utils.domData.get(element,'knockout-activateFileInput');if(typeof value==='object'){if(!value.handler||typeof value.handler!=='function'){throw new Error('activateFileInput: `value` object should have a callable `handler` property')}ko.utils.extend(options,value)}else if(typeof value==='function'){options.handler=value}else{throw new Error('activateFileInput: value must be an object or a function')}if(fileInputModel){fileInputModel.detach(element,options,viewModel)}else{fileInputModel=new FileInputModel;ko.utils.domData.set(element,'knockout-activateFileInput',fileInputModel)}fileInputModel.attach(element,options,viewModel)}};return ko.bindingHandlers.activateFileInput}))}());(function(){var define=System.amdDefine;define('components/richTextEditor/ImageHandler.js',['node_modules/jquery/dist/jquery.js','node_modules/knockout/build/output/knockout-latest.debug.js','3rdparty/knockout.activateFileInput.js'],function($,ko){function ImageHandler(options){var that=this;that.SIZE_THUMBNAIL=50;that.SIZE_SMALL=150;that.SIZE_MEDIUM=350;that.SIZE_LARGE=650;that.visible=ko.observable(false);that.attachedImage=ko.observable(null);that.imageRawSize=ko.observable();that.imageSetSize=ko.observable();that.text=options.imageHandlerText||{small:'Small',medium:'Medium',large:'Large',original:'Original','delete':'Delete'};that.attachedImage.subscribe(function(newImg){if(newImg){var $img=$(newImg),setWidth=$img.attr('width');$img.attr('unselectable','on');if(setWidth){if(setWidth<=that.SIZE_SMALL){that.imageSetSize('small')}else if(setWidth<=that.SIZE_MEDIUM){that.imageSetSize('medium')}else if(setWidth<=that.SIZE_LARGE){that.imageSetSize('large')}else{that.imageSetSize('original')}}else{that.imageSetSize('original')}var $shadowImg=$('<img src="'+$img.attr('src')+'" />');$shadowImg.hide();$shadowImg.load(function(){that.$toolbar.after($shadowImg);that.imageRawSize($shadowImg.width());$shadowImg.remove();that.visible(true);that.reposition()})}else{that.imageRawSize(null);that.imageSetSize(null)}});that.$toolbar=null;that.canSetSmall=ko.computed(function(){return that.imageRawSize()>that.SIZE_SMALL});that.canSetMedium=ko.computed(function(){return that.imageRawSize()>that.SIZE_MEDIUM});that.canSetLarge=ko.computed(function(){return that.imageRawSize()>that.SIZE_LARGE});that.closeToolbar=function(){that.attachedImage(null);that.$toolbar.width('');that.visible(false)};that.closeAfter=function(){setTimeout(function(){that.closeToolbar()},0);return true}}ImageHandler.prototype.reposition=function(){if(!this.attachedImage()){return}var $img=$(this.attachedImage()),$body=$(this.rootElement),$frame=$(this.frame),frameOffset=$frame.offset(),targetOffset=$img.offset(),leftInFrame=Math.min(targetOffset.left,$frame.width()),scrollTop=$body.scrollTop();if(scrollTop>targetOffset.top+$img.height()-this.$toolbar.height()||targetOffset.top+this.$toolbar.height()>scrollTop+$frame.height()){this.closeToolbar();return}this.$toolbar.offset({top:frameOffset.top-this.$toolbar.height()+Math.min(targetOffset.top+$img.height()-scrollTop,$frame.height()),left:frameOffset.left+leftInFrame});this.$toolbar.width('');this.$toolbar.width(Math.min(Math.max($img.width(),this.$toolbar.width()),$frame.width()-10))};ImageHandler.prototype.setEditor=function(editor,frame){var that=this;that.editor=editor;that.frame=frame;that.rootElement=that.editor.getDocument();that.$toolbar=$(frame).parent().find('.rte-imagehandler');that.$toolbar.offset({top:0,left:0});$(that.rootElement).on('click','img',function(event){that.attachedImage(event.target);event.stopPropagation()});$(that.rootElement).on('keydown',this.closeToolbar);$(that.rootElement).on('click',this.closeToolbar);$('body').on('keydown',this.closeToolbar);$('body').on('click',this.closeAfter)};ImageHandler.prototype.dispose=function(){$('body').off('keydown',this.closeToolbar);$('body').off('click',this.closeAfter)};ImageHandler.prototype._maxWidthHandler=function(width,imgElement){var that=this,$img=$(imgElement),height;$img.removeAttr('width');$img.removeAttr('height');if($img.width()>width){if(imgElement.naturalHeight){height=imgElement.naturalHeight*(width/ imgElement.naturalWidth);height=Math.round(height*100)/100}that.editor.modifyBlocks(function(block){$img.attr('width',width);if(height){$img.attr('height',height)}return block})}};ImageHandler.prototype.maxWidth=function(maxWidth,imgElement){var that=this,$img=$(imgElement),width;if(typeof maxWidth==='string'){if(maxWidth.toLowerCase()==='original'){$img.removeAttr('width')}else{width=that['SIZE_'+maxWidth.toUpperCase()]||that.SIZE_LARGE}}else{width=parseInt(maxWidth,10)||that.SIZE_LARGE}$img.load(function(){that._maxWidthHandler(width,imgElement)});that._maxWidthHandler(width,imgElement);that.reposition()};ImageHandler.prototype.setSizeSmall=function(){if(this.canSetSmall()&&this.attachedImage()){this.maxWidth('small',this.attachedImage());this.imageSetSize('small')}};ImageHandler.prototype.setSizeMedium=function(){if(this.canSetMedium()&&this.attachedImage()){this.maxWidth('medium',this.attachedImage());this.imageSetSize('medium')}};ImageHandler.prototype.setSizeLarge=function(){if(this.canSetLarge()&&this.attachedImage()){this.maxWidth('large',this.attachedImage());this.imageSetSize('large')}};ImageHandler.prototype.setSizeOriginal=function(){if(this.attachedImage()){this.maxWidth('original',this.attachedImage());this.imageSetSize('original')}};ImageHandler.prototype.deleteImage=function(){var that=this;if(that.attachedImage()){that.editor.modifyBlocks(function(block){$(that.attachedImage()).remove();return block})}this.closeToolbar()};return ImageHandler})}());(function(){var define=System.amdDefine;define('components/richTextEditor/LinkHandler.js',['node_modules/jquery/dist/jquery.js','node_modules/knockout/build/output/knockout-latest.debug.js','3rdparty/mario.js','3rdparty/purify.js'],function($,ko,mario,purify){function LinkHandler(options){var that=this;that.visible=ko.observable(false);that.attachedLink=ko.observable(null);that.text=options.linkHandlerText||{'goto':'Go to','delete':'Delete','edit':'Edit'};that.$toolbar=null;that.linkUrl=ko.pureComputed(function(){if(that.attachedLink()){return that.attachedLink().href}else{return null}});that.attachedLink.subscribe(function(newLink){if(newLink){that.visible(true);setTimeout(function(){that.reposition()},0)}});that.closeToolbar=function(){that.attachedLink(null);that.visible(false)};that.closeAfter=function(){setTimeout(function(){that.closeToolbar()},0);return true};that.showDelete=ko.pureComputed(function(){if(!mario.msie){return true}if(!that.attachedLink()){return false}var $link=that.attachedLink();var text=$link.text;return!(purify.url(text)||purify.url('http://'+text))});that.openEditableDialog=function(par,data){var toolbar=par[0].rteToolbar,link=this.linkUrl(),textOverLink=toolbar.editor.getSelectedText(),linkDialog=toolbar.buttons.link.model,selectedElement=toolbar.editor.getSelection(),node=selectedElement.commonAncestorContainer.parentNode;var range=document.createRange();range.setStart(node,0);range.setEnd(node,1);linkDialog.selected(false);toolbar.editor.setSelection(range);linkDialog.editMode=true;linkDialog.link(link);linkDialog.textOverLink(textOverLink);linkDialog.element=node;linkDialog.show()}}LinkHandler.prototype.reposition=function(){if(!this.attachedLink()){return}var $link=$(this.attachedLink()),$body=$(this.rootElement),$frame=$(this.frame),frameOffset=$frame.offset(),targetOffset=$link.offset(),leftInFrame=Math.min(targetOffset.left,$frame.width()),scrollTop=$body.scrollTop(),bodyWidth=Math.floor($frame.width()),linkPosition=Math.floor($link.offset().left),linkHandlerWidth=Math.floor(this.$toolbar.width()),$gotToLink=$('.linkhandler--link');$gotToLink.removeClass('wraplink');if(scrollTop>targetOffset.top+$link.height()){this.closeToolbar();return}if(linkPosition+linkHandlerWidth+200>bodyWidth){this.$toolbar.css({'white-space':'normal'});var difference=linkPosition+linkHandlerWidth-bodyWidth,properWidth=Math.floor(linkHandlerWidth-difference);this.$toolbar.css({width:properWidth});$gotToLink.addClass('wraplink');$gotToLink.css({width:properWidth})}else{this.$toolbar.css({'white-space':'nowrap'})}this.$toolbar.offset({top:frameOffset.top+Math.min(targetOffset.top+$link.height()-scrollTop,$frame.height()),left:frameOffset.left+leftInFrame});if(targetOffset.top+$link.height()+this.$toolbar.height()>scrollTop+$frame.height()){var top=this.$toolbar.offset().top-($link.height()+this.$toolbar.height());this.$toolbar.offset({top:top})}};LinkHandler.prototype.setEditor=function(editor,frame){var that=this;that.editor=editor;that.frame=frame;that.rootElement=that.editor.getDocument();that.$toolbar=$(frame).parent().find('.rte-linkhandler');that.$toolbar.offset({top:0,left:0});$(that.rootElement).on('click','a',function(event){var aElement=event.target;while(aElement&&aElement.nodeName!=='A'){aElement=aElement.parentNode}if(!aElement){return}that.attachedLink(aElement);event.stopPropagation()});$(that.rootElement).on('keydown',this.closeToolbar);$(that.rootElement).on('click',this.closeToolbar);$('body').on('keydown',this.closeToolbar);$('body').on('click',this.closeAfter)};LinkHandler.prototype.dispose=function(){$('body').off('keydown',this.closeToolbar);$('body').off('click',this.closeAfter)};LinkHandler.prototype.deleteLink=function(){this.editor.removeLink();this.closeToolbar()};return LinkHandler})}());(function(){var define=System.amdDefine;(function(root,factory){if(typeof exports==='object'){module.exports=factory(require('knockout'))}else if(typeof define==='function'&&define.amd){define('3rdparty/knockout.afterRender.js',['node_modules/knockout/build/output/knockout-latest.debug.js'],factory)}else{factory(ko)}}(this,function(ko){ko.bindingHandlers.afterRender={init:function(element,valueAccessor,allBindingsAccessor,viewModel,bindingContext){var value=valueAccessor();var handler=ko.utils.unwrapObservable(value);handler.call(viewModel,element,viewModel)}}}))}());System.registerDynamic('components/richTextEditor/rteditor.ko',[],true,function($__require,exports,module){var define,global=this||self,GLOBAL=global;module.exports=function injectTemplate(tpl){var s=document.createElement('script');s.id=tpl.id;s.innerHTML=window.TR?TR.HTML(tpl.content):tpl.content;s.type='text/html';document.head.appendChild(s)}({'id':'rteditor','content':'<div class="rte-toolbar" data-bind="foreach: rteToolbar.buttonSet" data-keydomain="---" style="word-spacing: -3px;">\n<!-- ko template: { name: $parent.rteToolbar.buttons[$data].template, data: $parent.rteToolbar.buttons[$data].model } -->\n<!-- /ko -->\n</div>\n\n<div class="rte-frame" data-bind="afterRender: setup">\n    <!-- ko if: imageHandler -->\n    <div class="rte-imagehandler" data-bind="template: { name: \'imageHandler\', data: imageHandler }, visible: imageHandler.visible" data-keydomain="---"></div>\n    <!-- /ko -->\n    <!-- ko if: linkHandler -->\n    <div class="rte-linkhandler" data-bind="template: { name: \'linkHandler\', data: linkHandler }, visible: linkHandler.visible" data-keydomain="---"></div>\n    <!-- /ko -->\n</div>\n\n<div class="rte-overlay" data-bind="visible: disabled"></div>\n'});return module.exports});System.registerDynamic('components/richTextEditor/fontDropdown.ko',[],true,function($__require,exports,module){var define,global=this||self,GLOBAL=global;module.exports=function injectTemplate(tpl){var s=document.createElement('script');s.id=tpl.id;s.innerHTML=window.TR?TR.HTML(tpl.content):tpl.content;s.type='text/html';document.head.appendChild(s)}({'id':'fontDropdown','content':'<div data-bind="unselectable: true, attr: { \'data-title\': tooltip }" class="rte-toolbar--button-container font-dropdown">\n    <a class="rte-toolbar--button" rel="font" data-bind="dropdownTemplate: { template: \'RteFontDropdownTemplate\', openState: visible }"><i class="rte-toolbar--font-sample" data-bind="text: selected"></i><i class="icon-rte-dropdown-arrow"></i></a>\n</div>\n<script id="RteFontDropdownTemplate" type="text/html">\n    <div class="rte-toolbar--menu rte-toolbar--popupTemplate" data-bind="foreach: fonts, keepInsideScreen: visible">\n        <div class="rte-toolbar--menuoption" data-bind="click: $parent.select, text: label, style: { fontFamily: family }"></div>\n    </div>\n</script>\n'});return module.exports});System.registerDynamic('components/richTextEditor/fontSizeDropdown.ko',[],true,function($__require,exports,module){var define,global=this||self,GLOBAL=global;module.exports=function injectTemplate(tpl){var s=document.createElement('script');s.id=tpl.id;s.innerHTML=window.TR?TR.HTML(tpl.content):tpl.content;s.type='text/html';document.head.appendChild(s)}({'id':'fontSizeDropdown','content':'<div data-bind="unselectable: true, attr: { \'data-title\': tooltip }" class="rte-toolbar--button-container">\n    <a class="rte-toolbar--button" rel="fontSize" data-bind="dropdownTemplate: { template: \'RteFontSizeDialogTemplate\', openState: visible }"><i data-bind="css: icon"></i><i class="icon-rte-dropdown-arrow"></i></a>\n</div>\n<script id="RteFontSizeDialogTemplate" type="text/html">\n    <div class="rte-toolbar--menu rte-toolbar--popupTemplate" data-bind="foreach: sizes, keepInsideScreen: visible">\n        <div data-bind="click: $parent.select, attr: { \'class\': cssClass }, text: label">\n        </div>\n    </div>\n</script>\n'});return module.exports});System.registerDynamic('components/richTextEditor/linkDialog.ko',[],true,function($__require,exports,module){var define,global=this||self,GLOBAL=global;module.exports=function injectTemplate(tpl){var s=document.createElement('script');s.id=tpl.id;s.innerHTML=window.TR?TR.HTML(tpl.content):tpl.content;s.type='text/html';document.head.appendChild(s)}({'id':'linkDialog','content':'<div class="rte-toolbar--button-container">\n    <a class="rte-toolbar--button selected" data-bind="click: action, visible: selected, unselectable: true, attr: { \'data-title\': tooltip }"><i data-bind="css: icon"></i></a>\n    <a class="rte-toolbar--button" data-bind="dropdownTemplate: { template: \'RteLinkDialogTemplate\', openState: visible, closeOnClickInPopup: false,  afterOpen: getSelectedText, afterClose: clearWarning }, visible: !selected(), unselectable: true, attr: { \'data-title\': tooltip }"><i data-bind="css: icon"></i></a>\n</div>\n<script id="RteLinkDialogTemplate" type="text/html">\n    <div class="rte-toolbar--dialog rte-toolbar--popupTemplate" data-bind="keepInsideScreen: visible">\n        <div class="rte-toolbar--dialogSection">\n            <div class="rte-toolbar--dialog--label" for="link" data-bind="text: text.title"></div>\n            <div class="rte-toolbar--dialog--field">\n                <input type="text" name="link" data-bind="value: link, focusWhen: visible, event: {keydown: keyDown}, valueUpdate: \'afterkeydown\', unselectable: false"></input>\n                <div data-bind="visible: warnInvalid, text: text.invalid" class="validation-warning"></div>\n            </div>\n            <div class="rte-toolbar--dialog--label" for="text" data-bind="text: text.textToDisplay"></div>\n            <div class="rte-toolbar--dialog--field">\n                <input type="text" name="text" data-bind="value: textOverLink, event: {keydown: keyDown}, valueUpdate: \'afterkeydown\', unselectable: false"></input>\n            </div>\n        </div>\n        <div class="rte-toolbar--dialogSection" data-bind="unselectable: true">\n            <div class="rte-toolbar--dialog--submission">\n                <button class="one-button-style" data-bind="click: save, text: text.save"></button>\n            </div>\n        </div>\n    </div>\n</script>\n'});return module.exports});System.registerDynamic('components/richTextEditor/imageDialog.ko',[],true,function($__require,exports,module){var define,global=this||self,GLOBAL=global;module.exports=function injectTemplate(tpl){var s=document.createElement('script');s.id=tpl.id;s.innerHTML=window.TR?TR.HTML(tpl.content):tpl.content;s.type='text/html';document.head.appendChild(s)}({'id':'imageDialog','content':'<div class="rte-toolbar--button-container">\n    <a class="rte-toolbar--button" data-bind="dropdownTemplate: { template: \'RteImageDialogTemplate\', openState: visible, closeOnClickInPopup: false }, unselectable: true, attr: { \'data-title\': tooltip }"><i data-bind="css: icon"></i></a>\n</div>\n<script id="RteImageDialogTemplate" type="text/html">\n    <div class="rte-toolbar--dialog rte-toolbar--popupTemplate" data-bind="keepInsideScreen: visible">\n        <div class="rte-toolbar--dialogSection">\n            <div class="rte-toolbar--dialog--label" for="imageFile">\n                <span data-bind="text: text.title"></span>\n                <!-- ko foreach: reverseSources -->\n                <a class="rte-toolbar--imageDialog--sourceSelector" data-bind="click: function () { $parent.selectedSource(name); }, css: {disabled: $parent.selectedSource() === name }, text: $parent.text[name]"></a>\n                <!-- /ko -->\n            </div>\n            <div class="rte-toolbar--dialog--field rte-toolbar--imageDialog--file" data-bind="visible: selectedSource() === \'disk\'">\n                <span class="rte-toolbar--imageDialog--file--item" data-bind="visible: imageFile, foreach: imageFiles">\n                    <span data-bind="text: $data.name" class="rte-toolbar--imageDialog--fileSelected"></span>\n                    <i class="icon-rte-remove rte-toolbar--imageDialog--fileClear" data-bind="click: $parent.remove.bind($data)"></i>\n                </span>\n                <span data-bind="visible: !imageFile(), activateFileInput: { handler: imageFile, accept: \'image/*\', multiple: multiple }, attr: { title: text.selectFile }" class="rte-toolbar--imageDialog--fileSelector">\n                    <button class="one-button-style" data-bind="text: text.selectFile"></button>\n                </span>\n            </div>\n            <div class="rte-toolbar--dialog--field" data-bind="visible: selectedSource() === \'url\'">\n                <input type="text" name="imageUrl" data-bind="value: imageUrl, focusWhen: visible, valueUpdate: \'afterkeydown\', unselectable: false" placeholder="http://" data-i18n="attr: {placeholder: null}"></input>\n            </div>\n        </div>\n        <div class="rte-toolbar--dialogSection" data-bind="unselectable: true">\n            <div class="rte-toolbar--dialog--submission">\n                <button class="one-button-style" data-bind="click: save, text: text.save"></button>\n            </div>\n        </div>\n    </div>\n</script>\n'});return module.exports});System.registerDynamic('components/richTextEditor/rteToolbarButton.ko',[],true,function($__require,exports,module){var define,global=this||self,GLOBAL=global;module.exports=function injectTemplate(tpl){var s=document.createElement('script');s.id=tpl.id;s.innerHTML=window.TR?TR.HTML(tpl.content):tpl.content;s.type='text/html';document.head.appendChild(s)}({'id':'rteToolbarButton','content':'<a class="rte-toolbar--button" data-bind="click: action, css: { selected: selected }, unselectable: true, attr: { \'data-title\': tooltip }"><i data-bind="css: icon"></i></a>\n'});return module.exports});System.registerDynamic('components/richTextEditor/imageHandler.ko',[],true,function($__require,exports,module){var define,global=this||self,GLOBAL=global;module.exports=function injectTemplate(tpl){var s=document.createElement('script');s.id=tpl.id;s.innerHTML=window.TR?TR.HTML(tpl.content):tpl.content;s.type='text/html';document.head.appendChild(s)}({'id':'imageHandler','content':'<div class="imagehandler--frame">\n    <ul class="imagehandler--sizeMenu">\n        <li class="imagehandler--sizeMenuItem" data-bind="css: { \'imagehandler--sizeMenuItemInactive\': !canSetSmall() }">\n            <a class="imagehandler--command"\n               data-bind="click: setSizeSmall,\n                          css: { \'imagehandler--commandSelected\': imageSetSize() == \'small\' },\n                          text: text.small"></a>\n        </li>\n        <li class="imagehandler--sizeMenuItem" data-bind="css: { \'imagehandler--sizeMenuItemInactive\': !canSetMedium() }">\n            <a class="imagehandler--command"\n               data-bind="click: setSizeMedium,\n                          css: { \'imagehandler--commandSelected\': imageSetSize() == \'medium\' },\n                          text: text.medium"></a>\n        </li>\n        <li class="imagehandler--sizeMenuItem" data-bind="css: { \'imagehandler--sizeMenuItemInactive\': !canSetLarge() }">\n            <a class="imagehandler--command"\n               data-bind="click: setSizeLarge,\n                          css: { \'imagehandler--commandSelected\': imageSetSize() == \'large\' },\n                          text: text.large"></a>\n        </li>\n        <li class="imagehandler--sizeMenuItem" data-bind="css: { \'imagehandler--sizeMenuItemInactive\': !canSetSmall() }">\n            <a class="imagehandler--command"\n               data-bind="click: setSizeOriginal, css: { \'imagehandler--commandSelected\': imageSetSize() == \'original\' },\n                          text: text.original"></a>\n        </li>\n    </ul>\n    <span class="imagehandler--spacer" data-bind="css: { \'imagehandler--sizeMenuItemInactive\': !canSetSmall() }" data-i18n="">&ndash;</span>\n    <a class="imagehandler--command" data-bind="click: deleteImage, text: text.delete"></a>\n</div>\n'});return module.exports});System.registerDynamic('components/richTextEditor/linkHandler.ko',[],true,function($__require,exports,module){var define,global=this||self,GLOBAL=global;module.exports=function injectTemplate(tpl){var s=document.createElement('script');s.id=tpl.id;s.innerHTML=window.TR?TR.HTML(tpl.content):tpl.content;s.type='text/html';document.head.appendChild(s)}({'id':'linkHandler','content':'<div class="linkhandler--frame">\n    <ul class="linkhandler--commandList">\n        <li class="linkhandler--command" data-bind="text: text.goto"></li>\n        <li class="linkhandler--command"><a class="linkhandler--link" target="_blank" data-bind="text: linkUrl, attr: { href: linkUrl }, click: closeAfter"></a></li>\n        <!-- ko if: showDelete -->\n        <span class="linkhandler--spacer" data-i18n="">&ndash;</span>\n        <li class="linkhandler--command"><a data-bind="text: text.edit, click: openEditableDialog.bind($data, $parents)"></a></li>\n        <span class="linkhandler--spacer" data-i18n="">&ndash;</span>\n        <li class="linkhandler--command"><a data-bind="click: deleteLink, text: text.delete"></a></li>\n        <!-- /ko -->\n    </ul>\n</div>\n'});return module.exports});System.registerDynamic('components/richTextEditor/colorPalette.ko',[],true,function($__require,exports,module){var define,global=this||self,GLOBAL=global;module.exports=function injectTemplate(tpl){var s=document.createElement('script');s.id=tpl.id;s.innerHTML=window.TR?TR.HTML(tpl.content):tpl.content;s.type='text/html';document.head.appendChild(s)}({'id':'colorPalette','content':'<div data-bind="unselectable: true, attr: { \'data-title\': tooltip }" class="rte-toolbar--button-container">\n    <a class="rte-toolbar--button" data-bind="dropdownTemplate: { template: \'RteColorPaletteTemplate\', openState: visible}" rel="color"><i data-bind="css: icon"></i></a>\n</div>\n<script id="RteColorPaletteTemplate" type="text/html">\n    <div class="rte-toolbar--colorPalette rte-toolbar--popupTemplate" data-bind="foreach: colors, keepInsideScreen: visible">\n        <div class="rte-toolbar--colorSample" data-bind="click: $parent.select, style: { backgroundColor: $data }, attr: { \'data-title\': $data }"></div>\n    </div>\n</script>\n'});return module.exports});(function(){var define=System.amdDefine;define('components/richTextEditor/rte.js',['node_modules/knockout/build/output/knockout-latest.debug.js','3rdparty/squire.js','components/richTextEditor/RteToolbar.js','components/richTextEditor/ImageHandler.js','components/richTextEditor/LinkHandler.js','common/util.js','3rdparty/knockout.afterRender.js','components/richTextEditor/rteditor.ko','components/richTextEditor/fontDropdown.ko','components/richTextEditor/fontSizeDropdown.ko','components/richTextEditor/linkDialog.ko','components/richTextEditor/imageDialog.ko','components/richTextEditor/rteToolbarButton.ko','components/richTextEditor/imageHandler.ko','components/richTextEditor/linkHandler.ko','components/richTextEditor/colorPalette.ko'],function(ko,Squire,RteToolbar,ImageHandler,LinkHandler,util){function getScrollHandlerForMenuDialog(itemToReposition){var isUpdating=false;return function(){if(!itemToReposition.visible()||isUpdating){return}isUpdating=true;requestAnimationFrame(function(){itemToReposition.reposition();isUpdating=false})}}function RichTextEditor(params){this.options=params.config||{};this.value=params.data||params.config.data||ko.observable();this.value(0);this.options.disabled=ko.observable(false);this.rteToolbar=new RteToolbar(this.options);this.imageHandler=this.options.images?new ImageHandler(this.options):null;this.linkHandler=this.rteToolbar.buttons.link?new LinkHandler(this.options):null;this.disabled=this.options.disabled;this.afterRender=params.afterRender;this.url=params.url||'/rte.html'}RichTextEditor.prototype.setAccessFunctions=function(){var that=this;that.value.getContent=function(){return that.editor.getHTML()};that.value.setContent=function(content){that.editor.setHTML(content)};that.value.setFocus=function(bottomPost){that.editor.focus();if(bottomPost){var selectElm=that.editorDocument.getElementById('oneComWebmail-startSelection');var scrollHeight=Math.max(selectElm.offsetTop+selectElm.offsetHeight-that.editorFrame.contentWindow.innerHeight,0);that.editorFrame.contentWindow.scrollTo(0,scrollHeight);var range=that.editor.getSelection();range.selectNode(selectElm);range.deleteContents();that.editor.setSelection(range)}else{that.editor.moveCursorToStart()}};that.value.setStyles=function(styles){var sheet=that.editorDocument.createElement('STYLE');sheet.appendChild(that.editorDocument.createTextNode(styles));that.editorDocument.head.appendChild(sheet)};that.value.getBody=function(){return that.editorDocument.body};that.value.getFrameElement=function(){return that.editorFrame};that.value.getToolbar=function(){return that.rteToolbar};that.value.ignoreNextChange=function(){that.editor._ignoreChange=true};ko.utils.domNodeDisposal.addDisposeCallback(that.editorFrame,function(){delete that.value.getContent;delete that.value.setContent;delete that.value.setFocus;delete that.value.setStyles;delete that.value.getBody;delete that.value.getFrameElement;delete that.value.getToolbar;delete that.value.ignoreNextChange})};RichTextEditor.prototype.setupImageHandler=function(){var that=this;that.imageHandler.setEditor(that.editor,that.editorFrame);ko.utils.domNodeDisposal.addDisposeCallback(that.editorFrame,function(){that.imageHandler.dispose()});try{that.editorDocument.execCommand('enableObjectResizing',false,false)}catch(e){}that.rteToolbar.setupImageHandler(that.imageHandler);that.editorFrame.contentWindow.addEventListener('scroll',getScrollHandlerForMenuDialog(that.imageHandler))};RichTextEditor.prototype.setupLinkHandler=function(){var that=this;that.linkHandler.setEditor(that.editor,that.editorFrame);ko.utils.domNodeDisposal.addDisposeCallback(that.editorFrame,function(){that.linkHandler.dispose()});that.rteToolbar.setupLinkHandler(that.linkHandler);that.editorFrame.contentWindow.addEventListener('scroll',getScrollHandlerForMenuDialog(that.linkHandler))};RichTextEditor.prototype.setupDragAndDrop=function(){var that=this;var uploadImagesHandler=that.options.images&&that.options.images.upload;var uploadFilesHandler=that.options.files&&that.options.files.upload;function dropFileHandler(e){e.preventDefault();var droppedInlineFiles=e.dataTransfer.files,droppedFiles=[],droppedImages=[];util.distinguishFileFromDirectory(droppedInlineFiles,function(files){files.forEach(function(file){if(util.isFileAnImage(file)&&uploadImagesHandler){droppedImages.push(file)}else if(uploadFilesHandler){droppedFiles.push(file)}});if(uploadImagesHandler&&droppedImages.length>0){uploadImagesHandler(droppedImages,function(urlOrData){that.rteToolbar.insertImage(urlOrData)})}if(uploadFilesHandler){droppedFiles.forEach(uploadFilesHandler)}})}if(uploadImagesHandler||uploadFilesHandler){that.editorDocument.addEventListener('drop',dropFileHandler);ko.utils.domNodeDisposal.addDisposeCallback(that.editorFrame,function(){that.editorDocument.removeEventListener('drop',dropFileHandler)})}};RichTextEditor.prototype.createEditor=function(element,callback){var that=this;that.editorFrame=document.createElement('iframe');that.editorFrame.setAttribute('src',that.url);that.editorFrame.setAttribute('style','border: 0 none transparent; padding: 0px; background-color: white;');that.editorFrame.addEventListener('load',function(){that.editorDocument=that.editorFrame.contentDocument;that.editor=new Squire(that.editorDocument);that.editorFrame.contentWindow.editor=that.editor;callback()});element.insertBefore(that.editorFrame,element.firstChild);that.editorFrame.contentWindow.addEventListener('click',function(){if(that.editor){that.editor.focus()}})};RichTextEditor.prototype.setup=function(element){var that=this;function incrementValue(){that.value(that.value()+1)}that.createEditor(element,function(){that.editor.addEventListener('input',incrementValue);that.editor.addEventListener('undoStateChange',incrementValue);that.rteToolbar.setEditor(that.editor);that.setAccessFunctions();if(that.options.styles){that.value.setStyles(that.options.styles)}var keyhandlers=that.options.keyhandlers||{};Object.keys(keyhandlers).forEach(function(key){that.editor.setKeyHandler(key,that.options.keyhandlers[key])});if(that.options.images){that.setupImageHandler()}if(that.rteToolbar.buttons.link){that.setupLinkHandler()}that.setupDragAndDrop();if(typeof that.afterRender==='function'){that.afterRender(element)}})};ko.components.register('rte',{template:{element:'rteditor'},viewModel:RichTextEditor})})}());(function(){var define=System.amdDefine;define('webmail/composer/Composer.js',['node_modules/jquery/dist/jquery.js','node_modules/knockout/build/output/knockout-latest.debug.js','3rdparty/mario.js','3rdparty/moment.js','3rdparty/Failboat.js','webmail/actions/SaveMailAction.js','webmail/actions/SendMailAction.js','webmail/actions/MoveMailsAction.js','webmail/actions/SaveAutocompleteAction.js','common/actions/QueryAutocompleteAction.js','webmail/actions/LoadMailPartsAction.js','webmail/composer/AttachmentView.js','webmail/model/mailparts/Attachment.js','common/util.js','common/model/Flag.js','3rdparty/htmlEmailToText.js','3rdparty/LocalStorage.js','webmail/composer/RecipientInput.js','webmail/model/Recipient.js','webmail/composer/OutgoingMail.js','webmail/mailView/ContactCard.js','webmail/model/mailparts/TextPart.js','webmail/model/mailparts/InlineImagePart.js','common/TraceLogging.js','common/KeyHandler.js','3rdparty/signals.js','components/richTextEditor/rte.js','components/inPlaceEditor/inPlaceEditor.js','3rdparty/knockout-toolbar/toolbar.js','3rdparty/knockout-extensions/knockout.editables.js'],function($,ko,mario,moment,Failboat,SaveMailAction,SendMailAction,MoveMailsAction,SaveAutocompleteAction,QueryAutocompleteAction,LoadMailPartsAction,AttachmentView,Attachment,util,Flag,htmlEmailToText,LocalStorage,RecipientInput,Recipient,OutgoingMail,ContactCard,TextPart,InlineImagePart,TraceLogging,getKeyHandler,signals){function Composer(state,errorHandler,actionExecutor){var that=this;this.type=null;that.actionExecutor=actionExecutor;that.draftBeingEdited=ko.observable(null);that.notification=state.notification;that.plainTextMode=state.preferences.plainTextMode();if(that.plainTextMode){that.text=ko.observable('')}else{that.editor=ko.observable(0);that.styles=null}that.focusEditor=ko.observable(false);var contactsList=ko.computed(function(){return state.contacts.all().concat(state.contacts.groups())});that.newQuery={to:ko.observable(''),cc:ko.observable(''),bcc:ko.observable('')};that.allNewQueries=ko.pureComputed(function(){return that.newQuery.to()+that.newQuery.cc()+that.newQuery.bcc()});that.editQuery={to:ko.observable(''),cc:ko.observable(''),bcc:ko.observable('')};that.allEditQueries=ko.pureComputed(function(){return that.editQuery.to()+that.editQuery.cc()+that.editQuery.bcc()});that.recipientQuery=ko.computed(function(){return(that.allNewQueries()+that.allEditQueries()).toLowerCase()});that.recipientQueryThrottled=ko.computed(function(){return that.recipientQuery()}).extend({rateLimit:100});that.recipientSource=ko.observableArray();var queriedContacts=[];var queriedGroups=[];that.subscriptions=[];var prevQuery='';that.subscriptions.push(that.recipientQuery.subscribe(function(query){if(!query||query.indexOf(prevQuery)===-1){that.recipientSource([])}}));that.subscriptions.push(that.recipientQueryThrottled.subscribe(function(query){if(!query){return}var queryRegexps=query.split(' ').filter(function(part){return part}).map(function(part){return new RegExp('(?:^|\\s|@)'+util.escapeRegExp(part),'i')});var recipients=[],groups=[];contactsList().forEach(function(contact){if(queryRegexps.every(function(query){return query.test(RecipientInput.prototype.format(contact))})){if(contact instanceof Recipient){recipients.push(contact)}else{groups.push(contact)}}});queriedContacts=recipients.sort();queriedGroups=groups.sort();if(!query){return}that.actionExecutor.enqueue(new QueryAutocompleteAction({query:query.trim(),recipients:that.recipientSource}),function(err,result){if(err){that.handleError(err)}var i;for(i=0;that.recipientSource().length<8;i+=1){var contact=queriedContacts[i];if(!contact){break}var alreadyFound=that.recipientSource().filter(function(item){return item===contact||(item.displayName||'')===(contact.displayName||'')&&item.displayEmail===contact.displayEmail});if(!alreadyFound.length){that.recipientSource.push(contact)}}var matchGroup=queriedGroups.filter(function(group){return group.name.toLowerCase()===query.toLowerCase()})[0];if(matchGroup){that.recipientSource.unshift(matchGroup);queriedGroups.splice(queriedGroups.indexOf(matchGroup),1)}for(i=0;i<=3;i+=1){var group=queriedGroups[i];if(!group){break}that.recipientSource.push(group)}})}));that.setFocusInsideComposer=ko.observable(false);that.restoreFocusToComposer=function(data,event){if(event&&event.target){that.setFocusInsideComposer(true);$(event.srcElement).focus()}};var isContactInMyContactsFnc=function(email){return!!that.state.contacts.byEmail()[email]};var contactCardFactoryFcn=function(recipient,isInMyContacts){var contactCard=new ContactCard(state.user(),state.contacts.byEmail(),recipient,isInMyContacts);contactCard.setState(state);return contactCard};that.to=ko.observableArray();var translatedTo=TR('mail.To','To');that.toView=new RecipientInput('to',that.recipientSource,that.newQuery.to,that.to,that.editQuery.to,isContactInMyContactsFnc,contactCardFactoryFcn,translatedTo);that.cc=ko.observableArray();var translatedCc=TR('mail.composer.Cc','Cc');that.ccView=new RecipientInput('cc',that.recipientSource,that.newQuery.cc,that.cc,that.editQuery.cc,isContactInMyContactsFnc,contactCardFactoryFcn,translatedCc);that.ccView.visible=ko.observable(false);that.ccView.show=function(){that.ccView.visible(true);that.ccView.focusInput()};that.bcc=ko.observableArray();var translatedBcc=TR('mail.composer.Bcc','Bcc');that.bccView=new RecipientInput('bcc',that.recipientSource,that.newQuery.bcc,that.bcc,that.editQuery.bcc,isContactInMyContactsFnc,contactCardFactoryFcn,translatedBcc);that.bccView.visible=ko.observable(false);that.bccView.show=function(){that.bccView.visible(true);that.bccView.focusInput()};that.subject=ko.observable();that.focusSubject=ko.observable(false);that.headers={};that.flags=[];that.state=state;that.attachmentView=new AttachmentView;that.viewReset=new signals.Signal;that.readyForEditing=ko.observable(false);that.readyForSending=ko.pureComputed(function(){return!that.sendingMail()&&that.readyForEditing()&&!that.attachmentView.attachmentsTooLarge()});that.editableFields={to:that.to,cc:that.cc,bcc:that.bcc,subject:that.subject,attachmentView:that.attachmentView.attachments};if(that.plainTextMode){that.editableFields.text=that.text}else{that.editableFields.editor=that.editor}that.sendingMail=ko.observable(false);that.failedSending=ko.observable(false);that.failedSaving=ko.observable(false);that.failed=ko.pureComputed(function(){return that.failedSaving()||that.failedSending()});ko.editable(that.editableFields);that.readyToSave=ko.pureComputed(function(){return that.readyForEditing()&&!that.sendingMail()&&that.editableFields.hasChanges()});that.loadingOverlayVisible=ko.observable(false);that.newInlineImage=[];that.attach=function(input){that.attachmentView.attach(input)};var keyhandler=getKeyHandler();var keyhandlers={'tab':function(_,event){var toolbar=that.editor.getToolbar();var listSelected=toolbar.isSelected('olist')||toolbar.isSelected('ulist');if(listSelected){toolbar.enact('indent')}event.preventDefault()},'shift-tab':function(_,event){var toolbar=that.editor.getToolbar();var listSelected=toolbar.isSelected('olist')||toolbar.isSelected('ulist');if(listSelected){toolbar.enact('outdent');event.preventDefault()}else{keyhandler.trigger('shift+tab');that.editor.getFrameElement().blur()}}};var ctrlKey=mario.macos?'meta':'ctrl';keyhandlers[ctrlKey+'-enter']=function(_,event){keyhandler.trigger('mod+return');event.preventDefault()};that.rteConfig={data:that.editor,images:{accept:['disk','url'],upload:that.getInlineImageUploader(),multiple:true},files:{upload:that.attachFile()},buttonSet:[{id:'bold',tooltip:TR('mail.composer.Bold','Bold')},{id:'italic',tooltip:TR('mail.composer.Italic','Italic')},{id:'underline',tooltip:TR('mail.composer.Underline','Underline')},{id:'font',tooltip:TR('mail.composer.Font','Font')},{id:'font-size',tooltip:TR('mail.composer.FontSize','Font size')},{id:'text-color',tooltip:TR('mail.composer.TextColor','Text color')},{id:'background-color',tooltip:TR('mail.composer.HightlightColor','Highlight color')},{id:'link',tooltip:TR('mail.composer.Link','Link')},{id:'image',tooltip:TR('mail.composer.Image','Image')},{id:'olist',tooltip:TR('mail.composer.NumberedList','Numbered list')},{id:'ulist',tooltip:TR('mail.composer.BulletedList','Bulleted list')},{id:'outdent',tooltip:TR('mail.composer.IndentLess','Indent less')},{id:'indent',tooltip:TR('mail.composer.IndentMore','Indent more')},{id:'justify-left',tooltip:TR('mail.composer.AlignLeft','Align left')},{id:'justify-center',tooltip:TR('mail.composer.AlignCenter','Align center')},{id:'justify-right',tooltip:TR('mail.composer.AlignRight','Align right')},{id:'justify-full',tooltip:TR('mail.composer.Justify','Justify')},{id:'remove-format',tooltip:TR('mail.composer.RemoveFormatting','Remove formatting')}],dialogText:{link:{title:TR('mail.composer.LinkDialogLabel','Link to:'),invalid:TR('mail.composer.LinkDialogInvalidWarning','Invalid link address'),save:TR('mail.composer.LinkDialogSave','Save'),close:TR('mail.composer.LinkDialogClose','Close'),textToDisplay:TR('mail.composer.LinkDialogTextToDisplay','Text to display:')},image:{title:TR('mail.composer.ImageDialogInsertImageFrom','Insert image from:'),url:TR('mail.composer.ImageDialogWeb','Web'),disk:TR('mail.composer.ImageDialogComputer','Computer'),selectFile:TR('mail.composer.SelectImage','Select Image'),save:TR('mail.composer.ImageDialogInsert','Insert'),close:TR('mail.composer.ImageDialogClose','Close')}},imageHandlerText:{small:TR('mail.composer.ImageHandler.small','Small'),medium:TR('mail.composer.ImageHandler.medium','Medium'),large:TR('mail.composer.ImageHandler.large','Large'),original:TR('mail.composer.ImageHandler.original','Original'),'delete':TR('mail.composer.ImageHandler.delete','Delete')},linkHandlerText:{'goto':TR('mail.composer.LinkHandler.GoTo','Go to'),'delete':TR('mail.composer.LinkHandler.delete','Delete'),'edit':TR('mail.composer.LinkHandler.edit','Edit')},keyhandlers:keyhandlers};that.errorHandler=errorHandler.extend({'404 BADURL':function(err){this.showWarning(TR('mail.ErrorInlineImageNoLongerExists','One or more of the images that your email refers to no longer exist'));var failedPart=err.response.errorData&&err.response.errorData.failedPart;if(failedPart){that.forEachBodyImgSrcMatching(failedPart.folderName.replace(/;.*/,''),failedPart.uid,failedPart.section.replace(/\.MIME$/,''),function(imgElem){$(imgElem).attr('src','#NonExisting');return true})}}});that.errorHandler.onErrorRouted=function(err,route){if(route!=='404 BADURL'){if(err.while==='sending'){that.failedSaving(true);that.state.signals.queueMailForSendingFailed.dispatch(that)}}};var updateInlineSizeThrottle;if(!that.plainTextMode){that.inlineImageTotalSize=that.attachmentView.inlineSize;that.updateInlineTotalSize=function(){clearTimeout(updateInlineSizeThrottle);updateInlineSizeThrottle=setTimeout(function(){var totalSize=0;var knownUrls=[];that.forEachImgInBodyMatching(function(img){return knownUrls.indexOf(img.src)===-1},function(img){var matchSize=img.src.match(/\&size=(\d+)/);var size=matchSize&&parseInt(matchSize[1])||0;totalSize+=size;knownUrls.push(img.src)});that.inlineImageTotalSize(totalSize)},200)};that.subscriptions.push(that.editor.subscribe(that.updateInlineTotalSize))}var storage=new LocalStorage(that.state.user());that.saveToLocalStorage=function(){var composerData={};['to','cc','bcc'].forEach(function(field){composerData[field]=that[field]().map(function(recipient){return recipient.toString()})});composerData.subject=that.subject();if(that.draftBeingEdited()){composerData.draftUid=that.draftBeingEdited().uid}if(that.plainTextMode){composerData.body=that.text()}else{composerData.body=that.getHtml()}storage.setJSON('composer',composerData)};that.restoreFromLocalStorage=function(){var composerData=storage.getJSON('composer');if(composerData){if(composerData.text){composerData.body=composerData.text}if(composerData.html){composerData.body=composerData.html}}if(!composerData||!composerData.body||that.draftBeingEdited()&&composerData.draftUid&&that.draftBeingEdited().uid!==composerData.draftUid){return}['to','cc','bcc'].forEach(function(field){if(composerData[field]){that[field](composerData[field].map(function(recipientString){return Recipient.from(recipientString)}))}else{that[field]([])}});that.subject(composerData.subject);if(that.plainTextMode){that.text(composerData.body)}else{if(that.editor.setContent){var content=that.editor.getContent();if(content!==composerData.body){that.editor.setContent(composerData.body);that.editor(that.editor()+1)}}else{that.html=composerData.body}}that.clearLocalStorage()};that.clearLocalStorage=function(){storage.removeItem('composer')};that.mainButtons=[{label:TR('mail.composer.Send','Send'),icon:'send',classes:'framed',track:['composer','send mail','click'],disabled:ko.pureComputed(function(){return!that.readyForSending()}),handler:that.sendMail.bind(that)}];that.minorButtons=[{label:TR('mail.composer.SaveAsDraft','Save draft'),icon:'save',track:['composer','save draft'],disabled:ko.pureComputed(function(){return!that.readyToSave()}),handler:that.saveMail.bind(that,false,null)},{label:TR('mail.composer.DeleteDraft','Delete draft'),icon:'delete',track:['composer','discard mail'],handler:that.discardMail.bind(that)}]}function formatContactsAsHtml(contacts){return contacts.map(function(contact){return util.htmlEncode(contact.toString())}).join(', ')}function createRecipientHeader(mail){var hasReplyTo=mail.replyTo().length!==0;return hasReplyTo?mail.replyTo():mail.from()}function createReplyHeader(mail){var contactString=formatContactsAsHtml(mail.from());var header=mail.date()?TR.PAT('mail.ReplyOnDateAuthorWrote','On {0}, {1} wrote:')(inter.renderDate(mail.date(),'longDateTime'),contactString):TR.PAT('mail.ReplyAuthorWrote','{0} wrote:')(contactString);return'<div>'+header+'</div>'}function createForwardHeader(mail){var htmlLines=['---------- '+TR('mail.ForwardedMessage','Forwarded message')+' ----------'];htmlLines.push(TR('mail.ForwardFrom','From:')+' '+formatContactsAsHtml(mail.from()));if(mail.date()){htmlLines.push(TR('mail.ForwardDate','Date:')+' '+util.htmlEncode(inter.renderDate(mail.date(),'longDateTime')))}htmlLines.push(TR('mail.ForwardSubject','Subject:')+' '+util.htmlEncode(mail.subject()));if(mail.to().length>0){htmlLines.push(TR('mail.ForwardTo','To:')+' '+formatContactsAsHtml(mail.to()))}if(mail.cc().length!==0){htmlLines.push(TR('mail.ForwardCc','Cc:')+' '+formatContactsAsHtml(mail.cc()))}return'<br><br><p>'+htmlLines.join('<br>')+'</p>'}function getMailHeaderStyles(){var stylesFromHeader='';$('.mailFrame').find('style').each(function(index,stylesheet){stylesFromHeader+=$(stylesheet).html()});return stylesFromHeader}function quoted(html){return'<blockquote type="cite">'+(html||'')+'</blockquote>'}Composer.prototype.init=function(element){var that=this;that.updateDraftState=ko.computed(function(){var draft=that.draftBeingEdited();if(draft){draft.failedSaving(that.failedSaving());draft.failedSending(that.failedSending())}})};Composer.prototype.initEditor=function(){var that=this;if(!that.plainTextMode){var keyhandler=getKeyHandler();that.editor.getBody().addEventListener('click',function(){that.setFocusInsideComposer(true);keyhandler.focusDomain(keyhandler.findDomainContaining(that.editor.getFrameElement()),true)},false);that.styles=that.styles||'';that.editor.setStyles(that.styles);if(that.html){that.editor.setContent(that.html);that.updateInlineTotalSize()}if(that.focusEditor()){getKeyHandler().focusDomain('composer');var mailPrefs=that.state.preferences.mail();var postOnBottom=mailPrefs&&mailPrefs.bottomPost;if(typeof postOnBottom==='string'){postOnBottom=postOnBottom.toLowerCase()==='true'}that.editor.setFocus(postOnBottom)}}that.focusEditor(false);that.beginEdit();if(typeof that.afterInit==='function'){that.afterInit();delete that.afterInit}};Composer.prototype.initPlainText=function(){this.beginEdit();if(typeof this.afterInit==='function'){this.afterInit();delete this.afterInit}};function replySubject(subject){if(/^Re:/i.test(subject)){return subject}else{return'Re: '+subject}}function getMailContent(mail){var content='';mail.inlineParts().forEach(function(part){if(part instanceof TextPart&&part.mailPartTooBig()===false){content+=part.htmlContent()}if(part instanceof InlineImagePart){content+='<img src="'+part.urlWithContentId().replace(/&/g,'&amp;').replace(/"/g,'&quot;')+'">'}});return content}Composer.registerKeys=function(){var keyhandler=getKeyHandler();var fields=['to','cc','bcc','subject'];keyhandler.register('composer','tab',function(){var type=document.activeElement.nodeName;if(type==='IFRAME'){document.activeElement.blur();keyhandler.focusDomain('sidebar')}else{var id=document.activeElement.id;if(id==='subject'){$('.rte-frame iframe')[0].focus();$('.rte-frame iframe')[0].contentWindow.focus();$('body',$('.rte-frame iframe').contents()).focus()}else{var index=fields.indexOf(id);if(index===-1){keyhandler.focusDomain('sidebar')}else{var nextField;while(!nextField){index+=1;nextField=$('#'+fields[index])[0]}if(nextField.firstChild&&nextField.firstChild.nodeName==='DIV'){$(nextField).find('input')[0].focus()}nextField.focus()}}}return false});keyhandler.register('composer','shift+tab',function(){var id=document.activeElement.id;if(id==='to'){if(keyhandler.listDomains().indexOf('listPanel')!==-1){keyhandler.focusDomain('listPanel')}else{keyhandler.focusDomain('sidebar')}}else{if(document.activeElement.nodeName==='IFRAME'){setTimeout(function(){$('#subject').find('input')[0].focus()},1)}else{var index=fields.indexOf(id);if(index===-1){keyhandler.focusDomain('listPanel')}else{var lastField;while(!lastField){index-=1;lastField=$('#'+fields[index])[0]}lastField.focus()}}}return false});keyhandler.register('composer','mod+a',function(){var iframe=document.querySelector('iframe');var editor=iframe&&iframe.contentWindow.editor;if(editor){var doc=editor.getDocument();var body=doc.body;var range=doc.createRange();range.setStartBefore(body.firstChild);range.setEndAfter(body.lastChild);editor.setSelection(range);editor.focus()}})};Composer.reply=function(state,errorHandler,actionExecutor,mail,all){var composer=new Composer(state,errorHandler,actionExecutor),html=getMailContent(mail),subject=replySubject(mail.subject());composer.type='reply';composer.subject(subject);var sender=mail.replyTo().concat(mail.from());var fromMe=state.containsMe(sender);var myEmails=state.myEmails();var hasReplyTo=mail.replyTo().length!==0;var hasMyReplyTo=mail.replyTo().some(function(recipient){return myEmails.indexOf(recipient.email)!==-1});if(fromMe&&(!hasReplyTo||hasMyReplyTo)){composer.to(mail.to());if(all){composer.cc(mail.cc())}}else{composer.to(createRecipientHeader(mail));if(all){var excludeFromCC=[].concat(myEmails);(composer.to()||[]).forEach(function(contact){excludeFromCC.push(contact.email)});(mail.from()||[]).forEach(function(contact){excludeFromCC.push(contact.email)});var ccRecipients=mail.to().concat(mail.cc()).filter(function(contact){var result=!excludeFromCC.some(function(email){return contact.hasEmail(email)});return result});composer.cc(util.unique(ccRecipients,function(contact){return contact.email}))}}if(composer.cc().length!==0){composer.ccView.visible(true)}var folder=mail.folder();composer.headers.draftInfo={type:'reply',folderName:folder.id(),uidValidity:folder.uidvalidity(),uid:mail.uid};if(mail.headers.References){composer.headers.references=mail.headers.References.concat([mail.messageId])}else if(mail.inReplyTo){composer.headers.references=[mail.inReplyTo,mail.messageId]}else if(mail.messageId){composer.headers.references=[mail.messageId]}if(mail.messageId){composer.headers.inReplyTo=mail.messageId}composer.styles=getMailHeaderStyles();if(composer.plainTextMode){composer.text(composer.getSignature()+'\n\n'+htmlEmailToText.htmlEmailToText(createReplyHeader(mail)+quoted(html)))}else{var mailPrefs=composer.state.preferences.mail();if(mailPrefs){var bottomPost=mailPrefs.bottomPost;if(typeof bottomPost==='string'){bottomPost=bottomPost.toLowerCase()==='true'}if(bottomPost){composer.html=createReplyHeader(mail)+quoted(html)+'<div id="oneComWebmail-startSelection"></div>'+(composer.getSignature()||'<div></div>')}else{composer.html=composer.getSignature()+'<br><br>'+createReplyHeader(mail)+quoted(html)}}}composer.focusEditor(true);return composer};Composer.forward=function(state,errorHandler,actionExecutor,mail){var composer=new Composer(state,errorHandler,actionExecutor),html=getMailContent(mail);html=html.replace(/<div class="oneComWebmail-html oneComWebmail-mail"><div class="oneComWebmail-body">(.*)\s*<\/div><\/div>/g,'$1');composer.type='forward';composer.subject('Fwd: '+mail.subject());composer.styles=getMailHeaderStyles();composer.attachmentView.addExistingAttachments(mail.attachments());var folder=mail.folder();composer.headers.draftInfo={type:'forward',folderName:folder.id(),uidValidity:folder.uidvalidity(),uid:mail.uid};if(composer.plainTextMode){composer.text(composer.getSignature()+htmlEmailToText.htmlEmailToText(createForwardHeader(mail)+(html||'')))}else{composer.html=composer.getSignature()+createForwardHeader(mail)+(html||'')}return composer};Composer.editAsNew=function(state,errorHandler,actionExecutor,mail){var composer=new Composer(state,errorHandler,actionExecutor),html=getMailContent(mail);var copyRecipients=function(recipients){var out=[];recipients.forEach(function(recipient){var recip=new Recipient(recipient.toArray());out.push(recip)});return out};html=html.replace(/<div class="oneComWebmail-html oneComWebmail-mail"><div class="oneComWebmail-body">(.*)\s*<\/div><\/div>/g,'$1');composer.type='new';composer.to(copyRecipients(mail.to()));composer.cc(copyRecipients(mail.cc()));composer.bcc(copyRecipients(mail.bcc()));composer.subject(mail.subject());composer.styles=getMailHeaderStyles();if(composer.cc().length!==0){composer.ccView.visible(true)}if(composer.bcc().length!==0){composer.bccView.visible(true)}composer.attachmentView.addExistingAttachments(mail.attachments());if(composer.plainTextMode){composer.text(htmlEmailToText.htmlEmailToText(html||''))}else{composer.html=html||''}return composer};Composer.edit=function(state,errorHandler,actionExecutor,mail,callback){var composer=new Composer(state,errorHandler,actionExecutor);composer.type='draft';composer.draftBeingEdited(mail);composer.to(mail.to());composer.cc(mail.cc());composer.bcc(mail.bcc());composer.subject(mail.subject());composer.attachmentView.addExistingAttachments(mail.attachments());if(composer.cc().length!==0){composer.ccView.visible(true)}if(composer.bcc().length!==0){composer.bccView.visible(true)}composer.headers.draftInfo=mail.headers['X-OneCom-Draft-Info'];composer.headers.references=mail.headers.References;composer.headers.inReplyTo=mail.inReplyTo;composer.loadingOverlayVisible(true);actionExecutor.enqueue(new LoadMailPartsAction({mail:mail}),function(err){if(err){composer.handleError(err)}if(!composer.plainTextMode&&composer.editor.setContent){composer.editor.setContent(getMailContent(mail)||'');composer.updateInlineTotalSize()}else{composer.html=getMailContent(mail)||''}if(composer.plainTextMode){composer.text(htmlEmailToText.htmlEmailToText(composer.html))}if(typeof callback==='function'){callback()}composer.loadingOverlayVisible(false)});return composer};Composer.prototype.updateViewWithDraft=function(oldUid,newDraft,data,callback){var that=this;that.draftBeingEdited(newDraft);var loadingImages=[];function checkCallback(){if(!(callback instanceof Function)){return}if(loadingImages.length===0||loadingImages.every(function(ref){return ref.loaded})){callback()}}function storeImageReference(imgElem){var imgReference={loaded:false};loadingImages.push(imgReference);$(imgElem).on('load error',function(){imgReference.loaded=true;checkCallback();$(imgElem).off('load error')});if(that.editor.ignoreNextChange){that.editor.ignoreNextChange()}}function getSizeByCid(cid){var relatedParts;data.mailInfo.parts.some(function(part){relatedParts=part.relatedParts;return relatedParts});if(relatedParts){var part=relatedParts.filter(function(part){return part.contentId===cid})[0];if(part&&part.size){return part.size}}return 0}function getRelatedPartUrlFromCid(cid){return newDraft.getMailUrl()+'/'+data.partMap[cid][0].id+'?contentId='+cid+'&size='+getSizeByCid(cid)}if(!this.plainTextMode){if(oldUid){var folderId=newDraft.folder().id();that.forEachBodyImgSrcMatching(newDraft.folder().id(),oldUid,function(img){var src=img.src,matchContentId=src&&src.match(/\?(setContentId|contentId)=([^&]+)/),contentId=matchContentId&&matchContentId[2];if(contentId){var contentIdEnc=decodeURIComponent(contentId),part=data.partMap[contentIdEnc]&&data.partMap[contentIdEnc].pop();if(part){var replacement='/'+folderId+'/'+newDraft.folder().uidvalidity()+'/'+data.uid+'/'+part.id,replaceRegex=new RegExp(util.escapeRegExp('/'+folderId+'/')+'(\\d+)'+util.escapeRegExp('/'+oldUid+'/')+'\\d+[.\\d]+');src=src.replace(replaceRegex,replacement);if(matchContentId[1]==='setContentId'){src=src.replace('setContentId=','contentId=')}storeImageReference(img);img.src=src;return true}}})}else{that.forEachImgInBodyMatching(function(imgElem){return imgElem.src&&/api\/.*\/preferences\/\d+\/mail\/photo\/[-A-Z0-9]+$/.test(imgElem.src)},function(imgElem){var cid=imgElem.src.match(/\/([-A-Z0-9]+$)/)[1];if(cid&&data.partMap[cid]&&data.partMap[cid].length>0){storeImageReference(imgElem);imgElem.src=getRelatedPartUrlFromCid(cid);return true}})}that.forEachImgInBodyMatching(function(imgElem){return!!imgElem.getAttribute('data-cid')},function(imgElem){var cid=imgElem.getAttribute('data-cid'),newUrl='';if(data.partMap[cid]&&data.partMap[cid].length>0){newUrl=getRelatedPartUrlFromCid(cid)}storeImageReference(imgElem);imgElem.src=newUrl;imgElem.removeAttribute('data-cid');return true})}that.attachmentView.updateAttachments(data.partMap,newDraft);that.newInlineImage=[];checkCallback()};Composer.prototype.clearSelection=function(element){window.getSelection().removeAllRanges()};function createRecipientsFromEmails(emailString){var addresses=emailString.split(/,/),recipients=[],displayNamePart='';addresses.forEach(function(address){var parts=address.trim().match(/^(?:(.*)\s<)?(\S+@\S+?)>?$/);if(parts){if(parts[1]&&displayNamePart){parts[1]=displayNamePart+parts[1]}displayNamePart='';recipients.push(new Recipient({email:parts[2],displayName:parts[1]}))}else{displayNamePart=address+', '+displayNamePart}});return recipients}Composer.compose=function(state,errorHandler,actionExecutor,options){var composer=new Composer(state,errorHandler,actionExecutor);composer.type='new';composer.html='';if(options&&typeof options==='object'){composer.afterInit=function(){['to','cc','bcc'].filter(function(field){return options[field]}).forEach(function(field){var recipientsData=options[field];var recipients=typeof recipientsData==='string'?createRecipientsFromEmails(recipientsData):recipientsData.map(function(data){return new Recipient(data)});composer[field](recipients)});if(composer.cc().length>0){composer.ccView.visible(true)}if(composer.bcc().length>0){composer.bccView.visible(true)}composer.subject(options.subject);composer.html=options.body&&util.htmlEncode(options.body)||'';if(composer.plainTextMode){composer.text(htmlEmailToText.htmlEmailToText(composer.html)+composer.getSignature())}else{composer.editor.setContent(composer.html+composer.getSignature())}}}if(composer.plainTextMode){composer.text(htmlEmailToText.htmlEmailToText(composer.html)+composer.getSignature())}else{composer.html+=composer.getSignature()}if(composer.to().length>0){composer.focusSubject(true)}else{composer.toView.focusInput()}return composer};Composer.prototype.resetRecipients=function(){var that=this;that.toView.reset();that.ccView.reset();that.ccView.visible(false);that.bccView.visible(false);that.bccView.reset()};Composer.prototype.startAutoSaveTimer=function(){var that=this;clearInterval(this.autoSaveTimer);this.autoSaveTimer=setInterval(function(){that.saveChanges({autoSave:true})},60000)};Composer.prototype.restartAutoSaveTimerAfterError=function(){var that=this;this.stopAutoSaveTimer();clearTimeout(this.restartAutoSaveTimerAfterErrorTimer);this.restartAutoSaveTimerAfterErrorTimer=setTimeout(function(){that.saveChanges({autoSave:true});that.startAutoSaveTimer()},30000)};Composer.prototype.stopAutoSaveTimer=function(){var that=this;if(that.autoSaveTimer){clearInterval(that.autoSaveTimer)}};Composer.prototype.beginEdit=function(){var that=this;that.readyForEditingTimer=setTimeout(function(){that.readyForEditing(true)},500);that.startAutoSaveTimer();that.editableFields.beginEdit();if(!that.plainTextMode){that.editor.beginEdit()}};Composer.prototype.commit=function(){this.editableFields.commit();this.editableFields.beginEdit();if(!this.plainTextMode){this.editor.commit();this.editor.beginEdit()}};Composer.prototype.hasChanges=function(){return this.editableFields.hasChanges()};Composer.prototype.getSignature=function(){var mailprefs=this.state.preferences.mail();if(!mailprefs){return''}if(this.plainTextMode){if(mailprefs.richSignature){return'\n\n'+htmlEmailToText.htmlEmailToText(mailprefs.richSignature)}}else{if(mailprefs.richSignature){return'<br><br>'+mailprefs.richSignature}}return''};Composer.prototype.getAttachments=function(){return this.attachmentView.attachmentsBelowSizeLimit()};Composer.prototype.getHeaders=function(){var draft=this.draftBeingEdited();this.headers.flags=draft&&draft.getImapFlags()||[];return ko.utils.extend({to:this.to().map(Recipient.toJS),cc:this.cc().map(Recipient.toJS),bcc:this.bcc().map(Recipient.toJS),subject:this.subject()},this.headers)};Composer.prototype.getRecipients=function(){return this.to().concat(this.cc().concat(this.bcc()))};Composer.prototype.getHtml=function(){var html='';if(this.editor.getContent){html=this.editor.getContent()}else{html=this.html}return util.unAbsolutizeApiLinks(html)};Composer.prototype.saveChanges=function(options,callback){var that=this;if(that.hasChanges()){that.saveMail(options,callback)}else if(callback){callback()}};Composer.prototype.hasRecipients=function(){return 0<this.to().length+this.cc().length+this.bcc().length};Composer.prototype.persistEditorContent=function(){if(!this.plainTextMode&&this.editor.getContent){this.html=this.getHtml()}};Composer.prototype.flushChanges=Composer.prototype.persistEditorContent;Composer.prototype.whenDoneSending=function(cb){var that=this;var subscription=that.sendingMail.subscribe(function(sending){if(!sending){subscription.dispose();cb()}})};Composer.prototype.updateHeadersWithPreferences=function(outgoingMail){var headers=outgoingMail.headers;var mailPreferences=this.state.preferences.mail();var globalPreferences=this.state.preferences.global();headers.from={email:this.state.user()};if(mailPreferences&&globalPreferences){var displayName=globalPreferences.displayName;if(mailPreferences.replyTo){headers.replyTo={email:mailPreferences.replyTo};if(displayName){headers.replyTo.displayName=displayName}}if(displayName){headers.from.displayName=displayName}}};Composer.prototype.updateHeadersWithDeleteOtherEmailUponSuccess=function(outgoingMail){var original=outgoingMail.original;if(original&&original.isDraft()){outgoingMail.headers.deleteOtherEmailUponSuccess={uid:original.uid,folderName:original.folder().id(),uidValidity:original.folder().uidvalidity()}}};Composer.prototype.createOutgoingMail=function(){var outgoingMail=new OutgoingMail({headers:this.getHeaders(),attachments:this.getAttachments(),original:this.draftBeingEdited()});this.updateHeadersWithPreferences(outgoingMail);this.updateHeadersWithDeleteOtherEmailUponSuccess(outgoingMail);outgoingMail.headers.send=false;outgoingMail.headers.date=moment().format('ddd, D MMM YYYY HH:mm:ss ZZ');if(this.plainTextMode){outgoingMail.text=this.text()}else{outgoingMail.html=this.getHtml()}if(this.newInlineImage.length){outgoingMail.newRelated=this.newInlineImage}return outgoingMail};function hasInvalidEmail(recipient){return recipient.isInvalidEmail()}function length(){return Array.prototype.slice.call(arguments).reduce(function(sum,items){return sum+items.length},0)}Composer.prototype.validateEmailsBeforeSending=function(){if(length(this.to(),this.cc(),this.bcc())===0){this.handleError(Failboat.tag({},'NORECIPIENTS Composer'));return false}var invalidRecipients={to:this.to().filter(hasInvalidEmail),cc:this.cc().filter(hasInvalidEmail),bcc:this.bcc().filter(hasInvalidEmail)};if(length(invalidRecipients.to,invalidRecipients.cc,invalidRecipients.bcc)>0){this.handleError(Failboat.tag(invalidRecipients,'INVALIDRECIPIENTS Composer'));return false}return true};Composer.prototype.sendMail=function(){var that=this;var previousFocus=document.activeElement;$('input').blur();previousFocus.focus();if(!this.validateEmailsBeforeSending()){return}that.loadingOverlayVisible(true);if(that.sendingMail()){return that.whenDoneSending(function(){that.sendMail()})}if(that.sent){return}that.sendingMail(true);that.failedSending(false);that.failedSaving(false);that.state.signals.sendingMail.dispatch(that);var recipients=that.getRecipients();var outgoingMail=that.createOutgoingMail();outgoingMail.destination=that.state.folders.sent;outgoingMail.headers.flags.push(Flag.SUBMITPENDING.imap);outgoingMail.headers.flags.push(Flag.SEEN.imap);that.notification(TR('mail.SendingMail','Sending mail...'));that.actionExecutor.enqueue(new SaveMailAction({outgoingMail:outgoingMail}),function(err,data,savedMail){that.notification(null);if(err){err.while='sending';that.handleError(err);that.beginEdit();that.failedSending(true);that.state.signals.queueMailForSendingFailed.dispatch(that);that.sendingMail(false)}else{that.commit();that.state.signals.queueMailForSending.dispatch(that);if(that.state.contacts.loaded()){that.actionExecutor.enqueue(new SaveAutocompleteAction({recipients:recipients}))}if(savedMail.submitPending()){that.actionExecutor.enqueue(new SendMailAction({mail:savedMail}),function(err){that.handleError(err);if(!err){that.sent=true;that.sendingMail(false);that.dispose()}that.sendingMail(false)})}else{that.sendingMail(false)}}that.loadingOverlayVisible(false)})};Composer.prototype.forEachImgInBodyMatching=function(matcher,iterator){var contentHtml,changesMade=false;if(this.editor.getBody){contentHtml=$(this.editor.getBody())}else{contentHtml=$.parseHTML(this.html)}$('img',contentHtml).each(function(index,imgElem){if(matcher(imgElem)){var justChanged=iterator(imgElem);changesMade=changesMade||justChanged}});if(!this.editor.getBody&&changesMade){this.html=contentHtml.map(function(node){return node.outerHTML}).join('')}};Composer.prototype.forEachBodyImgSrcMatching=function(folder,uid,section,callback){if(!callback){callback=section;section=''}var imgSrcRegExp=new RegExp('(?:https?:\\/\\/'+util.escapeRegExp(location.host)+')?'+util.escapeRegExp('/api/'+encodeURIComponent(this.state.user())+'/mail/')+'\\d+'+util.escapeRegExp('/'+folder+'/')+'\\d+'+util.escapeRegExp('/'+uid+'/'+section));var that=this;that.forEachImgInBodyMatching(function(imgElem){var src=$(imgElem).attr('src');return src&&imgSrcRegExp.test(src)},callback)};Composer.prototype.getInlineImageUploader=function(){var that=this;return function(files,done){files.forEach(function(file){var attachement=Attachment.createFromFile(file,true);that.newInlineImage.push(attachement);done({placeholderUrl:'https://mail-static.cdn-one.com/loaderSmall.16a1308f59.gif',cid:attachement.id})});that.saveMail({silent:true})}};Composer.prototype.attachFile=function(file){var input;var that=this;return function(file){input={files:[file]};that.attachmentView.attach(input)}};Composer.prototype.showDraftSavedNotification=function(){var that=this;var message=TR('mail.DraftSaved','Draft saved');that.notification(message);setTimeout(function(){if(that.notification()===message){that.notification(null)}},3000)};Composer.prototype.saveMail=function(options,done){options=util.extend({silent:false,autoSave:false,disableInternalErrorHandling:false},options);var that=this;if(that.sendingMail()){return}that.sendingMail(true);if(!options.autoSave){that.failedSaving(false);that.failedSending(false)}if(!that.plainTextMode&&that.editor.getHTML){that.html=that.editor.getHTML()}var outgoingMail=that.createOutgoingMail();var saveMailAction=new SaveMailAction({outgoingMail:outgoingMail});if(!options.silent&&!options.autoSave){that.notification({message:TR('mail.SavingDraft','Saving draft...'),timeout:3000})}var oldUid=that.draftBeingEdited()&&that.draftBeingEdited().uid;that.actionExecutor.enqueue(saveMailAction,function(err,data,newDraft){if(!options.silent&&!options.autoSave){that.notification(null)}if(err){err.while='saving';if(options.disableInternalErrorHandling){return done(err)}else if(options.autoSave){that.handleError(err,{'0, 500, 502, 503':function(){that.restartAutoSaveTimerAfterError()}})}else{that.handleError(err)}that.sendingMail(false)}else{that.clearLocalStorage();that.failedSaving(false);that.commit();that.beginEdit();if(options.autoSave){that.showDraftSavedNotification()}that.updateViewWithDraft(oldUid,newDraft,data,function(){that.sendingMail(false);if(done){done()}});that.state.signals.mailSaved.dispatch(that.draftBeingEdited())}})};Composer.prototype.handleError=function(err,handlers){this.errorHandler.handleError(err,handlers)};Composer.prototype.deleteMail=function(data){var that=this;data.discardMail();that.closeComposer(data)};Composer.prototype.discardMail=function(){var that=this;var draft=that.draftBeingEdited();var trash=that.state.folders.trash;that.commit();if(draft){that.notification({message:inter.trQuantity(TR('mail.MovedMailToTrash',{one:'{0} email moved to trash',other:'{0} emails moved to trash'}),1),timeout:3000});that.actionExecutor.enqueue(new MoveMailsAction({mails:[draft],destination:trash}),function(err){that.notification(null);if(err){that.handleError(err)}that.dispose()})}else{if(that.sendingMail()){that.whenDoneSending(function(){that.discardMail()})}}that.state.signals.mailDiscarded.dispatch(this)};Composer.prototype.template='composer';Composer.prototype.dispose=function(){this.disposed=true;var that=this;if(that.sendingMail()){return that.whenDoneSending(function(){that.dispose()})}that.subscriptions.forEach(function(sub){sub.dispose()});that.updateDraftState.dispose();that.stopAutoSaveTimer();clearTimeout(that.readyForEditingTimer);clearTimeout(that.restartAutoSaveTimerAfterErrorTimer)};Composer.prototype.saveAndClose=function(callback){var that=this;that.toView.flushChanges();that.ccView.flushChanges();that.bccView.flushChanges();that.flushChanges();that.loadingOverlayVisible(true);that.saveChanges({},function(err){that.loadingOverlayVisible(false);if(err){that.beginEdit()}else{callback()}})};Composer.prototype.close=function(){var that=this,linkHandler,imageDialog,buttons;if(this.editor){if(this.editor.getToolbar){buttons=this.editor.getToolbar().buttons;linkHandler=buttons.link.model;imageDialog=buttons.image.model;linkHandler.close();imageDialog.close()}}that.flushChanges();that.saveChanges({},function(){that.loadingOverlayVisible(false)});that.state.signals.composerClosing.dispatch(that)};TraceLogging.injectTracing(Composer);return Composer})}());(function(){var define=System.amdDefine;define('webmail/moveToFolder/MoveToFolder.js',['node_modules/jquery/dist/jquery.js','node_modules/knockout/build/output/knockout-latest.debug.js','common/util.js'],function($,ko,util){var keys={escape:27};function MoveToFolder(folders,moveMails){var that=this;this.folders=folders;this.openState=ko.observable(false);this.closeOnEsc=false;this.data={filterBy:ko.observable(''),folders:ko.pureComputed(function(){return that.folders.list().filter(function(folder){return!folder.selected()})}),maxItems:Infinity,format:function(folder){return folder.pathString()},onSelect:function(folder){that.openState(false);moveMails(folder);return''},afterRender:function(){$('#MoveToFolderFilter').on('keydown',function(e){if(e.which===keys.escape){if(that.data.filterBy()===''){that.openState(false)}if(that.data.filterBy()!==''){that.data.filterBy('')}}});$('#MoveToFolderFilter').width($('#moveToFolderList').width()-12)}};this.afterOpen=function(){$('#MoveToFolderFilter').focus()};this.afterClose=function(){that.data.filterBy('')};this.className='moveDropdown';this.template='moveToFolder'}return MoveToFolder})}());(function(){var define=System.amdDefine;define('webmail/actions/DeleteMailsAction.js',['common/util.js','common/ActionBehavior.js'],function(util,ActionBehavior){function DeleteMailsAction(options){util.extend(this,{retries:1},util.pick(options,'mails','retries'));ActionBehavior.installInto(this)}DeleteMailsAction.prototype.name='DeleteMailsAction';DeleteMailsAction.prototype.isBlocking=true;DeleteMailsAction.prototype.validate=function(){if(!this.mails||this.mails.length===0){throw new Error('At least one mail must be provided to the delete action')}var folder=this.mails[0].folder();var hasSameFolder=this.mails.every(function(mail){return mail.folder()===folder});if(!hasSameFolder){throw new Error('Mails must belong to the same folder')}if(!folder.isTrashFolder()){throw new Error('Mails can only be deleted from the trash folder')}};DeleteMailsAction.prototype.models=function(){return this.mails.concat(this.mails[0].folder())};DeleteMailsAction.prototype.execute=function(context,cb){var that=this;that.setBusyFlags();var state=context.state;var backend=context.backend;var mails=this.mails;var folder=mails[0].folder();var uids=mails.map(function(mail){return mail.uid});folder.removeMails(mails);backend.deleteMails(state.user(),folder.id(),folder.uidvalidity(),uids,function(err,data){that.removeBusyFlags();cb(err)})};return DeleteMailsAction})}());(function(){var define=System.amdDefine;(function(root,factory){if(typeof exports==='object'){module.exports=factory()}else if(typeof define==='function'&&define.amd){define('3rdparty/uidRanger.js',[],factory)}else{root.one=root.one||{};root.one.uidRanger=factory()}}(this,function(){function IntegerRange(from,to){this.from=from;this.to=to}IntegerRange.prototype.length=function(){return this.to-this.from+1};IntegerRange.prototype.toString=function(){return this.from+':'+this.to};IntegerRange.prototype.validate=function(){if(this.to<=this.from){throw new Error('UID range segment '+this.toString()+' is invalid. '+'from:to has to fulfill from < to.')}};function UidRange(){this.segments=[]}UidRange.prototype.add=function(segment){var nextSegmentStart;if(typeof segment==='number'){nextSegmentStart=segment}if(segment instanceof IntegerRange){segment.validate();nextSegmentStart=segment.from}var lastSegment=this.segments[this.segments.length-1];if(lastSegment){var lastSegmentEnd=lastSegment instanceof IntegerRange?lastSegment.to:lastSegment;if(nextSegmentStart<=lastSegmentEnd){throw new Error('Invalid UID range segment: '+String(segment)+'. '+'The UID segments must be sorted in increasing order: '+lastSegment+' >= '+nextSegmentStart+'.')}}this.segments.push(segment)};UidRange.prototype.toArray=function(){var result=[];this.segments.forEach(function(segment){if(segment instanceof IntegerRange){for(var i=segment.from;i<=segment.to;i+=1){result.push(i)}}else{result.push(segment)}});return result};UidRange.prototype.get=function(index){if(index<0){return null}var i=0;var uid=null;this.segments.some(function(segment){if(segment instanceof IntegerRange){if(index<i+segment.length()){uid=segment.from+index-i;return true}i+=segment.length()}else{if(i===index){uid=segment;return true}i+=1}return false});return uid};UidRange.prototype.toString=function(){return this.segments.map(function(segment){return String(segment)}).join(',')};UidRange.prototype.length=function(){var length=0;this.segments.forEach(function(segment){if(segment instanceof IntegerRange){length+=segment.length()}else{length+=1}});return length};var delimiterRegexp=/\s*,\s*/;var integerRangeRegexp=/^(\d+):(\d+)$/;var integerRegexp=/^(\d+)$/;var uidRanger={parse:function(rangeString){var uidRange=new UidRange;(rangeString||'').split(delimiterRegexp).forEach(function(rangeSegment){var m;if(m=integerRegexp.exec(rangeSegment)){uidRange.add(parseInt(m[1],10))}else if(m=integerRangeRegexp.exec(rangeSegment)){uidRange.add(new IntegerRange(parseInt(m[1],10),parseInt(m[2],10)))}else{throw new Error('Invalid UID range segment: '+rangeSegment+'. A range segment must be an UID or a UID '+'range separated by a colon.')}});return uidRange}};return uidRanger}))}());(function(){var define=System.amdDefine;define('webmail/actions/MoveMailsAction.js',['common/util.js','3rdparty/uidRanger.js','common/ActionBehavior.js'],function(util,uidRanger,ActionBehavior){function MoveMailsAction(options){util.extend(this,util.pick(options,'mails','destination'));ActionBehavior.installInto(this)}MoveMailsAction.prototype.name='MoveMailsAction';MoveMailsAction.prototype.isBlocking=true;MoveMailsAction.prototype.validate=function(){if(!this.mails||this.mails.length===0){throw new Error('At least one mail must be provided to the move action')}var folder=this.mails[0].folder();var hasSameFolder=this.mails.every(function(mail){return mail.folder()===folder});if(!hasSameFolder){throw new Error('Mails must belong to the same folder')}if(!this.destination){throw new Error('A destination folder must be specified')}};MoveMailsAction.prototype.models=function(){return this.mails.concat(this.destination).concat(this.mails[0].folder())};MoveMailsAction.prototype.execute=function(context,cb){var that=this;var state=context.state;var backend=context.backend;that.setBusyFlags();var mails=this.mails;var destination=this.destination;var folder=mails[0].folder();state.signals.movingMails.dispatch(mails,folder,destination);var uids=mails.map(function(mail){return mail.uid});folder.removeMails(mails);destination.addMails(mails);backend.moveMails(state.user(),folder.id(),folder.uidvalidity(),destination.id(),uids,function(err,data){that.removeBusyFlags();if(!err){if(typeof destination.uidvalidity()!=='number'){destination.uidvalidity(data.uidValidity)}if('from'in data&&'to'in data){var mailIndex=util.uniqueIndexBy(mails,'uid');var fromUidRange=uidRanger.parse(String(data.from));var toUidRange=uidRanger.parse(String(data.to));for(var i=0;i<fromUidRange.length();i+=1){var oldUid=fromUidRange.get(i);var newUid=toUidRange.get(i);var movedMail=mailIndex[oldUid];movedMail.uid=newUid;movedMail.folder(destination);destination.mailCache.store(movedMail)}}}cb(err)})};return MoveMailsAction})}());(function(){var define=System.amdDefine;define('webmail/actions/SetFlagAction.js',['common/util.js','common/model/Flag.js','common/ActionBehavior.js'],function(util,Flag,ActionBehavior){function SetFlagAction(options){util.extend(this,{retries:1},util.pick(options,'mails','flag','value','retries'));ActionBehavior.installInto(this)}SetFlagAction.prototype.name='SetFlagAction';SetFlagAction.prototype.models=function(){return this.mails.concat(this.mails[0].folder())};SetFlagAction.prototype.validate=function(){if(!this.mails||this.mails.length===0){throw new Error('At least one mail must be provided to the set flag action')}if(!(this.flag instanceof Flag)){throw new Error('The given flag most be of type comon/model/Flag')}if(typeof this.value!=='boolean'){throw new Error('The value for the flag must be a boolean')}var folder=this.mails[0].folder();var hasSameFolder=this.mails.every(function(mail){return mail.folder()===folder});if(!hasSameFolder){throw new Error('The mails must belong to the same folder')}};function getFlagValues(mails,flag){return mails.map(function(mail){return mail[flag.name]()})}SetFlagAction.prototype.execute=function(context,cb){var that=this;var state=context.state;var backend=context.backend;that.setBusyFlags();var mails=this.mails;var folder=this.mails[0].folder();var flag=this.flag;var value=this.value;var uids=mails.map(function(mail){return mail.uid});var flagValues=getFlagValues(mails,flag);folder.setFlags(mails,flag,value);var method=value?'addFlags':'removeFlags';backend[method](state.user(),folder.id(),folder.uidvalidity(),uids,[flag.imap],function(err){that.removeBusyFlags();if(err){folder.setFlags(mails,flag,flagValues)}cb(err)})};return SetFlagAction})}());(function(){var define=System.amdDefine;define('common/ScrollPane.js',['node_modules/jquery/dist/jquery.js'],function($){var defaultOffsets={top:0,left:0,right:0,bottom:0};function ScrollPane(container,offsets){this.container=$(container);this.offsets=$.extend({},defaultOffsets,offsets)}function top(element){return $(element).offset().top}function bottom(element){return top(element)+$(element).outerHeight()}ScrollPane.prototype.alignWithTop=function(element){this.container.scrollTop(this.container.scrollTop()+top(element)-top(this.container))};ScrollPane.prototype.alignWithBottom=function(element){this.container.scrollTop(this.container.scrollTop()+bottom(element)-bottom(this.container))};ScrollPane.prototype.scrollIntoView=function(element){if(this.isAboveScrollArea(element)){this.alignWithTop(element)}else if(this.isBelowScrollArea(element)){this.alignWithBottom(element)}};ScrollPane.prototype.isAboveScrollArea=function(element){return top(element)<top(this.container)};ScrollPane.prototype.isBelowScrollArea=function(element){return bottom(element)>bottom(this.container)};ScrollPane.prototype.scrollToTop=function(offsets){this.container.scrollTop(this.offsets.top)};return ScrollPane})}());(function(){var define=System.amdDefine;define('common/SimpleSearchLanguage.js',['common/util.js'],function(util){var regex={openingQuote:/^"/,closingQuote:/"$/};return{foldQuotedStrings:function(tokens){var result=[];var insideQuotedString=false;tokens.forEach(function(word){if(regex.openingQuote.test(word)&&regex.closingQuote.test(word)){word=word.substring(1,word.length-1);result.push(word)}else if(regex.openingQuote.test(word)){insideQuotedString=true;word=word.substring(1);result.push(word)}else if(regex.closingQuote.test(word)){insideQuotedString=false;word=word.substring(0,word.length-1);result[result.length-1]+=' '+word}else{if(insideQuotedString){result[result.length-1]+=' '+word}else{result.push(word)}}});return result},parseSearchQuery:function(query){var queryTokens=query.split(' ');var queryParts=[];var queryObject={};queryTokens.forEach(function(token,index){var matches=token.match(/^((?:to|from|cc|bcc|subject):)[^ ]+?$/);if(matches&&matches.length===2){queryTokens[index]=matches[1];queryTokens.splice(index+1,0,token.replace(matches[1],''))}});queryTokens=this.foldQuotedStrings(queryTokens);queryTokens=queryTokens.filter(function(token){return token!=='AND'&&token!=='OR'});queryTokens.forEach(function(token){if(/^(?:to|from|cc|bcc|subject):$/.test(token)){queryParts.push({type:token.substring(0,token.length-1),values:[]})}else{if(queryParts.length>0){queryParts[queryParts.length-1].values.push(token)}else{queryParts.push({type:'text',values:[token]})}}});queryParts.forEach(function(part){queryObject[part.type]=part.values});return queryObject},regexFromParsedSearchQuery:function(query,type){if(typeof type!=='string'){return false}if(!query.hasOwnProperty(type)&&!query.hasOwnProperty('text')){return false}var matching=[];if(query.hasOwnProperty(type)){matching=matching.concat(query[type])}if(query.hasOwnProperty('text')){matching=matching.concat(query.text)}return new RegExp('(?:'+matching.map(util.escapeRegExp).join('|')+')','gi')}}})}());(function(){var define=System.amdDefine;define('settings/model/Filter.js',['node_modules/knockout/build/output/knockout-latest.debug.js','common/model/Flag.js','common/util.js'],function(ko,Flag,util){function Filter(data){var that=this;if(!data){data={query:{},actions:{fileInto:'',addFlags:[]}}}if(typeof data.id!=='undefined'){that.id=data.id}else{that.id=util.uuid()}that.query=ko.observable(data.query);that.query.entries=ko.computed(function(){return util.entries(that.query())});that.actions={fileInto:ko.observable(data.actions.fileInto),addFlags:{}};that.actions.fileInto.folder=ko.computed(function(){return util.translatedFolderName(that.actions.fileInto())});var addFlags=data.actions.addFlags||[];[Flag.SEEN,Flag.FLAGGED].forEach(function(flag){var hasFlag=addFlags.indexOf(flag.imap)!==-1;that.actions.addFlags[flag.name]=ko.observable(hasFlag)});that.selected=ko.observable(false);that.focused=ko.observable(false);that.dragging=ko.observable(false)}var fieldTranslations={to:TR('mail.ToColon','To:'),cc:TR('mail.CcColon','Cc:'),from:TR('mail.FromColon','From:'),subject:TR('mail.SubjectColon','Subject:')};Filter.prototype.translateQueryField=function(field){return fieldTranslations[field]};Filter.prototype.toJS=function(){var that=this;var data={id:that.id,query:that.query(),actions:{addFlags:[]}};if(that.actions.fileInto()){data.actions.fileInto=that.actions.fileInto()}[Flag.SEEN,Flag.FLAGGED].forEach(function(flag){if(that.actions.addFlags[flag.name]()){data.actions.addFlags.push(flag.imap)}});return data};Filter.create=function(data){return new Filter(data)};return Filter})}());(function(){var define=System.amdDefine;define('settings/model/SenderPattern.js',['node_modules/knockout/build/output/knockout-latest.debug.js'],function(ko){function SenderPattern(pattern){var that=this;that.pattern=ko.observable(pattern);that.focused=ko.observable(false);that.selected=ko.observable(false)}SenderPattern.create=function(data){return new SenderPattern(data)};SenderPattern.prototype.toJS=function(){return this.pattern().trim()};SenderPattern.prototype.toString=function(){return this.pattern()};return SenderPattern})}());(function(){var define=System.amdDefine;define('settings/actions/LoadFiltersAction.js',['common/util.js','common/ActionBehavior.js','settings/model/Filter.js','settings/model/SenderPattern.js'],function(util,ActionBehavior,Filter,SenderPattern){function LoadFiltersAction(options){util.extend(this,util.pick(options,'filterData'));ActionBehavior.installInto(this)}LoadFiltersAction.prototype.name='LoadFiltersAction';LoadFiltersAction.prototype.models=function(){return this.filterData};LoadFiltersAction.prototype.execute=function(context,cb){var that=this;that.setBusyFlags();context.backend.getFilterData(context.state.user(),function(err,data){if(!err){data.filters=data.filters.filter(function(f){return typeof f.query!=='string'});that.filterData.filters(data.filters.map(Filter.create));that.filterData.original(that.filterData.current());that.filterData.blocked(data.blocked.map(SenderPattern.create));that.filterData.revision(data._rev)}that.removeBusyFlags();if(cb&&typeof cb==='function'){return cb(err)}})};return LoadFiltersAction})}());(function(){var define=System.amdDefine;define('settings/actions/SaveFiltersAction.js',['common/util.js','common/ActionBehavior.js'],function(util,ActionBehavior){function SaveFiltersAction(options){util.extend(this,util.pick(options,'filterData'));ActionBehavior.installInto(this)}SaveFiltersAction.prototype.name='SaveFiltersAction';SaveFiltersAction.prototype.models=function(){return this.filterData};SaveFiltersAction.prototype.validate=function(){if(!this.filterData){throw new Error('No filter-data was given to be saved')}};SaveFiltersAction.prototype.execute=function(context,cb){var that=this;that.validate();that.setBusyFlags();var filterData=that.filterData.current();context.backend.saveFilterData(context.state.user(),filterData,that.filterData.original(),function(err,data){if(!err){that.filterData.revision(data._rev);that.filterData.original(that.filterData.current())}that.removeBusyFlags();if(cb&&typeof cb==='function'){return cb(err)}})};return SaveFiltersAction})}());(function(){var define=System.amdDefine;define('common/knockout.pause.js',['node_modules/knockout/build/output/knockout-latest.debug.js'],function(ko){ko.extenders.pause=function(target,paused){var isPaused=!!paused;var lastValue;target.notifySubscribers=function(){if(!isPaused){ko.subscribable.fn.notifySubscribers.apply(this,arguments)}};target.pause=function(){isPaused=true;lastValue=target.peek()};target.resume=function(notify){isPaused=false;if(notify){var newValue=target.peek();if(target.isDifferent(lastValue,newValue)){ko.subscribable.fn.notifySubscribers.call(this,newValue)}}};target.silentUpdate=function(value){if(isPaused){target(value)}else{target.pause();target(value);target.resume()}};return target}})}());System.registerDynamic('components/pagination/pagination.ko',[],true,function($__require,exports,module){var define,global=this||self,GLOBAL=global;module.exports=function injectTemplate(tpl){var s=document.createElement('script');s.id=tpl.id;s.innerHTML=window.TR?TR.HTML(tpl.content):tpl.content;s.type='text/html';document.head.appendChild(s)}({'id':'pagination','content':'<!-- ko \'if\': loaded() -->\n    <!-- ko \'if\': pageCount() === 1 -->\n    <span class="pagination-label">\n        <span data-bind="visible: fullLength() !== 0, template: \'paginationLabel\'"></span>\n    </span>\n    <!-- /ko -->\n    <!-- ko \'if\': pageCount() > 1 -->\n    <span class="pagination-label dropdown">\n        <span data-bind="dropdownTemplate: {\n                            template: \'paginationDropdown\',\n                            positioning: dropdownPosition\n                         }"\n              class="dropdown-toggle">\n            <span data-bind="template: \'paginationLabel\'"></span>\n            <b class="caret"></b>\n        </span>\n    </span>\n    <!-- /ko -->\n<!-- /ko -->\n<!-- ko ifnot: loaded() -->\n    <span class="pagination-label">\n        <span data-i18n="mail.Loading">Loading...</span>\n    </span>\n<!-- /ko -->\n<button class="navigation newer" data-bind="enable: hasPreviousPage(), click: previousPage"><span class="icon-back-arrow"></span></button><button class="navigation older" data-bind="enable: hasNextPage(), click: nextPage"><span class="icon-forward-arrow"></span></button>\n'});return module.exports});System.registerDynamic('components/pagination/paginationLabel.ko',[],true,function($__require,exports,module){var define,global=this||self,GLOBAL=global;module.exports=function injectTemplate(tpl){var s=document.createElement('script');s.id=tpl.id;s.innerHTML=window.TR?TR.HTML(tpl.content):tpl.content;s.type='text/html';document.head.appendChild(s)}({'id':'paginationLabel','content':'<span data-i18n="mail.ShowingXToYOfZ">\n    <span data-bind="text: firstItemIndex">1</span>-<span data-bind="text: lastItemIndex">50</span> of <span class="highlight" data-bind="text: fullLength">0</span>\n</span>\n'});return module.exports});System.registerDynamic('components/pagination/paginationDropdown.ko',[],true,function($__require,exports,module){var define,global=this||self,GLOBAL=global;module.exports=function injectTemplate(tpl){var s=document.createElement('script');s.id=tpl.id;s.innerHTML=window.TR?TR.HTML(tpl.content):tpl.content;s.type='text/html';document.head.appendChild(s)}({'id':'paginationDropdown','content':'<ul class="popupDropdown" data-bind="foreach: paginationList">\n    <li class="dropdown-item" data-bind="text: name, click: clickHandler, style: { \'font-weight\': current ? \'bold\': \'normal\' }"></li>\n</ul>\n'});return module.exports});(function(){var define=System.amdDefine;define('components/pagination/pagination.js',['node_modules/knockout/build/output/knockout-latest.debug.js','common/bindings/knockout.dropdownTemplate.js','components/pagination/pagination.ko','components/pagination/paginationLabel.ko','components/pagination/paginationDropdown.ko'],function(ko){function PaginationModel(params){var that=this;that.pageLength=params.pageLength;that.fullLength=params.fullLength;that.currentPage=params.page||ko.observable();that.setPageNumber(that.currentPage()||1);that.pageCount=ko.pureComputed(function(){return Math.ceil(that.fullLength()/that.pageLength())});var gotoFunc=params.goto||function(){};that.goToPage=function(page){that.setPageNumber(page);gotoFunc(page)};that.loaded=params.loaded||function(){return true};that.dropdownPosition=params.dropdownPosition||{horizontal:'inside-right'};that.paginationList=ko.pureComputed(function(){var pageSize=that.pageLength(),currentPage=that.currentPage(),totalPages=that.pageCount(),firstPage=Math.max(1,currentPage-4),lastPage=Math.min(totalPages,currentPage+4),pageList=[],i;if(totalPages===1){return[]}function pageStart(page){return pageSize*(page-1)+1}function pageEnd(page){return Math.min(pageSize*page,that.fullLength())}function targetFunc(page){return function(){that.goToPage(page)}}if(firstPage>1){pageList.push({name:TR('mail.PaginationJumpToFirst','Jump to first'),clickHandler:targetFunc(1),current:false})}for(i=firstPage;i<currentPage;i+=1){pageList.push({name:pageStart(i)+'-'+pageEnd(i),clickHandler:targetFunc(i),current:false})}pageList.push({name:pageStart(currentPage)+'-'+pageEnd(currentPage),clickHandler:function(){},current:true});for(i=currentPage+1;i<=lastPage;i+=1){pageList.push({name:pageStart(i)+'-'+pageEnd(i),clickHandler:targetFunc(i),current:false})}if(lastPage<totalPages){pageList.push({name:TR('mail.PaginationJumpToLast','Jump to last'),clickHandler:targetFunc(totalPages),current:false})}return pageList});that.firstItemIndex=ko.pureComputed(function(){return(that.currentPage()-1)*that.pageLength()+1});that.lastItemIndex=ko.pureComputed(function(){return Math.min(that.currentPage()*that.pageLength(),that.fullLength())});that.hasNextPage=ko.pureComputed(function(){return that.currentPage()<that.pageCount()});that.hasPreviousPage=ko.pureComputed(function(){return that.currentPage()>1})}PaginationModel.prototype.setPageNumber=function(index){if(ko.isWritableObservable(this.currentPage)){this.currentPage(index)}};PaginationModel.prototype.nextPage=function(){if(this.currentPage()<this.pageCount()){var newIndex=this.currentPage()+1;this.goToPage(newIndex);this.setPageNumber(newIndex)}};PaginationModel.prototype.previousPage=function(){if(this.currentPage()>1){var newIndex=this.currentPage()-1;this.goToPage(newIndex);this.setPageNumber(newIndex)}};ko.components.register('pagination',{template:{element:'pagination'},viewModel:PaginationModel})})}());System.registerDynamic('components/cardStack/cardStack.ko',[],true,function($__require,exports,module){var define,global=this||self,GLOBAL=global;module.exports=function injectTemplate(tpl){var s=document.createElement('script');s.id=tpl.id;s.innerHTML=window.TR?TR.HTML(tpl.content):tpl.content;s.type='text/html';document.head.appendChild(s)}({'id':'cardStack','content':'<span class="card-stack-container" data-bind="foreach: { data: cards, beforeRemove: beforeRemove }, animate: data, css: { incremented: incremented, decremented: decremented }">\n    <span class="card-stack-card" data-bind="css: \'card-\' + $data, template: $parent.template"></span>\n</span>\n'});return module.exports});(function(){var define=System.amdDefine;define('components/cardStack/cardStack.js',['node_modules/knockout/build/output/knockout-latest.debug.js','components/cardStack/cardStack.ko'],function(ko){ko.components.register('card-stack',{template:{element:'cardStack'},viewModel:function(params){this.template=params.template;this.data=params.data;var subscriptions=[];var lastLength=0;subscriptions.push(this.data.subscribe(function(data){lastLength=data.length},null,'beforeChange'));this.incremented=ko.pureComputed(function(){return this.data().length>lastLength},this);this.decremented=ko.pureComputed(function(){return this.data().length<lastLength},this);this.cards=ko.pureComputed(function(){return params.data.slice(0,4).map(function(item,index){return index})});this.beforeRemove=function(element){function removeElement(){if(element.parentNode){element.parentNode.removeChild(element)}}if(element.nodeType===1){if(element.classList.contains('card-0')){removeElement()}else{ko.utils.toggleDomNodeCssClass(element,'removing',true);['animationend','animationend','webkitAnimationEnd','oanimationend','MSAnimationEnd'].forEach(function(eventName){ko.utils.registerEventHandler(element,eventName,removeElement)})}}};this.dispose=function(){subscriptions.forEach(function(subscription){subscription.dispose()})}}})})}());(function(){var define=System.amdDefine;define('3rdparty/knockout-toolbar/ToolbarViewModel.js',['node_modules/knockout/build/output/knockout-latest.debug.js','3rdparty/knockout-transformations/map.js'],function(ko){function Button(params,menus){var that=this;that.handler=that.menu=null;if(typeof params.handler==='function'){that.handler=function(){if(menus){menus.forEach(function(menu){menu(false)})}params.handler()}}else if(params.menu){that.menu=params.menu;that.menu.anchorHandler=false;that.menu.openState=that.menu.openState||ko.observable(false);that.handler=function(){that.menu.openState(!that.menu.openState())}}that.enabled=ko.pureComputed(function(){return!ko.unwrap(params.disabled)});that.track=params.track||null;that.icon=ko.pureComputed(function(){var icon=ko.unwrap(params.icon);return icon?'icon-'+icon:''});that.label=params.label||'';that.classes=params.classes||''}Button.prototype.close=function(){if(this.menu){this.menu.openState(false)}};function ToolbarViewModel(params){var that=this;that.subscriptions=[];that.back=ko.pureComputed(function(){var backData=ko.unwrap(params.back);if(backData){var back={icon:'back',disabled:false,classes:'toolbar-back'+(backData.classes?' '+backData.classes:'')};back.handler=backData.handler;back.label=backData.label||'BACK';return new Button(back)}else{return null}});that.moreOpen=ko.observable(false);that.primaryMenuOpen=ko.observable(false);function makeButton(data){return new Button(data,[that.primaryMenuOpen,that.moreOpen])}that.narrow=ko.isObservable(params.narrow)?params.narrow:ko.observable(!!params.narrow);that.collapsed=ko.isObservable(params.collapsed)?params.collapsed:ko.observable(!!params.collapsed);that.primaries=params.primaries?params.primaries.map(makeButton):[];that.secondaries=params.secondaries?params.secondaries.map(makeButton):[];that.tertiaries=params.tertiaries?params.tertiaries.map(makeButton):[];that.firstPrimary=ko.pureComputed(function(){return ko.unwrap(that.primaries)[0]});that.collapsedPrimaries=ko.pureComputed(function(){return ko.unwrap(that.primaries).slice(1)});that.primariesMenu={buttons:that.collapsedPrimaries,menu:{template:'toolbar-more',openState:that.primaryMenuOpen,positioning:{horizontal:'inside-right',vertical:'outside-bottom'},closeOnClickInPopup:false}};var more={label:params.moreLabel||'MORE',buttons:that.tertiaries,menu:{template:'toolbar-more',openState:that.moreOpen,positioning:{horizontal:'inside-right',vertical:'outside-bottom'},closeOnClickInPopup:false}};that.subscriptions.push(that.moreOpen.subscribe(function(open){if(!open){more.buttons().forEach(function(button){button.close()})}}));that.more=ko.pureComputed(function(){if(ko.unwrap(that.tertiaries).length){return more}else{return null}})}return ToolbarViewModel})}());System.registerDynamic('3rdparty/knockout-toolbar/toolbar-component.ko!3rdparty/systemjs-plugin-ko-tpl.js',[],true,function($__require,exports,module){var define,global=this||self,GLOBAL=global;module.exports=function injectTemplate(tpl){var s=document.createElement('script');s.id=tpl.id;s.innerHTML=window.TR?TR.HTML(tpl.content):tpl.content;s.type='text/html';document.head.appendChild(s)}({'id':'toolbar-component','content':'<div class="toolbar-left">\n    <!-- ko template: { name: \'toolbar-button\', data: back, if: back } -->\n    <!-- /ko -->\n    <!-- ko if: ko.unwrap(primaries).length -->\n    <!-- ko if: narrow() -->\n    <div class="combo-button">\n        <!-- ko template: { name: \'toolbar-button\', data: firstPrimary } -->\n        <!-- /ko -->\n        <!-- if: collapsedPrimaries().length -->\n        <!-- ko with: primariesMenu -->\n        <div class="combo-separator"></div>\n        <button href="#" class="combo-ribbon" data-bind="dropdownTemplate: menu">\n            <span class="icon-caret"></span>\n        </button>\n        <!-- /ko -->\n        <!-- /ko -->\n    </div>\n    <!-- /ko -->\n    <!-- ko ifnot: narrow() -->\n    <!-- ko template: { name: \'toolbar-button\', foreach: primaries } -->\n    <!-- /ko -->\n    <!-- /ko -->\n    <!-- /ko -->\n</div>\n<div class="toolbar-right">\n    <!-- ko template: { name: \'toolbar-button\', foreach: secondaries } -->\n    <!-- /ko -->\n    <!-- ko with: more -->\n    <button href="#" data-bind="dropdownTemplate: menu">\n        <span data-bind="text: label"></span>\n        <span class="icon-caret"></span>\n    </button>\n    <!-- /ko -->\n</div>\n'});return module.exports});System.registerDynamic('3rdparty/knockout-toolbar/toolbar-button.ko!3rdparty/systemjs-plugin-ko-tpl.js',[],true,function($__require,exports,module){var define,global=this||self,GLOBAL=global;module.exports=function injectTemplate(tpl){var s=document.createElement('script');s.id=tpl.id;s.innerHTML=window.TR?TR.HTML(tpl.content):tpl.content;s.type='text/html';document.head.appendChild(s)}({'id':'toolbar-button','content':'<!-- ko if: menu -->\n<button data-bind="click: handler, popupTemplate: menu, css: classes">\n    <span data-bind="css: icon"></span>\n    <span data-bind="text: label, visible: !$parent.collapsed()"></span>\n</button>\n<!-- /ko -->\n<!-- ko ifnot: menu -->\n<!-- ko if: track -->\n<button href="#" data-bind="click: handler, enable: enabled, css: classes, trackClick: track">\n    <span data-bind="css: icon"></span>\n    <span data-bind="text: label, visible: !$parent.collapsed()"></span>\n</button>\n<!-- /ko -->\n<!-- ko ifnot: track -->\n<button href="#" data-bind="click: handler, enable: enabled, css: classes">\n    <span data-bind="css: icon"></span>\n    <span data-bind="text: label, visible: !$parent.collapsed()"></span>\n</button>\n<!-- /ko -->\n<!-- /ko -->\n'});return module.exports});System.registerDynamic('3rdparty/knockout-toolbar/toolbar-more.ko!3rdparty/systemjs-plugin-ko-tpl.js',[],true,function($__require,exports,module){var define,global=this||self,GLOBAL=global;module.exports=function injectTemplate(tpl){var s=document.createElement('script');s.id=tpl.id;s.innerHTML=window.TR?TR.HTML(tpl.content):tpl.content;s.type='text/html';document.head.appendChild(s)}({'id':'toolbar-more','content':'<ul class="popupDropdown toolbar-menu">\n    <!-- ko if: menu.openState -->\n    <!-- ko foreach: buttons -->\n    <!-- ko if: menu -->\n    <li class="dropdown-item toolbar-menu" data-bind="click: handler, text: label, css: icon, popupTemplate: menu"></li>\n    <!-- /ko -->\n    <!-- ko ifnot: menu -->\n    <!-- ko if: track -->\n    <li class="dropdown-item toolbar-menu" data-bind="click: handler, css: icon, text: label, trackClick: track"></li>\n    <!-- /ko -->\n    <!-- ko ifnot: track -->\n    <li class="dropdown-item toolbar-menu" data-bind="click: handler, css: icon, text: label"></li>\n    <!-- /ko -->\n    <!-- /ko -->\n    <!-- /ko -->\n    <!-- /ko -->\n</ul>\n'});return module.exports});(function(){var define=System.amdDefine;define('3rdparty/knockout-toolbar/toolbar.js',['node_modules/knockout/build/output/knockout-latest.debug.js','3rdparty/knockout-toolbar/ToolbarViewModel.js','3rdparty/knockout-toolbar/toolbar-component.ko!3rdparty/systemjs-plugin-ko-tpl.js','3rdparty/knockout-toolbar/toolbar-button.ko!3rdparty/systemjs-plugin-ko-tpl.js','3rdparty/knockout-toolbar/toolbar-more.ko!3rdparty/systemjs-plugin-ko-tpl.js'],function(ko,ToolbarViewModel){ko.components.register('toolbar',{viewModel:{createViewModel:function(params,componentInfo){var model=new ToolbarViewModel(params);ko.utils.domNodeDisposal.addDisposeCallback(componentInfo.element,function(){model.moreOpen(false);model.primaryMenuOpen(false);model.subscriptions.forEach(function(sub){sub.dispose()})});return model}},template:{element:'toolbar-component'}})})}());(function(){var define=System.amdDefine;define('3rdparty/knockout-confirmation-dialog/ConfirmationDialogViewModel.js',['node_modules/knockout/build/output/knockout-latest.debug.js'],function(ko){function ConfirmationDialogViewModel(params,componentInfo){var that=this;that.show=params.show;that.topColor=params.topColor;that.topHeight=params.topHeight;that.buttons=params.buttons;function createTagString(data){if(typeof data==='string'){return data}var tag='<'+data.tag;if(data.attr){Object.keys(data.attr).forEach(function(name){tag+=' '+name+'="'+data.attr[name]+'"'})}if(data.text){tag+='>'+data.text+'</'+data.tag}tag+='>';return tag}that.content=ko.pureComputed(function(){var parts=ko.unwrap(params.content),contents=[];parts.forEach(function(part){contents.push(createTagString(part))});return contents})}return ConfirmationDialogViewModel})}());System.registerDynamic('3rdparty/knockout-confirmation-dialog/confirmation-dialog.ko!3rdparty/systemjs-plugin-ko-tpl.js',[],true,function($__require,exports,module){var define,global=this||self,GLOBAL=global;module.exports=function injectTemplate(tpl){var s=document.createElement('script');s.id=tpl.id;s.innerHTML=window.TR?TR.HTML(tpl.content):tpl.content;s.type='text/html';document.head.appendChild(s)}({'id':'confirmation-dialog','content':'<modal-dialog params="show: show, topHeight: topHeight, topColor: topColor, buttons: buttons, cornerCloser: true">\n    <!-- ko foreach: content -->\n        <p data-bind="html: $data"></p>\n    <!-- /ko -->\n</modal-dialog>\n'});return module.exports});(function(){var define=System.amdDefine;define('3rdparty/knockout-confirmation-dialog/confirmationDialog.js',['node_modules/knockout/build/output/knockout-latest.debug.js','node_modules/jquery/dist/jquery.js','3rdparty/knockout-confirmation-dialog/ConfirmationDialogViewModel.js','3rdparty/knockout-confirmation-dialog/confirmation-dialog.ko!3rdparty/systemjs-plugin-ko-tpl.js','3rdparty/knockout-modal-dialog/modalDialog.js'],function(ko,$,ViewModel,template){ko.components.register('confirmation-dialog',{viewModel:{createViewModel:function(params,componentInfo){return new ViewModel(params,componentInfo)}},template:{element:'confirmation-dialog'},synchronous:true})})}());(function(){var define=System.amdDefine;define('webmail/mailList/MailListView.js',['node_modules/jquery/dist/jquery.js','node_modules/knockout/build/output/knockout-latest.debug.js','common/ViewBehavior.js','common/model/Flag.js','settings/model/SenderPattern.js','common/util.js','webmail/model/Mail.js','webmail/mailView/MailView.js','webmail/composer/Composer.js','webmail/moveToFolder/MoveToFolder.js','webmail/actions/LoadMailsAction.js','webmail/actions/DeleteMailsAction.js','webmail/actions/MoveMailsAction.js','webmail/actions/SetFlagAction.js','common/ScrollPane.js','node_modules/@one.com/tracking-analytics/lib/tracking.js','3rdparty/page.js','common/SimpleSearchLanguage.js','common/AppCourier.js','common/KeyHandler.js','settings/actions/LoadFiltersAction.js','settings/actions/SaveFiltersAction.js','3rdparty/mario.js','common/knockout.pause.js','components/pagination/pagination.js','components/cardStack/cardStack.js','3rdparty/knockout-toolbar/toolbar.js','3rdparty/knockout-confirmation-dialog/confirmationDialog.js'],function($,ko,ViewBehavior,Flag,SenderPattern,util,Mail,MailView,Composer,MoveToFolder,LoadMailsAction,DeleteMailsAction,MoveMailsAction,SetFlagAction,ScrollPane,tracking,page,SimpleSearchLanguage,AppCourier,getKeyHandler,LoadFiltersAction,SaveFiltersAction,mario){function MailListView(options){var that=this;util.extend(this,util.pick(options,['state','layout','actionExecutor','errorHandler','pageNavigator','parentView']));that.subscriptions=[];ViewBehavior.installInto(this);that.folder=that.parentView.folder;that.page=ko.observable(null);that.search=ko.pureComputed(function(){return that.page()&&that.page().search});that.blockSenderDialog=ko.observable(false);that.showDialogWithAlreadyBlockedSenders=ko.observable(false);that.sendersAlreadyBlocked=ko.observableArray([]);that.dialogueContentOfBlockedSenders=ko.observable();that.currentMailList=ko.computed(function(){return that.page()&&that.page().mails()||[]});that.subscriptions.push(that.currentMailList.subscribe(function(mails){if(!that.focused()){that.focused(mails[0])}}));that.selection=ko.observableArray();that.focused=ko.observable();that.anchor=ko.observable();that.setFocusInMailView=ko.observable(false);that.shouldBeOpened=ko.observable();that.searchInputValue=ko.observable();that.arePopupDialogsOpen=ko.observable(false);var lastPage;that.getSenders=function(mails){var senders=[];mails.forEach(function(mail){mail.from().forEach(function(recipient){senders.push(recipient.email)})});return senders};that.listOfBlockedSenders=function(sender){return that.sendersAlreadyBlocked().push(sender)};that.extractEmailFromBlockedSenderPattern=function(blockedSenderPattern){var senders=[];blockedSenderPattern.forEach(function(sender){senders.push(sender.pattern())});return senders};that.checkIfSendersWereBlocked=function(senders,blockedSenderPattern){var isSenderBlocked=false,blockedSenders=this.extractEmailFromBlockedSenderPattern(blockedSenderPattern);senders.forEach(function(sender){if(blockedSenders.indexOf(sender)>-1){that.listOfBlockedSenders(sender);isSenderBlocked=true}});return isSenderBlocked};that.getMessages=function(senders,isSenderBlocked){var messages=null;if(isSenderBlocked===false){messages=[{tag:'h1',text:TR('mail.BlockSender','Block sender')},{tag:'p',text:inter.trQuantity(TR('mail.BlockedSendersMoveToSpam',{one:'This will block all emails from this sender and automatically move any future mails from them directly to your spam folder.',other:'This will block all emails from these senders and automatically move any future mails from them directly to your spam folder.'}),senders.length||1)},{tag:'p',text:TR('mail.RevertChangesInBlockedList','You can remove them from your blocked list in settings.')}]}else{messages=[{tag:'h1',text:TR('mail.BlockSender','Block sender')},{tag:'p',text:inter.trQuantity(TR('mail.SendersIsAlreadyBlocked',{one:'You have already blocked this sender once.',other:'One or more of the selected senders are already blocked.'}),senders.length||1)},{tag:'p',text:TR('mail.UpdateChangesInBlockedList','Future emails from blocked senders, will automatically be moved to your spam folder.')}]}return messages};that.confirmBlockingSender=function(){that.blockSenderDialog(false);that.saveBlockedSenders()};that.subscriptions.push(that.page.subscribe(function(page){lastPage=page},null,'beforeChange'));that.subscriptions.push(that.page.subscribe(function(page){if(page){page.incrementReferences()}if(lastPage){lastPage.decrementReferences()}that.searchInputValue(page.search.query)}));that.page(that.firstFolderPage());that.selected=ko.pureComputed(function(){return that.selection().length===1?that.selection()[0]:null}).extend({pause:false});var ready=ko.observable(false);that.isReady=ko.pureComputed(function(){return ready});that.state.signals.preferencesLoaded.add(function(){that.gotoFirstFolderPage();ready(true)});that.onPopupCloseEvent=function(){that.arePopupDialogsOpen(false)};that.onPopupOpenEvent=function(){that.arePopupDialogsOpen(true)};that.parentView.selected.subscribe(function(folder){if(that.folder()!==folder){if(that.shownComposer()&&that.shownComposer().draftBeingEdited()&&folder===that.shownComposer().draftBeingEdited().folder()){that.pageNavigator.show(folder.id(),1,that.shownComposer().draftBeingEdited().uid)}else{var options={};if(that.shownComposer()){if(that.shownComposer().draftBeingEdited()){options.compose=that.shownComposer().draftBeingEdited().uid;options.folder=that.shownComposer().draftBeingEdited().folder().id()}else{options.compose='new'}}if(that.arePopupDialogsOpen()===true){that.shouldBeOpened(false)}that.moveToFolder.openState(false);that.pageNavigator.show(folder.id(),1,null,options)}}});that.shownMailView=ko.observable();that.shownComposer=ko.observable();that.addFlagToggleState=ko.pureComputed(function(){var mails=that.selection();return 0<mails.reduce(function(acc,mail){return(mail.flagged()?1:-1)+acc},0)});that.markAsSeenToggleState=ko.pureComputed(function(){var mails=that.selection();return 0<mails.reduce(function(acc,mail){return(mail.seen()?1:-1)+acc},0)});that.moveToFolder=new MoveToFolder(that.state.folders,function(targetFolder){that.moveToFolderMoveMails(targetFolder)});that.showMarkDropdownInList=ko.observable(false);that.showMarkDropdownInContentPanel=ko.observable(false);that.closeMarkDropdown=function(){that.showMarkDropdownInList(false);that.showMarkDropdownInContentPanel(false)};that.starActionText=ko.pureComputed(function(){if(that.addFlagToggleState()){return TR('mail.RemoveStar','Remove star')}else{return TR('mail.AddStar','Add star')}});that.readActionText=ko.pureComputed(function(){if(that.markAsSeenToggleState()){return TR('mail.MarkAsUnread','Mark as unread')}else{return TR('mail.MarkAsRead','Mark as read')}});var lastSelectionLength=0;that.subscriptions.push(that.selection.subscribe(function(selection){lastSelectionLength=selection.length},this,'beforeChange'));that.detachViewFromSelection=function(){return that.state.isTouch&&that.folder().isDraftFolder()||that.layout.isStackView()||that.state.standalone};var viewTimer;that.subscriptions.push(that.selected.subscribe(function(selected){clearTimeout(viewTimer);var lastSelected=that.shownMailView()&&that.shownMailView().mail;if(that.detachViewFromSelection()){return}if(that.shownComposer()){that.shownComposer().setFocusInsideComposer(false)}if(selected){if(selected!==lastSelected){var options=that.getOptions();delete options.compose;delete options.folder;if(that.arePopupDialogsOpen()===true){that.shouldBeOpened(false)}if(lastSelectionLength===1){viewTimer=setTimeout(function(){that.pageNavigator.show(that.folder().id(),that.page().index,selected.uid,options)},200)}else{that.pageNavigator.show(that.folder().id(),that.page().index,selected.uid,options)}}}else{if(lastSelectionLength===1){that.pageNavigator.show(that.folder().id(),that.page().index,null,that.getOptions())}}}));that.subscriptions.push(that.layout.isSplitView.subscribe(function(split){setTimeout(function(){if(split&&that.layout.contentPanel.template()==='selection'){that.pageNavigator.show(that.folder().id(),that.page().index,that.selected()&&that.selected().uid,that.getOptions())}},0)}));var storedSelection=null,storedFocus=null;that.saveSelection=function(){storedSelection=that.selection();storedFocus=that.focused()};that.restoreSelection=function(){if(storedSelection instanceof Array){storedSelection=storedSelection.filter(function(mail){return that.currentMailList().indexOf(mail)!==-1});that.selection(storedSelection);storedSelection=null;that.focused(storedFocus);storedFocus=null}};that.activeMailSeenTimer=null;that.searchPlaceholder=ko.computed(function(){var search=TR.PAT('mail.SearchFolder','Search {0}');return search(that.folder()?that.folder().translatedName():'')});that.searchQuery=ko.pureComputed(function(){return that.search()&&that.search().query});that.toRegex=ko.pureComputed(function(){if(!that.hasSearchQuery()){return false}var parsedQuery=SimpleSearchLanguage.parseSearchQuery(that.searchQuery());return SimpleSearchLanguage.regexFromParsedSearchQuery(parsedQuery,'to')});that.fromRegex=ko.pureComputed(function(){if(!that.hasSearchQuery()){return false}var parsedQuery=SimpleSearchLanguage.parseSearchQuery(that.searchQuery());return SimpleSearchLanguage.regexFromParsedSearchQuery(parsedQuery,'from')});that.subjectRegex=ko.pureComputed(function(){if(!that.hasSearchQuery()){return false}var parsedQuery=SimpleSearchLanguage.parseSearchQuery(that.searchQuery());return SimpleSearchLanguage.regexFromParsedSearchQuery(parsedQuery,'subject')});that.hasSearchQuery=ko.pureComputed(function(){return!!that.searchQuery()});that.isFolderEmpty=ko.pureComputed(function(){var folder=that.folder();return folder&&folder.messages()===0});that.hasEmptySearchQuery=ko.computed(function(){return that.hasSearchQuery()&&!that.loading()&&!(that.page().mails().length>0||that.page().hasNextPage())});that.hasOneSelection=ko.pureComputed(function(){return that.selection().length===1});that.hasSelection=ko.pureComputed(function(){return that.selection().length>0});that.isMailFromUserAddressSelected=ko.pureComputed(function(){var senders=that.getSenders(that.selection()),user=that.state.user(),isUserInSendersList=senders.indexOf(user)>-1;return that.hasSelection()&&!isUserInSendersList});that.hasFlagged=ko.computed(function(){return that.selection().some(function(mail){return mail.flagged()})});that.hasUnflagged=ko.computed(function(){return that.selection().some(function(mail){return!mail.flagged()})});that.hasSeen=ko.computed(function(){return that.selection().some(function(mail){return mail.seen()})});that.hasUnseen=ko.computed(function(){return that.selection().some(function(mail){return!mail.seen()})});that.loading=ko.observable(false);that.searchFocus=ko.observable(false);that.mailTabs=null;that.state.signals.mailDiscarded.add(function(composer){var draft=composer.draftBeingEdited();if(draft&&that.folder()===draft.folder()){that.pageNavigator.show(that.folder().id(),that.page().index,null,that.getOptions())}else{that.showSelected()}});that.state.signals.composerOpened.add(function(composer){if(that.layout.isStackView()){var mail=that.selection()[0];if(mail){mail.selected(false);that.selection([])}}that.shownComposer(composer)});that.state.signals.composerClosing.add(function(composer){that.shownComposer(null)});that.state.signals.mailSaved.add(function(mail){if(that.shownComposer()&&that.shownComposer().draftBeingEdited()===mail){if(that.folder()===mail.folder()){that.pageNavigator.redirect(that.folder().id(),that.page().index,mail.uid,that.getOptions())}else{var options=that.getOptions();options.compose=mail.uid;options.folder=mail.folder().id();that.pageNavigator.redirect(that.folder().id(),that.page().index,that.getMailUID(),options)}}});that.paginationConfig={pageLength:ko.pureComputed(function(){return that.search().pageLength}),fullLength:ko.pureComputed(function(){return that.search().length()}),goto:function(pageIndex){tracking.track('navigation','mail list','go to page','page '+pageIndex);that.gotoPage(pageIndex)},loaded:ko.pureComputed(function(){return that.page()&&that.page().loaded()}),page:ko.pureComputed(function(){return that.page().index})};var minorButtons=[{label:TR('mail.Delete','Delete'),icon:'delete',handler:that.deleteSelectedMails.bind(that),track:['mail list','delete mails','count',that.selection().length]},{visible:'hasSelection',label:TR('mail.Move','Move'),icon:'folder',menu:that.moveToFolder}];that.minorButtons=ko.observableArray([]);that.subscriptions.push(that.hasSelection.subscribe(function(value){if(value){that.minorButtons(minorButtons)}else{that.minorButtons([])}}));var flagButtons=[{visible:'hasUnseen',handler:that.markAsSeen.bind(that),track:['mail list','mark as read'],label:TR('mail.MarkAsRead','Mark as read')},{visible:'hasSeen',handler:that.markAsUnseen.bind(that),track:['mail list','mark as unread'],label:TR('mail.MarkAsUnread','Mark as unread')},{visible:'hasUnflagged',handler:that.addFlag.bind(that),track:['mail list','add star'],label:TR('mail.AddStar','Add star')},{visible:'hasFlagged',handler:that.removeFlag.bind(that),track:['mail list','remove star'],label:TR('mail.RemoveStar','Remove star')},{visible:'hasOneSelection',handler:that.createFilter.bind(that),track:['mail list','create filter'],label:TR('mail.CreateFilter','Create filter')},{visible:'isMailFromUserAddressSelected',handler:that.blockSenders.bind(that),track:['mail list','block senders'],label:TR('mail.BlockSender','Block sender')}];var filteredFlagButtons=ko.pureComputed(function(){return flagButtons.filter(function(button){return that[button.visible]()})});that.moreMenu=ko.observableArray(filteredFlagButtons());that.subscriptions.push(filteredFlagButtons.subscribe(function(){that.moreMenu(filteredFlagButtons())}));that.getNextMail=function(mails){var currentIndex=that.currentMailList().indexOf(mails[0]);var nextIndex=currentIndex+that.selection().length;if(nextIndex>=that.currentMailList().length){nextIndex=Math.max(currentIndex-1,0)}return that.currentMailList()[nextIndex]}}MailListView.prototype.routePage=function(page,query){var searchOptions={pageLength:this.getPageSize()};if(query.sortKey||query.sortDirection||query.filter||query.search){query.sortKey=query.sortKey||'ARRIVAL';query.sortDirection=query.sortDirection||'DESC';searchOptions=util.extend(searchOptions,util.pick(query,'sortKey','sortDirection'));if(query.filter){searchOptions.viewFilter=query.filter}if(query.search){searchOptions.query=query.search}}this.searchInputValue(query.search||'');var search=this.folder().search(searchOptions);this.page(search.getPage(parseInt(page,10)||1))};MailListView.prototype.viewFirstMail=function(){var that=this;if(!that.currentMailList().length){return}that.pageNavigator.redirect(that.folder().id(),that.page().index,that.currentMailList()[0].uid,that.getOptions())};MailListView.prototype.viewLastMail=function(){var that=this;if(!that.currentMailList().length){return}that.pageNavigator.redirect(that.folder().id(),that.page().index,that.currentMailList()[that.currentMailList().length-1].uid,that.getOptions())};MailListView.prototype.focusIsLost=function(){var that=this,keyhandler=getKeyHandler(),currentDomain=keyhandler.getCurrentDomain(),isFocusOnBody=document.activeElement===$('body')[0],isFocusOnRte=document.activeElement===$('iframe')[0],shouldFocusOnMailView=that.setFocusInMailView(),isNotFocusOnMailList=currentDomain!=='listPanel';if(that.shownComposer()&&that.shownComposer().setFocusInsideComposer()===false){if(shouldFocusOnMailView===true&&isNotFocusOnMailList||isFocusOnBody&&shouldFocusOnMailView||isFocusOnRte){if(mario.firefox){setTimeout(function(){keyhandler.focusDomain('listPanel')},1)}keyhandler.focusDomain('listPanel')}}};MailListView.prototype.registerKeys=function(){var that=this;var keyhandler=getKeyHandler();function mailRowsVisible(){var mailList=$('.mailList');return Math.floor(mailList.height()/mailList.find('.list-item').first().height())-1}function pageUpIndex(index){return Math.max(index-mailRowsVisible(),0)}function pageDownIndex(index){return Math.min(index+mailRowsVisible(),that.page().mails().length-1)}var addSliceToSelection=function(index,newIndex){var selection=that.selection;var begin=Math.min(index,newIndex);var end=Math.max(index,newIndex)+1;var newMails=that.page().mails().slice(begin,end);var toAdd=newMails.filter(function(mail){return selection().indexOf(mail)===-1});selection.push.apply(selection,toAdd);that.focused(that.page().mails()[newIndex])};keyhandler.register('mod+p',function(){var mailView=that.shownMailView();if(mailView){mailView.print()}return false});keyhandler.register('listPanel','mod+shift+pagedown',function(){var index=that.page().mails().indexOf(that.focused());var newIndex=pageDownIndex(index);addSliceToSelection(index,newIndex);return false});keyhandler.register('listPanel','mod+shift+pageup',function(){var index=that.page().mails().indexOf(that.focused());var newIndex=pageUpIndex(index);addSliceToSelection(index,newIndex);return false});var expandSelectionToIndex=function(newIndex){var anchorIndex=that.page().mails().indexOf(that.anchor());if(anchorIndex<newIndex+1){that.selection(that.page().mails().slice(anchorIndex,newIndex+1))}else{that.selection(that.page().mails().slice(newIndex,anchorIndex))}that.focused(that.page().mails()[newIndex])};keyhandler.register('listPanel','shift+pagedown',function(){var index=that.page().mails().indexOf(that.focused());var newIndex=pageDownIndex(index);expandSelectionToIndex(newIndex);return false});keyhandler.register('listPanel','shift+pageup',function(){var index=that.page().mails().indexOf(that.focused());var newIndex=pageUpIndex(index);expandSelectionToIndex(newIndex);return false});var moveFocusToIndex=function(newIndex){that.focused(that.page().mails()[newIndex]);that.anchor(that.page().mails()[newIndex])};keyhandler.register('listPanel','mod+pagedown',function(){var index=that.page().mails().indexOf(that.focused());var newIndex=pageDownIndex(index);moveFocusToIndex(newIndex);return false});keyhandler.register('listPanel','mod+pageup',function(){var index=that.page().mails().indexOf(that.focused());var newIndex=pageUpIndex(index);moveFocusToIndex(newIndex);return false});var selectIndex=function(newIndex){that.selection(that.page().mails().slice(newIndex,newIndex+1))};keyhandler.register('listPanel','pagedown',function(){var index=that.page().mails().indexOf(that.focused());var newIndex=pageDownIndex(index);moveFocusToIndex(newIndex);selectIndex(newIndex);return false});keyhandler.register('listPanel','pageup',function(){var index=that.page().mails().indexOf(that.focused());var newIndex=pageUpIndex(index);moveFocusToIndex(newIndex);selectIndex(newIndex);return false});keyhandler.register('listPanel',['enter','o'],function(){if(that.focused()){that.pageNavigator.show(that.folder().id(),that.page().index,that.focused().uid,that.getOptions())}});keyhandler.register('listPanel','tab',function(){if(that.layout.isStackView()){keyhandler.focusDomain('sidebar');return false}if(that.shownComposer()){that.shownComposer().setFocusInsideComposer(false)}var domains=keyhandler.listDomains();if(domains.indexOf('mailView')!==-1){that.setFocusInMailView(false);keyhandler.focusDomain('mailView')}else if(domains.indexOf('composer')!==-1){that.setFocusInMailView(false);keyhandler.focusDomain('composer')}else{keyhandler.focusDomain('sidebar')}return false});keyhandler.register('listPanel','shift+tab',function(){that.setFocusInMailView(false);if(that.shownComposer()){that.shownComposer().setFocusInsideComposer(false)}keyhandler.focusDomain('sidebar');return false});that.layout.currentLayout.subscribe(function(currentLayout){keyhandler.removeDomain('listPanel');keyhandler.removeDomain('listSearch')},null,'beforeChange');keyhandler.register(['listPanel','mailView'],'r',function(){if(that.selected()){var mailView=that.shownMailView();if(!mailView){mailView=that.getMailView(that.selected(),false)}mailView.reply();tracking.track('navigation','open reply','key combo')}return false});keyhandler.register(['listPanel','mailView'],'shift+r',function(){if(that.selected()){var mailView=that.shownMailView();if(!mailView){mailView=that.getMailView(that.selected(),false)}mailView.replyAll();tracking.track('navigation','open reply all','key combo')}return false});keyhandler.register(['listPanel','mailView'],'f',function(){if(that.selected()){var mailView=that.shownMailView();if(!mailView){mailView=that.getMailView(that.selected(),false)}mailView.forward();tracking.track('navigation','open forward','key combo')}return false});keyhandler.register(['listPanel','mailView'],'s',function(){if(that.addFlagToggleState()){that.removeFlag()}else{that.addFlag()}return false});keyhandler.register(['listPanel','mailView'],'u',function(){if(that.markAsSeenToggleState()){that.markAsUnseen()}else{that.markAsSeen()}return false});keyhandler.register(['listPanel','mailView'],['mod+backspace','del'],function(){that.deleteSelectedMails()});keyhandler.register(['listPanel','mailView'],'m',function(){if(that.selection().length>0&&that.layout.contentPanel.template()!=='composer'){that.moveToFolder.openState(true)}return false});keyhandler.register(['listPanel','mailView'],'j',function(){that.showNextMail()});keyhandler.register(['listPanel','mailView'],'k',function(){that.showPreviousMail()});keyhandler.register('listPanel','mod+a',function(){that.selection(that.currentMailList());return false});keyhandler.register('listSearch',['tab','shift+tab'],function(){keyhandler.focusDomain('listPanel');return false})};MailListView.prototype.getPageSize=function(){if(this.state.isTouch){return 50}else{return this.state.preferences.mail()&&this.state.preferences.mail().pageSize||50}};MailListView.prototype.previousPage=function(viewLast){this.gotoPage(this.page().index-1,viewLast?'last':null)};MailListView.prototype.nextPage=function(viewFirst){this.gotoPage(this.page().index+1,viewFirst?'first':null)};MailListView.prototype.gotoPage=function(pageIndex,afterLoad){this.pageNavigator.show(this.folder().id(),pageIndex,null,this.getOptions(),afterLoad)};MailListView.prototype.setContentPanel=function(viewModel,done){if(viewModel&&this.layout.isStackView()){getKeyHandler().removeDomain('listPanel');getKeyHandler().removeDomain('listSearch')}this.layout.setContentPanel(viewModel,done)};MailListView.prototype.getMailView=function(mail,standalone){return new MailView({state:this.state,layout:this.layout,actionExecutor:this.actionExecutor,errorHandler:this.errorHandler,parentView:this,mail:mail,standalone:standalone})};MailListView.prototype.viewMail=function(mail,standalone){var that=this;var keyhandler=getKeyHandler();if(!mail){that.shownMailView(null);that.setContentPanel(null);if(this.selection().length===1){this.selection([])}}else if(mail.isDraft()){var composer=that.mailTabs&&that.mailTabs.findComposerForDraft(mail);if(!composer){composer=Composer.edit(that.state,that.errorHandler,that.actionExecutor,mail);composer.restoreFromLocalStorage()}that.setContentPanel(composer,function(){that.state.signals.composerOpened.dispatch(composer);that.shownMailView(null);if(that.folder()===mail.folder()&&(that.selection()[0]!==mail||that.selection().length!==1)){that.selection([mail])}that.focused(mail);composer.beginEdit()})}else{if(that.layout.contentPanel.viewModel instanceof MailView&&that.layout.contentPanel.viewModel.mail===mail){return}that.shownMailView(that.getMailView(mail,standalone));that.setContentPanel(that.shownMailView(),function(){if(that.layout.isStackView()){keyhandler.focusDomain('mailView')}});if(that.selection()[0]!==mail||that.selection().length!==1){that.selection([mail])}that.focused(mail);if(that.activeMailSeenTimer){clearTimeout(that.activeMailSeenTimer);that.activeMailSeenTimer=null}if(!mail.seen()){that.activeMailSeenTimer=setTimeout(function(){if(that.selected()===mail){that.markAsSeen()}},750)}}};MailListView.prototype.viewMailByUid=function(uid){this.viewMail(this.folder().mailCache.get(uid))};MailListView.prototype.showNextMail=function(){var mailView=this.shownMailView();var mail;if(mailView){if(mailView.hasNext()){if(mailView.pagePosition()===this.search().pageLength-1){this.nextPage(true)}else if(mailView.pagePosition()>=0){mail=this.page().mails()[mailView.pagePosition()+1];this.pageNavigator.show(this.folder().id(),this.page().index,mail.uid,this.getOptions())}}}else if(this.focused()){var index=this.page().mails().indexOf(this.focused())+1;if(index<this.page().length()){mail=this.page().mails()[index];this.pageNavigator.show(this.folder().id(),this.page().index,mail.uid,this.getOptions())}else if(this.page().hasNextPage()){this.nextPage(true)}}};MailListView.prototype.showPreviousMail=function(){var mailView=this.shownMailView();var mail;if(mailView){if(mailView.hasPrevious()){if(mailView.pagePosition()>0){mail=this.page().mails()[mailView.pagePosition()-1];this.pageNavigator.show(this.folder().id(),this.page().index,mail.uid,this.getOptions())}else{this.previousPage(true)}}}else if(this.focused()){var index=this.page().mails().indexOf(this.focused());if(this.page().index>1&&index===0){this.previousPage(true)}else if(index>0){index=index-1;mail=this.page().mails()[index];this.pageNavigator.show(this.folder().id(),this.page().index,mail.uid,this.getOptions())}}};MailListView.prototype.setSelection=function(criteria){if(typeof criteria==='function'){this.selection(this.page().mails().filter(criteria))}else{this.selection(criteria)}};MailListView.prototype.selectAll=function(){var that=this;that.setSelection([].concat(that.page().mails()))};MailListView.prototype.deselectAll=function(){var that=this;if(!that.focused()){that.focused(that.page().mails()[0])}that.selection([])};MailListView.prototype.selectRead=function(){var that=this;that.setSelection(function(mail){return mail.seen()})};MailListView.prototype.selectUnread=function(){var that=this;that.setSelection(function(mail){return!mail.seen()})};MailListView.prototype.selectFlagged=function(){var that=this;that.setSelection(function(mail){return mail.flagged()})};MailListView.prototype.getMailUID=function(){var mailView=this.shownMailView();if(mailView){return mailView.mail.uid}else{return null}};MailListView.prototype.getOptions=function(){var query={};if(this.search()){if(this.search().query&&this.search().query.trim().length>0){query.search=this.search().query}if(this.search().viewFilter!=='ALL'){query.filter=this.search().viewFilter}if(this.search().sortKey!=='ARRIVAL'){query.sortKey=this.search().sortKey}if(this.search().sortDirection!=='DESC'){query.sortDirection=this.search().sortDirection}}if(this.shownComposer()){var draft=this.shownComposer().draftBeingEdited();if(draft){if(draft.folder()!==this.folder()){query.compose=draft.uid;query.folder=draft.folder().id()}}else{query.compose='new'}}if(this.shownMailView()&&this.shownMailView().standalone){query.standalone=true}return query};MailListView.prototype.setViewFilter=function(filter){var options=this.getOptions();if(filter==='ALL'){delete options.filter}else{options.filter=filter}this.pageNavigator.show(this.folder().id(),1,this.getMailUID(),options)};MailListView.prototype.setSortKey=function(key){var options=this.getOptions();if(key==='ARRIVAL'){delete options.sortKey}else{options.sortKey=key}this.pageNavigator.show(this.folder().id(),1,this.getMailUID(),options)};MailListView.prototype.setSortDirection=function(dir){var options=this.getOptions();if(dir==='DESC'){delete options.sortDirection}else{options.sortDirection=dir}this.pageNavigator.show(this.folder().id(),1,this.getMailUID(),options)};MailListView.prototype.firstFolderPage=function(){return this.folder().search({pageLength:this.getPageSize()}).firstPage()};MailListView.prototype.gotoFirstFolderPage=function(){this.page(this.firstFolderPage())};MailListView.prototype.querySearch=function(){tracking.track('navigation','search');var query=this.searchInputValue().trim();var options=this.getOptions();options.search=query;this.pageNavigator.show(this.folder().id(),1,this.getMailUID(),options)};MailListView.prototype.resetSearchQuery=function(){var options=this.getOptions();delete options.search;this.pageNavigator.show(this.folder().id(),this.page().index,this.getMailUID(),options)};MailListView.prototype.addFlagToggle=function(){if(this.addFlagToggleState()){this.removeFlag()}else{this.addFlag()}this.closeMarkDropdown()};MailListView.prototype.markAsSeenToggle=function(){if(this.markAsSeenToggleState()){this.markAsUnseen()}else{this.markAsSeen()}this.closeMarkDropdown()};MailListView.prototype.moveToFolderHide=function(){$('.move-to-folder-list').addClass('hide');this.moveToFolder.openState(false);var options=this.getOptions();delete options.moving;this.pageNavigator.redirect(this.folder().id(),this.page().index,null,options)};MailListView.prototype.moveToFolderShow=function(){var selection=this.selection();$('.move-to-folder-list').removeClass('hide');this.moveToFolder.openState(true);var options=this.getOptions();options.moving=true;this.pageNavigator.show(this.folder().id(),this.page().index,this.getMailUID(),options);this.selection(selection)};MailListView.prototype.moveToFolderMoveMails=function(targetFolder){var mails=this.selection();var that=this;this.state.notification({message:inter.trQuantity(TR('mail.MoveMails',{one:'Moving {0} mail',other:'Moving {0} mails'}),mails.length||1),timeout:1500});tracking.track('action','move mails','menu');this.moveToFolderHide();if(this.detachViewFromSelection()&&this.layout.stackView.isContentPanelVisible()){this.pageNavigator.show(this.folder().id(),this.page().index,null,this.getOptions())}var nextEmail;if(that.layout.isSplitView()&&that.currentMailList().length>mails.length){nextEmail=that.getNextMail(mails)}this.executeMoveMails(mails,targetFolder,function(){if(nextEmail){that.pageNavigator.show(that.folder().id(),that.page().index,nextEmail.uid,that.getOptions())}});getKeyHandler().focusDomain('listPanel')};MailListView.prototype.setFlag=function(flag,value){this.executeSetFlag(this.selection(),flag,value)};MailListView.prototype.removeFlag=function(){this.setFlag(Flag.FLAGGED,false)};MailListView.prototype.addFlag=function(){this.setFlag(Flag.FLAGGED,true)};MailListView.prototype.markAsSeen=function(){this.setFlag(Flag.SEEN,true)};MailListView.prototype.markAsUnseen=function(){this.setFlag(Flag.SEEN,false)};MailListView.prototype.printMail=function(){var that=this,mailView=that.shownMailView();if(!(mailView instanceof MailView)){return}mailView.print()};MailListView.prototype.createFilter=function(){var mail=this.shownMailView().mail;var from=mail.from()[0].getEmail();var subject=mail.subject();var mailData={};mailData.from=from;mailData.subject=subject;var url='/settings/'+this.state.user()+'/filters?new=true';AppCourier.depart(url,mailData)};MailListView.prototype.createSenderPattern=function(data){var sendersPattern=[];data.forEach(function(sender){if(Object.prototype.toString.call(sender)==='[object String]'){sendersPattern.push(new SenderPattern(sender))}});return sendersPattern};MailListView.prototype.saveBlockedSenders=function(){var that=this,mails=that.selection(),senders=that.getSenders(mails);var blocked=that.state.filterData.blocked();var senderPattern=that.createSenderPattern(senders);blocked=blocked.concat(senderPattern);that.state.filterData.blocked(blocked);that.executeAction(new SaveFiltersAction({filterData:that.state.filterData}),function(err,data){if(err){that.handleError(err)}else{that.executeMoveMails(mails,that.state.folders.spam,function(){that.state.notification({message:inter.trQuantity(TR('mail.SaveBlockSender',{one:'Sender has been blocked. Go to settings to unblock again',other:'Senders have been blocked. Go to settings to unblock again'}),senders.length||1),timeout:3000})})}})};MailListView.prototype.loadBlockedFilters=function(cb){var that=this,mails=that.selection(),blockedSenderPattern,isSenderBlocked,senders=that.getSenders(mails);that.executeAction(new LoadFiltersAction({filterData:that.state.filterData}),function(err,data){if(err){that.handleError(err)}else{that.sendersAlreadyBlocked([]);blockedSenderPattern=that.state.filterData.blocked();senders=that.getSenders(mails);isSenderBlocked=that.checkIfSendersWereBlocked(senders,blockedSenderPattern);if(cb){cb(isSenderBlocked,that.sendersAlreadyBlocked())}}})};MailListView.prototype.blockSenders=function(){var that=this,mails=that.selection(),messages;that.closeLabel=TR('mail.Close','Close');that.cancelLabel=TR('mail.Cancel','Cancel');that.confirmLabel=TR('mail.Ok','OK');that.loadBlockedFilters(function(isSenderBlocked,sendersAlreadyBlocked){var senders=that.getSenders(mails);if(isSenderBlocked===false){messages=that.getMessages(senders,isSenderBlocked);that.dialogueContentOfBlockedSenders(messages);that.showConfirmationDialog(true);that.blockSenderDialog(true)}else{messages=that.getMessages(senders,isSenderBlocked);that.dialogueContentOfBlockedSenders(messages);that.showConfirmationDialog(true);that.showDialogWithAlreadyBlockedSenders(true)}})};MailListView.prototype.editAsNew=function(mail){var that=this;var composer=Composer.editAsNew(that.state,that.errorHandler,that.actionExecutor,mail);composer.afterInit=function(){composer.toView.focusInput();that.state.signals.composerOpened.dispatch(composer)};composer.saveMail(true,function(){that.mailTabs.add(composer);var draft=composer.draftBeingEdited();var options=that.getOptions();options.compose=draft.uid;options.folder=draft.folder().id();that.pageNavigator.show(that.folder().id(),that.page().index,that.getMailUID(),options)})};MailListView.prototype.executeMoveMails=function(mails,destination,done){var that=this;this.executeAction(new MoveMailsAction({mails:mails,destination:destination}),function(err){that.state.notification(null);if(err){that.handleError(err)}if(typeof done==='function'){done()}})};MailListView.prototype.executeDeleteMails=function(mails,done){var that=this;this.executeAction(new DeleteMailsAction({mails:mails}),function(err){that.state.notification(null);if(err){that.handleError(err)}if(typeof done==='function'){done()}})};MailListView.prototype.executeSetFlag=function(mails,flag,value){mails=[].concat(mails);if(mails&&mails.length>0){var that=this;this.executeAction(new SetFlagAction({mails:mails,flag:flag,value:value}),function(err){if(err){that.handleError(err)}})}};MailListView.prototype.loadMails=function(silent,done){var that=this;this.executeAction(new LoadMailsAction({page:this.page(),silent:silent}),function(err){if(err){that.handleError(err)}else if(typeof done==='function'){done()}})};MailListView.prototype.loadOnlyMissingMails=function(silent,done){var that=this;var firstIndex=that.page().firstMailIndex()+that.page().mails().length;var page={search:{pageLength:that.search().pageLength-that.page().mails().length,folder:that.folder(),query:that.search().query,viewFilter:that.search().viewFilter,sortExpression:function(){return that.search().sortExpression()},length:ko.observable(),ready:function(){}},dirty:true,busy:ko.observable(false),failed:false,index:1,firstMailIndex:function(){return firstIndex},mailUids:ko.observableArray()};that.executeAction(new LoadMailsAction({page:page,silent:silent}),function(err){if(err){that.handleError(err);return}var uidList=that.page().mailUids().concat(page.mailUids());that.page().mailUids(uidList);if(typeof done==='function'){done()}})};MailListView.prototype.deleteMails=function(mails){if(mails.length===0){return}var that=this;var folder=mails[0].folder();var nextEmail;if(that.layout.isSplitView()&&that.currentMailList().length>mails.length){nextEmail=that.getNextMail(mails);if(nextEmail){that.pageNavigator.show(that.folder().id(),that.page().index,nextEmail.uid,that.getOptions())}else{that.pageNavigator.show(that.folder().id(),that.page().index,null,that.getOptions())}}else{that.pageNavigator.show(that.folder().id(),that.page().index,null,that.getOptions())}if(folder&&folder.isTrashFolder()){that.state.notification({message:inter.trQuantity(TR('mail.DeletingMails',{one:'Deleting {0} email',other:'Deleting {0} emails'}),mails.length||1),timeout:1500});that.executeDeleteMails(mails)}else{that.state.notification({message:inter.trQuantity(TR('mail.MovedMailToTrash',{one:'{0} email moved to trash',other:'{0} emails moved to trash'}),mails.length||1),timeout:1500});var trash=that.state.folders.trash;that.executeMoveMails(mails,trash)}};MailListView.prototype.deleteSelectedMails=function(){this.deleteMails(this.selection())};MailListView.prototype.searchFolder=function(options){if(!this.folder()||!this.search()){return}options=util.extend(util.pick(this.search(),['sortKey','sortDirection','viewFilter','query','pageLength']),options);this.page(this.folder().search(options).firstPage())};MailListView.prototype.viewMailSource=function(mail){var that=this,mailview=that.shownMailView();if(!(mail instanceof Mail)&&mailview instanceof MailView){mail=mailview.mail}if(!(mail instanceof Mail)){return}var sourceUrl=mail.getMailUrl()+'/all';window.open(sourceUrl)};MailListView.prototype.editMailAsNew=function(mail){var that=this,mailview=that.shownMailView();if(!(mail instanceof Mail)&&mailview instanceof MailView){mail=mailview.mail}if(!(mail instanceof Mail)){return}this.editAsNew(mail)};MailListView.prototype.openInNewWindow=function(){var mailview=this.shownMailView(),mail=mailview.mail;var standaloneUrl='/'+this.state.user()+'/'+encodeURIComponent(mail.folder().id())+'/1/'+mail.uid+'?standalone=true';var $mailView=$('.mailView');var windowFeaturesList=[];var windowFeatures={'toolbar':'0','menubar':'0','location':'0','scrollbars':'yes',height:$mailView.height(),width:$mailView.width()};Object.keys(windowFeatures).forEach(function(key){windowFeaturesList.push(key+'='+windowFeatures[key])});window.open(standaloneUrl,'_blank',windowFeaturesList.join(','))};MailListView.prototype.resetFolderStateAndLoadMails=function(){var that=this;if(this.layout.isStackView()){that.pageNavigator.show(that.folder().id(),that.page().index,null,that.getOptions())}that.scrollMailListToTop();that.loadMails(false,function(){that.restoreSelection()})};MailListView.prototype.scrollFocusedIntoView=function(){var that=this,focused=$('.mailList .focused');if(that.mailListScrollPane&&focused.length>0){that.mailListScrollPane.scrollIntoView(focused)}};MailListView.prototype.scrollMailListToTop=function(){if(this.mailListScrollPane){this.mailListScrollPane.scrollToTop()}};MailListView.prototype.setupMailList=function(element){var that=this;var mailList=$(element),mailListContainer=$('.mailList'),viewMailTimer=null;var offsets={};var $search=$('.touch .search');if($search&&!this.hasSearchQuery()){offsets.top=$search.height()}that.mailListScrollPane=new ScrollPane(mailListContainer,offsets);that.subscriptions.push(that.focused.subscribe(function(){setTimeout(function(){that.scrollFocusedIntoView()},0)}));mailList.on('mousedown','.star',function(e){if(e.which===1){var item=ko.dataFor(e.target);tracking.track('mail list','toggle star','starred '+!item.flagged());that.executeSetFlag(item,Flag.FLAGGED,!item.flagged());e.stopPropagation()}});mailList.on('mousedown','.read',function(e){if(e.which===1){var item=ko.dataFor(e.target);tracking.track('mail list','toggle read','read '+!item.seen());that.executeSetFlag(item,Flag.SEEN,!item.seen());clearTimeout(that.activeMailSeenTimer);e.stopPropagation()}});mailList.on('click','.list-item',function(e){e.preventDefault();e.stopPropagation();var clickedInControl=$(e.target).closest('.checkbutton, .draghandle, .read, .star').length>0;if(e.which===1&&!clickedInControl&&!util.hasModifierKey(e)){var newMail=ko.dataFor(this);if(that.detachViewFromSelection()){that.pageNavigator.show(that.folder().id(),that.page().index,newMail.uid,that.getOptions())}}clearTimeout(viewMailTimer)});that.scrollMailListToTop();if(that.selected()){that.focused(that.selected());that.scrollFocusedIntoView()}};MailListView.prototype.showSelected=function(){this.pageNavigator.show(this.folder().id(),this.page().index,this.selected()&&this.selected().uid,this.getOptions())};return MailListView})}());(function(){var define=System.amdDefine;define('webmail/CacheManager.js',[],function(){function getCachingConfig(touch){var config=CONFIG.frontend.mail.caching;return config[touch?'touch':'desktop']}function CacheManager(state){this.state=state;this.lastCleanup=Date.now()}CacheManager.prototype.getPageReferenceIndex=function(){var result={pagesWithReferences:[],pagesWithNoReferences:[]};this.state.folders.list().forEach(function(folder){folder.searchCache.getAll().forEach(function(search){search.pageCache.getAll().forEach(function(page){if(page.hasReferences()){result.pagesWithReferences.push(page)}else{result.pagesWithNoReferences.push(page)}})})});return result};CacheManager.prototype.getMailReferenceIndex=function(){var result={mailsWithReferences:[],mailsWithNoReferences:[]};this.state.folders.list().forEach(function(folder){folder.mailCache.getAll().forEach(function(mail){if(mail.hasReferences()){result.mailsWithReferences.push(mail)}else{result.mailsWithNoReferences.push(mail)}})});return result};CacheManager.prototype.cleanup=function(){var cachingConfig=getCachingConfig(this.state.isTouch);if(Date.now()-this.lastCleanup<cachingConfig.cleanupInterval){return}var pageReferenceIndex=this.getPageReferenceIndex();var pagesWithReferences=pageReferenceIndex.pagesWithReferences;var pagesWithNoReferences=pageReferenceIndex.pagesWithNoReferences;var pagesToRetain=Math.max(0,cachingConfig.pagesToRetain-pagesWithReferences.length);pagesWithNoReferences.sort(function(a,b){return b.lastReferenceTime()-a.lastReferenceTime()});pagesWithNoReferences.slice(pagesToRetain).forEach(function(page){page.evict()});var mailReferenceIndex=this.getMailReferenceIndex();var mailsWithReferences=mailReferenceIndex.mailsWithReferences;var mailsWithNoReferences=mailReferenceIndex.mailsWithNoReferences;var mailsToRetain=Math.max(0,cachingConfig.mailsToRetain-mailsWithReferences.length);mailsWithNoReferences.sort(function(a,b){return b.lastReferenceTime()-a.lastReferenceTime()});mailsWithNoReferences.slice(mailsToRetain).forEach(function(mail){mail.evict()})};CacheManager.prototype.stats=function(){var stats={folders:{},total:{mails:0,searches:0,pages:0}};this.state.folders.list().forEach(function(folder){var mails=folder.mailCache.getAll();if(!folder.searchCache.isEmpty()||!folder.mailCache.isEmpty()){var searches=folder.searchCache.getAll();stats.folders[folder.id()]={mails:mails.length,searches:searches.length,pages:0};searches.forEach(function(search){var pages=search.pageCache.getAll();stats.folders[folder.id()].pages=pages.length;stats.total.pages+=pages.length});stats.total.searches+=searches.length}stats.total.mails+=mails.length});return stats};return CacheManager})}());(function(){var define=System.amdDefine;define('common/model/Page.js',['node_modules/knockout/build/output/knockout-latest.debug.js','3rdparty/signals.js','common/ReferenceCountBehavior.js'],function(ko,signals,ReferenceCountBehavior){function Page(search,index){var that=this;ReferenceCountBehavior.installInto(this);that.busy=ko.observable(false);that.search=search;that.index=index||1;var mailCache=that.search.folder.mailCache;that.mailUids=ko.observableArray();that.dirty=true;that.failed=false;that.mails=ko.pureComputed(function(){return that.mailUids().map(function(uid){return mailCache.get(uid)}).filter(function(mail){return mail})});that.length=ko.pureComputed(function(){if(that.index>search.pageCount()){return 0}if(search.length()===0){return 0}return that.index===search.pageCount()?search.length()%search.pageLength||search.pageLength:search.pageLength});that.loaded=ko.pureComputed(function(){return that.search.isReady()&&that.mails().length===that.length()});var prevMails;var sub1=that.mailUids.subscribe(function(mails){prevMails=[].concat(that.mails())},null,'beforeChange');var sub2=that.mails.subscribe(function(mails){mails.forEach(function(mail){mail.incrementReferences()});prevMails.forEach(function(mail){mail.decrementReferences()});prevMails=null});that.hasNextPage=ko.pureComputed(function(){return this.index<this.search.pageCount()},this);that.hasPreviousPage=ko.pureComputed(function(){return this.index>1},this);that.dispose=function(){that.mails().forEach(function(mail){mail.decrementReferences()});that.mails.dispose();sub1.dispose();sub2.dispose()};that.lastReferenceRemoved=new signals.Signal}Page.prototype.onNotReferenced=function(){this.lastReferenceRemoved.dispatch()};Page.prototype.firstMailIndex=function(){return(this.index-1)*this.search.pageLength+1};Page.prototype.lastMailIndex=function(){if(this.search.length()===0){return this.firstMailIndex()}return Math.min(this.firstMailIndex()-1+this.search.pageLength,this.search.length())};Page.prototype.nextPage=function(){return this.search.getPage(this.index+1)};Page.prototype.previousPage=function(){return this.search.getPage(this.index-1)};Page.prototype.evict=function(){if(this.hasReferences()){throw new Error('You can\'t evict a page with references')}this.search.pageCache.evict(this);if(this.search.pageCache.isEmpty()){this.search.evict()}};Page.prototype.mailUidUpdated=function(oldUid,newUid){var index=this.mailUids.indexOf(oldUid);if(index!==-1){this.mailUids.splice(index,1,newUid);this.dirty=true}};return Page})}());(function(){var define=System.amdDefine;define('common/Cache.js',[],function(){function Cache(createKey){if(typeof createKey!=='function'){throw new Error('A cache must be instantiated with a createKey function')}this.data={};this.createKey=createKey}function disposeValue(value){if(value&&value.dispose){value.dispose()}}Cache.prototype.store=function(values){if(!Array.isArray(values)){values=[values]}values.forEach(function(value){var key=this.createKey(value);if(!(key in this.data)){this.data[key]=value}},this);return this};Cache.prototype.get=function(key){return this.data[key]||null};Cache.prototype.getAll=function(){return Object.keys(this.data).map(function(key){return this.data[key]},this)};Cache.prototype.remove=function(values){if(!Array.isArray(values)){values=[values]}values.forEach(function(value){var key=this.createKey(value);delete this.data[key]},this);return this};Cache.prototype.evict=function(values){if(!Array.isArray(values)){values=[values]}values.forEach(function(value){var key=this.createKey(value);delete this.data[key];disposeValue(value)},this);return this};Cache.prototype.contains=function(values){if(!Array.isArray(values)){values=[values]}return values.every(function(value){var key=this.createKey(value);return key in this.data},this)};Cache.prototype.clear=function(){this.getAll().forEach(function(value){disposeValue(value)});this.data={};return this};Cache.prototype.dispose=function(){this.clear()};Cache.prototype.isEmpty=function(){return Object.keys(this.data).length===0};Cache.prototype.keyUpdated=function(oldKey,value){delete this.data[oldKey];this.store(value)};return Cache})}());(function(){var define=System.amdDefine;define('common/model/Search.js',['node_modules/knockout/build/output/knockout-latest.debug.js','common/model/Page.js','common/Cache.js','common/util.js'],function(ko,Page,Cache,util){function Search(options){var that=this;util.extend(this,util.pick(options,['folder','sortKey','sortDirection','viewFilter','query','pageLength']));that.length=ko.observable(0);that.pageCache=new Cache(function(page){return page.index});that.pageCount=ko.pureComputed(function(){return Math.max(Math.ceil(that.length()/that.pageLength),1)});that.findLastPage=function(amountOfEmails,pageSize){var result=amountOfEmails/pageSize;return Math.ceil(result)};that.lastPage=ko.observable();var searchIsReady=ko.observable(false);that.ready=function(){searchIsReady(true)};that.isReady=ko.pureComputed(function(){return searchIsReady()})}Search.prototype.getPage=function(index){if(typeof index!=='number'){throw new Error('search.getPage must be called with a number')}var page=this.pageCache.get(index);if(!page){page=new Page(this,index);this.pageCache.store(page)}return page};Search.prototype.firstPage=function(){return this.getPage(1)};Search.prototype.sortExpression=function(){var sortExpression=[];var expression={};expression[this.sortKey]=this.sortDirection;sortExpression.push(expression);if(this.sortKey!=='ARRIVAL'){sortExpression.push({ARRIVAL:'DESC'})}return sortExpression};Search.prototype.invalidateCache=function(){this.pageCache.getAll().forEach(function(page){if(page.hasReferences()){page.failed=false;page.dirty=true}else{page.evict()}},this)};function getPagesChains(pageCache){var pages=pageCache.getAll();pages.sort(function(a,b){return a.index-b.index});var pageChains=[];var currentChain=[];pages.forEach(function(page){currentChain.push(page);if(!pageCache.get(page.index+1)){pageChains.push(currentChain);currentChain=[]}});if(currentChain.length>0){pageChains.push(currentChain)}return pageChains}function getUidsFromPageChain(pageChain){var uids=[];pageChain.forEach(function(page){Array.prototype.push.apply(uids,page.mailUids())});return uids}function updateChainWithUids(pageChain,uids){var offset=0;pageChain.forEach(function(page,index){page.mailUids(uids.slice(offset,offset+page.length()));offset+=page.length()})}Search.prototype.removeMails=function(mails){var pages=this.pageCache.getAll();pages.sort(function(a,b){return a.index-b.index});var uidsToBeRemoved=util.uniqueIndexBy(mails,'uid');var pageChains=getPagesChains(this.pageCache);var removed=0;pageChains.forEach(function(pageChain){var uids=getUidsFromPageChain(pageChain);var indexedUids=util.indexBy(uids,function(uid){return uid in uidsToBeRemoved?'remove':'keep'});updateChainWithUids(pageChain,(indexedUids.keep||[]).slice(removed));removed+=(indexedUids.remove||[]).length});this.length(this.length()-removed);pageChains.forEach(function(pageChain){pageChain.forEach(function(page){if(page.mailUids().length<page.length()){page.dirty=true}if(page.mailUids().length===0&&!page.hasReferences()){page.evict()}})})};Search.prototype.evict=function(){this.pageCache.clear();this.folder.searchCache.evict(this)};Search.prototype.mailUidUpdated=function(oldUid,newUid){this.pageCache.getAll().forEach(function(page){page.mailUidUpdated(oldUid,newUid)})};Search.prototype.dispose=function(){this.pageCache.dispose()};return Search})}());(function(){var define=System.amdDefine;define('3rdparty/knockout.validation.js',['node_modules/knockout/build/output/knockout-latest.debug.js','3rdparty/onevalidation/validation.js'],function(ko,validation){var validations={present:function(value){if(value){return/\S+/.test(value)}else{return false}},email:function(value){return validation.email.test(value)},emailIdn:function(value){return validation.emailIdn.test(value)},domain:function(value){return validation.domain.test(value)},domainIdn:function(value){return validation.domainIdn.test(value)},password:function(value){return/^[!-~]{6,64}$/.test(value)},folderName:function(value){return/^[^\\\/\.]*$/.test(value)},notNull:function(value){return value!==null}};function capitalize(value){return value.charAt(0).toUpperCase()+value.substr(1)}function createValidator(name){return function(target){function validate(value){return validations[name](value)}target['is'+capitalize(name)]=ko.observable(validate(target()));target['isNot'+capitalize(name)]=ko.computed(function(){return!target['is'+capitalize(name)]()});target.subscribe(function(newValue){target['is'+capitalize(name)](validate(newValue))});if(!target.hasOwnProperty('isValid')&&!target.hasOwnProperty('isNotValid')){target.isValid=ko.computed(function(){var valid=true;for(var k in validations){if(target.hasOwnProperty('is'+capitalize(k))){valid=target['is'+capitalize(k)]()}}return valid});target.isNotValid=ko.computed(function(){return!target.isValid()})}return target}}for(var v in validations){ko.extenders[v]=createValidator(v)}})}());(function(){var define=System.amdDefine;define('common/model/Folder.js',['node_modules/knockout/build/output/knockout-latest.debug.js','common/Cache.js','common/model/Search.js','common/util.js','3rdparty/knockout.validation.js'],function(ko,Cache,Search,util){function createSearchKey(options){var uidValidity=options.folder.uidvalidity()||'';return options.folder.id()+(options.folder.isSystemFolder()?'':uidValidity)+options.pageLength+(options.sortKey||'')+(options.sortDirection||'')+(options.viewFilter||'')+(options.query||'')}var defaultPageLength=50;function Folder(data,parent){var that=this;that.subscriptions=[];data.children=data.children||[];that.busy=ko.observable(false);that.dirty=false;that.parent=ko.observable(parent);var parentId=parent&&parent.id()||null;var id=data.id||parentId+'.';that.id=ko.observable(id);that.isNew=ko.observable(data.isNew||false);that.name=ko.computed({read:function(){return that.id().split(/\./).pop()},write:function(value){var id=that.id().split(/\./);id[id.length-1]=value;that.changeIdRecursively(id.join('.'))}});that.translatedName=ko.computed(function(){return util.translatedFolderName(that.id())});that.closestSystemFolder=ko.computed(function(){if(that.isSystemFolder()){return that}else if(!that.parent()){return null}else{return that.parent().closestSystemFolder()}});that.supportRename=ko.computed(function(){return that.isCustomFolder()});that.supportDelete=ko.computed(function(){return that.isTrashFolder()});that.supportMoveToTrash=ko.computed(function(){return that.isCustomFolder()&&!that.isTrashFolder()});that.messages=ko.observable(data.messages||0);that.unseen=ko.observable(data.unseen||0);that.highestmodseq=ko.observable(data.highestmodseq);that.uidvalidity=ko.observable(data.uidValidity);that.collapsed=ko.observable(!!data.collapsed);that.children=ko.observableArray(data.children.map(function(child){return new Folder(child,that)}));that.indicator=ko.computed(function(){if(that.isTrashFolder()||that.isSentFolder()){return 0}if(that.isDraftFolder()){if(that.collapsed()){return that.messages()+that.allChildren().reduce(function(sum,folder){return sum+folder.messages()},0)}else{return that.messages()}}if(that.collapsed()){return that.unseen()+that.allChildren().reduce(function(sum,folder){return sum+folder.unseen()},0)}else{return that.unseen()}});that.label=ko.pureComputed(function(){if(that.indicator()){return that.translatedName()+' ('+that.indicator()+')'}return that.translatedName()});that.dragging=ko.observable(false);that.selected=ko.observable(false);that.collapsable=ko.pureComputed(function(){return!that.collapsed()&&that.children().length>0});that.hidden=ko.pureComputed(function(){var parent=that.parent();return parent&&(parent.collapsed()||parent.hidden())},null,{deferEvaluation:true});that.animated=ko.observable(false);that.subscriptions.push(that.animated.subscribe(function(active){if(active){setTimeout(function(){that.animated(false)},1000)}}));that.depth=ko.pureComputed(function(){if(!that.parent()){return 0}return that.isInbox()||that.parent().isInbox()?0:that.parent().depth()+1},null,{deferEvaluation:true});that.mailCache=new Cache(function(mail){return mail.uid});that.searchCache=new Cache(function(search){return createSearchKey(search)})}Folder.prototype.iconClass='icon-folder';Folder.prototype.allChildren=function(){return this.children().reduce(function(result,folder){result.push(folder);result.push.apply(result,folder.allChildren());return result},[])};Folder.prototype.pathString=function(){if(this.parent()&&!this.parent().isInbox()){return this.parent().pathString()+' » '+this.translatedName()}else{return this.translatedName()}};Folder.prototype.isInbox=function(){return false};Folder.prototype.isDraftFolder=function(){return this.parent()&&this.parent().isDraftFolder()};Folder.prototype.isSentFolder=function(){return this.parent()&&this.parent().isSentFolder()};Folder.prototype.isTrashFolder=function(){return this.parent()&&this.parent().isTrashFolder()};Folder.prototype.isSpamFolder=function(){return this.parent()&&this.parent().isSpamFolder()};Folder.prototype.isOutgoingFolder=function(){return this.parent()&&this.parent().isOutgoingFolder()};Folder.prototype.isSystemFolder=function(){return false};Folder.prototype.isCustomFolder=function(){return true};Folder.prototype.supportCreateSubfolder=function(){return true};Folder.prototype.supportResending=function(){return false};Folder.prototype.supportEmptyFolder=function(){return false};Folder.prototype.supportSpamToTrash=function(){return false};Folder.prototype.animateSelfAndChildren=function(notRoot){if(notRoot){this.animated(true)}if(notRoot&&this.collapsed()){return}this.children().forEach(function(child){child.animateSelfAndChildren(true)})};Folder.prototype.toggleCollapsed=function(){if(this.collapsed()||this.collapsable()){this.animateSelfAndChildren();this.collapsed(!this.collapsed())}};Folder.prototype.equals=function(folder){if(folder instanceof Folder){return this.id()===folder.id()}return false};Folder.prototype.isSuccessorOf=function(predecessor){var predecessorId=predecessor.id()+'.',successorId=this.id().substr(0,this.id().lastIndexOf('.')+1);return successorId.indexOf(predecessorId)===0};Folder.prototype.changeIdRecursively=function(newId){var that=this;that.id(newId);that.children().forEach(function(childFolder){childFolder.changeIdRecursively(that.id()+'.'+childFolder.name())})};Folder.prototype.hasChild=function(name){return this.children().some(function(child){return child.name()===name})};Folder.prototype.remove=function(){var that=this,parent=that.parent();if(parent){parent.children.remove(that)}return that};Folder.prototype.toJS=function(){return{id:this.id(),highestmodseq:this.highestmodseq(),messages:this.messages(),uidValidity:this.uidvalidity(),unseen:this.unseen()}};Folder.prototype.addMails=function(mails){mails=mails.filter(function(mail){return!this.mailCache.get(mail.uid)},this);if(0<mails.length){var unseenCount=mails.filter(function(mail){return!mail.seen()}).length;this.dirty=true;this.invalidateSearches();this.unseen(this.unseen()+unseenCount);this.messages(this.messages()+mails.length)}};Folder.prototype.removeMails=function(mails){mails=mails.filter(function(mail){return this.mailCache.get(mail.uid)},this);if(0<mails.length){var unseenCount=mails.filter(function(mail){return!mail.seen()}).length;this.unseen(this.unseen()-unseenCount);this.messages(this.messages()-mails.length);this.searchCache.getAll().forEach(function(search){search.removeMails(mails)});this.mailCache.remove(mails)}};Folder.prototype.invalidateSearches=function(){this.searchCache.getAll().forEach(function(search){search.invalidateCache()})};Folder.prototype.search=function(options){options=util.extend({pageLength:defaultPageLength,sortKey:'ARRIVAL',sortDirection:'DESC',viewFilter:'ALL',query:''},options);options.folder=this;var key=createSearchKey(options);var search=this.searchCache.get(key);if(!search){search=new Search(options);this.searchCache.store(search)}return search};Folder.prototype.mailUidUpdated=function(oldUid,mail){this.mailCache.keyUpdated(oldUid,mail);this.searchCache.getAll().forEach(function(search){search.mailUidUpdated(oldUid,mail.uid)})};Folder.prototype.setFlags=function(mails,flag,value){if(Array.isArray(value)){if(mails.length!==value.length){throw new Error('Mismatched arguments')}mails.forEach(function(mail,index){mail.setFlag(flag,value[index])})}else{mails.forEach(function(mail){mail.setFlag(flag,value)})}this.searchCache.getAll().filter(function(search){if(flag.name==='seen'){return search.viewFilter==='UNSEEN'}else if(flag.name==='flagged'){return search.viewFilter==='FLAGGED'}}).forEach(function(search){search.pageCache.getAll().forEach(function(page){if(page.hasReferences()){page.lastReferenceRemoved.addOnce(function(){page.dirty=true})}else{page.evict()}})})};Folder.prototype.dispose=function(){this.name.dispose();this.subscriptions.forEach(function(subscription){subscription.dispose()});this.searchCache.dispose();this.mailCache.dispose()};return Folder})}());(function(){var define=System.amdDefine;define('webmail/actions/RefreshFoldersAction.js',['node_modules/knockout/build/output/knockout-latest.debug.js','common/util.js','common/model/Folder.js','common/ActionBehavior.js','3rdparty/LocalStorage.js'],function(ko,util,Folder,ActionBehavior,LocalStorage){function forEachJsonFolder(folders,callback){if(!folders){return}folders.forEach(function(folder){callback(folder);if(folder.children){forEachJsonFolder(folder.children,callback)}})}function RefreshFoldersAction(options){util.extend(this,{retries:2},util.pick(options,'retries','silent'));ActionBehavior.installInto(this)}RefreshFoldersAction.prototype.name='RefreshFoldersAction';RefreshFoldersAction.prototype.models=function(context){var state=context.state;return state.folders.list()};RefreshFoldersAction.prototype.execute=function(context,cb){var that=this;var state=context.state;var backend=context.backend;that.setBusyFlags();backend.listFolders(state.user(),function(err,data){that.removeBusyFlags();data=data||[];var localCache={};var remoteCache={};function getKey(folder,system){return ko.utils.unwrapObservable(folder.id)+(system?'':ko.utils.unwrapObservable(folder.uidvalidity||folder.uidValidity))}if(!err){var localStorage=new LocalStorage(state.user()).subStorage('webmail');var collapsedFoldersIds=localStorage.getJSON('collapsed-folders')||[];forEachJsonFolder(data,function(folder){folder.collapsed=collapsedFoldersIds.indexOf(folder.id)!==-1});forEachJsonFolder(data,function(folder){var isSystemFolder=state.folders.defaults.indexOf(folder.id)!==-1;remoteCache[getKey(folder,isSystemFolder)]=folder});(state.folders.list()||[]).forEach(function(folder){localCache[getKey(folder,folder.isSystemFolder())]=folder});Object.keys(remoteCache).forEach(function(key){var localFolder=localCache[key];var remoteFolder=remoteCache[key];if(localFolder&&localFolder.isSystemFolder()){localFolder.uidvalidity(remoteFolder.uidvalidity||remoteFolder.uidValidity)}if(localFolder&&!localFolder.isNew()){var folderUpdated=(localFolder.highestmodseq()||0)<remoteFolder.highestmodseq;localFolder.unseen(remoteFolder.unseen);if(localFolder.dirty||folderUpdated){localFolder.messages(remoteFolder.messages);localFolder.highestmodseq(remoteFolder.highestmodseq);localFolder.invalidateSearches()}localFolder.dirty=false}});localStorage.setItem('InboxModSeq',state.folders.inbox.highestmodseq());var removedFoldersFromServer=Object.keys(localCache).filter(function(key){return state.folders.defaults.indexOf(key)===-1&&!remoteCache[key]&&(!localCache[key]||!localCache[key].isNew())});var removeSubFoldersFromLocalCache=function(folders){folders=Array.isArray(folders)?folders:[folders];folders.forEach(function(folder){var key=getKey(folder);if(localCache[key]){localCache[key].dispose();delete localCache[key];removeSubFoldersFromLocalCache(folder.children())}})};removedFoldersFromServer.forEach(function(key){var folderToRemove=localCache[key];if(folderToRemove){folderToRemove.remove();removeSubFoldersFromLocalCache(folderToRemove);folderToRemove.dispose()}});state.folders.defaults.forEach(function(key){if(!remoteCache[key]){var folder=localCache[key];if(folder){folder.uidvalidity(null)}}});var newFoldersFromServer=Object.keys(remoteCache).filter(function(key){return!localCache[key]});var addAllSubFolders=function(folders){folders=Array.isArray(folders)?folders:[folders];folders.forEach(function(folder){var key=getKey(folder);if(!localCache[key]){localCache[key]=folder}if(folder.children().length){addAllSubFolders(folder.children())}})};newFoldersFromServer.forEach(function(key){if(!localCache[key]){var remoteFolder=remoteCache[key];var parentId=remoteFolder.id.substr(0,remoteFolder.id.lastIndexOf('.'));var parentFolder=state.folders.inbox;if(parentId!=='INBOX'){parentFolder=Object.keys(localCache).map(function(localKey){return localCache[localKey]}).filter(function(folder){return folder.id()===parentId})[0]||state.folders.inbox}var newFolder=new Folder(remoteCache[key],parentFolder);parentFolder.children.push(newFolder);addAllSubFolders(newFolder)}})}state.folders.dirty=false;cb(err)})};return RefreshFoldersAction})}());(function(){var define=System.amdDefine;define('webmail/actions/MailPageNotFoundError.js',['3rdparty/Failboat.js'],function(Failboat){function MailPageNotFoundError(folder,page,totalFound){Failboat.tag(this,'MAILPAGENOTFOUND');this.folder=folder;this.page=page;this.totalFound=totalFound}MailPageNotFoundError.prototype=new Error;return MailPageNotFoundError})}());(function(){var define=System.amdDefine;define('webmail/actions/LoadMailsAction.js',['common/util.js','webmail/model/Mail.js','webmail/actions/MailPageNotFoundError.js','common/ActionBehavior.js','common/model/Flag.js'],function(util,Mail,MailPageNotFoundError,ActionBehavior,Flag){function LoadMailsAction(options){util.extend(this,{page:1,retries:2},util.pick(options,['page','retries','silent']));ActionBehavior.installInto(this)}LoadMailsAction.prototype.name='LoadMailsAction';LoadMailsAction.prototype.models=function(){return[this.page,this.page.search.folder]};LoadMailsAction.prototype.validate=function(){if(!this.page){throw new Error('The page to load must be specified')}};LoadMailsAction.prototype.execute=function(context,cb){var that=this;var state=context.state;var backend=context.backend;var page=this.page;var search=page.search;var folder=search.folder;if(!page.dirty){state.signals.mailsLoaded.dispatch();return cb(null)}if(typeof folder.uidvalidity()!=='number'){page.mailUids([]);page.dirty=false;search.length(0);search.ready();return cb(null)}that.setBusyFlags();var pageIndex=page.index;var first=page.firstMailIndex();var last=first+(page.search.pageLength-1);var query=search.query;var filter=[search.viewFilter];var sortExpression=search.sortExpression();var headers=folder.isDraftFolder()?['X-OneCom-Draft-Info']:[];headers.push('References','Received-SPF','List-Unsubscribe');backend.queryFolder(state.user(),folder.id(),folder.uidvalidity(),sortExpression,filter,query,first,last,headers,function(err,data){that.removeBusyFlags();if(err){folder.dirty=true;page.failed=true;setTimeout(function(){page.failed=false},500)}else{if(pageIndex!==1&&data.totalFound<first){var pageSize=that.context.state.preferences.mail()&&that.context.state.preferences.mail().pageSize||50;search.lastPage(search.findLastPage(data.totalFound,pageSize));return cb(new MailPageNotFoundError(folder,pageIndex,data.totalFound))}data.mails.forEach(function(mailData){if(!mailData){one.crashLogger.log('Query folder data.mails contains invalid data',mailData,data.mails.length)}var mail=folder.mailCache.get(mailData.uid);if(mail){Object.keys(Flag).forEach(function(flag){var name=Flag[flag].name,imap=Flag[flag].imap;if(mailData.flags&&typeof mailData.flags[imap]!=='undefined'&&mailData.flags[imap]===1){mail[name](true)}else{mail[name](false)}})}else{mail=new Mail(state.user(),folder,mailData);if(mailData.flags&&mailData.flags.$SubmitPending){mail.failedSending(true)}folder.mailCache.store(mail)}});page.mailUids(data.mails.map(function(mail){return mail.uid}));var folderUpdated=folder.highestmodseq()<data.folder.highestModSeq;if(folderUpdated||folder.dirty){if(!folder.busy()){folder.highestmodseq(data.folder.highestModSeq);folder.uidvalidity(data.folder.uidValidity);folder.messages(data.folder.total);if(typeof data.folder.unseen!=='undefined'){folder.unseen(data.folder.unseen)}else{state.folders.dirty=true}folder.dirty=false}else{state.folders.dirty=true}}search.length(data.totalFound||0);search.ready();page.dirty=false;page.failed=false}state.signals.mailsLoaded.dispatch();cb(err)})};return LoadMailsAction})}());(function(){var define=System.amdDefine;define('webmail/actions/MailNotFoundError.js',['3rdparty/Failboat.js'],function(Failboat){function MailNotFoundError(){Failboat.tag(this,'MAILNOTFOUND')}MailNotFoundError.prototype=new Error;return MailNotFoundError})}());(function(){var define=System.amdDefine;define('webmail/actions/GetMailInfoAction.js',['common/util.js','webmail/model/Mail.js','webmail/actions/MailNotFoundError.js','common/ActionBehavior.js'],function(util,Mail,MailNotFoundError,ActionBehavior){function GetMailInfoAction(options){util.extend(this,{retries:1},util.pick(options,['folder','uid','partId','retries']));ActionBehavior.installInto(this)}GetMailInfoAction.prototype.name='GetMailInfoAction';GetMailInfoAction.prototype.validate=function(){if(!this.folder){throw new Error('A folder must be specified')}if(typeof this.uid!=='number'){throw new Error('Uid must be a number')}};GetMailInfoAction.prototype.models=function(){return this.folder};GetMailInfoAction.prototype.execute=function(context,cb){var that=this;var state=context.state;var backend=context.backend;var folder=this.folder;var uid=this.uid;var partId=this.partId;var cachedMail=folder.mailCache.get(uid);if(cachedMail&&!this.partId){return cb(null,cachedMail)}that.setBusyFlags();var headers=['References','List-Unsubscribe'];if(folder.isDraftFolder()){headers.push('X-OneCom-Draft-Info')}var allowExternalImages=false;backend.getMailPart(state.user(),folder.id(),folder.uidvalidity(),uid,'info',headers,allowExternalImages,function(err,data){that.removeBusyFlags();if(err){cb(err,null)}else{if(partId){var flattenedParts=[],flattenPartList=function(part){flattenedParts.push(part);if(part.parts){part.parts.forEach(flattenPartList)}};data.parts.forEach(flattenPartList);var partToRenderAsMail=flattenedParts.filter(function(part){return part.id===partId});var part=partToRenderAsMail[0];if(part){part.uid=data.uid;var temporaryMail=new Mail(state.user(),folder,part);temporaryMail.partId=partId;cb(null,temporaryMail)}else{cb(new MailNotFoundError)}}else{var mail=new Mail(state.user(),folder,data);folder.mailCache.store(mail);cb(null,mail)}}})};return GetMailInfoAction})}());(function(){var define=System.amdDefine;(function(definition){if(typeof define==='function'){define('3rdparty/ContactModel.js',['node_modules/knockout/build/output/knockout-latest.debug.js'],definition)}else if(typeof module!=='undefined'&&module.exports){var ko=require('knockout');module.exports=definition(ko)}else{this.ContactModel=definition(this.ko)}}(function(ko){var uuid=function(){var CHARS='0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz'.split('');function uuid(len,radix){var chars=CHARS,uuid=[],i,r;radix=radix||chars.length;if(len){for(i=0;i<len;i+=1){uuid[i]=chars[0|Math.random()*radix]}}else{uuid[8]=uuid[13]=uuid[18]=uuid[23]='-';uuid[14]='4';for(i=0;i<36;i+=1){if(!uuid[i]){r=0|Math.random()*16;uuid[i]=chars[i===19?r&3|8:r]}}}return uuid.join('')};return uuid}();function ContactModel(data,eagerLoad){eagerLoad=eagerLoad===true;this.isExisting=!!data&&'isExisting'in data?data.isExisting:true;this.data=data||{};this.id=this.data.id||uuid();this._rev=this.data._rev||null;this.loadFields(eagerLoad);this.addComputedFields();this.busy=ko.observable(false);if(eagerLoad){this.data=null}}ContactModel.singularFieldNames=['displayName','birthday','published','note','occupation','company','x-imported','x-migrated','x-auto-created','x-formatted-name-compiled'];ContactModel.pluralFieldNames=['phoneNumbers','addresses','emails','urls','ims','photos','organizations'];ContactModel.nameFieldNames=['honorificPrefix','givenName','middleName','familyName','honorificSuffix'];ContactModel.addressFieldNames=['formatted','streetAddress','locality','region','postalCode','country'];ContactModel.eagerFields={singular:['displayName','x-auto-created','x-formatted-name-compiled'],plural:['emails']};function checkAndUpdatePrimaryFlag(entries){var primaryFound=false;if(entries.length===0){return entries}entries.forEach(function(entry){if(primaryFound&&entry.primary()){entry.primary(false)}primaryFound=primaryFound||entry.primary()});if(!primaryFound){entries[0].primary(true)}return entries}function processPluralEntries(entries){return checkAndUpdatePrimaryFlag(entries)}function makePluralEntry(fieldName,data){var entry;data=data||{};var isPrimary=data.primary===true||data.primary==='true';if(fieldName==='addresses'){entry={type:ko.observable(data.type||'home'),primary:ko.observable(isPrimary),isEmpty:function(){return ContactModel.addressFieldNames.every(function(fieldName){return/^\s*$/.test(this[fieldName]())},this)},concatenated:function(){return ContactModel.addressFieldNames.map(function(fieldName){if(fieldName==='formatted')return null;return this[fieldName]()},this).filter(function(value){return value}).join('\n')}};ContactModel.addressFieldNames.forEach(function(fieldName){entry[fieldName]=ko.observable(data[fieldName]||'')})}else if(fieldName==='organizations'){entry={name:ko.observable(data.name||''),title:ko.observable(data.title||''),type:ko.observable(data.type||'work'),primary:ko.observable(isPrimary),isEmpty:function(){return/^\s*$/.test(this.name()+this.title())}}}else{entry={value:ko.observable(data.value||''),type:ko.observable(data.type||'other'),primary:ko.observable(isPrimary),isEmpty:function(){return/^\s*$/.test(this.value())}}}return entry}ContactModel.checkAndUpdatePrimaryFlag=checkAndUpdatePrimaryFlag;ContactModel.clonePluralFieldEntry=function(fieldName,entry){return makePluralEntry(fieldName,ko.toJS(entry))};ContactModel.prototype.loadFields=function(eagerLoad){var that=this;if(that.isExisting&&!('x-formatted-name-compiled'in that.data)&&!('displayName'in that.data)){that.data['x-formatted-name-compiled']=true}var singulars=eagerLoad?ContactModel.singularFieldNames:ContactModel.eagerFields.singular;singulars.forEach(function(field){if(!that[field]){that[field]=ko.observable(that.data[field]||null)}else{that[field](that.data[field]||null)}});var plurals=eagerLoad?ContactModel.pluralFieldNames:ContactModel.eagerFields.plural;plurals.forEach(function(field){var entryList=that.data[field]||[];if(!that[field]){that[field]=ko.observableArray(processPluralEntries(entryList.map(makePluralEntry.bind(null,field))))}else{that[field](processPluralEntries(entryList.map(makePluralEntry.bind(null,field))))}});that.name=that.name||{};ContactModel.nameFieldNames.forEach(function(field){if(!that.name[field]){that.name[field]=ko.observable(that.data.name&&that.data.name[field]||null)}else{that.name[field](that.data.name&&that.data.name[field]||null)}});if(eagerLoad){if(that.data.organizations&&that.data.organizations.length>0){var firstOrg=that.data.organizations[0];that.company(firstOrg.name||null);that.occupation(firstOrg.title||null)}}};ContactModel.prototype.addComputedFields=function(){var that=this;that.name.formatted=ko.pureComputed({read:function(){if(that['x-formatted-name-compiled']()){return that.compileFormattedName()}else{return that.displayName()}},write:function(newValue){that['x-formatted-name-compiled'](false);that.displayName(newValue)}})};ContactModel.prototype.loadDetails=function(){if(this.data===null){return}this.loadFields(true);this.data=null};ContactModel.prototype.compileFormattedName=function(){var that=this;return ContactModel.nameFieldNames.map(function(fieldName){return that.name[fieldName]()}).filter(function(namePart){return namePart}).join(' ')};ContactModel.prototype.compareByEmails=function(other){return this.emails().some(function(email){return other.emails().some(function(otherEmail){return email.value()===otherEmail.value()})})};ContactModel.prototype.update=function(newData){if(this.id!==newData.id){throw new Error('Attempted to update ContactModel with wrong id')}if(this._rev&&this._rev===newData._rev)return;var eagerLoad=!!this.data;this.data=newData;this._rev=this.data._rev||this._rev;this.isExisting=true;this.loadFields(eagerLoad)};ContactModel.prototype.toJS=function(){var obj={};obj['x-type']='contact';if(this.id){obj.id=this.id}if(this._rev){obj._rev=this._rev}ContactModel.pluralFieldNames.forEach(function(fieldName){var values=ko.toJS(this[fieldName])||[];if(fieldName==='emails'){values.forEach(function(entry){entry.value=entry.value.trim()})}values.forEach(function(entry){if(entry.isEmpty){delete entry.isEmpty}if(entry.concatenated){delete entry.concatenated}if(entry.primary){entry.primary='true'}else{delete entry.primary}});if(values.length){obj[fieldName]=values}},this);ContactModel.singularFieldNames.forEach(function(fieldName){var value=ko.utils.unwrapObservable(this[fieldName]);if(value){if(fieldName==='company'||fieldName==='occupation'){obj.organizations=obj.organizations||[{}];obj.organizations[0].type='work';obj.organizations[0][{company:'name',occupation:'title'}[fieldName]]=value}else if(fieldName==='x-auto-created'){}else{obj[fieldName]=value}}else{if(obj.organizations&&(fieldName==='company'||fieldName==='occupation')){obj.organizations[0][{company:'name',occupation:'title'}[fieldName]]=null}}},this);if(obj.organizations&&obj.organizations.length>0&&!obj.organizations[0].name&&!obj.organizations[0].title){obj.organizations.shift()}ContactModel.nameFieldNames.forEach(function(nameFieldName){var value=ko.utils.unwrapObservable(this.name[nameFieldName]);if(value){obj.name=obj.name||{};obj.name[nameFieldName]=value}},this);return obj};ContactModel.prototype.toJSON=function(){return JSON.stringify(this.toJS())};return ContactModel}))}());(function(){var define=System.amdDefine;define('webmail/model/RecipientGroup.js',['node_modules/knockout/build/output/knockout-latest.debug.js','common/util.js'],function(ko,util){function RecipientGroup(data){this.name=data&&data.name;this.id=data.id;this.recipients=data.recipients||[]}RecipientGroup.prototype.sortKey=function(){var name=this.name;return name&&name.toLowerCase()};RecipientGroup.prototype.toString=function(){return this.name};return RecipientGroup})}());(function(){var define=System.amdDefine;define('webmail/actions/LoadContactsAction.js',['common/util.js','3rdparty/action-executor/ActionNotReadyError.js','3rdparty/ContactModel.js','webmail/model/Recipient.js','webmail/model/RecipientGroup.js','3rdparty/purify.js'],function(util,ActionNotReadyError,ContactModel,Recipient,RecipientGroup,purify){function LoadContactsAction(){}LoadContactsAction.prototype.name='LoadContactsAction';LoadContactsAction.prototype.execute=function(context,cb){var state=context.state;var backend=context.backend;if(state.contacts.busy()){return cb(new ActionNotReadyError)}backend.getContactStubsAndGroups(state.user(),function(err,data){if(!err){var recipients=[];var groups=[];var recipientsByContactId={};(data||[]).forEach(function(contactOrGroup){if(contactOrGroup['x-type']==='group'){groups.push(contactOrGroup)}else if(contactOrGroup.emails&&contactOrGroup.emails.length){var displayName=contactOrGroup.displayName||'';contactOrGroup.emails.filter(function(email){return purify.email(email)}).forEach(function(email){var recipient=new Recipient({displayName:displayName,email:email,photo:contactOrGroup.photo,id:contactOrGroup.id});recipients.push(recipient);if(!recipientsByContactId[contactOrGroup.id]){recipientsByContactId[contactOrGroup.id]=recipient}})}});state.contacts.all(recipients);var recipientGroups=groups.map(function(group){var recipientGroup=new RecipientGroup({name:group.name,id:group.id});group.contacts.forEach(function(contactId){var recipient=recipientsByContactId[contactId];if(recipient){recipientGroup.recipients.push(recipient)}});return recipientGroup}).filter(function(recipientGroup){return recipientGroup.recipients.length});state.contacts.groups(recipientGroups);state.contacts.loaded(true)}cb(err)})};return LoadContactsAction})}());(function(){var define=System.amdDefine;define('contacts/model/Group.js',['node_modules/knockout/build/output/knockout-latest.debug.js','common/util.js'],function(ko,util){function Group(data){var that=this;that.id=data.id||util.uuid();that._rev=data._rev;that.name=ko.observable(data&&data.name);that.ids=ko.observableArray(data.contacts);that.busy=ko.observable(false);that.sortKey=ko.pureComputed(function(){var name=that.name();return typeof name==='string'?name.toLowerCase():null},this)}Group.prototype.toString=function(){return this.name()};Group.prototype.contains=function(contact){return this.ids.indexOf(ko.utils.unwrapObservable(contact.id))!==-1};Group.prototype.isNew=function(){return!this._rev};Group.prototype.addContacts=function(contacts){var that=this;var contactsToAdd=contacts.filter(function(contact){return!that.contains(contact)}).map(function(contact){return contact.id});that.ids.push.apply(that.ids,contactsToAdd);return contactsToAdd.length>0};Group.prototype.removeContacts=function(contacts){return this.ids.removeAll(contacts.map(function(contact){return contact.id})).length>0};Group.prototype.toJS=function(){return{'x-type':'group',id:this.id,_rev:this._rev,name:this.name(),contacts:this.ids()}};return Group})}());(function(){var define=System.amdDefine;define('contacts/actions/SaveContactAction.js',['common/util.js','3rdparty/action-executor/ActionNotReadyError.js','contacts/model/Group.js'],function(util,ActionNotReadyError,Group){function SaveContactAction(options){util.extend(this,util.pick(options,'contact','tags'))}SaveContactAction.prototype.name='SaveContactAction';SaveContactAction.prototype.isBlocking=true;SaveContactAction.prototype.validate=function(){if(!this.contact){throw new Error('A contact must be specified')}};SaveContactAction.prototype.execute=function(context,cb){var state=context.state;var backend=context.backend;this.validate();var contact=this.contact;var tags=this.tags||[];var addQueue=[];var removeQueue=[];contact.id=contact.id||util.uuid();var models,contactsAndGroups;if(state.groups){state.groups().forEach(function(group){var shouldBeMember=tags.indexOf(group)!==-1;var contactIsMemberOfGroup=group.contains(contact);if(shouldBeMember&&!contactIsMemberOfGroup){addQueue.push(group)}else if(!shouldBeMember&&contactIsMemberOfGroup){removeQueue.push(group)}});var changedGroups=[].concat(addQueue,removeQueue);if(changedGroups.concat(contact).some(function(model){return model.busy()})){cb(new ActionNotReadyError)}var newGroups=tags.filter(function(group){return state.groups.indexOf(group)===-1});newGroups.forEach(function(group){group.addContacts([contact])});state.groups.push.apply(state.groups,newGroups);models=changedGroups.concat(newGroups,contact);contactsAndGroups=models.map(function(contactOrGroup){return contactOrGroup.toJS()})}else{models=[contact];contactsAndGroups=models.map(function(contactOrGroup){return contactOrGroup.toJS()})}addQueue.forEach(function(group){group.addContacts([contact])});removeQueue.forEach(function(group){group.removeContacts([contact])});models.forEach(function(model){model.busy(true)});backend.saveContactsOrGroups(state.user(),contactsAndGroups,function(err,data){models.forEach(function(model){model.busy(false)});if(!err){models.forEach(function(model){model._rev=data[model.id]._rev});contact.isExisting=true;var autocompletions=(contact.emails()||[]).map(function(emailObj){return{email:emailObj.value(),displayName:contact.name.formatted()}});if(autocompletions.length){backend.saveAutocompletions(state.user(),autocompletions,function(){cb(err)})}else{cb(err)}}else{cb(err)}})};return SaveContactAction})}());(function(){var define=System.amdDefine;(function(root,factory){if(typeof define==='function'&&define.amd){define('3rdparty/mousetrap-domain.js',['3rdparty/mousetrap.js'],factory)}else{root.amdWeb=factory(root.Mousetrap)}}(this,function(Mousetrap){var _currentDomain=null;var _domainCallbacks={};var _oldReset=Mousetrap.prototype.reset;Mousetrap.prototype.reset=function(){_currentDomain=null;_domainCallbacks={};_oldReset.apply(this,arguments)};Mousetrap.prototype.setDomain=function(name){_currentDomain=name};function _domainKeyHandler(key){return function(event,combo){if(_currentDomain&&_domainCallbacks[_currentDomain]&&_domainCallbacks[_currentDomain][key]){return _domainCallbacks[_currentDomain][key](event,combo)}}}function _keyUnused(key){return Object.keys(_domainCallbacks).every(function(domain){return!_domainCallbacks[domain][key]})}Mousetrap.prototype.bindDomain=function(domains,keys,handlerFunc){var that=this;if(typeof domains==='string'){domains=[domains]}if(typeof keys==='string'){keys=[keys]}keys.forEach(function(key){if(_keyUnused(key)){that.bind(key,_domainKeyHandler(key))}});domains.forEach(function(domain){if(!_domainCallbacks[domain]){_domainCallbacks[domain]={}}keys.forEach(function(key){_domainCallbacks[domain][key]=handlerFunc})})};Mousetrap.prototype.unbindDomain=function(domains,keys){var that=this;if(typeof domains==='string'){domains=[domains]}if(typeof keys==='string'){keys=[keys]}domains.forEach(function(domain){keys.forEach(function(key){delete _domainCallbacks[domain][key]});if(Object.keys(_domainCallbacks[domain]).length===0){delete _domainCallbacks[domain]}});keys.forEach(function(key){if(_keyUnused(key)){that.unbind(key)}})};Mousetrap.init();return Mousetrap}))}());(function(){var define=System.amdDefine;(function(window,document,undefined){var _MAP={8:'backspace',9:'tab',13:'enter',16:'shift',17:'ctrl',18:'alt',20:'capslock',27:'esc',32:'space',33:'pageup',34:'pagedown',35:'end',36:'home',37:'left',38:'up',39:'right',40:'down',45:'ins',46:'del',91:'meta',93:'meta',224:'meta'};var _KEYCODE_MAP={106:'*',107:'+',109:'-',110:'.',111:'/',186:';',187:'=',188:',',189:'-',190:'.',191:'/',192:'`',219:'[',220:'\\',221:']',222:'\''};var _SHIFT_MAP={'~':'`','!':'1','@':'2','#':'3','$':'4','%':'5','^':'6','&':'7','*':'8','(':'9',')':'0','_':'-','+':'=',':':';','"':'\'','<':',','>':'.','?':'/','|':'\\'};var _SPECIAL_ALIASES={'option':'alt','command':'meta','return':'enter','escape':'esc','plus':'+','mod':/Mac|iPod|iPhone|iPad/.test(navigator.platform)?'meta':'ctrl'};var _REVERSE_MAP;for(var i=1;i<20;++i){_MAP[111+i]='f'+i}for(i=0;i<=9;++i){_MAP[i+96]=i}function _addEvent(object,type,callback){if(object.addEventListener){object.addEventListener(type,callback,false);return}object.attachEvent('on'+type,callback)}function _characterFromEvent(e){if(e.type=='keypress'){var character=String.fromCharCode(e.which);if(!e.shiftKey){character=character.toLowerCase()}return character}if(_MAP[e.which]){return _MAP[e.which]}if(_KEYCODE_MAP[e.which]){return _KEYCODE_MAP[e.which]}return String.fromCharCode(e.which).toLowerCase()}function _modifiersMatch(modifiers1,modifiers2){return modifiers1.sort().join(',')===modifiers2.sort().join(',')}function _eventModifiers(e){var modifiers=[];if(e.shiftKey){modifiers.push('shift')}if(e.altKey){modifiers.push('alt')}if(e.ctrlKey){modifiers.push('ctrl')}if(e.metaKey){modifiers.push('meta')}return modifiers}function _preventDefault(e){if(e.preventDefault){e.preventDefault();return}e.returnValue=false}function _stopPropagation(e){if(e.stopPropagation){e.stopPropagation();return}e.cancelBubble=true}function _isModifier(key){return key=='shift'||key=='ctrl'||key=='alt'||key=='meta'}function _getReverseMap(){if(!_REVERSE_MAP){_REVERSE_MAP={};for(var key in _MAP){if(key>95&&key<112){continue}if(_MAP.hasOwnProperty(key)){_REVERSE_MAP[_MAP[key]]=key}}}return _REVERSE_MAP}function _pickBestAction(key,modifiers,action){if(!action){action=_getReverseMap()[key]?'keydown':'keypress'}if(action=='keypress'&&modifiers.length){action='keydown'}return action}function _keysFromString(combination){if(combination==='+'){return['+']}combination=combination.replace(/\+{2}/g,'+plus');return combination.split('+')}function _getKeyInfo(combination,action){var keys;var key;var i;var modifiers=[];keys=_keysFromString(combination);for(i=0;i<keys.length;++i){key=keys[i];if(_SPECIAL_ALIASES[key]){key=_SPECIAL_ALIASES[key]}if(action&&action!='keypress'&&_SHIFT_MAP[key]){key=_SHIFT_MAP[key];modifiers.push('shift')}if(_isModifier(key)){modifiers.push(key)}}action=_pickBestAction(key,modifiers,action);return{key:key,modifiers:modifiers,action:action}}function _belongsTo(element,ancestor){if(element===document){return false}if(element===ancestor){return true}return _belongsTo(element.parentNode,ancestor)}function Mousetrap(targetElement){var self=this;targetElement=targetElement||document;if(!(self instanceof Mousetrap)){return new Mousetrap(targetElement)}self.target=targetElement;self._callbacks={};self._directMap={};var _sequenceLevels={};var _resetTimer;var _ignoreNextKeyup=false;var _ignoreNextKeypress=false;var _nextExpectedAction=false;function _resetSequences(doNotReset){doNotReset=doNotReset||{};var activeSequences=false,key;for(key in _sequenceLevels){if(doNotReset[key]){activeSequences=true;continue}_sequenceLevels[key]=0}if(!activeSequences){_nextExpectedAction=false}}function _getMatches(character,modifiers,e,sequenceName,combination,level){var i;var callback;var matches=[];var action=e.type;if(!self._callbacks[character]){return[]}if(action=='keyup'&&_isModifier(character)){modifiers=[character]}for(i=0;i<self._callbacks[character].length;++i){callback=self._callbacks[character][i];if(!sequenceName&&callback.seq&&_sequenceLevels[callback.seq]!=callback.level){continue}if(action!=callback.action){continue}if(action=='keypress'&&!e.metaKey&&!e.ctrlKey||_modifiersMatch(modifiers,callback.modifiers)){var deleteCombo=!sequenceName&&callback.combo==combination;var deleteSequence=sequenceName&&callback.seq==sequenceName&&callback.level==level;if(deleteCombo||deleteSequence){self._callbacks[character].splice(i,1)}matches.push(callback)}}return matches}function _fireCallback(callback,e,combo,sequence){if(self.stopCallback(e,e.target||e.srcElement,combo,sequence)){return}if(callback(e,combo)===false){_preventDefault(e);_stopPropagation(e)}}self._handleKey=function(character,modifiers,e){var callbacks=_getMatches(character,modifiers,e);var i;var doNotReset={};var maxLevel=0;var processedSequenceCallback=false;for(i=0;i<callbacks.length;++i){if(callbacks[i].seq){maxLevel=Math.max(maxLevel,callbacks[i].level)}}for(i=0;i<callbacks.length;++i){if(callbacks[i].seq){if(callbacks[i].level!=maxLevel){continue}processedSequenceCallback=true;doNotReset[callbacks[i].seq]=1;_fireCallback(callbacks[i].callback,e,callbacks[i].combo,callbacks[i].seq);continue}if(!processedSequenceCallback){_fireCallback(callbacks[i].callback,e,callbacks[i].combo)}}var ignoreThisKeypress=e.type=='keypress'&&_ignoreNextKeypress;if(e.type==_nextExpectedAction&&!_isModifier(character)&&!ignoreThisKeypress){_resetSequences(doNotReset)}_ignoreNextKeypress=processedSequenceCallback&&e.type=='keydown'};function _handleKeyEvent(e){if(typeof e.which!=='number'){e.which=e.keyCode}var character=_characterFromEvent(e);if(!character){return}if(e.type=='keyup'&&_ignoreNextKeyup===character){_ignoreNextKeyup=false;return}self.handleKey(character,_eventModifiers(e),e)}function _resetSequenceTimer(){clearTimeout(_resetTimer);_resetTimer=setTimeout(_resetSequences,1000)}function _bindSequence(combo,keys,callback,action){_sequenceLevels[combo]=0;function _increaseSequence(nextAction){return function(){_nextExpectedAction=nextAction;++_sequenceLevels[combo];_resetSequenceTimer()}}function _callbackAndReset(e){_fireCallback(callback,e,combo);if(action!=='keyup'){_ignoreNextKeyup=_characterFromEvent(e)}setTimeout(_resetSequences,10)}for(var i=0;i<keys.length;++i){var isFinal=i+1===keys.length;var wrappedCallback=isFinal?_callbackAndReset:_increaseSequence(action||_getKeyInfo(keys[i+1]).action);_bindSingle(keys[i],wrappedCallback,action,combo,i)}}function _bindSingle(combination,callback,action,sequenceName,level){self._directMap[combination+':'+action]=callback;combination=combination.replace(/\s+/g,' ');var sequence=combination.split(' ');var info;if(sequence.length>1){_bindSequence(combination,sequence,callback,action);return}info=_getKeyInfo(combination,action);self._callbacks[info.key]=self._callbacks[info.key]||[];_getMatches(info.key,info.modifiers,{type:info.action},sequenceName,combination,level);self._callbacks[info.key][sequenceName?'unshift':'push']({callback:callback,modifiers:info.modifiers,action:info.action,seq:sequenceName,level:level,combo:combination})}self._bindMultiple=function(combinations,callback,action){for(var i=0;i<combinations.length;++i){_bindSingle(combinations[i],callback,action)}};_addEvent(targetElement,'keypress',_handleKeyEvent);_addEvent(targetElement,'keydown',_handleKeyEvent);_addEvent(targetElement,'keyup',_handleKeyEvent)}Mousetrap.prototype.bind=function(keys,callback,action){var self=this;keys=keys instanceof Array?keys:[keys];self._bindMultiple.call(self,keys,callback,action);return self};Mousetrap.prototype.unbind=function(keys,action){var self=this;return self.bind.call(self,keys,function(){},action)};Mousetrap.prototype.trigger=function(keys,action){var self=this;if(self._directMap[keys+':'+action]){self._directMap[keys+':'+action]({},keys)}return self};Mousetrap.prototype.reset=function(){var self=this;self._callbacks={};self._directMap={};return self};Mousetrap.prototype.stopCallback=function(e,element){var self=this;if((' '+element.className+' ').indexOf(' mousetrap ')>-1){return false}if(_belongsTo(element,self.target)){return false}return element.tagName=='INPUT'||element.tagName=='SELECT'||element.tagName=='TEXTAREA'||element.isContentEditable};Mousetrap.prototype.handleKey=function(){var self=this;return self._handleKey.apply(self,arguments)};Mousetrap.init=function(){var documentMousetrap=Mousetrap(document);for(var method in documentMousetrap){if(method.charAt(0)!=='_'){Mousetrap[method]=function(method){return function(){return documentMousetrap[method].apply(documentMousetrap,arguments)}}(method)}}};Mousetrap.init();window.Mousetrap=Mousetrap;if(typeof module!=='undefined'&&module.exports){module.exports=Mousetrap}if(typeof define==='function'&&define.amd){define('3rdparty/mousetrap.js',[],function(){return Mousetrap})}}(window,document))}());(function(){var define=System.amdDefine;define('common/mousetrap-globalize.js',['3rdparty/mousetrap.js'],function(Mousetrap){var _globalCallbacks={};var _oldStopCallback=Mousetrap.prototype.stopCallback;Mousetrap.prototype.stopCallback=function(e,element,combo,sequence){var that=this;if(that.paused){return true}if(_globalCallbacks[combo]||_globalCallbacks[sequence]){return false}return _oldStopCallback.call(that,e,element,combo)};Mousetrap.prototype.globalize=function(keys){if(Array.isArray(keys)){keys.forEach(function(key){_globalCallbacks[key]=true});return}else{_globalCallbacks[keys]=true}};Mousetrap.init()})}());(function(){var define=System.amdDefine;define('common/KeyHandler.js',['node_modules/knockout/build/output/knockout-latest.debug.js','3rdparty/mousetrap-domain.js','common/mousetrap-globalize.js'],function(ko,Mousetrap){var mousetrap=new Mousetrap(document);function KeyHandler(){var that=this;var currentDomain=null;var allDomains={};var defaultDomain=null;that.getDomain=function(domain){return allDomains[domain]};that.listDomains=function(){return Object.keys(allDomains)};that.getCurrentDomain=function(){return currentDomain};that.getCurrentDomainElement=function(){if(currentDomain){return allDomains[currentDomain]}else{return null}};that.addDomain=function(domain,element){if(!allDomains[domain]){allDomains[domain]=element;if(currentDomain===domain){this.focusDomain(domain)}}else{throw new Error('Cannot add already existing domain '+domain)}};that.removeDomain=function(domain){if(allDomains[domain]){if(currentDomain===domain){that.focusDomain(defaultDomain)}delete allDomains[domain]}};var lastFocused;that.setDefaultDomain=function(domainName){defaultDomain=domainName;that.focusDomain(domainName)};that.isLockingFocus=function(domainName){return!!(allDomains[domainName]&&allDomains[domainName].focusLock)};that.focusDomain=function(domainName,noDomFocus){if(domainName==='---'){return}var domain=allDomains[domainName];if(!domain){domainName=defaultDomain;domain=domainName?allDomains[domainName]:null}var element;if(lastFocused){if(lastFocused!==document.body){lastFocused.blur()}lastFocused=null}currentDomain=domainName;if(domain){if(typeof domain.focus==='string'&&(domain.focusLock||!noDomFocus)){element=domain.element;if(domain.focus.length>0){element=element.querySelector(domain.focus)}if(element){if(element.setActive){try{element.setActive()}catch(e){}}else{element.focus()}lastFocused=element}}else if(!noDomFocus){if(domain.element.setActive){try{domain.element.setActive()}catch(e){}}else{domain.element.focus()}}}mousetrap.setDomain(currentDomain)};that.findDomainContaining=function(element){if(element.hasAttribute('data-keydomain')){return element.getAttribute('data-keydomain')}else if(element===document.body||!element.parentElement){return null}else{return that.findDomainContaining(element.parentElement)}};var keybinds={};var lastId=0;that.register=function(domains,keys,handlerFunction){if(arguments.length===2){handlerFunction=keys;keys=domains;domains=null}var id=lastId;lastId+=1;keybinds[id]={keys:keys,domains:domains};if(domains){mousetrap.bindDomain(domains,keys,handlerFunction)}else{mousetrap.bind(keys,handlerFunction)}return id};that.unregister=function(handlerId){var identity=keybinds[handlerId];if(identity.domains){mousetrap.unbindDomain(identity.domains,identity.keys)}else{mousetrap.unbind(identity.keys)}};that.globalize=function(combo){mousetrap.globalize(combo)};that.trigger=function(combo){mousetrap.trigger(combo)};var handlingMousedown=false;var focusWasReset=false;function mousedownHandler(event){handlingMousedown=true;var targetDomain=that.findDomainContaining(event.target);var focusIsInDomain=!!document.activeElement&&targetDomain===that.findDomainContaining(document.activeElement);setTimeout(function(){if(that.isLockingFocus(targetDomain)||!focusWasReset&&!focusIsInDomain){that.focusDomain(targetDomain)}focusWasReset=false;handlingMousedown=false},0)}document.body.addEventListener('mousedown',mousedownHandler,true);function focusHandler(event){if(event.target===document.body&&!document.body.hasAttribute('data-keydomain')){return}if(handlingMousedown){focusWasReset=true}var targetDomain=that.findDomainContaining(event.target);if(targetDomain!==currentDomain){that.focusDomain(targetDomain,true);lastFocused=event.target}}document.body.addEventListener('focus',focusHandler,true);that.removeListeners=function(){document.body.removeEventListener('mousedown',mousedownHandler,true);document.body.removeEventListener('focus',focusHandler,true)}}var instance;function getInstance(){if(!instance){instance=new KeyHandler}return instance}KeyHandler.prototype.reset=function(){if(instance){instance.removeListeners();instance=null;mousetrap.reset();mousetrap=new Mousetrap(document)}};function makeDomain(element,firstFocus,lock){var domain={element:element};if(typeof firstFocus==='string'){domain.focus=firstFocus;if(lock){domain.focusLock=true}}return domain}ko.bindingHandlers.keybindDomain={init:function(element,valueAccessor,allBindingsAccessor,viewModel,bindingContext){var keyhandler=getInstance();var value=valueAccessor();var name,firstFocus,focusLock;if(typeof value==='string'){name=value}else{if(typeof value!=='object'||!value.name){throw new Error('keybindDomain must have a name.')}name=value.name;firstFocus=value.firstFocus;focusLock=value.lock}element.setAttribute('data-keydomain',name);if(!element.hasAttribute('tabindex')&&['INPUT','BUTTON','TEXTAREA','SELECT'].indexOf(element.nodeName)!==-1){element.setAttribute('tabindex','-1')}keyhandler.addDomain(name,makeDomain(element,firstFocus,focusLock));if(!value.noDispose){ko.utils.domNodeDisposal.addDisposeCallback(element,function(){keyhandler.removeDomain(name)})}}};return getInstance})}());(function(){var define=System.amdDefine;(function(root,factory){if(typeof exports==='object'){module.exports=factory(require('tracking'))}else if(typeof define==='function'&&define.amd){define('3rdparty/tracking-analytics/ErrorTracker.js',['node_modules/@one.com/tracking-analytics/lib/tracking.js'],factory)}else{root.com=root.com||{};root.com.one=root.com.one||{};root.com.one.ErrorTracker=factory(root.com.one.tracking)}}(this,function(tracking){function isServerError(err){var status=err.status;return 500<=status&&status<600}return{track:function(err,category){category=category||(err.status===400||err.status===200||isServerError(err)?'errors':'warnings');tracking.track(category,err.tags[0],err.tags.join(' '))}}}))}());(function(){var define=System.amdDefine;define('common/BaseErrorHandler.js',['3rdparty/Failboat.js','3rdparty/tracking-analytics/ErrorTracker.js','common/util.js'],function(Failboat,ErrorTracker,util){var BaseErrorHandler={};function missingHandlerMessage(err){return'Missing handler for error "'+err.tags.join(' ')+'".'}BaseErrorHandler.create=function(application){var noConnectionMessage=TR('errorHandler.NoConnection','Could not connect to the server, please try again later.');var failboat=new Failboat({'0':function(err){this.showWarning(noConnectionMessage)},'500, 502':function(err){this.showErrorAndReportTaggedCrashWithUser(err,noConnectionMessage)},'409':function(err){this.showWarning(TR('errorHandler.ObjectConflict','The item you are interacting with has been updated. Please refresh your browser window.'));this.reportTaggedCrashWithUser(err,missingHandlerMessage(err))},'413':function(err){this.showWarning(TR('errorHandler.TooLargeUpload','The file you attempted to upload is too large.'))},'503, 200':function(err){this.showErrorAndReportTaggedCrashWithUser(err,TR('errorHandler.ServiceUnavailable','Our webmail servers are currently unavailable due to a temporary overloading or maintenance. Please try again later.'))},'504':function(err){this.showErrorAndReportTaggedCrashWithUser(err,TR('errorHandler.GatewayTimeout','A proxy timeout has occurred. Please try again later. If you are using a (corporate) proxy, please contact the service staff maintaining your proxy.'))},'400':function(err){var message=TR('errorHandler.ConnectionProblem','There was a problem connecting to the server, please try again.');this.showErrorAndReportTaggedCrashWithUser(err,message)},'401, 403 INVALIDORMISSINGCOOKIE':function(err){if(/\/calendars\/2\/own\/\?events=true/.test(err.requestUrl)&&one.application.composeMail){return}this.logout()},'403 AUTHENTICATIONFAILED':function(err){this.logout()},'403 SUSPENDED':function(err){this.showError(TR('mail.AccountSuspendedOrDeactivated','Sorry, your account has been suspended or deactivated. Please contact the support.'))},'403 SMTPSUSPENDED':function(err){this.showError(TR('mail.SmtpSuspended','Sorry, we had to temporarily suspend outgoing emails on your domain. Please contact the support to get information about how to get the suspension lifted.'))},'403 Suspended':function(err){this.showError(TR('mail.AccountSuspended','Sorry, your account has been suspended. Please contact the support.'))},'403 Inactive':function(err){this.showError(TR('mail.AccountInactive','Sorry, your account is inactive. Your domain administrator can enable it from the Control Panel.'))},'403':'503','407':function(){this.showWarning(TR('errorHandler.ProxyAuthenticationNeeded','There was a problem connecting to the server. Please try to log into your (corporate) proxy again.'))},'502 ACCOUNTCREATIONPENDING':'ACCOUNTCREATIONPENDING','ACCOUNTCREATIONPENDING':function(err){var url='https://login.one.com/mail#error-login-imap-account-not-ready-yet';window.location.replace(url)}},util.extend(application,{reportTaggedCrashWithUser:function(err,message){if(this.state&&this.state.user){err.user=this.state.user().toString()}one.crashReporter.reportTaggedCrash(err,message)},showErrorAndReportTaggedCrashWithUser:function(err,message){err.crashReportId=util.uuid(15);this.showError(message+' Code: '+err.crashReportId);this.reportTaggedCrashWithUser(err,message)}}));failboat.onErrorRouted=function(err,matchingRoute){if(!matchingRoute){this.showErrorAndReportTaggedCrashWithUser(err,missingHandlerMessage(err));ErrorTracker.track(err,'errors')}else{ErrorTracker.track(err)}};return failboat};return BaseErrorHandler})}());(function(){var define=System.amdDefine;define('webmail/WebmailErrorHandler.js',['common/BaseErrorHandler.js'],function(BaseErrorHandler){var WebmailErrorHandler={};function invalidEmailInFieldErrorMesssage(fieldName,email){var emailHeaderTranslations=TR('mail.EmailHeaderLabel',{to:'To',cc:'Cc',bcc:'Bcc'});var trPattern=TR.PAT('mail.SendInvalidEmail','The mail you are trying to send has an invalid email "{0}" in the "{1}" line');return trPattern(email,emailHeaderTranslations[fieldName])}WebmailErrorHandler.create=function(application){var errorHandler=BaseErrorHandler.create(application).extend({'404 BADURL':function(err){this.setContentPanel(null);this.folderListView.refreshFolders(true);this.showWarning(TR('mail.error.DraftMissing','Another program has removed the draft you were editing, '+'and the mail composer has been closed as a result. '+'Sorry for any inconvenience.'))},'502 Closed':function(err){var message=TR('mail.serverClose','An operation failed, possibly because you have a very large mail folder. Please contact the support.');this.showWarning(message)},'503 NO_MAILBOXISLOCKED':function(err){var message=TR('mail.FolderLocked','The folder is temporarily unavailable. Please wait a little before trying to access it again.');this.showWarning(message)},'412 BAD_TOOMANYMESSAGE':function(err){var message=TR('mail.TooManyMessages','The email you are trying to send has too many attachments. Sorry for any inconvenience.');this.showWarning(message)},'MAILPAGENOTFOUND LoadMailsAction':function(err){var lastPage=this.mailListView.search().pageCount();var search=this.mailListView.search();if(search.lastPage()){lastPage=search.lastPage()}this.mailListView.gotoPage(Math.max(1,lastPage))},'404 NO_MAILBOXDOESNTEXIST':function(err){this.state.folders.dirty=true},'404 NO_MAILBOXDOESNTEXIST DeleteFolderAction':function(err){},'409 UidValidityConflict':function(err){this.showWarning(TR('mail.error.UidValidityConflictFolderHasBeenReloaded','Another program has changed the open folder. It has therefore been reloaded. Sorry for any inconvenience.'));this.state.folders.dirty=true},'404 NO_MAILBOXDOESNTEXIST MoveMailsAction':function(err){var message=TR.PAT('mail.DestinationFolderMissing','Destination folder "{0}" does not exist. It may have been deleted by '+'another program. Reloading the page is recommended to prevent further '+'errors. Sorry for the inconvenience.')(err.action.destination.translatedName());this.showWarning(message);this.state.folders.dirty=true},'404 NotFound GetMailInfoAction, MAILNOTFOUND GetMailInfoAction, 404 NOSUCHPART LoadMailPartsAction':function(err){this.showWarning(TR('mail.MailNotFound','The mail you tried to view was not found'));var folder=err.action.folder||err.action.mail.folder();var uid=err.action.uid||err.action.mail.uid;this.state.signals.mailDisappeared.dispatch(uid,folder);this.state.folders.dirty=true},'403 TOOMANYRECIPIENTS':function(err){this.showWarning(TR('mail.TooManyRecipients','Maximum number of recipients has been reached, please try again later.'))},'413 EMAILTOOBIG':function(err){var errorData=err.response&&err.response.errorData;if(errorData&&typeof errorData.messageSizeBytes==='number'&&typeof errorData.messageSizeMaxBytes==='number'&&errorData.recipientDomain){this.showWarning(TR.PAT('mail.EmailTooBigWithExtraInfo','The mail you are trying to send is too large ({0}). The domain {1} allows a maximum size of {2}')(inter.renderFileSize(errorData.messageSizeBytes),errorData.recipientDomain,inter.renderFileSize(errorData.messageSizeMaxBytes)))}else{this.showWarning(TR('mail.EmailTooBig','The mail you are trying to send is too large'))}},'403 MESSAGEREJECTEDDUETOCONTENTPOLICY SendMailAction, 429 TOOMANYMAILSRECEIVED SendMailAction':function(err){this.showWarning(TR('mail.MessageRejectedDueToContentPolicy','Message rejected due to content policy'))},'INVALIDRECIPIENTS Composer':function(err){var firstFieldWithErrors=['to','cc','bcc'].filter(function(field){return err[field].length})[0];var firstInvalidEmail=err[firstFieldWithErrors][0].toDisplayString();this.showWarning(invalidEmailInFieldErrorMesssage(firstFieldWithErrors,firstInvalidEmail))},'NORECIPIENTS Composer':function(err){this.showWarning(TR('mail.NoRecipients','The mail you are trying to send has no recipients'))},'400 BADEMAIL SendMailAction':function(err){var errorData=err.response.errorData;var message=invalidEmailInFieldErrorMesssage(errorData.headerName,errorData.email);this.showErrorAndReportTaggedCrashWithUser(err,message)},'0 SendMailAction, 500 InternalServerError SendMailAction, 502 BadGateway SendMailAction, 503 ServiceUnavailable SendMailAction, 403 AUTHENTICATIONFAILED SendMailAction':function(err){var message=TR.PAT('mail.SendingMailFailed','Sending the mail "{0}" failed, you can resend the mail from the sent folder. Sorry for any inconvenience.')(err.action.mail.subject());this.showWarning(message);one.crashReporter.reportCrash(err,{message:message})},'400 NORECIPIENTS':function(err){var message=TR('mail.NoRecipients','The mail you are trying to send has no recipients');this.showErrorAndReportTaggedCrashWithUser(err,message)},'412 ALREADYEXISTS EmptyFolderAction':function(err){this.showWarning(TR('mail.error.UidValidityConflictFolderHasBeenReloaded','Another program has changed the open folder. It has therefore been reloaded. Sorry for any inconvenience.'));this.state.folders.dirty=true},'412 ALREADYEXISTS CreateFolderAction':function(err){this.showWarning(TR('mail.error.FolderAlreadyExist','The folder you are trying to create already exists. The folders have been reloaded to reflect the current state. Sorry for any inconvenience.'));this.state.folders.dirty=true},'412 ALREADYEXISTS MoveFolderAction, 404 NO_MAILBOXDOESNTEXIST MoveFolderAction':function(err){if(!err.action.newName){this.showWarning(TR('mail.error.MoveFolderConflict','Another program has changed the folder you are moving. It has therefore been reloaded. Sorry for any inconvenience.'))}else{this.showWarning(TR('mail.error.RenameFolderConflict','Another program has changed the folder you are renaming. It has therefore been reloaded. Sorry for any inconvenience.'))}this.state.folders.dirty=true},'12041':function(){this.showWarning(TR('mail.error.BlockedBySecurityPolicy','An element was blocked due to internet security policy.'))},'CANCELLED':function(){},'FAILED_LOADING_EXTERNAL_ERRORS':function(err){var calendarNames=err.errors.map(function(err){return err.name});this.showWarning(TR.PAT('calendar.LoadingExternalCalendarsError','Failed to load the following external calendars: {0}')(calendarNames.join(', ')))}});return errorHandler};return WebmailErrorHandler})}());(function(){var define=System.amdDefine;define('common/TraceLogging.js',['node_modules/knockout/build/output/knockout-latest.debug.js'],function(ko){function wrapFunction(name,target,property){var original=target[property];return function(){one.crashLogger.log('calling: '+name+'.'+property);return original.apply(this,arguments)}}function getName(Constructor){var regex=/^function\s+(.+?)\s*\(/;return regex.exec(Constructor.toString())[1]}var TraceLogging={injectTracing:function(Constructor){var name=Constructor.name||getName(Constructor);var target=Constructor.prototype;if(!target._tracingInjected){Object.getOwnPropertyNames(target).filter(function(property){return typeof target[property]==='function'&&!ko.isObservable(target[property])}).forEach(function(property){target[property]=wrapFunction(name,target,property)});target._tracingInjected=true}return target}};return TraceLogging})}());(function(){var define=System.amdDefine;define('webmail/actions/CreateProductAddOnCookieAction.js',['node_modules/knockout/build/output/knockout-latest.debug.js','common/ActionBehavior.js'],function(ko,ActionBehavior){function CreateProductAddOnCookieAction(){ActionBehavior.installInto(this)}CreateProductAddOnCookieAction.prototype.name='CreateProductAddOnCookieAction';CreateProductAddOnCookieAction.prototype.models=function(context){return context.state.preferences};CreateProductAddOnCookieAction.prototype.execute=function(context,cb){context.backend.setAddOnProductCoolOffCookie(context.state.user());cb()};return CreateProductAddOnCookieAction})}());(function(){var define=System.amdDefine;define('common/actions/LoadPreferencesAction.js',['node_modules/knockout/build/output/knockout-latest.debug.js','common/util.js','common/ActionBehavior.js'],function(ko,util,ActionBehavior){function LoadPreferencesAction(options){util.extend(this,{retries:1},util.pick(options,'retries'));ActionBehavior.installInto(this)}LoadPreferencesAction.prototype.name='LoadPreferencesAction';LoadPreferencesAction.prototype.models=function(context){return context.state.preferences};LoadPreferencesAction.prototype.execute=function(context,cb){var that=this;var state=context.state;var backend=context.backend;that.setBusyFlags();var namespaces=['global','mail','trustedSenders','calendar'].filter(function(namespace){return ko.isObservable(state.preferences[namespace])});backend.getPreferences(state.user(),namespaces,function(err,data){that.removeBusyFlags();if(!err){namespaces.forEach(function(namespace){state.preferences[namespace](data[namespace])})}cb(err)})};return LoadPreferencesAction})}());System.registerDynamic('3rdparty/one-theme/images/icons/welcome/*.svg?svgfilter=--runScript=../../colorFilter.js,--color=%23FFFFFF&inkscape=--export-width=40,--export-area=0:0:40:40!node_modules/systemjs-asset-plugin/asset-plugin.js',[],true,function($__require,exports,module){var define,global=this||self,GLOBAL=global;var obj={'lightbulb':'https://mail-static.cdn-one.com/lightbulb.inkscape--export-width40,--export-area0-0-40-40.f77bbdda96.png','rocket':'https://mail-static.cdn-one.com/rocket.inkscape--export-width40,--export-area0-0-40-40.c0e0b99243.png','shootingStar':'https://mail-static.cdn-one.com/shootingStar.inkscape--export-width40,--export-area0-0-40-40.f9443e062d.png'};module.exports=function(){var output=obj;for(var i=0;i<arguments.length;i++){if(typeof obj[arguments[i]]!=='object'&&i!==arguments.length-1)throw new TypeError('Unable to read argument "'+arguments[i]+'" from glob in '+module.id);output=output[arguments[i]]}return output};return module.exports});(function(){var define=System.amdDefine;define('3rdparty/knockout-sequence-dialog/SequenceDialogViewModel.js',['node_modules/knockout/build/output/knockout-latest.debug.js'],function(ko){function SequenceDialogModalView(params,componentInfo){var that=this;that.show=params.show||ko.observable(true);that.pages=ko.unwrap(params.pages);that.pageIndex=ko.observable(0);that.seenLastPage=ko.observable(false);that.shownPage=ko.pureComputed(function(){return that.pages[that.pageIndex()]||{}});that.title=ko.unwrap(params.title);that.pageNumber=ko.pureComputed(function(){if(that.pages.length>1){return that.pageIndex()+1+'/'+that.pages.length}return null});function createTagString(data){if(typeof data==='string'){return data}var tag='<'+data.tag;if(data.attr){Object.keys(data.attr).forEach(function(name){tag+=' '+name+'="'+data.attr[name]+'"'})}if(data.text){tag+='>'+data.text+'</'+data.tag}tag+='>';return tag}var tagCheckRegex=/^<(\w+).*<\/\1>$/;that.content=ko.pureComputed(function(){return that.shownPage().text.map(function(paragraph){var p=paragraph.reduce(function(prev,current){return prev+=createTagString(current)},'');if(p&&!tagCheckRegex.test(p)){p='<p>'+p+'</p>'}return p}).join('\n')});that.image=ko.pureComputed(function(){return that.shownPage().image||''});that.nextHandler=function(){that.pageIndex((that.pageIndex()+1)%that.pages.length);if(!that.seenLastPage()&&that.pageIndex()===that.pages.length-1){that.seenLastPage(true)}};that.prevHandler=function(){var i=that.pageIndex();that.pageIndex(i?i-1:that.pages.length-1)};var closeButton={label:ko.pureComputed(function(){if(that.seenLastPage()){return params.finishLabel||'CLOSE'}else{return params.nextLabel||'NEXT'}}),keepOpen:ko.pureComputed(function(){return!that.seenLastPage()}),callback:function(){if(!that.seenLastPage()){that.nextHandler()}else if(typeof params.finishHandler==='function'){params.finishHandler(that.neverAgain())}},className:'primary'};that.buttons=ko.observableArray([closeButton]);that.titleIcon=params.titleIcon;that.topColor=params.topColor;that.neverAgainLabel=ko.pureComputed(function(){return ko.unwrap(params.neverAgainLabel)||false});that.neverAgain=ko.observable(false)}return SequenceDialogModalView})}());(function(){var define=System.amdDefine;(function(root,factory){if(typeof exports==='object'){module.exports=factory(require('knockout'))}else if(typeof define==='function'&&define.amd){define('3rdparty/knockout-transformations/map.js',['node_modules/knockout/build/output/knockout-latest.debug.js'],factory)}else{factory(root.ko)}}(this,function(ko){ko.transformations=ko.transformations||{fn:{}};function StateItem(inputItem,initialStateArrayIndex,initialOutputArrayIndex,mappingOptions,arrayOfState,outputObservableArray){this.inputItem=inputItem;this.stateArrayIndex=initialStateArrayIndex;this.mappingOptions=mappingOptions;this.arrayOfState=arrayOfState;this.outputObservableArray=outputObservableArray;this.outputArray=this.outputObservableArray.peek();this.isIncluded=null;this.suppressNotification=false;this.outputArrayIndex=ko.observable(initialOutputArrayIndex);this.disposeFuncFromMostRecentMapping=null;this.mappedValueComputed=ko.computed(this.mappingEvaluator,this);this.mappedValueComputed.subscribe(this.onMappingResultChanged,this);this.previousMappedValue=this.mappedValueComputed.peek()}StateItem.prototype.dispose=function(){this.mappedValueComputed.dispose();this.disposeResultFromMostRecentEvaluation()};StateItem.prototype.disposeResultFromMostRecentEvaluation=function(){if(this.disposeFuncFromMostRecentMapping){this.disposeFuncFromMostRecentMapping();this.disposeFuncFromMostRecentMapping=null}if(this.mappingOptions.disposeItem){var mappedItem=this.mappedValueComputed();this.mappingOptions.disposeItem(mappedItem)}};StateItem.prototype.mappingEvaluator=function(){if(this.isIncluded!==null){this.disposeResultFromMostRecentEvaluation()}var mappedValue;if(this.mappingOptions.mapping){mappedValue=this.mappingOptions.mapping(this.inputItem,this.outputArrayIndex)}else if(this.mappingOptions.mappingWithDisposeCallback){var mappedValueWithDisposeCallback=this.mappingOptions.mappingWithDisposeCallback(this.inputItem,this.outputArrayIndex);if(!('mappedValue'in mappedValueWithDisposeCallback)){throw new Error('Return value from mappingWithDisposeCallback should have a \'mappedItem\' property.')}mappedValue=mappedValueWithDisposeCallback.mappedValue;this.disposeFuncFromMostRecentMapping=mappedValueWithDisposeCallback.dispose}else{throw new Error('No mapping callback given.')}if(this.isIncluded===null){this.isIncluded=mappedValue!==this.mappingOptions.exclusionMarker}return mappedValue};StateItem.prototype.updateInclusion=function(){var outputArrayIndex=this.outputArrayIndex.peek();var outputArray=this.outputArray;for(var iterationIndex=this.stateArrayIndex;iterationIndex<this.arrayOfState.length;iterationIndex+=1){var stateItem=this.arrayOfState[iterationIndex];stateItem.setOutputArrayIndexSilently(outputArrayIndex);var newValue=stateItem.mappingEvaluator();var newInclusionState=newValue!==this.mappingOptions.exclusionMarker;if(newInclusionState){outputArray[outputArrayIndex]=newValue;outputArrayIndex+=1}stateItem.previousMappedValue=newValue;stateItem.isIncluded=newInclusionState}if(outputArrayIndex<outputArray.length){outputArray.length=outputArrayIndex}};StateItem.prototype.onMappingResultChanged=function(newValue){if(newValue!==this.previousMappedValue){if(!this.suppressNotification){this.outputObservableArray.valueWillMutate()}var newInclusionState=newValue!==this.mappingOptions.exclusionMarker;if(this.isIncluded!==newInclusionState){this.updateInclusion()}else{if(newInclusionState){this.outputArray[this.outputArrayIndex.peek()]=newValue}this.previousMappedValue=newValue}if(!this.suppressNotification){this.outputObservableArray.valueHasMutated()}}};StateItem.prototype.setOutputArrayIndexSilently=function(newIndex){this.suppressNotification=true;this.outputArrayIndex(newIndex);this.suppressNotification=false};function getDiffEntryPostOperationIndex(diffEntry,editOffset){if(!diffEntry){return null}switch(diffEntry.status){case'added':return diffEntry.index;case'deleted':return diffEntry.index+editOffset;default:throw new Error('Unknown diff status: '+diffEntry.status)}}function insertOutputItem(diffEntry,movedStateItems,stateArrayIndex,outputArrayIndex,mappingOptions,arrayOfState,outputObservableArray,outputArray){var isMoved=typeof diffEntry.moved==='number',stateItem=isMoved?movedStateItems[diffEntry.moved]:new StateItem(diffEntry.value,stateArrayIndex,outputArrayIndex,mappingOptions,arrayOfState,outputObservableArray);arrayOfState.splice(stateArrayIndex,0,stateItem);if(stateItem.isIncluded){outputArray.splice(outputArrayIndex,0,stateItem.mappedValueComputed.peek())}if(isMoved){stateItem.stateArrayIndex=stateArrayIndex;stateItem.setOutputArrayIndexSilently(outputArrayIndex)}return stateItem}function deleteOutputItem(diffEntry,arrayOfState,stateArrayIndex,outputArrayIndex,outputArray){var stateItem=arrayOfState.splice(stateArrayIndex,1)[0];if(stateItem.isIncluded){outputArray.splice(outputArrayIndex,1)}if(typeof diffEntry.moved!=='number'){stateItem.dispose()}}function updateRetainedOutputItem(stateItem,stateArrayIndex,outputArrayIndex){stateItem.stateArrayIndex=stateArrayIndex;stateItem.setOutputArrayIndexSilently(outputArrayIndex);return outputArrayIndex+(stateItem.isIncluded?1:0)}function makeLookupOfMovedStateItems(diff,arrayOfState){var movedStateItems={};for(var diffIndex=0;diffIndex<diff.length;diffIndex+=1){var diffEntry=diff[diffIndex];if(diffEntry.status==='added'&&typeof diffEntry.moved==='number'){movedStateItems[diffEntry.moved]=arrayOfState[diffEntry.moved]}}return movedStateItems}function getFirstModifiedOutputIndex(firstDiffEntry,arrayOfState,outputArray){if(!outputArray.length||!arrayOfState[firstDiffEntry.index]){return outputArray.length}else{return arrayOfState[firstDiffEntry.index].outputArrayIndex.peek()}}function respondToArrayStructuralChanges(inputObservableArray,arrayOfState,outputArray,outputObservableArray,mappingOptions){return inputObservableArray.subscribe(function(diff){if(!diff.length){return}if(arrayOfState.length===0){var newOutputItems=[];ko.utils.arrayForEach(diff,function(diffEntry,i){var inputItem=diffEntry.value;var stateItem=new StateItem(inputItem,i,newOutputItems.length,mappingOptions,arrayOfState,outputObservableArray);var mappedValue=stateItem.mappedValueComputed.peek();arrayOfState.push(stateItem);if(stateItem.isIncluded){newOutputItems.push(mappedValue)}});outputObservableArray.push.apply(outputObservableArray,newOutputItems);return}outputObservableArray.valueWillMutate();var movedStateItems=makeLookupOfMovedStateItems(diff,arrayOfState),diffIndex=0,diffEntry=diff[0],editOffset=0,outputArrayIndex=diffEntry&&getFirstModifiedOutputIndex(diffEntry,arrayOfState,outputArray);for(var stateArrayIndex=diffEntry.index;diffEntry||stateArrayIndex<arrayOfState.length;stateArrayIndex+=1){if(getDiffEntryPostOperationIndex(diffEntry,editOffset)===stateArrayIndex){switch(diffEntry.status){case'added':var stateItem=insertOutputItem(diffEntry,movedStateItems,stateArrayIndex,outputArrayIndex,mappingOptions,arrayOfState,outputObservableArray,outputArray);if(stateItem.isIncluded){outputArrayIndex+=1}editOffset+=1;break;case'deleted':deleteOutputItem(diffEntry,arrayOfState,stateArrayIndex,outputArrayIndex,outputArray);editOffset-=1;stateArrayIndex-=1;break;default:throw new Error('Unknown diff status: '+diffEntry.status)}diffIndex+=1;diffEntry=diff[diffIndex]}else if(stateArrayIndex<arrayOfState.length){outputArrayIndex=updateRetainedOutputItem(arrayOfState[stateArrayIndex],stateArrayIndex,outputArrayIndex)}}outputObservableArray.valueHasMutated()},null,'arrayChange')}ko.observableArray.fn.map=ko.transformations.fn.map=function map(mappingOptions){var that=this,arrayOfState=[],outputArray=[],outputObservableArray=ko.observableArray(outputArray),originalInputArrayContents=that.peek();if(typeof mappingOptions==='function'){mappingOptions={mapping:mappingOptions}}if(!mappingOptions.exclusionMarker){mappingOptions.exclusionMarker={}}if(mappingOptions.mappingWithDisposeCallback){if(mappingOptions.mapping||mappingOptions.disposeItem){throw new Error('\'mappingWithDisposeCallback\' cannot be used in conjunction with \'mapping\' or \'disposeItem\'.')}}else if(!mappingOptions.mapping){throw new Error('Specify either \'mapping\' or \'mappingWithDisposeCallback\'.')}for(var i=0;i<originalInputArrayContents.length;i+=1){var inputItem=originalInputArrayContents[i],stateItem=new StateItem(inputItem,i,outputArray.length,mappingOptions,arrayOfState,outputObservableArray),mappedValue=stateItem.mappedValueComputed.peek();arrayOfState.push(stateItem);if(stateItem.isIncluded){outputArray.push(mappedValue)}}var inputArraySubscription=respondToArrayStructuralChanges(that,arrayOfState,outputArray,outputObservableArray,mappingOptions);var outputComputed=ko.computed(outputObservableArray);if('throttle'in mappingOptions){outputComputed=outputComputed.extend({throttle:mappingOptions.throttle})}var returnValue=outputComputed.extend({trackArrayChanges:true}),originalDispose=returnValue.dispose;returnValue.dispose=function(){inputArraySubscription.dispose();ko.utils.arrayForEach(arrayOfState,function(stateItem){stateItem.dispose()});originalDispose.call(this,arguments)};ko.utils.extend(returnValue,ko.transformations.fn);return returnValue};return ko.transformations.fn.map}))}());(function(){var define=System.amdDefine;define('3rdparty/knockout-modal-dialog/ModalDialogViewModel.js',['node_modules/knockout/build/output/knockout-latest.debug.js','3rdparty/knockout-transformations/map.js'],function(ko){var topColors={green:'#9CBC73',yellow:'#E2BA5B',aqua:'#58C4A9',paleblue:'#B6DFE8',coral:'#E58477'};function ModalDialogViewModel(params,componentInfo){var that=this;that.show=params.show||ko.observable(true);that.cornerCloser=params.cornerCloser?function(){that.show(false)}:false;var buttons;if(params.close){buttons=ko.observableArray([params.close])}else if(ko.isObservable(params.buttons)){if(params.buttons.map){buttons=params.buttons}else{buttons=ko.observableArray(params.buttons());var buttonSub=params.buttons.subscribe(function(list){buttons(list)});ko.utils.domNodeDisposal.addDisposeCallback(componentInfo.element,function(){buttonSub.dispose()})}}else if(Array.isArray(params.buttons)){buttons=ko.observableArray(params.buttons)}else{buttons=ko.observableArray()}that.buttons=buttons.map(function(buttonParams){return{label:ko.unwrap(buttonParams.label),className:ko.unwrap(buttonParams.className)||'',handler:ko.unwrap(buttonParams.keepOpen)?buttonParams.callback:function(){that.show(false);if(typeof buttonParams.callback==='function'){buttonParams.callback()}}}});that.titleContent=ko.computed(function(){var title='';if(params.titleIcon){title+='<span class="title-icon"><img class="dialog-icon" src="'+ko.unwrap(params.titleIcon)+'"></span>'}title+='<span class="title">'+(ko.unwrap(params.titleText)||'').replace('<','&lt;')+'</span>';if(params.titleRight&&ko.unwrap(params.titleRight)){title+='<span class="title-right">'+ko.unwrap(params.titleRight)+'</span>'}return title});that.topColor=topColors[ko.unwrap(params.topColor)]||params.topColor||topColors.green;that.topHeight=params.topHeight||'62px';that.nodesInDialog=componentInfo.templateNodes;that.outerData=ko.contextFor(componentInfo.element).$data}return ModalDialogViewModel})}());(function(){var define=System.amdDefine;define('3rdparty/knockout-modal-overlay/viewModel.js',['node_modules/knockout/build/output/knockout-latest.debug.js'],function(ko){return function(params,componentInfo){var that={};var showingDelayTimer;that.gracefullyShowOverlay=!!params.gracefullyShow;that.showOverlay=params.showOverlay;that.showOverlay.subscribe(function(newValue){if(that.gracefullyShowOverlay){if(showingDelayTimer){clearTimeout(showingDelayTimer)}if(newValue){showingDelayTimer=setTimeout(function(){that.isOverlayActive(true)},2000)}else{that.isOverlayActive(false)}}else{that.isOverlayActive(newValue)}});that.nodesInOverlay=componentInfo.templateNodes;that.outerData=ko.contextFor(componentInfo.element).$data;that.isOverlayActive=ko.observable(that.showOverlay());return that}})}());System.registerDynamic('3rdparty/knockout-modal-overlay/modal-overlay.ko!3rdparty/systemjs-plugin-ko-tpl.js',[],true,function($__require,exports,module){var define,global=this||self,GLOBAL=global;module.exports=function injectTemplate(tpl){var s=document.createElement('script');s.id=tpl.id;s.innerHTML=window.TR?TR.HTML(tpl.content):tpl.content;s.type='text/html';document.head.appendChild(s)}({'id':'modal-overlay','content':'<div class="overlay-container" data-bind="css: { \'active\': isOverlayActive }">\n    <!-- ko template: { nodes: nodesInOverlay, data: outerData } --><!-- /ko -->\n</div>\n'});return module.exports});(function(){var define=System.amdDefine;define('3rdparty/knockout-modal-overlay/overlay.js',['node_modules/knockout/build/output/knockout-latest.debug.js','3rdparty/knockout-modal-overlay/viewModel.js','3rdparty/knockout-modal-overlay/modal-overlay.ko!3rdparty/systemjs-plugin-ko-tpl.js'],function(ko,viewModel){ko.components.register('modal-overlay',{viewModel:{createViewModel:viewModel},template:{element:'modal-overlay'}})})}());System.registerDynamic('3rdparty/knockout-modal-dialog/modal-dialog.ko!3rdparty/systemjs-plugin-ko-tpl.js',[],true,function($__require,exports,module){var define,global=this||self,GLOBAL=global;module.exports=function injectTemplate(tpl){var s=document.createElement('script');s.id=tpl.id;s.innerHTML=window.TR?TR.HTML(tpl.content):tpl.content;s.type='text/html';document.head.appendChild(s)}({'id':'modal-dialog','content':'<!-- ko if: show -->\n<modal-overlay params="showOverlay: ko.observable(true)">\n    <div class="modal-dialog" data-bind="css: { \'title-top\': titleContent }">\n        <div class="dialog-top" data-bind="html: titleContent, style: { backgroundColor: topColor, height: topHeight }"></div>\n        <!-- ko if: cornerCloser --><div class="corner-closer" data-bind="click: cornerCloser"><span class="icon-remove-item"></span></div><!-- /ko -->\n        <!-- ko template: { nodes: nodesInDialog, data: outerData } --><!-- /ko -->\n        <div class="buttons" data-bind="foreach: buttons">\n            <button data-bind="click: handler, text: label, css: className"></button>\n        </div>\n    </div>\n</modal-overlay>\n<!-- /ko -->\n'});return module.exports});(function(){var define=System.amdDefine;define('3rdparty/knockout-modal-dialog/modalDialog.js',['node_modules/knockout/build/output/knockout-latest.debug.js','3rdparty/knockout-modal-dialog/ModalDialogViewModel.js','3rdparty/knockout-modal-overlay/overlay.js','3rdparty/knockout-modal-dialog/modal-dialog.ko!3rdparty/systemjs-plugin-ko-tpl.js'],function(ko,ViewModel){ko.components.register('modal-dialog',{viewModel:{createViewModel:function(params,componentInfo){return new ViewModel(params,componentInfo)}},template:{element:'modal-dialog'}})})}());System.registerDynamic('3rdparty/knockout-sequence-dialog/sequence-dialog.ko!3rdparty/systemjs-plugin-ko-tpl.js',[],true,function($__require,exports,module){var define,global=this||self,GLOBAL=global;module.exports=function injectTemplate(tpl){var s=document.createElement('script');s.id=tpl.id;s.innerHTML=window.TR?TR.HTML(tpl.content):tpl.content;s.type='text/html';document.head.appendChild(s)}({'id':'sequence-dialog','content':'<modal-dialog params="show: show, buttons: buttons, titleText: title, titleIcon: titleIcon, topColor: topColor, titleRight: pageNumber">\n    <!-- ko if: pages.length > 1 -->\n        <button class="pager next" data-bind="click: nextHandler"></button>\n        <button class="pager prev" data-bind="click: prevHandler"></button>\n    <!-- /ko -->\n    <div data-bind="html: content"></div>\n    <div class="image" data-bind="if: image">\n        <img data-bind="attr: { src: image }">\n    </div>\n    <div class="neverAgain" data-bind="if: neverAgainLabel">\n        <input id="seqCheckNeverAgain" type="checkbox" data-bind="checked: neverAgain">\n        <label for="seqCheckNeverAgain" data-bind="text: neverAgainLabel"></label>\n    </div>\n</modal-dialog>\n'});return module.exports});(function(){var define=System.amdDefine;define('3rdparty/knockout-sequence-dialog/sequenceDialog.js',['node_modules/knockout/build/output/knockout-latest.debug.js','3rdparty/knockout-sequence-dialog/SequenceDialogViewModel.js','3rdparty/knockout-modal-dialog/modalDialog.js','3rdparty/knockout-sequence-dialog/sequence-dialog.ko!3rdparty/systemjs-plugin-ko-tpl.js'],function(ko,ViewModel){ko.components.register('sequence-dialog',{viewModel:{createViewModel:function(params,componentInfo){return new ViewModel(params,componentInfo)}},template:{element:'sequence-dialog'}})})}());(function(){var define=System.amdDefine;define('welcome/model/WelcomeView.js',['node_modules/jquery/dist/jquery.js','node_modules/knockout/build/output/knockout-latest.debug.js','webmail/actions/CreateProductAddOnCookieAction.js','common/actions/SavePreferencesAction.js','common/actions/LoadPreferencesAction.js','3rdparty/page.js','3rdparty/one-theme/images/icons/welcome/*.svg?svgfilter=--runScript=../../colorFilter.js,--color=%23FFFFFF&inkscape=--export-width=40,--export-area=0:0:40:40!node_modules/systemjs-asset-plugin/asset-plugin.js','3rdparty/knockout-sequence-dialog/sequenceDialog.js'],function($,ko,CreateProductAddOnCookieAction,SavePreferencesAction,LoadPreferencesAction,page,welcomeImageAssetUrlGetter){var CURRENT_UI=7;function WelcomeView(state,actionExecutor,errorHandler){this.state=state;this.actionExecutor=actionExecutor;this.errorHandler=errorHandler;this.newUserDialogVisible=ko.observable(false);this.newUIDialogVisible=ko.observable(false);this.touchDialogVisible=ko.observable(false);this.displayName=ko.observable('');var that=this;that.closeLabel=TR('welcome.CloseDialog','Close');that.settingsLabel=TR('welcome.PersonalizeSettings','Personalize settings');that.nextLabel=TR('welcome.Next','Next');that.gotoSettings=function(){that.saveIntroScreenShownPreference(function(){page.show('/settings')})};that.savePrefs=function(){that.saveIntroScreenShownPreference()};that.saveName=function(){that.setDisplayName()};function getTitleIcon(icon){return welcomeImageAssetUrlGetter(icon)}that.newUserIcon=getTitleIcon('rocket');that.newUserTitle=TR('welcome.NewUserTitle','Welcome to the One.com Webmail!');that.newUserPages=[{text:[[{tag:'h1',text:TR('welcome.AdFreeWebmail','Ad-free webmail with lots of space').toLocaleUpperCase()}],[TR('welcome.AllowsToCheckFromAnyComputer','Webmail allows you to access your mail from any modern web browser, Chrome, Firefox, Internet Explorer or Safari. Check your mail at work, on vacation or anywhere you are - no need for setting up a seperate mail program.')],[{tag:'h1',text:TR('welcome.OnlineCalendar','Online calendar').toLocaleUpperCase()}],[TR('welcome.ComesWithBuiltInCalendar','Webmail at One.com also comes with a calendar. The calendar provides you with easy access to create appointments and schedule your day, and even let you publish a calendar to a website.')],[{tag:'h1',text:TR('welcome.BuiltInAddressBook','Webmail with built-in address book').toLocaleUpperCase()}],[TR('welcome.YouAlwaysHaveYourContacts','With email addresses, phone numbers and addresses at hand in your webmail, you can always get the contact information you need - wherever you are.')]]}];that.newUIIcon=getTitleIcon('shootingStar');that.newUITitle=TR('welcome.WhatsNew','What\'s new');that.newUIPages=[{text:[[{tag:'h1',text:TR('welcome.v20.CalendarAgenda','Get a quick look of your agenda')}],[TR('welcome.v20.CalendarAgendaDescription','Get quick access to your calendar from the inbox, by clicking the date today in the upper right corner. See upcoming events and get an easy overview of your day.')]],image:'https://mail-static.cdn-one.com/v20CalendarQuickLook.03f4a68c23.png'},{text:[[{tag:'h1',text:TR('welcome.v20.SettingsUpdate','Updated design for Settings')}],[TR('welcome.v20.SettingsUpdateDescription','Your settings got a new fresh design for input fields and drop downs. Go and check it out!')]],image:'https://mail-static.cdn-one.com/v20settingsUpdate.9c87f0b8af.png'},{text:[[{tag:'h1',text:TR('welcome.v20.SettingsUpdateSpam','Turn your spam filter on and off')}],[TR('welcome.v20.SettingsUpdateSpamDescription','You can now enable the spam filter directly under "Account administration" in your settings. No need to go to the Control Panel anymore.')]],image:'https://mail-static.cdn-one.com/v20enableSpamFilter.b6dc5668c5.png'}]}WelcomeView.prototype.saveIntroScreenShownPreference=function(done){var that=this;var mail=that.state.preferences.mail();var showIntroScreen=mail.showIntroScreen;mail.showIntroScreen=false;mail.showUIUpdate=CURRENT_UI;that.state.preferences.mail(mail);that.actionExecutor.enqueue(new SavePreferencesAction({page:'mail'}),function(err){that.errorHandler.handleError(err,{409:function(){}});if(showIntroScreen){that.actionExecutor.enqueue(new CreateProductAddOnCookieAction,function(err){done&&done()})}else if(done){done()}})};WelcomeView.prototype.setDisplayName=function(){var that=this;var global=that.state.preferences.global();global.displayName=that.displayName();that.touchDialogVisible(false);that.state.preferences.global(global);that.actionExecutor.enqueue(new SavePreferencesAction({page:'global'}),function(err){that.errorHandler.handleError(err,{409:function(){that.actionExecutor.enqueue(new LoadPreferencesAction,function(err){that.errorHandler.handleError(err)})}})})};WelcomeView.prototype.showIfNecessary=function(){var that=this;var mail=that.state.preferences.mail();var global=that.state.preferences.global();if(mail.showIntroScreen){if(('ontouchstart'in document.documentElement||navigator.msMaxTouchPoints)&&!global.displayName){that.touchDialogVisible(true)}else if(mail['x-migrated']){that.newUserDialogVisible(true)}else{that.newUserDialogVisible(true)}}else if(!mail.showUIUpdate||mail.showUIUpdate<CURRENT_UI){that.newUIDialogVisible(true)}};return WelcomeView})}());(function(){var define=System.amdDefine;define('eas/model/EASView.js',['node_modules/knockout/build/output/knockout-latest.debug.js','3rdparty/page.js','3rdparty/LocalStorage.js','common/actions/SavePreferencesAction.js'],function(ko,page,LocalStorage,SavePreferencesAction){function EASView(state,backend,actionExecutor){this.state=state;this.backend=backend;this.actionExecutor=actionExecutor;this.isDialogVisible=ko.observable(false)}EASView.prototype.init=function(){var user=this.state.user();var mail=this.state.preferences.mail();var isEASAvailable=this.state.preferences.EAS().available;var hasSubscription=!!this.state.preferences.EAS().currentSubscription;var mailPreferences=this.state.preferences.mail();var showIntroScreen=!mailPreferences||mailPreferences.showIntroScreen;var shouldDelay=this.backend.hasAddOnProductCoolOffCookie(user);if(!hasBeenDisplayedFromStorage(user)&&!mail.isEASScreenShown&&isEASAvailable&&!hasSubscription&&!showIntroScreen&&!shouldDelay){this.isDialogVisible(true);mail.isEASScreenShown=true;this.state.preferences.mail(mail);this.actionExecutor.enqueue(new SavePreferencesAction({page:'mail'}))}else{this.isDialogVisible(false)}};function hasBeenDisplayedFromStorage(user){if(new LocalStorage().isWorking()){return new LocalStorage(user).subStorage('EASAddOnDialog').getItem('hasBeenDisplayed')}else{return false}}return EASView})}());(function(){var define=System.amdDefine;define('theme/LoadingScreen.js',[],function(){var loadingScreenElement=document.getElementById('loadingScreen');return{show:function(){loadingScreenElement.style.display=''},hide:function(){loadingScreenElement.style.display='none'}}})}());(function(){var define=System.amdDefine;(function(global){function SignalBinding(signal,listener,isOnce,listenerContext,priority){this._listener=listener;this._isOnce=isOnce;this.context=listenerContext;this._signal=signal;this._priority=priority||0}SignalBinding.prototype={active:true,params:null,execute:function(paramsArr){var handlerReturn,params;if(this.active&&!!this._listener){params=this.params?this.params.concat(paramsArr):paramsArr;handlerReturn=this._listener.apply(this.context,params);if(this._isOnce){this.detach()}}return handlerReturn},detach:function(){return this.isBound()?this._signal.remove(this._listener,this.context):null},isBound:function(){return!!this._signal&&!!this._listener},isOnce:function(){return this._isOnce},getListener:function(){return this._listener},getSignal:function(){return this._signal},_destroy:function(){delete this._signal;delete this._listener;delete this.context},toString:function(){return'[SignalBinding isOnce:'+this._isOnce+', isBound:'+this.isBound()+', active:'+this.active+']'}};function validateListener(listener,fnName){if(typeof listener!=='function'){throw new Error('listener is a required param of {fn}() and should be a Function.'.replace('{fn}',fnName))}}function Signal(){this._bindings=[];this._prevParams=null;var self=this;this.dispatch=function(){Signal.prototype.dispatch.apply(self,arguments)}}Signal.prototype={VERSION:'1.0.0',memorize:false,_shouldPropagate:true,active:true,_registerListener:function(listener,isOnce,listenerContext,priority){var prevIndex=this._indexOfListener(listener,listenerContext),binding;if(prevIndex!==-1){binding=this._bindings[prevIndex];if(binding.isOnce()!==isOnce){throw new Error('You cannot add'+(isOnce?'':'Once')+'() then add'+(!isOnce?'':'Once')+'() the same listener without removing the relationship first.')}}else{binding=new SignalBinding(this,listener,isOnce,listenerContext,priority);this._addBinding(binding)}if(this.memorize&&this._prevParams){binding.execute(this._prevParams)}return binding},_addBinding:function(binding){var n=this._bindings.length;do{--n}while(this._bindings[n]&&binding._priority<=this._bindings[n]._priority);this._bindings.splice(n+1,0,binding)},_indexOfListener:function(listener,context){var n=this._bindings.length,cur;while(n--){cur=this._bindings[n];if(cur._listener===listener&&cur.context===context){return n}}return-1},has:function(listener,context){return this._indexOfListener(listener,context)!==-1},add:function(listener,listenerContext,priority){validateListener(listener,'add');return this._registerListener(listener,false,listenerContext,priority)},addOnce:function(listener,listenerContext,priority){validateListener(listener,'addOnce');return this._registerListener(listener,true,listenerContext,priority)},remove:function(listener,context){validateListener(listener,'remove');var i=this._indexOfListener(listener,context);if(i!==-1){this._bindings[i]._destroy();this._bindings.splice(i,1)}return listener},removeAll:function(){var n=this._bindings.length;while(n--){this._bindings[n]._destroy()}this._bindings.length=0},getNumListeners:function(){return this._bindings.length},halt:function(){this._shouldPropagate=false},dispatch:function(params){if(!this.active){return}var paramsArr=Array.prototype.slice.call(arguments),n=this._bindings.length,bindings;if(this.memorize){this._prevParams=paramsArr}if(!n){return}bindings=this._bindings.slice();this._shouldPropagate=true;do{n--}while(bindings[n]&&this._shouldPropagate&&bindings[n].execute(paramsArr)!==false)},forget:function(){this._prevParams=null},dispose:function(){this.removeAll();delete this._bindings;delete this._prevParams},toString:function(){return'[Signal active:'+this.active+' numListeners:'+this.getNumListeners()+']'}};var signals=Signal;signals.Signal=Signal;if(typeof define==='function'&&define.amd){define('3rdparty/signals.js',[],function(){return signals})}else if(typeof module!=='undefined'&&module.exports){module.exports=signals}else{global['signals']=signals}}(this))}());System.registerDynamic('locale',[],true,function($__require,exports,module){var define,global=this||self,GLOBAL=global;var localeId=function(){function normalizeLocaleId(localeId){return localeId&&localeId.replace(/-/g,'_').toLowerCase()}var documentElement=document&&document.documentElement;var documentElementLang=documentElement&&normalizeLocaleId(documentElement.getAttribute('lang'));if(documentElementLang){return documentElementLang}if(window.location&&location.href){var matchLocationHref=location.href.match(/\?(?:|[^#]*&)locale=([\w\-_]+)(?:[&#]|$)/);if(matchLocationHref){var queryStringLocaleId=normalizeLocaleId(matchLocationHref[1]);return queryStringLocaleId}}var matchLocaleCookieValue=document.cookie&&document.cookie.match(/\bOneLang=([\w-]+)/);if(matchLocaleCookieValue){var cookieLocaleId=normalizeLocaleId(matchLocaleCookieValue[1]);return cookieLocaleId}if(window.navigator&&navigator.language&&navigator.language!=='C'){return normalizeLocaleId(navigator.language)}return'en_us'}();if(typeof document!=='undefined'&&document.documentElement&&localeId!==document.documentElement.getAttribute('lang')){document.documentElement.setAttribute('lang',localeId)}module.exports=localeId;return module.exports});(function(){var define=System.amdDefine;define('common/LocaleSwitcher.js',['locale','node_modules/jquery/dist/jquery.js','node_modules/knockout/build/output/knockout-latest.debug.js','common/util.js','3rdparty/jquery.cookie.js'],function(currentLocaleId,$,ko,util){function LocaleSwitcher(supportedLocaleIds){var that=this;that.localeMap={};if(supportedLocaleIds&&supportedLocaleIds.length>0){that.localeInfos=that.localeInfos.filter(function(locale){return supportedLocaleIds.indexOf(locale.id)!==-1});that.localeInfos.forEach(function(locale){that.localeMap[locale.id]=locale.displayName})}}LocaleSwitcher.prototype.switchLocale=function(localeId){if(localeId!==currentLocaleId){var hostname=location.hostname;var cookieDomain='';if(hostname!=='localhost'){cookieDomain='.'+hostname.split('.').splice(-2,2).join('.')}$.cookie('OneLang',localeId,{expires:365*2,path:'/',domain:cookieDomain});document.location.reload(true)}};LocaleSwitcher.prototype.localeInfos=[{id:'cs',displayName:'Čeština'},{id:'da',displayName:'Dansk'},{id:'de',displayName:'Deutsch'},{id:'en_gb',displayName:'English (UK)'},{id:'en_us',displayName:'English (US)'},{id:'es',displayName:'Español'},{id:'fr',displayName:'Français'},{id:'it',displayName:'Italiano'},{id:'nl',displayName:'Nederlands'},{id:'nb',displayName:'Norsk'},{id:'pl',displayName:'Polski'},{id:'pt',displayName:'Português (Portugal)'},{id:'pt_br',displayName:'Português (Brasil)'},{id:'ru',displayName:'Pусский'},{id:'sv',displayName:'Svenska'},{id:'fi',displayName:'Suomi'}];LocaleSwitcher.prototype.getLanguage=function(localeId){var that=this,locale=that.localeInfos.filter(function(info){return info.id===localeId});return locale[0]};return LocaleSwitcher})}());(function(){var define=System.amdDefine;define('3rdparty/version-tracking/Version.js',['node_modules/knockout/build/output/knockout-latest.debug.js'],function(ko){function Version(){var that=this,versionPattern=/^(\d+)\.(\d+)\.(\d+)$/;function parseFromDocument(){var documentElement=document.documentElement,attributeValue=documentElement&&documentElement.getAttribute('data-version')||'',version=attributeValue.match(/(?:\d+\.?)+/);return version&&version[0].match(versionPattern)?version[0]:null}function segmentVersionNumber(version){var segments=version.match(versionPattern);if(segments){return{major:parseInt(segments[1],10),minor:parseInt(segments[2],10),patch:parseInt(segments[3],10)}}}function isLessThanVersion(current,other){return current.major<other.major||current.major===other.major&&current.minor<other.minor||current.major===other.major&&current.minor===other.minor&&current.patch<other.patch}that.clientVersion=ko.observable('');that.serverVersion=ko.observable('');that.minimumClientVersion=ko.observable('');that.updatePriority=ko.pureComputed(function(){var client=segmentVersionNumber(that.clientVersion()),server=segmentVersionNumber(that.serverVersion()),minimumClientVersion=segmentVersionNumber(that.minimumClientVersion());if(client&&minimumClientVersion&&isLessThanVersion(client,minimumClientVersion)){return 3}if(server&&client){if(isLessThanVersion(server,client)){return-2}else if(server.major>client.major){return 3}else if(server.minor>client.minor){return 2}else if(server.patch>client.patch){return 1}else{return 0}}else{return-1}});that.init=function(){var clientVersion=parseFromDocument();if(clientVersion){that.clientVersion(clientVersion);that.serverVersion(clientVersion)}};that.init()}var instance=new Version;window.one=window.one||{};window.one.version=instance;return instance})}());(function(){var define=System.amdDefine;define('3rdparty/version-tracking/VersionTracker.js',['node_modules/jquery/dist/jquery.js','3rdparty/version-tracking/Version.js'],function($,Version){function VersionTracker(){var doc=$(document),that=this;doc.ajaxSend(function(e,xhr,ajaxOptions){var clientVersion;if(!that.enabled){return}if(ajaxOptions.crossDomain){return}clientVersion=Version.clientVersion();if(clientVersion){xhr.setRequestHeader('X-One-Version',clientVersion)}});doc.ajaxComplete(function(e,xhr,ajaxOptions){var serverVersion,minimumClientVersion;if(!that.enabled){return}if(ajaxOptions.crossDomain){return}serverVersion=xhr.getResponseHeader('X-One-Version');if(serverVersion){Version.serverVersion(serverVersion)}minimumClientVersion=xhr.getResponseHeader('X-One-Minimum-Client-Version');if(minimumClientVersion){Version.minimumClientVersion(minimumClientVersion)}});that.enabled=true}VersionTracker.prototype.start=function(){this.enabled=true};VersionTracker.prototype.stop=function(){this.enabled=false};return new VersionTracker})}());(function(){var define=System.amdDefine;define('3rdparty/version-tracking/VersionUpgradeTimer.js',[],function(){function VersionUpgradeTimer(options){options=options||{};var minute=60000;var hour=60*minute;this.timeBeforeStartingUpgrade=Math.floor(Math.random()*6*hour);this.idleTimeBeforeUpgrading=3*minute;this.upgradeTimer=null;this.idleTimer=null;this.readyToUpgrade=false;this.onReadyToUpgrade=options.onReadyToUpgrade}VersionUpgradeTimer.prototype._startIdleTimer=function(){var that=this;this.idleTimer=setTimeout(function(){that.readyToUpgrade=true;if(that.onReadyToUpgrade){that.onReadyToUpgrade()}},this.idleTimeBeforeUpgrading)};VersionUpgradeTimer.prototype.start=function(){var that=this;if(!this.upgradeTimer){this.upgradeTimer=setTimeout(function(){that._startIdleTimer()},this.timeBeforeStartingUpgrade)}};VersionUpgradeTimer.prototype.restartIdleTimer=function(){if(!this.readyToUpgrade&&this.idleTimer){clearTimeout(this.idleTimer);this._startIdleTimer()}};VersionUpgradeTimer.prototype.upgradeIfReady=function(){if(this.readyToUpgrade){window.location.reload(true)}};return VersionUpgradeTimer})}());(function(){var define=System.amdDefine;define('common/AppCourier.js',['3rdparty/LocalStorage.js','3rdparty/page.js','common/util.js'],function(LocalStorage,page,util){var storage=new LocalStorage('AppCourier');function getQuery(){return util.decodePairs(page.current.replace(/^.*\?/,''))}function getLocation(){return page.current.replace(/\?.*$/,'')}var CHARS='0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz'.split('');function newMessageID(){var i,uuid=[],len=16;for(i=0;i<len;i+=1){uuid[i]=CHARS[0|Math.random()*CHARS.length]}return uuid.join('')}function getDispatchId(){var query=getQuery();return query.dispatchId}function storeMessage(id,data){var timeout=new Date;timeout.setHours(timeout.getHours()+1);data={timeout:timeout.toISOString(),message:data};storage.setJSON('dispatch '+id,data)}function fetchMessage(id){return storage.getJSON('dispatch '+id)}function depart(url,messageData,fail){var hasQuery=/\?/.test(url);if(storage.isWorking()){var messageId=newMessageID();storeMessage(messageId,messageData);url+=(hasQuery?'&':'?')+'dispatchId='+messageId}else{url+=(hasQuery?'&':'?')+'dispatch='+encodeURIComponent(JSON.stringify(messageData));var origin=window.location.origin?window.location.origin:window.location.protocol+'//'+window.location.host;var maximumSerializedUrlLength=2048;if(origin.length+url.length>=maximumSerializedUrlLength){if(typeof fail==='function'){fail()}return}}page.show(url)}function awaits(){if(storage.isWorking()){var id=getDispatchId();return storage.hasItem('dispatch '+id)}else{return!!getQuery().dispatch}}function arrive(){var message,id;if(storage.isWorking()){id=getDispatchId();message=fetchMessage(id).message}else{message=JSON.parse(getQuery().dispatch||'')}clear();return message}function clear(){var id,query,url;if(storage.isWorking()){id=getDispatchId();storage.removeItem('dispatch '+id);query=getQuery();delete query.dispatchId;url=getLocation()+util.createUrlQueryPart(query);page.redirect(url)}else{query=getQuery();delete query.dispatch;url=getLocation()+util.createUrlQueryPart(query);page.redirect(url)}}function garbageCollect(){var now=new Date;storage.keys().forEach(function(key){key=key.substring('AppCourier '.length);var timeout=new Date(storage.getJSON(key).timeout);if(now>timeout){storage.removeItem(key)}})}garbageCollect();return{depart:depart,awaits:awaits,arrive:arrive}})}());(function(){var define=System.amdDefine;define('common/heartbeat.js',['node_modules/@one.com/tracking-analytics/lib/tracking.js'],function(tracking){return function(interval){setInterval(function(){tracking.sendHeartbeat()},interval||5*60*1000)}})}());(function(){var define=System.amdDefine;!function(e){if('object'==typeof exports&&'undefined'!=typeof module)module.exports=e();else if('function'==typeof define&&define.amd)define('3rdparty/page.js',[],e);else{var f;'undefined'!=typeof window?f=window:'undefined'!=typeof global?f=global:'undefined'!=typeof self&&(f=self),f.page=e()}}(function(){var define,module,exports;return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=='function'&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error('Cannot find module \''+o+'\'');throw f.code='MODULE_NOT_FOUND',f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=='function'&&require;for(var o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){(function(process){'use strict';var pathtoRegexp=require('path-to-regexp');module.exports=page;var clickEvent='undefined'!==typeof document&&document.ontouchstart?'touchstart':'click';var location='undefined'!==typeof window&&(window.history.location||window.location);var dispatch=true;var decodeURLComponents=true;var base='';var running;var hashbang=false;var prevContext;function page(path,fn){if('function'===typeof path){return page('*',path)}if('function'===typeof fn){var route=new Route(path);for(var i=1;i<arguments.length;++i){page.callbacks.push(route.middleware(arguments[i]))}}else if('string'===typeof path){page['string'===typeof fn?'redirect':'show'](path,fn)}else{page.start(path)}}page.callbacks=[];page.exits=[];page.current='';page.len=0;page.base=function(path){if(0===arguments.length)return base;base=path};page.start=function(options){options=options||{};if(running)return;running=true;if(false===options.dispatch)dispatch=false;if(false===options.decodeURLComponents)decodeURLComponents=false;if(false!==options.popstate)window.addEventListener('popstate',onpopstate,false);if(false!==options.click){document.addEventListener(clickEvent,onclick,false)}if(true===options.hashbang)hashbang=true;if(!dispatch)return;var url=hashbang&&~location.hash.indexOf('#!')?location.hash.substr(2)+location.search:location.pathname+location.search+location.hash;page.replace(url,null,true,dispatch)};page.stop=function(){if(!running)return;page.current='';page.len=0;running=false;document.removeEventListener(clickEvent,onclick,false);window.removeEventListener('popstate',onpopstate,false)};page.show=function(path,state,dispatch,push){var ctx=new Context(path,state);page.current=ctx.path;function dispatchNext(){if(false!==dispatch)page.dispatchEnter(ctx);if(false!==ctx.handled&&false!==push)ctx.pushState()}if(false!==dispatch){page.dispatchExit(dispatchNext)}else{dispatchNext()}return ctx};page.back=function(path,state){if(page.len>0){history.back();page.len--}else if(path){setTimeout(function(){page.show(path,state)})}else{setTimeout(function(){page.show(base,state)})}};page.redirect=function(from,to){if('string'===typeof from&&'string'===typeof to){page(from,function(e){setTimeout(function(){page.replace(to)},0)})}if('string'===typeof from&&'undefined'===typeof to){setTimeout(function(){page.replace(from)},0)}};page.replace=function(path,state,init,dispatch){var ctx=new Context(path,state);page.current=ctx.path;ctx.init=init;ctx.save();if(false!==dispatch)page.dispatch(ctx);return ctx};page.dispatchExit=function(cb){var prev=prevContext,i=0;var inExitChain=true;function nextExit(){var fn=page.exits[i++];if(!fn){inExitChain=false;return cb()}fn(prev,nextExit)}if(prev){nextExit();if(inExitChain&&page.revertState)page.revertState(prev);page.revertState=null}else{cb()}};page.dispatchEnter=function(ctx){var i=0;prevContext=ctx;function nextEnter(){var fn=page.callbacks[i++];if(ctx.path!==page.current){ctx.handled=false;return}if(!fn){return unhandled(ctx)}fn(ctx,nextEnter)}nextEnter()};page.dispatch=function(ctx){page.dispatchExit(function(){page.dispatchEnter(ctx)})};function unhandled(ctx){if(ctx.handled)return;var current;if(hashbang){current=base+location.hash.replace('#!','')}else{current=location.pathname+location.search}if(current===ctx.canonicalPath)return;page.stop();ctx.handled=false;location.href=ctx.canonicalPath}page.exit=function(path,fn){if(typeof path==='function'){return page.exit('*',path)}var route=new Route(path);for(var i=1;i<arguments.length;++i){page.exits.push(route.middleware(arguments[i]))}};function decodeURLEncodedURIComponent(val){if(typeof val!=='string'){return val}return decodeURLComponents?decodeURIComponent(val.replace(/\+/g,' ')):val}function Context(path,state){if('/'===path[0]&&0!==path.indexOf(base))path=base+(hashbang?'#!':'')+path;var i=path.indexOf('?');this.canonicalPath=path;this.path=path.replace(base,'')||'/';if(hashbang)this.path=this.path.replace('#!','')||'/';this.title=document.title;this.state=state||{};this.state.path=path;this.querystring=~i?decodeURLEncodedURIComponent(path.slice(i+1)):'';this.pathname=decodeURLEncodedURIComponent(~i?path.slice(0,i):path);this.params={};this.hash='';if(!hashbang){if(!~this.path.indexOf('#'))return;var parts=this.path.split('#');this.path=parts[0];this.hash=decodeURLEncodedURIComponent(parts[1])||'';this.querystring=this.querystring.split('#')[0]}}page.Context=Context;Context.prototype.pushState=function(){page.len++;history.pushState(this.state,this.title,hashbang&&this.path!=='/'?'#!'+this.path:this.canonicalPath)};Context.prototype.save=function(){history.replaceState(this.state,this.title,hashbang&&this.path!=='/'?'#!'+this.path:this.canonicalPath)};function Route(path,options){options=options||{};this.path=path==='*'?'(.*)':path;this.method='GET';this.regexp=pathtoRegexp(this.path,this.keys=[],options.sensitive,options.strict)}page.Route=Route;Route.prototype.middleware=function(fn){var self=this;return function(ctx,next){if(self.match(ctx.path,ctx.params))return fn(ctx,next);next()}};Route.prototype.match=function(path,params){var keys=this.keys,qsIndex=path.indexOf('?'),pathname=~qsIndex?path.slice(0,qsIndex):path,m=this.regexp.exec(pathname);if(!m)return false;for(var i=1,len=m.length;i<len;++i){var key=keys[i-1];var val=decodeURLEncodedURIComponent(m[i]);if(val!==undefined||!hasOwnProperty.call(params,key.name)){params[key.name]=val}}return true};var onpopstate=function(){var loaded=false;if('undefined'===typeof window){return}if(document.readyState==='complete'){loaded=true}else{window.addEventListener('load',function(){setTimeout(function(){loaded=true},0)})}return function onpopstate(e){if(!loaded)return;page.revertState=function(prevState){page.show(prevState.pathname,prevState.state,false)};if(e.state){var path=e.state.path;page.replace(path,e.state)}else{page.show(location.pathname+location.hash,undefined,undefined,false)}}}();function onclick(e){if(1!==which(e))return;if(e.metaKey||e.ctrlKey||e.shiftKey)return;if(e.defaultPrevented)return;var el=e.target;while(el&&'A'!==el.nodeName)el=el.parentNode;if(!el||'A'!==el.nodeName)return;if(el.hasAttribute('download')||el.getAttribute('rel')==='external')return;var link=el.getAttribute('href');if(!hashbang&&el.pathname===location.pathname&&(el.hash||'#'===link))return;if(link&&link.indexOf('mailto:')>-1)return;if(el.target)return;if(!sameOrigin(el.href))return;var path=el.pathname+el.search+(el.hash||'');if(typeof process!=='undefined'&&path.match(/^\/[a-zA-Z]:\//)){path=path.replace(/^\/[a-zA-Z]:\//,'/')}var orig=path;if(path.indexOf(base)===0){path=path.substr(base.length)}if(hashbang)path=path.replace('#!','');if(base&&orig===path)return;e.preventDefault();page.show(orig)}function which(e){e=e||window.event;return null===e.which?e.button:e.which}function sameOrigin(href){var origin=location.protocol+'//'+location.hostname;if(location.port)origin+=':'+location.port;return href&&0===href.indexOf(origin)}page.sameOrigin=sameOrigin}.call(this,require('_process')))},{'_process':2,'path-to-regexp':3}],2:[function(require,module,exports){var process=module.exports={};process.nextTick=function(){var canSetImmediate=typeof window!=='undefined'&&window.setImmediate;var canMutationObserver=typeof window!=='undefined'&&window.MutationObserver;var canPost=typeof window!=='undefined'&&window.postMessage&&window.addEventListener;;if(canSetImmediate){return function(f){return window.setImmediate(f)}}var queue=[];if(canMutationObserver){var hiddenDiv=document.createElement('div');var observer=new MutationObserver(function(){var queueList=queue.slice();queue.length=0;queueList.forEach(function(fn){fn()})});observer.observe(hiddenDiv,{attributes:true});return function nextTick(fn){if(!queue.length){hiddenDiv.setAttribute('yes','no')}queue.push(fn)}}if(canPost){window.addEventListener('message',function(ev){var source=ev.source;if((source===window||source===null)&&ev.data==='process-tick'){ev.stopPropagation();if(queue.length>0){var fn=queue.shift();fn()}}},true);return function nextTick(fn){queue.push(fn);window.postMessage('process-tick','*')}}return function nextTick(fn){setTimeout(fn,0)}}();process.title='browser';process.browser=true;process.env={};process.argv=[];function noop(){}process.on=noop;process.addListener=noop;process.once=noop;process.off=noop;process.removeListener=noop;process.removeAllListeners=noop;process.emit=noop;process.binding=function(name){throw new Error('process.binding is not supported')};process.cwd=function(){return'/'};process.chdir=function(dir){throw new Error('process.chdir is not supported')}},{}],3:[function(require,module,exports){var isArray=require('isarray');module.exports=pathToRegexp;var PATH_REGEXP=new RegExp(['(\\\\.)','([\\/.])?(?:\\:(\\w+)(?:\\(((?:\\\\.|[^)])*)\\))?|\\(((?:\\\\.|[^)])*)\\))([+*?])?','([.+*?=^!:${}()[\\]|\\/])'].join('|'),'g');function escapeGroup(group){return group.replace(/([=!:$\/()])/g,'\\$1')}function attachKeys(re,keys){re.keys=keys;return re}function flags(options){return options.sensitive?'':'i'}function regexpToRegexp(path,keys){var groups=path.source.match(/\((?!\?)/g);if(groups){for(var i=0;i<groups.length;i++){keys.push({name:i,delimiter:null,optional:false,repeat:false})}}return attachKeys(path,keys)}function arrayToRegexp(path,keys,options){var parts=[];for(var i=0;i<path.length;i++){parts.push(pathToRegexp(path[i],keys,options).source)}var regexp=new RegExp('(?:'+parts.join('|')+')',flags(options));return attachKeys(regexp,keys)}function replacePath(path,keys){var index=0;function replace(_,escaped,prefix,key,capture,group,suffix,escape){if(escaped){return escaped}if(escape){return'\\'+escape}var repeat=suffix==='+'||suffix==='*';var optional=suffix==='?'||suffix==='*';keys.push({name:key||index++,delimiter:prefix||'/',optional:optional,repeat:repeat});prefix=prefix?'\\'+prefix:'';capture=escapeGroup(capture||group||'[^'+(prefix||'\\/')+']+?');if(repeat){capture=capture+'(?:'+prefix+capture+')*'}if(optional){return'(?:'+prefix+'('+capture+'))?'}return prefix+'('+capture+')'}return path.replace(PATH_REGEXP,replace)}function pathToRegexp(path,keys,options){keys=keys||[];if(!isArray(keys)){options=keys;keys=[]}else if(!options){options={}}if(path instanceof RegExp){return regexpToRegexp(path,keys,options)}if(isArray(path)){return arrayToRegexp(path,keys,options)}var strict=options.strict;var end=options.end!==false;var route=replacePath(path,keys);var endsWithSlash=path.charAt(path.length-1)==='/';if(!strict){route=(endsWithSlash?route.slice(0,-2):route)+'(?:\\/(?=$))?'}if(end){route+='$'}else{route+=strict&&endsWithSlash?'':'(?=\\/|$)'}return attachKeys(new RegExp('^'+route,flags(options)),keys)}},{'isarray':4}],4:[function(require,module,exports){module.exports=Array.isArray||function(arr){return Object.prototype.toString.call(arr)=='[object Array]'}},{}]},{},[1])(1)})}());(function(){var define=System.amdDefine;define('common/model/EmailNotification.js',['3rdparty/page.js'],function(page){function EmailNotification(options){if(!('Notification'in window)){return}var that=this;var mails=Object.keys(options.mails).map(function(key){return options.mails[key]});var timeout=options.timeout||10*1000;this.user=options.user;if(!this.user){throw new Error('PushNotification: user not defined')}this.title=titleComposer(mails);this.link=getLink(this.user,mails);this.notification=new window.Notification(this.title,{body:bodyComposer(mails),tag:'one_email_received',icon:'https://mail-static.cdn-one.com/mail.inkscape--export-width45.ab58bf9125.png'});this.notification.addEventListener('click',function(){window.focus();page.show(that.link);that.notification.close()});this.closeTimeout=window.setTimeout(function(){if(that.notification){that.notification.close()}},timeout)}function titleComposer(mails){if(mails.length>1){return inter.trQuantity(TR('mail.notification.YouHaveXMails',{one:'You have {0} mail',other:'You have {0} mails'}),mails.length)}else{return TR('mail.notification.YouHaveMail','You have mail')}}function getTruncatedSubject(mail,bodySize){bodySize=bodySize||24;var subject=mail.subject();if(subject.length>=bodySize){subject=subject.substring(0,bodySize)+' ...'}return subject}function bodyComposer(mails){if(mails.length>1){return TR('mail.notification.GoToInbox','Go to inbox')}else{return getTruncatedSubject(mails[0])}}function getLink(user,mails){return'/'+user+'/INBOX/1/'+(mails.length>1?'':mails[0].uid)}return EmailNotification})}());(function(){var define=System.amdDefine;define('common/model/Flag.js',[],function(){function Flag(name,imap){var that=this;that.name=name;that.imap=imap}Flag.SEEN=new Flag('seen','\\Seen');Flag.ANSWERED=new Flag('answered','\\Answered');Flag.FORWARDED=new Flag('forwarded','$Forwarded');Flag.FLAGGED=new Flag('flagged','\\Flagged');Flag.ONECOMLOADIMG=new Flag('oneComLoadImg','OneComLoadImg');Flag.ONECOMDISREGARDSPF=new Flag('oneComDisregardSPF','oneComDisregardSPF');Flag.SUBMITPENDING=new Flag('submitPending','$SubmitPending');return Flag})}());(function(){var define=System.amdDefine;(function(root,factory){if(typeof exports==='object'){module.exports=factory()}else if(typeof define==='function'&&define.amd){define('3rdparty/onevalidation/validation.js',[],factory)}else{root.one=root.one||{};root.one.validation=factory()}}(this,function(){'use strict';function concatRegExps(){var source='',i=0;for(;i<arguments.length;i+=1){if(Object.prototype.toString.call(arguments[i])==='[object RegExp]'){source+=arguments[i].source}else{source+=arguments[i]}}return source}var ipv4DigitRegExpSource=/(?:[0-9]|1?[0-9][0-9]|2[0-4][0-9]|25[0-5])/.source,validation={functions:{}},fragments={visibleNonAsciiChar:/[ªµºÀ-ÖØ-öø-ˁˆ-ˑˠ-ˤˬˮͰ-ʹͶͷͺ-ͽΆΈ-ΊΌΎ-ΡΣ-ϵϷ-ҁҊ-ԥԱ-Ֆՙա-ևא-תװ-ײء-يٮٯٱ-ۓەۥۦۮۯۺ-ۼۿܐܒ-ܯݍ-ޥޱߊ-ߪߴߵߺࠀ-ࠕࠚࠤࠨऄ-हऽॐक़-ॡॱॲॹ-ॿঅ-ঌএঐও-নপ-রলশ-হঽৎড়ঢ়য়-ৡৰৱਅ-ਊਏਐਓ-ਨਪ-ਰਲਲ਼ਵਸ਼ਸਹਖ਼-ੜਫ਼ੲ-ੴઅ-ઍએ-ઑઓ-નપ-રલળવ-હઽૐૠૡଅ-ଌଏଐଓ-ନପ-ରଲଳଵ-ହଽଡ଼ଢ଼ୟ-ୡୱஃஅ-ஊஎ-ஐஒ-கஙசஜஞடணதந-பம-ஹௐఅ-ఌఎ-ఐఒ-నప-ళవ-హఽౘౙౠౡಅ-ಌಎ-ಐಒ-ನಪ-ಳವ-ಹಽೞೠೡഅ-ഌഎ-ഐഒ-നപ-ഹഽൠൡൺ-ൿඅ-ඖක-නඳ-රලව-ෆก-ะาำเ-ๆກຂຄງຈຊຍດ-ທນ-ຟມ-ຣລວສຫອ-ະາຳຽເ-ໄໆໜໝༀཀ-ཇཉ-ཬྈ-ྋက-ဪဿၐ-ၕၚ-ၝၡၥၦၮ-ၰၵ-ႁႎႠ-Ⴥა-ჺჼᄀ-ቈቊ-ቍቐ-ቖቘቚ-ቝበ-ኈኊ-ኍነ-ኰኲ-ኵኸ-ኾዀዂ-ዅወ-ዖዘ-ጐጒ-ጕጘ-ፚᎀ-ᎏᎠ-Ᏼᐁ-ᙬᙯ-ᙿᚁ-ᚚᚠ-ᛪᜀ-ᜌᜎ-ᜑᜠ-ᜱᝀ-ᝑᝠ-ᝬᝮ-ᝰក-ឳៗៜᠠ-ᡷᢀ-ᢨᢪᢰ-ᣵᤀ-ᤜᥐ-ᥭᥰ-ᥴᦀ-ᦫᧁ-ᧇᨀ-ᨖᨠ-ᩔᪧᬅ-ᬳᭅ-ᭋᮃ-ᮠᮮᮯᰀ-ᰣᱍ-ᱏᱚ-ᱽᳩ-ᳬᳮ-ᳱᴀ-ᶿḀ-ἕἘ-Ἕἠ-ὅὈ-Ὅὐ-ὗὙὛὝὟ-ώᾀ-ᾴᾶ-ᾼιῂ-ῄῆ-ῌῐ-ΐῖ-Ίῠ-Ῥῲ-ῴῶ-ῼⁱⁿₐ-ₔℂℇℊ-ℓℕℙ-ℝℤΩℨK-ℭℯ-ℹℼ-ℿⅅ-ⅉⅎↃↄⰀ-Ⱞⰰ-ⱞⱠ-ⳤⳫ-ⳮⴀ-ⴥⴰ-ⵥⵯⶀ-ⶖⶠ-ⶦⶨ-ⶮⶰ-ⶶⶸ-ⶾⷀ-ⷆⷈ-ⷎⷐ-ⷖⷘ-ⷞⸯ々〆〱-〵〻〼ぁ-ゖゝ-ゟァ-ヺー-ヿㄅ-ㄭㄱ-ㆎㆠ-ㆷㇰ-ㇿ㐀-䶵一-鿋ꀀ-ꒌꓐ-ꓽꔀ-ꘌꘐ-ꘟꘪꘫꙀ-ꙟꙢ-ꙮꙿ-ꚗꚠ-ꛥꜗ-ꜟꜢ-ꞈꞋꞌꟻ-ꠁꠃ-ꠅꠇ-ꠊꠌ-ꠢꡀ-ꡳꢂ-ꢳꣲ-ꣷꣻꤊ-ꤥꤰ-ꥆꥠ-ꥼꦄ-ꦲꧏꨀ-ꨨꩀ-ꩂꩄ-ꩋꩠ-ꩶꩺꪀ-ꪯꪱꪵꪶꪹ-ꪽꫀꫂꫛ-ꫝꯀ-ꯢ가-힣ힰ-ퟆퟋ-ퟻ豈-鶴侮-舘並-龎ﬀ-ﬆﬓ-ﬗיִײַ-ﬨשׁ-זּטּ-לּמּנּסּףּפּצּ-ﮱﯓ-ﴽﵐ-ﶏﶒ-ﷇﷰ-ﷻﹰ-ﹴﹶ-ﻼＡ-Ｚａ-ｚｦ-ﾾￂ-ￇￊ-ￏￒ-ￗￚ-ￜ̀-ͯ҃-҉֑-ׇֽֿׁׂׅׄؐ-ًؚ-ٰٞۖ-ۜ۞-۪ۤۧۨ-ܑۭܰ-݊ަ-ް߫-߳ࠖ-࠙ࠛ-ࠣࠥ-ࠧࠩ-࠭ऀ-ः़ा-ॎ॑-ॕॢॣঁ-ঃ়া-ৄেৈো-্ৗৢৣਁ-ਃ਼ਾ-ੂੇੈੋ-੍ੑੰੱੵઁ-ઃ઼ા-ૅે-ૉો-્ૢૣଁ-ଃ଼ା-ୄେୈୋ-୍ୖୗୢୣஂா-ூெ-ைொ-்ௗఁ-ఃా-ౄె-ైొ-్ౕౖౢౣಂಃ಼ಾ-ೄೆ-ೈೊ-್ೕೖೢೣംഃാ-ൄെ-ൈൊ-്ൗൢൣංඃ්ා-ුූෘ-ෟෲෳัิ-ฺ็-๎ັິ-ູົຼ່-ໍ༹༘༙༵༷༾༿ཱ-྄྆྇ྐ-ྗྙ-ྼ࿆ါ-ှၖ-ၙၞ-ၠၢ-ၤၧ-ၭၱ-ၴႂ-ႍႏႚ-ႝ፟ᜒ-᜔ᜲ-᜴ᝒᝓᝲᝳា-៓៝᠋-᠍ᢩᤠ-ᤫᤰ-᤻ᦰ-ᧀᧈᧉᨗ-ᨛᩕ-ᩞ᩠-᩿᩼ᬀ-ᬄ᬴-᭄᭫-᭳ᮀ-ᮂᮡ-᮪ᰤ-᰷᳐-᳔᳒-᳨᳭ᳲ᷀-᷽ᷦ-᷿⃐-⃰⳯-⳱ⷠ-〪ⷿ-゙゚〯꙯-꙲꙼꙽꛰꛱ꠂ꠆ꠋꠣ-ꠧꢀꢁꢴ-꣄꣠-꣱ꤦ-꤭ꥇ-꥓ꦀ-ꦃ꦳-꧀ꨩ-ꨶꩃꩌꩍꩻꪰꪲ-ꪴꪷꪸꪾ꪿꫁ꯣ-ꯪ꯬꯭ﬞ︀-️︠-︦²³¹¼-¾٠-٩۰-۹߀-߉०-९০-৯৴-৹੦-੯૦-૯୦-୯௦-௲౦-౯౸-౾೦-೯൦-൵๐-๙໐-໙༠-༳၀-၉႐-႙፩-፼ᛮ-ᛰ០-៩៰-៹᠐-᠙᥆-᥏᧐-᧚᪀-᪉᪐-᪙᭐-᭙᮰-᮹᱀-᱉᱐-᱙⁰⁴-⁹₀-₉⅐-ↂↅ-↉①-⒛⓪-⓿❶-➓⳽〇〡-〩〸-〺㆒-㆕㈠-㈩㉑-㉟㊀-㊉㊱-㊿꘠-꘩ꛦ-ꛯ꠰-꠵꣐-꣙꤀-꤉꧐-꧙꩐-꩙꯰-꯹０-９¡«·»¿;·՚-՟։֊־׀׃׆׳״؉؊،؍؛؞؟٪-٭۔܀-܍߷-߹࠰-࠾।॥॰෴๏๚๛༄-༒༺-༽྅࿐-࿔၊-၏჻፡-፨᐀᙭᙮᚛᚜᛫-᛭᜵᜶។-៖៘-៚᠀-᠊᥄᥅᧞᧟᨞᨟᪠-᪦᪨-᪭᭚-᭠᰻-᰿᱾᱿᳓‐-‧‰-⁃⁅-⁑⁓-⁞⁽⁾₍₎〈〉❨-❵⟅⟆⟦-⟯⦃-⦘⧘-⧛⧼⧽⳹-⳼⳾⳿⸀-⸮⸰⸱、-〃〈-】〔-〟〰〽゠・꓾꓿꘍-꘏꙳꙾꛲-꛷꡴-꡷꣎꣏꣸-꣺꤮꤯꥟꧁-꧍꧞꧟꩜-꩟꫞꫟꯫﴾﴿︐-︙︰-﹒﹔-﹡﹣﹨﹪﹫！-＃％-＊，-／：；？＠［-］＿｛｝｟-･¢-©¬®-±´¶¸×÷˂-˅˒-˟˥-˫˭˯-˿͵΄΅϶҂؆-؈؋؎؏۩۽۾߶৲৳৺৻૱୰௳-௺౿ೱೲ൹฿༁-༃༓-༗༚-༟༴༶༸྾-࿅࿇-࿌࿎࿏࿕-࿘႞႟፠᎐-᎙៛᥀᧠-᧿᭡-᭪᭴-᭼᾽᾿-῁῍-῏῝-῟῭-`´῾⁄⁒⁺-⁼₊-₌₠-₸℀℁℃-℆℈℉℔№-℘℞-℣℥℧℩℮℺℻⅀-⅄⅊-⅍⅏←-⌨⌫-⏨␀-␦⑀-⑊⒜-ⓩ─-⛍⛏-⛡⛣⛨-⛿✁-✄✆-✉✌-✧✩-❋❍❏-❒❖-❞❡-❧➔➘-➯➱-➾⟀-⟄⟇-⟊⟌⟐-⟥⟰-⦂⦙-⧗⧜-⧻⧾-⭌⭐-⭙⳥-⳪⺀-⺙⺛-⻳⼀-⿕⿰-⿻〄〒〓〠〶〷〾〿゛゜㆐㆑㆖-㆟㇀-㇣㈀-㈞㈪-㉐㉠-㉿㊊-㊰㋀-㋾㌀-㏿䷀-䷿꒐-꓆꜀-꜖꜠꜡꞉꞊꠨-꠫꠶-꠹꩷-꩹﬩﷼﷽﹢﹤-﹦﹩＄＋＜-＞＾｀｜～￠-￦￨-\uffee\ufffc\ufffd]/,domainPart:/[a-z0-9](?:[\-a-z0-9]*[a-z0-9])?/i,tld:/[a-z][\-a-z]*[a-z]/i,port:/\d{1,5}/,localpart:/[a-z0-9!#$%&'*+\/=?\^_`{|}~\-:][\.a-z0-9!#$%&'*+\/=?\^_`{|}~\-]*/i,user:/[^:@\/]+/i,uuid:/[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}/i,lowerCaseUuid:/[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}/,upperCaseUuid:/[0-9A-F]{8}-[0-9A-F]{4}-[0-9A-F]{4}-[0-9A-F]{4}-[0-9A-F]{12}/,password:/[^@\/]+?/i,pathname:/[\w\-\.~%!$&'\(\)*+,;=:@\/]*/,search:/[\w\-\.~%!$&'\(\)*+,;=:@\/?]*/,hash:/[\w\-\.~%!$&'\(\)*+,;=:@\/?#]*/,ipv4:new RegExp('(?:'+ipv4DigitRegExpSource+'\\.){3}'+ipv4DigitRegExpSource)},name;var alphanumericalPlusVisibleNonAsciiChars=new RegExp(fragments.visibleNonAsciiChar.source.replace(/^\[/,'[a-z0-9')),alphabeticalPlusVisibleNonAsciiChars=new RegExp(fragments.visibleNonAsciiChar.source.replace(/^\[/,'[a-z'));fragments.domainPartIdn=new RegExp(concatRegExps(alphanumericalPlusVisibleNonAsciiChars,'(?:',new RegExp(alphanumericalPlusVisibleNonAsciiChars.source.replace(/^\[/,'[\\-')+'*'),alphanumericalPlusVisibleNonAsciiChars,')?'));fragments.tldIdn=new RegExp(concatRegExps(alphabeticalPlusVisibleNonAsciiChars,new RegExp(alphabeticalPlusVisibleNonAsciiChars.source.replace(/^\[/,'[\\-')+'*'),alphabeticalPlusVisibleNonAsciiChars));fragments.domain=fragments.domainName=new RegExp('(?:'+fragments.domainPart.source+'\\.)+'+fragments.tld.source,'i');fragments.domainIdn=fragments.domainNameIdn=new RegExp('(?:'+fragments.domainPartIdn.source+'\\.)+'+fragments.tldIdn.source,'i');fragments.email=fragments.emailAddress=new RegExp(fragments.localpart.source+'@'+fragments.domain.source,'i');fragments.emailIdn=fragments.emailAddressIdn=new RegExp(fragments.localpart.source+'@'+fragments.domainIdn.source,'i');fragments.mailtoUrl=new RegExp('mailto:'+fragments.email.source,'i');fragments.mailtoUrlIdn=new RegExp('mailto:'+fragments.emailIdn.source,'i');fragments.pathnameSearchHash=new RegExp(concatRegExps('(?:/',fragments.pathname,'(?:\\?',fragments.search,')?','(?:#',fragments.hash,')?',')?'));function createHttpishUrlRegExp(options){options=options||{};return new RegExp(concatRegExps(options.scheme||'https?','://','(?:',fragments.user,'(?::',fragments.password,')?@',')?','(?:',options.localhost?'localhost|':'',options.idn?fragments.domainIdn:fragments.domain,'|',fragments.ipv4,')','(?::',fragments.port,')?',fragments.pathnameSearchHash),'i')}fragments.httpUrl=createHttpishUrlRegExp({scheme:/https?/});fragments.httpUrlIdn=createHttpishUrlRegExp({scheme:/https?/,idn:true});fragments.ftpUrl=createHttpishUrlRegExp({scheme:/ftp/});fragments.ftpUrlIdn=createHttpishUrlRegExp({scheme:/ftp/,idn:true});function getFlagsStringFromRegExp(regExp){var flagsString='';if(regExp.ignoreCase){flagsString+='i'}if(regExp.global){flagsString+='g'}if(regExp.multiline){flagsString+='m'}return flagsString}for(name in fragments){if(fragments.hasOwnProperty(name)){validation[name]=new RegExp('^'+fragments[name].source+'$',getFlagsStringFromRegExp(fragments[name]));validation.functions[name]=function(name){return function(value){return validation[name].test(value)}}(name)}}validation.fragments=fragments;validation.createHttpishUrlRegExp=createHttpishUrlRegExp;return validation}))}());(function(){var define=System.amdDefine;;(function(root){var freeExports=typeof exports=='object'&&exports&&!exports.nodeType&&exports;var freeModule=typeof module=='object'&&module&&!module.nodeType&&module;var freeGlobal=typeof global=='object'&&global;if(freeGlobal.global===freeGlobal||freeGlobal.window===freeGlobal||freeGlobal.self===freeGlobal){root=freeGlobal}var punycode,maxInt=2147483647,base=36,tMin=1,tMax=26,skew=38,damp=700,initialBias=72,initialN=128,delimiter='-',regexPunycode=/^xn--/,regexNonASCII=/[^\x20-\x7E]/,regexSeparators=/[\x2E\u3002\uFF0E\uFF61]/g,errors={'overflow':'Overflow: input needs wider integers to process','not-basic':'Illegal input >= 0x80 (not a basic code point)','invalid-input':'Invalid input'},baseMinusTMin=base-tMin,floor=Math.floor,stringFromCharCode=String.fromCharCode,key;function error(type){throw RangeError(errors[type])}function map(array,fn){var length=array.length;var result=[];while(length--){result[length]=fn(array[length])}return result}function mapDomain(string,fn){var parts=string.split('@');var result='';if(parts.length>1){result=parts[0]+'@';string=parts[1]}var labels=string.split(regexSeparators);var encoded=map(labels,fn).join('.');return result+encoded}function ucs2decode(string){var output=[],counter=0,length=string.length,value,extra;while(counter<length){value=string.charCodeAt(counter++);if(value>=55296&&value<=56319&&counter<length){extra=string.charCodeAt(counter++);if((extra&64512)==56320){output.push(((value&1023)<<10)+(extra&1023)+65536)}else{output.push(value);counter--}}else{output.push(value)}}return output}function ucs2encode(array){return map(array,function(value){var output='';if(value>65535){value-=65536;output+=stringFromCharCode(value>>>10&1023|55296);value=56320|value&1023}output+=stringFromCharCode(value);return output}).join('')}function basicToDigit(codePoint){if(codePoint-48<10){return codePoint-22}if(codePoint-65<26){return codePoint-65}if(codePoint-97<26){return codePoint-97}return base}function digitToBasic(digit,flag){return digit+22+75*(digit<26)-((flag!=0)<<5)}function adapt(delta,numPoints,firstTime){var k=0;delta=firstTime?floor(delta/damp):delta>>1;delta+=floor(delta/numPoints);for(;delta>baseMinusTMin*tMax>>1;k+=base){delta=floor(delta/baseMinusTMin)}return floor(k+(baseMinusTMin+1)*delta/(delta+skew))}function decode(input){var output=[],inputLength=input.length,out,i=0,n=initialN,bias=initialBias,basic,j,index,oldi,w,k,digit,t,baseMinusT;basic=input.lastIndexOf(delimiter);if(basic<0){basic=0}for(j=0;j<basic;++j){if(input.charCodeAt(j)>=128){error('not-basic')}output.push(input.charCodeAt(j))}for(index=basic>0?basic+1:0;index<inputLength;){for(oldi=i,w=1,k=base;;k+=base){if(index>=inputLength){error('invalid-input')}digit=basicToDigit(input.charCodeAt(index++));if(digit>=base||digit>floor((maxInt-i)/w)){error('overflow')}i+=digit*w;t=k<=bias?tMin:k>=bias+tMax?tMax:k-bias;if(digit<t){break}baseMinusT=base-t;if(w>floor(maxInt/baseMinusT)){error('overflow')}w*=baseMinusT}out=output.length+1;bias=adapt(i-oldi,out,oldi==0);if(floor(i/out)>maxInt-n){error('overflow')}n+=floor(i/out);i%=out;output.splice(i++,0,n)}return ucs2encode(output)}function encode(input){var n,delta,handledCPCount,basicLength,bias,j,m,q,k,t,currentValue,output=[],inputLength,handledCPCountPlusOne,baseMinusT,qMinusT;input=ucs2decode(input);inputLength=input.length;n=initialN;delta=0;bias=initialBias;for(j=0;j<inputLength;++j){currentValue=input[j];if(currentValue<128){output.push(stringFromCharCode(currentValue))}}handledCPCount=basicLength=output.length;if(basicLength){output.push(delimiter)}while(handledCPCount<inputLength){for(m=maxInt,j=0;j<inputLength;++j){currentValue=input[j];if(currentValue>=n&&currentValue<m){m=currentValue}}handledCPCountPlusOne=handledCPCount+1;if(m-n>floor((maxInt-delta)/handledCPCountPlusOne)){error('overflow')}delta+=(m-n)*handledCPCountPlusOne;n=m;for(j=0;j<inputLength;++j){currentValue=input[j];if(currentValue<n&&++delta>maxInt){error('overflow')}if(currentValue==n){for(q=delta,k=base;;k+=base){t=k<=bias?tMin:k>=bias+tMax?tMax:k-bias;if(q<t){break}qMinusT=q-t;baseMinusT=base-t;output.push(stringFromCharCode(digitToBasic(t+qMinusT%baseMinusT,0)));q=floor(qMinusT/baseMinusT)}output.push(stringFromCharCode(digitToBasic(q,0)));bias=adapt(delta,handledCPCountPlusOne,handledCPCount==basicLength);delta=0;++handledCPCount}}++delta;++n}return output.join('')}function toUnicode(input){return mapDomain(input,function(string){return regexPunycode.test(string)?decode(string.slice(4).toLowerCase()):string})}function toASCII(input){return mapDomain(input,function(string){return regexNonASCII.test(string)?'xn--'+encode(string):string})}punycode={'version':'1.3.1','ucs2':{'decode':ucs2decode,'encode':ucs2encode},'decode':decode,'encode':encode,'toASCII':toASCII,'toUnicode':toUnicode};if(typeof define=='function'&&typeof define.amd=='object'&&define.amd){define('3rdparty/punycode.js',[],function(){return punycode})&&define('punycode',['3rdparty/punycode.js'],function(m){return m})}else if(freeExports&&freeModule){if(module.exports==freeExports){freeModule.exports=punycode}else{for(key in punycode){punycode.hasOwnProperty(key)&&(freeExports[key]=punycode[key])}}}else{root.punycode=punycode}}(this))}());(function(){var define=System.amdDefine;(function(root,factory){if(typeof exports==='object'){module.exports=factory()}else if(typeof define==='function'&&define.amd){define('3rdparty/unicodeRegExp.js',[],factory)}else{root.unicodeRegExp=factory()}}(this,function(xregexp){var unicodeRegExp={};unicodeRegExp.letter=/[A-Za-zªµºÀ-ÖØ-öø-ˁˆ-ˑˠ-ˤˬˮͰ-ʹͶͷͺ-ͽΆΈ-ΊΌΎ-ΡΣ-ϵϷ-ҁҊ-ԧԱ-Ֆՙա-ևא-תװ-ײؠ-يٮٯٱ-ۓەۥۦۮۯۺ-ۼۿܐܒ-ܯݍ-ޥޱߊ-ߪߴߵߺࠀ-ࠕࠚࠤࠨࡀ-ࡘࢠࢢ-ࢬऄ-हऽॐक़-ॡॱ-ॷॹ-ॿঅ-ঌএঐও-নপ-রলশ-হঽৎড়ঢ়য়-ৡৰৱਅ-ਊਏਐਓ-ਨਪ-ਰਲਲ਼ਵਸ਼ਸਹਖ਼-ੜਫ਼ੲ-ੴઅ-ઍએ-ઑઓ-નપ-રલળવ-હઽૐૠૡଅ-ଌଏଐଓ-ନପ-ରଲଳଵ-ହଽଡ଼ଢ଼ୟ-ୡୱஃஅ-ஊஎ-ஐஒ-கஙசஜஞடணதந-பம-ஹௐఅ-ఌఎ-ఐఒ-నప-ళవ-హఽౘౙౠౡಅ-ಌಎ-ಐಒ-ನಪ-ಳವ-ಹಽೞೠೡೱೲഅ-ഌഎ-ഐഒ-ഺഽൎൠൡൺ-ൿඅ-ඖක-නඳ-රලව-ෆก-ะาำเ-ๆກຂຄງຈຊຍດ-ທນ-ຟມ-ຣລວສຫອ-ະາຳຽເ-ໄໆໜ-ໟༀཀ-ཇཉ-ཬྈ-ྌက-ဪဿၐ-ၕၚ-ၝၡၥၦၮ-ၰၵ-ႁႎႠ-ჅჇჍა-ჺჼ-ቈቊ-ቍቐ-ቖቘቚ-ቝበ-ኈኊ-ኍነ-ኰኲ-ኵኸ-ኾዀዂ-ዅወ-ዖዘ-ጐጒ-ጕጘ-ፚᎀ-ᎏᎠ-Ᏼᐁ-ᙬᙯ-ᙿᚁ-ᚚᚠ-ᛪᜀ-ᜌᜎ-ᜑᜠ-ᜱᝀ-ᝑᝠ-ᝬᝮ-ᝰក-ឳៗៜᠠ-ᡷᢀ-ᢨᢪᢰ-ᣵᤀ-ᤜᥐ-ᥭᥰ-ᥴᦀ-ᦫᧁ-ᧇᨀ-ᨖᨠ-ᩔᪧᬅ-ᬳᭅ-ᭋᮃ-ᮠᮮᮯᮺ-ᯥᰀ-ᰣᱍ-ᱏᱚ-ᱽᳩ-ᳬᳮ-ᳱᳵᳶᴀ-ᶿḀ-ἕἘ-Ἕἠ-ὅὈ-Ὅὐ-ὗὙὛὝὟ-ώᾀ-ᾴᾶ-ᾼιῂ-ῄῆ-ῌῐ-ΐῖ-Ίῠ-Ῥῲ-ῴῶ-ῼⁱⁿₐ-ₜℂℇℊ-ℓℕℙ-ℝℤΩℨK-ℭℯ-ℹℼ-ℿⅅ-ⅉⅎↃↄⰀ-Ⱞⰰ-ⱞⱠ-ⳤⳫ-ⳮⳲⳳⴀ-ⴥⴧⴭⴰ-ⵧⵯⶀ-ⶖⶠ-ⶦⶨ-ⶮⶰ-ⶶⶸ-ⶾⷀ-ⷆⷈ-ⷎⷐ-ⷖⷘ-ⷞⸯ々〆〱-〵〻〼ぁ-ゖゝ-ゟァ-ヺー-ヿㄅ-ㄭㄱ-ㆎㆠ-ㆺㇰ-ㇿ㐀-䶵一-鿌ꀀ-ꒌꓐ-ꓽꔀ-ꘌꘐ-ꘟꘪꘫꙀ-ꙮꙿ-ꚗꚠ-ꛥꜗ-ꜟꜢ-ꞈꞋ-ꞎꞐ-ꞓꞠ-Ɦꟸ-ꠁꠃ-ꠅꠇ-ꠊꠌ-ꠢꡀ-ꡳꢂ-ꢳꣲ-ꣷꣻꤊ-ꤥꤰ-ꥆꥠ-ꥼꦄ-ꦲꧏꨀ-ꨨꩀ-ꩂꩄ-ꩋꩠ-ꩶꩺꪀ-ꪯꪱꪵꪶꪹ-ꪽꫀꫂꫛ-ꫝꫠ-ꫪꫲ-ꫴꬁ-ꬆꬉ-ꬎꬑ-ꬖꬠ-ꬦꬨ-ꬮꯀ-ꯢ가-힣ힰ-ퟆퟋ-ퟻ豈-舘並-龎ﬀ-ﬆﬓ-ﬗיִײַ-ﬨשׁ-זּטּ-לּמּנּסּףּפּצּ-ﮱﯓ-ﴽﵐ-ﶏﶒ-ﷇﷰ-ﷻﹰ-ﹴﹶ-ﻼＡ-Ｚａ-ｚｦ-ﾾￂ-ￇￊ-ￏￒ-ￗￚ-ￜ]/;unicodeRegExp.mark=/[\u0300-\u036F\u0483-\u0489\u0591-\u05BD\u05BF\u05C1\u05C2\u05C4\u05C5\u05C7\u0610-\u061A\u064B-\u065F\u0670\u06D6-\u06DC\u06DF-\u06E4\u06E7\u06E8\u06EA-\u06ED\u0711\u0730-\u074A\u07A6-\u07B0\u07EB-\u07F3\u0816-\u0819\u081B-\u0823\u0825-\u0827\u0829-\u082D\u0859-\u085B\u08E4-\u08FE\u0900-\u0903\u093A-\u093C\u093E-\u094F\u0951-\u0957\u0962\u0963\u0981-\u0983\u09BC\u09BE-\u09C4\u09C7\u09C8\u09CB-\u09CD\u09D7\u09E2\u09E3\u0A01-\u0A03\u0A3C\u0A3E-\u0A42\u0A47\u0A48\u0A4B-\u0A4D\u0A51\u0A70\u0A71\u0A75\u0A81-\u0A83\u0ABC\u0ABE-\u0AC5\u0AC7-\u0AC9\u0ACB-\u0ACD\u0AE2\u0AE3\u0B01-\u0B03\u0B3C\u0B3E-\u0B44\u0B47\u0B48\u0B4B-\u0B4D\u0B56\u0B57\u0B62\u0B63\u0B82\u0BBE-\u0BC2\u0BC6-\u0BC8\u0BCA-\u0BCD\u0BD7\u0C01-\u0C03\u0C3E-\u0C44\u0C46-\u0C48\u0C4A-\u0C4D\u0C55\u0C56\u0C62\u0C63\u0C82\u0C83\u0CBC\u0CBE-\u0CC4\u0CC6-\u0CC8\u0CCA-\u0CCD\u0CD5\u0CD6\u0CE2\u0CE3\u0D02\u0D03\u0D3E-\u0D44\u0D46-\u0D48\u0D4A-\u0D4D\u0D57\u0D62\u0D63\u0D82\u0D83\u0DCA\u0DCF-\u0DD4\u0DD6\u0DD8-\u0DDF\u0DF2\u0DF3\u0E31\u0E34-\u0E3A\u0E47-\u0E4E\u0EB1\u0EB4-\u0EB9\u0EBB\u0EBC\u0EC8-\u0ECD\u0F18\u0F19\u0F35\u0F37\u0F39\u0F3E\u0F3F\u0F71-\u0F84\u0F86\u0F87\u0F8D-\u0F97\u0F99-\u0FBC\u0FC6\u102B-\u103E\u1056-\u1059\u105E-\u1060\u1062-\u1064\u1067-\u106D\u1071-\u1074\u1082-\u108D\u108F\u109A-\u109D\u135D-\u135F\u1712-\u1714\u1732-\u1734\u1752\u1753\u1772\u1773\u17B4-\u17D3\u17DD\u180B-\u180D\u18A9\u1920-\u192B\u1930-\u193B\u19B0-\u19C0\u19C8\u19C9\u1A17-\u1A1B\u1A55-\u1A5E\u1A60-\u1A7C\u1A7F\u1B00-\u1B04\u1B34-\u1B44\u1B6B-\u1B73\u1B80-\u1B82\u1BA1-\u1BAD\u1BE6-\u1BF3\u1C24-\u1C37\u1CD0-\u1CD2\u1CD4-\u1CE8\u1CED\u1CF2-\u1CF4\u1DC0-\u1DE6\u1DFC-\u1DFF\u20D0-\u20F0\u2CEF-\u2CF1\u2D7F\u2DE0-\u2DFF\u302A-\u302F\u3099\u309A\uA66F-\uA672\uA674-\uA67D\uA69F\uA6F0\uA6F1\uA802\uA806\uA80B\uA823-\uA827\uA880\uA881\uA8B4-\uA8C4\uA8E0-\uA8F1\uA926-\uA92D\uA947-\uA953\uA980-\uA983\uA9B3-\uA9C0\uAA29-\uAA36\uAA43\uAA4C\uAA4D\uAA7B\uAAB0\uAAB2-\uAAB4\uAAB7\uAAB8\uAABE\uAABF\uAAC1\uAAEB-\uAAEF\uAAF5\uAAF6\uABE3-\uABEA\uABEC\uABED\uFB1E\uFE00-\uFE0F\uFE20-\uFE26]/;unicodeRegExp.number=/[0-9²³¹¼-¾٠-٩۰-۹߀-߉०-९০-৯৴-৹੦-੯૦-૯୦-୯୲-୷௦-௲౦-౯౸-౾೦-೯൦-൵๐-๙໐-໙༠-༳၀-၉႐-႙፩-፼ᛮ-ᛰ០-៩៰-៹᠐-᠙᥆-᥏᧐-᧚᪀-᪉᪐-᪙᭐-᭙᮰-᮹᱀-᱉᱐-᱙⁰⁴-⁹₀-₉⅐-ↂↅ-↉①-⒛⓪-⓿❶-➓⳽〇〡-〩〸-〺㆒-㆕㈠-㈩㉈-㉏㉑-㉟㊀-㊉㊱-㊿꘠-꘩ꛦ-ꛯ꠰-꠵꣐-꣙꤀-꤉꧐-꧙꩐-꩙꯰-꯹０-９]/;unicodeRegExp.punctuation=/[\u0021-\u0023\u0025-\u002A\u002C-\u002F\u003A\u003B\u003F\u0040\u005B-\u005D\u005F\u007B\u007D\u00A1\u00A7\u00AB\u00B6\u00B7\u00BB\u00BF\u037E\u0387\u055A-\u055F\u0589\u058A\u05BE\u05C0\u05C3\u05C6\u05F3\u05F4\u0609\u060A\u060C\u060D\u061B\u061E\u061F\u066A-\u066D\u06D4\u0700-\u070D\u07F7-\u07F9\u0830-\u083E\u085E\u0964\u0965\u0970\u0AF0\u0DF4\u0E4F\u0E5A\u0E5B\u0F04-\u0F12\u0F14\u0F3A-\u0F3D\u0F85\u0FD0-\u0FD4\u0FD9\u0FDA\u104A-\u104F\u10FB\u1360-\u1368\u1400\u166D\u166E\u169B\u169C\u16EB-\u16ED\u1735\u1736\u17D4-\u17D6\u17D8-\u17DA\u1800-\u180A\u1944\u1945\u1A1E\u1A1F\u1AA0-\u1AA6\u1AA8-\u1AAD\u1B5A-\u1B60\u1BFC-\u1BFF\u1C3B-\u1C3F\u1C7E\u1C7F\u1CC0-\u1CC7\u1CD3\u2010-\u2027\u2030-\u2043\u2045-\u2051\u2053-\u205E\u207D\u207E\u208D\u208E\u2329\u232A\u2768-\u2775\u27C5\u27C6\u27E6-\u27EF\u2983-\u2998\u29D8-\u29DB\u29FC\u29FD\u2CF9-\u2CFC\u2CFE\u2CFF\u2D70\u2E00-\u2E2E\u2E30-\u2E3B\u3001-\u3003\u3008-\u3011\u3014-\u301F\u3030\u303D\u30A0\u30FB\uA4FE\uA4FF\uA60D-\uA60F\uA673\uA67E\uA6F2-\uA6F7\uA874-\uA877\uA8CE\uA8CF\uA8F8-\uA8FA\uA92E\uA92F\uA95F\uA9C1-\uA9CD\uA9DE\uA9DF\uAA5C-\uAA5F\uAADE\uAADF\uAAF0\uAAF1\uABEB\uFD3E\uFD3F\uFE10-\uFE19\uFE30-\uFE52\uFE54-\uFE61\uFE63\uFE68\uFE6A\uFE6B\uFF01-\uFF03\uFF05-\uFF0A\uFF0C-\uFF0F\uFF1A\uFF1B\uFF1F\uFF20\uFF3B-\uFF3D\uFF3F\uFF5B\uFF5D\uFF5F-\uFF65]/;unicodeRegExp.symbol=/[\u0024+<->\u005E`\u007C~¢-¦¨©¬®-±´¸×÷˂-˅˒-˟˥-˫˭˯-˿͵΄΅϶҂֏؆-؈؋؎؏۞۩۽۾߶৲৳৺৻૱୰௳-௺౿൹฿༁-༃༓༕-༗༚-༟༴༶༸྾-࿅࿇-࿌࿎࿏࿕-࿘႞႟᎐-᎙៛᥀᧞-᧿᭡-᭪᭴-᭼᾽᾿-῁῍-῏῝-῟῭-`´῾⁄⁒⁺-⁼₊-₌₠-₹℀℁℃-℆℈℉℔№-℘℞-℣℥℧℩℮℺℻⅀-⅄⅊-⅍⅏←-⌨⌫-⏳␀-␦⑀-⑊⒜-ⓩ─-⛿✁-❧➔-⟄⟇-⟥⟰-⦂⦙-⧗⧜-⧻⧾-⭌⭐-⭙⳥-⳪⺀-⺙⺛-⻳⼀-⿕⿰-⿻〄〒〓〠〶〷〾〿゛゜㆐㆑㆖-㆟㇀-㇣㈀-㈞㈪-㉇㉐㉠-㉿㊊-㊰㋀-㋾㌀-㏿䷀-䷿꒐-꓆꜀-꜖꜠꜡꞉꞊꠨-꠫꠶-꠹꩷-꩹﬩﮲-﯁﷼﷽﹢﹤-﹦﹩＄＋＜-＞＾｀｜～￠-￦￨-￮￼�]/;unicodeRegExp.separator=/[\u0020\u00A0\u1680\u180E\u2000-\u200A\u2028\u2029\u202F\u205F\u3000]/;unicodeRegExp.other=/[\u0000-\u001F\u007F-\u009F\u00AD\u0378\u0379\u037F-\u0383\u038B\u038D\u03A2\u0528-\u0530\u0557\u0558\u0560\u0588\u058B-\u058E\u0590\u05C8-\u05CF\u05EB-\u05EF\u05F5-\u0605\u061C\u061D\u06DD\u070E\u070F\u074B\u074C\u07B2-\u07BF\u07FB-\u07FF\u082E\u082F\u083F\u085C\u085D\u085F-\u089F\u08A1\u08AD-\u08E3\u08FF\u0978\u0980\u0984\u098D\u098E\u0991\u0992\u09A9\u09B1\u09B3-\u09B5\u09BA\u09BB\u09C5\u09C6\u09C9\u09CA\u09CF-\u09D6\u09D8-\u09DB\u09DE\u09E4\u09E5\u09FC-\u0A00\u0A04\u0A0B-\u0A0E\u0A11\u0A12\u0A29\u0A31\u0A34\u0A37\u0A3A\u0A3B\u0A3D\u0A43-\u0A46\u0A49\u0A4A\u0A4E-\u0A50\u0A52-\u0A58\u0A5D\u0A5F-\u0A65\u0A76-\u0A80\u0A84\u0A8E\u0A92\u0AA9\u0AB1\u0AB4\u0ABA\u0ABB\u0AC6\u0ACA\u0ACE\u0ACF\u0AD1-\u0ADF\u0AE4\u0AE5\u0AF2-\u0B00\u0B04\u0B0D\u0B0E\u0B11\u0B12\u0B29\u0B31\u0B34\u0B3A\u0B3B\u0B45\u0B46\u0B49\u0B4A\u0B4E-\u0B55\u0B58-\u0B5B\u0B5E\u0B64\u0B65\u0B78-\u0B81\u0B84\u0B8B-\u0B8D\u0B91\u0B96-\u0B98\u0B9B\u0B9D\u0BA0-\u0BA2\u0BA5-\u0BA7\u0BAB-\u0BAD\u0BBA-\u0BBD\u0BC3-\u0BC5\u0BC9\u0BCE\u0BCF\u0BD1-\u0BD6\u0BD8-\u0BE5\u0BFB-\u0C00\u0C04\u0C0D\u0C11\u0C29\u0C34\u0C3A-\u0C3C\u0C45\u0C49\u0C4E-\u0C54\u0C57\u0C5A-\u0C5F\u0C64\u0C65\u0C70-\u0C77\u0C80\u0C81\u0C84\u0C8D\u0C91\u0CA9\u0CB4\u0CBA\u0CBB\u0CC5\u0CC9\u0CCE-\u0CD4\u0CD7-\u0CDD\u0CDF\u0CE4\u0CE5\u0CF0\u0CF3-\u0D01\u0D04\u0D0D\u0D11\u0D3B\u0D3C\u0D45\u0D49\u0D4F-\u0D56\u0D58-\u0D5F\u0D64\u0D65\u0D76-\u0D78\u0D80\u0D81\u0D84\u0D97-\u0D99\u0DB2\u0DBC\u0DBE\u0DBF\u0DC7-\u0DC9\u0DCB-\u0DCE\u0DD5\u0DD7\u0DE0-\u0DF1\u0DF5-\u0E00\u0E3B-\u0E3E\u0E5C-\u0E80\u0E83\u0E85\u0E86\u0E89\u0E8B\u0E8C\u0E8E-\u0E93\u0E98\u0EA0\u0EA4\u0EA6\u0EA8\u0EA9\u0EAC\u0EBA\u0EBE\u0EBF\u0EC5\u0EC7\u0ECE\u0ECF\u0EDA\u0EDB\u0EE0-\u0EFF\u0F48\u0F6D-\u0F70\u0F98\u0FBD\u0FCD\u0FDB-\u0FFF\u10C6\u10C8-\u10CC\u10CE\u10CF\u1249\u124E\u124F\u1257\u1259\u125E\u125F\u1289\u128E\u128F\u12B1\u12B6\u12B7\u12BF\u12C1\u12C6\u12C7\u12D7\u1311\u1316\u1317\u135B\u135C\u137D-\u137F\u139A-\u139F\u13F5-\u13FF\u169D-\u169F\u16F1-\u16FF\u170D\u1715-\u171F\u1737-\u173F\u1754-\u175F\u176D\u1771\u1774-\u177F\u17DE\u17DF\u17EA-\u17EF\u17FA-\u17FF\u180F\u181A-\u181F\u1878-\u187F\u18AB-\u18AF\u18F6-\u18FF\u191D-\u191F\u192C-\u192F\u193C-\u193F\u1941-\u1943\u196E\u196F\u1975-\u197F\u19AC-\u19AF\u19CA-\u19CF\u19DB-\u19DD\u1A1C\u1A1D\u1A5F\u1A7D\u1A7E\u1A8A-\u1A8F\u1A9A-\u1A9F\u1AAE-\u1AFF\u1B4C-\u1B4F\u1B7D-\u1B7F\u1BF4-\u1BFB\u1C38-\u1C3A\u1C4A-\u1C4C\u1C80-\u1CBF\u1CC8-\u1CCF\u1CF7-\u1CFF\u1DE7-\u1DFB\u1F16\u1F17\u1F1E\u1F1F\u1F46\u1F47\u1F4E\u1F4F\u1F58\u1F5A\u1F5C\u1F5E\u1F7E\u1F7F\u1FB5\u1FC5\u1FD4\u1FD5\u1FDC\u1FF0\u1FF1\u1FF5\u1FFF\u200B-\u200F\u202A-\u202E\u2060-\u206F\u2072\u2073\u208F\u209D-\u209F\u20BA-\u20CF\u20F1-\u20FF\u218A-\u218F\u23F4-\u23FF\u2427-\u243F\u244B-\u245F\u2700\u2B4D-\u2B4F\u2B5A-\u2BFF\u2C2F\u2C5F\u2CF4-\u2CF8\u2D26\u2D28-\u2D2C\u2D2E\u2D2F\u2D68-\u2D6E\u2D71-\u2D7E\u2D97-\u2D9F\u2DA7\u2DAF\u2DB7\u2DBF\u2DC7\u2DCF\u2DD7\u2DDF\u2E3C-\u2E7F\u2E9A\u2EF4-\u2EFF\u2FD6-\u2FEF\u2FFC-\u2FFF\u3040\u3097\u3098\u3100-\u3104\u312E-\u3130\u318F\u31BB-\u31BF\u31E4-\u31EF\u321F\u32FF\u4DB6-\u4DBF\u9FCD-\u9FFF\uA48D-\uA48F\uA4C7-\uA4CF\uA62C-\uA63F\uA698-\uA69E\uA6F8-\uA6FF\uA78F\uA794-\uA79F\uA7AB-\uA7F7\uA82C-\uA82F\uA83A-\uA83F\uA878-\uA87F\uA8C5-\uA8CD\uA8DA-\uA8DF\uA8FC-\uA8FF\uA954-\uA95E\uA97D-\uA97F\uA9CE\uA9DA-\uA9DD\uA9E0-\uA9FF\uAA37-\uAA3F\uAA4E\uAA4F\uAA5A\uAA5B\uAA7C-\uAA7F\uAAC3-\uAADA\uAAF7-\uAB00\uAB07\uAB08\uAB0F\uAB10\uAB17-\uAB1F\uAB27\uAB2F-\uABBF\uABEE\uABEF\uABFA-\uABFF\uD7A4-\uD7AF\uD7C7-\uD7CA\uD7FC-\uF8FF\uFA6E\uFA6F\uFADA-\uFAFF\uFB07-\uFB12\uFB18-\uFB1C\uFB37\uFB3D\uFB3F\uFB42\uFB45\uFBC2-\uFBD2\uFD40-\uFD4F\uFD90\uFD91\uFDC8-\uFDEF\uFDFE\uFDFF\uFE1A-\uFE1F\uFE27-\uFE2F\uFE53\uFE67\uFE6C-\uFE6F\uFE75\uFEFD-\uFF00\uFFBF-\uFFC1\uFFC8\uFFC9\uFFD0\uFFD1\uFFD8\uFFD9\uFFDD-\uFFDF\uFFE7\uFFEF-\uFFFB\uFFFE\uFFFF]/;unicodeRegExp.spliceCharacterClassRegExps=function(){var args=Array.prototype.slice.call(arguments);return new RegExp('['+args.map(function(regExp){return regExp.source.replace(/^\[|\]$/g,'')}).join('')+']')};unicodeRegExp.visible=unicodeRegExp.spliceCharacterClassRegExps(unicodeRegExp.letter,unicodeRegExp.mark,unicodeRegExp.number,unicodeRegExp.punctuation,unicodeRegExp.symbol);unicodeRegExp.printable=unicodeRegExp.spliceCharacterClassRegExps(unicodeRegExp.visible,unicodeRegExp.separator);function parseCharCode(u4,x2,literal){if(u4||x2){return parseInt(u4||x2,16)}else{return literal.charCodeAt(0)}}function charCodeToRegExpToken(charCode){if(charCode>=32&&charCode<127){return String.fromCharCode(charCode)}else{var hexStr=charCode.toString(16);return'\\u'+'0000'.slice(hexStr.length)+hexStr}}var characterClassToken=/(?:\\u([0-9a-f]{4})|\\x([0-9a-f]{2})|([^\-]))(?:-(?:\\u([0-9a-f]{4})|\\x([0-9a-f]{2})|([^\-])))?/gi;unicodeRegExp.removeCharacterFromCharacterClassRegExp=function(regExp,ch){var charCode=ch.charCodeAt(0);return new RegExp('['+regExp.source.replace(/^\[|\]$/g,'').replace(characterClassToken,function($0,fromU4,fromX2,fromLiteral,toU4,toX2,toLiteral){var fromCharCode=parseCharCode(fromU4,fromX2,fromLiteral);if(toU4||toX2||toLiteral){var toCharCode=parseCharCode(toU4,toX2,toLiteral);if(charCode===fromCharCode){if(charCode+1<toCharCode){return charCodeToRegExpToken(charCode+1)+'-'+charCodeToRegExpToken(toCharCode)}else{return charCodeToRegExpToken(toCharCode)}}else if(charCode===toCharCode){if(fromCharCode<charCode-1){return charCodeToRegExpToken(fromCharCode)+'-'+charCodeToRegExpToken(charCode-1)}else{return charCodeToRegExpToken(fromCharCode)}}else if(charCode>fromCharCode&&charCode<toCharCode){return charCodeToRegExpToken(fromCharCode)+(charCode>fromCharCode+1?'-'+charCodeToRegExpToken(charCode-1):'')+(charCode+1<toCharCode?charCodeToRegExpToken(charCode+1)+'-':'')+charCodeToRegExpToken(toCharCode)}else{return $0}}else{if(charCode===fromCharCode){return''}else{return charCodeToRegExpToken(fromCharCode)}}})+']')};return unicodeRegExp}))}());(function(){var define=System.amdDefine;(function(root,factory){if(typeof exports==='object'){module.exports=factory(require('one-validation'),require('punycode'),require('unicoderegexp'))}else if(typeof define==='function'&&define.amd){define('3rdparty/purify.js',['3rdparty/onevalidation/validation.js','3rdparty/punycode.js','3rdparty/unicodeRegExp.js'],factory)}else{root.purify=factory(root.one.validation,root.punycode,root.unicodeRegExp)}}(this,function(oneValidation,punycode,unicodeRegExp){var purify={};purify.boolean=function(rawValue,defaultValue){if(typeof rawValue==='boolean'){return rawValue}else if(typeof rawValue==='string'){var isTrue=/^(?:1|on|true|yes)$/i.test(rawValue),isFalse=/^(?:0|off|false|no)$/i.test(rawValue);return isTrue?true:isFalse?false:defaultValue}return defaultValue};purify.email=purify.emailAddress=function(rawValue,defaultValue){var fragments,encodedEmail,encodedDomain;try{if(typeof rawValue==='string'&&oneValidation.emailIdn.test(rawValue)){fragments=rawValue.split('@');encodedDomain=fragments.length===2&&punycode.toASCII(fragments[1]).toLowerCase();var decodedDomain=punycode.toUnicode(encodedDomain);if(!/\.[^\.]{2,}$/.test(decodedDomain)){encodedDomain=undefined}}}catch(e){encodedDomain=undefined}finally{encodedEmail=encodedDomain&&fragments[0]+'@'+encodedDomain;if(typeof encodedEmail==='string'&&oneValidation.email.test(encodedEmail)){return encodedEmail}else{return defaultValue}}};purify.emailIdn=purify.emailAddressIdn=function(rawValue,defaultValue){var fragments,decodedDomain,decodedEmail;try{if(typeof rawValue==='string'&&oneValidation.emailIdn.test(rawValue)){fragments=rawValue.split('@');decodedDomain=fragments.length===2&&punycode.toUnicode(fragments[1]).toLowerCase();if(!/\.[^\.]{2,}$/.test(decodedDomain)){decodedDomain=undefined}}}catch(e){decodedDomain=undefined}finally{decodedEmail=decodedDomain&&fragments[0]+'@'+decodedDomain;if(typeof decodedEmail==='string'&&oneValidation.emailIdn.test(decodedEmail)){return decodedEmail}else{return defaultValue}}};purify.domain=purify.domainName=function(rawValue,defaultValue){var encodedDomain;try{if(typeof rawValue==='string'&&oneValidation.domainIdn.test(rawValue)){encodedDomain=punycode.toASCII(rawValue.toLowerCase());var decodedDomain=punycode.toUnicode(encodedDomain);if(!/\.[^\.]{2,}$/.test(decodedDomain)){encodedDomain=undefined}}}catch(e){encodedDomain=undefined}finally{if(typeof encodedDomain==='string'&&oneValidation.domain.test(encodedDomain)){return encodedDomain}else{return defaultValue}}};purify.domainIdn=purify.domainNameIdn=function(rawValue,defaultValue){var decodedDomain;try{if(typeof rawValue==='string'&&oneValidation.domainIdn.test(rawValue)){decodedDomain=punycode.toUnicode(rawValue.toLowerCase());if(!/\.[^\.]{2,}$/.test(decodedDomain)){decodedDomain=undefined}}}catch(e){decodedDomain=undefined}finally{if(typeof decodedDomain==='string'&&oneValidation.domainIdn.test(decodedDomain)){return decodedDomain}else{return defaultValue}}};purify.url=function(rawValue,defaultValue){if(typeof rawValue==='string'&&oneValidation.httpUrl.test(rawValue)){return rawValue}return defaultValue};var urlWithLocalhostRegExp=new RegExp('^(?:'+oneValidation.createHttpishUrlRegExp({scheme:/https?/,localhost:true}).source+')$');purify.urlWithLocalhost=function(rawValue,defaultValue){if(typeof rawValue==='string'&&urlWithLocalhostRegExp.test(rawValue)){return rawValue}return defaultValue};purify.integer=function(rawValue,defaultValue){var integer;if(typeof rawValue==='string'){integer=parseInt(rawValue,10)}else if(typeof rawValue==='number'){integer=Math.floor(rawValue)}if(typeof integer==='number'&&isFinite(integer)&&!isNaN(integer)){return integer}else{return defaultValue}};purify.integerInRange=function(rawValue,lower,upper,defaultValue){var integer=purify.integer(rawValue);if(typeof integer==='number'&&!isNaN(integer)&&isFinite(integer)&&(typeof lower==='undefined'||integer>=lower)&&(typeof upper==='undefined'||integer<=upper)){return integer}return defaultValue};purify.positiveInteger=function(rawValue,defaultValue){var integer=purify.integer(rawValue);if(typeof integer!=='undefined'&&!isNaN(integer)&&isFinite(integer)&&integer>=1){return integer}return defaultValue};purify.positiveIntegerOrZero=function(rawValue,defaultValue){var integer=purify.integer(rawValue);if(typeof integer!=='undefined'&&!isNaN(integer)&&isFinite(integer)&&integer>=0){return integer}return defaultValue};purify.float=function(rawValue,defaultValue){var number;if(typeof rawValue==='string'){if(/^[\-+]?[0-9]*\.?[0-9]+$/.test(rawValue)){number=parseFloat(rawValue)}}else if(typeof rawValue==='number'){number=rawValue}if(typeof number!=='undefined'&&!isNaN(number)&&isFinite(number)){return number}return defaultValue};purify.positiveFloat=function(rawValue,defaultValue){var number;if(typeof rawValue==='string'){if(/^\+?[0-9]*\.?[0-9]+$/.test(rawValue)){number=parseFloat(rawValue)}}else if(typeof rawValue==='number'){number=rawValue}if(typeof number!=='undefined'&&!isNaN(number)&&isFinite(number)&&number>0){return number}return defaultValue};purify.positiveFloatOrZero=function(rawValue,defaultValue){var number;if(typeof rawValue==='string'){if(/^\+?[0-9]*\.?[0-9]+$/.test(rawValue)){number=parseFloat(rawValue)}}else if(typeof rawValue==='number'){number=rawValue}if(typeof number!=='undefined'&&!isNaN(number)&&isFinite(number)&&number>=0){return number}return defaultValue};var nonEmptyVisibleUnicodeRegExp=new RegExp('^'+unicodeRegExp.visible.source+'+$');purify.nonEmptyVisibleUnicode=function(rawValue,defaultValue){if(typeof rawValue==='string'&&nonEmptyVisibleUnicodeRegExp.test(rawValue)){return rawValue}return defaultValue};var visibleUnicodeRegExp=new RegExp('^'+unicodeRegExp.visible.source+'*$');purify.visibleUnicode=function(rawValue,defaultValue){if(typeof rawValue==='string'&&visibleUnicodeRegExp.test(rawValue)){return rawValue}return defaultValue};var nonEmptyPrintableUnicodeRegExp=new RegExp('^'+unicodeRegExp.printable.source+'+$');purify.nonEmptyPrintableUnicode=function(rawValue,defaultValue){if(typeof rawValue==='string'&&nonEmptyPrintableUnicodeRegExp.test(rawValue)){return rawValue}return defaultValue};var printableUnicodeRegExp=new RegExp('^'+unicodeRegExp.printable.source+'*$');purify.printableUnicode=function(rawValue,defaultValue){if(typeof rawValue==='string'&&printableUnicodeRegExp.test(rawValue)){return rawValue}return defaultValue};purify.nonEmptyVisibleAscii=function(rawValue,defaultValue){if(typeof rawValue==='string'&&/^[\x21-\x7e]+$/.test(rawValue)){return rawValue}return defaultValue};purify.visibleAscii=function(rawValue,defaultValue){if(typeof rawValue==='string'&&/^[\x21-\x7e]*$/.test(rawValue)){return rawValue}return defaultValue};purify.nonEmptyPrintableAscii=function(rawValue,defaultValue){if(typeof rawValue==='string'&&/^[\x20-\x7e]+$/.test(rawValue)){return rawValue}return defaultValue};purify.printableAscii=function(rawValue,defaultValue){if(typeof rawValue==='string'&&/^[\x20-\x7e]*$/.test(rawValue)){return rawValue}return defaultValue};purify.alphaNumeric=function(rawValue,defaultValue){if(typeof rawValue==='string'&&/^[a-z0-9]*$/i.test(rawValue)){return rawValue}else if(typeof rawValue==='number'&&isFinite(rawValue)&&!isNaN(rawValue)&&rawValue===Math.floor(rawValue)){return String(rawValue)}return defaultValue};purify.nonEmptyAlphaNumeric=function(rawValue,defaultValue){if(typeof rawValue==='string'&&/^[a-z0-9]+$/i.test(rawValue)){return rawValue}else if(typeof rawValue==='number'&&isFinite(rawValue)&&!isNaN(rawValue)&&rawValue===Math.floor(rawValue)){return String(rawValue)}return defaultValue};purify.alphaNumericWithDot=function(rawValue,defaultValue){if(typeof rawValue==='string'&&/^[a-z0-9\.]*$/i.test(rawValue)){return rawValue}else if(typeof rawValue==='number'&&isFinite(rawValue)&&!isNaN(rawValue)){return String(rawValue)}return defaultValue};purify.nonEmptyAlphaNumericWithDot=function(rawValue,defaultValue){if(typeof rawValue==='string'&&/^[a-z0-9\.]+$/i.test(rawValue)){return rawValue}else if(typeof rawValue==='number'&&isFinite(rawValue)&&!isNaN(rawValue)){return String(rawValue)}return defaultValue};purify.uuid=function(rawValue,defaultValue){if(typeof rawValue==='string'&&oneValidation.uuid.test(rawValue)){return rawValue}return defaultValue};purify.upperCaseUuid=function(rawValue,defaultValue){if(typeof rawValue==='string'&&oneValidation.upperCaseUuid.test(rawValue)){return rawValue}return defaultValue};purify.lowerCaseUuid=function(rawValue,defaultValue){if(typeof rawValue==='string'&&oneValidation.lowerCaseUuid.test(rawValue)){return rawValue}return defaultValue};purify.json=function(rawValue,defaultValue){if(typeof rawValue==='string'){try{return JSON.parse(rawValue)}catch(e){}}return defaultValue};return purify}))}());(function(){var define=System.amdDefine;define('webmail/model/Recipient.js',['3rdparty/onevalidation/validation.js','3rdparty/purify.js'],function(validation,purify){function Recipient(data){if(typeof data==='string'){return Recipient.from(data)}this.email=purify.email(data.email);this.displayEmail=purify.emailIdn(data.email)||'';if(data.email&&!this.email&&!data.displayName){data.displayName=data.email}this.displayName=data.displayName||data.displayname;this.photoUrl=data.photo;this.id=data.id}Recipient.prototype.toArray=function(){var data={email:this.email,displayEmail:this.displayEmail,displayName:this.displayName,photoUrl:this.photoUrl,id:this.id};return data};Recipient.prototype.toString=function(){return this.displayName&&this.displayName!==this.email?this.displayName+(this.email?' <'+this.email+'>':''):this.email||''};Recipient.prototype.getEmail=function(){return this.email};Recipient.prototype.toEditDisplayString=function(){var displayName=this.displayName;if(!displayName||displayName===this.displayEmail){return this.displayEmail}if(displayName.match(/^".*"$/)){displayName='"'+displayName+'"'}return displayName+(this.displayEmail?' <'+this.displayEmail+'>':'')};Recipient.prototype.toDisplayString=function(){return this.displayName||this.displayEmail};Recipient.prototype.hasEmail=function(email){return this.email&&this.email.toLowerCase()===email.toLowerCase()};Recipient.prototype.sortKey=function(){return this.toString().toLowerCase()};Recipient.toJS=function(recipient){var result={email:purify.email(recipient.email)};if(recipient.displayName){result.displayName=recipient.displayName}return result};Recipient.prototype.isInvalidEmail=function(){return!validation.email.test(this.email)};var displayNameAndEmailRegExp=new RegExp('^(.+)(?:<('+validation.fragments.emailIdn.source+')>|\\s+('+validation.fragments.emailIdn.source+'))$','i');Recipient.from=function(text){text=(text||'').trim();var matches=displayNameAndEmailRegExp.exec(text),displayName,email,recipientProperties={};if(matches){displayName=matches[1].trim();if(displayName&&displayName.match(/^".*"$/)){displayName=displayName.replace(/^"/,'').replace(/"$/,'')}email=matches[2]||matches[3];recipientProperties.displayName=displayName;recipientProperties.email=purify.email(email)}else{email=purify.email(text);if(email){recipientProperties.email=email}else{recipientProperties.displayName=text}}return new Recipient(recipientProperties)};return Recipient})}());(function(){var define=System.amdDefine;define('webmail/model/mailparts/TextPart.js',['node_modules/jquery/dist/jquery.js','node_modules/knockout/build/output/knockout-latest.debug.js','webmail/model/MailPart.js','3rdparty/mario.js'],function($,ko,MailPart,mario){function TextPart(part,mail){MailPart.call(this,part,mail);this.renderLimit=CONFIG.webmail.htmlPartSizeRenderLimit;this.template='mailPartText';this.htmlContent=ko.observable('');this.isLoaded=ko.observable(false);this.hasExternalImages=ko.observable(false);this.domReference=null}TextPart.prototype=Object.create(MailPart.prototype);TextPart.prototype.constructor=TextPart;TextPart.prototype.mailPartTooBig=function(){return this.contentType==='text/html'&&this.size()>this.renderLimit};TextPart.prototype.url=function(){return this.mail.getMailUrl()+'/'+this.partId+'?preserveoriginal=true'};TextPart.prototype.urlWithExternalImagesAllowed=function(){return this.mail.getMailUrl()+'/'+this.partId+'?preserveoriginal=true&allowexternalimages=true'};TextPart.prototype.afterLoad=function(html){this.htmlContent(this.cleanupHTML(html));this.handleExternalImages();this.isLoaded(true)};TextPart.prototype.cleanupHTML=function(htmlString){if(mario.firefox){htmlString=htmlString.replace(/<div class="oneComWebmail\-html oneComWebmail\-mail"><div class="oneComWebmail\-body">/g,'')}var elements=$.parseHTML(htmlString)||[];$('div.oneComWebmail-html > div.oneComWebmail-body',elements).each(function(){var parent=this.parentNode;var $parent=$(parent);if(this.attributes.length===1&&parent.attributes.length===1&&$parent.parent().is('div.oneComWebmail-html > div.oneComWebmail-body')){$parent.before(this.childNodes)}});$('div.oneComWebmail-html > div.oneComWebmail-body',elements).each(function(){if(this.childNodes.length<1){$(this).parent().remove()}});$('img',elements).each(function(){if(!$(this).attr('src')&&!$(this).attr('data-src')){$(this).remove()}});return elements.map(function(node){if(node.nodeType===1){return node.outerHTML}else{return node.data.replace(/</g,'&lt;')}}).join('')};TextPart.prototype.setDomReference=function(element){this.domReference=element};TextPart.prototype.getOrCreateElement=function(){return this.domReference?this.domReference:$('<div>').html(this.htmlContent())};TextPart.prototype.handleExternalImages=function(element){element=element||this.getOrCreateElement();var $externalImagesFiltered=$(element).find('span#externalImagesFiltered');if($externalImagesFiltered.length>0){if(this.mail.oneComLoadImg()){this.loadExternalImages(element)}this.hasExternalImages(true)}};TextPart.prototype.loadExternalImages=function(element){element=element||this.getOrCreateElement();$(element).find('table[data-src], tr[data-src], td[data-src], th[data-src], img[data-src]').each(function(){var $this=$(this);$this.attr(this.nodeName.toLowerCase()==='img'?'src':'background',$this.attr('data-src'));$this.removeAttr('data-src')});this.htmlContent($(element).html())};return TextPart})}());(function(){var define=System.amdDefine;define('webmail/model/mailparts/InlineImagePart.js',['node_modules/knockout/build/output/knockout-latest.debug.js','common/util.js','webmail/model/MailPart.js'],function(ko,util,MailPart){function InlineImagePart(part,mail){MailPart.call(this,part,mail);this.template='mailPartInlineImage'}InlineImagePart.prototype=Object.create(MailPart.prototype);InlineImagePart.prototype.constructor=InlineImagePart;InlineImagePart.prototype.url=function(){return this.mail.getMailUrl()+'/'+this.partId};InlineImagePart.prototype.urlWithContentId=function(){var contentId=this.contentId?'contentId='+this.contentId:'setContentId='+util.uuid();return this.mail.getMailUrl()+'/'+this.partId+'?'+contentId};return InlineImagePart})}());(function(){var define=System.amdDefine;(function(root,factory){if(typeof exports==='object'){module.exports=factory()}else if(typeof define==='function'&&define.amd){define('3rdparty/mime/types.js',[],factory)}else{factory()}}(this,function(){return{'binary':{},'application':{'atom+xml':{'extensions':['atom'],'className':'sgml','path':'source'},'atomcat+xml':{'extensions':['atomcat'],'className':'sgml','path':'source'},'atomsvc+xml':{'extensions':['atomsvc'],'className':'sgml','path':'source'},'ccxml+xml':{'extensions':['ccxml'],'className':'sgml','path':'source'},'davmount+xml':{'extensions':['davmount'],'className':'sgml','path':'source'},'dssc+xml':{'extensions':['xdssc'],'className':'sgml','path':'source'},'ecmascript':{'extensions':['ecma'],'path':'source'},'emma+xml':{'extensions':['emma'],'className':'sgml','path':'source'},'epub+zip':{'extensions':['epub'],'path':'archive'},'inkml+xml':{'extensions':['ink','inkml'],'className':'sgml','path':'source'},'java-archive':{'extensions':['jar'],'path':'archive'},'javascript':{'extensions':['js'],'className':'sgml','path':'source'},'json':{'extensions':['json'],'className':'sgml','path':'source'},'lost+xml':{'extensions':['lostxml'],'className':'sgml','path':'source'},'mads+xml':{'extensions':['mads'],'className':'sgml','path':'source'},'marcxml+xml':{'extensions':['mrcx'],'className':'sgml','path':'source'},'mathml+xml':{'extensions':['mathml'],'className':'sgml','path':'source'},'mediaservercontrol+xml':{'extensions':['mscml'],'className':'sgml','path':'source'},'metalink4+xml':{'extensions':['meta4'],'className':'sgml','path':'source'},'mets+xml':{'extensions':['mets'],'className':'sgml','path':'source'},'mods+xml':{'extensions':['mods'],'className':'sgml','path':'source'},'msword':{'extensions':['doc','dot'],'className':'x-office-document','path':'document'},'oebps-package+xml':{'extensions':['opf'],'className':'sgml','path':'source'},'patch-ops-error+xml':{'extensions':['xer'],'className':'sgml','path':'source'},'pdf':{'extensions':['pdf'],'className':'pdf'},'pls+xml':{'extensions':['pls'],'className':'sgml','path':'source'},'pskc+xml':{'extensions':['pskcxml'],'className':'sgml','path':'source'},'rdf+xml':{'extensions':['rdf'],'className':'sgml','path':'source'},'reginfo+xml':{'extensions':['rif'],'className':'sgml','path':'source'},'resource-lists+xml':{'extensions':['rl'],'className':'sgml','path':'source'},'resource-lists-diff+xml':{'extensions':['rld'],'className':'sgml','path':'source'},'rls-services+xml':{'extensions':['rs'],'className':'sgml','path':'source'},'rsd+xml':{'extensions':['rsd'],'className':'sgml','path':'source'},'rss+xml':{'extensions':['rss'],'className':'sgml','path':'source'},'rtf':{'extensions':['rtf'],'path':'document'},'sbml+xml':{'extensions':['sbml'],'className':'sgml','path':'source'},'shf+xml':{'extensions':['shf'],'className':'sgml','path':'source'},'smil+xml':{'extensions':['smi','smil'],'className':'sgml','path':'source'},'sparql-results+xml':{'extensions':['srx'],'className':'sgml','path':'source'},'srgs+xml':{'extensions':['grxml'],'className':'sgml','path':'source'},'sru+xml':{'extensions':['sru'],'className':'sgml','path':'source'},'ssml+xml':{'extensions':['ssml'],'className':'sgml','path':'source'},'tei+xml':{'extensions':['tei','teicorpus'],'className':'sgml','path':'source'},'thraud+xml':{'extensions':['tfi'],'className':'sgml','path':'source'},'vnd.adobe.air-application-installer-package+zip':{'extensions':['air'],'path':'archive'},'vnd.adobe.xdp+xml':{'extensions':['xdp'],'className':'sgml','path':'source'},'vnd.android.package-archive':{'extensions':['apk'],'path':'archive'},'vnd.apple.installer+xml':{'extensions':['mpkg'],'className':'sgml','path':'source'},'vnd.chemdraw+xml':{'extensions':['cdxml'],'className':'sgml','path':'source'},'vnd.criticaltools.wbs+xml':{'extensions':['wbs'],'className':'sgml','path':'source'},'vnd.dece.ttml+xml':{'extensions':['uvt','uvvt'],'className':'sgml','path':'source'},'vnd.eszigno3+xml':{'extensions':['es3','et3'],'className':'sgml','path':'source'},'vnd.google-earth.kml+xml':{'extensions':['kml'],'className':'sgml','path':'source'},'vnd.hal+xml':{'extensions':['hal'],'className':'sgml','path':'source'},'vnd.handheld-entertainment+xml':{'extensions':['zmm'],'className':'sgml','path':'source'},'vnd.irepository.package+xml':{'extensions':['irp'],'className':'sgml','path':'source'},'vnd.kde.kword':{'extensions':['kwd','kwt'],'path':'document'},'vnd.las.las+xml':{'extensions':['lasxml'],'className':'sgml','path':'source'},'vnd.llamagraphics.life-balance.exchange+xml':{'extensions':['lbe'],'className':'sgml','path':'source'},'vnd.mozilla.xul+xml':{'extensions':['xul'],'className':'sgml','path':'source'},'vnd.ms-excel':{'extensions':['xls','xlm','xla','xlc','xlt','xlw'],'className':'x-office-spreadsheet','path':'document'},'vnd.ms-powerpoint':{'extensions':['ppt','pps','pot'],'className':'x-office-presentation','path':'document'},'vnd.oasis.opendocument.presentation':{'extensions':['odp'],'className':'x-office-presentation','path':'document'},'vnd.oasis.opendocument.spreadsheet':{'extensions':['ods'],'className':'x-office-spreadsheet','path':'document'},'vnd.oasis.opendocument.text':{'extensions':['odt'],'className':'x-office-document','path':'document'},'vnd.oma.dd2+xml':{'extensions':['dd2'],'className':'sgml','path':'source'},'vnd.openxmlformats-officedocument.presentationml.presentation':{'extensions':['pptx'],'className':'x-office-presentation','path':'document'},'vnd.openxmlformats-officedocument.spreadsheetml.sheet':{'extensions':['xlsx'],'className':'x-office-spreadsheet','path':'document'},'vnd.openxmlformats-officedocument.wordprocessingml.document':{'extensions':['docx'],'className':'x-office-document','path':'document'},'vnd.recordare.musicxml':{'extensions':['mxl'],'className':'sgml','path':'source'},'vnd.recordare.musicxml+xml':{'extensions':['musicxml'],'className':'sgml','path':'source'},'vnd.route66.link66+xml':{'extensions':['link66'],'className':'sgml','path':'source'},'vnd.solent.sdkm+xml':{'extensions':['sdkm','sdkd'],'className':'sgml','path':'source'},'vnd.sun.xml.calc':{'extensions':['sxc'],'className':'sgml','path':'source'},'vnd.sun.xml.calc.template':{'extensions':['stc'],'className':'sgml','path':'source'},'vnd.sun.xml.draw':{'extensions':['sxd'],'className':'sgml','path':'source'},'vnd.sun.xml.draw.template':{'extensions':['std'],'className':'sgml','path':'source'},'vnd.sun.xml.impress':{'extensions':['sxi'],'className':'sgml','path':'source'},'vnd.sun.xml.impress.template':{'extensions':['sti'],'className':'sgml','path':'source'},'vnd.sun.xml.math':{'extensions':['sxm'],'className':'sgml','path':'source'},'vnd.sun.xml.writer':{'extensions':['sxw'],'className':'sgml','path':'source'},'vnd.sun.xml.writer.global':{'extensions':['sxg'],'className':'sgml','path':'source'},'vnd.sun.xml.writer.template':{'extensions':['stw'],'className':'sgml','path':'source'},'vnd.syncml+xml':{'extensions':['xsm'],'className':'sgml','path':'source'},'vnd.syncml.dm+wbxml':{'extensions':['bdm'],'className':'sgml','path':'source'},'vnd.syncml.dm+xml':{'extensions':['xdm'],'className':'sgml','path':'source'},'vnd.tcpdump.pcap':{'extensions':['pcap','cap','dmp'],'path':'archive'},'vnd.uoml+xml':{'extensions':['uoml'],'className':'sgml','path':'source'},'vnd.wap.wbxml':{'extensions':['wbxml'],'className':'sgml','path':'source'},'vnd.wordperfect':{'extensions':['wpd'],'path':'document'},'vnd.yamaha.openscoreformat.osfpvg+xml':{'extensions':['osfpvg'],'className':'sgml','path':'source'},'vnd.zzazz.deck+xml':{'extensions':['zaz'],'className':'sgml','path':'source'},'voicexml+xml':{'extensions':['vxml'],'className':'sgml','path':'source'},'wsdl+xml':{'extensions':['wsdl'],'className':'sgml','path':'source'},'wspolicy+xml':{'extensions':['wspolicy'],'className':'sgml','path':'source'},'x-7z-compressed':{'extensions':['7z'],'path':'archive'},'x-abiword':{'extensions':['abw'],'path':'document'},'x-ace-compressed':{'extensions':['ace'],'path':'archive'},'x-bzip':{'extensions':['bz'],'className':'zip','path':'archive'},'x-bzip2':{'extensions':['boz'],'className':'zip','path':'archive'},'x-csh':{'extensions':['csh'],'className':'x-sh'},'x-debian-package':{'extensions':['deb','udeb'],'path':'archive'},'x-dtbncx+xml':{'extensions':['ncx'],'className':'sgml','path':'source'},'x-dtbook+xml':{'extensions':['dtb'],'className':'sgml','path':'source'},'x-dtbresource+xml':{'extensions':['res'],'className':'sgml','path':'source'},'x-gtar':{'extensions':['gtar'],'path':'archive'},'x-latex':{'extensions':['latex'],'path':'source'},'x-msdownload':{'extensions':['exe','dll','com','bat','msi'],'className':'x-sh'},'x-rar-compressed':{'extensions':['rar'],'className':'rar','path':'archive'},'x-sh':{'extensions':['sh'],'className':'x-sh'},'x-shockwave-flash':{'extensions':['swf','fla'],'className':'x-shockwave-flash'},'x-stuffit':{'extensions':['sit'],'path':'archive'},'x-tar':{'extensions':['tar'],'path':'archive'},'x-tex':{'extensions':['tex'],'path':'source'},'xcap-diff+xml':{'extensions':['xdf'],'className':'sgml','path':'source'},'xenc+xml':{'extensions':['xenc'],'className':'sgml','path':'source'},'xhtml+xml':{'extensions':['xhtml','xht'],'className':'sgml','path':'source'},'xml':{'extensions':['xml','xsl'],'className':'sgml','path':'source'},'xml-dtd':{'extensions':['dtd'],'className':'sgml','path':'source'},'xop+xml':{'extensions':['xop'],'className':'sgml','path':'source'},'xslt+xml':{'extensions':['xslt'],'className':'sgml','path':'source'},'xspf+xml':{'extensions':['xspf'],'className':'sgml','path':'source'},'xv+xml':{'extensions':['mxml','xhvml','xvml','xvm'],'className':'sgml','path':'source'},'yin+xml':{'extensions':['yin'],'className':'sgml','path':'source'},'zip':{'extensions':['zip'],'className':'zip','path':'archive'}},'archive':{'*':{'extensions':['lzh','iso','dmg','pkg']},'zip':{'extensions':['bz2','gz','gzip','z'],'className':'zip'}},'audio':{'*':{'extensions':['adp','au','snd','mid','midi','kar','rmi','oga','ogg','spx','uva','uvva','eol','dra','dts','dtshd','lvp','pya','ecelp4800','ecelp7470','ecelp9600','rip','weba','aac','aif','aiff','aifc','m3u','wax','wma','ram','ra','rmp','flac']},'mp4':{'extensions':['mp4a','m4a'],'className':'mpeg'},'mpeg':{'extensions':['mpga','mp2','mp2a','mp3','m2a','m3a'],'className':'mpeg'},'x-wav':{'extensions':['wav'],'className':'x-wav'}},'image':{'bmp':{'extensions':['bmp'],'className':'bmp'},'*':{'extensions':['cgm','g3','ief','ktx','btif','psd','uvi','uvvi','uvg','uvvg','djvu','djv','dwg','dxf','fbs','fpx','fst','mmr','rlc','mdi','npx','wbmp','xif','webp','ras','cmx','fh','fhc','fh4','fh5','fh7','ico','pcx','pic','pct','pnm','pbm','pgm','ppm','rgb','xbm','xpm','xwd']},'gif':{'extensions':['gif'],'className':'gif'},'jpeg':{'extensions':['jpeg','jpg','jpe'],'className':'jpeg'},'png':{'extensions':['png'],'className':'png'},'svg+xml':{'extensions':['svg','svgz'],'className':'sgml','path':'source'},'tiff':{'extensions':['tiff','tif'],'className':'tiff'}},'text':{'*':{'extensions':['sub','ics','ifb','csv','n3','txt','text','conf','def','list','log','in','dsc','rtx','tsv','t','tr','roff','man','me','ms','ttl','uri','uris','urls','vcard','curl','dcurl','scurl','mcurl','fly','flx','gv','3dml','spot','jad','wml','wmls','etx','uu','vcs','vcf','htc','ini','gitignore','htaccess','htpasswd','config']},'css':{'extensions':['css'],'className':'css'},'html':{'extensions':['html','htm'],'className':'sgml','path':'source'},'sgml':{'extensions':['sgml','sgm'],'className':'sgml','path':'source'},'x-asm':{'extensions':['s','asm'],'path':'source'},'x-c':{'extensions':['c','cc','cxx','cpp','hh','dic'],'path':'source'},'x-fortran':{'extensions':['f','for','f77','f90'],'path':'source'},'x-pascal':{'extensions':['p','pas'],'path':'source'},'x-java-source':{'extensions':['java'],'path':'source'},'cache-manifest':{'extensions':['appcache','manifest'],'path':'source'}},'source':{'*':{'extensions':['h','pl','py','rb','less','sass','sml','sql','vb','php','php3','inc','asp','as']}},'video':{'*':{'extensions':['3gp','3g2','h261','h263','h264','jpgv','jpm','jpgm','mj2','mjp2','mpeg','mpg','mpe','m1v','m2v','ogv','qt','mov','uvh','uvvh','uvm','uvvm','uvp','uvvp','uvs','uvvs','uvv','uvvv','dvb','fvt','mxu','m4u','pyv','uvu','uvvu','viv','webm','f4v','fli','m4v','asf','asx','wm','wmx','wvx','movie','ts']},'mp4':{'extensions':['mp4','mp4v','mpg4'],'className':'mp4'},'x-flv':{'extensions':['flv'],'className':'x-flv'},'x-ms-wmv':{'extensions':['wmv'],'className':'x-ms-wmv'},'x-msvideo':{'extensions':['avi'],'className':'x-msvideo'}}}}))}());(function(){var define=System.amdDefine;(function(root,factory){if(typeof exports==='object'){module.exports=factory(require('./types'))}else if(typeof define==='function'&&define.amd){define('3rdparty/mime/wtf.js',['3rdparty/mime/types.js'],factory)}else{factory(mimeTypes)}}(this,function(types){var classPrefix='mime-',extensionIdx={},contentTypeByExtension={};Object.keys(types).forEach(function(group){Object.keys(types[group]).forEach(function(type){types[group][type].extensions.forEach(function(extension){contentTypeByExtension[extension]=group+'/'+type;extensionIdx[extension]={group:group,type:types[group][type]}})})});function fileNameExtension(fileName){var fileExtension=null;var separatorIdx=fileName.lastIndexOf('.');if(separatorIdx>-1){return fileName.substr(separatorIdx+1).toLowerCase()}return''}return{types:types,contentTypeByExtension:contentTypeByExtension,getClass:function(fileName,mimeType){var fileExtension=fileNameExtension(fileName||''),mimeTypes=(mimeType||'application/octet-stream').toLowerCase().split(';'),classList=['icon'];mimeTypes.forEach(function(type){var path=type.replace(/^\s+|\s+$/g,'').split('/'),group=types[path[0]];if(group){if(group[path[1]]){type=group[path[1]];classList.push(type.path||path[0]);if(type.className){classList.push(type.className)}}else if(extensionIdx[fileExtension]){type=extensionIdx[fileExtension];classList.push(type.type.path||type.group);if(type.type.className){classList.push(type.type.className)}}else{classList.push(path[0])}}});if(classList.length===1){classList.push('application')}return classList.map(function(item){return classPrefix+item}).join(' ')},getContentTypeByFileName:function(fileName){var fileExtension=fileNameExtension(fileName||'');return this.contentTypeByExtension[fileExtension]||'application/octet-stream'},getDom:function(fileName,mimeType){var icon=document.createElement('div'),span;icon.className=this.getClass(fileName,mimeType);if(fileName){span=icon.appendChild(document.createElement('span'));span.appendChild(document.createTextNode(fileName.match(/\.([^\.]+)$/)[1]))}return icon}}}))}());(function(){var define=System.amdDefine;(function(name,definition){if(typeof define==='function')define('3rdparty/mario.js',[],definition);else if(typeof module!=='undefined'&&module.exports)module.exports=definition();else this[name]=definition()}('mario',function(){var t=true;function mario(ua){function getFirstMatch(regexp){var match=ua.match(regexp);return match&&match[1]}var windows=/windows/i.test(ua)||/win32/i.test(ua);var macos=/mac os/i.test(ua);var linux=/linux/i.test(ua);var chrome=/chrome/i.test(ua);var firefox=/firefox/i.test(ua);var seamonkey=/seamonkey\//i.test(ua);var opera=/opera/i.test(ua);var operaBlink=/OPR/.test(ua);var safari=/safari/i.test(ua);var ie=/msie/i.test(ua);var spartan=/edge/i.test(ua);var trident=/trident/i.test(ua);var phantom=/phantom/i.test(ua);var touch=/touch/i.test(ua);var iphone=/\(iphone;/i.test(ua);var ipad=/\(ipad;/i.test(ua);var ipod=/\(ipod( touch)?;/i.test(ua);var crios=/crios\//i.test(ua);var android=/android/i.test(ua);var windowsPhone=/Windows Phone/i.test(ua);var gecko=/gecko\//i.test(ua);var likeGecko=/like gecko/i.test(ua);var webkit=/webkit/i.test(ua);var blackBerry=/\(BB\d+;/i.test(ua);var detected={};if(ie){detected.msie=t;detected.name='Internet Explorer';detected.version=getFirstMatch(/msie (\d+(\.\d+)?);/i)}else if(spartan){detected.name='Edge';detected.msedge=t;detected.edge=t;detected.version=getFirstMatch(/Edge\/(\d+)/i)}else if(operaBlink){detected.name='Opera';detected.opera=t;detected.version=getFirstMatch(/OPR\/(\d+(\.\d+)?)/i)}else if(chrome){detected.name='Chrome';detected.chrome=t;detected.version=getFirstMatch(/chrome\/(\d+(\.\d+)?)/i)}else if(firefox){detected.name='Firefox';detected.firefox=t;detected.version=getFirstMatch(/firefox\/(\d+(\.\d+)?)/i)}else if(phantom){detected.phantom=t;detected.version=getFirstMatch(/phantomjs\/(\d+(\.\d+)+)/i)}else if(seamonkey){detected.seamonkey=t;detected.version=getFirstMatch(/seamonkey\/(\d+(\.\d+)?)/i)}else if(opera){detected.name='Opera';detected.opera=t;detected.version=getFirstMatch(/version\/(\d+(\.\d+)?)/i)}else if(safari&&!android&&!blackBerry){detected.name='Safari';detected.safari=t;detected.version=getFirstMatch(/version\/(\d+(\.\d+)?)/i)}else{if(ipad||iphone||ipod){detected.safari=t;detected.webkit=t}else if(trident){detected.msie=t}else if(android||blackBerry){detected.webkit=t;detected.version=getFirstMatch(/version\/(\d+(\.\d+)?)/i)}}if(!detected.version){delete detected.version}if(windows){detected.windows=t}if(macos&&!trident){detected.macos=t}if(linux){detected.linux=t}if(touch){detected.touch=t}if(windowsPhone){detected.touch=t;detected.windowsPhone=t}if(ipad||iphone||ipod){detected.touch=t;detected.ios=t;if(!detected.version&&crios){delete detected.safari;detected.name='Chrome';detected.chrome=t;detected.version=getFirstMatch(/crios\/(\d+(\.\d+)?)/i)}else{detected.name='Safari'}var osVersion=getFirstMatch(/os (\d+([_\s]\d+)*) like mac os x/i);if(osVersion){detected.osversion=osVersion.replace(/[_\s]/g,'.')}}if(blackBerry){detected.name='Blackberry';detected.blackberry=t;detected.osversion=getFirstMatch(/\(BB(\d+);/i)}if(ipad){detected.ipad=t}if(iphone){detected.iphone=t}if(ipod){detected.ipod=t}if(gecko){detected.mozilla=t;detected.gecko=t}if(likeGecko){if(trident){detected.name='Internet Explorer';detected.msie=t;detected.version=getFirstMatch(/rv[ :](\d+(?:\.\d+))/i)}}if(android&&!trident){if(!detected.name){detected.name='Android'}detected.touch=t;detected.android=t;var androidVersion=getFirstMatch(/android[ \/](\d+(\.\d+)*)/i);if(androidVersion){detected.osversion=androidVersion}}if(operaBlink||chrome&&detected.version>=28||android&&detected.osversion>=4.4){detected.blink=t}if(!detected.blink&&!trident&&webkit){detected.webkit=t}if(detected.msie){detected.explorer=t;if(windowsPhone){detected.explorermobile=t}}return detected}if(typeof navigator!=='undefined'&&navigator&&typeof navigator.userAgent==='string'){var detected=mario(navigator.userAgent);for(var propertyName in detected){if(detected.hasOwnProperty(propertyName)){mario[propertyName]=detected[propertyName]}}}return mario}))}());(function(){var define=System.amdDefine;define('common/fileExtensionByContentType.js',[],function(){return{'application/andrew-inset':'ez','application/applixware':'aw','application/atom+xml':'atom','application/atomcat+xml':'atomcat','application/atomsvc+xml':'atomsvc','application/ccxml+xml':'ccxml','application/cdmi-capability':'cdmia','application/cdmi-container':'cdmic','application/cdmi-domain':'cdmid','application/cdmi-object':'cdmio','application/cdmi-queue':'cdmiq','application/cu-seeme':'cu','application/davmount+xml':'davmount','application/dssc+der':'dssc','application/dssc+xml':'xdssc','application/ecmascript':'ecma','application/emma+xml':'emma','application/epub+zip':'epub','application/exi':'exi','application/font-tdpfr':'pfr','application/hyperstudio':'stk','application/inkml+xml':'ink','application/ipfix':'ipfix','application/java-archive':'jar','application/java-serialized-object':'ser','application/java-vm':'class','application/javascript':'js','application/json':'json','application/lost+xml':'lostxml','application/mac-binhex40':'hqx','application/mac-compactpro':'cpt','application/mads+xml':'mads','application/marc':'mrc','application/marcxml+xml':'mrcx','application/mathematica':'ma','application/mathml+xml':'mathml','application/mbox':'mbox','application/mediaservercontrol+xml':'mscml','application/metalink4+xml':'meta4','application/mets+xml':'mets','application/mods+xml':'mods','application/mp21':'m21','application/mp4':'mp4s','application/msword':'doc','application/mxf':'mxf','application/octet-stream':'bin','application/oda':'oda','application/oebps-package+xml':'opf','application/ogg':'ogx','application/onenote':'onetoc','application/oxps':'oxps','application/patch-ops-error+xml':'xer','application/pdf':'pdf','application/pgp-encrypted':'pgp','application/pgp-signature':'asc','application/pics-rules':'prf','application/pkcs10':'p10','application/pkcs7-mime':'p7m','application/pkcs7-signature':'p7s','application/pkcs8':'p8','application/pkix-attr-cert':'ac','application/pkix-cert':'cer','application/pkix-crl':'crl','application/pkix-pkipath':'pkipath','application/pkixcmp':'pki','application/pls+xml':'pls','application/postscript':'ai','application/prs.cww':'cww','application/pskc+xml':'pskcxml','application/rdf+xml':'rdf','application/reginfo+xml':'rif','application/relax-ng-compact-syntax':'rnc','application/resource-lists+xml':'rl','application/resource-lists-diff+xml':'rld','application/rls-services+xml':'rs','application/rpki-ghostbusters':'gbr','application/rpki-manifest':'mft','application/rpki-roa':'roa','application/rsd+xml':'rsd','application/rss+xml':'rss','application/rtf':'rtf','application/sbml+xml':'sbml','application/scvp-cv-request':'scq','application/scvp-cv-response':'scs','application/scvp-vp-request':'spq','application/scvp-vp-response':'spp','application/sdp':'sdp','application/set-payment-initiation':'setpay','application/set-registration-initiation':'setreg','application/shf+xml':'shf','application/smil+xml':'smi','application/sparql-query':'rq','application/sparql-results+xml':'srx','application/srgs':'gram','application/srgs+xml':'grxml','application/sru+xml':'sru','application/ssml+xml':'ssml','application/tei+xml':'tei','application/thraud+xml':'tfi','application/timestamped-data':'tsd','application/vnd.3gpp.pic-bw-large':'plb','application/vnd.3gpp.pic-bw-small':'psb','application/vnd.3gpp.pic-bw-var':'pvb','application/vnd.3gpp2.tcap':'tcap','application/vnd.3m.post-it-notes':'pwn','application/vnd.accpac.simply.aso':'aso','application/vnd.accpac.simply.imp':'imp','application/vnd.acucobol':'acu','application/vnd.acucorp':'atc','application/vnd.adobe.air-application-installer-package+zip':'air','application/vnd.adobe.fxp':'fxp','application/vnd.adobe.xdp+xml':'xdp','application/vnd.adobe.xfdf':'xfdf','application/vnd.ahead.space':'ahead','application/vnd.airzip.filesecure.azf':'azf','application/vnd.airzip.filesecure.azs':'azs','application/vnd.amazon.ebook':'azw','application/vnd.americandynamics.acc':'acc','application/vnd.amiga.ami':'ami','application/vnd.android.package-archive':'apk','application/vnd.anser-web-certificate-issue-initiation':'cii','application/vnd.anser-web-funds-transfer-initiation':'fti','application/vnd.antix.game-component':'atx','application/vnd.apple.installer+xml':'mpkg','application/vnd.apple.mpegurl':'m3u8','application/vnd.aristanetworks.swi':'swi','application/vnd.astraea-software.iota':'iota','application/vnd.audiograph':'aep','application/vnd.blueice.multipass':'mpm','application/vnd.bmi':'bmi','application/vnd.businessobjects':'rep','application/vnd.chemdraw+xml':'cdxml','application/vnd.chipnuts.karaoke-mmd':'mmd','application/vnd.cinderella':'cdy','application/vnd.claymore':'cla','application/vnd.cloanto.rp9':'rp9','application/vnd.clonk.c4group':'c4g','application/vnd.cluetrust.cartomobile-config':'c11amc','application/vnd.cluetrust.cartomobile-config-pkg':'c11amz','application/vnd.commonspace':'csp','application/vnd.contact.cmsg':'cdbcmsg','application/vnd.cosmocaller':'cmc','application/vnd.crick.clicker':'clkx','application/vnd.crick.clicker.keyboard':'clkk','application/vnd.crick.clicker.palette':'clkp','application/vnd.crick.clicker.template':'clkt','application/vnd.crick.clicker.wordbank':'clkw','application/vnd.criticaltools.wbs+xml':'wbs','application/vnd.ctc-posml':'pml','application/vnd.cups-ppd':'ppd','application/vnd.curl.car':'car','application/vnd.curl.pcurl':'pcurl','application/vnd.data-vision.rdz':'rdz','application/vnd.dece.data':'uvf','application/vnd.dece.ttml+xml':'uvt','application/vnd.dece.unspecified':'uvx','application/vnd.dece.zip':'uvz','application/vnd.denovo.fcselayout-link':'fe_launch','application/vnd.dna':'dna','application/vnd.dolby.mlp':'mlp','application/vnd.dpgraph':'dpg','application/vnd.dreamfactory':'dfac','application/vnd.dvb.ait':'ait','application/vnd.dvb.service':'svc','application/vnd.dynageo':'geo','application/vnd.ecowin.chart':'mag','application/vnd.enliven':'nml','application/vnd.epson.esf':'esf','application/vnd.epson.msf':'msf','application/vnd.epson.quickanime':'qam','application/vnd.epson.salt':'slt','application/vnd.epson.ssf':'ssf','application/vnd.eszigno3+xml':'es3','application/vnd.ezpix-album':'ez2','application/vnd.ezpix-package':'ez3','application/vnd.fdf':'fdf','application/vnd.fdsn.mseed':'mseed','application/vnd.fdsn.seed':'seed','application/vnd.flographit':'gph','application/vnd.fluxtime.clip':'ftc','application/vnd.framemaker':'fm','application/vnd.frogans.fnc':'fnc','application/vnd.frogans.ltf':'ltf','application/vnd.fsc.weblaunch':'fsc','application/vnd.fujitsu.oasys':'oas','application/vnd.fujitsu.oasys2':'oa2','application/vnd.fujitsu.oasys3':'oa3','application/vnd.fujitsu.oasysgp':'fg5','application/vnd.fujitsu.oasysprs':'bh2','application/vnd.fujixerox.ddd':'ddd','application/vnd.fujixerox.docuworks':'xdw','application/vnd.fujixerox.docuworks.binder':'xbd','application/vnd.fuzzysheet':'fzs','application/vnd.genomatix.tuxedo':'txd','application/vnd.geogebra.file':'ggb','application/vnd.geogebra.tool':'ggt','application/vnd.geometry-explorer':'gex','application/vnd.geonext':'gxt','application/vnd.geoplan':'g2w','application/vnd.geospace':'g3w','application/vnd.gmx':'gmx','application/vnd.google-earth.kml+xml':'kml','application/vnd.google-earth.kmz':'kmz','application/vnd.grafeq':'gqf','application/vnd.groove-account':'gac','application/vnd.groove-help':'ghf','application/vnd.groove-identity-message':'gim','application/vnd.groove-injector':'grv','application/vnd.groove-tool-message':'gtm','application/vnd.groove-tool-template':'tpl','application/vnd.groove-vcard':'vcg','application/vnd.hal+xml':'hal','application/vnd.handheld-entertainment+xml':'zmm','application/vnd.hbci':'hbci','application/vnd.hhe.lesson-player':'les','application/vnd.hp-hpgl':'hpgl','application/vnd.hp-hpid':'hpid','application/vnd.hp-hps':'hps','application/vnd.hp-jlyt':'jlt','application/vnd.hp-pcl':'pcl','application/vnd.hp-pclxl':'pclxl','application/vnd.hydrostatix.sof-data':'sfd-hdstx','application/vnd.hzn-3d-crossword':'x3d','application/vnd.ibm.minipay':'mpy','application/vnd.ibm.modcap':'afp','application/vnd.ibm.rights-management':'irm','application/vnd.ibm.secure-container':'sc','application/vnd.iccprofile':'icc','application/vnd.igloader':'igl','application/vnd.immervision-ivp':'ivp','application/vnd.immervision-ivu':'ivu','application/vnd.insors.igm':'igm','application/vnd.intercon.formnet':'xpw','application/vnd.intergeo':'i2g','application/vnd.intu.qbo':'qbo','application/vnd.intu.qfx':'qfx','application/vnd.ipunplugged.rcprofile':'rcprofile','application/vnd.irepository.package+xml':'irp','application/vnd.is-xpr':'xpr','application/vnd.isac.fcs':'fcs','application/vnd.jam':'jam','application/vnd.jcp.javame.midlet-rms':'rms','application/vnd.jisp':'jisp','application/vnd.joost.joda-archive':'joda','application/vnd.kahootz':'ktz','application/vnd.kde.karbon':'karbon','application/vnd.kde.kchart':'chrt','application/vnd.kde.kformula':'kfo','application/vnd.kde.kivio':'flw','application/vnd.kde.kontour':'kon','application/vnd.kde.kpresenter':'kpr','application/vnd.kde.kspread':'ksp','application/vnd.kde.kword':'kwd','application/vnd.kenameaapp':'htke','application/vnd.kidspiration':'kia','application/vnd.kinar':'kne','application/vnd.koan':'skp','application/vnd.kodak-descriptor':'sse','application/vnd.las.las+xml':'lasxml','application/vnd.llamagraphics.life-balance.desktop':'lbd','application/vnd.llamagraphics.life-balance.exchange+xml':'lbe','application/vnd.lotus-1-2-3':'123','application/vnd.lotus-approach':'apr','application/vnd.lotus-freelance':'pre','application/vnd.lotus-notes':'nsf','application/vnd.lotus-organizer':'org','application/vnd.lotus-screencam':'scm','application/vnd.lotus-wordpro':'lwp','application/vnd.macports.portpkg':'portpkg','application/vnd.mcd':'mcd','application/vnd.medcalcdata':'mc1','application/vnd.mediastation.cdkey':'cdkey','application/vnd.mfer':'mwf','application/vnd.mfmp':'mfm','application/vnd.micrografx.flo':'flo','application/vnd.micrografx.igx':'igx','application/vnd.mif':'mif','application/vnd.mobius.daf':'daf','application/vnd.mobius.dis':'dis','application/vnd.mobius.mbk':'mbk','application/vnd.mobius.mqy':'mqy','application/vnd.mobius.msl':'msl','application/vnd.mobius.plc':'plc','application/vnd.mobius.txf':'txf','application/vnd.mophun.application':'mpn','application/vnd.mophun.certificate':'mpc','application/vnd.mozilla.xul+xml':'xul','application/vnd.ms-artgalry':'cil','application/vnd.ms-cab-compressed':'cab','application/vnd.ms-excel':'xls','application/vnd.ms-excel.addin.macroenabled.12':'xlam','application/vnd.ms-excel.sheet.binary.macroenabled.12':'xlsb','application/vnd.ms-excel.sheet.macroenabled.12':'xlsm','application/vnd.ms-excel.template.macroenabled.12':'xltm','application/vnd.ms-fontobject':'eot','application/vnd.ms-htmlhelp':'chm','application/vnd.ms-ims':'ims','application/vnd.ms-lrm':'lrm','application/vnd.ms-officetheme':'thmx','application/vnd.ms-pki.seccat':'cat','application/vnd.ms-pki.stl':'stl','application/vnd.ms-powerpoint':'ppt','application/vnd.ms-powerpoint.addin.macroenabled.12':'ppam','application/vnd.ms-powerpoint.presentation.macroenabled.12':'pptm','application/vnd.ms-powerpoint.slide.macroenabled.12':'sldm','application/vnd.ms-powerpoint.slideshow.macroenabled.12':'ppsm','application/vnd.ms-powerpoint.template.macroenabled.12':'potm','application/vnd.ms-project':'mpp','application/vnd.ms-word.document.macroenabled.12':'docm','application/vnd.ms-word.template.macroenabled.12':'dotm','application/vnd.ms-works':'wps','application/vnd.ms-wpl':'wpl','application/vnd.ms-xpsdocument':'xps','application/vnd.mseq':'mseq','application/vnd.musician':'mus','application/vnd.muvee.style':'msty','application/vnd.mynfc':'taglet','application/vnd.neurolanguage.nlu':'nlu','application/vnd.noblenet-directory':'nnd','application/vnd.noblenet-sealer':'nns','application/vnd.noblenet-web':'nnw','application/vnd.nokia.n-gage.data':'ngdat','application/vnd.nokia.n-gage.symbian.install':'n-gage','application/vnd.nokia.radio-preset':'rpst','application/vnd.nokia.radio-presets':'rpss','application/vnd.novadigm.edm':'edm','application/vnd.novadigm.edx':'edx','application/vnd.novadigm.ext':'ext','application/vnd.oasis.opendocument.chart':'odc','application/vnd.oasis.opendocument.chart-template':'otc','application/vnd.oasis.opendocument.database':'odb','application/vnd.oasis.opendocument.formula':'odf','application/vnd.oasis.opendocument.formula-template':'odft','application/vnd.oasis.opendocument.graphics':'odg','application/vnd.oasis.opendocument.graphics-template':'otg','application/vnd.oasis.opendocument.image':'odi','application/vnd.oasis.opendocument.image-template':'oti','application/vnd.oasis.opendocument.presentation':'odp','application/vnd.oasis.opendocument.presentation-template':'otp','application/vnd.oasis.opendocument.spreadsheet':'ods','application/vnd.oasis.opendocument.spreadsheet-template':'ots','application/vnd.oasis.opendocument.text':'odt','application/vnd.oasis.opendocument.text-master':'odm','application/vnd.oasis.opendocument.text-template':'ott','application/vnd.oasis.opendocument.text-web':'oth','application/vnd.olpc-sugar':'xo','application/vnd.oma.dd2+xml':'dd2','application/vnd.openofficeorg.extension':'oxt','application/vnd.openxmlformats-officedocument.presentationml.presentation':'pptx','application/vnd.openxmlformats-officedocument.presentationml.slide':'sldx','application/vnd.openxmlformats-officedocument.presentationml.slideshow':'ppsx','application/vnd.openxmlformats-officedocument.presentationml.template':'potx','application/vnd.openxmlformats-officedocument.spreadsheetml.sheet':'xlsx','application/vnd.openxmlformats-officedocument.spreadsheetml.template':'xltx','application/vnd.openxmlformats-officedocument.wordprocessingml.document':'docx','application/vnd.openxmlformats-officedocument.wordprocessingml.template':'dotx','application/vnd.osgeo.mapguide.package':'mgp','application/vnd.osgi.dp':'dp','application/vnd.palm':'pdb','application/vnd.pawaafile':'paw','application/vnd.pg.format':'str','application/vnd.pg.osasli':'ei6','application/vnd.picsel':'efif','application/vnd.pmi.widget':'wg','application/vnd.pocketlearn':'plf','application/vnd.powerbuilder6':'pbd','application/vnd.previewsystems.box':'box','application/vnd.proteus.magazine':'mgz','application/vnd.publishare-delta-tree':'qps','application/vnd.pvi.ptid1':'ptid','application/vnd.quark.quarkxpress':'qxd','application/vnd.realvnc.bed':'bed','application/vnd.recordare.musicxml':'mxl','application/vnd.recordare.musicxml+xml':'musicxml','application/vnd.rig.cryptonote':'cryptonote','application/vnd.rim.cod':'cod','application/vnd.rn-realmedia':'rm','application/vnd.route66.link66+xml':'link66','application/vnd.sailingtracker.track':'st','application/vnd.seemail':'see','application/vnd.sema':'sema','application/vnd.semd':'semd','application/vnd.semf':'semf','application/vnd.shana.informed.formdata':'ifm','application/vnd.shana.informed.formtemplate':'itp','application/vnd.shana.informed.interchange':'iif','application/vnd.shana.informed.package':'ipk','application/vnd.simtech-mindmapper':'twd','application/vnd.smaf':'mmf','application/vnd.smart.teacher':'teacher','application/vnd.solent.sdkm+xml':'sdkm','application/vnd.spotfire.dxp':'dxp','application/vnd.spotfire.sfs':'sfs','application/vnd.stardivision.calc':'sdc','application/vnd.stardivision.draw':'sda','application/vnd.stardivision.impress':'sdd','application/vnd.stardivision.math':'smf','application/vnd.stardivision.writer':'sdw','application/vnd.stardivision.writer-global':'sgl','application/vnd.stepmania.package':'smzip','application/vnd.stepmania.stepchart':'sm','application/vnd.sun.xml.calc':'sxc','application/vnd.sun.xml.calc.template':'stc','application/vnd.sun.xml.draw':'sxd','application/vnd.sun.xml.draw.template':'std','application/vnd.sun.xml.impress':'sxi','application/vnd.sun.xml.impress.template':'sti','application/vnd.sun.xml.math':'sxm','application/vnd.sun.xml.writer':'sxw','application/vnd.sun.xml.writer.global':'sxg','application/vnd.sun.xml.writer.template':'stw','application/vnd.sus-calendar':'sus','application/vnd.svd':'svd','application/vnd.symbian.install':'sis','application/vnd.syncml+xml':'xsm','application/vnd.syncml.dm+wbxml':'bdm','application/vnd.syncml.dm+xml':'xdm','application/vnd.tao.intent-module-archive':'tao','application/vnd.tcpdump.pcap':'pcap','application/vnd.tmobile-livetv':'tmo','application/vnd.trid.tpt':'tpt','application/vnd.triscape.mxs':'mxs','application/vnd.trueapp':'tra','application/vnd.ufdl':'ufd','application/vnd.uiq.theme':'utz','application/vnd.umajin':'umj','application/vnd.unity':'unityweb','application/vnd.uoml+xml':'uoml','application/vnd.vcx':'vcx','application/vnd.visio':'vsd','application/vnd.visionary':'vis','application/vnd.vsf':'vsf','application/vnd.wap.wbxml':'wbxml','application/vnd.wap.wmlc':'wmlc','application/vnd.wap.wmlscriptc':'wmlsc','application/vnd.webturbo':'wtb','application/vnd.wolfram.player':'nbp','application/vnd.wordperfect':'wpd','application/vnd.wqd':'wqd','application/vnd.wt.stf':'stf','application/vnd.xara':'xar','application/vnd.xfdl':'xfdl','application/vnd.yamaha.hv-dic':'hvd','application/vnd.yamaha.hv-script':'hvs','application/vnd.yamaha.hv-voice':'hvp','application/vnd.yamaha.openscoreformat':'osf','application/vnd.yamaha.openscoreformat.osfpvg+xml':'osfpvg','application/vnd.yamaha.smaf-audio':'saf','application/vnd.yamaha.smaf-phrase':'spf','application/vnd.yellowriver-custom-menu':'cmp','application/vnd.zul':'zir','application/vnd.zzazz.deck+xml':'zaz','application/voicexml+xml':'vxml','application/widget':'wgt','application/winhlp':'hlp','application/wsdl+xml':'wsdl','application/wspolicy+xml':'wspolicy','application/x-7z-compressed':'7z','application/x-abiword':'abw','application/x-ace-compressed':'ace','application/x-authorware-bin':'aab','application/x-authorware-map':'aam','application/x-authorware-seg':'aas','application/x-bcpio':'bcpio','application/x-bittorrent':'torrent','application/x-bzip':'bz','application/x-bzip2':'bz2','application/x-cdlink':'vcd','application/x-chat':'chat','application/x-chess-pgn':'pgn','application/x-cpio':'cpio','application/x-csh':'csh','application/x-debian-package':'deb','application/x-director':'dir','application/x-doom':'wad','application/x-dtbncx+xml':'ncx','application/x-dtbook+xml':'dtb','application/x-dtbresource+xml':'res','application/x-dvi':'dvi','application/x-font-bdf':'bdf','application/x-font-ghostscript':'gsf','application/x-font-linux-psf':'psf','application/x-font-otf':'otf','application/x-font-pcf':'pcf','application/x-font-snf':'snf','application/x-font-ttf':'ttf','application/x-font-type1':'pfa','application/x-font-woff':'woff','application/x-futuresplash':'spl','application/x-gnumeric':'gnumeric','application/x-gtar':'gtar','application/x-hdf':'hdf','application/x-java-jnlp-file':'jnlp','application/x-latex':'latex','application/x-mobipocket-ebook':'prc','application/x-ms-application':'application','application/x-ms-wmd':'wmd','application/x-ms-wmz':'wmz','application/x-ms-xbap':'xbap','application/x-msaccess':'mdb','application/x-msbinder':'obd','application/x-mscardfile':'crd','application/x-msclip':'clp','application/x-msdownload':'exe','application/x-msmediaview':'mvb','application/x-msmetafile':'wmf','application/x-msmoney':'mny','application/x-mspublisher':'pub','application/x-msschedule':'scd','application/x-msterminal':'trm','application/x-mswrite':'wri','application/x-netcdf':'nc','application/x-pkcs12':'p12','application/x-pkcs7-certificates':'p7b','application/x-pkcs7-certreqresp':'p7r','application/x-rar-compressed':'rar','application/x-sh':'sh','application/x-shar':'shar','application/x-shockwave-flash':'swf','application/x-silverlight-app':'xap','application/x-stuffit':'sit','application/x-stuffitx':'sitx','application/x-sv4cpio':'sv4cpio','application/x-sv4crc':'sv4crc','application/x-tar':'tar','application/x-tcl':'tcl','application/x-tex':'tex','application/x-tex-tfm':'tfm','application/x-texinfo':'texinfo','application/x-ustar':'ustar','application/x-wais-source':'src','application/x-x509-ca-cert':'der','application/x-xfig':'fig','application/x-xpinstall':'xpi','application/xcap-diff+xml':'xdf','application/xenc+xml':'xenc','application/xhtml+xml':'xhtml','application/xml':'xml','application/xml-dtd':'dtd','application/xop+xml':'xop','application/xslt+xml':'xslt','application/xspf+xml':'xspf','application/xv+xml':'mxml','application/yang':'yang','application/yin+xml':'yin','application/zip':'zip','audio/adpcm':'adp','audio/basic':'au','audio/midi':'mid','audio/mp4':'mp4a','audio/mpeg':'mpga','audio/ogg':'oga','audio/vnd.dece.audio':'uva','audio/vnd.digital-winds':'eol','audio/vnd.dra':'dra','audio/vnd.dts':'dts','audio/vnd.dts.hd':'dtshd','audio/vnd.lucent.voice':'lvp','audio/vnd.ms-playready.media.pya':'pya','audio/vnd.nuera.ecelp4800':'ecelp4800','audio/vnd.nuera.ecelp7470':'ecelp7470','audio/vnd.nuera.ecelp9600':'ecelp9600','audio/vnd.rip':'rip','audio/webm':'weba','audio/x-aac':'aac','audio/x-aiff':'aif','audio/x-mpegurl':'m3u','audio/x-ms-wax':'wax','audio/x-ms-wma':'wma','audio/x-pn-realaudio':'ram','audio/x-pn-realaudio-plugin':'rmp','audio/x-wav':'wav','chemical/x-cdx':'cdx','chemical/x-cif':'cif','chemical/x-cmdf':'cmdf','chemical/x-cml':'cml','chemical/x-csml':'csml','chemical/x-xyz':'xyz','image/bmp':'bmp','image/cgm':'cgm','image/g3fax':'g3','image/gif':'gif','image/ief':'ief','image/jpeg':'jpeg','image/ktx':'ktx','image/png':'png','image/prs.btif':'btif','image/svg+xml':'svg','image/tiff':'tiff','image/vnd.adobe.photoshop':'psd','image/vnd.dece.graphic':'uvi','image/vnd.dvb.subtitle':'sub','image/vnd.djvu':'djvu','image/vnd.dwg':'dwg','image/vnd.dxf':'dxf','image/vnd.fastbidsheet':'fbs','image/vnd.fpx':'fpx','image/vnd.fst':'fst','image/vnd.fujixerox.edmics-mmr':'mmr','image/vnd.fujixerox.edmics-rlc':'rlc','image/vnd.ms-modi':'mdi','image/vnd.net-fpx':'npx','image/vnd.wap.wbmp':'wbmp','image/vnd.xiff':'xif','image/webp':'webp','image/x-cmu-raster':'ras','image/x-cmx':'cmx','image/x-freehand':'fh','image/x-icon':'ico','image/x-pcx':'pcx','image/x-pict':'pic','image/x-portable-anymap':'pnm','image/x-portable-bitmap':'pbm','image/x-portable-graymap':'pgm','image/x-portable-pixmap':'ppm','image/x-rgb':'rgb','image/x-xbitmap':'xbm','image/x-xpixmap':'xpm','image/x-xwindowdump':'xwd','message/rfc822':'eml','model/iges':'igs','model/mesh':'msh','model/vnd.collada+xml':'dae','model/vnd.dwf':'dwf','model/vnd.gdl':'gdl','model/vnd.gtw':'gtw','model/vnd.mts':'mts','model/vnd.vtu':'vtu','model/vrml':'wrl','text/calendar':'ics','text/css':'css','text/csv':'csv','text/html':'html','text/n3':'n3','text/plain':'txt','text/prs.lines.tag':'dsc','text/richtext':'rtx','text/sgml':'sgml','text/tab-separated-values':'tsv','text/troff':'t','text/turtle':'ttl','text/uri-list':'uri','text/vcard':'vcard','text/vnd.curl':'curl','text/vnd.curl.dcurl':'dcurl','text/vnd.curl.scurl':'scurl','text/vnd.curl.mcurl':'mcurl','text/vnd.dvb.subtitle':'sub','text/vnd.fly':'fly','text/vnd.fmi.flexstor':'flx','text/vnd.graphviz':'gv','text/vnd.in3d.3dml':'3dml','text/vnd.in3d.spot':'spot','text/vnd.sun.j2me.app-descriptor':'jad','text/vnd.wap.wml':'wml','text/vnd.wap.wmlscript':'wmls','text/x-asm':'s','text/x-c':'c','text/x-fortran':'f','text/x-pascal':'p','text/x-java-source':'java','text/x-setext':'etx','text/x-uuencode':'uu','text/x-vcalendar':'vcs','text/x-vcard':'vcf','video/3gpp':'3gp','video/3gpp2':'3g2','video/h261':'h261','video/h263':'h263','video/h264':'h264','video/jpeg':'jpgv','video/jpm':'jpm','video/mj2':'mj2','video/mp4':'mp4','video/mpeg':'mpeg','video/ogg':'ogv','video/quicktime':'qt','video/vnd.dece.hd':'uvh','video/vnd.dece.mobile':'uvm','video/vnd.dece.pd':'uvp','video/vnd.dece.sd':'uvs','video/vnd.dece.video':'uvv','video/vnd.dvb.file':'dvb','video/vnd.fvt':'fvt','video/vnd.mpegurl':'mxu','video/vnd.ms-playready.media.pyv':'pyv','video/vnd.uvvu.mp4':'uvu','video/vnd.vivo':'viv','video/webm':'webm','video/x-f4v':'f4v','video/x-fli':'fli','video/x-flv':'flv','video/x-m4v':'m4v','video/x-ms-asf':'asf','video/x-ms-wm':'wm','video/x-ms-wmv':'wmv','video/x-ms-wmx':'wmx','video/x-ms-wvx':'wvx','video/x-msvideo':'avi','video/x-sgi-movie':'movie','x-conference/x-cooltalk':'ice','application/x-chrome-extension':'crx','font/opentype':'otf','text/x-component':'htc','text/cache-manifest':'appcache','application/x-mpegURL':'m3u8','video/MP2T':'ts','audio/flac':'flac'}})}());(function(){var define=System.amdDefine;define('webmail/model/MailPart.js',['node_modules/knockout/build/output/knockout-latest.debug.js'],function(ko){function MailPart(part,mail){this.contentType=part.contentType;this.partId=part.id;this.size=ko.observable(part.size);this.disposition=part.disposition||null;this.contentId=part.contentId||null;this.mail=mail}return MailPart})}());(function(){var define=System.amdDefine;define('3rdparty/jquery.cookie.js',['node_modules/jquery/dist/jquery.js'],function($){$.cookie=function(key,value,options){if(arguments.length>1&&(!/Object/.test(Object.prototype.toString.call(value))||value===null||value===undefined)){options=$.extend({},options);if(value===null||value===undefined){options.expires=-1}if(typeof options.expires==='number'){var days=options.expires,t=options.expires=new Date;t.setDate(t.getDate()+days)}value=String(value);return document.cookie=[encodeURIComponent(key),'=',options.raw?value:encodeURIComponent(value),options.expires?'; expires='+options.expires.toUTCString():'',options.path?'; path='+options.path:'',options.domain?'; domain='+options.domain:'',options.secure?'; secure':''].join('')}options=value||{};var decode=options.raw?function(s){return s}:decodeURIComponent;var pairs=document.cookie.split('; ');for(var i=0,pair;pair=pairs[i]&&pairs[i].split('=');i++){if(decode(pair[0])===key)return decode(pair[1]||'')}return null}})}());(function(){var define=System.amdDefine;define('webmail/model/mailparts/Attachment.js',['node_modules/jquery/dist/jquery.js','node_modules/knockout/build/output/knockout-latest.debug.js','3rdparty/mime/wtf.js','3rdparty/mario.js','common/util.js','common/fileExtensionByContentType.js','webmail/model/MailPart.js','3rdparty/jquery.cookie.js'],function($,ko,wtf,mario,util,fileExtensionByContentType,MailPart){function getFileExtensionByContentType(contentType){var extension=fileExtensionByContentType[contentType];return extension?'.'+extension:''}function composeDisplayName(dataObject){var displayName=dataObject.displayName;if(!displayName&&dataObject.fileName){displayName=dataObject.fileName.replace(/^.*?[\\\/]?([^\\\/]+)$/,'$1')}if(!displayName){displayName='Part-'+dataObject.id+'-'+dataObject.contentType.split('/').pop();displayName+=getFileExtensionByContentType(dataObject.contentType)}return displayName}function Attachment(dataObject,mail){var that=this;MailPart.call(that,dataObject,mail);that.mail=mail;that.id=dataObject.uid||util.uuid();that.part=dataObject.id;if(!dataObject.decodedSize){dataObject.decodedSize=dataObject.size;dataObject.size=Math.ceil(dataObject.decodedSize/3)*4}that.size=ko.observable(dataObject.decodedSize);that.rawSize=ko.observable(dataObject.size);that.displayName=composeDisplayName(dataObject);that.justAdded=dataObject.justAdded;that.input=dataObject.input;that.name=dataObject.name;that.value=dataObject.value;that.files=dataObject.files;var matchFileNameAndExtension=that.displayName.match(/^(.*)(\.[^.]+$)/);if(matchFileNameAndExtension){that.displayNameWithoutExtension=matchFileNameAndExtension[1];that.fileExtension=matchFileNameAndExtension[2]}else{that.displayNameWithoutExtension=that.displayName;that.fileExtension=''}that.contentType=dataObject.contentType;that.tempUrl=dataObject.tempUrl;that.iconClass='mime-icon mime-httpd mime-attachment';that.displaySize=ko.computed(function(){var size=that.size();if(!size){return''}else if(size<1024){return'1 KB'}else if(size<1048576){return inter.renderFileSize(size)}else{return inter.renderFileSize(size,1)}});that.checkForThumbnail();that.isPreviewable=ko.computed(function(){return that.hasThumbnail||!that.tempUrl&&Attachment.allowPdfPreview&&/^.pdf$/i.test(that.fileExtension)});that.cutTheString=function(maxLength,fileName,extension){if(fileName.length+extension.length>maxLength){var maxFileNameLength=maxLength-'…'.length-extension.length;fileName=fileName.substr(0,maxFileNameLength)+'…'}return fileName+extension};that.displayBottomName=ko.computed(function(){var maxLength=25,displayedFilename=that.cutTheString(maxLength,that.displayNameWithoutExtension,that.fileExtension);return displayedFilename});that.displayTopName=ko.computed(function(){var maxLength=70,displayedFilename;if(mario.msie){maxLength=20}displayedFilename=that.cutTheString(maxLength,that.displayNameWithoutExtension,that.fileExtension);return displayedFilename})}Attachment.prototype=Object.create(MailPart.prototype);Attachment.prototype.constructor=Attachment;Attachment.allowPdfPreview=mario.chrome&&mario.version>=19||mario.opera&&mario.version>=25||mario.safari&&mario.version>=5;Attachment.prototype.checkForThumbnail=function(){this.hasThumbnail=/^image\/(?:gif|png|x-png|tiff|jpeg|pjpeg|jpg)$/.test(this.contentType)};Attachment.createFromFile=function(file,isInlineImage){var attachement;file=Attachment.extendFileByNecessaryProperties(file,isInlineImage);attachement=Attachment.createAttachment(file);return attachement};Attachment.createAttachment=function(file){return new Attachment({id:file.id,uid:file.id,size:file.size,contentType:file.type,tempUrl:file.url,fileName:file.fileName,justAdded:true,input:file.input})};Attachment.extendFileByNecessaryProperties=function(file,isInlineImage){var name;file.id=util.uuid();if(isInlineImage){name=JSON.stringify({type:'related',isExisting:false,id:file.id,contentId:file.id})}else{name=JSON.stringify({type:'attachment',id:file.id,isExisting:false})}file.input={name:encodeURIComponent(name),value:'C:\\fakepath\\'+file.name,files:[file]};file.fileName=file.name;file.url=URL.createObjectURL(file);return file};Attachment.createAttachmentArray=function(dataArray,mail){return(dataArray||[]).map(function(dataObject){return new Attachment(dataObject,mail)})};Attachment.prototype.getPartUrl=function(){if(this.mail){return this.mail.getMailUrl()+'/'+this.part}else{return''}};Attachment.prototype.viewAttachedMail=function(){var currentUrl=window.location.href;var index=currentUrl.indexOf('?');if(index!==-1){currentUrl=currentUrl.substring(0,index)}window.open(currentUrl+'?standalone=true&part='+this.part,'_blank','toolbar=0,menubar=0,location=0')};Attachment.prototype.getDownloadUrl=function(parameters){var part=this.getPartUrl();parameters=parameters||{};if(part){if(mario.ios&&window.navigator.standalone){parameters.MailAuth=$.cookie('MailAuth')}return this.getPartUrl()+'/'+encodeURIComponent(this.displayName.replace(/\.\w+$/,function($0){return $0.toLowerCase()}))+util.createUrlQueryPart(parameters)}else if(this.tempUrl){return this.tempUrl}else{return''}};Attachment.prototype.canDownload=function(){return this.getPartUrl()||this.tempUrl&&!mario.msie};Attachment.prototype.getImageUrl=function(thumbnail){if(this.hasThumbnail){var parameters={};if(this.contentType==='image/tiff'||this.contentType==='application/pdf'){parameters.format='png'}if(thumbnail){parameters.width=!mario.ios?173:270;parameters.height=!mario.ios?115:180;parameters.crop=true;parameters.gravity='Center';parameters.repage=true}return this.getDownloadUrl(parameters)}else{return''}};Attachment.prototype.getPreviewUrl=function(){var url=this.getImageUrl();if(!url){var options={nodownload:1};if(this.fileExtension==='.pdf'){options.contentType='application/pdf'}return this.getDownloadUrl(options)}else{return url}};Attachment.prototype.getThumbnailUrl=function(){return this.getImageUrl(true)};Attachment.prototype.getThumbnailUrlForCSS=function(){return'url("'+this.getThumbnailUrl().replace(/'/,'\\"')+'")'};Attachment.prototype.attachToNewMail=function(mail){var dataObject={uid:this.id,id:this.part,size:this.size(),displayName:this.displayName,justAdded:this.justAdded,input:this.input,contentType:this.contentType};if(this.tempUrl){URL.revokeObjectURL(this.tempUrl)}return new Attachment(dataObject,mail)};Attachment.prototype.isAttachedMail=function(){return this.contentType==='message/rfc822'};return Attachment})}());(function(){var define=System.amdDefine;define('webmail/model/MailPartFactory.js',['node_modules/knockout/build/output/knockout-latest.debug.js','common/util.js','webmail/model/mailparts/TextPart.js','webmail/model/mailparts/InlineImagePart.js','webmail/model/mailparts/Attachment.js'],function(ko,util,TextPart,InlineImagePart,Attachment){function MailPartFactory(){}MailPartFactory.create=function(part,mail,actions){var textTypes=CONFIG.webmail.renderableContentTypes.textTypes,inlineImageTypes=CONFIG.webmail.renderableContentTypes.inlineImageTypes,MailPartClass;switch(true){case part.disposition&&part.disposition==='attachment':MailPartClass=Attachment;break;case textTypes.indexOf(part.contentType)!==-1:MailPartClass=TextPart;break;case inlineImageTypes.indexOf(part.contentType)!==-1:MailPartClass=InlineImagePart;break;default:MailPartClass=Attachment;break}return new MailPartClass(part,mail)};return MailPartFactory})}());(function(){var define=System.amdDefine;define('common/ReferenceCountBehavior.js',[],function(){var ReferenceCountBehavior={installInto:function(target){var referenceCount=0;var lastReferenceTime=Date.now();target.incrementReferences=function(){referenceCount+=1};target.decrementReferences=function(){referenceCount-=1;if(referenceCount===0){lastReferenceTime=Date.now();if(target.onNotReferenced){target.onNotReferenced()}}};target.hasReferences=function(){return referenceCount>0};target.lastReferenceTime=function(){return lastReferenceTime};target.referenceCount=function(){return referenceCount}}};return ReferenceCountBehavior})}());(function(){var define=System.amdDefine;define('webmail/model/Mail.js',['node_modules/knockout/build/output/knockout-latest.debug.js','common/model/Flag.js','3rdparty/mime/wtf.js','webmail/model/Recipient.js','webmail/model/mailparts/Attachment.js','webmail/model/MailPartFactory.js','common/ReferenceCountBehavior.js'],function(ko,Flag,wtf,Recipient,Attachment,MailPartFactory,ReferenceCountBehavior){function createRecipients(recipientsData){var result=[];(recipientsData||[]).forEach(function(recipientData){(recipientData.emails||[]).forEach(function(email){var recipient=new Recipient({displayName:recipientData.displayName,email:email.value||email});if(recipient){result.push(recipient)}})});return result}function Mail(username,folder,data){var that=this,flags=ko.observable({});ReferenceCountBehavior.installInto(this);function createFlagAccessor(flag){return ko.computed({read:function(){return!!flags()[flag]},write:function(value){var fs=flags();if(value){fs[flag]=value}else{delete fs[flag]}flags(fs)}})}that.username=username;that.folder=ko.observable(folder);that.busy=ko.observable(false);that.uid=null;that.messageId=null;that.size=0;that.headers={};that.inReplyTo=null;that.date=ko.observable();that.arrivalDate=ko.observable();that.replyTo=ko.observableArray();that.from=ko.observableArray();that.to=ko.observableArray();that.cc=ko.observableArray();that.bcc=ko.observableArray();that.subject=ko.observable();that.showLink=ko.observable(false);that.parts=ko.observableArray();that.undisclosedRecipients=ko.observable(false);Object.keys(Flag).forEach(function(flag){var name=Flag[flag].name;that[name]=createFlagAccessor(name)});this.selected=ko.observable(false);this.focused=ko.observable(false);this.dragging=ko.observable(false);this.sending=ko.observable(false);this.failedSaving=ko.observable(false);this.failedSending=ko.observable(false);this.failed=ko.pureComputed(function(){return this.failedSending()||this.failedSaving()},this);that.updateWith(data);that.displaySubject=ko.pureComputed(function(){return that.subject()||TR('mail.mailView.NoSubject','(No subject)')});that.hasRecipients=ko.pureComputed(function(){return that.to().length>0});['cc','from','to','bcc','replyTo'].forEach(function(field){that[field].toString=ko.pureComputed(function(){var contacts=that[field]();return contacts.map(function(contact){return contact.toString()}).join(', ')});that[field].toDisplayString=ko.pureComputed(function(){var contacts=that[field]();return contacts.map(function(contact){return contact.toDisplayString()}).join(', ')})});that.inlineParts=ko.pureComputed(function(){return that.parts().filter(function(part){return!(part instanceof Attachment)})});that.hasInlineParts=ko.pureComputed(function(){return that.inlineParts().length>0});that.attachments=ko.pureComputed(function(){return that.parts().filter(function(part){return part instanceof Attachment})});that.hasAttachments=ko.pureComputed(function(){return that.attachments().length>0});that.shouldDisplayDownloadAllAttachmentsLink=ko.pureComputed(function(){return that.attachments().length>1});that.getDownloadAllAttachmentsUrl=ko.pureComputed(function(){var attachmentsFilename=TR('mail.DefaultAttachmentsFilename','attachments');return that.getMailUrl()+'/zip/'+encodeURIComponent(attachmentsFilename)});that.isLoaded=ko.pureComputed(function(){return that.inlineParts().filter(function(part){return part.isLoaded}).every(function(part){return part.isLoaded()})});that.hasExternalImages=ko.pureComputed(function(){return that.inlineParts().filter(function(part){return part.hasExternalImages}).some(function(part){return part.hasExternalImages()})});that.displaySize=ko.pureComputed(function(){var size=that.size;if(!size){return''}else if(size<1024){return'<1 KB'}else if(size<1048576){return inter.renderFileSize(size)}else{return inter.renderFileSize(size,1)}})}Mail.prototype.loadExternalImages=function(){var textPartsWithExternalImages=this.inlineParts().filter(function(part){return part.hasExternalImages&&part.hasExternalImages()});textPartsWithExternalImages.forEach(function(part){part.loadExternalImages()})};Mail.prototype.setLoadImagesFlag=function(){this.oneComLoadImg(true);this.showLink(true)};Mail.prototype.setDisregardSPFFlag=function(){this.oneComDisregardSPF(true)};Mail.prototype.equals=function(mail){return this.uid===mail.uid};Mail.prototype.isDraft=function(){return this.folder().isDraftFolder()};Mail.prototype.getMailUrl=function(){return'/api/'+encodeURIComponent(this.username)+'/mail/1/'+encodeURIComponent(this.folder().id())+'/'+this.folder().uidvalidity()+'/'+this.uid};Mail.prototype.getImapFlags=function(){var that=this;return Object.keys(Flag).map(function(flagName){return Flag[flagName]}).filter(function(flag){return that[flag.name]()}).map(function(flag){return flag.imap})};Mail.prototype.setFlag=function(flag,value){if(this[flag.name]()!==value){this[flag.name](value);if(flag===Flag.SEEN){this.folder().unseen(this.folder().unseen()+(value?-1:1))}}};Mail.prototype.updateFlags=function(flagData){Object.keys(Flag).forEach(function(flag){var name=Flag[flag].name,imap=Flag[flag].imap;if(flagData&&typeof flagData[imap]!=='undefined'&&flagData[imap]===1){this[name](true)}else{this[name](false)}},this)};Mail.prototype.updateWith=function(data){var that=this;that.uid=data.uid;that.messageId=data.messageId;that.size=data.size||0;that.headers=data.headers||{};that.headers.References=that.headers.References||[];that.inReplyTo=data.inReplyTo;that.date(data.date&&new Date(data.date));that.arrivalDate(new Date(data.arrivalDate));that.replyTo(createRecipients(data.replyTo));that.from(createRecipients(data.from));that.to(createRecipients(data.to));that.cc(createRecipients(data.cc));that.bcc(createRecipients(data.bcc));that.subject(data.subject||'');that.undisclosedRecipients(data.undisclosedRecipients||false);that.parts((data.parts||[]).map(function(part){return MailPartFactory.create(part,that)}));that.updateFlags(data.flags)};Mail.prototype.evict=function(){this.folder().mailCache.evict(this)};return Mail})}());(function(){var define=System.amdDefine;(function(root,factory){if(typeof exports==='object'){module.exports=factory()}else if(typeof define==='function'&&define.amd){define('3rdparty/LocalStorage.js',[],factory)}else{root.LocalStorage=factory()}}(this,function(){function LocalStorage(namespace){this.namespace=namespace}LocalStorage.prototype.isWorking=function(){if(this._isWorking){return true}this.setItem('local-storage-test','local-storage-test');if(this.getItem('local-storage-test')==='local-storage-test'){this._isWorking=true;this.removeItem('local-storage-test')}return this._isWorking};LocalStorage.prototype.createKey=function(key){return this.namespace?this.namespace+' '+key:key};LocalStorage.prototype.setItem=function(key,value){try{localStorage.setItem(this.createKey(key),value)}catch(e){}};LocalStorage.prototype.getItem=function(key){try{return localStorage.getItem(this.createKey(key))}catch(e){return null}};LocalStorage.prototype.removeItem=function(key){try{localStorage.removeItem(this.createKey(key))}catch(e){}};LocalStorage.prototype.hasItem=function(key){try{return localStorage.hasOwnProperty(this.createKey(key))}catch(e){return false}};LocalStorage.prototype.setJSON=function(key,value){this.setItem(key,JSON.stringify(value))};LocalStorage.prototype.getJSON=function(key){try{return JSON.parse(this.getItem(key))}catch(e){return null}};LocalStorage.prototype.subStorage=function(subNamespace){return new LocalStorage(this.namespace+' '+subNamespace)};LocalStorage.prototype.keys=function(){var namespace=this.namespace;try{var allKeys=Object.keys(localStorage);if(namespace){return allKeys.filter(function(key){return namespace===key.substring(0,namespace.length)})}else{return allKeys}}catch(e){return[]}};LocalStorage.prototype.clear=function(){this.keys().forEach(function(key){try{localStorage.removeItem(key)}catch(e){}})};LocalStorage.prototype.toString=function(){return this.keys().toString()};return LocalStorage}))}());(function(){var define=System.amdDefine;define('common/actions/NotifyRecentEmailsAction.js',['node_modules/knockout/build/output/knockout-latest.debug.js','common/util.js','common/ActionBehavior.js','common/model/EmailNotification.js','webmail/model/Mail.js','3rdparty/LocalStorage.js'],function(ko,util,ActionBehavior,EmailNotification,Mail,LocalStorage){function NotifyRecentEmailsAction(options){util.extend(this,util.pick(options,['application']));ActionBehavior.installInto(this)}NotifyRecentEmailsAction.prototype.name='NotifyRecentEmailsAction';NotifyRecentEmailsAction.prototype.execute=function(context,cb){var that=this;var state=context.state;var backend=context.backend;var inbox=state.folders?state.folders.inbox:state.inbox;var headers=[];var localStorage=new LocalStorage(state.user()).subStorage('webmail');var lastKnownModSeq=localStorage.getItem('InboxModSeq');backend.resyncFolder(state.user(),inbox.name(),inbox.uidvalidity(),lastKnownModSeq,headers,function(err,data){if(err){return cb(err)}var newMails=[];Object.keys(data.mails).forEach(function(key){var mailData=data.mails[key];var mail=new Mail(state.user(),inbox,mailData);if(mailData.flags['\\Recent']){newMails.push(mail)}inbox.mailCache.store(mail)});if(newMails.length>0){new EmailNotification({applicationName:that.application,user:state.user(),mails:newMails})}localStorage.setItem('InboxModSeq',data.highestModSeq);cb()})};return NotifyRecentEmailsAction})}());(function(){var define=System.amdDefine;define('common/actions/SavePreferencesAction.js',['node_modules/knockout/build/output/knockout-latest.debug.js','common/util.js','common/ActionBehavior.js'],function(ko,util,ActionBehavior){function SavePreferencesAction(options){util.extend(this,util.pick(options,'page'));ActionBehavior.installInto(this)}SavePreferencesAction.prototype.name='SavePreferencesAction';SavePreferencesAction.prototype.models=function(context){return context.state.preferences};SavePreferencesAction.prototype.execute=function(context,cb){var that=this;var state=context.state;var backend=context.backend;that.setBusyFlags();backend.savePreference(state.user(),that.page,ko.toJS(state.preferences[that.page]),function(err,data){that.removeBusyFlags();if(!err){state.preferences[that.page].peek()._rev=data._rev}cb(err)})};return SavePreferencesAction})}());(function(){var define=System.amdDefine;define('calendar/actions/LoadExternalCalendarsAction.js',['common/util.js','3rdparty/async.js','3rdparty/Failboat.js','calendar/model/Calendar.js','common/ActionBehavior.js','calendar/actions/FormatSanitationAction.js'],function(util,async,Failboat,Calendar,ActionBehavior,FormatSanitationAction){function LoadExternalCalendarsAction(){ActionBehavior.installInto(this)}LoadExternalCalendarsAction.prototype.name='LoadExternalCalendarsAction';LoadExternalCalendarsAction.prototype.execute=function(context,cb){var state=context.state;var backend=context.backend;var calendarPreferences=state.preferences.calendar()||{};var subscribedCalendars=calendarPreferences.subscribedCalendars||[];var loadedCalendars=[];var processedCalendars=0;async.eachLimit(subscribedCalendars,2,function(subscribedCalendar,next){backend.getExternalCalendar(subscribedCalendar.url,function(err,data){if(err){loadedCalendars.push({calendar:subscribedCalendar,error:err});return next()}var sanitationAction=new FormatSanitationAction({calendarData:data});sanitationAction.execute(context,function(err,sanitizedCalendarData){loadedCalendars.push({calendar:subscribedCalendar,error:err,calData:sanitizedCalendarData});next()})})});var errors=[];var refreshInterval=setInterval(function(){if(processedCalendars===subscribedCalendars.length){clearInterval(refreshInterval);if(errors.length>0){var error=new Error('Unable load external calendars');error.errors=errors;Failboat.tag(error,'FAILED_LOADING_EXTERNAL_ERRORS');cb(error)}else{cb()}}else{if(!state.blockRenderingView||!state.blockRenderingView()){state.calendars.version.pause();loadedCalendars.forEach(function(entry){var subscribedCalendar=entry.calendar;if(entry.error){errors.push(util.extend(entry.error,{id:subscribedCalendar.id,name:subscribedCalendar.displayName||subscribedCalendar.url,url:subscribedCalendar.url}))}var calendarData=util.extend({writable:false,extern:true,own:false,failedLoading:!!entry.error},util.pick(subscribedCalendar,'id','color','enabled'));calendarData.name=subscribedCalendar.displayName;calendarData.icalendar={children:[{res:subscribedCalendar.url,etag:'',calData:entry.calData||'BEGIN:VCALENDAR\r\nEND:VCALENDAR'}]};if(!state.calendars.hasCalendar(calendarData.id)){state.calendars.add(new Calendar(calendarData,state.timeZone))}});processedCalendars+=loadedCalendars.length;loadedCalendars=[];state.calendars.version.resume(true)}}},400)};return LoadExternalCalendarsAction})}());(function(){var define=System.amdDefine;define('common/EASAdministrationView.js',['node_modules/knockout/build/output/knockout-latest.debug.js'],function(ko){var PRODUCT_NAME='EAS';function EASAdministrationView(options){this.state=options.state;this.backend=options.backend;this.loading=ko.observable(true);this.failed=ko.observable(false);this.active=ko.observable(false);this.currencyCode=ko.observable();this.currencyFactor=ko.observable();this.price=ko.observable();this.includeVat=ko.observable();this.startTime=ko.observable();this.state.preferences[PRODUCT_NAME]=ko.observable({})}EASAdministrationView.prototype.init=function(callback){var user=this.state.user();this.execute(function(){var preferences=this.state.preferences[PRODUCT_NAME]();this.active(preferences.active);this.currencyCode(preferences.currencyCode);this.currencyFactor(preferences.currencyFactor);this.price(preferences.price);this.includeVat(preferences.includeVat);this.startTime(preferences.startTime);this.active.subscribe(function(active){this.loading(true);if(active){this.backend.activateAddOnProduct(user,PRODUCT_NAME,updatePreferences.bind(this))}else{this.backend.deactivateAddOnProduct(user,PRODUCT_NAME,updatePreferences.bind(this))}},this);typeof callback==='function'&&callback()})};EASAdministrationView.prototype.start=function(){this.active(true)};EASAdministrationView.prototype.loadData=function(){this.loading(false)};EASAdministrationView.prototype.execute=function(callback){var that=this;this.backend.queryAddOnProduct(that.state.user(),PRODUCT_NAME,function(err,data){if(!err){that.state.preferences[PRODUCT_NAME](data)}typeof callback==='function'&&callback.call(that)})};function updatePreferences(err,data){if(err){return}this.currencyCode(data.currencyCode);this.currencyFactor(data.currencyFactor);this.price(data.price);this.includeVat(data.includeVat);this.startTime(data.startTime);this.state.preferences[PRODUCT_NAME](data);this.loading(false)}return EASAdministrationView})}());(function(){var define=System.amdDefine;(function(root,factory){if(typeof exports==='object'){module.exports=factory()}else if(typeof define==='function'&&define.amd){define('3rdparty/passError.js',[],factory)}else{root.passError=factory()}}(this,function(){return function passError(errorCallback,successCallback){if(typeof errorCallback!=='function'||typeof successCallback!=='function'){throw new Error('passError: Two function arguments required')}var called=false;return function(err){if(called){throw new Error('passError: The callback was called again with '+(err?err.stack:'no error'))}called=true;if(err){errorCallback(err)}else{successCallback.apply(this,[].slice.call(arguments,1))}}}}))}());(function(){var define=System.amdDefine;(function(f){if(typeof exports==='object'&&typeof module!=='undefined'){module.exports=f()}else if(typeof define==='function'&&define.amd){define('3rdparty/onecolor/one-color.js',[],f)}else{var g;if(typeof window!=='undefined'){g=window}else if(typeof global!=='undefined'){g=global}else if(typeof self!=='undefined'){g=self}else{g=this}(g.one||(g.one={})).color=f()}}(function(){var define,module,exports;return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=='function'&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error('Cannot find module \''+o+'\'');throw f.code='MODULE_NOT_FOUND',f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=='function'&&require;for(var o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){module.exports=function(t){t.use(require(2)),t.installColorSpace('HSL',['hue','saturation','lightness','alpha'],{hsv:function(){var s,n=2*this._lightness,h=this._saturation*(1>=n?n:2-n);return s=1e-9>n+h?0:2*h/(n+h),new t.HSV(this._hue,s,(n+h)/2,this._alpha)},rgb:function(){return this.hsv().rgb()},fromRgb:function(){return this.hsv().hsl()}})}},{'2':2}],2:[function(require,module,exports){module.exports=function(a){a.installColorSpace('HSV',['hue','saturation','value','alpha'],{rgb:function(){var e,t,s,h=this._hue,i=this._saturation,r=this._value,n=Math.min(5,Math.floor(6*h)),u=6*h-n,c=r*(1-i),l=r*(1-u*i),o=r*(1-(1-u)*i);switch(n){case 0:e=r,t=o,s=c;break;case 1:e=l,t=r,s=c;break;case 2:e=c,t=r,s=o;break;case 3:e=c,t=l,s=r;break;case 4:e=o,t=c,s=r;break;case 5:e=r,t=c,s=l}return new a.RGB(e,t,s,this._alpha)},hsl:function(){var e,t=(2-this._saturation)*this._value,s=this._saturation*this._value,h=1>=t?t:2-t;return e=1e-9>h?0:s/h,new a.HSL(this._hue,e,t/2,this._alpha)},fromRgb:function(){var e,t=this._red,s=this._green,h=this._blue,i=Math.max(t,s,h),r=Math.min(t,s,h),n=i-r,u=0===i?0:n/ i,c=i;if(0===n)e=0;else switch(i){case t:e=(s-h)/n/6+(h>s?1:0);break;case s:e=(h-t)/n/6+1/3;break;case h:e=(t-s)/n/6+2/3}return new a.HSV(e,u,c,this._alpha)}})}},{}],3:[function(require,module,exports){function color(r){if(Array.isArray(r)){if('string'==typeof r[0]&&'function'==typeof color[r[0]])return new color[r[0]](r.slice(1,r.length));if(4===r.length)return new color.RGB(r[0]/255,r[1]/255,r[2]/255,r[3]/255)}else if('string'==typeof r){var o=r.toLowerCase();color.namedColors[o]&&(r='#'+color.namedColors[o]),'transparent'===o&&(r='rgba(0,0,0,0)');var e=r.match(cssColorRegExp);if(e){var t=e[1].toUpperCase(),n=undef(e[8])?e[8]:parseFloat(e[8]),a='H'===t[0],s=e[3]?100:a?360:255,i=e[5]||a?100:255,c=e[7]||a?100:255;if(undef(color[t]))throw new Error('color.'+t+' is not installed.');return new color[t](parseFloat(e[2])/s,parseFloat(e[4])/ i,parseFloat(e[6])/c,n)}r.length<6&&(r=r.replace(/^#?([0-9a-f])([0-9a-f])([0-9a-f])$/i,'$1$1$2$2$3$3'));var l=r.match(/^#?([0-9a-f][0-9a-f])([0-9a-f][0-9a-f])([0-9a-f][0-9a-f])$/i);if(l)return new color.RGB(parseInt(l[1],16)/255,parseInt(l[2],16)/255,parseInt(l[3],16)/255);if(color.CMYK){var u=r.match(new RegExp('^cmyk\\('+percentageChannelRegExp.source+','+percentageChannelRegExp.source+','+percentageChannelRegExp.source+','+percentageChannelRegExp.source+'\\)$','i'));if(u)return new color.CMYK(parseFloat(u[1])/100,parseFloat(u[2])/100,parseFloat(u[3])/100,parseFloat(u[4])/100)}}else if('object'==typeof r&&r.isColor)return r;return!1}var installedColorSpaces=[],undef=function(r){return'undefined'==typeof r},channelRegExp=/\s*(\.\d+|\d+(?:\.\d+)?)(%)?\s*/,percentageChannelRegExp=/\s*(\.\d+|100|\d?\d(?:\.\d+)?)%\s*/,alphaChannelRegExp=/\s*(\.\d+|\d+(?:\.\d+)?)\s*/,cssColorRegExp=new RegExp('^(rgb|hsl|hsv)a?\\('+channelRegExp.source+','+channelRegExp.source+','+channelRegExp.source+'(?:,'+alphaChannelRegExp.source+')?\\)$','i');color.namedColors={},color.installColorSpace=function(r,o,e){function t(r,o){var e={};e[o.toLowerCase()]=function(){return this.rgb()[o.toLowerCase()]()},color[o].propertyNames.forEach(function(r){var t='black'===r?'k':r.charAt(0);e[r]=e[t]=function(e,t){return this[o.toLowerCase()]()[r](e,t)}});for(var t in e)e.hasOwnProperty(t)&&void 0===color[r].prototype[t]&&(color[r].prototype[t]=e[t])}color[r]=function(e){var t=Array.isArray(e)?e:arguments;o.forEach(function(e,n){var a=t[n];if('alpha'===e)this._alpha=isNaN(a)||a>1?1:0>a?0:a;else{if(isNaN(a))throw new Error('['+r+']: Invalid color: ('+o.join(',')+')');'hue'===e?this._hue=0>a?a-Math.floor(a):a%1:this['_'+e]=0>a?0:a>1?1:a}},this)},color[r].propertyNames=o;var n=color[r].prototype;['valueOf','hex','hexa','css','cssa'].forEach(function(o){n[o]=n[o]||('RGB'===r?n.hex:function(){return this.rgb()[o]()})}),n.isColor=!0,n.equals=function(e,t){undef(t)&&(t=1e-10),e=e[r.toLowerCase()]();for(var n=0;n<o.length;n+=1)if(Math.abs(this['_'+o[n]]-e['_'+o[n]])>t)return!1;return!0},n.toJSON=function(){return[r].concat(o.map(function(r){return this['_'+r]},this))};for(var a in e)if(e.hasOwnProperty(a)){var s=a.match(/^from(.*)$/);s?color[s[1].toUpperCase()].prototype[r.toLowerCase()]=e[a]:n[a]=e[a]}return n[r.toLowerCase()]=function(){return this},n.toString=function(){return'['+r+' '+o.map(function(r){return this['_'+r]}).join(', ')+']'},o.forEach(function(r){var e='black'===r?'k':r.charAt(0);n[r]=n[e]=function(e,t){return'undefined'==typeof e?this['_'+r]:t?new this.constructor(o.map(function(o){return this['_'+o]+(r===o?e:0)},this)):new this.constructor(o.map(function(o){return r===o?e:this['_'+o]},this))}}),installedColorSpaces.forEach(function(o){t(r,o),t(o,r)}),installedColorSpaces.push(r),color},color.pluginList=[],color.use=function(r){return-1===color.pluginList.indexOf(r)&&(this.pluginList.push(r),r(color)),color},color.installMethod=function(r,o){return installedColorSpaces.forEach(function(e){color[e].prototype[r]=o}),this},color.installColorSpace('RGB',['red','green','blue','alpha'],{hex:function(){var r=(65536*Math.round(255*this._red)+256*Math.round(255*this._green)+Math.round(255*this._blue)).toString(16);return'#'+'00000'.substr(0,6-r.length)+r},hexa:function(){var r=Math.round(255*this._alpha).toString(16);return'#'+'00'.substr(0,2-r.length)+r+this.hex().substr(1,6)},css:function(){return'rgb('+Math.round(255*this._red)+','+Math.round(255*this._green)+','+Math.round(255*this._blue)+')'},cssa:function(){return'rgba('+Math.round(255*this._red)+','+Math.round(255*this._green)+','+Math.round(255*this._blue)+','+this._alpha+')'}}),module.exports=color},{}],4:[function(require,module,exports){module.exports=require(3).use(require(2)).use(require(1))},{'1':1,'2':2,'3':3}]},{},[4])(4)}))}());(function(){var define=System.amdDefine;define('calendar/Colors.js',['node_modules/knockout/build/output/knockout-latest.debug.js','3rdparty/onecolor/one-color.js'],function(ko,oneColor){function Colors(colorObservable){return{backgroundColor:ko.computed(function(){return oneColor(colorObservable()).lightness(0.9).saturation(0.6).hex()}),boxTextColor:ko.computed(function(){return oneColor(colorObservable()).lightness(0.2).saturation(0.6).hex()}),borderColor:ko.computed(function(){return oneColor(colorObservable()).lightness(0.8).saturation(0.6).hex()}),darkBackgroundColor:ko.computed(function(){return oneColor(colorObservable()).lightness(0.6).saturation(0.6).hex()})}}var colorChoices=['#B50000','#B54B00','#B59700','#88B500','#3CB500','#00B50F','#00B55B','#00B5A6','#0079B5','#002DB5','#1E00B5','#6A00B5','#B500B5','#B5006A'];return{createColors:function(colorObservable){return new Colors(colorObservable)},colorChoices:colorChoices.slice(),defaultColor:colorChoices.slice()[0],nextColor:function(calendars){var colorsCount={};for(var i=0;i<colorChoices.length;i++){colorsCount[colorChoices[i]]=calendars.filter(function(calendar){return calendar.color()===colorChoices[i]}).length}var minCount=Number.MAX_VALUE;Object.keys(colorsCount).forEach(function(color){if(colorsCount[color]<minCount){minCount=colorsCount[color]}});return Object.keys(colorsCount).filter(function(color){return minCount===colorsCount[color]})[0]},validateColor:function(color){var colorPattern=/^#([0-9a-f]{3}|[0-9a-f]{6})$/i;if(color){return colorPattern.test(color)}return false},sanitizeColor:function(color){if(color){if(this.validateColor(color)){return color}var trimmed=color.substr(0,7);if(this.validateColor(trimmed)){return trimmed}}return null}}})}());(function(){var define=System.amdDefine;define('calendar/fixUpJcal.js',[],function(){function hash(str){var hash=0,i,chr,len;if(str.length===0){return hash}for(i=0,len=str.length;i<len;i++){chr=str.charCodeAt(i);hash=(hash<<5)-hash+chr;hash|=0}return hash}return function fixUpJcal(jCal){var remappedTzidByTzid={};(function traverse(jCal){if(jCal[0]==='vtimezone'){var tzid=jCal[1]&&jCal[1][0][0]==='tzid'&&jCal[1][0][3];if(tzid==='EAS-GENERATED-TIMEZONE'){remappedTzidByTzid[tzid]=jCal[1][0][3]=tzid+'-'+hash(JSON.stringify(jCal))}}jCal[1].forEach(function(property){if(property[0]==='dtstart'||property[0]==='dtend'||property[0]==='exdate'||property[0]==='rdate'||property[0]==='recurrence-id'){if(!property[1].value&&property[2]==='date-time'&&/T::$/.test(property[3])){property[2]='date';property[3]=property[3].replace(/T::$/,'')}var tzid=property[1].tzid;if(tzid&&remappedTzidByTzid[tzid]){property[1].tzid=remappedTzidByTzid[tzid]}}});jCal[2].forEach(traverse)}(jCal));return jCal}})}());(function(){var define=System.amdDefine;define('calendar/model/SharedLinks.js',['node_modules/knockout/build/output/knockout-latest.debug.js','common/util.js'],function(ko,util){function SharedLinks(){var that=this;that.byId=ko.observable({});that.version=ko.computed(function(){return Object.keys(that.byId()).map(function(key){return key+that.get(key).version()}).join(',')}).extend({pause:false})}SharedLinks.prototype.has=function(id){return id in this.byId.peek()};SharedLinks.prototype.add=function(sharedLink){var byId=this.byId.peek();byId[sharedLink.id]=sharedLink;this.byId(byId)};SharedLinks.prototype.get=function(id){return this.byId.peek()[id]};SharedLinks.prototype.remove=function(id){var byId=this.byId.peek();delete byId[id];this.byId(byId)};SharedLinks.prototype.all=function(){var that=this;return Object.keys(that.byId.peek()).map(function(key){return that.get(key)})};return SharedLinks})}());(function(){var define=System.amdDefine;(function(root,factory){if(typeof exports==='object'){module.exports=factory()}else if(typeof define==='function'&&define.amd){define('3rdparty/url-template.js',[],factory)}else{root.urltemplate=factory()}}(this,function(){function UrlTemplate(){}UrlTemplate.prototype.encodeReserved=function(str){return str.split(/(%[0-9A-Fa-f]{2})/g).map(function(part){if(!/%[0-9A-Fa-f]/.test(part)){part=encodeURI(part)}return part}).join('')};UrlTemplate.prototype.encodeValue=function(operator,value,key){value=operator==='+'||operator==='#'?this.encodeReserved(value):encodeURIComponent(value);if(key){return encodeURIComponent(key)+'='+value}else{return value}};UrlTemplate.prototype.isDefined=function(value){return value!==undefined&&value!==null};UrlTemplate.prototype.isKeyOperator=function(operator){return operator===';'||operator==='&'||operator==='?'};UrlTemplate.prototype.getValues=function(context,operator,key,modifier){var value=context[key],result=[];if(this.isDefined(value)&&value!==''){if(typeof value==='string'||typeof value==='number'||typeof value==='boolean'){value=value.toString();if(modifier&&modifier!=='*'){value=value.substring(0,parseInt(modifier,10))}result.push(this.encodeValue(operator,value,this.isKeyOperator(operator)?key:null))}else{if(modifier==='*'){if(Array.isArray(value)){value.filter(this.isDefined).forEach(function(value){result.push(this.encodeValue(operator,value,this.isKeyOperator(operator)?key:null))},this)}else{Object.keys(value).forEach(function(k){if(this.isDefined(value[k])){result.push(this.encodeValue(operator,value[k],k))}},this)}}else{var tmp=[];if(Array.isArray(value)){value.filter(this.isDefined).forEach(function(value){tmp.push(this.encodeValue(operator,value))},this)}else{Object.keys(value).forEach(function(k){if(this.isDefined(value[k])){tmp.push(encodeURIComponent(k));tmp.push(this.encodeValue(operator,value[k].toString()))}},this)}if(this.isKeyOperator(operator)){result.push(encodeURIComponent(key)+'='+tmp.join(','))}else if(tmp.length!==0){result.push(tmp.join(','))}}}}else{if(operator===';'){result.push(encodeURIComponent(key))}else if(value===''&&(operator==='&'||operator==='?')){result.push(encodeURIComponent(key)+'=')}else if(value===''){result.push('')}}return result};UrlTemplate.prototype.parse=function(template){var that=this;var operators=['+','#','.','/',';','?','&'];return{expand:function(context){return template.replace(/\{([^\{\}]+)\}|([^\{\}]+)/g,function(_,expression,literal){if(expression){var operator=null,values=[];if(operators.indexOf(expression.charAt(0))!==-1){operator=expression.charAt(0);expression=expression.substr(1)}expression.split(/,/g).forEach(function(variable){var tmp=/([^:\*]*)(?::(\d+)|(\*))?/.exec(variable);values.push.apply(values,that.getValues(context,operator,tmp[1],tmp[2]||tmp[3]))});if(operator&&operator!=='+'){var separator=',';if(operator==='?'){separator='&'}else if(operator!=='#'){separator=operator}return(values.length!==0?operator:'')+values.join(separator)}else{return values.join(',')}}else{return that.encodeReserved(literal)}})}}};return new UrlTemplate}))}());(function(){var define=System.amdDefine;define('calendar/model/Calendar.js',['node_modules/knockout/build/output/knockout-latest.debug.js','common/util.js','3rdparty/insection.js','calendar/model/EventInstance.js','calendar/ical/parser.js','calendar/ical/TimeZone.js','calendar/ical/TimeZoneService.js','calendar/ical/Event.js','calendar/ical/Component.js','calendar/ical/Duration.js','calendar/Colors.js','calendar/fixUpJcal.js','calendar/model/SharedLinks.js','3rdparty/url-template.js'],function(ko,util,insection,EventInstance,icalParser,TimeZone,TimeZoneService,Event,Component,Duration,Colors,fixUpJcal,SharedLinks,urlTemplate){function eventsFromVCalendar(vcalendar,settingsTimeZone){var events={};settingsTimeZone=ko.isObservable(settingsTimeZone)?settingsTimeZone():settingsTimeZone;var vTimeZones=vcalendar.getAllSubcomponents('vtimezone');var timeZones=vTimeZones&&vTimeZones.map(function(vTimeZone){return TimeZone.fromData(vTimeZone)});if(timeZones.length){timeZones.forEach(function(timeZone){if(timeZone.tzid&&!TimeZoneService.has(timeZone.tzid)){TimeZoneService.register(timeZone.tzid,timeZone)}})}function getTimezone(tzid){var tz;timeZones.some(function(timeZone){var isCorrectTimeZone=timeZone.toString()===tzid;if(isCorrectTimeZone){tz=timeZone}return isCorrectTimeZone});return tz}var defaultTimezone=settingsTimeZone;vcalendar.getAllSubcomponents('vevent').forEach(function(eventData){var event=new Event(eventData);var embeddedTimeZone=getTimezone(event.startDate.timezone);var eventTimeZone=embeddedTimeZone||defaultTimezone;if(eventTimeZone&&event.startDate.zone.equal(TimeZone.localTimeZone)&&!event.startDate.isDate){event.startDate=event.startDate.convertToZone(eventTimeZone)}if(eventTimeZone&&event.endDate.zone.equal(TimeZone.localTimeZone)&&!event.endDate.isDate){event.endDate=event.endDate.convertToZone(eventTimeZone)}if(event.isRecurrenceException()){if(events[event.uid]){events[event.uid].relateException(event)}}else{events[event.uid]=event}});return Object.keys(events).map(function(uid){return events[uid]})}function eventsFromResource(icalEntry,timeZone){var icsData=fixUpJcal(icalParser(icalEntry.calData));var vcalendar=new Component(icsData);vcalendar.resource={id:icalEntry.res,etag:icalEntry.etag};return eventsFromVCalendar(vcalendar,timeZone)}function eventsFromResources(resources,timeZone){var events=[];resources.forEach(function(icalEntry){eventsFromResource(icalEntry,timeZone).forEach(function(event){if(event.startDate&&event.endDate&&event.startDate.isDate&&event.startDate.compare(event.endDate)===0){event.endDate.adjust(1)}if(!event.isRecurring()&&event.startDate.compare(event.endDate)>0&&event.endDate.zone===event.startDate.zone){var startDate=event.startDate;var endDate=event.endDate;event.startDate=endDate.clone();event.endDate=startDate.clone()}events.push(event)})});return events}function eventsFromCalendarData(data,timeZone){return eventsFromResources(data.icalendar&&data.icalendar.children||[],timeZone)}function Calendar(data,timeZone){var that=this;util.extend(this,util.pick(data,'ctag','own','writable','extern','id'));that.timeZone=ko.isObservable(timeZone)?timeZone:ko.observable(timeZone||TimeZone.utcTimeZone);that.name=ko.observable(data.name);that.defaultCalendar=ko.observable(!!data.default);that.color=ko.observable(Colors.sanitizeColor(data.color)||Colors.defaultColor);that.sharedLinks=new SharedLinks;that.sharedLinksLoaded=ko.observable(false);that.failedLoading=ko.observable(!!data.failedLoading);var colors=Colors.createColors(that.color);util.extend(this,util.pick(colors,'backgroundColor','boxTextColor','borderColor','darkBackgroundColor'));that.version=ko.observable(0);that.enabled=ko.observable(!!data.enabled);that.eventInstances=insection(function(a,b){if(a.details.uid<b.details.uid){return-1}if(a.details.uid>b.details.uid){return 1}if(!a.details.recurrenceId&&b.details.recurrenceId){return 1}else if(a.details.recurrenceId&&!b.details.recurrenceId){return-1}else if(a.details.recurrenceId&&b.details.recurrenceId){return a.details.recurrenceId.compare(b.details.recurrenceId)}return 0});that.events={};eventsFromCalendarData(data,timeZone).forEach(function(event){that.addEvent(event);event.calendar=that})}Calendar.prototype.addEvent=function(event){event.calendar=this;this.events[event.uid]=event};Calendar.prototype.update=function(start,end,data){var that=this;util.extend(this,util.pick(data,'ctag','own','writable','extern'));that.name(data.name);that.defaultCalendar(!!data.default);that.color(Colors.sanitizeColor(data.color)||Colors.defaultColor);that.enabled(!!data.enabled);var localResourceIndex=util.uniqueIndexBy(Object.keys(that.events).map(function(uid){return that.events[uid].component.parent.resource}),function(resource){return resource.id});var updatedResources=(data.icalendar&&data.icalendar.children||[]).filter(function(resource){return!localResourceIndex[resource.res]||localResourceIndex[resource.res].etag!==resource.etag});var remoteEvents=util.uniqueIndexBy(eventsFromResources(updatedResources),function(event){return event.uid});var localEvents=util.uniqueIndexBy(that.getEventInstances(start,end),function(eventInstance){return eventInstance.details.uid});var uidsForAdding=Object.keys(remoteEvents).filter(function(uid){return!localEvents[uid]});var uidsForUpdate=Object.keys(localEvents).filter(function(uid){var remoteEvent=remoteEvents[uid];if(!remoteEvent){return false}var localEventResource=localEvents[uid].event.component.parent.resource;var remoteEventResource=remoteEvent.component.parent.resource;return localEventResource.id!==remoteEventResource.id||localEventResource.etag!==remoteEventResource.etag});var remoteResourceIndex=util.uniqueIndexBy(data.icalendar&&data.icalendar.children||[],function(resource){return resource.res});var uidsForRemoval=Object.keys(localEvents).filter(function(uid){return!remoteResourceIndex[that.events[uid].component.parent.resource.id]});Object.keys(remoteEvents).forEach(function(uid){that.events[uid]=remoteEvents[uid];that.events[uid].calendar=that});if(uidsForUpdate.length+uidsForRemoval.length>0){that.removeEventInstanceByEventUids(uidsForUpdate.concat(uidsForRemoval))}uidsForRemoval.forEach(function(uid){delete that.events[uid]});if(uidsForAdding.length+uidsForUpdate.length+uidsForRemoval.length>0){that.version(that.version()+1)}};function getExpansionEndDate(event,until){var result=until;Object.keys(event.exceptions).forEach(function(key){var exception=event.exceptions[key];var startDate=exception.startDate;if(startDate.compare(until)<=0){var recurrenceId=exception.recurrenceId;if(until.compare(recurrenceId)<=0&&result.compare(recurrenceId)<0){result=recurrenceId}}});return result}Calendar.prototype.toUnixTime=function(date){var that=this;if(date.isDate){date=date.convertToZone(that.timeZone())}return date.toUnixTime()};Calendar.prototype.resourceUrl=function(email){var template=urlTemplate.parse('https://caldav.one.com/calendars/users/{email}/{calendarId}/');return template.expand({calendarId:this.id,email:email}).replace('%40','@')};Calendar.prototype.removeEventInstanceByEventUids=function(uids){if(!Array.isArray(uids)){uids=[uids]}var that=this;uids.forEach(function(uid){var event=that.events[uid];event.expantionIterator=null});var uidRemoveIndex=util.uniqueIndexBy(uids);that.eventInstances.getEntries().filter(function(entry){return uidRemoveIndex[entry.value.event.uid]}).forEach(function(entry){that.eventInstances.remove(entry.interval,entry.value)})};Calendar.prototype.removeEventInstanceByEvents=function(events){if(!Array.isArray(events)){events=[events]}this.removeEventInstanceByEventUids(events.map(function(event){return event.uid}))};Calendar.prototype.removeEventInstances=function(eventInstances){var that=this;if(!Array.isArray(eventInstances)){eventInstances=[eventInstances]}eventInstances.forEach(function(eventInstance){var event=eventInstance.event;event.expantionIterator=null;var start=eventInstance.startDate;var end=eventInstance.endDate;that.eventInstances.remove(that.toUnixTime(start),that.toUnixTime(end),eventInstance)})};Calendar.prototype.expandEventTo=function(event,until){var iterator=event.expantionIterator;if(!iterator){iterator=event.iterator();iterator.next();iterator.count=0}else if(iterator.complete){return}var that=this;var expansionEndDate=getExpansionEndDate(event,until);if(iterator.last.compare(expansionEndDate)>0){return}var first=!event.expantionIterator;var next;do{var occurrenceDetails=event.getOccurrenceDetails(iterator.last);var eventInstance=new EventInstance(occurrenceDetails);eventInstance.details=occurrenceDetails.item||event;eventInstance.event=event;eventInstance.state={hidden:ko.observable(false)};eventInstance.count=iterator.count;var start=that.toUnixTime(eventInstance.startDate);var end=that.toUnixTime(eventInstance.endDate);end=Math.max(start,end);that.eventInstances.add(start,end,eventInstance);next=iterator.next();iterator.count+=1;eventInstance.last=!next;eventInstance.first=first;first=false}while(next&&iterator.last.compare(expansionEndDate)<=0);event.expantionIterator=iterator};Calendar.prototype.expandTo=function(until){var that=this;if(that.enabled()){Object.keys(that.events).forEach(function(uid){that.expandEventTo(that.events[uid],until)})}};Calendar.prototype.getEventInstances=function(startDate,endDate){var that=this;var utcEndDate=endDate.convertToZone(TimeZone.utcTimeZone);this.expandTo(utcEndDate);return this.eventInstances.get('(',that.toUnixTime(startDate),that.toUnixTime(utcEndDate),')')};Calendar.prototype.hasEventInstances=function(startDate,endDate){var that=this;var utcEndDate=endDate.convertToZone(TimeZone.utcTimeZone);this.expandTo(utcEndDate);return this.eventInstances.forEachEntry('(',that.toUnixTime(startDate),that.toUnixTime(utcEndDate),')',function(entry){return true})||false};return Calendar})}());(function(){var define=System.amdDefine;!function(e){if('object'==typeof exports&&'undefined'!=typeof module)module.exports=e();else if('function'==typeof define&&define.amd)define('3rdparty/insection.js',[],e);else{var o;'undefined'!=typeof window?o=window:'undefined'!=typeof global?o=global:'undefined'!=typeof self&&(o=self);var n=o;n=n.com||(n.com={}),n=n.one||(n.one={}),n.insection=e()}}(function(){var define,module,exports;return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=='function'&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error('Cannot find module \''+o+'\'');throw f.code='MODULE_NOT_FOUND',f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=='function'&&require;for(var o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){var InvalidIntervalError=require(3);var Interval=require(2);var RedBlackTree=require(4);function augmenter(value,x,y){var interval=value.interval;if(!x&&!y){return interval}var minStart=interval;var maxEnd=interval;if(x&&(x.start<minStart.start||x.start===minStart.start&&minStart.isStartOpen())){minStart=x}if(x&&(x.end>maxEnd.end||x.end===maxEnd.end&&maxEnd.isEndOpen())){maxEnd=x}if(y&&(y.end>maxEnd.end||y.end===maxEnd.end&&maxEnd.isEndOpen())){maxEnd=y}return Interval.create(minStart.startString,minStart.start,maxEnd.end,maxEnd.endString)}function defaultValueComparer(x,y){if(x<y){return-1}if(x>y){return 1}return 0}function intervalComparer(x,y){if(x.start<y.start){return-1}if(x.start>y.start){return 1}if(x.end<y.end){return-1}if(x.end>y.end){return 1}if(!x.isStartOpen()&&y.isStartOpen()){return-1}if(x.isStartOpen()&&!y.isStartOpen()){return 1}if(!x.isEndOpen()&&y.isEndOpen()){return-1}if(x.isEndOpen()&&!y.isEndOpen()){return 1}return 0}function Insection(valueComparer){if(!(this instanceof Insection)){return new Insection(valueComparer)}valueComparer=valueComparer||defaultValueComparer;this.data=new RedBlackTree(function(x,y){var c=intervalComparer(x.interval,y.interval);if(c!==0){return c}return valueComparer(x.value,y.value)},augmenter)}Insection.interval=function(startString,start,end,endString){if(arguments.length===1){if(arguments[0]instanceof Interval){return arguments[0]}return Insection.interval('[',arguments[0],arguments[0],']')}if(arguments.length===2){return Insection.interval('[',arguments[0],arguments[1],']')}return Interval.create(startString,start,end,endString)};Insection.prototype.interval=function(){return Insection.interval.apply(null,arguments)};Insection.prototype.isEmpty=function(){return this.data.isEmpty()};Insection.prototype.add=function(){var data=this.data;var intervalArgs=Array.prototype.slice.call(arguments,0,-1);var interval=Insection.interval.apply(null,intervalArgs);var value=arguments[arguments.length-1];data.add({interval:interval,value:value});return this};Insection.prototype.remove=function(){var data=this.data;var intervalArgs=Array.prototype.slice.call(arguments,0,-1);var interval=Insection.interval.apply(null,intervalArgs);var value=arguments[arguments.length-1];data.remove({interval:interval,value:value});return this};Insection.prototype.contains=function(){var interval=Insection.interval.apply(null,arguments);if(this.data.isEmpty()){return false}if(!interval.intersect(this.data.root.hierarchicalData)){return false}return this.data.find(function(value){return intervalComparer(interval,value.interval)})!==null};Insection.prototype.forEachEntry=function(){var intervalArgs=Array.prototype.slice.call(arguments,0,-1);var callback=arguments[arguments.length-1];var interval=intervalArgs.length===0?{intersect:function(){return true}}:Insection.interval.apply(null,intervalArgs);var root=this.data.root;var queue=[];if(root){queue.push(root)}while(queue.length){var node=queue.pop();if(interval.intersect(node.value.interval)){var result=callback.call(null,node.value);if(typeof result!=='undefined'){return result}}var left=node.left;if(left&&interval.intersect(left.hierarchicalData)){queue.push(left)}var right=node.right;if(right&&interval.intersect(right.hierarchicalData)){queue.push(right)}}};Insection.prototype.getEntries=function(){var result=[];var args=Array.prototype.slice.call(arguments);args.push(function(value){result.push(value)});this.forEachEntry.apply(this,args);return result};Insection.prototype.get=function(){return this.getEntries.apply(this,arguments).map(function(entry){return entry.value})};Insection.prototype.getIntervals=function(){return this.getEntries.apply(this,arguments).map(function(entry){return entry.interval})};function pointsOrder(a,b){if(a.point<b.point){return-1}if(a.point>b.point){return 1}if(!a.isOpen&&!b.isOpen){if(a.isStart&&b.isEnd){return-1}if(a.isEnd&&b.isStart){return 1}}else{if(a.isStart&&b.isEnd){return 1}if(a.isEnd&&b.isStart){return-1}}if(a.isStart){if(a.isOpen&&!b.isOpen){return 1}if(!a.isOpen&&b.isOpen){return-1}}else{if(a.isOpen&&!b.isOpen){return-1}if(!a.isOpen&&b.isOpen){return 1}}return 0}function unique(points){return points.reduce(function(result,point){if(result.length===0||pointsOrder(result[result.length-1],point)!==0){result.push(point)}return result},[])}Insection.prototype.getIntersection=function(){if(arguments.length===0){return this.getIntervals()}var queryInterval=Insection.interval.apply(null,arguments);return this.getIntervals(queryInterval).map(function(interval){return queryInterval.getIntersection(interval)})};function isInfinite(value){return value===Infinity||value===-Infinity}Insection.prototype.getGaps=function(){var queryInterval=Insection.interval.apply(null,arguments);var intervals=new Insection;var points=[{point:queryInterval.start,isStart:true,isOpen:queryInterval.isStartOpen()},{point:queryInterval.end,isEnd:true,isOpen:queryInterval.isEndOpen()}];this.getIntersection(queryInterval).forEach(function(interval){points.push({point:interval.start,isEnd:true,isOpen:!interval.isStartOpen()});points.push({point:interval.end,isStart:true,isOpen:!interval.isEndOpen()});intervals.add(interval,interval)});points=unique(points.sort(pointsOrder));points=points.filter(function(point){if(point.point===-Infinity||point.point===Infinity){return true}var expectedNumberOfIntervals=point.isOpen?1:0;var i=0;var foundMoreThanExpectedIntersections=intervals.forEachEntry(point.point,function(entry){if(expectedNumberOfIntervals===i){return true}i+=1});return!foundMoreThanExpectedIntersections});var lastStart;var result=[];points.forEach(function(endPoint){if(endPoint.isStart){lastStart=endPoint}else if(lastStart){if(lastStart.point!==endPoint.point||!isInfinite(lastStart.point)&&(!lastStart.isOpen||!endPoint.isOpen)){result.push(Insection.interval(lastStart.isOpen?'(':'[',lastStart.point,endPoint.point,endPoint.isOpen?')':']'))}lastStart=null}});return result};module.exports=Insection},{}],2:[function(require,module,exports){var InvalidIntervalError=require(3);function isFinite(value){return value!==Infinity&&value!==-Infinity}function Interval(start,end){this.start=start;this.end=end}var intervalEndRequirements={'[]':function(start,end){return isFinite(start)&&isFinite(end)},'(]':function(start,end){return isFinite(end)},'[)':function(start,end){return isFinite(start)},'()':function(start,end){return true}};function ensureValidInterval(startString,start,end,endString){var startType=typeof start;var endType=typeof end;if(startType!==endType||startType!=='number'&&startType!=='string'||start>end){throw new InvalidIntervalError(startString,start,end,endString)}var intervalEndRequirement=intervalEndRequirements[startString+endString];if(!intervalEndRequirement||!intervalEndRequirement(start,end)){throw new InvalidIntervalError(startString,start,end,endString)}}Interval.create=function(startString,start,end,endString){ensureValidInterval(startString,start,end,endString);switch(startString+endString){case'[]':return new ClosedClosedInterval(start,end);case'[)':return new ClosedOpenInterval(start,end);case'(]':return new OpenClosedInterval(start,end);case'()':return new OpenOpenInterval(start,end)}};function endPointToInt(text){if(text==='Infinity'){return Infinity}else if(text==='-Infinity'){return-Infinity}else if(text.match(/^-?\d+$/)){return parseInt(text,10)}else{return text}}Interval.fromString=function(text){var m=text.match(/^([\[\(])([^;]+);\s?([^\]\)]+)([\]\)])$/);if(m){var start=endPointToInt(m[2]);var end=endPointToInt(m[3]);return Interval.create(m[1],start,end,m[4])}else{throw new Error('Could not parse "'+text+'" as an interval')}};Interval.prototype.toString=function(detailed){return detailed?'Insection.interval(\''+this.startString+'\','+this.start+','+this.end+',\''+this.endString+'\')':this.startString+this.start+';'+this.end+this.endString};Interval.prototype.intersect=function(other){return!(this.end<other.start||this.start>other.end||this.end===other.start&&(this.isEndOpen()||other.isStartOpen())||this.start===other.end&&(this.isStartOpen()||other.isEndOpen()))};Interval.prototype.getIntersection=function(other){var startPoint=this.start>other.start?this:other;var endPoint=this.end<other.end?this:other;if(this.start===other.start){startPoint=this.isStartOpen()?this:other}if(this.end===other.end){endPoint=this.isEndOpen()?this:other}return Interval.create(startPoint.isStartOpen()?'(':'[',startPoint.start,endPoint.end,endPoint.isEndOpen()?')':']')};function OpenOpenInterval(start,end){Interval.call(this,start,end);this.startString='(';this.endString=')'}OpenOpenInterval.prototype=Object.create(Interval.prototype);OpenOpenInterval.prototype.isStartOpen=function(){return true};OpenOpenInterval.prototype.isEndOpen=function(){return true};function OpenClosedInterval(start,end){Interval.call(this,start,end);this.startString='(';this.endString=']'}OpenClosedInterval.prototype=Object.create(Interval.prototype);OpenClosedInterval.prototype.isStartOpen=function(){return true};OpenClosedInterval.prototype.isEndOpen=function(){return false};function ClosedOpenInterval(start,end){Interval.call(this,start,end);this.startString='[';this.endString=')'}ClosedOpenInterval.prototype=Object.create(Interval.prototype);ClosedOpenInterval.prototype.isStartOpen=function(){return false};ClosedOpenInterval.prototype.isEndOpen=function(){return true};function ClosedClosedInterval(start,end){Interval.call(this,start,end);this.startString='[';this.endString=']'}ClosedClosedInterval.prototype=Object.create(Interval.prototype);ClosedClosedInterval.prototype.isStartOpen=function(){return false};ClosedClosedInterval.prototype.isEndOpen=function(){return false};module.exports=Interval},{}],3:[function(require,module,exports){function InvalidIntervalError(startString,start,end,endString){var argsString=[startString,start,end,endString].join(', ');var error=Error.call(this,'Insection.interval was called with '+argsString+' valid signatures are:\n'+'Insection.interval(start,end)\n'+'Insection.interval("[",start,end,"]")\n'+'Insection.interval("[",start,end,")")\n'+'Insection.interval("(",start,end,"]")\n'+'Insection.interval("(",start,end,")")\n'+'where start <= end.');this.name='InvalidIntervalError';this.message=error.message;this.stack=error.stack}InvalidIntervalError.prototype=Object.create(Error.prototype);module.exports=InvalidIntervalError},{}],4:[function(require,module,exports){function nodeColor(node){return node===null?BLACK:node.color}var BLACK='black';var RED='red';function Node(value){this.value=value;this.color=RED;this.left=null;this.right=null;this.parent=null}Node.prototype.grandparent=function(){if(this.parent===null){return null}return this.parent.parent};Node.prototype.sibling=function(){if(this.parent===null){return null}return this===this.parent.left?this.parent.right:this.parent.left};Node.prototype.uncle=function(){if(this.parent===null){return null}return this.parent.sibling()};function RedBlackTree(comparefn,augmenterfn){this.root=null;this.comparefn=comparefn;this.augmenterfn=augmenterfn;this.balancer=new Balancer(this)}RedBlackTree.prototype.augmentNode=function(node){node.hierarchicalData=this.augmenterfn(node.value,node.left&&node.left.hierarchicalData,node.right&&node.right.hierarchicalData)};RedBlackTree.prototype.augmentAncestors=function(node){node=node&&node.parent;while(node){this.augmentNode(node);node=node.parent}};RedBlackTree.prototype.augmentNodeAndAncestors=function(node){if(node){this.augmentNode(node);this.augmentAncestors(node)}};RedBlackTree.prototype.isEmpty=function(){return this.root===null};RedBlackTree.prototype.add=function(value){var newNode=new Node(value);if(this.isEmpty()){this.root=newNode}else{var node=this.root;while(true){var c=this.comparefn(value,node.value);if(c<0){if(node.left===null){node.left=newNode;break}else{node=node.left}}else if(0<c){if(node.right===null){node.right=newNode;break}else{node=node.right}}else{node.value=value;return}}newNode.parent=node}this.augmentNodeAndAncestors(newNode);this.balancer.inserted(newNode)};RedBlackTree.prototype.findNode=function(navigator){var node=this.root;while(node!==null){var c=navigator(node);if(c<0){node=node.left}else if(0<c){node=node.right}else{return node}}return null};RedBlackTree.prototype.find=function(navigator){var node=this.findNode(function(node){return navigator(node.value)});return node&&node.value};RedBlackTree.prototype.remove=function(value){var comparefn=this.comparefn;var node=this.findNode(function(node){return comparefn(value,node.value)});if(node===null){return}if(node.left!==null&&node.right!==null){var pred=node.left;while(pred.right!==null){pred=pred.right}node.value=pred.value;node=pred}this.augmentNodeAndAncestors(node);var child=node.right===null?node.left:node.right;if(nodeColor(node)===BLACK){node.color=nodeColor(child);this.balancer.deleted(node)}this.balancer.replaceNode(node,child);this.augmentNodeAndAncestors(child);if(nodeColor(this.root)===RED){this.root.color=BLACK}};function Balancer(tree){this.tree=tree}Balancer.prototype.inserted=function(node){this.insertCase1(node)};Balancer.prototype.deleted=function(node){this.deleteCase1(node)};Balancer.prototype.replaceNode=function(original,replacement){if(original.parent===null){this.tree.root=replacement}else{if(original===original.parent.left){original.parent.left=replacement}else{original.parent.right=replacement}}if(replacement!==null){replacement.parent=original.parent}};Balancer.prototype.rotateLeft=function(node){var right=node.right;this.replaceNode(node,right);node.right=right.left;if(right.left!==null){right.left.parent=node}right.left=node;node.parent=right;this.tree.augmentNodeAndAncestors(node)};Balancer.prototype.rotateRight=function(node){var left=node.left;this.replaceNode(node,left);node.left=left.right;if(left.right!==null){left.right.parent=node}left.right=node;node.parent=left;this.tree.augmentNodeAndAncestors(node)};Balancer.prototype.insertCase1=function(node){if(node.parent===null){node.color=BLACK}else{this.insertCase2(node)}};Balancer.prototype.insertCase2=function(node){if(nodeColor(node.parent)===BLACK){return}else{this.insertCase3(node)}};Balancer.prototype.insertCase3=function(node){var uncle=node.uncle();var grandparent=node.grandparent();if(uncle!==null&&nodeColor(uncle)===RED){node.parent.color=BLACK;uncle.color=BLACK;grandparent.color=RED;this.insertCase1(grandparent)}else{this.insertCase4(node)}};Balancer.prototype.insertCase4=function(node){var grandparent=node.grandparent();if(node===node.parent.right&&node.parent===grandparent.left){this.rotateLeft(node.parent);node=node.left}else if(node===node.parent.left&&node.parent===grandparent.right){this.rotateRight(node.parent);node=node.right}this.insertCase5(node)};Balancer.prototype.insertCase5=function(node){var grandparent=node.grandparent();node.parent.color=BLACK;grandparent.color=RED;if(node===node.parent.left&&node.parent===grandparent.left){this.rotateRight(grandparent)}else if(node===node.parent.right&&node.parent===grandparent.right){this.rotateLeft(grandparent)}};Balancer.prototype.deleteCase1=function(node){if(node.parent!==null){this.deleteCase2(node)}};Balancer.prototype.deleteCase2=function(node){var sibling=node.sibling();if(nodeColor(sibling)===RED){node.parent.color=RED;sibling.color=BLACK;if(node===node.parent.left){this.rotateLeft(node.parent)}else{this.rotateRight(node.parent)}}this.deleteCase3(node)};Balancer.prototype.deleteCase3=function(node){var sibling=node.sibling();if(nodeColor(node.parent)===BLACK&&nodeColor(sibling)===BLACK&&nodeColor(sibling.left)===BLACK&&nodeColor(sibling.right)===BLACK){sibling.color=RED;this.deleteCase1(node.parent)}else{this.deleteCase4(node)}};Balancer.prototype.deleteCase4=function(node){var sibling=node.sibling();if(nodeColor(node.parent)===RED&&nodeColor(sibling)===BLACK&&nodeColor(sibling.left)===BLACK&&nodeColor(sibling.right)===BLACK){sibling.color=RED;node.parent.color=BLACK}else{this.deleteCase5(node)}};Balancer.prototype.deleteCase5=function(node){var sibling=node.sibling();if(node===node.parent.left&&nodeColor(sibling)===BLACK&&nodeColor(sibling.left)===RED&&nodeColor(sibling.right)===BLACK){sibling.color=RED;sibling.left.color=BLACK;this.rotateRight(sibling)}else if(node===node.parent.right&&nodeColor(sibling)===BLACK&&nodeColor(sibling.right)===RED&&nodeColor(sibling.left)===BLACK){sibling.color=RED;sibling.right.color=BLACK;this.rotateLeft(sibling)}this.deleteCase6(node)};Balancer.prototype.deleteCase6=function(node){var sibling=node.sibling();sibling.color=nodeColor(node.parent);node.parent.color=BLACK;if(node===node.parent.left){sibling.right.color=BLACK;this.rotateLeft(node.parent)}else{sibling.left.color=BLACK;this.rotateRight(node.parent)}};module.exports=RedBlackTree},{}]},{},[1])(1)})}());(function(){var define=System.amdDefine;define('calendar/ical/parser.js',['3rdparty/ical.js'],function(ical){return ical.parse})}());(function(){var define=System.amdDefine;define('calendar/actions/GetTimeZoneAction.js',['common/util.js','calendar/ical/TimeZoneService.js','calendar/ical/Component.js','calendar/ical/parser.js'],function(util,TimeZoneService,Component,icalParser){function parseTimeZone(icsData){var component=new Component(icalParser(icsData));return component.getFirstSubcomponent('vtimezone')}function GetTimeZoneAction(options){util.extend(this,util.pick(options,'tzid'))}GetTimeZoneAction.prototype.name='GetTimeZoneAction';GetTimeZoneAction.prototype.execute=function(context,cb){var state=context.state;var backend=context.backend;var tzid=this.tzid;backend.getTimeZone(state.user(),tzid,function(err,timeZoneDefinition){if(err){cb(err)}else{TimeZoneService.register(parseTimeZone(timeZoneDefinition));cb(null,TimeZoneService.get(tzid))}})};return GetTimeZoneAction})}());(function(){var define=System.amdDefine;define('calendar/ical/TimeZoneService.js',['3rdparty/ical.js'],function(ical){return ical.TimezoneService})}());(function(){var define=System.amdDefine;define('calendar/actions/FormatSanitationAction.js',['common/util.js','calendar/actions/GetTimeZoneAction.js','3rdparty/async.js','calendar/ical/TimeZoneService.js'],function(util,GetTimeZoneAction,async,TimeZoneService){var deprecatedRrulePattern=/RRULE.*((BYMONTH=|BYWEEKNO=|BYMONTHDAY=|BYDAY=).*BYYEARDAY=|BYYEARDAY=.*(BYMONTH=|BYWEEKNO=|BYMONTHDAY=|BYDAY=))/g;function FormatSanitationAction(options){util.extend(this,util.pick(options,'calendarData'))}FormatSanitationAction.prototype.name='FormatSanitationAction';FormatSanitationAction.prototype.sanitizeIcalData=function(icalData,context,cb){icalData=icalData.replace(/<!--(.*?)-->/g,'');var tzidsToReplace=[];var timeZoneMatch=icalData.match(/BEGIN:VTIMEZONE([\s\S]*?)END:VTIMEZONE/g);if(timeZoneMatch){for(var i=0;i<timeZoneMatch.length;i++){var timeZone=timeZoneMatch[i];var timeZoneWithoutLineBreaks=timeZone.replace(/\r?\n\s/g,'');if(timeZoneWithoutLineBreaks.match(deprecatedRrulePattern)){var tzidMatch=/TZID:(.*)/g.exec(timeZone);var tzid=tzidMatch&&tzidMatch[1];tzidsToReplace.push({tzid:tzid,toReplace:timeZone})}}}var tzTasks=tzidsToReplace.map(function(tzidToReplace){return function(callback){var tzid=tzidToReplace.tzid;if(TimeZoneService.has(tzid)){tzidToReplace.timeZone=TimeZoneService.get(tzid);return callback(null,tzidToReplace)}var getTimeZone=new GetTimeZoneAction({tzid:tzid});getTimeZone.execute(context,function(err,timeZone){if(err||!timeZone){return callback(err||new Error('no time zone found'))}tzidToReplace.timeZone=timeZone;callback(null,tzidToReplace)})}});async.parallelLimit(tzTasks,2,function(err,results){if(err){return cb(err)}for(var i=0;i<results.length;i++){var tzidToReplace=results[i];icalData=icalData.replace(tzidToReplace.toReplace,tzidToReplace.timeZone.component.toString())}cb(null,icalData)})};FormatSanitationAction.prototype.execute=function(context,callback){var that=this;var calendarData=that.calendarData;if(typeof calendarData==='string'){return that.sanitizeIcalData(calendarData,context,callback)}if(!calendarData||!calendarData.icalendar){return callback(null,calendarData)}var icalDataChildren=calendarData.icalendar.children;async.map(icalDataChildren,function(child,next){that.sanitizeIcalData(child.calData,context,function(err,calData){if(!err){child.calData=calData}next(err,child)})},function(err,children){if(err){return callback(err,calendarData)}calendarData.icalendar.children=children;callback(null,calendarData)})};return FormatSanitationAction})}());(function(){var define=System.amdDefine;define('calendar/actions/LoadCalendarsAction.js',['3rdparty/async.js','common/util.js','3rdparty/passError.js','calendar/model/Calendar.js','calendar/ical/Time.js','calendar/ical/TimeZone.js','3rdparty/insection.js','common/ActionBehavior.js','calendar/actions/FormatSanitationAction.js'],function(async,util,passError,Calendar,Time,TimeZone,insection,ActionBehavior,FormatSanitationAction){function LoadCalendarsAction(options){util.extend(this,util.pick(options,'startDate','endDate'));ActionBehavior.installInto(this)}LoadCalendarsAction.prototype.name='LoadCalendarsAction';LoadCalendarsAction.prototype.models=function(context){return[context.state.calendars]};LoadCalendarsAction.prototype.validate=function(){if(!this.startDate||!this.endDate){throw new Error('LoadCalendarsActions requires a startDate and an endDate')}};LoadCalendarsAction.prototype.execute=function(context,cb){var that=this;var state=context.state;var backend=context.backend;var start=this.startDate.convertToZone(TimeZone.utcTimeZone);var end=this.endDate.convertToZone(TimeZone.utcTimeZone);start.isDate=false;end.isDate=false;var gaps=state.cacheIndex.getGaps(start.toUnixTime(),end.toUnixTime());that.setBusyFlags();async.mapLimit(gaps,2,function(gap,next){var start=new Time;start.fromUnixTime(gap.start);var end=new Time;end.fromUnixTime(gap.end);var filter={start:start.toICALString(),end:end.toICALString()};backend.getCalendars(state.user(),filter,passError(next,function(data){var calendarTasks=(data.calendars||[]).map(function(calendarData){return function(taskCallback){var sanitationAction=new FormatSanitationAction({calendarData:calendarData});sanitationAction.execute(context,function(err,sanitizedCalendarData){if(err){return taskCallback(err)}taskCallback(null,sanitizedCalendarData)})}});async.parallelLimit(calendarTasks,2,function(err,results){if(err){return next(err)}next(null,{start:start,end:end,data:{calendars:results}})})}))},passError(cb,function(results){that.removeBusyFlags();state.calendars.version.pause();results.forEach(function(result){var remoteCalendars=result.data.calendars||[];var remoteCalendarIndex=util.uniqueIndexBy(remoteCalendars,function(calendarData){return calendarData.id});state.calendars.all().forEach(function(calendar){if(!calendar.extern&&!remoteCalendarIndex[calendar.id]){state.calendars.remove(calendar)}});remoteCalendars.forEach(function(calendarData){var calendar=state.calendars.get(calendarData.id);if(calendar){calendar.update(result.start,result.end,calendarData)}else{state.calendars.add(new Calendar(calendarData,state.timeZone))}});state.cacheIndex.add(start.toUnixTime(),end.toUnixTime(),null)});state.calendars.version.resume(true);cb()}))};return LoadCalendarsAction})}());(function(){var define=System.amdDefine;define('calendar/components/navigation/NavigationViewModel.js',['node_modules/knockout/build/output/knockout-latest.debug.js','node_modules/jquery/dist/jquery.js','common/util.js'],function(ko,$,utils){function NavigationViewModel(options){var that=this;var context=utils.defaults(options,{showNavigation:true,showTabs:true,activeField:null,showToday:$.noop,showPrevious:$.noop,showNext:$.noop,showDayView:$.noop,showWeekView:$.noop,showMonthView:$.noop,showAgendaView:$.noop});context.activeField=ko.isObservable(context.activeField)?context.activeField:ko.observable(context.activeField);utils.extend(that,context)}return NavigationViewModel})}());System.registerDynamic('calendar/components/navigation/navigation.ko',[],true,function($__require,exports,module){var define,global=this||self,GLOBAL=global;module.exports=function injectTemplate(tpl){var s=document.createElement('script');s.id=tpl.id;s.innerHTML=window.TR?TR.HTML(tpl.content):tpl.content;s.type='text/html';document.head.appendChild(s)}({'id':'navigation','content':'<div class="buttons-container navigation-btns" data-bind="visible: showNavigation">\n    <button data-bind="leftMouseDown: showToday" data-i18n="calendar.Today">Today</button>\n    <button data-bind="leftMouseDown: showPrevious" class="previous"></button>\n    <button data-bind="leftMouseDown: showNext" class="next"></button>\n</div>\n<div class="buttons-container tabs-btns" data-bind="visible: showTabs">\n    <button data-bind="leftMouseDown: showDayView, css: { active: activeField() === \'day\' }" data-i18n="calendar.Day">Day</button>\n    <button data-bind="leftMouseDown: showWeekView, css: { active: activeField() === \'week\' }" data-i18n="calendar.Week">Week</button>\n    <button data-bind="leftMouseDown: showMonthView, css: { active: activeField() === \'month\' }" data-i18n="calendar.Month">Month</button>\n    <button data-bind="leftMouseDown: showAgendaView, css: { active: activeField() === \'agenda\' }" data-i18n="calendar.Agenda">Agenda</button>\n</div>\n'});return module.exports});(function(){var define=System.amdDefine;define('calendar/components/navigation/navigation.js',['node_modules/knockout/build/output/knockout-latest.debug.js','calendar/components/navigation/NavigationViewModel.js','calendar/components/navigation/navigation.ko'],function(ko,NavigationViewModel){ko.components.register('one-navigation',{template:{element:'navigation'},viewModel:{createViewModel:function(params){return new NavigationViewModel(params)}}})})}());(function(){var define=System.amdDefine;define('calendar/agenda/AgendaView.js',['node_modules/knockout/build/output/knockout-latest.debug.js','common/util.js','calendar/ical/Time.js','calendar/ical/TimeZone.js','calendar/ical/Duration.js','calendar/Sort.js','calendar/model/DateRange.js','calendar/actions/LoadCalendarsAction.js','common/ViewBehavior.js','calendar/components/navigation/navigation.js'],function(ko,util,Time,TimeZone,Duration,Sort,DateRange,LoadCalendarsAction,ViewBehavior){var maxShowDays=90;function AgendaView(options){var that=this;util.extend(that,{autoRefreshAgenda:true},util.pick(options,'state','autoRefreshAgenda','pageNavigator','actionExecutor','errorHandler'));ViewBehavior.installInto(this);var now=that.state.now;that.duration=ko.observable(options.duration||Duration.fromString('P7D'));that.startDate=ko.observable(now());that.endDate=ko.pureComputed(function(){var result=that.startDate().startOfDay();result.addDuration(that.duration());result._normalize();return result});that.slideIn=!!options.slideIn;that.showCalendarLink=that.slideIn;that.goToCalendar=function(){that.pageNavigator.page.show('/calendar')};that.dateRange=ko.pureComputed(function(){return new DateRange({from:that.startDate().startOfDay(),to:that.endDate()})});that.dateRange.subscribe(function(dateRange){loadDateRange(dateRange)});function loadDateRange(dateRange){if(dateRange&&that.state.user()!=='anonymous'){that.executeAction(new LoadCalendarsAction({startDate:dateRange.from,endDate:dateRange.to}),function(err){that.handleError(err)})}}that.isTodayInRange=ko.pureComputed(function(){return that.dateRange().contains(that.currentDate())});that.currentDate=that.state.currentDate;that.lastAgendaDay=ko.pureComputed(function(){var result=that.endDate().clone();result.day-=1;result._normalize();return result});that.canLoadMore=ko.pureComputed(function(){return that.duration().toDays()<maxShowDays});var calendars=that.state.calendars;function eventInstancesForDate(date){var localDate=date.clone().convertToZone(that.state.timeZone());var dayStart=date.startOfDay();var dayEnd=dayStart.dayAfter();var localDayStart=localDate.startOfDay();var localDayEnd=localDate.dayAfter();localDayEnd.isDate=date.isDate;return Sort.eventInstances.byStartDateThenByCalendarName(calendars.getEventInstances(localDate,localDayEnd).map(function(eventInstance){var startDate=eventInstance.startDate;var endDate=eventInstance.endDate;if(!startDate.isDate){startDate=startDate.convertToZone(that.state.timeZone())}if(!endDate.isDate){endDate=endDate.convertToZone(that.state.timeZone())}if(startDate.compare(localDayStart)<0){startDate=dayStart.clone()}if(localDayEnd.compare(endDate)<0){endDate=dayEnd.clone()}return{allDay:startDate.isDate&&endDate.isDate,startDate:startDate,endDate:endDate,eventInstance:eventInstance}}))}var agendaDays=ko.pureComputed(function(){var result=[];var currentDate=that.startDate().isDate?that.startDate().clone().convertToZone(TimeZone.localTimeZone):that.startDate().clone();while(currentDate.compare(that.endDate())<0){var dayStart=currentDate.clone();result.push(dayStart);currentDate=currentDate.dayAfter();currentDate=currentDate.convertToZone(TimeZone.localTimeZone)}return result});var refreshTimer;function setRefreshTimeout(eventInstances){clearTimeout(refreshTimer);var minEndDate=eventInstances[0].endDate;eventInstances.forEach(function(eventInstance){if(eventInstance.endDate.compare(minEndDate)<0){minEndDate=eventInstance.endDate}});var secondsBeforeTimeout=minEndDate.subtractDateTz(now()).toSeconds();refreshTimer=setTimeout(function(){that.startDate(now())},secondsBeforeTimeout*1000)}that.days=ko.pureComputed(function(){calendars.version();var result=[];var days=agendaDays();var registerRefreshTimer=that.autoRefreshAgenda&&now().startOfDay().compare(days[0].startOfDay())===0;days.forEach(function(day){var eventInstances=eventInstancesForDate(day);if(eventInstances.length){if(registerRefreshTimer){setRefreshTimeout(eventInstances);registerRefreshTimer=false}var dayEntry={date:day,eventInstances:eventInstances};result.push(dayEntry)}});return result}).extend({throttle:0})}AgendaView.prototype.loadMore=function(){var duration=this.duration();duration.days+=7;this.duration(duration)};AgendaView.prototype.showDayView=function(){this.pageNavigator.show(new DateRange({from:this.isTodayInRange()?this.currentDate():this.dateRange().from,duration:Duration.fromString('P1D')}),{view:'day'})};AgendaView.prototype.showWeekView=function(){this.pageNavigator.show(new DateRange({from:this.dateRange().from.startOfWeek(),duration:Duration.fromString('P1W')}),{view:'week'})};AgendaView.prototype.showMonthView=function(){this.pageNavigator.show(this.dateRange().expandToMonth(),{view:'month'})};AgendaView.prototype.showAgendaView=function(){this.pageNavigator.show(this.dateRange().expandToMonth(),{view:'agenda'})};return AgendaView})}());(function(){var define=System.amdDefine;define('calendar/dialogs/event/RecurrenceOptionsView.js',['node_modules/knockout/build/output/knockout-latest.debug.js','common/util.js','calendar/model/RecurrenceRule.js','calendar/ical/Recur.js','calendar/ical/Time.js','calendar/ical/Duration.js'],function(ko,util,RecurrenceRule,Recur,Time,Duration){var RecurrenceOptionsView={installInto:function(target){var that=target;that.recurrence=ko.observable();that.frequency=ko.observable();that.count=ko.observable();that.until=ko.observable();that.interval=ko.observable();that.byday=ko.observableArray();that.bymonthday=ko.observableArray();that.wkst=ko.observable(null);that.singleOccurrence=TR('calendar.NoRecurrence','Single occurrence');that.recurrenceProperties=['frequency','count','until','interval','byday','bymonthday','wkst'];var daysOfWeek=['SU','MO','TU','WE','TH','FR','SA','SU','MO','TU','WE','TH','FR','SA'];that.initRecurrenceOptions=function(eventInstance){var recurrence=eventInstance.event.recurrence;that.frequency(recurrence&&recurrence.rrule.freq);that.count(recurrence&&recurrence.rrule.count);that.until(recurrence&&recurrence.rrule.until);that.interval(recurrence&&recurrence.rrule.interval);that.byday(recurrence&&recurrence.rrule.parts&&recurrence.rrule.parts.BYDAY);that.recurrence(recurrence);that.setWeekStart();that.selectMonthlyRepetition();that.prevRecurrence=null};that.resetRecurrenceOptions=function(){that.recurrence(null);that.frequency(null);that.count(null);that.until(null);that.interval(null);that.byday(null)};that.initialDate=ko.pureComputed(function(){var eventInstance=that.eventInstance();var startDate=that.startDate();var details=eventInstance&&eventInstance.details;var event=eventInstance&&eventInstance.event;return details&&details.startDate||event&&event.startDate||startDate});that.frequencyOptions=[{value:RecurrenceRule.frequencies.daily,text:util.firstUp(TR('calendar.Recurrence.FrequencyDaily','daily'))},{value:RecurrenceRule.frequencies.weekly,text:util.firstUp(TR('calendar.Recurrence.FrequencyWeekly','Weekly'))},{value:RecurrenceRule.frequencies.monthly,text:util.firstUp(TR('calendar.Recurrence.FrequencyMonthly','Monthly'))},{value:RecurrenceRule.frequencies.yearly,text:util.firstUp(TR('calendar.Recurrence.FrequencyYearly','yearly'))}];that.selectedFrequency=ko.pureComputed({read:function(){return that.getFrequencyOption(that.frequency())},write:function(newFrequency){var freq=newFrequency.value;if(freq===that.frequency()){return}if(freq===RecurrenceRule.frequencies.weekly||RecurrenceRule.frequencies.daily){that.byday(null)}if(freq!==RecurrenceRule.frequencies.monthly){if(freq!==RecurrenceRule.frequencies.daily){that.byday(null)}that.bymonthday(null)}if(freq===RecurrenceRule.frequencies.yearly){that.byday(null);that.bymonthday(null)}if(freq===RecurrenceRule.frequencies.monthly){that.byday(null);that.bymonthday(null);that.selectMonthlyRepetition(freq)}that.interval(1);that.frequency(freq)}});that.getFrequencyOption=function(freq){var freqOption=that.frequencyOptions[0];that.frequencyOptions.some(function(option){if(option.value===freq){freqOption=option;return true}return false});return freqOption};that.detectKeyCode=function(data,event){var key=window.event?event.keyCode:event.which;if(event.keyCode===8||event.keyCode===46||event.keyCode===37||event.keyCode===39||key===65&&event.ctrlKey===true){return true}else if((key<48||key>57)&&(key<96||key>105)){return false}else{return true}};function numberWithMax(property,maxNumber){return function(value){var type=typeof value;var validType=['string','number'].indexOf(type)>-1;var isValid=validType&&!isNaN(+value);if(isValid){var number=+value;if(number<1){return property(1)}if(number>maxNumber){return property(maxNumber)}if(type==='string'){property(number)}}else if(value!==null&&value!==undefined){property(1)}}}var maxSafeInteger=Number.MAX_SAFE_INTEGER||9007199254740991;that.count.subscribe(numberWithMax(that.count,maxSafeInteger));that.interval.subscribe(numberWithMax(that.interval,30));that.isWeekdaysOnly=ko.pureComputed({read:function(){return isWeekdays(that.byday())},write:function(newOption){if(newOption){that.byday(that.weekDays().slice())}else{that.byday([])}}});that.weekdaysOnlyClick=function(){that.isWeekdaysOnly(!that.isWeekdaysOnly.peek())};that.intervalDescription=ko.pureComputed(function(){var freq=that.frequency();if(!freq||RecurrenceRule.supportedFrequencies.indexOf(freq.toLowerCase())===-1){return}var translation=TR('calendar.RecurrenceRule.IntervalPostfixPatternByFrequencyAndQuantity',{daily:{one:'day',other:'days'},weekly:{one:'week',other:'weeks'},monthly:{one:'month',other:'months'},yearly:{one:'year',other:'years'}})[freq.toLowerCase()];return inter.trQuantity(translation,that.interval()||1)});that.setWeekStart=function(){var globalSettings=that.state.preferences.global();var recurrence=that.recurrence();var wkst=recurrence&&(recurrence.wkst?recurrence.wkst:daysOfWeek[globalSettings.weekStart]);that.wkst(wkst)};that.daysOfWeekInOrder=ko.pureComputed(function(){var globalSettings=that.state.preferences.global();var weekdayNames=inter.calendars.gregorian.dayNames.standAlone.abbreviated;var initialDate=that.initialDate();return daysOfWeek.slice().splice(globalSettings.weekStart,7).map(function(day){var dayNumber=daysOfWeek.indexOf(day);var dayText=weekdayNames[dayNumber];var disabled=ko.pureComputed(function(){return initialDate.dayOfWeek()===Recur.icalDayToNumericDay(day)});return{id:ko.pureComputed(function(){return day}),text:ko.pureComputed(function(){return dayText}),disabled:disabled,selected:ko.pureComputed({read:function(){var byday=that.byday()?that.byday:[];return disabled()||byday.indexOf(day)>-1},write:function(addDayToByDay){if(disabled()){return}if(!that.byday()||that.byday().length===0){that.byday([initialDate.dayOfWeekId()])}if(addDayToByDay){that.byday.push(day)}else{that.byday.remove(day)}}}),labelClick:function(viewModel,event){if(viewModel.disabled()){return}viewModel.selected(!viewModel.selected.peek())}}})});that.weekDayInMonth=ko.pureComputed(function(){var initialDate=that.initialDate();if(!initialDate){return 1}return 1+Math.floor((initialDate.day-1)/7)});that.bydaynthText=ko.pureComputed(function(){var initialDate=that.initialDate();if(!initialDate){return}var dayOfWeekMondayFirst=(initialDate.dayOfWeek()-1+6)%7;var nthWeekDayInMonth=that.weekDayInMonth()-1;return TR('calendar.Recurrence.ByNthDayOfTheWeek',[['On the 1st Monday','On the 2nd Monday','On the 3rd Monday','On the 4th Monday','On the 5th Monday'],['On the 1st Tuesday','On the 2nd Tuesday','On the 3rd Tuesday','On the 4th Tuesday','On the 5th Tuesday'],['On the 1st Wednesday','On the 2nd Wednesday','On the 3rd Wednesday','On the 4th Wednesday','On the 5th Wednesday'],['On the 1st Thursday','On the 2nd Thursday','On the 3rd Thursday','On the 4th Thursday','On the 5th Thursday'],['On the 1st Friday','On the 2nd Friday','On the 3rd Friday','On the 4th Friday','On the 5th Friday'],['On the 1st Saturday','On the 2nd Saturday','On the 3rd Saturday','On the 4th Saturday','On the 5th Saturday'],['On the 1st Sunday','On the 2nd Sunday','On the 3rd Sunday','On the 4th Sunday','On the 5th Sunday']])[dayOfWeekMondayFirst][nthWeekDayInMonth]});that.monthlyRepetitionLabel=function(item,event){event.preventDefault();event.stopPropagation();event.cancelBubble=true;that.monthlyRepetition(item.value)};that.bydaylastText=ko.pureComputed(function(){var initialDate=that.initialDate();if(!initialDate){return}var dayNames=inter.calendars.gregorian.dayNames.standAlone.wide;var dayOfWeek=initialDate.dayOfWeek();return TR.PAT('calendar.Recurrence.ByLastDayOfTheWeek','On the last {0}')(dayNames[dayOfWeek-1])});that.bymonthdayText=ko.pureComputed(function(){var initialDate=that.initialDate();if(!initialDate){return}var day=initialDate.day;var dayOfTheMonthOrdinals=RecurrenceRule.dayOfTheMonthOrdinals;var dayOrdinal=dayOfTheMonthOrdinals[day-1];return TR.PAT('calendar.Recurrence.ByMonthDay','On the {0}')(dayOrdinal)});that.showBydaylastOption=ko.pureComputed(function(){var initialDate=that.initialDate();if(!initialDate){return}var daysInMonth=Time.daysInMonth(initialDate.month,initialDate.year);var day=initialDate.day;return day>daysInMonth-7});that.updateMonthlyRepetition=function(monthlyRepetition){monthlyRepetition=monthlyRepetition||ko.unwrap(that.monthlyRepetition);var initialDate=ko.unwrap(that.initialDate);var freq=that.frequency();if(freq===RecurrenceRule.frequencies.monthly){var weekDay=Recur.numericDayToIcalDay(initialDate.dayOfWeek());if(monthlyRepetition==='bydaynth'){that.byday([that.weekDayInMonth()+weekDay]);that.bymonthday(null)}else if(monthlyRepetition==='bydaylast'){that.byday(['-1'+weekDay]);that.bymonthday(null)}else{that.byday(null);that.bymonthday([initialDate.day])}}};that.monthlyRepetition=ko.observable(null);that.monthlyRepetition.subscribe(function(newValue){that.updateMonthlyRepetition(newValue)});that.monthlyRepetitionOptions=ko.pureComputed(function(){return[{text:that.bymonthdayText(),value:'bymonthday',show:ko.observable(true)},{text:that.bydaynthText(),value:'bydaynth',show:ko.observable(true)},{text:that.bydaylastText(),value:'bydaylast',show:that.showBydaylastOption()}]});that.selectMonthlyRepetition=function(frequency){var recurrence=that.recurrence();if(recurrence&&recurrence.tooComplex()){return}var bymonthday=that.bymonthday();var byday=that.byday();var freq=frequency||that.frequency();if(freq!==RecurrenceRule.frequencies.monthly){return}var initialDate=that.initialDate();var repetitionByDay=freq===RecurrenceRule.frequencies.monthly&&byday&&byday.length!==0;var repetitionByMonthDay=bymonthday&&bymonthday.length!==0;var zeroIndexedDayOfWeek=initialDate.dayOfWeek()-1;that.monthlyRepetition('bymonthday');if(repetitionByDay||repetitionByMonthDay){if(repetitionByDay){var byDaySplit=/^(\-?\d+)(\w\w)$/.exec(byday[0]);if(byDaySplit[1]&&byDaySplit[2]===daysOfWeek[zeroIndexedDayOfWeek]){if(daysOfWeek.indexOf(byDaySplit[2])>=0){if(daysOfWeek.indexOf(byDaySplit[2])===zeroIndexedDayOfWeek){that.monthlyRepetition(parseInt(byDaySplit[1],10)>0?'bydaynth':'bydaylast')}}}}if(repetitionByMonthDay){var firstByMonthDay=bymonthday[0];var isValidByMonthDay=/^\d+$/.test(firstByMonthDay)&&parseInt(firstByMonthDay,10)>0&&firstByMonthDay===initialDate.day;that.monthlyRepetition(isValidByMonthDay?'bymonthday':null)}}};that.weekDays=ko.pureComputed(function(){var globalSettings=that.state.preferences.global();return daysOfWeek.slice().splice(globalSettings.weekendStart+7-5,5)});function isWeekdays(bydayPart){var byday=bydayPart||[];var weekDays=that.weekDays();if(weekDays.length!==byday.length){return false}return!weekDays.some(function(day){return byday.indexOf(day)===-1})};that.recurrenceDescription=ko.pureComputed(function(){if(!that.recurrence()){return that.singleOccurrence}var globalPreferences=that.state.preferences.global();return that.recurrence().toLocaleString(that.initialDate(),globalPreferences)});that.prevRecurrence=null;that.repeats=ko.pureComputed({read:function(){return!!that.recurrence()},write:function(value){that.toggleRecurrence(that)}});that.tooComplex=ko.pureComputed(function(){return that.recurrence()&&that.recurrence().tooComplex()});that.toggleRecurrence=function(viewModel,e){if(that.recurrence()){that.prevRecurrence=that.recurrence();that.recurrence(null);that.frequency(null);that.count(null);that.until(null);that.interval(null)}else{var recurrence=that.prevRecurrence||new RecurrenceRule(Recur.fromData({freq:RecurrenceRule.frequencies.daily}));that.frequency(recurrence.rrule.freq);that.until(recurrence.rrule.until);that.count(recurrence.rrule.count);that.interval(recurrence.rrule.interval);that.recurrence(recurrence);that.selectMonthlyRepetition();that.setWeekStart();if(!that.isSlideIn&&(!that.prevRecurrence||that.prevRecurrence.isEmpty())){that.showRecurrence()}}};that.deleteRecurrence=function(){that.toggleRecurrence();that.prevRecurrence=null};that.rruleTooltip=ko.pureComputed(function(){return that.recurrence()&&that.recurrence().tooComplex()&&that.recurrence().rrule.toString()});that.recurrenceProperties.forEach(function(recurProperty){that[recurProperty].subscribe(updateRecurrence)});function updateRecurrence(){var recurrence=that.recurrence();if(!recurrence){return}var freq=ko.unwrap(that.frequency);var wkst=ko.unwrap(that.wkst);var byday=ko.unwrap(that.byday);var bymonthday=ko.unwrap(that.bymonthday);recurrence.rrule.freq=freq;recurrence.rrule.until=ko.unwrap(that.until);recurrence.rrule.count=ko.unwrap(that.count);recurrence.rrule.interval=ko.unwrap(that.interval);recurrence.rrule.wkst=wkst&&Recur.icalDayToNumericDay(wkst);if(byday&&byday.length){recurrence.rrule.parts.BYDAY=ko.unwrap(that.byday)}else{delete recurrence.rrule.parts.BYDAY}if(bymonthday&&bymonthday.length){recurrence.rrule.parts.BYMONTHDAY=ko.unwrap(that.bymonthday)}else{delete recurrence.rrule.parts.BYMONTHDAY}recurrence.normalizeUntil(that.startDate());that.recurrence.valueHasMutated()}that.until.subscribeChanged(function(newValue,previousValue){if(!newValue||!previousValue){return}setTimeout(function(){var eventInstance=that.eventInstance();var dateOfFirstOccurence=eventInstance&&eventInstance.event.startDate;if(dateOfFirstOccurence&&newValue.compare(dateOfFirstOccurence)<0){that.until(previousValue)}},1)});that.limit=ko.pureComputed({read:function(){if(that.count()){return'count'}else if(that.until()){return'until'}else{return'forever'}},write:function(newLimitation){if(newLimitation==='count'){that.until(null);if(!that.count()){that.count(1)}}else if(newLimitation==='until'){if(!that.until()){var sevenDaysDuration=Duration.fromData({days:7});var defaultUntil=that.initialDate().clone().addDuration(sevenDaysDuration);defaultUntil=defaultUntil._normalize();that.until(defaultUntil)}that.count(null)}else{that.until(null);that.count(null)}}})}};return RecurrenceOptionsView})}());(function(){var define=System.amdDefine;define('calendar/actions/UpdateEventInstanceAction.js',['3rdparty/async.js','common/util.js','common/ActionBehavior.js','calendar/actions/ScopeDetectionError.js','calendar/actions/UpdateCalendarAction.js','calendar/model/RecurrenceRule.js','calendar/ical/Duration.js','calendar/ical/Time.js','calendar/ical/Recur.js','calendar/ical/Event.js','calendar/ical/Component.js','calendar/ical/Property.js','calendar/ical/TimeZone.js','calendar/ical/helpers.js'],function(async,util,ActionBehavior,ScopeDetectionError,UpdateCalendarAction,RecurrenceRule,Duration,Time,Recur,Event,Component,Property,TimeZone,icalHelpers){function UpdateEventInstanceAction(options){util.extend(this,util.pick(options,'eventInstance','data','scope'));ActionBehavior.installInto(this)}UpdateEventInstanceAction.prototype.name='UpdateEventInstanceAction';var scopes=['this','thisAndFuture','all'];UpdateEventInstanceAction.prototype.validate=function(){if(!this.eventInstance.event.calendar.writable){throw new Error('Only writable calendars can be updated')}if(this.scope!==null&&typeof this.scope!=='undefined'){if(scopes.indexOf(this.scope)===-1){throw new Error('Unknown scope: '+this.scope+', should be one of: '+scopes.join(', '))}if(this.scope!=='this'){if(!this.eventInstance.event.isRecurring()){throw new Error('scope: '+this.scope+' is only supported for recurring events')}if(this.eventInstance.details.isRecurrenceException()&&(this.data.startDate||this.data.endDate)){throw new Error('scope: '+this.scope+' is not supported when changing the time of a recurrence exception')}if(this.scope==='thisAndFuture'&&(this.eventInstance.first||this.eventInstance.last)){throw new Error('scope: thisAndFuture is not supported on the '+(this.eventInstance.first?'first':'last')+' instance in a series')}}}};function isPropertyDefined(data,property){return data[property]!==null&&typeof data[property]!=='undefined'}function createRecur(recurData,eventStartDate){var recurrenceRule=new RecurrenceRule(Recur.fromData(recurData));recurrenceRule.normalizeUntil(eventStartDate);return recurrenceRule.rrule}function adjustEventDates(event,data,dateField){var dateFieldOffsetName=dateField+'Offset';var isDateFieldName='is'+util.firstUp(dateField);if(!isPropertyDefined(data,dateFieldOffsetName)){return}var date=event[dateField];var offset=data[dateFieldOffsetName];var hasDateRegulartor=isPropertyDefined(data,isDateFieldName);var isDate=date.isDate;if(hasDateRegulartor&&isDate){date.isDate=data[isDateFieldName]}date=date.addDuration(offset);if(hasDateRegulartor&&!isDate){date.isDate=data[isDateFieldName]}if(date.isDate){date=date.convertToZone(TimeZone.localTimeZone)}else if(date.zone.isLocal()){date=date.convertToZone(data.offsetZone)}event[dateField]=date}function updateEvent(event,data){['summary','description','location'].forEach(function(property){if(isPropertyDefined(data,property)){event[property]=data[property]}});['startDate','endDate'].forEach(function(property){if(isPropertyDefined(data,property)){var originTimeZone=event[property].zone;var targetDate=data[property];if(!targetDate.isDate&&targetDate.zone.equal(TimeZone.localTimeZone)){targetDate=targetDate.convertToZone(originTimeZone)}event[property]=targetDate}});adjustEventDates(event,data,'startDate');adjustEventDates(event,data,'endDate');var component=event.component;if(component.hasProperty('rrule')){if(data.recur){component.updatePropertyWithValue('rrule',createRecur(data.recur,event.startDate))}else if(data.recur===null){component.removeProperty('rrule')}else{var existingRrule=component.getFirstPropertyValue('rrule');var updatedRRule=createRecur(existingRrule.toJSON(),event.startDate);component.updatePropertyWithValue('rrule',updatedRRule)}}else if(data.recur){var recur=createRecur(data.recur,event.startDate);var rrule=new Property('rrule');rrule.setValue(recur);component.addProperty(rrule)}}function isRedundantException(event,exception){if(exception.startDate.compare(exception.recurrenceId)!==0||event.duration.compare(exception.duration)!==0){return false}var propertyNameIndex={};exception.component.getAllProperties().forEach(function(property){if(/^(?:uid|dtstart|dtend|dtstamp|duration|recurrence-id)$/.test(property.name)){return true}var propertyIndex=propertyNameIndex[property.name]=propertyNameIndex[property.name]={};var key=property.toICALString();propertyIndex[key]=(propertyIndex[key]||0)+1});event.component.getAllProperties().forEach(function(property){var propertyIndex=propertyNameIndex[property.name];if(propertyIndex){var key=property.toICALString();if(propertyIndex[key]){propertyIndex[key]-=1}}});return Object.keys(propertyNameIndex).every(function(propertyName){var propertyIndex=propertyNameIndex[propertyName];return Object.keys(propertyIndex).every(function(key){return propertyIndex[key]===0})})}UpdateEventInstanceAction.prototype.removeRedundantExceptions=function(){var eventInstance=this.eventInstance;var event=eventInstance.event;var iterator=event.iterator();var exceptionIds=Object.keys(event.exceptions).sort();var isPossibleExceptionById={};if(exceptionIds.length>0){var lastExceptionId=exceptionIds[exceptionIds.length-1];var next;do{next=iterator.next();if(next){isPossibleExceptionById[next.toString()]=true}}while(next&&next.toString()<lastExceptionId)}exceptionIds.forEach(function(recurrenceId){var exception=event.exceptions[recurrenceId];if(!isPossibleExceptionById[recurrenceId]||isRedundantException(event,exception)){delete event.exceptions[recurrenceId];var vcalendar=event.component.parent;vcalendar.removeSubcomponent(exception.component)}})};UpdateEventInstanceAction.prototype.removeAllExceptions=function(){var eventInstance=this.eventInstance;var event=eventInstance.event;Object.keys(event.exceptions).forEach(function(recurrenceId){var exception=event.exceptions[recurrenceId];delete event.exceptions[recurrenceId];var vcalendar=event.component.parent;vcalendar.removeSubcomponent(exception.component)})};UpdateEventInstanceAction.prototype.updateThisInstance=function(){var eventInstance=this.eventInstance;var event=eventInstance.event;var data=this.data;eventInstance.removeFromCalendar();if(!event.isRecurring()){updateEvent(event,data)}else if(eventInstance.details.isRecurrenceException()){updateEvent(eventInstance.details,data)}else{var exception=eventInstance.createException();updateEvent(exception,data);event.relateException(exception);var vcalendar=event.component.parent;vcalendar.addSubcomponent(exception.component)}};function getOffsetInfo(dateField,eventInstance,data){if(!data[dateField]){return}var compareFrom=eventInstance[dateField];var compareTo=data[dateField];var compareZone=compareFrom.zone.isLocal()?compareTo.zone:compareFrom.zone;compareTo=compareTo.convertToZone(compareZone);compareFrom=compareFrom.convertToZone(compareZone);var offset=compareTo.subtractDateTz(compareFrom);return{offset:offset,zone:compareZone}}UpdateEventInstanceAction.prototype.getDataWithDateOffsets=function(){var eventInstance=this.eventInstance;var data=this.data;var startDateOffsetInfo=getOffsetInfo('startDate',eventInstance,data);var endDateOffsetInfo=getOffsetInfo('endDate',eventInstance,data);return util.extend({startDateOffset:startDateOffsetInfo&&startDateOffsetInfo.offset,endDateOffset:endDateOffsetInfo&&endDateOffsetInfo.offset,isStartDate:data.startDate&&data.startDate.isDate,isEndDate:data.endDate&&data.endDate.isDate,offsetZone:startDateOffsetInfo&&startDateOffsetInfo.zone||endDateOffsetInfo&&endDateOffsetInfo.zone},data,{startDate:null,endDate:null})};function updateAllInstances(event,data){var modifiesTime=data.startDateOffset||data.endDateOffset;var originalStartDate=event.startDate.clone();event.calendar.removeEventInstanceByEvents(event);updateEvent(event,data);var exceptions=Object.keys(event.exceptions).map(function(recurrenceId){return event.exceptions[recurrenceId]});if(modifiesTime){event.clearExceptions();event.component.removeAllProperties('rdates');var eventWasMovedToAnotherDay=originalStartDate.startOfDay().compare(event.startDate.startOfDay())!==0;if(eventWasMovedToAnotherDay){exceptions.forEach(function(exception){exception.component.parent.removeSubcomponent(exception.component)});event.component.removeAllProperties('exdate')}else{exceptions.forEach(function(exception){if(data.startDateOffset){exception.recurrenceId=exception.recurrenceId.addDuration(data.startDateOffset)}updateEvent(exception,util.extend({},data,{startDate:exception.recurrenceId.clone(),endDate:exception.recurrenceId.clone().addDuration(event.duration),startDateOffset:null,endDateOffset:null}))});exceptions.forEach(function(exception){event.relateException(exception)});event.component.getAllProperties('exdate').forEach(function(property){property.setValues(property.getValues().map(function(exdate){return exdate.addDuration(data.startDateOffset)}))})}}else{exceptions.forEach(function(exception){updateEvent(exception,data)})}}UpdateEventInstanceAction.prototype.updateAllInstances=function(){var event=this.eventInstance.event;var data=this.getDataWithDateOffsets();updateAllInstances(event,data)};UpdateEventInstanceAction.prototype.detectScope=function(){var eventInstance=this.eventInstance;var data=this.data;var dataKeys=Object.keys(this.data);if(eventInstance.event.isRecurring()){if(data.recur===null||eventInstance.first&&eventInstance.last||dataKeys.length===1&&dataKeys[0]==='calendar'){return['all']}if(!eventInstance.details.isRecurrenceException()||!data.startDate&&!data.endDate){var allowedScopes=[];if(!data.recur){allowedScopes.push('this')}if(eventInstance.event.recurrence&&eventInstance.event.recurrence.rrule.freq==='WEEKLY'){if(!data.startDate){allowedScopes.push('all');if(!eventInstance.first&&!eventInstance.last){allowedScopes.push('thisAndFuture')}}else if(data.startDate.year===eventInstance.startDate.year&&data.startDate.month===eventInstance.startDate.month&&data.startDate.day===eventInstance.startDate.day){allowedScopes.push('all');if(!eventInstance.first&&!eventInstance.last){allowedScopes.push('thisAndFuture')}}else{allowedScopes._forceChoice=true}}else{allowedScopes.push('all');if(!eventInstance.first&&!eventInstance.last){allowedScopes.push('thisAndFuture')}}return allowedScopes}else{return['this']}}else{return['this']}};function removePropertyValues(property,predicate){var values=property.getValues().filter(function(value){return!predicate(value)});if(values.length>0){property.setValues(values)}else{property.parent.removeProperty(property)}}UpdateEventInstanceAction.prototype.createUuid=function(){return util.uuid()};UpdateEventInstanceAction.prototype.updateThisInstanceAndFuture=function(){var eventInstance=this.eventInstance;var event=eventInstance.event;event.calendar.removeEventInstanceByEvents(event);var vcalendar=new Component(icalHelpers.clone(event.component.parent.toJSON(),true));vcalendar.resource={id:this.createUuid()+'.ics'};var exceptions=Object.keys(event.exceptions).map(function(recurrenceId){return event.exceptions[recurrenceId]});event.clearExceptions();var tailEvent;vcalendar.getAllSubcomponents('vevent').forEach(function(vevent){if(!tailEvent){tailEvent=new Event(vevent)}else{vcalendar.removeSubcomponent(vevent)}});tailEvent.uid=this.createUuid();event.calendar.addEvent(tailEvent);tailEvent.component.getAllProperties('rrule').forEach(function(property){var rrule=property.getFirstValue();if(typeof rrule.count==='number'){rrule.count-=eventInstance.count;property.setValue(rrule)}});event.component.getAllProperties('rrule').forEach(function(property){var rrule=property.getFirstValue();if(typeof rrule.count==='number'){rrule.count=eventInstance.count}else{rrule.until=eventInstance.recurrenceId.clone();rrule.until.day-=1}property.setValue(rrule)});exceptions.forEach(function(exception){if(exception.recurrenceId.compare(eventInstance.recurrenceId)<0){event.relateException(exception)}else{vcalendar.addSubcomponent(exception.component);exception.uid=tailEvent.uid;tailEvent.relateException(exception)}});event.component.getAllProperties('exdate').forEach(function(property){removePropertyValues(property,function(exdate){return exdate.compare(eventInstance.recurrenceId)>=0})});tailEvent.component.getAllProperties('exdate').forEach(function(property){removePropertyValues(property,function(exdate){return exdate.compare(eventInstance.recurrenceId)<0})});event.component.getAllProperties('rdate').forEach(function(property){removePropertyValues(property,function(rdate){return rdate.start.compare(eventInstance.recurrenceId)>=0})});tailEvent.startDate=eventInstance.startDate.clone();tailEvent.endDate=eventInstance.startDate.clone().addDuration(event.duration);var data=this.getDataWithDateOffsets();updateAllInstances(tailEvent,data);this.eventsToSave.push(tailEvent)};UpdateEventInstanceAction.prototype.sanitizeEvents=function(state){this.eventsToSave.map(function(e){var vcalendar=e.component.parent;var vTimeZone=vcalendar.getFirstSubcomponent('vtimezone');var timeZone=TimeZone.fromData(vTimeZone);var eventTimeZone=!vTimeZone||timeZone.equal(state.timeZone())?state.timeZone():timeZone;if(!e.startDate.isDate){e.startDate=e.startDate.convertToZone(eventTimeZone)}else{e.startDate=e.startDate.convertToZone(TimeZone.localTimezone)}if(!e.endDate.isDate){e.endDate=e.endDate.convertToZone(eventTimeZone)}else{e.endDate=e.endDate.convertToZone(TimeZone.localTimezone)}var eventsWithRecurrenceId=vcalendar.getAllSubcomponents().filter(function(eventData){return eventData.name==='vevent'}).map(function(eventData){return new Event(eventData)}).filter(function(event){return event.recurrenceId});eventsWithRecurrenceId.forEach(function(event){if(!event.recurrenceId.zone||event.recurrenceId.zone.equal(TimeZone.localTimeZone)){event.recurrenceId=event.recurrenceId.convertToZone(eventTimeZone)}});if(!vTimeZone){vcalendar.addSubcomponent(eventTimeZone.component)}return e})};UpdateEventInstanceAction.prototype.sanitizeData=function(){var data=this.data;var vcalendar=this.eventInstance.event.component.parent;var vTimeZone=vcalendar.getFirstSubcomponent('vtimezone');var calendarTimeZone=vTimeZone&&TimeZone.fromData(vTimeZone);var eventTimeZone=this.eventInstance.event.startDate.zone;if(eventTimeZone.equal(TimeZone.localTimeZone)&&vTimeZone&&!calendarTimeZone.equal(TimeZone.localTimeZone)){eventTimeZone=calendarTimeZone}Object.keys(data).forEach(function(dataKey){if(['startDate','endDate'].indexOf(dataKey)>-1){var value=data[dataKey];if(value.isDate){data[dataKey]=value.convertToZone(TimeZone.localTimeZone)}else if(!eventTimeZone.equal(TimeZone.localTimeZone)){data[dataKey]=value.convertToZone(eventTimeZone)}}})};UpdateEventInstanceAction.prototype.execute=function(context,cb){var that=this;var state=context.state;var backend=context.backend;if(!that.scope){var detectedScopes=that.detectScope();if(detectedScopes.length>1||detectedScopes._forceChoice){return cb(new ScopeDetectionError([].concat(detectedScopes)))}that.scope=detectedScopes[0]}var eventInstance=that.eventInstance;var event=eventInstance.event;var calendar=eventInstance.event.calendar;that.eventsToSave=[event];that.sanitizeEvents(state);that.sanitizeData();switch(that.scope){case'this':that.updateThisInstance();break;case'thisAndFuture':that.updateThisInstanceAndFuture();break;case'all':that.updateAllInstances();break}if(event.isRecurring()&&that.data.recur===null){that.removeAllExceptions()}else{that.removeRedundantExceptions()}var tasks=[];var targetCalendar=that.data.calendar;if(targetCalendar){if(!targetCalendar.enabled()){targetCalendar.enabled(true);new UpdateCalendarAction({calendar:calendar,data:{enabled:true}}).execute(context,function(err){if(err){that.handleError(err)}})}calendar.removeEventInstanceByEvents(event);delete calendar.events[event.uid];var newUid=that.createUuid();event.uid=newUid;Object.keys(event.exceptions).forEach(function(recurrenceId){var exception=event.exceptions[recurrenceId];exception.uid=newUid});var oldResource=util.extend(event.component.parent.resource);that.eventsToSave.forEach(function(event){targetCalendar.addEvent(event);tasks.push(function(callback){var vcalendar=event.component.parent;vcalendar.resource={id:newUid+'.ics'};backend.saveCalendarResource(state.user(),targetCalendar.id,vcalendar.resource,vcalendar.toString(),function(err,data){if(!err){vcalendar.resource.etag=data.headers.etag}callback(err)})})});tasks.push(function(callback){backend.deleteCalendarResource(state.user(),calendar.id,oldResource,callback)});targetCalendar.version(targetCalendar.version()+1)}else{tasks=that.eventsToSave.map(function(event){return function(callback){var vcalendar=event.component.parent;backend.saveCalendarResource(state.user(),event.calendar.id,vcalendar.resource,vcalendar.toString(),function(err,data){if(!err){vcalendar.resource.etag=data.headers.etag}callback(err)})}})}calendar.version(calendar.version()+1);async.series(tasks,cb)};return UpdateEventInstanceAction})}());(function(){var define=System.amdDefine;define('calendar/actions/DeleteEventInstanceAction.js',['common/util.js','common/ActionBehavior.js','calendar/ical/TimeZone.js','calendar/ical/Property.js','calendar/actions/ScopeDetectionError.js'],function(util,ActionBehavior,TimeZone,Property,ScopeDetectionError){function DeleteEventInstanceAction(options){util.extend(this,util.pick(options,'eventInstance','data','scope'));ActionBehavior.installInto(this)}var scopes=['this','thisAndFuture','all'];DeleteEventInstanceAction.prototype.validate=function(){if(!this.eventInstance.event.calendar.writable){throw new Error('Only writable calendars can be deleted')}if(this.scope!==null&&typeof this.scope!=='undefined'){if(scopes.indexOf(this.scope)===-1){throw new Error('Unknown scope: '+this.scope+', should be one of: '+scopes.join(', '))}if(this.scope!=='this'){if(!this.eventInstance.event.isRecurring()){throw new Error('scope: '+this.scope+' is only supported for recurring events')}if(this.eventInstance.details.isRecurrenceException()){throw new Error('scope: '+this.scope+' is not supported when deleting a recurrence exception')}if(this.scope==='thisAndFuture'&&(this.eventInstance.first||this.eventInstance.last)){throw new Error('scope: thisAndFuture is not supported on the '+(this.eventInstance.first?'first':'last')+' instance in a series')}}}};DeleteEventInstanceAction.prototype.name='DeleteEventInstanceAction';DeleteEventInstanceAction.prototype.detectScope=function(){var eventInstance=this.eventInstance;if(eventInstance.event.isRecurring()){if(eventInstance.first&&eventInstance.last){return['all']}var result=['this'];if(!eventInstance.details.isRecurrenceException()){result.push('all');if(!eventInstance.first&&!eventInstance.last){result.push('thisAndFuture')}}return result}else{return['this']}};DeleteEventInstanceAction.prototype.removeEvent=function(context,cb){var state=context.state;var backend=context.backend;var eventInstance=this.eventInstance;var event=eventInstance.event;var vcalendar=event.component.parent;var calendar=eventInstance.event.calendar;delete calendar.events[event.uid];calendar.version(calendar.version()+1);backend.deleteCalendarResource(state.user(),calendar.id,vcalendar.resource,cb)};DeleteEventInstanceAction.prototype.removeThisInstance=function(context,cb){var state=context.state;var backend=context.backend;var eventInstance=this.eventInstance;if(eventInstance.first&&eventInstance.last){return this.removeAllInstances(context,cb)}var event=eventInstance.event;var vcalendar=event.component.parent;var calendar=eventInstance.event.calendar;calendar.removeEventInstances(eventInstance);if(eventInstance.details.isRecurrenceException()){var exceptionComponent=eventInstance.details.component;exceptionComponent.parent.removeSubcomponent(exceptionComponent);delete event.exceptions[eventInstance.recurrenceId.toString()];var exceptions=Object.keys(event.exceptions).map(function(recurrenceId){return event.exceptions[recurrenceId]});event.clearExceptions();exceptions.forEach(function(exception){event.relateException(exception)})}event.addExDate(eventInstance.recurrenceId);calendar.version(calendar.version()+1);backend.saveCalendarResource(state.user(),calendar.id,vcalendar.resource,vcalendar.toString(),function(err,data){if(!err){vcalendar.resource.etag=data.headers.etag}cb(err)})};DeleteEventInstanceAction.prototype.removeAllInstances=function(context,cb){var eventInstance=this.eventInstance;var event=eventInstance.event;var calendar=eventInstance.event.calendar;calendar.removeEventInstanceByEvents(event);this.removeEvent(context,cb)};DeleteEventInstanceAction.prototype.removeThisAndFutureInstance=function(context,cb){var state=context.state;var backend=context.backend;var eventInstance=this.eventInstance;var event=eventInstance.event;var calendar=eventInstance.event.calendar;var vcalendar=event.component.parent;event.component.getAllProperties('rrule').forEach(function(property){var rrule=property.getFirstValue();if(typeof rrule.count==='number'){rrule.count=eventInstance.count}else{rrule.until=eventInstance.recurrenceId.clone();rrule.until.day-=1}property.setValue(rrule)});calendar.removeEventInstanceByEvents(event);calendar.version(calendar.version()+1);backend.saveCalendarResource(state.user(),calendar.id,vcalendar.resource,vcalendar.toString(),function(err,data){if(!err){vcalendar.resource.etag=data.headers.etag}cb(err)})};DeleteEventInstanceAction.prototype.execute=function(context,cb){var eventInstance=this.eventInstance;var event=eventInstance.event;var calendar=eventInstance.event.calendar;if(!this.scope){var detectedScopes=this.detectScope();if(detectedScopes.length>1){return cb(new ScopeDetectionError(detectedScopes))}this.scope=detectedScopes[0]}if(event.isRecurring()){switch(this.scope){case'this':return this.removeThisInstance(context,cb);case'all':return this.removeAllInstances(context,cb);case'thisAndFuture':return this.removeThisAndFutureInstance(context,cb)}}else{calendar.removeEventInstances(eventInstance);return this.removeEvent(context,cb)}};return DeleteEventInstanceAction})}());(function(){var define=System.amdDefine;(function(){var async={};var root,previous_async;root=this;if(root!=null){previous_async=root.async}async.noConflict=function(){root.async=previous_async;return async};function only_once(fn){var called=false;return function(){if(called)throw new Error('Callback was already called.');called=true;fn.apply(root,arguments)}}var _toString=Object.prototype.toString;var _isArray=Array.isArray||function(obj){return _toString.call(obj)==='[object Array]'};var _each=function(arr,iterator){if(arr.forEach){return arr.forEach(iterator)}for(var i=0;i<arr.length;i+=1){iterator(arr[i],i,arr)}};var _map=function(arr,iterator){if(arr.map){return arr.map(iterator)}var results=[];_each(arr,function(x,i,a){results.push(iterator(x,i,a))});return results};var _reduce=function(arr,iterator,memo){if(arr.reduce){return arr.reduce(iterator,memo)}_each(arr,function(x,i,a){memo=iterator(memo,x,i,a)});return memo};var _keys=function(obj){if(Object.keys){return Object.keys(obj)}var keys=[];for(var k in obj){if(obj.hasOwnProperty(k)){keys.push(k)}}return keys};if(typeof process==='undefined'||!process.nextTick){if(typeof setImmediate==='function'){async.nextTick=function(fn){setImmediate(fn)};async.setImmediate=async.nextTick}else{async.nextTick=function(fn){setTimeout(fn,0)};async.setImmediate=async.nextTick}}else{async.nextTick=process.nextTick;if(typeof setImmediate!=='undefined'){async.setImmediate=function(fn){setImmediate(fn)}}else{async.setImmediate=async.nextTick}}async.each=function(arr,iterator,callback){callback=callback||function(){};if(!arr.length){return callback()}var completed=0;_each(arr,function(x){iterator(x,only_once(done))});function done(err){if(err){callback(err);callback=function(){}}else{completed+=1;if(completed>=arr.length){callback()}}}};async.forEach=async.each;async.eachSeries=function(arr,iterator,callback){callback=callback||function(){};if(!arr.length){return callback()}var completed=0;var iterate=function(){iterator(arr[completed],function(err){if(err){callback(err);callback=function(){}}else{completed+=1;if(completed>=arr.length){callback()}else{iterate()}}})};iterate()};async.forEachSeries=async.eachSeries;async.eachLimit=function(arr,limit,iterator,callback){var fn=_eachLimit(limit);fn.apply(null,[arr,iterator,callback])};async.forEachLimit=async.eachLimit;var _eachLimit=function(limit){return function(arr,iterator,callback){callback=callback||function(){};if(!arr.length||limit<=0){return callback()}var completed=0;var started=0;var running=0;(function replenish(){if(completed>=arr.length){return callback()}while(running<limit&&started<arr.length){started+=1;running+=1;iterator(arr[started-1],function(err){if(err){callback(err);callback=function(){}}else{completed+=1;running-=1;if(completed>=arr.length){callback()}else{replenish()}}})}}())}};var doParallel=function(fn){return function(){var args=Array.prototype.slice.call(arguments);return fn.apply(null,[async.each].concat(args))}};var doParallelLimit=function(limit,fn){return function(){var args=Array.prototype.slice.call(arguments);return fn.apply(null,[_eachLimit(limit)].concat(args))}};var doSeries=function(fn){return function(){var args=Array.prototype.slice.call(arguments);return fn.apply(null,[async.eachSeries].concat(args))}};var _asyncMap=function(eachfn,arr,iterator,callback){arr=_map(arr,function(x,i){return{index:i,value:x}});if(!callback){eachfn(arr,function(x,callback){iterator(x.value,function(err){callback(err)})})}else{var results=[];eachfn(arr,function(x,callback){iterator(x.value,function(err,v){results[x.index]=v;callback(err)})},function(err){callback(err,results)})}};async.map=doParallel(_asyncMap);async.mapSeries=doSeries(_asyncMap);async.mapLimit=function(arr,limit,iterator,callback){return _mapLimit(limit)(arr,iterator,callback)};var _mapLimit=function(limit){return doParallelLimit(limit,_asyncMap)};async.reduce=function(arr,memo,iterator,callback){async.eachSeries(arr,function(x,callback){iterator(memo,x,function(err,v){memo=v;callback(err)})},function(err){callback(err,memo)})};async.inject=async.reduce;async.foldl=async.reduce;async.reduceRight=function(arr,memo,iterator,callback){var reversed=_map(arr,function(x){return x}).reverse();async.reduce(reversed,memo,iterator,callback)};async.foldr=async.reduceRight;var _filter=function(eachfn,arr,iterator,callback){var results=[];arr=_map(arr,function(x,i){return{index:i,value:x}});eachfn(arr,function(x,callback){iterator(x.value,function(v){if(v){results.push(x)}callback()})},function(err){callback(_map(results.sort(function(a,b){return a.index-b.index}),function(x){return x.value}))})};async.filter=doParallel(_filter);async.filterSeries=doSeries(_filter);async.select=async.filter;async.selectSeries=async.filterSeries;var _reject=function(eachfn,arr,iterator,callback){var results=[];arr=_map(arr,function(x,i){return{index:i,value:x}});eachfn(arr,function(x,callback){iterator(x.value,function(v){if(!v){results.push(x)}callback()})},function(err){callback(_map(results.sort(function(a,b){return a.index-b.index}),function(x){return x.value}))})};async.reject=doParallel(_reject);async.rejectSeries=doSeries(_reject);var _detect=function(eachfn,arr,iterator,main_callback){eachfn(arr,function(x,callback){iterator(x,function(result){if(result){main_callback(x);main_callback=function(){}}else{callback()}})},function(err){main_callback()})};async.detect=doParallel(_detect);async.detectSeries=doSeries(_detect);async.some=function(arr,iterator,main_callback){async.each(arr,function(x,callback){iterator(x,function(v){if(v){main_callback(true);main_callback=function(){}}callback()})},function(err){main_callback(false)})};async.any=async.some;async.every=function(arr,iterator,main_callback){async.each(arr,function(x,callback){iterator(x,function(v){if(!v){main_callback(false);main_callback=function(){}}callback()})},function(err){main_callback(true)})};async.all=async.every;async.sortBy=function(arr,iterator,callback){async.map(arr,function(x,callback){iterator(x,function(err,criteria){if(err){callback(err)}else{callback(null,{value:x,criteria:criteria})}})},function(err,results){if(err){return callback(err)}else{var fn=function(left,right){var a=left.criteria,b=right.criteria;return a<b?-1:a>b?1:0};callback(null,_map(results.sort(fn),function(x){return x.value}))}})};async.auto=function(tasks,callback){callback=callback||function(){};var keys=_keys(tasks);var remainingTasks=keys.length;if(!remainingTasks){return callback()}var results={};var listeners=[];var addListener=function(fn){listeners.unshift(fn)};var removeListener=function(fn){for(var i=0;i<listeners.length;i+=1){if(listeners[i]===fn){listeners.splice(i,1);return}}};var taskComplete=function(){remainingTasks--;_each(listeners.slice(0),function(fn){fn()})};addListener(function(){if(!remainingTasks){var theCallback=callback;callback=function(){};theCallback(null,results)}});_each(keys,function(k){var task=_isArray(tasks[k])?tasks[k]:[tasks[k]];var taskCallback=function(err){var args=Array.prototype.slice.call(arguments,1);if(args.length<=1){args=args[0]}if(err){var safeResults={};_each(_keys(results),function(rkey){safeResults[rkey]=results[rkey]});safeResults[k]=args;callback(err,safeResults);callback=function(){}}else{results[k]=args;async.setImmediate(taskComplete)}};var requires=task.slice(0,Math.abs(task.length-1))||[];var ready=function(){return _reduce(requires,function(a,x){return a&&results.hasOwnProperty(x)},true)&&!results.hasOwnProperty(k)};if(ready()){task[task.length-1](taskCallback,results)}else{var listener=function(){if(ready()){removeListener(listener);task[task.length-1](taskCallback,results)}};addListener(listener)}})};async.retry=function(times,task,callback){var DEFAULT_TIMES=5;var attempts=[];if(typeof times==='function'){callback=task;task=times;times=DEFAULT_TIMES}times=parseInt(times,10)||DEFAULT_TIMES;var wrappedTask=function(wrappedCallback,wrappedResults){var retryAttempt=function(task,finalAttempt){return function(seriesCallback){task(function(err,result){seriesCallback(!err||finalAttempt,{err:err,result:result})},wrappedResults)}};while(times){attempts.push(retryAttempt(task,!(times-=1)))}async.series(attempts,function(done,data){data=data[data.length-1];(wrappedCallback||callback)(data.err,data.result)})};return callback?wrappedTask():wrappedTask};async.waterfall=function(tasks,callback){callback=callback||function(){};if(!_isArray(tasks)){var err=new Error('First argument to waterfall must be an array of functions');return callback(err)}if(!tasks.length){return callback()}var wrapIterator=function(iterator){return function(err){if(err){callback.apply(null,arguments);callback=function(){}}else{var args=Array.prototype.slice.call(arguments,1);var next=iterator.next();if(next){args.push(wrapIterator(next))}else{args.push(callback)}async.setImmediate(function(){iterator.apply(null,args)})}}};wrapIterator(async.iterator(tasks))()};var _parallel=function(eachfn,tasks,callback){callback=callback||function(){};if(_isArray(tasks)){eachfn.map(tasks,function(fn,callback){if(fn){fn(function(err){var args=Array.prototype.slice.call(arguments,1);if(args.length<=1){args=args[0]}callback.call(null,err,args)})}},callback)}else{var results={};eachfn.each(_keys(tasks),function(k,callback){tasks[k](function(err){var args=Array.prototype.slice.call(arguments,1);if(args.length<=1){args=args[0]}results[k]=args;callback(err)})},function(err){callback(err,results)})}};async.parallel=function(tasks,callback){_parallel({map:async.map,each:async.each},tasks,callback)};async.parallelLimit=function(tasks,limit,callback){_parallel({map:_mapLimit(limit),each:_eachLimit(limit)},tasks,callback)};async.series=function(tasks,callback){callback=callback||function(){};if(_isArray(tasks)){async.mapSeries(tasks,function(fn,callback){if(fn){fn(function(err){var args=Array.prototype.slice.call(arguments,1);if(args.length<=1){args=args[0]}callback.call(null,err,args)})}},callback)}else{var results={};async.eachSeries(_keys(tasks),function(k,callback){tasks[k](function(err){var args=Array.prototype.slice.call(arguments,1);if(args.length<=1){args=args[0]}results[k]=args;callback(err)})},function(err){callback(err,results)})}};async.iterator=function(tasks){var makeCallback=function(index){var fn=function(){if(tasks.length){tasks[index].apply(null,arguments)}return fn.next()};fn.next=function(){return index<tasks.length-1?makeCallback(index+1):null};return fn};return makeCallback(0)};async.apply=function(fn){var args=Array.prototype.slice.call(arguments,1);return function(){return fn.apply(null,args.concat(Array.prototype.slice.call(arguments)))}};var _concat=function(eachfn,arr,fn,callback){var r=[];eachfn(arr,function(x,cb){fn(x,function(err,y){r=r.concat(y||[]);cb(err)})},function(err){callback(err,r)})};async.concat=doParallel(_concat);async.concatSeries=doSeries(_concat);async.whilst=function(test,iterator,callback){if(test()){iterator(function(err){if(err){return callback(err)}async.whilst(test,iterator,callback)})}else{callback()}};async.doWhilst=function(iterator,test,callback){iterator(function(err){if(err){return callback(err)}var args=Array.prototype.slice.call(arguments,1);if(test.apply(null,args)){async.doWhilst(iterator,test,callback)}else{callback()}})};async.until=function(test,iterator,callback){if(!test()){iterator(function(err){if(err){return callback(err)}async.until(test,iterator,callback)})}else{callback()}};async.doUntil=function(iterator,test,callback){iterator(function(err){if(err){return callback(err)}var args=Array.prototype.slice.call(arguments,1);if(!test.apply(null,args)){async.doUntil(iterator,test,callback)}else{callback()}})};async.queue=function(worker,concurrency){if(concurrency===undefined){concurrency=1}function _insert(q,data,pos,callback){if(!q.started){q.started=true}if(!_isArray(data)){data=[data]}if(data.length==0){return async.setImmediate(function(){if(q.drain){q.drain()}})}_each(data,function(task){var item={data:task,callback:typeof callback==='function'?callback:null};if(pos){q.tasks.unshift(item)}else{q.tasks.push(item)}if(q.saturated&&q.tasks.length===q.concurrency){q.saturated()}async.setImmediate(q.process)})}var workers=0;var q={tasks:[],concurrency:concurrency,saturated:null,empty:null,drain:null,started:false,paused:false,push:function(data,callback){_insert(q,data,false,callback)},kill:function(){q.drain=null;q.tasks=[]},unshift:function(data,callback){_insert(q,data,true,callback)},process:function(){if(!q.paused&&workers<q.concurrency&&q.tasks.length){var task=q.tasks.shift();if(q.empty&&q.tasks.length===0){q.empty()}workers+=1;var next=function(){workers-=1;if(task.callback){task.callback.apply(task,arguments)}if(q.drain&&q.tasks.length+workers===0){q.drain()}q.process()};var cb=only_once(next);worker(task.data,cb)}},length:function(){return q.tasks.length},running:function(){return workers},idle:function(){return q.tasks.length+workers===0},pause:function(){if(q.paused===true){return}q.paused=true;q.process()},resume:function(){if(q.paused===false){return}q.paused=false;q.process()}};return q};async.priorityQueue=function(worker,concurrency){function _compareTasks(a,b){return a.priority-b.priority};function _binarySearch(sequence,item,compare){var beg=-1,end=sequence.length-1;while(beg<end){var mid=beg+(end-beg+1>>>1);if(compare(item,sequence[mid])>=0){beg=mid}else{end=mid-1}}return beg}function _insert(q,data,priority,callback){if(!q.started){q.started=true}if(!_isArray(data)){data=[data]}if(data.length==0){return async.setImmediate(function(){if(q.drain){q.drain()}})}_each(data,function(task){var item={data:task,priority:priority,callback:typeof callback==='function'?callback:null};q.tasks.splice(_binarySearch(q.tasks,item,_compareTasks)+1,0,item);if(q.saturated&&q.tasks.length===q.concurrency){q.saturated()}async.setImmediate(q.process)})}var q=async.queue(worker,concurrency);q.push=function(data,priority,callback){_insert(q,data,priority,callback)};delete q.unshift;return q};async.cargo=function(worker,payload){var working=false,tasks=[];var cargo={tasks:tasks,payload:payload,saturated:null,empty:null,drain:null,drained:true,push:function(data,callback){if(!_isArray(data)){data=[data]}_each(data,function(task){tasks.push({data:task,callback:typeof callback==='function'?callback:null});cargo.drained=false;if(cargo.saturated&&tasks.length===payload){cargo.saturated()}});async.setImmediate(cargo.process)},process:function process(){if(working)return;if(tasks.length===0){if(cargo.drain&&!cargo.drained)cargo.drain();cargo.drained=true;return}var ts=typeof payload==='number'?tasks.splice(0,payload):tasks.splice(0,tasks.length);var ds=_map(ts,function(task){return task.data});if(cargo.empty)cargo.empty();working=true;worker(ds,function(){working=false;var args=arguments;_each(ts,function(data){if(data.callback){data.callback.apply(null,args)}});process()})},length:function(){return tasks.length},running:function(){return working}};return cargo};var _console_fn=function(name){return function(fn){var args=Array.prototype.slice.call(arguments,1);fn.apply(null,args.concat([function(err){var args=Array.prototype.slice.call(arguments,1);if(typeof console!=='undefined'){if(err){if(console.error){;}}else if(console[name]){_each(args,function(x){;})}}}]))}};async.log=_console_fn('log');async.dir=_console_fn('dir');async.memoize=function(fn,hasher){var memo={};var queues={};hasher=hasher||function(x){return x};var memoized=function(){var args=Array.prototype.slice.call(arguments);var callback=args.pop();var key=hasher.apply(null,args);if(key in memo){async.nextTick(function(){callback.apply(null,memo[key])})}else if(key in queues){queues[key].push(callback)}else{queues[key]=[callback];fn.apply(null,args.concat([function(){memo[key]=arguments;var q=queues[key];delete queues[key];for(var i=0,l=q.length;i<l;i++){q[i].apply(null,arguments)}}]))}};memoized.memo=memo;memoized.unmemoized=fn;return memoized};async.unmemoize=function(fn){return function(){return(fn.unmemoized||fn).apply(null,arguments)}};async.times=function(count,iterator,callback){var counter=[];for(var i=0;i<count;i++){counter.push(i)}return async.map(counter,iterator,callback)};async.timesSeries=function(count,iterator,callback){var counter=[];for(var i=0;i<count;i++){counter.push(i)}return async.mapSeries(counter,iterator,callback)};async.seq=function(){var fns=arguments;return function(){var that=this;var args=Array.prototype.slice.call(arguments);var callback=args.pop();async.reduce(fns,args,function(newargs,fn,cb){fn.apply(that,newargs.concat([function(){var err=arguments[0];var nextargs=Array.prototype.slice.call(arguments,1);cb(err,nextargs)}]))},function(err,results){callback.apply(that,[err].concat(results))})}};async.compose=function(){return async.seq.apply(null,Array.prototype.reverse.call(arguments))};var _applyEach=function(eachfn,fns){var go=function(){var that=this;var args=Array.prototype.slice.call(arguments);var callback=args.pop();return eachfn(fns,function(fn,cb){fn.apply(that,args.concat([cb]))},callback)};if(arguments.length>2){var args=Array.prototype.slice.call(arguments,2);return go.apply(this,args)}else{return go}};async.applyEach=doParallel(_applyEach);async.applyEachSeries=doSeries(_applyEach);async.forever=function(fn,callback){function next(err){if(err){if(callback){return callback(err)}throw err}fn(next)}next()};if(typeof module!=='undefined'&&module.exports){module.exports=async}else if(typeof define!=='undefined'&&define.amd){define('3rdparty/async.js',[],function(){return async})}else{root.async=async}}())}());(function(){var define=System.amdDefine;(function(root,factory){if(typeof exports==='object'){module.exports=factory()}else if(typeof define==='function'&&define.amd){define('3rdparty/Failboat.js',[],factory)}else{root.com=root.com||{};root.com.one=root.com.one||{};root.com.one.FailBoat=factory()}}(this,function(){function Failboat(routes,context,parent){this.routes=Object.keys(routes||{}).reduce(function(result,key){var handler=routes[key];key.split(/\s*,\s*/).forEach(function(route){result[route]=handler});return result},{});this._context=context||{};this._parent=parent||null}function score(tags,route){var routeSegments=route.split(' ');if(routeSegments.length>tags.length){return 0}var matching=routeSegments.every(function(routeSegment,index){return tags[index]===routeSegment});return matching?routeSegments.length:0}function maxBy(arr,selector){return arr.reduce(function(max,current){return max[selector]<current[selector]?current:max})}Failboat.prototype.emitErrorRouted=function(err,matchingRoute){if(this.onErrorRouted){this.onErrorRouted.call(this._context,err,matchingRoute)}};Failboat.prototype.parents=function(){var parent=this._parent;return parent?[parent].concat(parent.parents()):[]};Failboat.prototype.convoy=function(){return[this].concat(this.parents())};Failboat.prototype.routeError=function(tags,err){var matchingRoute=null;var routesWithScore=Object.keys(this.routes).map(function(route){return{score:score(tags,route),route:route}}).filter(function(routeWithScore){return routeWithScore.score>0});if(routesWithScore.length>0){matchingRoute=maxBy(routesWithScore,'score').route}else if('*'in this.routes){matchingRoute='*'}if(matchingRoute){var handler=this.routes[matchingRoute];if(typeof handler==='string'){var alias=handler;return this.routeError(alias.split(' '),err)}else{handler.call(this._context,err)}this.convoy().forEach(function(failboat){failboat.emitErrorRouted(err,matchingRoute)});return true}else{this.emitErrorRouted(err,matchingRoute);if(this._parent){return this._parent.routeError(tags,err)}else{return false}}};Failboat.prototype.handleError=function(err,routes){if(routes){return this.extend(routes).handleError(err)}if(!err){return this}if(!Array.isArray(err.tags)){throw new Error('Failboat.handleError requires a tagged error object as the first argument')}return this.routeError(err.tags,err)};var tagRegexp=/^\w+$/;Failboat.tag=function(err){if(err===null||typeof err!=='object'){throw new Error('Failboat.tag requires an object as the first paramenter')}var tags=Array.prototype.slice.call(arguments,1);tags.forEach(function(tag){var type=typeof tag;if(type!=='string'&&type!=='number'){throw new Error('Failboat.tag require tags to be strings or numbers was given: "'+tag+'"')}});tags=tags.map(function(tag){return''+tag}).reduce(function(tags,tag){return tags.concat(tag.split(' '))},[]).filter(function(tag){return tag.length>0});tags.forEach(function(tag){if(!tag.match(tagRegexp)){throw new Error('Failboat.tag require tags to be strings or numbers without special characters was given: "'+tag+'"')}});err.tags=(err.tags||[]).concat(tags);return err};Failboat.prototype.extend=function(routes){return new Failboat(routes,this._context,this)};return Failboat}))}());(function(){var define=System.amdDefine;define('calendar/actions/ScopeDetectionError.js',['3rdparty/Failboat.js'],function(Failboat){function ScopeDetectionError(possibleScopes){Failboat.tag(this,'SCOPE_DETECTION_ERROR');this.possibleScopes=possibleScopes}ScopeDetectionError.prototype=new Error;return ScopeDetectionError})}());(function(){var define=System.amdDefine;define('calendar/ical/Component.js',['3rdparty/ical.js'],function(ical){return ical.Component})}());(function(){var define=System.amdDefine;define('calendar/ical/helpers.js',['3rdparty/ical.js'],function(ical){return ical.helpers})}());(function(){var define=System.amdDefine;define('calendar/actions/CreateEventAction.js',['3rdparty/async.js','common/util.js','common/ActionBehavior.js','calendar/actions/ScopeDetectionError.js','calendar/actions/UpdateCalendarAction.js','calendar/model/RecurrenceRule.js','calendar/ical/Duration.js','calendar/ical/Recur.js','calendar/ical/Event.js','calendar/ical/Component.js','calendar/ical/TimeZone.js','calendar/ical/Property.js','calendar/ical/helpers.js'],function(async,util,ActionBehavior,ScopeDetectionError,UpdateCalendarAction,RecurrenceRule,Duration,Recur,Event,Component,TimeZone,Property,icalHelpers){function CreateEventAction(options){util.extend(this,util.pick(options,'data'));ActionBehavior.installInto(this);this.calendar=this.data.calendar}CreateEventAction.prototype.name='CreateEventAction';CreateEventAction.prototype.createEvent=function(context,data){var state=context.state;var event=new Event;['summary','description','location'].forEach(function(property){if(data[property]){event[property]=data[property]}});['startDate','endDate'].forEach(function(property){var time=data[property];if(time.isDate){event[property]=time.convertToZone(TimeZone.localTimezone)}else{event[property]=time.convertToZone(state.timeZone())}},this);event.uid=this.createUuid();event.creationTime=state.now().clone().convertToZone(TimeZone.utcTimeZone);if(data.recur){var recurrenceRule=new RecurrenceRule(Recur.fromData(data.recur));recurrenceRule.normalizeUntil(event.startDate);var rruleProperty=new Property('rrule');rruleProperty.setValue(recurrenceRule.rrule);event.component.addProperty(rruleProperty)}return event};CreateEventAction.prototype.validate=function(){if(!this.calendar){throw new Error('A calendar for the event need to be defined')}if(!this.calendar.writable){throw new Error('Only writable calendars can be updated')}};CreateEventAction.prototype.createUuid=function(){return util.uuid()};CreateEventAction.prototype.execute=function(context,cb){var that=this;var state=context.state;var backend=context.backend;var event=that.createEvent(context,that.data);var calendar=that.calendar;if(!calendar.enabled()){calendar.enabled(true);new UpdateCalendarAction({calendar:calendar,data:{enabled:true}}).execute(context,function(err){if(err){that.handleError(err)}})}var vcalendar=Component.fromString('BEGIN:VCALENDAR\n'+'VERSION:2.0\n'+'PRODID:One.com Calendar\n'+'CALSCALE:GREGORIAN\n'+'END:VCALENDAR');vcalendar.resource={id:event.uid+'.ics'};that.eventsToAdd=[event];vcalendar.addSubcomponent(state.timeZone().component);vcalendar.addSubcomponent(event.component);async.each(that.eventsToAdd,function(event,callback){backend.saveCalendarResource(state.user(),calendar.id,{id:vcalendar.resource.id},vcalendar.toString(),function(err,data){if(!err){vcalendar.resource.etag=data.headers.etag;that.eventsToAdd.forEach(function(event){calendar.addEvent(event)});calendar.version(calendar.version()+1)}callback(err)})},cb)};return CreateEventAction})}());(function(){var define=System.amdDefine;define('calendar/ical/Property.js',['3rdparty/ical.js'],function(ical){return ical.Property})}());(function(){var define=System.amdDefine;define('calendar/ical/Recur.js',['3rdparty/ical.js'],function(ical){return ical.Recur})}());(function(){var define=System.amdDefine;define('calendar/model/RecurrenceRule.js',['node_modules/knockout/build/output/knockout-latest.debug.js','calendar/ical/Recur.js'],function(ko,Recur){function RecurrenceRule(rrule){var that=this;that.rrule=rrule.clone()}RecurrenceRule.supportedFrequencies=['yearly','monthly','weekly','daily'];RecurrenceRule.prototype.normalizeUntil=function(dtstart){var rrule=this.rrule;var until=rrule.until;if(until&&dtstart&&rrule){rrule.until=null;var deadline=until;if(deadline.isDate){if(!dtstart.isDate){deadline=deadline.clone().dayAfter()}}else{if(dtstart.isDate){deadline=deadline.clone().startOfDay();deadline.isDate=true}else{deadline=deadline.clone().dayAfter().startOfDay();deadline.isDate=false}}var iterator=rrule.iterator(dtstart);iterator.next();var lastInstanceStartTime;do{if(iterator.last.compare(deadline)>0){break}else{lastInstanceStartTime=iterator.last.clone()}}while(iterator.next());rrule.until=lastInstanceStartTime||until}};RecurrenceRule.prototype.isEmpty=function(){return!this.rrule.freq};RecurrenceRule.prototype.tooComplex=function(){if(this.isEmpty()){return}if(this.rrule.freq&&RecurrenceRule.supportedFrequencies.indexOf(this.rrule.freq.toLowerCase())===-1){return true}var parts=this.rrule.parts&&this.rrule.parts;var illegalParts=['bysecond','byminute','byhour','byyearday','byweekno','bysetpos'];var hasIllegalParts=illegalParts.some(function(bypart){return parts&&parts[bypart.toUpperCase()]});if(hasIllegalParts){return true}return false};RecurrenceRule.prototype.toLocaleString=function(startDate,globalPreferences){var weekStart=globalPreferences.weekStart;var weekendStart=globalPreferences.weekendStart;var freq=this.rrule.freq;if(this.isEmpty()){return''}if(this.tooComplex()){return TR('calendar.RecurrenceRule.TooComplex','Complex repetition rule')}var frequencyString=freq.toLowerCase();var arg;var byday=this.rrule.getComponent('byday');var bymonthday=this.rrule.getComponent('bymonthday');var dayNames=inter.calendars.gregorian.dayNames.standAlone.wide;var weekDays=['SU','MO','TU','WE','TH','FR','SA','SU','MO','TU','WE','TH','FR','SA'];function zeroIndexedIcalDayNumber(iCalDay){return weekDays.indexOf(iCalDay)}if(byday&&byday.length){byday=byday.filter(function(iCalDay,index,bydayArray){return index===bydayArray.indexOf(iCalDay)});byday.sort(function(a,b){return(zeroIndexedIcalDayNumber(a.match(/(MO|TU|WE|TH|FR|SA|SU)$/)[1])+7-weekStart)%7-(zeroIndexedIcalDayNumber(b.match(/(MO|TU|WE|TH|FR|SA|SU)$/)[1])+7-weekStart)%7});var isWeekdaysOnly=true;byday.forEach(function(iCalDay){var dayNo=zeroIndexedIcalDayNumber(iCalDay);if(dayNo===weekendStart||dayNo===(weekendStart+1)%7){isWeekdaysOnly=false}});if(byday.length===7){arg=TR('calendar.RecurrenceRule.AllDays','all days')}else if(byday.length>=5){if(isWeekdaysOnly){if(freq===RecurrenceRule.frequencies.daily){frequencyString='dailyWeekdays'}else{arg=TR('calendar.RecurrenceRule.Weekdays','weekdays')}}else{var daysOfTheWeek=weekDays.slice(weekStart,weekStart+7);var daysNotSeen=daysOfTheWeek.filter(function(val){return byday.indexOf(val)===-1});arg=TR.PAT('calendar.RecurrenceRule.AllDaysExcept','all days except {0}')(inter.renderList(daysNotSeen.map(function(iCalDay){return dayNames[zeroIndexedIcalDayNumber(iCalDay)]})))}}else{arg=inter.renderList(byday.map(function(iCalDay){var m=iCalDay.match(/^(-1|[1-9][0-9]*)?(MO|TU|WE|TH|FR|SA|SU)$/);if(m){var no=parseInt(m[1],10);var weekDayNo=zeroIndexedIcalDayNumber(m[2]);if(no){if(no===-1){var lastDayPattern=TR.PAT('calendar.RecurrenceRule.ByLastDay','the last {0}');return lastDayPattern(dayNames[weekDayNo])}else{var otherDayPattern=TR.PAT('calendar.RecurrenceRule.ByDay','the {0} {1}');return otherDayPattern(RecurrenceRule.dayOfTheMonthOrdinals[no-1],dayNames[weekDayNo])}}else{return dayNames[weekDayNo]}}}))}}else if(bymonthday&&bymonthday.length){arg=inter.renderList(bymonthday.map(function(monthDay){return TR.PAT('calendar.RecurrenceRule.ByMonthDay','day {0}')(monthDay)}))}else if(freq===RecurrenceRule.frequencies.weekly){arg=dayNames[zeroIndexedIcalDayNumber(startDate.dayOfWeekId())]}else if(freq===RecurrenceRule.frequencies.monthly){arg=TR.PAT('calendar.RecurrenceRule.ByMonthDay','day {0}')(startDate.day)}else if(freq===RecurrenceRule.frequencies.yearly){arg=inter.renderDate(startDate,'MMMMd')}var components=[inter.trQuantity(RecurrenceRule.parameterizedIntervalPatternByFrequencyAndQuantity[frequencyString],this.rrule.interval||1,arg)];if(this.rrule.until){var untilPattern=TR.PAT('calendar.RecurrenceRule.Until','until {0}');var untilFormattedDate=inter.renderDate(this.rrule.until,'longDate');components.push(untilPattern(untilFormattedDate))}else if(this.rrule.count){components.push(inter.trQuantity(TR('calendar.RecurrenceRule.Count',{one:'for one occurrence',other:'for {0} occurrences'}),this.rrule.count))}return components.join(', ')};var frequencies={daily:'DAILY',weekly:'WEEKLY',monthly:'MONTHLY',yearly:'YEARLY'};Object.defineProperty(RecurrenceRule,'frequencies',{get:function(){return frequencies}});var dayOfTheMonthOrdinals=TR('calendar.RecurrenceRule.DayOfTheMonthOrdinals',['1st','2nd','3rd','4th','5th','6th','7th','8th','9th','10th','11th','12th','13th','14th','15th','16th','17th','18th','19th','20th','21st','22nd','23rd','24th','25th','26th','27th','28th','29th','30th','31st']);Object.defineProperty(RecurrenceRule,'dayOfTheMonthOrdinals',{get:function(){return dayOfTheMonthOrdinals}});var intervalPatternByFrequencyAndQuantity=TR('calendar.RecurrenceRule.IntervalPatternByFrequencyAndQuantity',{dailyWeekdays:{one:'Daily on weekdays',other:'Every {0} weekdays'},daily:{one:'Daily',other:'Every {0} days'},weekly:{one:'Weekly',other:'Every {0} weeks'},monthly:{one:'Monthly',other:'Every {0} months'},yearly:{one:'Yearly',other:'Every {0} years'}});Object.defineProperty(RecurrenceRule,'intervalPatternByFrequencyAndQuantity',{get:function(){return intervalPatternByFrequencyAndQuantity}});var parameterizedIntervalPatternByFrequencyAndQuantity=TR('calendar.RecurrenceRule.ParameterizedIntervalPatternByFrequencyAndQuantity',{daily:{one:'Daily',other:'Every {0} days'},dailyWeekdays:{one:'Daily on weekdays',other:'Every {0} weekdays'},monthly:{one:'Monthly on {1}',other:'Every {0} months on {1}'},weekly:{one:'Weekly on {1}',other:'Every {0} weeks on {1}'},yearly:{one:'Yearly on {1}',other:'Every {0} years on {1}'}});Object.defineProperty(RecurrenceRule,'parameterizedIntervalPatternByFrequencyAndQuantity',{get:function(){return parameterizedIntervalPatternByFrequencyAndQuantity}});return RecurrenceRule})}());(function(){var define=System.amdDefine;define('calendar/ical/Event.js',['3rdparty/ical.js','calendar/ical/Property.js','calendar/ical/TimeZone.js','calendar/model/RecurrenceRule.js'],function(ical,Property,TimeZone,RecurrenceRule){Object.defineProperty(ical.Event.prototype,'creationTime',{get:function(){return this._firstProp('dtstamp')},set:function(value){this._setTime('dtstamp',value)}});Object.defineProperty(ical.Event.prototype,'recurrenceId',{get:function(){return this._firstProp('recurrence-id')},set:function(value){this._setTime('recurrence-id',value)}});Object.defineProperty(ical.Event.prototype,'recurrence',{get:function(){var rrule=this._firstProp('rrule');return rrule&&new RecurrenceRule(rrule)}});ical.Event.prototype.clearExceptions=function(){this._rangeExceptionCache=Object.create(null);this.exceptions=Object.create(null);this.rangeExceptions=[]};ical.Event.prototype.addExDate=function(date){var property=new Property('exdate');if(date.zone!==TimeZone.localTimeZone&&date.zone!==TimeZone.utcTimeZone){property.setParameter('tzid',date.zone.tzid)}property.setValue(date.clone());this.component.addProperty(property)};return ical.Event})}());(function(){var define=System.amdDefine;define('calendar/model/EventInstance.js',['calendar/ical/Event.js','calendar/ical/Time.js','calendar/ical/Duration.js'],function(Event,Time,Duration){var oneDay=Duration.fromData({days:1});function EventInstance(data){this.recurrenceId=data.recurrenceId;this.startDate=data.startDate;this.endDate=data.endDate;this.details=data.details;this.event=data.event}EventInstance.prototype.isAllDay=function(){return oneDay.compare(this.details.duration)<=0};EventInstance.prototype.isTimeDelimited=function(){return!this.startDate.isDate||!this.endDate.isDate};EventInstance.prototype.isNew=function(){return!(this.details&&this.details.uid||this.event&&this.event.uid)};EventInstance.prototype.isReadonly=function(){return!this.isNew()&&(this.calendar.extern||!this.calendar.writable)};EventInstance.prototype.createException=function(){var exception=new Event;exception.uid=this.event.uid;exception.startDate=this.startDate;exception.endDate=this.endDate;exception.recurrenceId=this.recurrenceId;exception.creationTime=Time.fromJSDate(new Date,true);return exception};['summary','description','location'].forEach(function(property){Object.defineProperty(EventInstance.prototype,property,{get:function(){if(this.details&&property in this.details&&this.details[property]!==null){return this.details[property]}if(property in this.event){return this.event[property]}return null}})});EventInstance.prototype.removeFromCalendar=function(){this.event.calendar.removeEventInstances(this)};EventInstance.prototype.startDateAsZone=function(timeZone){return this.startDate&&this.startDate.convertToZone(timeZone)};EventInstance.prototype.endDateAsZone=function(timeZone){return this.endDate&&this.endDate.convertToZone(timeZone)};EventInstance.toDisplayEndDate=function(endDate){return endDate&&endDate.isDate?endDate.addDuration(Duration.fromData({days:1})):endDate};Object.defineProperty(EventInstance.prototype,'calendar',{get:function(){return this.event.calendar}});Object.defineProperty(EventInstance.prototype,'displayStartDate',{get:function(){return this.startDate},set:function(newStartDate){this.startDate=newStartDate}});Object.defineProperty(EventInstance.prototype,'displayEndDate',{get:function(){return this.endDate&&this.endDate.isDate?this.endDate.clone().addDuration(Duration.fromData({days:-1})):this.endDate},set:function(newEndDate){this.endDate=EventInstance.toDisplayEndDate(newEndDate)}});return EventInstance})}());(function(){var define=System.amdDefine;(function(factory){if(typeof require==='function'&&typeof exports==='object'&&typeof module==='object'){factory(require('knockout'),exports)}else if(typeof define==='function'&&define['amd']){define('3rdparty/knockout-extensions/knockout.editables.js',['node_modules/knockout/build/output/knockout-latest.debug.js','exports'],factory)}else{factory(ko)}}(function(ko){var deferredDependentObservable=function(readFunction){return ko.dependentObservable({read:readFunction,deferEvaluation:true})};var defaultScope='';var editableObservables={_observables:{},add:function(scope,observable){if(!this._observables.hasOwnProperty(scope)){this._observables[scope]=ko.observableArray()}this._observables[scope].push(observable)},get:function(scope){scope=scope===undefined?defaultScope:scope;if(!this._observables.hasOwnProperty(scope)){throw new Error('Unknown scope '+scope)}return ko.utils.unwrapObservable(this._observables[scope])}};editableObservables._observables[defaultScope]=ko.observableArray();function newScope(){return'_scope'+ ++newScope.counter}newScope.counter=0;var comparers={'scalar':function(actualValue,originalValue){return actualValue==originalValue},'array':function(actualValue,originalValue){actualValue=actualValue||[];originalValue=originalValue||[];if(actualValue.length!=originalValue.length){return false}for(var i=0;i<actualValue.length;i++){if(actualValue[i]!==originalValue[i]){return false}}return true}};var defaultParams={enable:true,scope:defaultScope};ko.extenders['editable']=function(target,params){if(target.hasOwnProperty('editable')){return target}if(typeof params!='object'){params={enable:params===undefined?true:params,scope:defaultScope}}else{params=ko.utils.extend(ko.utils.extend({},defaultParams),params)}target.editable=params.enable;if(!target.editable){return target}var oldValue;var equalityComparer=params.equalityComparer||comparers['scalar'];var inTransaction=target.inTransaction=ko.observable(false);target.beginEdit=function(){if(inTransaction()){return}var currentValue=target();if(currentValue instanceof Array){currentValue=currentValue.slice();equalityComparer=comparers['array']}oldValue=currentValue;inTransaction(true)};target.commit=function(){inTransaction(false)};target.rollback=function(){if(inTransaction()){target(oldValue);inTransaction(false)}};target.oldValue=function(){return oldValue};target.hasChanges=deferredDependentObservable(function(){var hasChanges=inTransaction()&&!equalityComparer(target(),oldValue);return hasChanges});if(params.scope!==false){editableObservables.add(params.scope,target)}return target};function makeEditable(rootObject,scope,editables,processedObjects){processedObjects=processedObjects||[];for(var propertyName in rootObject){var propertyValue=rootObject[propertyName];if(ko.isWriteableObservable(propertyValue)){if(propertyValue.editable!==false){propertyValue.extend({editable:{enable:true,scope:scope}});editables.push(propertyValue)}}if(ko.utils.arrayIndexOf(processedObjects,propertyValue)>-1){continue}processedObjects.push(propertyValue);var underlyingPropertyValue=ko.utils.unwrapObservable(propertyValue);if(typeof underlyingPropertyValue=='object'){var isObservable=ko.isObservable(propertyValue);if(isObservable){if(ko.utils.arrayIndexOf(processedObjects,underlyingPropertyValue)>-1){continue}processedObjects.push(underlyingPropertyValue)}makeEditable(underlyingPropertyValue,scope,editables,processedObjects)}}};ko.editable=function(viewModel,autoInit){if(typeof viewModel.beginEdit=='function'){return}autoInit=autoInit===undefined?true:autoInit;var allEditables=ko.observableArray();viewModel.beginEdit=function(){ko.utils.arrayForEach(allEditables(),function(obj){obj.beginEdit()})};viewModel.commit=function(){ko.utils.arrayForEach(allEditables(),function(obj){obj.commit()})};viewModel.rollback=function(){ko.utils.arrayForEach(allEditables(),function(obj){obj.rollback()})};viewModel.hasChanges=deferredDependentObservable(function(){var editableWithChanges=ko.utils.arrayFirst(allEditables(),function(editable){return editable.hasChanges()});return editableWithChanges!=null});var scope=newScope();viewModel.addEditable=function(obj){makeEditable(obj,scope,allEditables,[])};if(autoInit){makeEditable(viewModel,scope,allEditables,[])}};ko.editable.enable=function(object,scope){if(scope===undefined){scope=defaultScope}makeEditable(object,scope,[])};ko.editable.beginEdit=function(scope){ko.utils.arrayForEach(editableObservables.get(scope),function(observable){observable.beginEdit()})};ko.editable.commit=function(scope){ko.utils.arrayForEach(editableObservables.get(scope),function(observable){observable.commit()})};ko.editable.rollback=function(scope){ko.utils.arrayForEach(editableObservables.get(scope),function(observable){observable.rollback()})};ko.editable.hasChanges=function(scope){var observables=editableObservables.get(scope);for(var i=0,l=observables.length;i<l;i++){if(observables[i].hasChanges()){return true}}return false};ko.editable._editables=editableObservables;ko.editable.getHasChangesFlag=function(scope){return deferredDependentObservable(function(){return ko.editable.hasChanges(scope)}).extend({throttle:100})}}))}());System.registerDynamic('components/inPlaceEditor/inPlaceEditor.ko',[],true,function($__require,exports,module){var define,global=this||self,GLOBAL=global;module.exports=function injectTemplate(tpl){var s=document.createElement('script');s.id=tpl.id;s.innerHTML=window.TR?TR.HTML(tpl.content):tpl.content;s.type='text/html';document.head.appendChild(s)}({'id':'inPlaceEditor','content':'<div class="in-place-editor-content" data-bind="css: { multiline: isMultiline }">\n    <!-- ko if: placeholder -->\n    <span class="floating-placeholder" data-bind="css: { \'float\': float }, text: placeholder"></span>\n    <!-- /ko -->\n    <!-- ko if: isMultiline -->\n        <!-- ko if: !!autocomplete -->\n        <textarea rows="1"\n                  data-bind="disable: disabled,\n                             hasFocus: focused,\n                             textInput: value,\n                             autoExpand: value,\n                             attr: { tabindex: tabindex, name: name, id: id },\n                             valueUpdate: valueUpdate,\n                             autocomplete: autocomplete,\n                             event: events"></textarea>\n       <!-- /ko -->\n       <!-- ko ifnot: !!autocomplete -->\n       <textarea rows="1"\n                 data-bind="disable: disabled,\n                            hasFocus: focused,\n                            textInput: value,\n                            autoExpand: value,\n                            attr: { tabindex: tabindex, name: name, id: id },\n                            valueUpdate: valueUpdate,\n                            event: events"></textarea>\n        <!-- /ko -->\n    <!-- /ko -->\n    <!-- ko ifnot: isMultiline -->\n        <!-- ko if: !!autocomplete -->\n        <input type="text"\n               data-bind="disable: disabled,\n                          hasFocus: focused,\n                          textInput: value,\n                          attr: { tabindex: tabindex, name: name, id: id },\n                          valueUpdate: valueUpdate,\n                          autocomplete: autocomplete,\n                          event: events">\n        <!-- /ko -->\n        <!-- ko ifnot: !!autocomplete -->\n        <input type="text"\n               data-bind="disable: disabled,\n                          hasFocus: focused,\n                          textInput: value,\n                          attr: { tabindex: tabindex, type: type, name: name, id: id },\n                          valueUpdate: valueUpdate,\n                          event: events">\n        <!-- /ko -->\n    <!-- /ko -->\n</div>\n'});return module.exports});(function(){var define=System.amdDefine;(function(factory){if(typeof define==='function'&&define.amd){define('3rdparty/knockout.autocomplete.js',['node_modules/knockout/build/output/knockout-latest.debug.js','node_modules/jquery/dist/jquery.js'],factory)}else{factory(ko,jQuery)}}(function(ko,$){var ua=navigator.userAgent;var safari=/safari/i.test(ua);var iphone=/\(iphone;/i.test(ua);var ipad=/\(ipad;/i.test(ua);var mobileSafari=safari&&(ipad||iphone);var utils=ko.utils;var triggerEvent=utils.triggerEvent;var unwrapObservable=utils.unwrapObservable;var arrayMap=utils.arrayMap;var arrayFilter=utils.arrayFilter;var keys={escape:27,up:38,down:40,pageUp:33,pageDown:34,enter:13,tab:9,shift:16};var defaultOptions={minLength:1,maxItems:8,separators:null,format:function(item){return item.toString()}};function ScrollPane(container){this.container=$(container)}function top(element){return $(element).offset().top}function bottom(element){return top(element)+$(element).outerHeight()}ScrollPane.prototype.alignWithTop=function(element){this.container.scrollTop(this.container.scrollTop()+top(element)-top(this.container))};ScrollPane.prototype.alignWithBottom=function(element){this.container.scrollTop(this.container.scrollTop()+bottom(element)-bottom(this.container))};ScrollPane.prototype.isAboveScrollArea=function(element){return top(element)<top(this.container)};ScrollPane.prototype.isBelowScrollArea=function(element){return bottom(element)>bottom(this.container)};ScrollPane.prototype.scrollIntoView=function(element){if(this.isAboveScrollArea(element)){this.alignWithTop(element)}else if(this.isBelowScrollArea(element)){this.alignWithBottom(element)}};ko.bindingHandlers.autocomplete={init:function(element,valueAccessor,allBindingsAccessor,viewModel,bindingContext){var value=valueAccessor();var options=unwrapObservable(value);var subscriptions=[];var $element=$(element);var $window=$(window);var $dropdown=$('<ul class="knockout-autocomplete menu scrollable popup-container"></ul>');if(options.className){$dropdown.addClass(options.className)}var $container;if(options.target){$container=$('#'+options.target);$dropdown.appendTo($container)}else if(options.after){$container=$dropdown;$element.after($dropdown);$dropdown.addClass('after-menu')}else{$container=$dropdown;$dropdown.appendTo('body')}$container.hide();$dropdown.hide();ko.utils.domData.set($dropdown[0],'anchor',{$element:$element,$popupHolder:$dropdown});var format=options.format||defaultOptions.format;var maxItems=options.maxItems||defaultOptions.maxItems;var minLength=typeof options.minLength==='number'?options.minLength:defaultOptions.minLength;var separators=options.separators||defaultOptions.separators;separators=separators&&new RegExp('['+separators+']');var floatingMenu=!options.target&&!options.after;$dropdown.toggleClass('floating-menu',floatingMenu);options.onSelect=options.onSelect||function(item){return item.toString()};function fireOnSelect(){var newValue=options.onSelect.apply(null,arguments)||'';element.value=newValue;triggerEvent(element,'change');query(newValue);menuShown(false)}var query=ko.isObservable(options.query)?options.query:ko.observable('');var selectedIndex=-1;var suggestions=ko.computed(function(){var data=unwrapObservable(options.data);var queryText=(unwrapObservable(query)||'').trim().toLowerCase();if(queryText.length<minLength){return[]}else{var matches;if(options.noFilter){matches=data}else{matches=utils.arrayFilter(data,function(item){var label=format(item).toLowerCase();var offset=label.indexOf(queryText);return offset!==-1}).slice(0,maxItems)}return arrayMap(matches,function(item){var label=format(item);var suggestion={item:item,query:queryText,label:label};return suggestion})}});subscriptions.push(suggestions);var renderSuggestion=typeof options.renderSuggestion==='function'?function(completionItem,index){var $result=$('<li>').append(options.renderSuggestion(completionItem));$result.attr('data-index',index);return $result}:function(completionItem,index){var offset=completionItem.label.toLowerCase().indexOf(completionItem.query);var before=completionItem.label.substring(0,offset);var match=completionItem.label.substring(offset,offset+completionItem.query.length);var after=completionItem.label.substring(offset+completionItem.query.length);var $result=$('<li>'+'<span class="before"></span>'+'<strong class="match"></strong>'+'<span class="after"></span>'+'</li>');$result.attr('data-index',index);$('.before',$result).text(before);$('.match',$result).text(match);$('.after',$result).text(after);return $result};function wrapIndex(index,length){if(index<0){return Math.max(0,suggestions().length-1)}if(suggestions().length<=index){return 0}return index}function moveSelection(fromIndex,toIndex){toIndex=wrapIndex(toIndex);var toElement=$dropdown.children()[toIndex];var hasSelection=fromIndex!==-1;if(hasSelection){var fromElement=$dropdown.children()[fromIndex];$(fromElement).toggleClass('selected',false)}$(toElement).toggleClass('selected',true);selectedIndex=toIndex;var scrollPane=new ScrollPane($dropdown);scrollPane.scrollIntoView(toElement);return hasSelection}function selectPrevious(){if(!menuShown()){menuShown(true);if(selectedIndex===0){moveSelection(selectedIndex,suggestions().length-1)}}else if(selectedIndex!==-1){var i=selectedIndex;moveSelection(i,i-1)}return false}function selectNext(){if(!menuShown()){menuShown(true)}else if(selectedIndex!==-1){var i=selectedIndex;return moveSelection(i,i+1)}return false}function selectSuggestion(index){return moveSelection(selectedIndex,index)}function renderSuggestions($target,suggestions){return suggestions.map(renderSuggestion)}function freeTextSelect(){var value=element.value;var texts=value?value.split(separators):[];texts=arrayMap(texts,function(text){return text.trim()});texts=arrayFilter(texts,function(text){return text.length>0});fireOnSelect(texts,justPasted)}function selectItem(item){fireOnSelect(separators?[item]:item);if(options.target){setTimeout(function(){element.scrollIntoView(false)},1)}}function select(){var items=suggestions();var i=selectedIndex;var hasSelection=i!==-1;if(hasSelection){selectItem(items[i].item);return true}else if(separators){freeTextSelect();return true}}function preventDefault(e){if(e.preventDefault){e.preventDefault()}return false}var justPasted=false;$element.on('paste',function(e){if(window.clipboardData){var clipped=window.clipboardData.getData('Text');clipped=clipped.replace(/(\r\n|\n|\r)/gm,' ');$(this).val(clipped);return false}justPasted=true});var keyClose=false;$element.on('keydown',function(e){if(e.ctrlKey||e.metaKey||e.altKey||e.shiftKey){return true}switch(e.which){case keys.up:if(selectPrevious()){return preventDefault(e)}break;case keys.down:if(selectNext()){return preventDefault(e)}break;case keys.enter:if(select()){return preventDefault(e)}break;case keys.tab:select();break;case keys.escape:var isMenuShown=menuShown();var bubble=!isMenuShown||preventDefault(e);if(isMenuShown){menuShown(false)}else{keyClose=true;$element.blur()}return bubble}return true});$element.on('keyup',function(e){keyClose=false;if(justPasted||separators&&separators.test(element.value)){freeTextSelect();justPasted=false;return}var inputKey=Object.keys(keys).every(function(key){return e.which!==keys[key]});if(inputKey){var text=element.value;query(text)}});var mouseInDropdown=false;function mouseEnterDropdown(){mouseInDropdown=true}function mouseLeaveDropdown(){mouseInDropdown=false}var menuShown=ko.computed({read:function(){return this.state()},write:function(value){if(value){if(suggestions().length){if(!this.state()){$dropdown.on('mouseenter',mouseEnterDropdown).on('mouseleave',mouseLeaveDropdown)}this.state(true);updateVisibilityOption(true)}}else{if(!options.target||options.minLength>0){this.state(false);updateVisibilityOption(false);$dropdown.off('mouseenter',mouseEnterDropdown).off('mouseleave',mouseLeaveDropdown)}}}},{state:ko.observable(false)});function updateVisibilityOption(value){if(ko.isObservable(options.visible)&&options.visible.peek()!==value){options.visible(value)}}if(ko.isObservable(options.visible)){menuShown(options.visible());subscriptions.push(options.visible.subscribe(function(visible){if(visible&&query()!==''){var currentSuggestion=suggestions();var currentSelectedIndex=selectedIndex;query('');if(currentSuggestion.length>0){var allSuggestions=suggestions();var newSelectedIndex=arrayMap(allSuggestions,function(suggestion){return suggestion.label}).indexOf(currentSuggestion[0].label);moveSelection(currentSelectedIndex,newSelectedIndex)}}menuShown(visible)}))}subscriptions.push(menuShown.subscribe(function(value){if(value){$dropdown.show();$container.show();if(floatingMenu){positionMenu()}}else{$container.hide();$dropdown.hide()}}));if(floatingMenu){$window.on('scroll.autocomplete',positionMenu);$window.on('resize.autocomplete',positionMenu);$dropdown.on('scroll.autocomplete',positionMenu)}$element.on('blur.autocomplete',function(e){if(menuShown()&&mouseInDropdown&&!keyClose){e.preventDefault();$element.focus();return false}menuShown(false);mouseInDropdown=false;if(query()!==''){setTimeout(function(){$(':focus').first().each(function(i,el){if($dropdown.has(el).length>0){el.scrollIntoView(false)}})},10)}});var $highlightedElements;var moves;function handleTouchStart(e){moves=0;var $target=$(e.target);$highlightedElements=$target.closest('li');$('li',$dropdown).removeClass('touching');setTimeout(function(){if($highlightedElements){$highlightedElements.addClass('touching')}},50);if(e.stopPropagation){e.stopPropagation()}return true}function handleTouchMove(e){moves+=1;if($highlightedElements){$highlightedElements.removeClass('touching')}if(e.stopPropagation){e.stopPropagation()}return true}function handleTouchEnd(e){setTimeout(function(){if($highlightedElements){$highlightedElements.removeClass('touching');$highlightedElements=null}},300);if(moves>1){return true}var targetIndex=$(e.target).closest('li').attr('data-index');var item=suggestions()[targetIndex];selectItem(item.item);if(e.stopPropagation){e.stopPropagation()}return preventDefault(e)}function handleMouseEnter(e){var index=$(this).data('index');moveSelection(selectedIndex,index)}function handleMouseDown(e){if(e.type==='mousedown'&&e.which!==1){return false}var targetIndex=$(e.target).closest('li').attr('data-index');var item=suggestions()[targetIndex];selectItem(item.item);if(e.stopPropagation){e.stopPropagation()}return preventDefault(e)}$dropdown.on('touchstart','li',handleTouchStart);$dropdown.on('touchmove','li',handleTouchMove);$dropdown.on('touchend','li',handleTouchEnd);$dropdown.on('mouseenter','li',handleMouseEnter);$dropdown.on('mousedown','li',handleMouseDown);function positionMenu(){var offset=$element.offset();var elementHeight=$element.outerHeight();var elementBottom=offset.top+elementHeight;var windowHeight=$window.height();var spaceAbove=offset.top;var spaceBelow=windowHeight-elementBottom;$dropdown.css('bottom','auto');var dropdownHeight=$dropdown.outerHeight();var dropdownWidth=$dropdown.outerWidth();var top=elementHeight+offset.top;var left=offset.left;var right=left+dropdownWidth;var bottom=null;if(mobileSafari&&spaceBelow<600||dropdownHeight>spaceBelow){top=offset.top-dropdownHeight-5}if(right>$window.width()){left=Math.max($window.width()-dropdownWidth,0)}else{left-=document.body.scrollLeft}if(top<document.body.scrollTop){top=document.body.scrollTop;bottom=$window.height()-(offset.top-5)}else{top-=document.body.scrollTop}if(top+dropdownHeight>windowHeight){bottom=0}$dropdown.css('top',top+'px');$dropdown.css('left',left+'px');if(bottom!==null){$dropdown.css('overflow','auto');$dropdown.css('bottom',bottom+'px')}}subscriptions.push(suggestions.subscribe(function(newValue){selectedIndex=-1;$dropdown.empty();if(newValue.length){$dropdown.append(renderSuggestions($dropdown,newValue));selectSuggestion(0);if(floatingMenu){positionMenu()}menuShown(true)}else{menuShown(false)}}));if(suggestions().length){$dropdown.append(renderSuggestions($dropdown,suggestions()));selectSuggestion(0)}if(options.target&&options.minLength===0){menuShown(true)}utils.domNodeDisposal.addDisposeCallback(element,function(){$window.off('scroll.autocomplete',positionMenu);$window.off('resize.autocomplete',positionMenu);$dropdown.off('scroll.autocomplete',positionMenu);$dropdown.off('touchstart','li',handleTouchStart);$dropdown.off('touchmove','li',handleTouchMove);$dropdown.off('touchend','li',handleTouchEnd);$dropdown.off('mouseenter','li',handleMouseEnter);$dropdown.off('mousedown','li',handleMouseDown);query('');$dropdown.remove();subscriptions.forEach(function(subscription){subscription.dispose()})})}}}))}());(function(){var define=System.amdDefine;define('components/inPlaceEditor/inPlaceEditor.js',['node_modules/knockout/build/output/knockout-latest.debug.js','node_modules/jquery/dist/jquery.js','common/util.js','components/inPlaceEditor/inPlaceEditor.ko','3rdparty/knockout.autocomplete.js'],function(ko,$,util){ko.components.register('in-place-editor',{template:{element:'inPlaceEditor'},viewModel:function(params){var that=this;that.value=params.value;that.isMultiline=params.isMultiline;that.placeholder=params.placeholder;that.tabindex=params.tabindex;that.name=params.name;that.type=params.type||'text';that.id=params.id;that.valueUpdate=params.valueUpdate;that.autocomplete=params.autocomplete;that.events={};if(params.onKeyTab||params.onKeyEnter){that.events.keydown=function(e){var which=e.keyCode||e.which;if(which===9&&params.onKeyTab){return params.onKeyTab(e)}if(which===13&&params.onKeyEnter){return params.onKeyEnter(e)}return true}}that.disabled=ko.isObservable(params.disabled)?params.disabled:ko.observable(params.disabled);that.float=ko.pureComputed(function(){return!that.disabled()&&that.focused()||!!that.value()});that.focused=ko.pureComputed({read:function(){var hasFocus=ko.isObservable(params.focused)?params.focused():this.focus();return hasFocus},write:function(value){if(ko.isObservable(params.focused)){if(value||this.initialWrongBlurHappened){params.focused(value)}else{this.initialWrongBlurHappened=true}}this.focus(value)},owner:{focus:ko.observable(false),initialWrongBlurHappened:false}})},synchronous:true})})}());(function(){var define=System.amdDefine;define('calendar/components/dateSelector/DateSelectorViewModel.js',['node_modules/knockout/build/output/knockout-latest.debug.js','calendar/ical/Time.js','calendar/model/DateRange.js'],function(ko,Time,DateRange){function DateSelectorViewModel(params){var that=this;that.date=params.date;that.disabled=params.disabled;that.dateRange=ko.observable(that.date()&&DateRange.fromTime(that.date()));that.openState=ko.observable(false);that.tabindex=params.tabindex;that.date.subscribe(function(newDate){if(newDate){that.dateRange(DateRange.fromTime(newDate))}});that.onDateChange=function(dateRange){var newDate=dateRange.from.clone();if(that.date()){var previousDateTime=that.date().clone();newDate.isDate=previousDateTime.isDate;newDate.hour=previousDateTime.hour;newDate.minute=previousDateTime.minute;newDate.second=previousDateTime.second}that.date(newDate);that.openState(false)}}return DateSelectorViewModel})}());(function(){var define=System.amdDefine;define('calendar/model/DateRange.js',['calendar/ical/Time.js','calendar/ical/Duration.js','calendar/ical/TimeZone.js'],function(Time,Duration,TimeZone){var oneDay=Duration.fromData({days:1});function InvalidDateRangeError(message){var error=Error.call(this,message);this.name='InvalidDateRangeError';this.message=error.message;this.stack=error.stack}InvalidDateRangeError.prototype=Object.create(Error.prototype);function DateRange(options){this.from=options.from;if(!options.from){throw new InvalidDateRangeError('You must provide a from-date')}else if(options.to&&options.duration){throw new InvalidDateRangeError('You can provide both to-date and a duration')}if(!options.to&&!options.duration){var to=this.from.clone();to.addDuration(Duration.fromString('P1D'));this.to=to}else if(options.to){this.to=options.to}else if(options.duration){this.to=this.from.clone();this.to.addDuration(options.duration)}this.days=this.to.subtractDate(this.from).toDays();if(!this.from.isDate||!this.to.isDate){throw new InvalidDateRangeError('Invalid date range: '+this.toString()+', end point must be dates.')}if(this.from.zone!==this.to.zone){throw new InvalidDateRangeError('Invalid date range: '+this.toString()+', end point must have same time zone.')}if(this.days<1){throw new InvalidDateRangeError('Invalid date range: '+this.toString()+', the range must be at least one day.')}}DateRange.InvalidDateRangeError=InvalidDateRangeError;DateRange.fromTime=function(time){return new DateRange({from:time.startOfDay()})};DateRange.singleDateStringPattern=/^(\w{4})(\w{2})(\w{2})$/;DateRange.dateRangeStringPattern=/^(\w{4})(\w{2})(\w{2})-(\w{4})(\w{2})(\w{2})$/;DateRange.isDateString=function(dateString){return DateRange.singleDateStringPattern.test(dateString)||DateRange.dateRangeStringPattern.test(dateString)||false};DateRange.fromString=function(dateString){var m=DateRange.singleDateStringPattern.exec(dateString);if(m){var from=Time.fromData({year:parseInt(m[1],10),month:parseInt(m[2],10),day:parseInt(m[3],10)});var to=from.clone();to.addDuration(Duration.fromString('P1D'));return new DateRange({from:from,to:to})}m=DateRange.dateRangeStringPattern.exec(dateString);if(m){return new DateRange({from:Time.fromData({year:parseInt(m[1],10),month:parseInt(m[2],10),day:parseInt(m[3],10)}),to:Time.fromData({year:parseInt(m[4],10),month:parseInt(m[5],10),day:parseInt(m[6],10)})})}throw new Error('Invalid date range: '+dateString)};DateRange.prototype.contains=function(date){return this.from.compare(date)<=0&&date.compare(this.to)<0};DateRange.prototype.toString=function(){return this.days===1?this.from.toICALString():this.from.toICALString()+'-'+this.to.toICALString()};DateRange.prototype.convertToZone=function(zone){return new DateRange({from:this.from.convertToZone(zone),to:this.to.convertToZone(zone)})};DateRange.prototype.previous=function(){var from=this.from.clone();var to=this.from;from.day-=this.days;return new DateRange({from:from,to:to})};DateRange.prototype.next=function(){var from=this.to;var to=this.to.clone();to.day+=this.days;return new DateRange({from:from,to:to})};DateRange.prototype.expandToMonth=function(){var from=this.from.month!==this.to.month&&this.days<=(this.to.day-1)*2?this.to.startOfMonth():this.from.startOfMonth();var to=from.clone();to.month+=1;return new DateRange({from:from,to:to})};DateRange.prototype.expandToWeeks=function(){return new DateRange({from:this.from.startOfWeek(),to:this.to.dayBefore().endOfWeek().dayAfter()})};DateRange.prototype.dates=function(timezone){var dateFrom=this.from;if(timezone&&dateFrom.zone.equal(TimeZone.localTimeZone)){dateFrom=dateFrom.convertToZone(timezone)}var result=[dateFrom];for(var i=1;i<this.days;i+=1){var nextDay=result[result.length-1].clone();nextDay.addDuration(oneDay);result.push(nextDay)}return result};DateRange.prototype.equal=function(other){return this.days===other.days&&this.from.compare(other.from)===0};return DateRange})}());(function(){var define=System.amdDefine;define('calendar/ical/Duration.js',['3rdparty/ical.js'],function(ical){ical.Duration.prototype.toDays=function(){return this.toHours()/24};ical.Duration.prototype.toHours=function(){return this.toSeconds()/(60*60)};return ical.Duration})}());(function(){var define=System.amdDefine;define('calendar/components/miniCalendar/MiniCalendarViewModel.js',['node_modules/knockout/build/output/knockout-latest.debug.js','common/util.js','calendar/model/DateRange.js','calendar/ical/Time.js','calendar/ical/Duration.js'],function(ko,util,DateRange,Time,Duration){function MiniCalendarViewModel(params){var that=this;that.supportsRangeSelection=ko.pureComputed(function(){return ko.unwrap(params.rangeSelection)});that.currentDate=ko.pureComputed(function(){return ko.unwrap(params.currentDate)||Time.now().startOfDay()});var dateRangeEqualityComparer=function(previous,next){return previous.equal(next)};that.value=ko.isObservable(params.value)?params.value:ko.observable(params.value);if(!that.value.peek()){that.value(new DateRange({from:that.currentDate()}))}that.dateRange=ko.observable(that.value());that.dateRange.equalityComparer=dateRangeEqualityComparer;that.value.subscribe(function(dateRange){that.dateRange(dateRange)});that.selection=ko.observable(null);that.monthRange=ko.computed(function(){return that.dateRange().expandToMonth()});that.monthRange.equalityComparer=dateRangeEqualityComparer;that.expandedDateRange=ko.computed(function(){var monthRange=that.monthRange();var from=monthRange.from.startOfWeek();var to=from.clone();to.day+=6*7;return new DateRange({from:from,to:to})});that.expandedDateRange.equalityComparer=dateRangeEqualityComparer;that.emitChangeEvent=function(){if(params.onChange){params.onChange(that.value())}};that.weeks=util.range(6).map(function(w){var week={days:[]};week.days=util.range(7).map(function(d){var date=ko.pureComputed(function(){return that.expandedDateRange().dates()[w*7+d]});var dayAfter=ko.pureComputed(function(){return date().dayAfter()});var day={outsideMonth:ko.pureComputed(function(){return!that.monthRange().contains(date())}),hasEvents:ko.pureComputed(function(){return!!(params.hasEvents&&params.hasEvents(date()))}),highlight:ko.pureComputed(function(){return that.value().contains(date())}),selected:ko.pureComputed(function(){return!!(that.selection()&&that.selection().contains(date()))}),date:date,present:ko.pureComputed(function(){return date().compare(that.currentDate())===0}),showDay:function(){that.value(new DateRange({from:date(),to:dayAfter()}));that.emitChangeEvent()},dragStart:function(){if(!that.supportsRangeSelection()){return false}that.selection(new DateRange({from:date(),duration:Duration.fromString('P1D')}))},dragEnd:function(){that.selection(null)},dragOver:function(e,source){var from=source.date();var to=dayAfter();if(from.compare(date())<0){that.selection(new DateRange({from:from,to:to}))}else{that.selection(new DateRange({from:date(),to:from.dayAfter()}))}},drop:function(){var selection=that.selection();if(selection.days<=7){that.value(that.selection())}else{that.value(that.selection().expandToWeeks())}that.emitChangeEvent()}};return day});week.number=ko.pureComputed(function(){return week.days[0].date().weekNumber(Time.weekStart)});week.showWeek=function(){if(that.supportsRangeSelection()){that.value(new DateRange({from:week.days[0].date(),duration:Duration.fromString('P7D')}));that.emitChangeEvent()}};return week});that.showPrevious=function(){var to=that.monthRange().from;var from=to.clone();from.month-=1;that.dateRange(new DateRange({from:from,to:to}))};that.showNext=function(){var from=that.monthRange().to;var to=from.clone();to.month+=1;that.dateRange(new DateRange({from:from,to:to}))};that.showMonth=function(){if(that.supportsRangeSelection()){that.value(that.monthRange());that.emitChangeEvent()}};that.highlightedDates=ko.observableArray([])}return MiniCalendarViewModel})}());System.registerDynamic('calendar/components/miniCalendar/miniCalendar.ko',[],true,function($__require,exports,module){var define,global=this||self,GLOBAL=global;module.exports=function injectTemplate(tpl){var s=document.createElement('script');s.id=tpl.id;s.innerHTML=window.TR?TR.HTML(tpl.content):tpl.content;s.type='text/html';document.head.appendChild(s)}({'id':'miniCalendar','content':'<table cellspacing="0">\n    <thead>\n        <tr>\n            <td colspan="8">\n                <div class="navigation">\n                    <div class="month-label" data-bind="click: showMonth, formatDate: { value: monthRange().from, format: \'MMMM y\' }"></div>\n                    <button class="previous" data-bind="click: showPrevious"></button>\n                    <button class="next" data-bind="click: showNext"></button>\n                </div>\n            </td>\n        </tr>\n        <tr>\n            <th class="week-number"></th>\n            <!-- ko foreach: weeks[0].days -->\n            <th class="day-names" data-bind="text: inter.calendars.gregorian.dayNames.format.narrow[$data.date().dayOfWeek() - 1]"></th>\n            <!-- /ko -->\n        </tr>\n    </thead>\n    <tbody data-bind="foreach: weeks">\n        <tr>\n            <th class="week-number" data-bind="text: number, click: showWeek, css: { \'no-range\': !$parent.supportsRangeSelection() }"></th>\n            <!--  ko foreach: days -->\n            <td data-bind="css: {\n                             outsideMonth: outsideMonth,\n                             hasEvents: hasEvents,\n                             highlight: highlight,\n                             present: present,\n                             selected: selected\n                           },\n                           click: showDay,\n                           dragZone: { name: \'miniCalendarDay\', dragDistance: 1, element: null, dragStart: dragStart, dragEnd: dragEnd },\n                           dropZone: { accepts: \'miniCalendarDay\', dragOver: dragOver, drop: drop },\n                           formatDate: { value: date, format: \'d\' }" class="day"></td>\n            <!-- /ko -->\n        </tr>\n    </tbody>\n</table>\n'});return module.exports});(function(){var define=System.amdDefine;define('calendar/components/miniCalendar/miniCalendar.js',['node_modules/knockout/build/output/knockout-latest.debug.js','calendar/components/miniCalendar/MiniCalendarViewModel.js','calendar/components/miniCalendar/miniCalendar.ko'],function(ko,MiniCalendarViewModel){ko.components.register('one-mini-calendar',{template:{element:'miniCalendar'},viewModel:{createViewModel:function(params){return new MiniCalendarViewModel(params)}}})})}());(function(){var define=System.amdDefine;define('calendar/components/dateInput/DateInputViewModel.js',['node_modules/knockout/build/output/knockout-latest.debug.js','calendar/ical/Time.js'],function(ko,Time){var ymdOrder=inter.calendars.gregorian.datePartsOrder;var ymdOrderIndex={year:ymdOrder.indexOf('y'),month:ymdOrder.indexOf('m'),day:ymdOrder.indexOf('d')};var mdOrder=ymdOrder.replace('y','');var mdOrderIndex={month:mdOrder.indexOf('m'),day:mdOrder.indexOf('d')};function DateInputViewModel(params){var that=this;that.disabled=params.disabled;that.date=ko.isObservable(params.date)?params.date:ko.observable(params.date);that.lastValidDate=ko.observable(that.date());that.tabindex=params.tabindex;that.date.subscribe(function(newValue){if(newValue){that.lastValidDate(newValue)}});that.value=ko.computed({read:function(){var validDate=that.lastValidDate();return inter.renderDate(validDate,'shortDate')},write:function(value){that.date(that.parseDate(value))}}).extend({notify:'always'})}DateInputViewModel.prototype.parseDate=function(text){var date=this.lastValidDate().clone();var parts=text.split(/\D+/).filter(function(part){return part});function getPart(index){return parseInt(parts[index],10)}var day=date.day;var month=date.month;var year=date.year;if(parts.length===0){return null}else if(parts.length===1){var dateString=parts[0];if(parts[0].length===6){return this.parseDate(dateString.substr(0,2)+'/'+dateString.substr(2,2)+'/'+dateString.substr(4,2))}else{day=getPart(0)}}else if(parts.length===2){month=getPart(mdOrderIndex.month);day=getPart(mdOrderIndex.day)}else{year=getPart(ymdOrderIndex.year);month=getPart(ymdOrderIndex.month);day=getPart(ymdOrderIndex.day)}if(0<year&&year<100){year=Math.floor(date.year/100)*100+year}if(day<1||day>31||month<1||month>12||year<0){return null}date.day=day;date.month=month;date.year=year;return date};return DateInputViewModel})}());System.registerDynamic('calendar/components/dateInput/dateInput.ko',[],true,function($__require,exports,module){var define,global=this||self,GLOBAL=global;module.exports=function injectTemplate(tpl){var s=document.createElement('script');s.id=tpl.id;s.innerHTML=window.TR?TR.HTML(tpl.content):tpl.content;s.type='text/html';document.head.appendChild(s)}({'id':'dateInput','content':'<input type="text"\n       value=""\n       data-bind="value: value,\n                  selectOnFocus: true,\n                  disable: disabled,\n                  attr: { tabindex: tabindex }"\n       class="field" />\n'});return module.exports});(function(){var define=System.amdDefine;define('calendar/components/dateInput/dateInput.js',['node_modules/knockout/build/output/knockout-latest.debug.js','calendar/components/dateInput/DateInputViewModel.js','calendar/components/dateInput/dateInput.ko','3rdparty/knockout.selectOnFocus.js'],function(ko,DateInputViewModel){ko.components.register('one-date-input',{template:{element:'dateInput'},viewModel:{createViewModel:function(params){return new DateInputViewModel(params)}}})})}());System.registerDynamic('calendar/components/dateSelector/dateSelector.ko',[],true,function($__require,exports,module){var define,global=this||self,GLOBAL=global;module.exports=function injectTemplate(tpl){var s=document.createElement('script');s.id=tpl.id;s.innerHTML=window.TR?TR.HTML(tpl.content):tpl.content;s.type='text/html';document.head.appendChild(s)}({'id':'dateSelector','content':'<one-date-input params="date: date, disabled: disabled, tabindex: tabindex"></one-date-input>\n<!-- ko ifnot: disabled -->\n<div class="dropdown-toggle" data-bind="popupTemplate: {\n                                    template: \'datePickerDropdown\',\n                                    \'positioning\': [\n                                        \'inside-right outside-bottom\',\n                                        \'inside-right outside-top\'\n                                    ],\n                                    closeOnClickInPopup: false,\n                                    openState: openState\n                                }">\n    <span class="calendar-icon"></span>\n</div>\n<!-- /ko -->\n\n<script type="text/html" id="datePickerDropdown">\n    <div class="popupDropdown date-selector-dropdown">\n        <one-mini-calendar params="value: dateRange, rangeSelection: false, onChange: onDateChange"></one-mini-calendar>\n    </div>\n</script>\n'});return module.exports});(function(){var define=System.amdDefine;(function(root,factory){if(typeof exports==='object'){module.exports=factory(require('jquery'),require('knockout'))}else if(typeof define==='function'&&define.amd){define('3rdparty/knockout.popupTemplate.js',['node_modules/jquery/dist/jquery.js','node_modules/knockout/build/output/knockout-latest.debug.js'],factory)}else{factory($,ko)}}(this,function($,ko){function callMeMaybe(callback){if(typeof callback==='function'){callback()}}function callInSequence(){var args=Array.prototype.slice.call(arguments);return function(){args.filter(function(arg){return typeof arg==='function'}).forEach(function(arg){arg.apply(null,arguments)})}}function Popup(element,bindingContext,options){this.element=element;this.$element=$(element);this.options=options;this.bindingContext=bindingContext;this.subscriptions=[];this.bestPosition=ko.observable(null);this.$popupHolder=null;this.bestPosition.equalityComparer=function(a,b){if(!a&&b){return false}if(a&&!b){return false}return a.vertical===b.vertical&&a.horizontal===b.horizontal};this.subscriptions.push(this.options.openState.subscribe(this.observe.bind(this)));this.subscriptions.push(this.options.template.subscribe(function(){this.render()},this));if(this.options.renderOnInit){this.render();this.reposition();this.close()}if(this.options.openState()){this.observe(true)}ko.utils.domNodeDisposal.addDisposeCallback(this.element,function(){this.subscriptions.forEach(function(item){item.dispose()})}.bind(this))}Popup.prototype.disabled=function(){var disabler=this.options.disable;if(ko.isObservable(disabler)){return!!disabler()}else{return!!disabler}};Popup.prototype.observe=function(newValue){var that=this;if(newValue){if(this.disabled()){return}this.options.beforeOpen();this.open(function(){that.options.afterOpen()})}else{this.options.beforeClose();this.close(function(){that.options.afterClose()})}};Popup.prototype.isInsideViewport=function(anchorOffset,boundingRect,window,position){var offset=this.calculateOffset(anchorOffset,position);return window.pageXOffset<=offset.left&&window.pageYOffset<=offset.top&&offset.left+boundingRect.width<=window.innerWidth+window.pageXOffset&&offset.top+boundingRect.height<=window.innerHeight+window.pageYOffset};Popup.prototype.getBestPosition=function(){var positioning=this.options.positioning;if(!this.$popupHolder||!this.options.openState()){return ko.toJS(positioning[0])}var anchorOffset=this.$element.offset();var boundingRect=this.$popupHolder[0].getBoundingClientRect();var bestCandidate=null;for(var i=0;i<positioning.length;i+=1){var position=ko.toJS(positioning[i]);var popupOffset=this.calculateOffset(anchorOffset,position);var constrainedOffset=this.keepInViewport(popupOffset,boundingRect,window);var distance=Math.sqrt(Math.pow(constrainedOffset.left-popupOffset.left,2)+Math.pow(constrainedOffset.top-popupOffset.top,2));if(distance===0){return position}if(!bestCandidate||distance<bestCandidate.distance){bestCandidate={position:position,distance:distance}}}return bestCandidate.position};Popup.prototype.createElementContainer=function(){var $popupHolder;var classes=['popupTemplate','popup-container'];if(this.options.className){classes.push(this.options.className)}this.bestPosition(this.getBestPosition());var position=ko.computed(function(){var position=this.bestPosition();return'horizontal-'+position.horizontal+' vertical-'+position.vertical},this);this.subscriptions.push(position);classes.push(position());$popupHolder=$('<div class="'+classes.join(' ')+''+'"></div>');$popupHolder.css('position','absolute');this.subscriptions.push(position.subscribe(this.removePositionClasses,this,'beforeChange'));this.subscriptions.push(position.subscribe(this.setPositionClasses,this));var positioning=ko.computed(function(){return ko.toJS(this.options.positioning)},this);this.subscriptions.push(positioning);this.subscriptions.push(positioning.subscribe(this.reposition,this));this.setPositionClasses();this.reposition();return $popupHolder};Popup.prototype.removePositionClasses=function(positionClasses){if(!this.$popupHolder){return}this.$popupHolder.removeClass(positionClasses)};Popup.prototype.setPositionClasses=function(positionClasses){if(!this.$popupHolder){return}this.$popupHolder.toggleClass(positionClasses)};Popup.prototype.render=function(done){if(!this.$popupHolder){this.$popupHolder=this.createElementContainer()}this.$popupHolder.appendTo($('body'));ko.utils.domData.set(this.$popupHolder[0],'anchor',this);var innerBindingContext='data'in this.options?this.bindingContext.createChildContext(this.options.data):this.bindingContext;ko.renderTemplate(this.options.template(),innerBindingContext,{afterRender:done},this.$popupHolder[0]);ko.utils.domNodeDisposal.addDisposeCallback(this.element,this.remove.bind(this))};Popup.prototype.remove=function(done){if(this.options.disposalCallback){this.options.disposalCallback(this.$popupHolder[0])}else{ko.removeNode(this.$popupHolder[0])}callMeMaybe(done)};Popup.prototype.reposition=function(e){if(!this.$popupHolder){return}var scrollTarget=e&&e.type==='scroll'&&e.target;var isChildScrolling=scrollTarget&&this.$popupHolder.has(scrollTarget).length>0;if(isChildScrolling){return}this.bestPosition(this.getBestPosition());var boundingRect=this.$popupHolder[0].getBoundingClientRect();var offset=this.calculateInitialPosition();offset=this.keepInViewport(offset,boundingRect,window);this.$popupHolder.offset(offset)};Popup.prototype.calculateOffset=function(anchorOffset,position){var offset=ko.utils.extend({},anchorOffset);var horizontal=position.horizontal,vertical=position.vertical;var $anchor=this.$element;var $popupHolder=this.$popupHolder;if(horizontal==='outside-left'){offset.left-=$popupHolder.outerWidth()}else if(horizontal==='middle'){offset.left+=Math.round($anchor.outerWidth()/2);offset.left-=Math.round($popupHolder.width()/2)}else if(horizontal==='inside-right'){offset.left+=$anchor.outerWidth();offset.left-=$popupHolder.width()}else if(horizontal==='outside-right'){offset.left+=$anchor.outerWidth()}if(vertical==='outside-top'){offset.top-=$popupHolder.height()}else if(vertical==='middle'){offset.top+=Math.round($anchor.outerHeight()/2);offset.top-=Math.round($popupHolder.height()/2)}else if(vertical==='inside-bottom'){offset.top+=$anchor.outerHeight();offset.top-=$popupHolder.height()}else if(vertical==='outside-bottom'){offset.top+=$anchor.outerHeight()}return offset};Popup.prototype.calculateInitialPosition=function(){return this.calculateOffset(this.$element.offset(),this.bestPosition())};Popup.prototype.keepInViewport=function(offset,boundingRect,window){var result=ko.utils.extend({},offset);if(result.left+boundingRect.width>window.innerWidth+window.pageXOffset){result.left=Math.max(window.innerWidth+window.pageXOffset-boundingRect.width,0)}if(result.top+boundingRect.height>window.innerHeight+window.pageYOffset){result.top=Math.max(window.innerHeight+window.pageYOffset-boundingRect.height,0)}result.left=Math.max(window.pageXOffset,result.left);result.top=Math.max(window.pageYOffset,result.top);return result};Popup.prototype.hide=function(done){this.$popupHolder.css('visibility','hidden');callMeMaybe(done)};Popup.prototype.show=function(done){this.$popupHolder.css('visibility','visible');this.reposition();callMeMaybe(done)};Popup.prototype.toggleClasses=function(bool){this.$popupHolder.toggleClass('open',bool);this.$popupHolder.toggleClass('closed',!bool)};Popup.prototype.open=function(done){var that=this;if(this.options.renderOnInit){this.toggleClasses(true);this.show(done)}else{this.render(function(){that.reposition();that.toggleClasses(true);callMeMaybe(done);that.reposition()})}};Popup.prototype.close=function(done){if(this.options.renderOnInit){this.toggleClasses(false);this.hide(done)}else{this.toggleClasses(false);this.remove(done)}};function eachIFrameContents(callback){$('iframe').each(function(index,iframe){var src=iframe.src;var origin=window.location.origin||location.protocol+'//'+location.host;if(!src||src.indexOf(origin)===0){var $contents;try{$contents=$(iframe).contents()}catch(e){}if($contents){$contents.each(callback)}}})}Popup.closeOnEsc={elements:[],handlerRegistered:false,handler:function(event){if(Popup.closeOnEsc.elements.length>0){var lastIndex=Popup.closeOnEsc.elements.length-1;var lastItem=Popup.closeOnEsc.elements[lastIndex];if(event.which===27&&lastItem.openState()){lastItem.openState(false)}}},setupHandler:function(){if(!Popup.closeOnEsc.handlerRegistered){document.addEventListener('keydown',Popup.closeOnEsc.handler,false);eachIFrameContents(function(index,doc){doc.addEventListener('keydown',Popup.closeOnEsc.handler,false)});Popup.closeOnEsc.handlerRegistered=true}},tearDownHandler:function(){if(Popup.closeOnEsc.handlerRegistered&&Popup.closeOnEsc.elements.length===0){document.removeEventListener('keydown',Popup.closeOnEsc.handler,false);eachIFrameContents(function(index,doc){doc.removeEventListener('keydown',Popup.closeOnEsc.handler,false)});Popup.closeOnEsc.handlerRegistered=false}},registerElement:function(element){Popup.closeOnEsc.elements.push(element);Popup.closeOnEsc.setupHandler()},unregisterElement:function(element){Popup.closeOnEsc.elements=Popup.closeOnEsc.elements.filter(function(el){return el!==element});Popup.closeOnEsc.tearDownHandler()}};var HORIZONTAL_POSITIONS=['outside-left','inside-left','middle','inside-right','outside-right'];var VERTICAL_POSITIONS=['outside-top','inside-top','middle','inside-bottom','outside-bottom'];function stringToPositioning(positionString){var positioningTokens=positionString.split(' ');var positioning={};if(positioningTokens[0]){positioning.horizontal=positioningTokens[0]}if(positioningTokens[1]){positioning.vertical=positioningTokens[1]}return positioning}function normalizePositioning(positioning){if(typeof positioning==='string'){positioning=stringToPositioning(positioning)}var vertical=ko.isObservable(positioning.vertical)?positioning.vertical:ko.observable(positioning.vertical);var horizontal=ko.isObservable(positioning.horizontal)?positioning.horizontal:ko.observable(positioning.horizontal);return{vertical:vertical,horizontal:horizontal}}function applyDefaults(positioning){if(VERTICAL_POSITIONS.indexOf(positioning.vertical.peek())===-1){positioning.vertical('outside-bottom')}if(HORIZONTAL_POSITIONS.indexOf(positioning.horizontal.peek())===-1){positioning.horizontal('inside-left')}}function configFixupPositioning(config){var positioning=config.positioning instanceof Array?config.positioning:[config.positioning];positioning=positioning.map(normalizePositioning);positioning.forEach(applyDefaults);config.positioning=positioning;return config}function configFixupOpenState(config){if(!ko.isObservable(config.openState)){if(typeof config.openState==='boolean'){config.openState=ko.observable(config.openState)}else{config.openState=ko.observable(false)}}return config}ko.bindingHandlers.popupTemplate={_internals:{Popup:Popup,configFixupPositioning:configFixupPositioning,configFixupOpenState:configFixupOpenState},init:function(element,valueAccessor,allBindingsAccessor,viewModel,bindingContext){var config=valueAccessor();var defaultConfiguration={renderOnInit:false,className:'',beforeOpen:function(){},afterOpen:function(){},beforeClose:function(){},afterClose:function(){},positioning:{},anchorHandler:true,outsideHandler:true,closeOnEsc:true,closeOnClickInPopup:false,openOnMouseOver:null,disposalCallBack:null,disable:null};if(typeof config==='string'){config={template:ko.observable(config)}}else if(ko.isObservable(config)&&typeof config()==='string'){config={template:config}}else if(config.hasOwnProperty('template')){if(!ko.isObservable(config.template)){config.template=ko.observable(config.template)}}config=ko.utils.extend(defaultConfiguration,config);config=configFixupPositioning(config);config=configFixupOpenState(config);var popup=new Popup(element,bindingContext,config);var popupReposition=popup.reposition.bind(popup);config.beforeOpen=config.beforeOpen.bind(popup);config.afterOpen=config.afterOpen.bind(popup);config.beforeClose=config.beforeClose.bind(popup);config.afterClose=config.afterClose.bind(popup);var $element=$(element);var insidePopupTemplate=false;if(config.outsideHandler||config.closeOnEsc){config.afterOpen=callInSequence(addCloseHandler,config.afterOpen);config.beforeClose=callInSequence(config.beforeClose,removeCloseHandler)}if(config.anchorHandler){if(defaultConfiguration.openOnMouseOver===true){var $popupTemplContainer;$element.on('mouseover.popupTemplate',function(event){config.openState(true);$popupTemplContainer=$(popup.$popupHolder[0]);$popupTemplContainer.on('mouseover.popupTemplate',function(event){insidePopupTemplate=true});$popupTemplContainer.on('mouseleave.popupTemplate',function(event){insidePopupTemplate=false;config.openState(false);removeEventsListener($popupTemplContainer,$element)});$element.on('mouseleave.popupTemplate',function(event){setTimeout(function(){if(insidePopupTemplate===false){config.openState(false);removeEventsListener($popupTemplContainer,$element)}},300)});event.stopPropagation();event.preventDefault()})}else{$element.on('click.popupTemplate',function(event){if(event.which===1){config.openState(!config.openState());event.stopPropagation();event.preventDefault()}})}}function removeEventsListener($container,$element){$container.off('mouseleave.popupTemplate');$container.off('mouseenter.popupTemplate');$element.off('mouseleave.popupTemplate')}function closePopupHandler(event){if(event.which===1&&config.openState()){var target=event.target||document.elementFromPoint(event.pageX||event.clientX,event.pageY||event.clientY);var $targetPopup=$(target).closest('.popup-container');var inPopup=$targetPopup.length>0;if(inPopup){var targetPopup=ko.utils.domData.get($targetPopup[0],'anchor');var $targetPopupHolder=targetPopup.$popupHolder;var $targetAnchor=targetPopup.$element;var $popupHolder=popup.$popupHolder;inPopup=$popupHolder.is($targetPopupHolder)||$popupHolder.has($targetAnchor).length>0}var isAnchor=$element.is(target)||$element.has(target).length>0;if(!isAnchor&&!inPopup){config.openState(false)}}}function closeOnClickInPopupHandler(event){if(event.which===1&&config.closeOnClickInPopup&&config.openState()){var target=event.target||document.elementFromPoint(event.pageX||event.clientX,event.pageY||event.clientY);var $popupHolder=popup.$popupHolder;var isPopup=$popupHolder.is(target)||$popupHolder.has(target).length>0;if(isPopup){config.openState(false)}}}function addCloseHandler(){eachIFrameContents(function(index,doc){if(config.outsideHandler){doc.addEventListener('click',closePopupHandler,true);doc.addEventListener('click',closeOnClickInPopupHandler,true)}});if(config.outsideHandler){document.addEventListener('click',closePopupHandler,true);document.addEventListener('click',closeOnClickInPopupHandler,true)}if(config.closeOnEsc){Popup.closeOnEsc.registerElement(config)}$(window).on('resize',popupReposition);window.addEventListener('scroll',popupReposition,true)}function removeCloseHandler(){eachIFrameContents(function(index,doc){if(config.outsideHandler){doc.removeEventListener('click',closePopupHandler,true);doc.removeEventListener('click',closeOnClickInPopupHandler,true)}});if(config.outsideHandler){document.removeEventListener('click',closePopupHandler,true);document.removeEventListener('click',closeOnClickInPopupHandler,true)}if(config.closeOnEsc){Popup.closeOnEsc.unregisterElement(config)}$(window).off('resize',popupReposition);window.removeEventListener('scroll',popupReposition,true)}ko.utils.domNodeDisposal.addDisposeCallback(element,function(){removeCloseHandler()})}};return ko.bindingHandlers.popupTemplate}))}());(function(){var define=System.amdDefine;define('common/bindings/knockout.dropdownTemplate.js',['node_modules/jquery/dist/jquery.js','node_modules/knockout/build/output/knockout-latest.debug.js','3rdparty/knockout.popupTemplate.js'],function($,ko){var animationEndEvents='MSAnimationEnd webkitAnimationEnd animationend';var supportsCssAnimations=document.body.style.animationName!==undefined;if(!supportsCssAnimations){supportsCssAnimations=document.body.style.webkitAnimationName!==undefined}ko.bindingHandlers.dropdownTemplate={init:function(element,valueAccessor,allBindingsAccessor,viewModel,bindingContext){var config=valueAccessor();if(typeof config==='string'){config={template:config}}config.openState=ko.isObservable(config.openState)?config.openState:ko.observable(false);config.className='dropdownTemplate';if(config.closeOnClickInPopup!==false){config.closeOnClickInPopup=true}if(!config.positioning){config.positioning=['inside-left outside-bottom','inside-left outside-top']}var removeImmediately=false;if(supportsCssAnimations){var modSequence=0;config.openState.subscribe(function(){modSequence=modSequence+1});config.disposalCallback=function(popup){var currentModSequence=modSequence;if(removeImmediately){ko.removeNode(popup)}else{$(popup).one(animationEndEvents,function(){if(modSequence===currentModSequence){ko.removeNode(popup)}})}}}ko.utils.domNodeDisposal.addDisposeCallback(element,function(){removeImmediately=true});ko.bindingHandlers.popupTemplate.init(element,function(){return config},allBindingsAccessor,viewModel,bindingContext)}}})}());(function(){var define=System.amdDefine;define('calendar/components/dateSelector/dateSelector.js',['node_modules/knockout/build/output/knockout-latest.debug.js','calendar/components/dateSelector/DateSelectorViewModel.js','calendar/components/miniCalendar/miniCalendar.js','calendar/components/dateInput/dateInput.js','calendar/components/dateSelector/dateSelector.ko','common/bindings/knockout.dropdownTemplate.js'],function(ko,DateSelectorViewModel){ko.components.register('one-date-selector',{template:{element:'dateSelector'},viewModel:{createViewModel:function(params){return new DateSelectorViewModel(params)}}})})}());(function(){var define=System.amdDefine;define('calendar/ical/Time.js',['3rdparty/ical.js'],function(ical){ical.Time.prototype.startOfDay=function(){var result=this.clone();result.hour=0;result.minute=0;result.second=0;result.isDate=true;result._normalize();return result};ical.Time.prototype.dayBefore=function(){var result=this.clone();result.day-=1;result.hour=0;result.minute=0;result.second=0;result.isDate=true;result._normalize();return result};ical.Time.prototype.dayAfter=function(){var result=this.clone();result.day+=1;result.hour=0;result.minute=0;result.second=0;result.isDate=true;result._normalize();return result};ical.Time.weekStart=ical.Time.DEFAULT_WEEK_START;ical.Time.prototype.startOfWeek=function(aWeekStart){var firstDow=ical.Time.weekStart||aWeekStart||ical.Time.SUNDAY;var result=this.clone();result.day-=(this.dayOfWeek()+7-firstDow)%7;result.isDate=true;result.hour=0;result.minute=0;result.second=0;result._normalize();return result};ical.Time.prototype.endOfWeek=function(aWeekStart){var firstDow=ical.Time.weekStart||aWeekStart||ical.Time.SUNDAY;var result=this.clone();result.day+=(7-this.dayOfWeek()+firstDow-ical.Time.SUNDAY)%7;result.isDate=true;result.hour=0;result.minute=0;result.second=0;result._normalize();return result};ical.Time.prototype.dayOfWeekId=function(){var dayOfWeekNumber=this.dayOfWeek();return ical.Recur.numericDayToIcalDay(dayOfWeekNumber)};var addDuration=ical.Time.prototype.addDuration;ical.Time.prototype.addDuration=function(){addDuration.apply(this,arguments);this._normalize();return this};ical.Time.prototype.compareTz=function(other,tz){var a=this.convertToZone(tz);var b=other.convertToZone(tz);return a.compare(b)};ical.Time.fromICALString=function(str){if(str.length===8){return ical.Time.fromData({year:ical.helpers.strictParseInt(str.substr(0,4)),month:ical.helpers.strictParseInt(str.substr(4,2)),day:ical.helpers.strictParseInt(str.substr(6,2)),isDate:true})}else{return ical.Time.fromData({year:ical.helpers.strictParseInt(str.substr(0,4)),month:ical.helpers.strictParseInt(str.substr(4,2)),day:ical.helpers.strictParseInt(str.substr(6,2)),hour:ical.helpers.strictParseInt(str.substr(11,2)),minute:ical.helpers.strictParseInt(str.substr(13,2)),second:ical.helpers.strictParseInt(str.substr(15,2)),isDate:false})}};return ical.Time})}());(function(){var define=System.amdDefine;define('calendar/components/timeSelector/timeParser.js',['node_modules/knockout/build/output/knockout-latest.debug.js','calendar/ical/Time.js'],function(ko,Time){return function(text,lastValidDate){var datetime=(ko.isObservable(lastValidDate)?lastValidDate():lastValidDate).clone();var parts=text.split(/\D+/).filter(function(part){return part});function getPart(index){return parseInt(parts[index],10)}var anteOrPostMeridiem=(text.toLowerCase().match(/am|pm/)||[])[0];var shortTimeFormat=inter.calendars.gregorian.dateFormats.basic.shortTime;var clock12Hours=/h.* a/.test(shortTimeFormat);var hour=datetime.hour;var minute=datetime.minute;if(parts.length===0){return null}else if(parts.length===1){var timeString=parts[0];if(timeString.length<=2){hour=getPart(0);minute=0}else if(timeString.length<=4){hour=parseInt(timeString.substr(0,timeString.length-2),10);minute=parseInt(timeString.substr(timeString.length-2),10)}}else if(parts.length===2){hour=getPart(0);minute=getPart(1)}if(!anteOrPostMeridiem&&clock12Hours){if(datetime.hour>=12&&hour<12){hour=(hour+12)%24}}if(anteOrPostMeridiem==='pm'&&hour<12){hour+=12}if(anteOrPostMeridiem==='am'&&hour===12){hour=0}if(hour<0||hour>24||minute<0||minute>60){return null}datetime.hour=hour;datetime.minute=minute;datetime.isDate=false;datetime.toString();return datetime}})}());(function(){var define=System.amdDefine;define('calendar/components/timeSelector/TimeSelectorViewModel.js',['node_modules/knockout/build/output/knockout-latest.debug.js','calendar/ical/Time.js','common/util.js','calendar/components/timeSelector/timeParser.js'],function(ko,Time,util,timeParser){function TimeSelectorViewModel(params){var that=this;that.date=params.date;that.disabled=ko.isObservable(params.disabled)?params.disabled:ko.observable(params.disabled);that.timeValue=ko.observable(inter.renderDate(that.date(),'shortTime'));that.timeQuery=ko.observable(that.timeValue());that.tabindex=params.tabindex;that.date.subscribe(function(newValue){if(newValue){that.lastValidDate(newValue);that.timeValue(inter.renderDate(newValue,'shortTime'))}});that.lastValidDate=ko.observable(that.date());var times=[];util.range(24,0).forEach(function(hour){times.push(inter.renderDate(new Date(2000,0,1,hour,0,0,0),'shortTime'));times.push(inter.renderDate(new Date(2000,0,1,hour,15,0,0),'shortTime'));times.push(inter.renderDate(new Date(2000,0,1,hour,30,0,0),'shortTime'));times.push(inter.renderDate(new Date(2000,0,1,hour,45,0,0),'shortTime'))});function normalizeTime(text){return text.replace(/^0([1-9])/,'$1')}that.timeData=ko.computed(function(){var timeDataHits=times.filter(function(time){var query=normalizeTime(that.timeQuery());return query===normalizeTime(time).substring(0,query.length)});if(timeDataHits.length===0){var parsedTime=timeParser(that.timeQuery(),that.lastValidDate);if(parsedTime){var formattedTime=inter.renderDate(parsedTime,'shortTime');timeDataHits.push(formattedTime)}}return timeDataHits});that.visible=ko.observable(false);that.focused=ko.observable(false);that.visible.subscribe(function(value){if(value){that.focused(true)}});that.focused.subscribe(function(focus){if(!focus&&!that.timeValue()&&!that.disabled()){that.timeValue(inter.renderDate(that.lastValidDate(),'shortTime'))}});that.disabled.subscribe(function(value){that.visible(false);that.focused(false)});that.isNotValid=ko.pureComputed(function(){var timeValue=that.timeValue();var parsedTime=timeParser(timeValue,that.lastValidDate);return timeValue&&!parsedTime});that.renderSuggestion=function(completionItem,index){return document.createTextNode(completionItem.label)};that.onSelect=function(item){var timeValue=item.toString();var parsedTime=timeParser(timeValue,that.lastValidDate);that.date(parsedTime);return timeValue}}TimeSelectorViewModel.prototype.hide=function(viewModel){viewModel.visible(false)};TimeSelectorViewModel.prototype.toggleVisible=function(viewModel,event){if(event.button===0){viewModel.visible(!viewModel.visible())}};return TimeSelectorViewModel})}());System.registerDynamic('calendar/components/timeSelector/timeSelector.ko',[],true,function($__require,exports,module){var define,global=this||self,GLOBAL=global;module.exports=function injectTemplate(tpl){var s=document.createElement('script');s.id=tpl.id;s.innerHTML=window.TR?TR.HTML(tpl.content):tpl.content;s.type='text/html';document.head.appendChild(s)}({'id':'timeSelector','content':'<input\n    data-bind="hasfocus: focused,\n               autocomplete: {\n                   data: timeData,\n                   query: timeQuery,\n                   noFilter: true,\n                   minLength: 0,\n                   className: \'time-dropdown\',\n                   visible: visible,\n                   renderSuggestion: renderSuggestion,\n                   onSelect: onSelect,\n                   after: true\n               },\n               value: timeValue,\n               disable: disabled,\n               css: { \'invalid\': isNotValid },\n               attr: { tabindex: tabindex }"\n    class="time-input field"\n    type="text"\n/>\n<!-- ko ifnot: disabled -->\n<div class="dropdown-toggle" data-bind="event: { mousedown: toggleVisible }">\n  <span class="expand-icon"></span>\n</div>\n<!-- /ko -->\n'});return module.exports});(function(){var define=System.amdDefine;(function(factory){if(typeof define==='function'&&define.amd){define('3rdparty/knockout.selectOnFocus.js',['node_modules/knockout/build/output/knockout-latest.debug.js'],factory)}else{factory(ko)}}(function(ko){function getOptions(valueAccessor){var options=ko.utils.unwrapObservable(valueAccessor());if(options.pattern){return options}else{return{pattern:options}}}function selectText(field,start,end){if(field.createTextRange){var selRange=field.createTextRange();selRange.collapse(true);selRange.moveStart('character',start);selRange.moveEnd('character',end);selRange.select();field.focus()}else if(field.setSelectionRange){field.focus();field.setSelectionRange(start,end)}else if(typeof field.selectionStart!=='undefined'){field.selectionStart=start;field.selectionEnd=end;field.focus()}}ko.bindingHandlers.selectOnFocus={init:function(element,valueAccessor){var firstFocus=true;function selectContentAsync(){setTimeout(function(){var options=getOptions(valueAccessor);var pattern=ko.utils.unwrapObservable(options.pattern);var onlySelectOnFirstFocus=ko.utils.unwrapObservable(options.onlySelectOnFirstFocus);if(!onlySelectOnFirstFocus||firstFocus){if(Object.prototype.toString.call(pattern)==='[object RegExp]'){var matchInfo=pattern.exec(element.value);if(matchInfo){var startOffset=matchInfo.index,endOffset=matchInfo.index+matchInfo[0].length;selectText(element,startOffset,endOffset)}}else{element.select()}firstFocus=false}},1)}if(document.activeElement===element){selectContentAsync()}ko.utils.registerEventHandler(element,'focus',function(e){selectContentAsync()})}}}))}());(function(){var define=System.amdDefine;define('calendar/components/timeSelector/timeSelector.js',['node_modules/knockout/build/output/knockout-latest.debug.js','calendar/components/timeSelector/TimeSelectorViewModel.js','calendar/components/timeSelector/timeSelector.ko','3rdparty/knockout.selectOnFocus.js'],function(ko,TimeSelectorViewModel){ko.components.register('one-time-selector',{template:{element:'timeSelector'},viewModel:{createViewModel:function(params){return new TimeSelectorViewModel(params)}}})})}());(function(){var define=System.amdDefine;define('common/knockout.subscribeChanged.js',['node_modules/knockout/build/output/knockout-latest.debug.js'],function(ko){ko.subscribable.fn.subscribeChanged=function(callback){var previousValue;this.subscribe(function(_previousValue){previousValue=_previousValue},this,'beforeChange');var subscription=this.subscribe(function(_newValue){callback(_newValue,previousValue)});return subscription}})}());(function(){var define=System.amdDefine;define('calendar/components/dialogHeader/DialogHeaderViewModel.js',['node_modules/knockout/build/output/knockout-latest.debug.js','common/util.js'],function(ko,utils){function DialogHeaderViewModel(options){var that=this;utils.extend(that,options.context);that.close=options.close;that.back=options.back;that.onClose=options.close;that.onBack=options.back;that.tabindex=options.tabindex}return DialogHeaderViewModel})}());System.registerDynamic('calendar/components/dialogHeader/dialogHeader.ko',[],true,function($__require,exports,module){var define,global=this||self,GLOBAL=global;module.exports=function injectTemplate(tpl){var s=document.createElement('script');s.id=tpl.id;s.innerHTML=window.TR?TR.HTML(tpl.content):tpl.content;s.type='text/html';document.head.appendChild(s)}({'id':'dialogHeader','content':'<div class="dialog-header-container">\n    <!-- ko if: !!back -->\n    <div class="layout back-section">\n        <button class="back-button" data-bind="click: onBack, attr: { tabindex: tabindex }">\n            <span class="back-text" data-i18n="calendar.Back">Back</span>\n        </button>\n    </div>\n    <!-- /ko -->\n    <div class="layout title">\n        <!-- ko template: { nodes: $componentTemplateNodes } --><!-- /ko -->\n    </div>\n    <!-- ko if: !!close -->\n    <div class="layout close-section">\n        <button class="close-button" data-bind="click: onClose, attr: { tabindex: tabindex }"><span class="close-icon"></span></button>\n    </div>\n    <!-- /ko -->\n</div>\n'});return module.exports});(function(){var define=System.amdDefine;define('calendar/components/dialogHeader/dialogHeader.js',['node_modules/knockout/build/output/knockout-latest.debug.js','calendar/components/dialogHeader/DialogHeaderViewModel.js','calendar/components/dialogHeader/dialogHeader.ko'],function(ko,DialogHeaderViewModel){ko.components.register('one-dialog-header',{template:{element:'dialogHeader'},viewModel:{createViewModel:function(params){return new DialogHeaderViewModel(params)}}})})}());(function(){var define=System.amdDefine;define('calendar/dialogs/event/EventDialog.js',['node_modules/jquery/dist/jquery.js','node_modules/knockout/build/output/knockout-latest.debug.js','common/util.js','common/ViewBehavior.js','calendar/dialogs/event/RecurrenceOptionsView.js','calendar/actions/UpdateEventInstanceAction.js','calendar/actions/ScopeDetectionError.js','calendar/actions/DeleteEventInstanceAction.js','calendar/actions/CreateEventAction.js','calendar/Sort.js','calendar/ical/Duration.js','calendar/ical/Time.js','calendar/model/EventInstance.js','3rdparty/knockout-extensions/knockout.editables.js','components/inPlaceEditor/inPlaceEditor.js','calendar/components/dateSelector/dateSelector.js','calendar/components/timeSelector/timeSelector.js','common/knockout.subscribeChanged.js','calendar/components/dialogHeader/dialogHeader.js'],function($,ko,util,ViewBehavior,RecurrenceOptionsView,UpdateEventInstanceAction,ScopeDetectionError,DeleteEventInstanceAction,CreateEventAction,Sort,Duration,Time,EventInstance){var properties=['startDate','endDate','summary','description','location','calendar'];var scopeLabels={'this':TR('calendar.OnlyThisEvent','Only this event'),'all':TR('calendar.AllEventsInSeries','All events in the series'),'thisAndFuture':TR('calendar.ThisAndFutureEvents','This and future events')};function EventDialog(options){var that=this;util.extend(this,util.pick(options,'state','actionExecutor','errorHandler'));ViewBehavior.installInto(that);RecurrenceOptionsView.installInto(that);that.startDate=ko.observable().extend({notNull:true});that.endDate=ko.observable().extend({notNull:true});that.summary=ko.observable();that.description=ko.observable();that.location=ko.observable();that.summaryFocused=ko.observable(false);that.isProcessing=ko.observable(false);that.isSlideIn=!!options.slideIn;that.view=ko.observable('main');that.calendar=ko.observable(null);that.selectCalendar=function(calendar){that.calendar(calendar)};that.isNew=ko.pureComputed(function(){return that.eventInstance()&&that.eventInstance().isNew()});that.isDeletable=ko.pureComputed(function(){return that.eventInstance()&&!that.eventInstance().isNew()&&!that.isReadonly()});that.isDiscardable=ko.pureComputed(function(){return(that.hasChanges()||that.isNew())&&!that.isReadonly()});that.isReadonly=ko.pureComputed(function(){return that.calendar()&&(that.calendar().extern||!that.calendar().writable)});that.model=ko.observable(null);that.eventInstance=ko.pureComputed(function(){return that.model()&&that.model().eventInstance});var previousEventInstance;that.eventInstance.subscribe(function(eventInstance){function reset(){that.commit();that.resetRecurrenceOptions();previousEventInstance=null;that.summaryFocused(false);that.isProcessing(false)}if(eventInstance){if(previousEventInstance){reset()}that.view('main');var startDate=eventInstance.displayStartDate;if(startDate.zone!==that.state.timeZone()){startDate=startDate.convertToZone(that.state.timeZone())}var endDate=eventInstance.displayEndDate;if(endDate.zone!==that.state.timeZone()){endDate=endDate.convertToZone(that.state.timeZone())}that.startDate(startDate);that.endDate(endDate);that.isAllDayEventWhenDateFieldsAreNotFilledIn(startDate.isDate);that.summary(eventInstance.summary);that.description(eventInstance.description);that.location(eventInstance.location);that.calendar(eventInstance.event.calendar);that.initRecurrenceOptions(eventInstance);that.beginEdit();prevDates=null;previousEventInstance=eventInstance;setTimeout(function(){that.summaryFocused(true)},0);that.isProcessing(false)}else{reset()}});that.calendars=ko.computed(function(){that.state.calendars.version();return Sort.calendars.byDefaultThenByName(that.state.calendars.all().filter(function(calendar){return calendar.writable}))});that.allDayEvent=ko.pureComputed({read:function(){var startDate=that.startDate();var endDate=that.endDate();if(startDate&&endDate){return that.startDate().isDate&&that.endDate().isDate}else{return that.isAllDayEventWhenDateFieldsAreNotFilledIn()}},write:function(value){that.toggleAllDay()},owner:that});that.isAllDayEventWhenDateFieldsAreNotFilledIn=ko.observable(false);var prevDates=null;that.toggleAllDay=function(){var isAllDayEvent=that.allDayEvent();that.isAllDayEventWhenDateFieldsAreNotFilledIn(!isAllDayEvent);var endDate,startDate,startDateClone,endDateClone;if(isAllDayEvent){if(prevDates&&(!that.startDate()||prevDates.from.startOfDay().compare(that.startDate())===0)&&(!that.endDate()||prevDates.to.startOfDay().compare(that.endDate())===0)){that.startDate(prevDates.from);that.endDate(prevDates.to)}else{startDate=that.startDate();endDate=that.endDate();if(startDate){startDateClone=startDate.clone();startDateClone.isDate=false;startDateClone.hour=9;that.startDate(startDateClone)}if(endDate){endDateClone=endDate.clone();endDateClone.isDate=false;endDateClone.hour=10;that.endDate(endDateClone)}}}else{startDate=that.startDate();endDate=that.endDate();if(startDate&&endDate){prevDates={from:startDate.clone(),to:endDate.clone()};endDateClone=endDate.clone();that.startDate(startDate.startOfDay());if(endDateClone.hour===0&&endDateClone.minute===0&&endDateClone.second===0){endDateClone.isDate=true;that.endDate(endDateClone)}else{that.endDate(endDateClone.startOfDay())}}else{prevDates=null}}};that.locationUrl=ko.pureComputed(function(){return'https://maps.google.com/?q='+encodeURIComponent(that.location())});that.editableFields={};properties.concat(that.recurrenceProperties).forEach(function(property){var editableParams;if(['startDate','endDate'].indexOf(property)>-1){editableParams={equalityComparer:function(newValue,oldValue){if(newValue&&!oldValue||!newValue&&oldValue){return true}else if(!newValue&&!oldValue){return false}return newValue.compare(oldValue)===0}}}ko.editable(that[property],editableParams);that.editableFields[property]=that[property]});ko.editable(that.editableFields);['beginEdit','commit','hasChanges','rollback'].forEach(function(m){that[m]=that.editableFields[m]});that.startDate.subscribeChanged(function(newValue,previousValue){if(!newValue||!previousValue){return}var endDate=that.endDate();if(endDate){var durationDifference=endDate.clone().subtractDate(previousValue);that.endDate(newValue.clone().addDuration(durationDifference))}});that.endDate.subscribeChanged(function(newValue,previousValue){if(!newValue||!previousValue){return}var startDate=that.startDate();if(startDate&&newValue.compare(that.startDate())<0){that.endDate(previousValue.clone());var shift=newValue.clone().subtractDate(previousValue);that.startDate(that.startDate().clone().addDuration(shift))}});that.isDateRangeValid=ko.pureComputed(function(){return that.startDate.isValid()&&that.endDate.isValid()&&(that.startDate().isDate&&that.endDate().isDate&&that.startDate().compare(that.endDate())<=0||that.startDate().compare(that.endDate())<=0)});function isPropertySavable(property){var isNew=that.eventInstance()&&that.eventInstance().isNew();var isValid=!that[property].isValid||that[property].isValid();var hasChanges=that[property].hasChanges();return(hasChanges||isNew)&&isValid}that.hasSavableProperties=ko.pureComputed(function(){return properties.concat(that.recurrenceProperties).some(isPropertySavable)});that.isSavable=ko.pureComputed(function(){return that.hasSavableProperties()&&that.isDateRangeValid()&&!that.isReadonly()});that.discard=function(){that.rollback();that.model(null);that.isProcessing(false)};that.back=function(){that.view('main');that.summaryFocused(true)};that.getAllProperties=function(){var result={};properties.forEach(function(property){var value=ko.unwrap(that[property]);if(property==='calendar'&&!isPropertySavable(property)){return}result[property]=property==='endDate'?EventInstance.toDisplayEndDate(value.clone()):value});var recurrenceChanged=that.recurrenceProperties.some(function(property){if(that[property].hasChanges()){return true}return false});if(recurrenceChanged||result.startTime){result.recur=that.recurrence()?that.recurrence().rrule.toJSON():null}return result};that.scopes=ko.observableArray();that.showScopeSelector=function(possibleScopes,next){that.scopes(possibleScopes.map(function(scope){return{label:scopeLabels[scope],selectScope:function(){next(scope)}}}));that.view('scope-selector');focusFirst()};that.saveScope=function(scope){var eventInstance=that.eventInstance();var changedProperties=that.getAllProperties();var action;if(eventInstance.isNew()){action=new CreateEventAction({data:util.extend({calendar:eventInstance.event.calendar,startDate:that.startDate(),endDate:that.endDate()},changedProperties)})}else{action=new UpdateEventInstanceAction({eventInstance:eventInstance,data:changedProperties,scope:scope})}that.isProcessing(true);that.state.blockRenderingView(false);that.executeAction(action,function(err){that.isProcessing(false);if(err){that.handleError(err,{'SCOPE_DETECTION_ERROR':function(){that.showScopeSelector(err.possibleScopes,function(scope){that.saveScope(scope)})}})}else{that.commit();that.model(null)}})};that.save=function(){that.saveScope()};that.removeScope=function(scope){var eventInstance=that.eventInstance();that.isProcessing(true);that.executeAction(new DeleteEventInstanceAction({eventInstance:eventInstance,scope:scope}),function(err){that.isProcessing(false);if(err){that.handleError(err,{'SCOPE_DETECTION_ERROR':function(){that.showScopeSelector(err.possibleScopes,function(scope){that.removeScope(scope)})}})}else{that.model(null)}})};that.remove=function(){that.removeScope()};that.showRecurrence=function(){that.view('recurrence');focusFirst()};function focusFirst(){var $tabContainer=$(document.activeElement).closest('.speech-bubble').find('.dialog-'+that.view());var $firstFocus=$('.first-focus',$tabContainer);var $tabbableElements=$('[tabindex="1"]:not(:disabled):not(.ignore-tab)',$tabContainer);var firstFocusElement=$firstFocus.first()[0]||$tabbableElements.first()[0];if(firstFocusElement){firstFocusElement.focus()}}$(document).on('keydown',function(e){var activeElement=document.activeElement;if(e.keyCode===13&&activeElement.tagName!=='TEXTAREA'&&that.model()&&that.eventInstance()&&that.isSavable()){if(that.view()==='main'){that.save()}else if(that.view()==='recurrence'){that.back();that.summaryFocused(true)}}})}return EventDialog})}());(function(){var define=System.amdDefine;define('webmail/components/calendarSlideIn/CalendarSlideInViewModel.js',['node_modules/jquery/dist/jquery.js','node_modules/knockout/build/output/knockout-latest.debug.js','calendar/ical/Time.js','calendar/agenda/AgendaView.js','calendar/dialogs/event/EventDialog.js'],function($,ko,Time,AgendaView,EventDialog){ko.bindingHandlers.eventDialog={init:function(element,valueAccessor,allBindingsAccessor,viewModel,bindingContext){var options=valueAccessor();var eventDialog=bindingContext.$component.eventDialog;$(element).click(function(){eventDialog.model({eventInstance:options.eventInstance})})}};function CalendarSlideInViewModel(options,element){var that=this;var $element=$($(element).find('.slide-in'));that.open=ko.observable(false);that.animating=ko.observable(false);that.state=options.state;that.pageNavigator=options.pageNavigator;that.actionExecutor=options.actionExecutor;that.errorHandler=options.errorHandler;that.agendaView=new AgendaView({state:that.state,pageNavigator:that.pageNavigator,actionExecutor:that.actionExecutor,errorHandler:that.errorHandler,slideIn:true});that.eventDialog=new EventDialog({state:that.state,actionExecutor:that.actionExecutor,errorHandler:that.errorHandler,slideIn:true});that.eventModel=ko.pureComputed(function(){return that.eventDialog.model()});that.now=ko.pureComputed(function(){return that.state.now()});setInterval(function(){var newVersion=that.state.nowVersion.peek()+1;that.state.nowVersion(newVersion%10000)},1000);that.open.subscribe(function(openState){if(!openState){that.eventDialog.model(null)}});var onTransitionEnd=function(){that.animating(false);$element.off('transitionend webkitTransitionEnd oTransitionEnd',onTransitionEnd)};that.toggleSlideIn=function(evt){var newState=!that.open.peek();that.open(newState);that.animating(true);$element.on('transitionend webkitTransitionEnd oTransitionEnd',onTransitionEnd)}}return CalendarSlideInViewModel})}());(function(){var define=System.amdDefine;define('3rdparty/knockout.formatDate.js',['node_modules/knockout/build/output/knockout-latest.debug.js'],function(ko){var isEdge13Or14=/\bEdge\/1[34]\./.test(navigator.userAgent);function getDateFormatFromContext(formatId,date){var dateFormatId='shortDate',dateFormat;if(typeof formatId==='string'){dateFormatId=formatId;if(dateFormatId.indexOf('/')!==-1){var dateFormatIds=dateFormatId.split('/');var now=new Date;var year=date&&(date.getFullYear&&date.getFullYear()||date.year);var month=date&&(date.getMonth&&date.getMonth());if(typeof month!=='number'){month=date.month-1}var day=date&&(date.getDate&&date.getDate()||date.day);if(year===now.getFullYear()&&month===now.getMonth()&&day===now.getDate()){dateFormatId=dateFormatIds[0]}else{dateFormatId=dateFormatIds[1]}}dateFormat=inter.getDateFormat(dateFormatId)}else if(Array.isArray(formatId)){var timeFormatString=inter.getDateFormat(formatId[0]),dateFormatString=inter.getDateFormat(formatId[1]);dateFormat=inter.calendars.gregorian.defaultDateTimePattern.replace('{0}',timeFormatString).replace('{1}',dateFormatString)}return dateFormat}ko.utils.extend(ko.bindingHandlers,{formatDate:{update:function(element,valueAccessor,allBindings){var options=ko.utils.unwrapObservable(valueAccessor()),dateFormat='',tooltipDateFormat='',date;if(options&&typeof options.toJSDate==='function'){dateFormat=getDateFormatFromContext('',date)}else if(Object.prototype.toString.call(options)==='[object Date]'){date=options;dateFormat=getDateFormatFromContext('',date)}else if(options.value){date=ko.utils.unwrapObservable(options.value);if(options.formatId){dateFormat=getDateFormatFromContext(options.formatId,date)}else if(options.format){dateFormat=options.format}if(options.tooltipFormatId&&date){tooltipDateFormat=getDateFormatFromContext(options.tooltipFormatId,date)}else if(options.tooltipFormat){tooltipDateFormat=options.tooltipFormat}if(tooltipDateFormat&&date){element.setAttribute('data-title',inter.renderDateFormat(date,tooltipDateFormat))}}var textContent=date?inter.renderDateFormat(date,dateFormat):'';if(isEdge13Or14){element.innerHTML=String(textContent).replace(/</g,'&lt;')}else{ko.utils.setTextContent(element,textContent)}}}})})}());(function(){var define=System.amdDefine;define('theme/binding/knockout.checkbox.js',['node_modules/knockout/build/output/knockout-latest.debug.js','node_modules/jquery/dist/jquery.js'],function(ko,$){var KEY_ENTER=13,KEY_SPACE=32,MOUSE_LEFT=1;ko.bindingHandlers.checkbox={init:function(element,valueAccessor){var $element=$(element);$element.addClass('checkbox');function toggle(){var value=valueAccessor();value(!value())}$element.on('keydown',function(e){if(e.which===KEY_SPACE){toggle();e.preventDefault()}else if(e.which===KEY_ENTER){e.preventDefault()}});$element.on('mousedown',function(e){if(e.which===MOUSE_LEFT){toggle();element.focus();e.stopPropagation();e.preventDefault()}});$element.on('click',function(e){e.stopPropagation();e.preventDefault();return false})},update:function(element,valueAccessor){var value=valueAccessor();var checked=ko.utils.unwrapObservable(value);$(element).toggleClass('checked',checked)}}})}());(function(){var define=System.amdDefine;(function(){var DEBUG=true;(function(undefined){var window=this||(0,eval)('this'),document=window['document'],navigator=window['navigator'],jQueryInstance=window['jQuery'],JSON=window['JSON'];(function(factory){if(typeof define==='function'&&define['amd']){define('node_modules/knockout/build/output/knockout-latest.debug.js',['exports','require'],factory)}else if(typeof exports==='object'&&typeof module==='object'){factory(module['exports']||exports)}else{factory(window['ko']={})}}(function(koExports,amdRequire){var ko=typeof koExports!=='undefined'?koExports:{};ko.exportSymbol=function(koPath,object){var tokens=koPath.split('.');var target=ko;for(var i=0;i<tokens.length-1;i++)target=target[tokens[i]];target[tokens[tokens.length-1]]=object};ko.exportProperty=function(owner,publicName,object){owner[publicName]=object};ko.version='3.4.1';ko.exportSymbol('version',ko.version);ko.options={'deferUpdates':false,'useOnlyNativeEvents':false};ko.utils=function(){function objectForEach(obj,action){for(var prop in obj){if(obj.hasOwnProperty(prop)){action(prop,obj[prop])}}}function extend(target,source){if(source){for(var prop in source){if(source.hasOwnProperty(prop)){target[prop]=source[prop]}}}return target}function setPrototypeOf(obj,proto){obj.__proto__=proto;return obj}var canSetPrototype={__proto__:[]}instanceof Array;var canUseSymbols=!DEBUG&&typeof Symbol==='function';var knownEvents={},knownEventTypesByEventName={};var keyEventTypeName=navigator&&/Firefox\/2/i.test(navigator.userAgent)?'KeyboardEvent':'UIEvents';knownEvents[keyEventTypeName]=['keyup','keydown','keypress'];knownEvents['MouseEvents']=['click','dblclick','mousedown','mouseup','mousemove','mouseover','mouseout','mouseenter','mouseleave'];objectForEach(knownEvents,function(eventType,knownEventsForType){if(knownEventsForType.length){for(var i=0,j=knownEventsForType.length;i<j;i++)knownEventTypesByEventName[knownEventsForType[i]]=eventType}});var eventsThatMustBeRegisteredUsingAttachEvent={'propertychange':true};var ieVersion=document&&function(){var version=3,div=document.createElement('div'),iElems=div.getElementsByTagName('i');while(div.innerHTML='<!--[if gt IE '+ ++version+']><i></i><![endif]-->',iElems[0]){}return version>4?version:undefined}();var isIe6=ieVersion===6,isIe7=ieVersion===7;function isClickOnCheckableElement(element,eventType){if(ko.utils.tagNameLower(element)!=='input'||!element.type)return false;if(eventType.toLowerCase()!='click')return false;var inputType=element.type;return inputType=='checkbox'||inputType=='radio'}var cssClassNameRegex=/\S+/g;function toggleDomNodeCssClass(node,classNames,shouldHaveClass){var addOrRemoveFn;if(classNames){if(typeof node.classList==='object'){addOrRemoveFn=node.classList[shouldHaveClass?'add':'remove'];ko.utils.arrayForEach(classNames.match(cssClassNameRegex),function(className){addOrRemoveFn.call(node.classList,className)})}else if(typeof node.className['baseVal']==='string'){toggleObjectClassPropertyString(node.className,'baseVal',classNames,shouldHaveClass)}else{toggleObjectClassPropertyString(node,'className',classNames,shouldHaveClass)}}}function toggleObjectClassPropertyString(obj,prop,classNames,shouldHaveClass){var currentClassNames=obj[prop].match(cssClassNameRegex)||[];ko.utils.arrayForEach(classNames.match(cssClassNameRegex),function(className){ko.utils.addOrRemoveItem(currentClassNames,className,shouldHaveClass)});obj[prop]=currentClassNames.join(' ')}return{fieldsIncludedWithJsonPost:['authenticity_token',/^__RequestVerificationToken(_.*)?$/],arrayForEach:function(array,action){for(var i=0,j=array.length;i<j;i++)action(array[i],i)},arrayIndexOf:function(array,item){if(typeof Array.prototype.indexOf=='function')return Array.prototype.indexOf.call(array,item);for(var i=0,j=array.length;i<j;i++)if(array[i]===item)return i;return-1},arrayFirst:function(array,predicate,predicateOwner){for(var i=0,j=array.length;i<j;i++)if(predicate.call(predicateOwner,array[i],i))return array[i];return null},arrayRemoveItem:function(array,itemToRemove){var index=ko.utils.arrayIndexOf(array,itemToRemove);if(index>0){array.splice(index,1)}else if(index===0){array.shift()}},arrayGetDistinctValues:function(array){array=array||[];var result=[];for(var i=0,j=array.length;i<j;i++){if(ko.utils.arrayIndexOf(result,array[i])<0)result.push(array[i])}return result},arrayMap:function(array,mapping){array=array||[];var result=[];for(var i=0,j=array.length;i<j;i++)result.push(mapping(array[i],i));return result},arrayFilter:function(array,predicate){array=array||[];var result=[];for(var i=0,j=array.length;i<j;i++)if(predicate(array[i],i))result.push(array[i]);return result},arrayPushAll:function(array,valuesToPush){if(valuesToPush instanceof Array)array.push.apply(array,valuesToPush);else for(var i=0,j=valuesToPush.length;i<j;i++)array.push(valuesToPush[i]);return array},addOrRemoveItem:function(array,value,included){var existingEntryIndex=ko.utils.arrayIndexOf(ko.utils.peekObservable(array),value);if(existingEntryIndex<0){if(included)array.push(value)}else{if(!included)array.splice(existingEntryIndex,1)}},canSetPrototype:canSetPrototype,extend:extend,setPrototypeOf:setPrototypeOf,setPrototypeOfOrExtend:canSetPrototype?setPrototypeOf:extend,objectForEach:objectForEach,objectMap:function(source,mapping){if(!source)return source;var target={};for(var prop in source){if(source.hasOwnProperty(prop)){target[prop]=mapping(source[prop],prop,source)}}return target},emptyDomNode:function(domNode){while(domNode.firstChild){ko.removeNode(domNode.firstChild)}},moveCleanedNodesToContainerElement:function(nodes){var nodesArray=ko.utils.makeArray(nodes);var templateDocument=nodesArray[0]&&nodesArray[0].ownerDocument||document;var container=templateDocument.createElement('div');for(var i=0,j=nodesArray.length;i<j;i++){container.appendChild(ko.cleanNode(nodesArray[i]))}return container},cloneNodes:function(nodesArray,shouldCleanNodes){for(var i=0,j=nodesArray.length,newNodesArray=[];i<j;i++){var clonedNode=nodesArray[i].cloneNode(true);newNodesArray.push(shouldCleanNodes?ko.cleanNode(clonedNode):clonedNode)}return newNodesArray},setDomNodeChildren:function(domNode,childNodes){ko.utils.emptyDomNode(domNode);if(childNodes){for(var i=0,j=childNodes.length;i<j;i++)domNode.appendChild(childNodes[i])}},replaceDomNodes:function(nodeToReplaceOrNodeArray,newNodesArray){var nodesToReplaceArray=nodeToReplaceOrNodeArray.nodeType?[nodeToReplaceOrNodeArray]:nodeToReplaceOrNodeArray;if(nodesToReplaceArray.length>0){var insertionPoint=nodesToReplaceArray[0];var parent=insertionPoint.parentNode;for(var i=0,j=newNodesArray.length;i<j;i++)parent.insertBefore(newNodesArray[i],insertionPoint);for(var i=0,j=nodesToReplaceArray.length;i<j;i++){ko.removeNode(nodesToReplaceArray[i])}}},fixUpContinuousNodeArray:function(continuousNodeArray,parentNode){if(continuousNodeArray.length){parentNode=parentNode.nodeType===8&&parentNode.parentNode||parentNode;while(continuousNodeArray.length&&continuousNodeArray[0].parentNode!==parentNode)continuousNodeArray.splice(0,1);while(continuousNodeArray.length>1&&continuousNodeArray[continuousNodeArray.length-1].parentNode!==parentNode)continuousNodeArray.length--;if(continuousNodeArray.length>1){var current=continuousNodeArray[0],last=continuousNodeArray[continuousNodeArray.length-1];continuousNodeArray.length=0;while(current!==last){continuousNodeArray.push(current);current=current.nextSibling}continuousNodeArray.push(last)}}return continuousNodeArray},setOptionNodeSelectionState:function(optionNode,isSelected){if(ieVersion<7)optionNode.setAttribute('selected',isSelected);else optionNode.selected=isSelected},stringTrim:function(string){return string===null||string===undefined?'':string.trim?string.trim():string.toString().replace(/^[\s\xa0]+|[\s\xa0]+$/g,'')},stringStartsWith:function(string,startsWith){string=string||'';if(startsWith.length>string.length)return false;return string.substring(0,startsWith.length)===startsWith},domNodeIsContainedBy:function(node,containedByNode){if(node===containedByNode)return true;if(node.nodeType===11)return false;if(containedByNode.contains)return containedByNode.contains(node.nodeType===3?node.parentNode:node);if(containedByNode.compareDocumentPosition)return(containedByNode.compareDocumentPosition(node)&16)==16;while(node&&node!=containedByNode){node=node.parentNode}return!!node},domNodeIsAttachedToDocument:function(node){return ko.utils.domNodeIsContainedBy(node,node.ownerDocument.documentElement)},anyDomNodeIsAttachedToDocument:function(nodes){return!!ko.utils.arrayFirst(nodes,ko.utils.domNodeIsAttachedToDocument)},tagNameLower:function(element){return element&&element.tagName&&element.tagName.toLowerCase()},catchFunctionErrors:function(delegate){return ko['onError']?function(){try{return delegate.apply(this,arguments)}catch(e){ko['onError']&&ko['onError'](e);throw e}}:delegate},setTimeout:function(handler,timeout){return setTimeout(ko.utils.catchFunctionErrors(handler),timeout)},deferError:function(error){setTimeout(function(){ko['onError']&&ko['onError'](error);throw error},0)},registerEventHandler:function(element,eventType,handler){var wrappedHandler=ko.utils.catchFunctionErrors(handler);var mustUseAttachEvent=ieVersion&&eventsThatMustBeRegisteredUsingAttachEvent[eventType];if(!ko.options['useOnlyNativeEvents']&&!mustUseAttachEvent&&jQueryInstance){jQueryInstance(element)['bind'](eventType,wrappedHandler)}else if(!mustUseAttachEvent&&typeof element.addEventListener=='function')element.addEventListener(eventType,wrappedHandler,false);else if(typeof element.attachEvent!='undefined'){var attachEventHandler=function(event){wrappedHandler.call(element,event)},attachEventName='on'+eventType;element.attachEvent(attachEventName,attachEventHandler);ko.utils.domNodeDisposal.addDisposeCallback(element,function(){element.detachEvent(attachEventName,attachEventHandler)})}else throw new Error('Browser doesn\'t support addEventListener or attachEvent')},triggerEvent:function(element,eventType){if(!(element&&element.nodeType))throw new Error('element must be a DOM node when calling triggerEvent');var useClickWorkaround=isClickOnCheckableElement(element,eventType);if(!ko.options['useOnlyNativeEvents']&&jQueryInstance&&!useClickWorkaround){jQueryInstance(element)['trigger'](eventType)}else if(typeof document.createEvent=='function'){if(typeof element.dispatchEvent=='function'){var eventCategory=knownEventTypesByEventName[eventType]||'HTMLEvents';var event=document.createEvent(eventCategory);event.initEvent(eventType,true,true,window,0,0,0,0,0,false,false,false,false,0,element);element.dispatchEvent(event)}else throw new Error('The supplied element doesn\'t support dispatchEvent')}else if(useClickWorkaround&&element.click){element.click()}else if(typeof element.fireEvent!='undefined'){element.fireEvent('on'+eventType)}else{throw new Error('Browser doesn\'t support triggering events')}},unwrapObservable:function(value){return ko.isObservable(value)?value():value},peekObservable:function(value){return ko.isObservable(value)?value.peek():value},toggleDomNodeCssClass:toggleDomNodeCssClass,setTextContent:function(element,textContent){var value=ko.utils.unwrapObservable(textContent);if(value===null||value===undefined)value='';var innerTextNode=ko.virtualElements.firstChild(element);if(!innerTextNode||innerTextNode.nodeType!=3||ko.virtualElements.nextSibling(innerTextNode)){ko.virtualElements.setDomNodeChildren(element,[element.ownerDocument.createTextNode(value)])}else{innerTextNode.data=value}ko.utils.forceRefresh(element)},setElementName:function(element,name){element.name=name;if(ieVersion<=7){try{element.mergeAttributes(document.createElement('<input name=\''+element.name+'\'/>'),false)}catch(e){}}},forceRefresh:function(node){if(ieVersion>=9){var elem=node.nodeType==1?node:node.parentNode;if(elem.style)elem.style.zoom=elem.style.zoom}},ensureSelectElementIsRenderedCorrectly:function(selectElement){if(ieVersion){var originalWidth=selectElement.style.width;selectElement.style.width=0;selectElement.style.width=originalWidth}},range:function(min,max){min=ko.utils.unwrapObservable(min);max=ko.utils.unwrapObservable(max);var result=[];for(var i=min;i<=max;i++)result.push(i);return result},makeArray:function(arrayLikeObject){var result=[];for(var i=0,j=arrayLikeObject.length;i<j;i++){result.push(arrayLikeObject[i])};return result},createSymbolOrString:function(identifier){return canUseSymbols?Symbol(identifier):identifier},isIe6:isIe6,isIe7:isIe7,ieVersion:ieVersion,getFormFields:function(form,fieldName){var fields=ko.utils.makeArray(form.getElementsByTagName('input')).concat(ko.utils.makeArray(form.getElementsByTagName('textarea')));var isMatchingField=typeof fieldName=='string'?function(field){return field.name===fieldName}:function(field){return fieldName.test(field.name)};var matches=[];for(var i=fields.length-1;i>=0;i--){if(isMatchingField(fields[i]))matches.push(fields[i])};return matches},parseJson:function(jsonString){if(typeof jsonString=='string'){jsonString=ko.utils.stringTrim(jsonString);if(jsonString){if(JSON&&JSON.parse)return JSON.parse(jsonString);return new Function('return '+jsonString)()}}return null},stringifyJson:function(data,replacer,space){if(!JSON||!JSON.stringify)throw new Error('Cannot find JSON.stringify(). Some browsers (e.g., IE < 8) don\'t support it natively, but you can overcome this by adding a script reference to json2.js, downloadable from http://www.json.org/json2.js');return JSON.stringify(ko.utils.unwrapObservable(data),replacer,space)},postJson:function(urlOrForm,data,options){options=options||{};var params=options['params']||{};var includeFields=options['includeFields']||this.fieldsIncludedWithJsonPost;var url=urlOrForm;if(typeof urlOrForm=='object'&&ko.utils.tagNameLower(urlOrForm)==='form'){var originalForm=urlOrForm;url=originalForm.action;for(var i=includeFields.length-1;i>=0;i--){var fields=ko.utils.getFormFields(originalForm,includeFields[i]);for(var j=fields.length-1;j>=0;j--)params[fields[j].name]=fields[j].value}}data=ko.utils.unwrapObservable(data);var form=document.createElement('form');form.style.display='none';form.action=url;form.method='post';for(var key in data){var input=document.createElement('input');input.type='hidden';input.name=key;input.value=ko.utils.stringifyJson(ko.utils.unwrapObservable(data[key]));form.appendChild(input)}objectForEach(params,function(key,value){var input=document.createElement('input');input.type='hidden';input.name=key;input.value=value;form.appendChild(input)});document.body.appendChild(form);options['submitter']?options['submitter'](form):form.submit();setTimeout(function(){form.parentNode.removeChild(form)},0)}}}();ko.exportSymbol('utils',ko.utils);ko.exportSymbol('utils.arrayForEach',ko.utils.arrayForEach);ko.exportSymbol('utils.arrayFirst',ko.utils.arrayFirst);ko.exportSymbol('utils.arrayFilter',ko.utils.arrayFilter);ko.exportSymbol('utils.arrayGetDistinctValues',ko.utils.arrayGetDistinctValues);ko.exportSymbol('utils.arrayIndexOf',ko.utils.arrayIndexOf);ko.exportSymbol('utils.arrayMap',ko.utils.arrayMap);ko.exportSymbol('utils.arrayPushAll',ko.utils.arrayPushAll);ko.exportSymbol('utils.arrayRemoveItem',ko.utils.arrayRemoveItem);ko.exportSymbol('utils.extend',ko.utils.extend);ko.exportSymbol('utils.fieldsIncludedWithJsonPost',ko.utils.fieldsIncludedWithJsonPost);ko.exportSymbol('utils.getFormFields',ko.utils.getFormFields);ko.exportSymbol('utils.peekObservable',ko.utils.peekObservable);ko.exportSymbol('utils.postJson',ko.utils.postJson);ko.exportSymbol('utils.parseJson',ko.utils.parseJson);ko.exportSymbol('utils.registerEventHandler',ko.utils.registerEventHandler);ko.exportSymbol('utils.stringifyJson',ko.utils.stringifyJson);ko.exportSymbol('utils.range',ko.utils.range);ko.exportSymbol('utils.toggleDomNodeCssClass',ko.utils.toggleDomNodeCssClass);ko.exportSymbol('utils.triggerEvent',ko.utils.triggerEvent);ko.exportSymbol('utils.unwrapObservable',ko.utils.unwrapObservable);ko.exportSymbol('utils.objectForEach',ko.utils.objectForEach);ko.exportSymbol('utils.addOrRemoveItem',ko.utils.addOrRemoveItem);ko.exportSymbol('utils.setTextContent',ko.utils.setTextContent);ko.exportSymbol('unwrap',ko.utils.unwrapObservable);if(!Function.prototype['bind']){Function.prototype['bind']=function(object){var originalFunction=this;if(arguments.length===1){return function(){return originalFunction.apply(object,arguments)}}else{var partialArgs=Array.prototype.slice.call(arguments,1);return function(){var args=partialArgs.slice(0);args.push.apply(args,arguments);return originalFunction.apply(object,args)}}}}ko.utils.domData=new function(){var uniqueId=0;var dataStoreKeyExpandoPropertyName='__ko__'+new Date().getTime();var dataStore={};function getAll(node,createIfNotFound){var dataStoreKey=node[dataStoreKeyExpandoPropertyName];var hasExistingDataStore=dataStoreKey&&dataStoreKey!=='null'&&dataStore[dataStoreKey];if(!hasExistingDataStore){if(!createIfNotFound)return undefined;dataStoreKey=node[dataStoreKeyExpandoPropertyName]='ko'+uniqueId++;dataStore[dataStoreKey]={}}return dataStore[dataStoreKey]}return{get:function(node,key){var allDataForNode=getAll(node,false);return allDataForNode===undefined?undefined:allDataForNode[key]},set:function(node,key,value){if(value===undefined){if(getAll(node,false)===undefined)return}var allDataForNode=getAll(node,true);allDataForNode[key]=value},clear:function(node){var dataStoreKey=node[dataStoreKeyExpandoPropertyName];if(dataStoreKey){delete dataStore[dataStoreKey];node[dataStoreKeyExpandoPropertyName]=null;return true}return false},nextKey:function(){return uniqueId++ +dataStoreKeyExpandoPropertyName}}};ko.exportSymbol('utils.domData',ko.utils.domData);ko.exportSymbol('utils.domData.clear',ko.utils.domData.clear);ko.utils.domNodeDisposal=new function(){var domDataKey=ko.utils.domData.nextKey();var cleanableNodeTypes={1:true,8:true,9:true};var cleanableNodeTypesWithDescendants={1:true,9:true};function getDisposeCallbacksCollection(node,createIfNotFound){var allDisposeCallbacks=ko.utils.domData.get(node,domDataKey);if(allDisposeCallbacks===undefined&&createIfNotFound){allDisposeCallbacks=[];ko.utils.domData.set(node,domDataKey,allDisposeCallbacks)}return allDisposeCallbacks}function destroyCallbacksCollection(node){ko.utils.domData.set(node,domDataKey,undefined)}function cleanSingleNode(node){var callbacks=getDisposeCallbacksCollection(node,false);if(callbacks){callbacks=callbacks.slice(0);for(var i=0;i<callbacks.length;i++)callbacks[i](node)}ko.utils.domData.clear(node);ko.utils.domNodeDisposal['cleanExternalData'](node);if(cleanableNodeTypesWithDescendants[node.nodeType])cleanImmediateCommentTypeChildren(node)}function cleanImmediateCommentTypeChildren(nodeWithChildren){var child,nextChild=nodeWithChildren.firstChild;while(child=nextChild){nextChild=child.nextSibling;if(child.nodeType===8)cleanSingleNode(child)}}return{addDisposeCallback:function(node,callback){if(typeof callback!='function')throw new Error('Callback must be a function');getDisposeCallbacksCollection(node,true).push(callback)},removeDisposeCallback:function(node,callback){var callbacksCollection=getDisposeCallbacksCollection(node,false);if(callbacksCollection){ko.utils.arrayRemoveItem(callbacksCollection,callback);if(callbacksCollection.length==0)destroyCallbacksCollection(node)}},cleanNode:function(node){if(cleanableNodeTypes[node.nodeType]){cleanSingleNode(node);if(cleanableNodeTypesWithDescendants[node.nodeType]){var descendants=[];ko.utils.arrayPushAll(descendants,node.getElementsByTagName('*'));for(var i=0,j=descendants.length;i<j;i++)cleanSingleNode(descendants[i])}}return node},removeNode:function(node){ko.cleanNode(node);if(node.parentNode)node.parentNode.removeChild(node)},'cleanExternalData':function(node){if(jQueryInstance&&typeof jQueryInstance['cleanData']=='function')jQueryInstance['cleanData']([node])}}};ko.cleanNode=ko.utils.domNodeDisposal.cleanNode;ko.removeNode=ko.utils.domNodeDisposal.removeNode;ko.exportSymbol('cleanNode',ko.cleanNode);ko.exportSymbol('removeNode',ko.removeNode);ko.exportSymbol('utils.domNodeDisposal',ko.utils.domNodeDisposal);ko.exportSymbol('utils.domNodeDisposal.addDisposeCallback',ko.utils.domNodeDisposal.addDisposeCallback);ko.exportSymbol('utils.domNodeDisposal.removeDisposeCallback',ko.utils.domNodeDisposal.removeDisposeCallback);(function(){var none=[0,'',''],table=[1,'<table>','</table>'],tbody=[2,'<table><tbody>','</tbody></table>'],tr=[3,'<table><tbody><tr>','</tr></tbody></table>'],select=[1,'<select multiple=\'multiple\'>','</select>'],lookup={'thead':table,'tbody':table,'tfoot':table,'tr':tbody,'td':tr,'th':tr,'option':select,'optgroup':select},mayRequireCreateElementHack=ko.utils.ieVersion<=8;function getWrap(tags){var m=tags.match(/^<([a-z]+)[ >]/);return m&&lookup[m[1]]||none}function simpleHtmlParse(html,documentContext){documentContext||(documentContext=document);var windowContext=documentContext['parentWindow']||documentContext['defaultView']||window;var tags=ko.utils.stringTrim(html).toLowerCase(),div=documentContext.createElement('div'),wrap=getWrap(tags),depth=wrap[0];var markup='ignored<div>'+wrap[1]+html+wrap[2]+'</div>';if(typeof windowContext['innerShiv']=='function'){div.appendChild(windowContext['innerShiv'](markup))}else{if(mayRequireCreateElementHack){documentContext.appendChild(div)}div.innerHTML=markup;if(mayRequireCreateElementHack){div.parentNode.removeChild(div)}}while(depth--)div=div.lastChild;return ko.utils.makeArray(div.lastChild.childNodes)}function jQueryHtmlParse(html,documentContext){if(jQueryInstance['parseHTML']){return jQueryInstance['parseHTML'](html,documentContext)||[]}else{var elems=jQueryInstance['clean']([html],documentContext);if(elems&&elems[0]){var elem=elems[0];while(elem.parentNode&&elem.parentNode.nodeType!==11)elem=elem.parentNode;if(elem.parentNode)elem.parentNode.removeChild(elem)}return elems}}ko.utils.parseHtmlFragment=function(html,documentContext){return jQueryInstance?jQueryHtmlParse(html,documentContext):simpleHtmlParse(html,documentContext)};ko.utils.setHtml=function(node,html){ko.utils.emptyDomNode(node);html=ko.utils.unwrapObservable(html);if(html!==null&&html!==undefined){if(typeof html!='string')html=html.toString();if(jQueryInstance){jQueryInstance(node)['html'](html)}else{var parsedNodes=ko.utils.parseHtmlFragment(html,node.ownerDocument);for(var i=0;i<parsedNodes.length;i++)node.appendChild(parsedNodes[i])}}}}());ko.exportSymbol('utils.parseHtmlFragment',ko.utils.parseHtmlFragment);ko.exportSymbol('utils.setHtml',ko.utils.setHtml);ko.memoization=function(){var memos={};function randomMax8HexChars(){return((1+Math.random())*4294967296|0).toString(16).substring(1)}function generateRandomId(){return randomMax8HexChars()+randomMax8HexChars()}function findMemoNodes(rootNode,appendToArray){if(!rootNode)return;if(rootNode.nodeType==8){var memoId=ko.memoization.parseMemoText(rootNode.nodeValue);if(memoId!=null)appendToArray.push({domNode:rootNode,memoId:memoId})}else if(rootNode.nodeType==1){for(var i=0,childNodes=rootNode.childNodes,j=childNodes.length;i<j;i++)findMemoNodes(childNodes[i],appendToArray)}}return{memoize:function(callback){if(typeof callback!='function')throw new Error('You can only pass a function to ko.memoization.memoize()');var memoId=generateRandomId();memos[memoId]=callback;return'<!--[ko_memo:'+memoId+']-->'},unmemoize:function(memoId,callbackParams){var callback=memos[memoId];if(callback===undefined)throw new Error('Couldn\'t find any memo with ID '+memoId+'. Perhaps it\'s already been unmemoized.');try{callback.apply(null,callbackParams||[]);return true}finally{delete memos[memoId]}},unmemoizeDomNodeAndDescendants:function(domNode,extraCallbackParamsArray){var memos=[];findMemoNodes(domNode,memos);for(var i=0,j=memos.length;i<j;i++){var node=memos[i].domNode;var combinedParams=[node];if(extraCallbackParamsArray)ko.utils.arrayPushAll(combinedParams,extraCallbackParamsArray);ko.memoization.unmemoize(memos[i].memoId,combinedParams);node.nodeValue='';if(node.parentNode)node.parentNode.removeChild(node)}},parseMemoText:function(memoText){var match=memoText.match(/^\[ko_memo\:(.*?)\]$/);return match?match[1]:null}}}();ko.exportSymbol('memoization',ko.memoization);ko.exportSymbol('memoization.memoize',ko.memoization.memoize);ko.exportSymbol('memoization.unmemoize',ko.memoization.unmemoize);ko.exportSymbol('memoization.parseMemoText',ko.memoization.parseMemoText);ko.exportSymbol('memoization.unmemoizeDomNodeAndDescendants',ko.memoization.unmemoizeDomNodeAndDescendants);ko.tasks=function(){var scheduler,taskQueue=[],taskQueueLength=0,nextHandle=1,nextIndexToProcess=0;if(window['MutationObserver']){scheduler=function(callback){var div=document.createElement('div');new MutationObserver(callback).observe(div,{attributes:true});return function(){div.classList.toggle('foo')}}(scheduledProcess)}else if(document&&'onreadystatechange'in document.createElement('script')){scheduler=function(callback){var script=document.createElement('script');script.onreadystatechange=function(){script.onreadystatechange=null;document.documentElement.removeChild(script);script=null;callback()};document.documentElement.appendChild(script)}}else{scheduler=function(callback){setTimeout(callback,0)}}function processTasks(){if(taskQueueLength){var mark=taskQueueLength,countMarks=0;for(var task;nextIndexToProcess<taskQueueLength;){if(task=taskQueue[nextIndexToProcess++]){if(nextIndexToProcess>mark){if(++countMarks>=5000){nextIndexToProcess=taskQueueLength;ko.utils.deferError(Error('\'Too much recursion\' after processing '+countMarks+' task groups.'));break}mark=taskQueueLength}try{task()}catch(ex){ko.utils.deferError(ex)}}}}}function scheduledProcess(){processTasks();nextIndexToProcess=taskQueueLength=taskQueue.length=0}function scheduleTaskProcessing(){ko.tasks['scheduler'](scheduledProcess)}var tasks={'scheduler':scheduler,schedule:function(func){if(!taskQueueLength){scheduleTaskProcessing()}taskQueue[taskQueueLength++]=func;return nextHandle++},cancel:function(handle){var index=handle-(nextHandle-taskQueueLength);if(index>=nextIndexToProcess&&index<taskQueueLength){taskQueue[index]=null}},'resetForTesting':function(){var length=taskQueueLength-nextIndexToProcess;nextIndexToProcess=taskQueueLength=taskQueue.length=0;return length},runEarly:processTasks};return tasks}();ko.exportSymbol('tasks',ko.tasks);ko.exportSymbol('tasks.schedule',ko.tasks.schedule);ko.exportSymbol('tasks.runEarly',ko.tasks.runEarly);ko.extenders={'throttle':function(target,timeout){target['throttleEvaluation']=timeout;var writeTimeoutInstance=null;return ko.dependentObservable({'read':target,'write':function(value){clearTimeout(writeTimeoutInstance);writeTimeoutInstance=ko.utils.setTimeout(function(){target(value)},timeout)}})},'rateLimit':function(target,options){var timeout,method,limitFunction;if(typeof options=='number'){timeout=options}else{timeout=options['timeout'];method=options['method']}target._deferUpdates=false;limitFunction=method=='notifyWhenChangesStop'?debounce:throttle;target.limit(function(callback){return limitFunction(callback,timeout)})},'deferred':function(target,options){if(options!==true){throw new Error('The \'deferred\' extender only accepts the value \'true\', because it is not supported to turn deferral off once enabled.')}if(!target._deferUpdates){target._deferUpdates=true;target.limit(function(callback){var handle;return function(){ko.tasks.cancel(handle);handle=ko.tasks.schedule(callback);target['notifySubscribers'](undefined,'dirty')}})}},'notify':function(target,notifyWhen){target['equalityComparer']=notifyWhen=='always'?null:valuesArePrimitiveAndEqual}};var primitiveTypes={'undefined':1,'boolean':1,'number':1,'string':1};function valuesArePrimitiveAndEqual(a,b){var oldValueIsPrimitive=a===null||typeof a in primitiveTypes;return oldValueIsPrimitive?a===b:false}function throttle(callback,timeout){var timeoutInstance;return function(){if(!timeoutInstance){timeoutInstance=ko.utils.setTimeout(function(){timeoutInstance=undefined;callback()},timeout)}}}function debounce(callback,timeout){var timeoutInstance;return function(){clearTimeout(timeoutInstance);timeoutInstance=ko.utils.setTimeout(callback,timeout)}}function applyExtenders(requestedExtenders){var target=this;if(requestedExtenders){ko.utils.objectForEach(requestedExtenders,function(key,value){var extenderHandler=ko.extenders[key];if(typeof extenderHandler=='function'){target=extenderHandler(target,value)||target}})}return target}ko.exportSymbol('extenders',ko.extenders);ko.subscription=function(target,callback,disposeCallback){this._target=target;this.callback=callback;this.disposeCallback=disposeCallback;this.isDisposed=false;ko.exportProperty(this,'dispose',this.dispose)};ko.subscription.prototype.dispose=function(){this.isDisposed=true;this.disposeCallback()};ko.subscribable=function(){ko.utils.setPrototypeOfOrExtend(this,ko_subscribable_fn);ko_subscribable_fn.init(this)};var defaultEvent='change';function limitNotifySubscribers(value,event){if(!event||event===defaultEvent){this._limitChange(value)}else if(event==='beforeChange'){this._limitBeforeChange(value)}else{this._origNotifySubscribers(value,event)}}var ko_subscribable_fn={init:function(instance){instance._subscriptions={};instance._versionNumber=1},subscribe:function(callback,callbackTarget,event){var self=this;event=event||defaultEvent;var boundCallback=callbackTarget?callback.bind(callbackTarget):callback;var subscription=new ko.subscription(self,boundCallback,function(){ko.utils.arrayRemoveItem(self._subscriptions[event],subscription);if(self.afterSubscriptionRemove)self.afterSubscriptionRemove(event)});if(self.beforeSubscriptionAdd)self.beforeSubscriptionAdd(event);if(!self._subscriptions[event])self._subscriptions[event]=[];self._subscriptions[event].push(subscription);return subscription},'notifySubscribers':function(valueToNotify,event){event=event||defaultEvent;if(event===defaultEvent){this.updateVersion()}if(this.hasSubscriptionsForEvent(event)){try{ko.dependencyDetection.begin();for(var a=this._subscriptions[event].slice(0),i=0,subscription;subscription=a[i];++i){if(!subscription.isDisposed)subscription.callback(valueToNotify)}}finally{ko.dependencyDetection.end()}}},getVersion:function(){return this._versionNumber},hasChanged:function(versionToCheck){return this.getVersion()!==versionToCheck},updateVersion:function(){++this._versionNumber},limit:function(limitFunction){var self=this,selfIsObservable=ko.isObservable(self),ignoreBeforeChange,previousValue,pendingValue,beforeChange='beforeChange';if(!self._origNotifySubscribers){self._origNotifySubscribers=self['notifySubscribers'];self['notifySubscribers']=limitNotifySubscribers}var finish=limitFunction(function(){self._notificationIsPending=false;if(selfIsObservable&&pendingValue===self){pendingValue=self()}ignoreBeforeChange=false;if(self.isDifferent(previousValue,pendingValue)){self._origNotifySubscribers(previousValue=pendingValue)}});self._limitChange=function(value){self._notificationIsPending=ignoreBeforeChange=true;pendingValue=value;finish()};self._limitBeforeChange=function(value){if(!ignoreBeforeChange){previousValue=value;self._origNotifySubscribers(value,beforeChange)}}},hasSubscriptionsForEvent:function(event){return this._subscriptions[event]&&this._subscriptions[event].length},getSubscriptionsCount:function(event){if(event){return this._subscriptions[event]&&this._subscriptions[event].length||0}else{var total=0;ko.utils.objectForEach(this._subscriptions,function(eventName,subscriptions){if(eventName!=='dirty')total+=subscriptions.length});return total}},isDifferent:function(oldValue,newValue){return!this['equalityComparer']||!this['equalityComparer'](oldValue,newValue)},extend:applyExtenders};ko.exportProperty(ko_subscribable_fn,'subscribe',ko_subscribable_fn.subscribe);ko.exportProperty(ko_subscribable_fn,'extend',ko_subscribable_fn.extend);ko.exportProperty(ko_subscribable_fn,'getSubscriptionsCount',ko_subscribable_fn.getSubscriptionsCount);if(ko.utils.canSetPrototype){ko.utils.setPrototypeOf(ko_subscribable_fn,Function.prototype)}ko.subscribable['fn']=ko_subscribable_fn;ko.isSubscribable=function(instance){return instance!=null&&typeof instance.subscribe=='function'&&typeof instance['notifySubscribers']=='function'};ko.exportSymbol('subscribable',ko.subscribable);ko.exportSymbol('isSubscribable',ko.isSubscribable);ko.computedContext=ko.dependencyDetection=function(){var outerFrames=[],currentFrame,lastId=0;function getId(){return++lastId}function begin(options){outerFrames.push(currentFrame);currentFrame=options}function end(){currentFrame=outerFrames.pop()}return{begin:begin,end:end,registerDependency:function(subscribable){if(currentFrame){if(!ko.isSubscribable(subscribable))throw new Error('Only subscribable things can act as dependencies');currentFrame.callback.call(currentFrame.callbackTarget,subscribable,subscribable._id||(subscribable._id=getId()))}},ignore:function(callback,callbackTarget,callbackArgs){try{begin();return callback.apply(callbackTarget,callbackArgs||[])}finally{end()}},getDependenciesCount:function(){if(currentFrame)return currentFrame.computed.getDependenciesCount()},isInitial:function(){if(currentFrame)return currentFrame.isInitial}}}();ko.exportSymbol('computedContext',ko.computedContext);ko.exportSymbol('computedContext.getDependenciesCount',ko.computedContext.getDependenciesCount);ko.exportSymbol('computedContext.isInitial',ko.computedContext.isInitial);ko.exportSymbol('ignoreDependencies',ko.ignoreDependencies=ko.dependencyDetection.ignore);var observableLatestValue=ko.utils.createSymbolOrString('_latestValue');ko.observable=function(initialValue){function observable(){if(arguments.length>0){if(observable.isDifferent(observable[observableLatestValue],arguments[0])){observable.valueWillMutate();observable[observableLatestValue]=arguments[0];observable.valueHasMutated()}return this}else{ko.dependencyDetection.registerDependency(observable);return observable[observableLatestValue]}}observable[observableLatestValue]=initialValue;if(!ko.utils.canSetPrototype){ko.utils.extend(observable,ko.subscribable['fn'])}ko.subscribable['fn'].init(observable);ko.utils.setPrototypeOfOrExtend(observable,observableFn);if(ko.options['deferUpdates']){ko.extenders['deferred'](observable,true)}return observable};var observableFn={'equalityComparer':valuesArePrimitiveAndEqual,peek:function(){return this[observableLatestValue]},valueHasMutated:function(){this['notifySubscribers'](this[observableLatestValue])},valueWillMutate:function(){this['notifySubscribers'](this[observableLatestValue],'beforeChange')}};if(ko.utils.canSetPrototype){ko.utils.setPrototypeOf(observableFn,ko.subscribable['fn'])}var protoProperty=ko.observable.protoProperty='__ko_proto__';observableFn[protoProperty]=ko.observable;ko.hasPrototype=function(instance,prototype){if(instance===null||instance===undefined||instance[protoProperty]===undefined)return false;if(instance[protoProperty]===prototype)return true;return ko.hasPrototype(instance[protoProperty],prototype)};ko.isObservable=function(instance){return ko.hasPrototype(instance,ko.observable)};ko.isWriteableObservable=function(instance){if(typeof instance=='function'&&instance[protoProperty]===ko.observable)return true;if(typeof instance=='function'&&instance[protoProperty]===ko.dependentObservable&&instance.hasWriteFunction)return true;return false};ko.exportSymbol('observable',ko.observable);ko.exportSymbol('isObservable',ko.isObservable);ko.exportSymbol('isWriteableObservable',ko.isWriteableObservable);ko.exportSymbol('isWritableObservable',ko.isWriteableObservable);ko.exportSymbol('observable.fn',observableFn);ko.exportProperty(observableFn,'peek',observableFn.peek);ko.exportProperty(observableFn,'valueHasMutated',observableFn.valueHasMutated);ko.exportProperty(observableFn,'valueWillMutate',observableFn.valueWillMutate);ko.observableArray=function(initialValues){initialValues=initialValues||[];if(typeof initialValues!='object'||!('length'in initialValues))throw new Error('The argument passed when initializing an observable array must be an array, or null, or undefined.');var result=ko.observable(initialValues);ko.utils.setPrototypeOfOrExtend(result,ko.observableArray['fn']);return result.extend({'trackArrayChanges':true})};ko.observableArray['fn']={'remove':function(valueOrPredicate){var underlyingArray=this.peek();var removedValues=[];var predicate=typeof valueOrPredicate=='function'&&!ko.isObservable(valueOrPredicate)?valueOrPredicate:function(value){return value===valueOrPredicate};for(var i=0;i<underlyingArray.length;i++){var value=underlyingArray[i];if(predicate(value)){if(removedValues.length===0){this.valueWillMutate()}removedValues.push(value);underlyingArray.splice(i,1);i--}}if(removedValues.length){this.valueHasMutated()}return removedValues},'removeAll':function(arrayOfValues){if(arrayOfValues===undefined){var underlyingArray=this.peek();var allValues=underlyingArray.slice(0);this.valueWillMutate();underlyingArray.splice(0,underlyingArray.length);this.valueHasMutated();return allValues}if(!arrayOfValues)return[];return this['remove'](function(value){return ko.utils.arrayIndexOf(arrayOfValues,value)>=0})},'destroy':function(valueOrPredicate){var underlyingArray=this.peek();var predicate=typeof valueOrPredicate=='function'&&!ko.isObservable(valueOrPredicate)?valueOrPredicate:function(value){return value===valueOrPredicate};this.valueWillMutate();for(var i=underlyingArray.length-1;i>=0;i--){var value=underlyingArray[i];if(predicate(value))underlyingArray[i]['_destroy']=true}this.valueHasMutated()},'destroyAll':function(arrayOfValues){if(arrayOfValues===undefined)return this['destroy'](function(){return true});if(!arrayOfValues)return[];return this['destroy'](function(value){return ko.utils.arrayIndexOf(arrayOfValues,value)>=0})},'indexOf':function(item){var underlyingArray=this();return ko.utils.arrayIndexOf(underlyingArray,item)},'replace':function(oldItem,newItem){var index=this['indexOf'](oldItem);if(index>=0){this.valueWillMutate();this.peek()[index]=newItem;this.valueHasMutated()}}};if(ko.utils.canSetPrototype){ko.utils.setPrototypeOf(ko.observableArray['fn'],ko.observable['fn'])}ko.utils.arrayForEach(['pop','push','reverse','shift','sort','splice','unshift'],function(methodName){ko.observableArray['fn'][methodName]=function(){var underlyingArray=this.peek();this.valueWillMutate();this.cacheDiffForKnownOperation(underlyingArray,methodName,arguments);var methodCallResult=underlyingArray[methodName].apply(underlyingArray,arguments);this.valueHasMutated();return methodCallResult===underlyingArray?this:methodCallResult}});ko.utils.arrayForEach(['slice'],function(methodName){ko.observableArray['fn'][methodName]=function(){var underlyingArray=this();return underlyingArray[methodName].apply(underlyingArray,arguments)}});ko.exportSymbol('observableArray',ko.observableArray);var arrayChangeEventName='arrayChange';ko.extenders['trackArrayChanges']=function(target,options){target.compareArrayOptions={};if(options&&typeof options=='object'){ko.utils.extend(target.compareArrayOptions,options)}target.compareArrayOptions['sparse']=true;if(target.cacheDiffForKnownOperation){return}var trackingChanges=false,cachedDiff=null,arrayChangeSubscription,pendingNotifications=0,underlyingNotifySubscribersFunction,underlyingBeforeSubscriptionAddFunction=target.beforeSubscriptionAdd,underlyingAfterSubscriptionRemoveFunction=target.afterSubscriptionRemove;target.beforeSubscriptionAdd=function(event){if(underlyingBeforeSubscriptionAddFunction)underlyingBeforeSubscriptionAddFunction.call(target,event);if(event===arrayChangeEventName){trackChanges()}};target.afterSubscriptionRemove=function(event){if(underlyingAfterSubscriptionRemoveFunction)underlyingAfterSubscriptionRemoveFunction.call(target,event);if(event===arrayChangeEventName&&!target.hasSubscriptionsForEvent(arrayChangeEventName)){if(underlyingNotifySubscribersFunction){target['notifySubscribers']=underlyingNotifySubscribersFunction;underlyingNotifySubscribersFunction=undefined}arrayChangeSubscription.dispose();trackingChanges=false}};function trackChanges(){if(trackingChanges){return}trackingChanges=true;underlyingNotifySubscribersFunction=target['notifySubscribers'];target['notifySubscribers']=function(valueToNotify,event){if(!event||event===defaultEvent){++pendingNotifications}return underlyingNotifySubscribersFunction.apply(this,arguments)};var previousContents=[].concat(target.peek()||[]);cachedDiff=null;arrayChangeSubscription=target.subscribe(function(currentContents){currentContents=[].concat(currentContents||[]);if(target.hasSubscriptionsForEvent(arrayChangeEventName)){var changes=getChanges(previousContents,currentContents)}previousContents=currentContents;cachedDiff=null;pendingNotifications=0;if(changes&&changes.length){target['notifySubscribers'](changes,arrayChangeEventName)}})}function getChanges(previousContents,currentContents){if(!cachedDiff||pendingNotifications>1){cachedDiff=ko.utils.compareArrays(previousContents,currentContents,target.compareArrayOptions)}return cachedDiff}target.cacheDiffForKnownOperation=function(rawArray,operationName,args){if(!trackingChanges||pendingNotifications){return}var diff=[],arrayLength=rawArray.length,argsLength=args.length,offset=0;function pushDiff(status,value,index){return diff[diff.length]={'status':status,'value':value,'index':index}}switch(operationName){case'push':offset=arrayLength;case'unshift':for(var index=0;index<argsLength;index++){pushDiff('added',args[index],offset+index)}break;case'pop':offset=arrayLength-1;case'shift':if(arrayLength){pushDiff('deleted',rawArray[offset],offset)}break;case'splice':var startIndex=Math.min(Math.max(0,args[0]<0?arrayLength+args[0]:args[0]),arrayLength),endDeleteIndex=argsLength===1?arrayLength:Math.min(startIndex+(args[1]||0),arrayLength),endAddIndex=startIndex+argsLength-2,endIndex=Math.max(endDeleteIndex,endAddIndex),additions=[],deletions=[];for(var index=startIndex,argsIndex=2;index<endIndex;++index,++argsIndex){if(index<endDeleteIndex)deletions.push(pushDiff('deleted',rawArray[index],index));if(index<endAddIndex)additions.push(pushDiff('added',args[argsIndex],index))}ko.utils.findMovesInArrayComparison(deletions,additions);break;default:return}cachedDiff=diff}};var computedState=ko.utils.createSymbolOrString('_state');ko.computed=ko.dependentObservable=function(evaluatorFunctionOrOptions,evaluatorFunctionTarget,options){if(typeof evaluatorFunctionOrOptions==='object'){options=evaluatorFunctionOrOptions}else{options=options||{};if(evaluatorFunctionOrOptions){options['read']=evaluatorFunctionOrOptions}}if(typeof options['read']!='function')throw Error('Pass a function that returns the value of the ko.computed');var writeFunction=options['write'];var state={latestValue:undefined,isStale:true,isBeingEvaluated:false,suppressDisposalUntilDisposeWhenReturnsFalse:false,isDisposed:false,pure:false,isSleeping:false,readFunction:options['read'],evaluatorFunctionTarget:evaluatorFunctionTarget||options['owner'],disposeWhenNodeIsRemoved:options['disposeWhenNodeIsRemoved']||options.disposeWhenNodeIsRemoved||null,disposeWhen:options['disposeWhen']||options.disposeWhen,domNodeDisposalCallback:null,dependencyTracking:{},dependenciesCount:0,evaluationTimeoutInstance:null};function computedObservable(){if(arguments.length>0){if(typeof writeFunction==='function'){writeFunction.apply(state.evaluatorFunctionTarget,arguments)}else{throw new Error('Cannot write a value to a ko.computed unless you specify a \'write\' option. If you wish to read the current value, don\'t pass any parameters.')}return this}else{ko.dependencyDetection.registerDependency(computedObservable);if(state.isStale||state.isSleeping&&computedObservable.haveDependenciesChanged()){computedObservable.evaluateImmediate()}return state.latestValue}}computedObservable[computedState]=state;computedObservable.hasWriteFunction=typeof writeFunction==='function';if(!ko.utils.canSetPrototype){ko.utils.extend(computedObservable,ko.subscribable['fn'])}ko.subscribable['fn'].init(computedObservable);ko.utils.setPrototypeOfOrExtend(computedObservable,computedFn);if(options['pure']){state.pure=true;state.isSleeping=true;ko.utils.extend(computedObservable,pureComputedOverrides)}else if(options['deferEvaluation']){ko.utils.extend(computedObservable,deferEvaluationOverrides)}if(ko.options['deferUpdates']){ko.extenders['deferred'](computedObservable,true)}if(DEBUG){computedObservable['_options']=options}if(state.disposeWhenNodeIsRemoved){state.suppressDisposalUntilDisposeWhenReturnsFalse=true;if(!state.disposeWhenNodeIsRemoved.nodeType){state.disposeWhenNodeIsRemoved=null}}if(!state.isSleeping&&!options['deferEvaluation']){computedObservable.evaluateImmediate()}if(state.disposeWhenNodeIsRemoved&&computedObservable.isActive()){ko.utils.domNodeDisposal.addDisposeCallback(state.disposeWhenNodeIsRemoved,state.domNodeDisposalCallback=function(){computedObservable.dispose()})}return computedObservable};function computedDisposeDependencyCallback(id,entryToDispose){if(entryToDispose!==null&&entryToDispose.dispose){entryToDispose.dispose()}}function computedBeginDependencyDetectionCallback(subscribable,id){var computedObservable=this.computedObservable,state=computedObservable[computedState];if(!state.isDisposed){if(this.disposalCount&&this.disposalCandidates[id]){computedObservable.addDependencyTracking(id,subscribable,this.disposalCandidates[id]);this.disposalCandidates[id]=null;--this.disposalCount}else if(!state.dependencyTracking[id]){computedObservable.addDependencyTracking(id,subscribable,state.isSleeping?{_target:subscribable}:computedObservable.subscribeToDependency(subscribable))}}}var computedFn={'equalityComparer':valuesArePrimitiveAndEqual,getDependenciesCount:function(){return this[computedState].dependenciesCount},addDependencyTracking:function(id,target,trackingObj){if(this[computedState].pure&&target===this){throw Error('A \'pure\' computed must not be called recursively')}this[computedState].dependencyTracking[id]=trackingObj;trackingObj._order=this[computedState].dependenciesCount++;trackingObj._version=target.getVersion()},haveDependenciesChanged:function(){var id,dependency,dependencyTracking=this[computedState].dependencyTracking;for(id in dependencyTracking){if(dependencyTracking.hasOwnProperty(id)){dependency=dependencyTracking[id];if(dependency._target.hasChanged(dependency._version)){return true}}}},markDirty:function(){if(this._evalDelayed&&!this[computedState].isBeingEvaluated){this._evalDelayed()}},isActive:function(){return this[computedState].isStale||this[computedState].dependenciesCount>0},respondToChange:function(){if(!this._notificationIsPending){this.evaluatePossiblyAsync()}},subscribeToDependency:function(target){if(target._deferUpdates&&!this[computedState].disposeWhenNodeIsRemoved){var dirtySub=target.subscribe(this.markDirty,this,'dirty'),changeSub=target.subscribe(this.respondToChange,this);return{_target:target,dispose:function(){dirtySub.dispose();changeSub.dispose()}}}else{return target.subscribe(this.evaluatePossiblyAsync,this)}},evaluatePossiblyAsync:function(){var computedObservable=this,throttleEvaluationTimeout=computedObservable['throttleEvaluation'];if(throttleEvaluationTimeout&&throttleEvaluationTimeout>=0){clearTimeout(this[computedState].evaluationTimeoutInstance);this[computedState].evaluationTimeoutInstance=ko.utils.setTimeout(function(){computedObservable.evaluateImmediate(true)},throttleEvaluationTimeout)}else if(computedObservable._evalDelayed){computedObservable._evalDelayed()}else{computedObservable.evaluateImmediate(true)}},evaluateImmediate:function(notifyChange){var computedObservable=this,state=computedObservable[computedState],disposeWhen=state.disposeWhen,changed=false;if(state.isBeingEvaluated){return}if(state.isDisposed){return}if(state.disposeWhenNodeIsRemoved&&!ko.utils.domNodeIsAttachedToDocument(state.disposeWhenNodeIsRemoved)||disposeWhen&&disposeWhen()){if(!state.suppressDisposalUntilDisposeWhenReturnsFalse){computedObservable.dispose();return}}else{state.suppressDisposalUntilDisposeWhenReturnsFalse=false}state.isBeingEvaluated=true;try{changed=this.evaluateImmediate_CallReadWithDependencyDetection(notifyChange)}finally{state.isBeingEvaluated=false}if(!state.dependenciesCount){computedObservable.dispose()}return changed},evaluateImmediate_CallReadWithDependencyDetection:function(notifyChange){var computedObservable=this,state=computedObservable[computedState],changed=false;var isInitial=state.pure?undefined:!state.dependenciesCount,dependencyDetectionContext={computedObservable:computedObservable,disposalCandidates:state.dependencyTracking,disposalCount:state.dependenciesCount};ko.dependencyDetection.begin({callbackTarget:dependencyDetectionContext,callback:computedBeginDependencyDetectionCallback,computed:computedObservable,isInitial:isInitial});state.dependencyTracking={};state.dependenciesCount=0;var newValue=this.evaluateImmediate_CallReadThenEndDependencyDetection(state,dependencyDetectionContext);if(computedObservable.isDifferent(state.latestValue,newValue)){if(!state.isSleeping){computedObservable['notifySubscribers'](state.latestValue,'beforeChange')}state.latestValue=newValue;if(DEBUG)computedObservable._latestValue=newValue;if(state.isSleeping){computedObservable.updateVersion()}else if(notifyChange){computedObservable['notifySubscribers'](state.latestValue)}changed=true}if(isInitial){computedObservable['notifySubscribers'](state.latestValue,'awake')}return changed},evaluateImmediate_CallReadThenEndDependencyDetection:function(state,dependencyDetectionContext){try{var readFunction=state.readFunction;return state.evaluatorFunctionTarget?readFunction.call(state.evaluatorFunctionTarget):readFunction()}finally{ko.dependencyDetection.end();if(dependencyDetectionContext.disposalCount&&!state.isSleeping){ko.utils.objectForEach(dependencyDetectionContext.disposalCandidates,computedDisposeDependencyCallback)}state.isStale=false}},peek:function(){var state=this[computedState];if(state.isStale&&!state.dependenciesCount||state.isSleeping&&this.haveDependenciesChanged()){this.evaluateImmediate()}return state.latestValue},limit:function(limitFunction){ko.subscribable['fn'].limit.call(this,limitFunction);this._evalDelayed=function(){this._limitBeforeChange(this[computedState].latestValue);this[computedState].isStale=true;this._limitChange(this)}},dispose:function(){var state=this[computedState];if(!state.isSleeping&&state.dependencyTracking){ko.utils.objectForEach(state.dependencyTracking,function(id,dependency){if(dependency.dispose)dependency.dispose()})}if(state.disposeWhenNodeIsRemoved&&state.domNodeDisposalCallback){ko.utils.domNodeDisposal.removeDisposeCallback(state.disposeWhenNodeIsRemoved,state.domNodeDisposalCallback)}state.dependencyTracking=null;state.dependenciesCount=0;state.isDisposed=true;state.isStale=false;state.isSleeping=false;state.disposeWhenNodeIsRemoved=null}};var pureComputedOverrides={beforeSubscriptionAdd:function(event){var computedObservable=this,state=computedObservable[computedState];if(!state.isDisposed&&state.isSleeping&&event=='change'){state.isSleeping=false;if(state.isStale||computedObservable.haveDependenciesChanged()){state.dependencyTracking=null;state.dependenciesCount=0;state.isStale=true;if(computedObservable.evaluateImmediate()){computedObservable.updateVersion()}}else{var dependeciesOrder=[];ko.utils.objectForEach(state.dependencyTracking,function(id,dependency){dependeciesOrder[dependency._order]=id});ko.utils.arrayForEach(dependeciesOrder,function(id,order){var dependency=state.dependencyTracking[id],subscription=computedObservable.subscribeToDependency(dependency._target);subscription._order=order;subscription._version=dependency._version;state.dependencyTracking[id]=subscription})}if(!state.isDisposed){computedObservable['notifySubscribers'](state.latestValue,'awake')}}},afterSubscriptionRemove:function(event){var state=this[computedState];if(!state.isDisposed&&event=='change'&&!this.hasSubscriptionsForEvent('change')){ko.utils.objectForEach(state.dependencyTracking,function(id,dependency){if(dependency.dispose){state.dependencyTracking[id]={_target:dependency._target,_order:dependency._order,_version:dependency._version};dependency.dispose()}});state.isSleeping=true;this['notifySubscribers'](undefined,'asleep')}},getVersion:function(){var state=this[computedState];if(state.isSleeping&&(state.isStale||this.haveDependenciesChanged())){this.evaluateImmediate()}return ko.subscribable['fn'].getVersion.call(this)}};var deferEvaluationOverrides={beforeSubscriptionAdd:function(event){if(event=='change'||event=='beforeChange'){this.peek()}}};if(ko.utils.canSetPrototype){ko.utils.setPrototypeOf(computedFn,ko.subscribable['fn'])}var protoProp=ko.observable.protoProperty;ko.computed[protoProp]=ko.observable;computedFn[protoProp]=ko.computed;ko.isComputed=function(instance){return ko.hasPrototype(instance,ko.computed)};ko.isPureComputed=function(instance){return ko.hasPrototype(instance,ko.computed)&&instance[computedState]&&instance[computedState].pure};ko.exportSymbol('computed',ko.computed);ko.exportSymbol('dependentObservable',ko.computed);ko.exportSymbol('isComputed',ko.isComputed);ko.exportSymbol('isPureComputed',ko.isPureComputed);ko.exportSymbol('computed.fn',computedFn);ko.exportProperty(computedFn,'peek',computedFn.peek);ko.exportProperty(computedFn,'dispose',computedFn.dispose);ko.exportProperty(computedFn,'isActive',computedFn.isActive);ko.exportProperty(computedFn,'getDependenciesCount',computedFn.getDependenciesCount);ko.pureComputed=function(evaluatorFunctionOrOptions,evaluatorFunctionTarget){if(typeof evaluatorFunctionOrOptions==='function'){return ko.computed(evaluatorFunctionOrOptions,evaluatorFunctionTarget,{'pure':true})}else{evaluatorFunctionOrOptions=ko.utils.extend({},evaluatorFunctionOrOptions);evaluatorFunctionOrOptions['pure']=true;return ko.computed(evaluatorFunctionOrOptions,evaluatorFunctionTarget)}};ko.exportSymbol('pureComputed',ko.pureComputed);(function(){var maxNestedObservableDepth=10;ko.toJS=function(rootObject){if(arguments.length==0)throw new Error('When calling ko.toJS, pass the object you want to convert.');return mapJsObjectGraph(rootObject,function(valueToMap){for(var i=0;ko.isObservable(valueToMap)&&i<maxNestedObservableDepth;i++)valueToMap=valueToMap();return valueToMap})};ko.toJSON=function(rootObject,replacer,space){var plainJavaScriptObject=ko.toJS(rootObject);return ko.utils.stringifyJson(plainJavaScriptObject,replacer,space)};function mapJsObjectGraph(rootObject,mapInputCallback,visitedObjects){visitedObjects=visitedObjects||new objectLookup;rootObject=mapInputCallback(rootObject);var canHaveProperties=typeof rootObject=='object'&&rootObject!==null&&rootObject!==undefined&&!(rootObject instanceof RegExp)&&!(rootObject instanceof Date)&&!(rootObject instanceof String)&&!(rootObject instanceof Number)&&!(rootObject instanceof Boolean);if(!canHaveProperties)return rootObject;var outputProperties=rootObject instanceof Array?[]:{};visitedObjects.save(rootObject,outputProperties);visitPropertiesOrArrayEntries(rootObject,function(indexer){var propertyValue=mapInputCallback(rootObject[indexer]);switch(typeof propertyValue){case'boolean':case'number':case'string':case'function':outputProperties[indexer]=propertyValue;break;case'object':case'undefined':var previouslyMappedValue=visitedObjects.get(propertyValue);outputProperties[indexer]=previouslyMappedValue!==undefined?previouslyMappedValue:mapJsObjectGraph(propertyValue,mapInputCallback,visitedObjects);break}});return outputProperties}function visitPropertiesOrArrayEntries(rootObject,visitorCallback){if(rootObject instanceof Array){for(var i=0;i<rootObject.length;i++)visitorCallback(i);if(typeof rootObject['toJSON']=='function')visitorCallback('toJSON')}else{for(var propertyName in rootObject){visitorCallback(propertyName)}}};function objectLookup(){this.keys=[];this.values=[]};objectLookup.prototype={constructor:objectLookup,save:function(key,value){var existingIndex=ko.utils.arrayIndexOf(this.keys,key);if(existingIndex>=0)this.values[existingIndex]=value;else{this.keys.push(key);this.values.push(value)}},get:function(key){var existingIndex=ko.utils.arrayIndexOf(this.keys,key);return existingIndex>=0?this.values[existingIndex]:undefined}}}());ko.exportSymbol('toJS',ko.toJS);ko.exportSymbol('toJSON',ko.toJSON);(function(){var hasDomDataExpandoProperty='__ko__hasDomDataOptionValue__';ko.selectExtensions={readValue:function(element){switch(ko.utils.tagNameLower(element)){case'option':if(element[hasDomDataExpandoProperty]===true)return ko.utils.domData.get(element,ko.bindingHandlers.options.optionValueDomDataKey);return ko.utils.ieVersion<=7?element.getAttributeNode('value')&&element.getAttributeNode('value').specified?element.value:element.text:element.value;case'select':return element.selectedIndex>=0?ko.selectExtensions.readValue(element.options[element.selectedIndex]):undefined;default:return element.value}},writeValue:function(element,value,allowUnset){switch(ko.utils.tagNameLower(element)){case'option':switch(typeof value){case'string':ko.utils.domData.set(element,ko.bindingHandlers.options.optionValueDomDataKey,undefined);if(hasDomDataExpandoProperty in element){delete element[hasDomDataExpandoProperty]}element.value=value;break;default:ko.utils.domData.set(element,ko.bindingHandlers.options.optionValueDomDataKey,value);element[hasDomDataExpandoProperty]=true;element.value=typeof value==='number'?value:'';break}break;case'select':if(value===''||value===null)value=undefined;var selection=-1;for(var i=0,n=element.options.length,optionValue;i<n;++i){optionValue=ko.selectExtensions.readValue(element.options[i]);if(optionValue==value||optionValue==''&&value===undefined){selection=i;break}}if(allowUnset||selection>=0||value===undefined&&element.size>1){element.selectedIndex=selection}break;default:if(value===null||value===undefined)value='';element.value=value;break}}}}());ko.exportSymbol('selectExtensions',ko.selectExtensions);ko.exportSymbol('selectExtensions.readValue',ko.selectExtensions.readValue);ko.exportSymbol('selectExtensions.writeValue',ko.selectExtensions.writeValue);ko.expressionRewriting=function(){var javaScriptReservedWords=['true','false','null','undefined'];var javaScriptAssignmentTarget=/^(?:[$_a-z][$\w]*|(.+)(\.\s*[$_a-z][$\w]*|\[.+\]))$/i;function getWriteableValue(expression){if(ko.utils.arrayIndexOf(javaScriptReservedWords,expression)>=0)return false;var match=expression.match(javaScriptAssignmentTarget);return match===null?false:match[1]?'Object('+match[1]+')'+match[2]:expression}var stringDouble='"(?:[^"\\\\]|\\\\.)*"',stringSingle='\'(?:[^\'\\\\]|\\\\.)*\'',stringRegexp='/(?:[^/\\\\]|\\\\.)*/w*',specials=',"\'{}()/:[\\]',everyThingElse='[^\\s:,/][^'+specials+']*[^\\s'+specials+']',oneNotSpace='[^\\s]',bindingToken=RegExp(stringDouble+'|'+stringSingle+'|'+stringRegexp+'|'+everyThingElse+'|'+oneNotSpace,'g'),divisionLookBehind=/[\])"'A-Za-z0-9_$]+$/,keywordRegexLookBehind={'in':1,'return':1,'typeof':1};function parseObjectLiteral(objectLiteralString){var str=ko.utils.stringTrim(objectLiteralString);if(str.charCodeAt(0)===123)str=str.slice(1,-1);var result=[],toks=str.match(bindingToken),key,values=[],depth=0;if(toks){toks.push(',');for(var i=0,tok;tok=toks[i];++i){var c=tok.charCodeAt(0);if(c===44){if(depth<=0){result.push(key&&values.length?{key:key,value:values.join('')}:{'unknown':key||values.join('')});key=depth=0;values=[];continue}}else if(c===58){if(!depth&&!key&&values.length===1){key=values.pop();continue}}else if(c===47&&i&&tok.length>1){var match=toks[i-1].match(divisionLookBehind);if(match&&!keywordRegexLookBehind[match[0]]){str=str.substr(str.indexOf(tok)+1);toks=str.match(bindingToken);toks.push(',');i=-1;tok='/'}}else if(c===40||c===123||c===91){++depth}else if(c===41||c===125||c===93){--depth}else if(!key&&!values.length&&(c===34||c===39)){tok=tok.slice(1,-1)}values.push(tok)}}return result}var twoWayBindings={};function preProcessBindings(bindingsStringOrKeyValueArray,bindingOptions){bindingOptions=bindingOptions||{};function processKeyValue(key,val){var writableVal;function callPreprocessHook(obj){return obj&&obj['preprocess']?val=obj['preprocess'](val,key,processKeyValue):true}if(!bindingParams){if(!callPreprocessHook(ko['getBindingHandler'](key)))return;if(twoWayBindings[key]&&(writableVal=getWriteableValue(val))){propertyAccessorResultStrings.push('\''+key+'\':function(_z){'+writableVal+'=_z}')}}if(makeValueAccessors){val='function(){return '+val+' }'}resultStrings.push('\''+key+'\':'+val)}var resultStrings=[],propertyAccessorResultStrings=[],makeValueAccessors=bindingOptions['valueAccessors'],bindingParams=bindingOptions['bindingParams'],keyValueArray=typeof bindingsStringOrKeyValueArray==='string'?parseObjectLiteral(bindingsStringOrKeyValueArray):bindingsStringOrKeyValueArray;ko.utils.arrayForEach(keyValueArray,function(keyValue){processKeyValue(keyValue.key||keyValue['unknown'],keyValue.value)});if(propertyAccessorResultStrings.length)processKeyValue('_ko_property_writers','{'+propertyAccessorResultStrings.join(',')+' }');return resultStrings.join(',')}return{bindingRewriteValidators:[],twoWayBindings:twoWayBindings,parseObjectLiteral:parseObjectLiteral,preProcessBindings:preProcessBindings,keyValueArrayContainsKey:function(keyValueArray,key){for(var i=0;i<keyValueArray.length;i++)if(keyValueArray[i]['key']==key)return true;return false},writeValueToProperty:function(property,allBindings,key,value,checkIfDifferent){if(!property||!ko.isObservable(property)){var propWriters=allBindings.get('_ko_property_writers');if(propWriters&&propWriters[key])propWriters[key](value)}else if(ko.isWriteableObservable(property)&&(!checkIfDifferent||property.peek()!==value)){property(value)}}}}();ko.exportSymbol('expressionRewriting',ko.expressionRewriting);ko.exportSymbol('expressionRewriting.bindingRewriteValidators',ko.expressionRewriting.bindingRewriteValidators);ko.exportSymbol('expressionRewriting.parseObjectLiteral',ko.expressionRewriting.parseObjectLiteral);ko.exportSymbol('expressionRewriting.preProcessBindings',ko.expressionRewriting.preProcessBindings);ko.exportSymbol('expressionRewriting._twoWayBindings',ko.expressionRewriting.twoWayBindings);ko.exportSymbol('jsonExpressionRewriting',ko.expressionRewriting);ko.exportSymbol('jsonExpressionRewriting.insertPropertyAccessorsIntoJson',ko.expressionRewriting.preProcessBindings);(function(){var commentNodesHaveTextProperty=document&&document.createComment('test').text==='<!--test-->';var startCommentRegex=commentNodesHaveTextProperty?/^<!--\s*ko(?:\s+([\s\S]+))?\s*-->$/:/^\s*ko(?:\s+([\s\S]+))?\s*$/;var endCommentRegex=commentNodesHaveTextProperty?/^<!--\s*\/ko\s*-->$/:/^\s*\/ko\s*$/;var htmlTagsWithOptionallyClosingChildren={'ul':true,'ol':true};function isStartComment(node){return node.nodeType==8&&startCommentRegex.test(commentNodesHaveTextProperty?node.text:node.nodeValue)}function isEndComment(node){return node.nodeType==8&&endCommentRegex.test(commentNodesHaveTextProperty?node.text:node.nodeValue)}function getVirtualChildren(startComment,allowUnbalanced){var currentNode=startComment;var depth=1;var children=[];while(currentNode=currentNode.nextSibling){if(isEndComment(currentNode)){depth--;if(depth===0)return children}children.push(currentNode);if(isStartComment(currentNode))depth++}if(!allowUnbalanced)throw new Error('Cannot find closing comment tag to match: '+startComment.nodeValue);return null}function getMatchingEndComment(startComment,allowUnbalanced){var allVirtualChildren=getVirtualChildren(startComment,allowUnbalanced);if(allVirtualChildren){if(allVirtualChildren.length>0)return allVirtualChildren[allVirtualChildren.length-1].nextSibling;return startComment.nextSibling}else return null}function getUnbalancedChildTags(node){var childNode=node.firstChild,captureRemaining=null;if(childNode){do{if(captureRemaining)captureRemaining.push(childNode);else if(isStartComment(childNode)){var matchingEndComment=getMatchingEndComment(childNode,true);if(matchingEndComment)childNode=matchingEndComment;else captureRemaining=[childNode]}else if(isEndComment(childNode)){captureRemaining=[childNode]}}while(childNode=childNode.nextSibling)}return captureRemaining}ko.virtualElements={allowedBindings:{},childNodes:function(node){return isStartComment(node)?getVirtualChildren(node):node.childNodes},emptyNode:function(node){if(!isStartComment(node))ko.utils.emptyDomNode(node);else{var virtualChildren=ko.virtualElements.childNodes(node);for(var i=0,j=virtualChildren.length;i<j;i++)ko.removeNode(virtualChildren[i])}},setDomNodeChildren:function(node,childNodes){if(!isStartComment(node))ko.utils.setDomNodeChildren(node,childNodes);else{ko.virtualElements.emptyNode(node);var endCommentNode=node.nextSibling;for(var i=0,j=childNodes.length;i<j;i++)endCommentNode.parentNode.insertBefore(childNodes[i],endCommentNode)}},prepend:function(containerNode,nodeToPrepend){if(!isStartComment(containerNode)){if(containerNode.firstChild)containerNode.insertBefore(nodeToPrepend,containerNode.firstChild);else containerNode.appendChild(nodeToPrepend)}else{containerNode.parentNode.insertBefore(nodeToPrepend,containerNode.nextSibling)}},insertAfter:function(containerNode,nodeToInsert,insertAfterNode){if(!insertAfterNode){ko.virtualElements.prepend(containerNode,nodeToInsert)}else if(!isStartComment(containerNode)){if(insertAfterNode.nextSibling)containerNode.insertBefore(nodeToInsert,insertAfterNode.nextSibling);else containerNode.appendChild(nodeToInsert)}else{containerNode.parentNode.insertBefore(nodeToInsert,insertAfterNode.nextSibling)}},firstChild:function(node){if(!isStartComment(node))return node.firstChild;if(!node.nextSibling||isEndComment(node.nextSibling))return null;return node.nextSibling},nextSibling:function(node){if(isStartComment(node))node=getMatchingEndComment(node);if(node.nextSibling&&isEndComment(node.nextSibling))return null;return node.nextSibling},hasBindingValue:isStartComment,virtualNodeBindingValue:function(node){var regexMatch=(commentNodesHaveTextProperty?node.text:node.nodeValue).match(startCommentRegex);return regexMatch?regexMatch[1]:null},normaliseVirtualElementDomStructure:function(elementVerified){if(!htmlTagsWithOptionallyClosingChildren[ko.utils.tagNameLower(elementVerified)])return;var childNode=elementVerified.firstChild;if(childNode){do{if(childNode.nodeType===1){var unbalancedTags=getUnbalancedChildTags(childNode);if(unbalancedTags){var nodeToInsertBefore=childNode.nextSibling;for(var i=0;i<unbalancedTags.length;i++){if(nodeToInsertBefore)elementVerified.insertBefore(unbalancedTags[i],nodeToInsertBefore);else elementVerified.appendChild(unbalancedTags[i])}}}}while(childNode=childNode.nextSibling)}}}}());ko.exportSymbol('virtualElements',ko.virtualElements);ko.exportSymbol('virtualElements.allowedBindings',ko.virtualElements.allowedBindings);ko.exportSymbol('virtualElements.emptyNode',ko.virtualElements.emptyNode);ko.exportSymbol('virtualElements.insertAfter',ko.virtualElements.insertAfter);ko.exportSymbol('virtualElements.prepend',ko.virtualElements.prepend);ko.exportSymbol('virtualElements.setDomNodeChildren',ko.virtualElements.setDomNodeChildren);(function(){var defaultBindingAttributeName='data-bind';ko.bindingProvider=function(){this.bindingCache={}};ko.utils.extend(ko.bindingProvider.prototype,{'nodeHasBindings':function(node){switch(node.nodeType){case 1:return node.getAttribute(defaultBindingAttributeName)!=null||ko.components['getComponentNameForNode'](node);case 8:return ko.virtualElements.hasBindingValue(node);default:return false}},'getBindings':function(node,bindingContext){var bindingsString=this['getBindingsString'](node,bindingContext),parsedBindings=bindingsString?this['parseBindingsString'](bindingsString,bindingContext,node):null;return ko.components.addBindingsForCustomElement(parsedBindings,node,bindingContext,false)},'getBindingAccessors':function(node,bindingContext){var bindingsString=this['getBindingsString'](node,bindingContext),parsedBindings=bindingsString?this['parseBindingsString'](bindingsString,bindingContext,node,{'valueAccessors':true}):null;return ko.components.addBindingsForCustomElement(parsedBindings,node,bindingContext,true)},'getBindingsString':function(node,bindingContext){switch(node.nodeType){case 1:return node.getAttribute(defaultBindingAttributeName);case 8:return ko.virtualElements.virtualNodeBindingValue(node);default:return null}},'parseBindingsString':function(bindingsString,bindingContext,node,options){try{var bindingFunction=createBindingsStringEvaluatorViaCache(bindingsString,this.bindingCache,options);return bindingFunction(bindingContext,node)}catch(ex){ex.message='Unable to parse bindings.\nBindings value: '+bindingsString+'\nMessage: '+ex.message;throw ex}}});ko.bindingProvider['instance']=new ko.bindingProvider;function createBindingsStringEvaluatorViaCache(bindingsString,cache,options){var cacheKey=bindingsString+(options&&options['valueAccessors']||'');return cache[cacheKey]||(cache[cacheKey]=createBindingsStringEvaluator(bindingsString,options))}function createBindingsStringEvaluator(bindingsString,options){var rewrittenBindings=ko.expressionRewriting.preProcessBindings(bindingsString,options),functionBody='with($context){with($data||{}){return{'+rewrittenBindings+'}}}';return new Function('$context','$element',functionBody)}}());ko.exportSymbol('bindingProvider',ko.bindingProvider);(function(){ko.bindingHandlers={};var bindingDoesNotRecurseIntoElementTypes={'script':true,'textarea':true,'template':true};ko['getBindingHandler']=function(bindingKey){return ko.bindingHandlers[bindingKey]};ko.bindingContext=function(dataItemOrAccessor,parentContext,dataItemAlias,extendCallback,options){function updateContext(){var dataItemOrObservable=isFunc?dataItemOrAccessor():dataItemOrAccessor,dataItem=ko.utils.unwrapObservable(dataItemOrObservable);if(parentContext){if(parentContext._subscribable)parentContext._subscribable();ko.utils.extend(self,parentContext);self._subscribable=subscribable}else{self['$parents']=[];self['$root']=dataItem;self['ko']=ko}self['$rawData']=dataItemOrObservable;self['$data']=dataItem;if(dataItemAlias)self[dataItemAlias]=dataItem;if(extendCallback)extendCallback(self,parentContext,dataItem);return self['$data']}function disposeWhen(){return nodes&&!ko.utils.anyDomNodeIsAttachedToDocument(nodes)}var self=this,isFunc=typeof dataItemOrAccessor=='function'&&!ko.isObservable(dataItemOrAccessor),nodes,subscribable;if(options&&options['exportDependencies']){updateContext()}else{subscribable=ko.dependentObservable(updateContext,null,{disposeWhen:disposeWhen,disposeWhenNodeIsRemoved:true});if(subscribable.isActive()){self._subscribable=subscribable;subscribable['equalityComparer']=null;nodes=[];subscribable._addNode=function(node){nodes.push(node);ko.utils.domNodeDisposal.addDisposeCallback(node,function(node){ko.utils.arrayRemoveItem(nodes,node);if(!nodes.length){subscribable.dispose();self._subscribable=subscribable=undefined}})}}}};ko.bindingContext.prototype['createChildContext']=function(dataItemOrAccessor,dataItemAlias,extendCallback,options){return new ko.bindingContext(dataItemOrAccessor,this,dataItemAlias,function(self,parentContext){self['$parentContext']=parentContext;self['$parent']=parentContext['$data'];self['$parents']=(parentContext['$parents']||[]).slice(0);self['$parents'].unshift(self['$parent']);if(extendCallback)extendCallback(self)},options)};ko.bindingContext.prototype['extend']=function(properties){return new ko.bindingContext(this._subscribable||this['$data'],this,null,function(self,parentContext){self['$rawData']=parentContext['$rawData'];ko.utils.extend(self,typeof properties=='function'?properties():properties)})};ko.bindingContext.prototype.createStaticChildContext=function(dataItemOrAccessor,dataItemAlias){return this['createChildContext'](dataItemOrAccessor,dataItemAlias,null,{'exportDependencies':true})};function makeValueAccessor(value){return function(){return value}}function evaluateValueAccessor(valueAccessor){return valueAccessor()}function makeAccessorsFromFunction(callback){return ko.utils.objectMap(ko.dependencyDetection.ignore(callback),function(value,key){return function(){return callback()[key]}})}function makeBindingAccessors(bindings,context,node){if(typeof bindings==='function'){return makeAccessorsFromFunction(bindings.bind(null,context,node))}else{return ko.utils.objectMap(bindings,makeValueAccessor)}}function getBindingsAndMakeAccessors(node,context){return makeAccessorsFromFunction(this['getBindings'].bind(this,node,context))}function validateThatBindingIsAllowedForVirtualElements(bindingName){var validator=ko.virtualElements.allowedBindings[bindingName];if(!validator)throw new Error('The binding \''+bindingName+'\' cannot be used with virtual elements')}function applyBindingsToDescendantsInternal(bindingContext,elementOrVirtualElement,bindingContextsMayDifferFromDomParentElement){var currentChild,nextInQueue=ko.virtualElements.firstChild(elementOrVirtualElement),provider=ko.bindingProvider['instance'],preprocessNode=provider['preprocessNode'];if(preprocessNode){while(currentChild=nextInQueue){nextInQueue=ko.virtualElements.nextSibling(currentChild);preprocessNode.call(provider,currentChild)}nextInQueue=ko.virtualElements.firstChild(elementOrVirtualElement)}while(currentChild=nextInQueue){nextInQueue=ko.virtualElements.nextSibling(currentChild);applyBindingsToNodeAndDescendantsInternal(bindingContext,currentChild,bindingContextsMayDifferFromDomParentElement)}}function applyBindingsToNodeAndDescendantsInternal(bindingContext,nodeVerified,bindingContextMayDifferFromDomParentElement){var shouldBindDescendants=true;var isElement=nodeVerified.nodeType===1;if(isElement)ko.virtualElements.normaliseVirtualElementDomStructure(nodeVerified);var shouldApplyBindings=isElement&&bindingContextMayDifferFromDomParentElement||ko.bindingProvider['instance']['nodeHasBindings'](nodeVerified);if(shouldApplyBindings)shouldBindDescendants=applyBindingsToNodeInternal(nodeVerified,null,bindingContext,bindingContextMayDifferFromDomParentElement)['shouldBindDescendants'];if(shouldBindDescendants&&!bindingDoesNotRecurseIntoElementTypes[ko.utils.tagNameLower(nodeVerified)]){applyBindingsToDescendantsInternal(bindingContext,nodeVerified,!isElement)}}var boundElementDomDataKey=ko.utils.domData.nextKey();function topologicalSortBindings(bindings){var result=[],bindingsConsidered={},cyclicDependencyStack=[];ko.utils.objectForEach(bindings,function pushBinding(bindingKey){if(!bindingsConsidered[bindingKey]){var binding=ko['getBindingHandler'](bindingKey);if(binding){if(binding['after']){cyclicDependencyStack.push(bindingKey);ko.utils.arrayForEach(binding['after'],function(bindingDependencyKey){if(bindings[bindingDependencyKey]){if(ko.utils.arrayIndexOf(cyclicDependencyStack,bindingDependencyKey)!==-1){throw Error('Cannot combine the following bindings, because they have a cyclic dependency: '+cyclicDependencyStack.join(', '))}else{pushBinding(bindingDependencyKey)}}});cyclicDependencyStack.length--}result.push({key:bindingKey,handler:binding})}bindingsConsidered[bindingKey]=true}});return result}function applyBindingsToNodeInternal(node,sourceBindings,bindingContext,bindingContextMayDifferFromDomParentElement){var alreadyBound=ko.utils.domData.get(node,boundElementDomDataKey);if(!sourceBindings){if(alreadyBound){throw Error('You cannot apply bindings multiple times to the same element.')}ko.utils.domData.set(node,boundElementDomDataKey,true)}if(!alreadyBound&&bindingContextMayDifferFromDomParentElement)ko.storedBindingContextForNode(node,bindingContext);var bindings;if(sourceBindings&&typeof sourceBindings!=='function'){bindings=sourceBindings}else{var provider=ko.bindingProvider['instance'],getBindings=provider['getBindingAccessors']||getBindingsAndMakeAccessors;var bindingsUpdater=ko.dependentObservable(function(){bindings=sourceBindings?sourceBindings(bindingContext,node):getBindings.call(provider,node,bindingContext);if(bindings&&bindingContext._subscribable)bindingContext._subscribable();return bindings},null,{disposeWhenNodeIsRemoved:node});if(!bindings||!bindingsUpdater.isActive())bindingsUpdater=null}var bindingHandlerThatControlsDescendantBindings;if(bindings){var getValueAccessor=bindingsUpdater?function(bindingKey){return function(){return evaluateValueAccessor(bindingsUpdater()[bindingKey])}}:function(bindingKey){return bindings[bindingKey]};function allBindings(){return ko.utils.objectMap(bindingsUpdater?bindingsUpdater():bindings,evaluateValueAccessor)}allBindings['get']=function(key){return bindings[key]&&evaluateValueAccessor(getValueAccessor(key))};allBindings['has']=function(key){return key in bindings};var orderedBindings=topologicalSortBindings(bindings);ko.utils.arrayForEach(orderedBindings,function(bindingKeyAndHandler){var handlerInitFn=bindingKeyAndHandler.handler['init'],handlerUpdateFn=bindingKeyAndHandler.handler['update'],bindingKey=bindingKeyAndHandler.key;if(node.nodeType===8){validateThatBindingIsAllowedForVirtualElements(bindingKey)}try{if(typeof handlerInitFn=='function'){ko.dependencyDetection.ignore(function(){var initResult=handlerInitFn(node,getValueAccessor(bindingKey),allBindings,bindingContext['$data'],bindingContext);if(initResult&&initResult['controlsDescendantBindings']){if(bindingHandlerThatControlsDescendantBindings!==undefined)throw new Error('Multiple bindings ('+bindingHandlerThatControlsDescendantBindings+' and '+bindingKey+') are trying to control descendant bindings of the same element. You cannot use these bindings together on the same element.');bindingHandlerThatControlsDescendantBindings=bindingKey}})}if(typeof handlerUpdateFn=='function'){ko.dependentObservable(function(){handlerUpdateFn(node,getValueAccessor(bindingKey),allBindings,bindingContext['$data'],bindingContext)},null,{disposeWhenNodeIsRemoved:node})}}catch(ex){ex.message='Unable to process binding "'+bindingKey+': '+bindings[bindingKey]+'"\nMessage: '+ex.message;throw ex}})}return{'shouldBindDescendants':bindingHandlerThatControlsDescendantBindings===undefined}};var storedBindingContextDomDataKey=ko.utils.domData.nextKey();ko.storedBindingContextForNode=function(node,bindingContext){if(arguments.length==2){ko.utils.domData.set(node,storedBindingContextDomDataKey,bindingContext);if(bindingContext._subscribable)bindingContext._subscribable._addNode(node)}else{return ko.utils.domData.get(node,storedBindingContextDomDataKey)}};function getBindingContext(viewModelOrBindingContext){return viewModelOrBindingContext&&viewModelOrBindingContext instanceof ko.bindingContext?viewModelOrBindingContext:new ko.bindingContext(viewModelOrBindingContext)}ko.applyBindingAccessorsToNode=function(node,bindings,viewModelOrBindingContext){if(node.nodeType===1)ko.virtualElements.normaliseVirtualElementDomStructure(node);return applyBindingsToNodeInternal(node,bindings,getBindingContext(viewModelOrBindingContext),true)};ko.applyBindingsToNode=function(node,bindings,viewModelOrBindingContext){var context=getBindingContext(viewModelOrBindingContext);return ko.applyBindingAccessorsToNode(node,makeBindingAccessors(bindings,context,node),context)};ko.applyBindingsToDescendants=function(viewModelOrBindingContext,rootNode){if(rootNode.nodeType===1||rootNode.nodeType===8)applyBindingsToDescendantsInternal(getBindingContext(viewModelOrBindingContext),rootNode,true)};ko.applyBindings=function(viewModelOrBindingContext,rootNode){if(!jQueryInstance&&window['jQuery']){jQueryInstance=window['jQuery']}if(rootNode&&rootNode.nodeType!==1&&rootNode.nodeType!==8)throw new Error('ko.applyBindings: first parameter should be your view model; second parameter should be a DOM node');rootNode=rootNode||window.document.body;applyBindingsToNodeAndDescendantsInternal(getBindingContext(viewModelOrBindingContext),rootNode,true)};ko.contextFor=function(node){switch(node.nodeType){case 1:case 8:var context=ko.storedBindingContextForNode(node);if(context)return context;if(node.parentNode)return ko.contextFor(node.parentNode);break}return undefined};ko.dataFor=function(node){var context=ko.contextFor(node);return context?context['$data']:undefined};ko.exportSymbol('bindingHandlers',ko.bindingHandlers);ko.exportSymbol('applyBindings',ko.applyBindings);ko.exportSymbol('applyBindingsToDescendants',ko.applyBindingsToDescendants);ko.exportSymbol('applyBindingAccessorsToNode',ko.applyBindingAccessorsToNode);ko.exportSymbol('applyBindingsToNode',ko.applyBindingsToNode);ko.exportSymbol('contextFor',ko.contextFor);ko.exportSymbol('dataFor',ko.dataFor)}());(function(undefined){var loadingSubscribablesCache={},loadedDefinitionsCache={};ko.components={get:function(componentName,callback){var cachedDefinition=getObjectOwnProperty(loadedDefinitionsCache,componentName);if(cachedDefinition){if(cachedDefinition.isSynchronousComponent){ko.dependencyDetection.ignore(function(){callback(cachedDefinition.definition)})}else{ko.tasks.schedule(function(){callback(cachedDefinition.definition)})}}else{loadComponentAndNotify(componentName,callback)}},clearCachedDefinition:function(componentName){delete loadedDefinitionsCache[componentName]},_getFirstResultFromLoaders:getFirstResultFromLoaders};function getObjectOwnProperty(obj,propName){return obj.hasOwnProperty(propName)?obj[propName]:undefined}function loadComponentAndNotify(componentName,callback){var subscribable=getObjectOwnProperty(loadingSubscribablesCache,componentName),completedAsync;if(!subscribable){subscribable=loadingSubscribablesCache[componentName]=new ko.subscribable;subscribable.subscribe(callback);beginLoadingComponent(componentName,function(definition,config){var isSynchronousComponent=!!(config&&config['synchronous']);loadedDefinitionsCache[componentName]={definition:definition,isSynchronousComponent:isSynchronousComponent};delete loadingSubscribablesCache[componentName];if(completedAsync||isSynchronousComponent){subscribable['notifySubscribers'](definition)}else{ko.tasks.schedule(function(){subscribable['notifySubscribers'](definition)})}});completedAsync=true}else{subscribable.subscribe(callback)}}function beginLoadingComponent(componentName,callback){getFirstResultFromLoaders('getConfig',[componentName],function(config){if(config){getFirstResultFromLoaders('loadComponent',[componentName,config],function(definition){callback(definition,config)})}else{callback(null,null)}})}function getFirstResultFromLoaders(methodName,argsExceptCallback,callback,candidateLoaders){if(!candidateLoaders){candidateLoaders=ko.components['loaders'].slice(0)}var currentCandidateLoader=candidateLoaders.shift();if(currentCandidateLoader){var methodInstance=currentCandidateLoader[methodName];if(methodInstance){var wasAborted=false,synchronousReturnValue=methodInstance.apply(currentCandidateLoader,argsExceptCallback.concat(function(result){if(wasAborted){callback(null)}else if(result!==null){callback(result)}else{getFirstResultFromLoaders(methodName,argsExceptCallback,callback,candidateLoaders)}}));if(synchronousReturnValue!==undefined){wasAborted=true;if(!currentCandidateLoader['suppressLoaderExceptions']){throw new Error('Component loaders must supply values by invoking the callback, not by returning values synchronously.')}}}else{getFirstResultFromLoaders(methodName,argsExceptCallback,callback,candidateLoaders)}}else{callback(null)}}ko.components['loaders']=[];ko.exportSymbol('components',ko.components);ko.exportSymbol('components.get',ko.components.get);ko.exportSymbol('components.clearCachedDefinition',ko.components.clearCachedDefinition)}());(function(undefined){var defaultConfigRegistry={};ko.components.register=function(componentName,config){if(!config){throw new Error('Invalid configuration for '+componentName)}if(ko.components.isRegistered(componentName)){throw new Error('Component '+componentName+' is already registered')}defaultConfigRegistry[componentName]=config};ko.components.isRegistered=function(componentName){return defaultConfigRegistry.hasOwnProperty(componentName)};ko.components.unregister=function(componentName){delete defaultConfigRegistry[componentName];ko.components.clearCachedDefinition(componentName)};ko.components.defaultLoader={'getConfig':function(componentName,callback){var result=defaultConfigRegistry.hasOwnProperty(componentName)?defaultConfigRegistry[componentName]:null;callback(result)},'loadComponent':function(componentName,config,callback){var errorCallback=makeErrorCallback(componentName);possiblyGetConfigFromAmd(errorCallback,config,function(loadedConfig){resolveConfig(componentName,errorCallback,loadedConfig,callback)})},'loadTemplate':function(componentName,templateConfig,callback){resolveTemplate(makeErrorCallback(componentName),templateConfig,callback)},'loadViewModel':function(componentName,viewModelConfig,callback){resolveViewModel(makeErrorCallback(componentName),viewModelConfig,callback)}};var createViewModelKey='createViewModel';function resolveConfig(componentName,errorCallback,config,callback){var result={},makeCallBackWhenZero=2,tryIssueCallback=function(){if(--makeCallBackWhenZero===0){callback(result)}},templateConfig=config['template'],viewModelConfig=config['viewModel'];if(templateConfig){possiblyGetConfigFromAmd(errorCallback,templateConfig,function(loadedConfig){ko.components._getFirstResultFromLoaders('loadTemplate',[componentName,loadedConfig],function(resolvedTemplate){result['template']=resolvedTemplate;tryIssueCallback()})})}else{tryIssueCallback()}if(viewModelConfig){possiblyGetConfigFromAmd(errorCallback,viewModelConfig,function(loadedConfig){ko.components._getFirstResultFromLoaders('loadViewModel',[componentName,loadedConfig],function(resolvedViewModel){result[createViewModelKey]=resolvedViewModel;tryIssueCallback()})})}else{tryIssueCallback()}}function resolveTemplate(errorCallback,templateConfig,callback){if(typeof templateConfig==='string'){callback(ko.utils.parseHtmlFragment(templateConfig))}else if(templateConfig instanceof Array){callback(templateConfig)}else if(isDocumentFragment(templateConfig)){callback(ko.utils.makeArray(templateConfig.childNodes))}else if(templateConfig['element']){var element=templateConfig['element'];if(isDomElement(element)){callback(cloneNodesFromTemplateSourceElement(element))}else if(typeof element==='string'){var elemInstance=document.getElementById(element);if(elemInstance){callback(cloneNodesFromTemplateSourceElement(elemInstance))}else{errorCallback('Cannot find element with ID '+element)}}else{errorCallback('Unknown element type: '+element)}}else{errorCallback('Unknown template value: '+templateConfig)}}function resolveViewModel(errorCallback,viewModelConfig,callback){if(typeof viewModelConfig==='function'){callback(function(params){return new viewModelConfig(params)})}else if(typeof viewModelConfig[createViewModelKey]==='function'){callback(viewModelConfig[createViewModelKey])}else if('instance'in viewModelConfig){var fixedInstance=viewModelConfig['instance'];callback(function(params,componentInfo){return fixedInstance})}else if('viewModel'in viewModelConfig){resolveViewModel(errorCallback,viewModelConfig['viewModel'],callback)}else{errorCallback('Unknown viewModel value: '+viewModelConfig)}}function cloneNodesFromTemplateSourceElement(elemInstance){switch(ko.utils.tagNameLower(elemInstance)){case'script':return ko.utils.parseHtmlFragment(elemInstance.text);case'textarea':return ko.utils.parseHtmlFragment(elemInstance.value);case'template':if(isDocumentFragment(elemInstance.content)){return ko.utils.cloneNodes(elemInstance.content.childNodes)}}return ko.utils.cloneNodes(elemInstance.childNodes)}function isDomElement(obj){if(window['HTMLElement']){return obj instanceof HTMLElement}else{return obj&&obj.tagName&&obj.nodeType===1}}function isDocumentFragment(obj){if(window['DocumentFragment']){return obj instanceof DocumentFragment}else{return obj&&obj.nodeType===11}}function possiblyGetConfigFromAmd(errorCallback,config,callback){if(typeof config['require']==='string'){if(amdRequire||window['require']){(amdRequire||window['require'])([config['require']],callback)}else{errorCallback('Uses require, but no AMD loader is present')}}else{callback(config)}}function makeErrorCallback(componentName){return function(message){throw new Error('Component \''+componentName+'\': '+message)}}ko.exportSymbol('components.register',ko.components.register);ko.exportSymbol('components.isRegistered',ko.components.isRegistered);ko.exportSymbol('components.unregister',ko.components.unregister);ko.exportSymbol('components.defaultLoader',ko.components.defaultLoader);ko.components['loaders'].push(ko.components.defaultLoader);ko.components._allRegisteredComponents=defaultConfigRegistry}());(function(undefined){ko.components['getComponentNameForNode']=function(node){var tagNameLower=ko.utils.tagNameLower(node);if(ko.components.isRegistered(tagNameLower)){if(tagNameLower.indexOf('-')!=-1||''+node=='[object HTMLUnknownElement]'||ko.utils.ieVersion<=8&&node.tagName===tagNameLower){return tagNameLower}}};ko.components.addBindingsForCustomElement=function(allBindings,node,bindingContext,valueAccessors){if(node.nodeType===1){var componentName=ko.components['getComponentNameForNode'](node);if(componentName){allBindings=allBindings||{};if(allBindings['component']){throw new Error('Cannot use the "component" binding on a custom element matching a component')}var componentBindingValue={'name':componentName,'params':getComponentParamsFromCustomElement(node,bindingContext)};allBindings['component']=valueAccessors?function(){return componentBindingValue}:componentBindingValue}}return allBindings};var nativeBindingProviderInstance=new ko.bindingProvider;function getComponentParamsFromCustomElement(elem,bindingContext){var paramsAttribute=elem.getAttribute('params');if(paramsAttribute){var params=nativeBindingProviderInstance['parseBindingsString'](paramsAttribute,bindingContext,elem,{'valueAccessors':true,'bindingParams':true}),rawParamComputedValues=ko.utils.objectMap(params,function(paramValue,paramName){return ko.computed(paramValue,null,{disposeWhenNodeIsRemoved:elem})}),result=ko.utils.objectMap(rawParamComputedValues,function(paramValueComputed,paramName){var paramValue=paramValueComputed.peek();if(!paramValueComputed.isActive()){return paramValue}else{return ko.computed({'read':function(){return ko.utils.unwrapObservable(paramValueComputed())},'write':ko.isWriteableObservable(paramValue)&&function(value){paramValueComputed()(value)},disposeWhenNodeIsRemoved:elem})}});if(!result.hasOwnProperty('$raw')){result['$raw']=rawParamComputedValues}return result}else{return{'$raw':{}}}}if(ko.utils.ieVersion<9){ko.components['register']=function(originalFunction){return function(componentName){document.createElement(componentName);return originalFunction.apply(this,arguments)}}(ko.components['register']);document.createDocumentFragment=function(originalFunction){return function(){var newDocFrag=originalFunction(),allComponents=ko.components._allRegisteredComponents;for(var componentName in allComponents){if(allComponents.hasOwnProperty(componentName)){newDocFrag.createElement(componentName)}}return newDocFrag}}(document.createDocumentFragment)}}());(function(undefined){var componentLoadingOperationUniqueId=0;ko.bindingHandlers['component']={'init':function(element,valueAccessor,ignored1,ignored2,bindingContext){var currentViewModel,currentLoadingOperationId,disposeAssociatedComponentViewModel=function(){var currentViewModelDispose=currentViewModel&&currentViewModel['dispose'];if(typeof currentViewModelDispose==='function'){currentViewModelDispose.call(currentViewModel)}currentViewModel=null;currentLoadingOperationId=null},originalChildNodes=ko.utils.makeArray(ko.virtualElements.childNodes(element));ko.utils.domNodeDisposal.addDisposeCallback(element,disposeAssociatedComponentViewModel);ko.computed(function(){var value=ko.utils.unwrapObservable(valueAccessor()),componentName,componentParams;if(typeof value==='string'){componentName=value}else{componentName=ko.utils.unwrapObservable(value['name']);componentParams=ko.utils.unwrapObservable(value['params'])}if(!componentName){throw new Error('No component name specified')}var loadingOperationId=currentLoadingOperationId=++componentLoadingOperationUniqueId;ko.components.get(componentName,function(componentDefinition){if(currentLoadingOperationId!==loadingOperationId){return}disposeAssociatedComponentViewModel();if(!componentDefinition){throw new Error('Unknown component \''+componentName+'\'')}cloneTemplateIntoElement(componentName,componentDefinition,element);var componentViewModel=createViewModel(componentDefinition,element,originalChildNodes,componentParams),childBindingContext=bindingContext['createChildContext'](componentViewModel,undefined,function(ctx){ctx['$component']=componentViewModel;ctx['$componentTemplateNodes']=originalChildNodes});currentViewModel=componentViewModel;ko.applyBindingsToDescendants(childBindingContext,element)})},null,{disposeWhenNodeIsRemoved:element});return{'controlsDescendantBindings':true}}};ko.virtualElements.allowedBindings['component']=true;function cloneTemplateIntoElement(componentName,componentDefinition,element){var template=componentDefinition['template'];if(!template){throw new Error('Component \''+componentName+'\' has no template')}var clonedNodesArray=ko.utils.cloneNodes(template);ko.virtualElements.setDomNodeChildren(element,clonedNodesArray)}function createViewModel(componentDefinition,element,originalChildNodes,componentParams){var componentViewModelFactory=componentDefinition['createViewModel'];return componentViewModelFactory?componentViewModelFactory.call(componentDefinition,componentParams,{'element':element,'templateNodes':originalChildNodes}):componentParams}}());var attrHtmlToJavascriptMap={'class':'className','for':'htmlFor'};ko.bindingHandlers['attr']={'update':function(element,valueAccessor,allBindings){var value=ko.utils.unwrapObservable(valueAccessor())||{};ko.utils.objectForEach(value,function(attrName,attrValue){attrValue=ko.utils.unwrapObservable(attrValue);var toRemove=attrValue===false||attrValue===null||attrValue===undefined;if(toRemove)element.removeAttribute(attrName);if(ko.utils.ieVersion<=8&&attrName in attrHtmlToJavascriptMap){attrName=attrHtmlToJavascriptMap[attrName];if(toRemove)element.removeAttribute(attrName);else element[attrName]=attrValue}else if(!toRemove){element.setAttribute(attrName,attrValue.toString())}if(attrName==='name'){ko.utils.setElementName(element,toRemove?'':attrValue.toString())}})}};(function(){ko.bindingHandlers['checked']={'after':['value','attr'],'init':function(element,valueAccessor,allBindings){var checkedValue=ko.pureComputed(function(){if(allBindings['has']('checkedValue')){return ko.utils.unwrapObservable(allBindings.get('checkedValue'))}else if(allBindings['has']('value')){return ko.utils.unwrapObservable(allBindings.get('value'))}return element.value});function updateModel(){var isChecked=element.checked,elemValue=useCheckedValue?checkedValue():isChecked;if(ko.computedContext.isInitial()){return}if(isRadio&&!isChecked){return}var modelValue=ko.dependencyDetection.ignore(valueAccessor);if(valueIsArray){var writableValue=rawValueIsNonArrayObservable?modelValue.peek():modelValue;if(oldElemValue!==elemValue){if(isChecked){ko.utils.addOrRemoveItem(writableValue,elemValue,true);ko.utils.addOrRemoveItem(writableValue,oldElemValue,false)}oldElemValue=elemValue}else{ko.utils.addOrRemoveItem(writableValue,elemValue,isChecked)}if(rawValueIsNonArrayObservable&&ko.isWriteableObservable(modelValue)){modelValue(writableValue)}}else{ko.expressionRewriting.writeValueToProperty(modelValue,allBindings,'checked',elemValue,true)}};function updateView(){var modelValue=ko.utils.unwrapObservable(valueAccessor());if(valueIsArray){element.checked=ko.utils.arrayIndexOf(modelValue,checkedValue())>=0}else if(isCheckbox){element.checked=modelValue}else{element.checked=checkedValue()===modelValue}};var isCheckbox=element.type=='checkbox',isRadio=element.type=='radio';if(!isCheckbox&&!isRadio){return}var rawValue=valueAccessor(),valueIsArray=isCheckbox&&ko.utils.unwrapObservable(rawValue)instanceof Array,rawValueIsNonArrayObservable=!(valueIsArray&&rawValue.push&&rawValue.splice),oldElemValue=valueIsArray?checkedValue():undefined,useCheckedValue=isRadio||valueIsArray;if(isRadio&&!element.name)ko.bindingHandlers['uniqueName']['init'](element,function(){return true});ko.computed(updateModel,null,{disposeWhenNodeIsRemoved:element});ko.utils.registerEventHandler(element,'click',updateModel);ko.computed(updateView,null,{disposeWhenNodeIsRemoved:element});rawValue=undefined}};ko.expressionRewriting.twoWayBindings['checked']=true;ko.bindingHandlers['checkedValue']={'update':function(element,valueAccessor){element.value=ko.utils.unwrapObservable(valueAccessor())}}}());var classesWrittenByBindingKey='__ko__cssValue';ko.bindingHandlers['css']={'update':function(element,valueAccessor){var value=ko.utils.unwrapObservable(valueAccessor());if(value!==null&&typeof value=='object'){ko.utils.objectForEach(value,function(className,shouldHaveClass){shouldHaveClass=ko.utils.unwrapObservable(shouldHaveClass);ko.utils.toggleDomNodeCssClass(element,className,shouldHaveClass)})}else{value=ko.utils.stringTrim(String(value||''));ko.utils.toggleDomNodeCssClass(element,element[classesWrittenByBindingKey],false);element[classesWrittenByBindingKey]=value;ko.utils.toggleDomNodeCssClass(element,value,true)}}};ko.bindingHandlers['enable']={'update':function(element,valueAccessor){var value=ko.utils.unwrapObservable(valueAccessor());if(value&&element.disabled)element.removeAttribute('disabled');else if(!value&&!element.disabled)element.disabled=true}};ko.bindingHandlers['disable']={'update':function(element,valueAccessor){ko.bindingHandlers['enable']['update'](element,function(){return!ko.utils.unwrapObservable(valueAccessor())})}};function makeEventHandlerShortcut(eventName){ko.bindingHandlers[eventName]={'init':function(element,valueAccessor,allBindings,viewModel,bindingContext){var newValueAccessor=function(){var result={};result[eventName]=valueAccessor();return result};return ko.bindingHandlers['event']['init'].call(this,element,newValueAccessor,allBindings,viewModel,bindingContext)}}}ko.bindingHandlers['event']={'init':function(element,valueAccessor,allBindings,viewModel,bindingContext){var eventsToHandle=valueAccessor()||{};ko.utils.objectForEach(eventsToHandle,function(eventName){if(typeof eventName=='string'){ko.utils.registerEventHandler(element,eventName,function(event){var handlerReturnValue;var handlerFunction=valueAccessor()[eventName];if(!handlerFunction)return;try{var argsForHandler=ko.utils.makeArray(arguments);viewModel=bindingContext['$data'];argsForHandler.unshift(viewModel);handlerReturnValue=handlerFunction.apply(viewModel,argsForHandler)}finally{if(handlerReturnValue!==true){if(event.preventDefault)event.preventDefault();else event.returnValue=false}}var bubble=allBindings.get(eventName+'Bubble')!==false;if(!bubble){event.cancelBubble=true;if(event.stopPropagation)event.stopPropagation()}})}})}};ko.bindingHandlers['foreach']={makeTemplateValueAccessor:function(valueAccessor){return function(){var modelValue=valueAccessor(),unwrappedValue=ko.utils.peekObservable(modelValue);if(!unwrappedValue||typeof unwrappedValue.length=='number')return{'foreach':modelValue,'templateEngine':ko.nativeTemplateEngine.instance};ko.utils.unwrapObservable(modelValue);return{'foreach':unwrappedValue['data'],'as':unwrappedValue['as'],'includeDestroyed':unwrappedValue['includeDestroyed'],'afterAdd':unwrappedValue['afterAdd'],'beforeRemove':unwrappedValue['beforeRemove'],'afterRender':unwrappedValue['afterRender'],'beforeMove':unwrappedValue['beforeMove'],'afterMove':unwrappedValue['afterMove'],'templateEngine':ko.nativeTemplateEngine.instance}}},'init':function(element,valueAccessor,allBindings,viewModel,bindingContext){return ko.bindingHandlers['template']['init'](element,ko.bindingHandlers['foreach'].makeTemplateValueAccessor(valueAccessor))},'update':function(element,valueAccessor,allBindings,viewModel,bindingContext){return ko.bindingHandlers['template']['update'](element,ko.bindingHandlers['foreach'].makeTemplateValueAccessor(valueAccessor),allBindings,viewModel,bindingContext)}};ko.expressionRewriting.bindingRewriteValidators['foreach']=false;ko.virtualElements.allowedBindings['foreach']=true;var hasfocusUpdatingProperty='__ko_hasfocusUpdating';var hasfocusLastValue='__ko_hasfocusLastValue';ko.bindingHandlers['hasfocus']={'init':function(element,valueAccessor,allBindings){var handleElementFocusChange=function(isFocused){element[hasfocusUpdatingProperty]=true;var ownerDoc=element.ownerDocument;if('activeElement'in ownerDoc){var active;try{active=ownerDoc.activeElement}catch(e){active=ownerDoc.body}isFocused=active===element}var modelValue=valueAccessor();ko.expressionRewriting.writeValueToProperty(modelValue,allBindings,'hasfocus',isFocused,true);element[hasfocusLastValue]=isFocused;element[hasfocusUpdatingProperty]=false};var handleElementFocusIn=handleElementFocusChange.bind(null,true);var handleElementFocusOut=handleElementFocusChange.bind(null,false);ko.utils.registerEventHandler(element,'focus',handleElementFocusIn);ko.utils.registerEventHandler(element,'focusin',handleElementFocusIn);ko.utils.registerEventHandler(element,'blur',handleElementFocusOut);ko.utils.registerEventHandler(element,'focusout',handleElementFocusOut)},'update':function(element,valueAccessor){var value=!!ko.utils.unwrapObservable(valueAccessor());if(!element[hasfocusUpdatingProperty]&&element[hasfocusLastValue]!==value){value?element.focus():element.blur();if(!value&&element[hasfocusLastValue]){element.ownerDocument.body.focus()}ko.dependencyDetection.ignore(ko.utils.triggerEvent,null,[element,value?'focusin':'focusout'])}}};ko.expressionRewriting.twoWayBindings['hasfocus']=true;ko.bindingHandlers['hasFocus']=ko.bindingHandlers['hasfocus'];ko.expressionRewriting.twoWayBindings['hasFocus']=true;ko.bindingHandlers['html']={'init':function(){return{'controlsDescendantBindings':true}},'update':function(element,valueAccessor){ko.utils.setHtml(element,valueAccessor())}};function makeWithIfBinding(bindingKey,isWith,isNot,makeContextCallback){ko.bindingHandlers[bindingKey]={'init':function(element,valueAccessor,allBindings,viewModel,bindingContext){var didDisplayOnLastUpdate,savedNodes;ko.computed(function(){var rawValue=valueAccessor(),dataValue=ko.utils.unwrapObservable(rawValue),shouldDisplay=!isNot!==!dataValue,isFirstRender=!savedNodes,needsRefresh=isFirstRender||isWith||shouldDisplay!==didDisplayOnLastUpdate;if(needsRefresh){if(isFirstRender&&ko.computedContext.getDependenciesCount()){savedNodes=ko.utils.cloneNodes(ko.virtualElements.childNodes(element),true)}if(shouldDisplay){if(!isFirstRender){ko.virtualElements.setDomNodeChildren(element,ko.utils.cloneNodes(savedNodes))}ko.applyBindingsToDescendants(makeContextCallback?makeContextCallback(bindingContext,rawValue):bindingContext,element)}else{ko.virtualElements.emptyNode(element)}didDisplayOnLastUpdate=shouldDisplay}},null,{disposeWhenNodeIsRemoved:element});return{'controlsDescendantBindings':true}}};ko.expressionRewriting.bindingRewriteValidators[bindingKey]=false;ko.virtualElements.allowedBindings[bindingKey]=true}makeWithIfBinding('if');makeWithIfBinding('ifnot',false,true);makeWithIfBinding('with',true,false,function(bindingContext,dataValue){return bindingContext.createStaticChildContext(dataValue)});var captionPlaceholder={};ko.bindingHandlers['options']={'init':function(element){if(ko.utils.tagNameLower(element)!=='select')throw new Error('options binding applies only to SELECT elements');while(element.length>0){element.remove(0)}return{'controlsDescendantBindings':true}},'update':function(element,valueAccessor,allBindings){function selectedOptions(){return ko.utils.arrayFilter(element.options,function(node){return node.selected})}var selectWasPreviouslyEmpty=element.length==0,multiple=element.multiple,previousScrollTop=!selectWasPreviouslyEmpty&&multiple?element.scrollTop:null,unwrappedArray=ko.utils.unwrapObservable(valueAccessor()),valueAllowUnset=allBindings.get('valueAllowUnset')&&allBindings['has']('value'),includeDestroyed=allBindings.get('optionsIncludeDestroyed'),arrayToDomNodeChildrenOptions={},captionValue,filteredArray,previousSelectedValues=[];if(!valueAllowUnset){if(multiple){previousSelectedValues=ko.utils.arrayMap(selectedOptions(),ko.selectExtensions.readValue)}else if(element.selectedIndex>=0){previousSelectedValues.push(ko.selectExtensions.readValue(element.options[element.selectedIndex]))}}if(unwrappedArray){if(typeof unwrappedArray.length=='undefined')unwrappedArray=[unwrappedArray];filteredArray=ko.utils.arrayFilter(unwrappedArray,function(item){return includeDestroyed||item===undefined||item===null||!ko.utils.unwrapObservable(item['_destroy'])});if(allBindings['has']('optionsCaption')){captionValue=ko.utils.unwrapObservable(allBindings.get('optionsCaption'));if(captionValue!==null&&captionValue!==undefined){filteredArray.unshift(captionPlaceholder)}}}else{}function applyToObject(object,predicate,defaultValue){var predicateType=typeof predicate;if(predicateType=='function')return predicate(object);else if(predicateType=='string')return object[predicate];else return defaultValue}var itemUpdate=false;function optionForArrayItem(arrayEntry,index,oldOptions){if(oldOptions.length){previousSelectedValues=!valueAllowUnset&&oldOptions[0].selected?[ko.selectExtensions.readValue(oldOptions[0])]:[];itemUpdate=true}var option=element.ownerDocument.createElement('option');if(arrayEntry===captionPlaceholder){ko.utils.setTextContent(option,allBindings.get('optionsCaption'));ko.selectExtensions.writeValue(option,undefined)}else{var optionValue=applyToObject(arrayEntry,allBindings.get('optionsValue'),arrayEntry);ko.selectExtensions.writeValue(option,ko.utils.unwrapObservable(optionValue));var optionText=applyToObject(arrayEntry,allBindings.get('optionsText'),optionValue);ko.utils.setTextContent(option,optionText)}return[option]}arrayToDomNodeChildrenOptions['beforeRemove']=function(option){element.removeChild(option)};function setSelectionCallback(arrayEntry,newOptions){if(itemUpdate&&valueAllowUnset){ko.selectExtensions.writeValue(element,ko.utils.unwrapObservable(allBindings.get('value')),true)}else if(previousSelectedValues.length){var isSelected=ko.utils.arrayIndexOf(previousSelectedValues,ko.selectExtensions.readValue(newOptions[0]))>=0;ko.utils.setOptionNodeSelectionState(newOptions[0],isSelected);if(itemUpdate&&!isSelected){ko.dependencyDetection.ignore(ko.utils.triggerEvent,null,[element,'change'])}}}var callback=setSelectionCallback;if(allBindings['has']('optionsAfterRender')&&typeof allBindings.get('optionsAfterRender')=='function'){callback=function(arrayEntry,newOptions){setSelectionCallback(arrayEntry,newOptions);ko.dependencyDetection.ignore(allBindings.get('optionsAfterRender'),null,[newOptions[0],arrayEntry!==captionPlaceholder?arrayEntry:undefined])}}ko.utils.setDomNodeChildrenFromArrayMapping(element,filteredArray,optionForArrayItem,arrayToDomNodeChildrenOptions,callback);ko.dependencyDetection.ignore(function(){if(valueAllowUnset){ko.selectExtensions.writeValue(element,ko.utils.unwrapObservable(allBindings.get('value')),true)}else{var selectionChanged;if(multiple){selectionChanged=previousSelectedValues.length&&selectedOptions().length<previousSelectedValues.length}else{selectionChanged=previousSelectedValues.length&&element.selectedIndex>=0?ko.selectExtensions.readValue(element.options[element.selectedIndex])!==previousSelectedValues[0]:previousSelectedValues.length||element.selectedIndex>=0}if(selectionChanged){ko.utils.triggerEvent(element,'change')}}});ko.utils.ensureSelectElementIsRenderedCorrectly(element);if(previousScrollTop&&Math.abs(previousScrollTop-element.scrollTop)>20)element.scrollTop=previousScrollTop}};ko.bindingHandlers['options'].optionValueDomDataKey=ko.utils.domData.nextKey();ko.bindingHandlers['selectedOptions']={'after':['options','foreach'],'init':function(element,valueAccessor,allBindings){ko.utils.registerEventHandler(element,'change',function(){var value=valueAccessor(),valueToWrite=[];ko.utils.arrayForEach(element.getElementsByTagName('option'),function(node){if(node.selected)valueToWrite.push(ko.selectExtensions.readValue(node))});ko.expressionRewriting.writeValueToProperty(value,allBindings,'selectedOptions',valueToWrite)})},'update':function(element,valueAccessor){if(ko.utils.tagNameLower(element)!='select')throw new Error('values binding applies only to SELECT elements');var newValue=ko.utils.unwrapObservable(valueAccessor()),previousScrollTop=element.scrollTop;if(newValue&&typeof newValue.length=='number'){ko.utils.arrayForEach(element.getElementsByTagName('option'),function(node){var isSelected=ko.utils.arrayIndexOf(newValue,ko.selectExtensions.readValue(node))>=0;if(node.selected!=isSelected){ko.utils.setOptionNodeSelectionState(node,isSelected)}})}element.scrollTop=previousScrollTop}};ko.expressionRewriting.twoWayBindings['selectedOptions']=true;ko.bindingHandlers['style']={'update':function(element,valueAccessor){var value=ko.utils.unwrapObservable(valueAccessor()||{});ko.utils.objectForEach(value,function(styleName,styleValue){styleValue=ko.utils.unwrapObservable(styleValue);if(styleValue===null||styleValue===undefined||styleValue===false){styleValue=''}element.style[styleName]=styleValue})}};ko.bindingHandlers['submit']={'init':function(element,valueAccessor,allBindings,viewModel,bindingContext){if(typeof valueAccessor()!='function')throw new Error('The value for a submit binding must be a function');ko.utils.registerEventHandler(element,'submit',function(event){var handlerReturnValue;var value=valueAccessor();try{handlerReturnValue=value.call(bindingContext['$data'],element)}finally{if(handlerReturnValue!==true){if(event.preventDefault)event.preventDefault();else event.returnValue=false}}})}};ko.bindingHandlers['text']={'init':function(){return{'controlsDescendantBindings':true}},'update':function(element,valueAccessor){ko.utils.setTextContent(element,valueAccessor())}};ko.virtualElements.allowedBindings['text']=true;(function(){if(window&&window.navigator){var parseVersion=function(matches){if(matches){return parseFloat(matches[1])}};var operaVersion=window.opera&&window.opera.version&&parseInt(window.opera.version()),userAgent=window.navigator.userAgent,safariVersion=parseVersion(userAgent.match(/^(?:(?!chrome).)*version\/([^ ]*) safari/i)),firefoxVersion=parseVersion(userAgent.match(/Firefox\/([^ ]*)/))}if(ko.utils.ieVersion<10){var selectionChangeRegisteredName=ko.utils.domData.nextKey(),selectionChangeHandlerName=ko.utils.domData.nextKey();var selectionChangeHandler=function(event){var target=this.activeElement,handler=target&&ko.utils.domData.get(target,selectionChangeHandlerName);if(handler){handler(event)}};var registerForSelectionChangeEvent=function(element,handler){var ownerDoc=element.ownerDocument;if(!ko.utils.domData.get(ownerDoc,selectionChangeRegisteredName)){ko.utils.domData.set(ownerDoc,selectionChangeRegisteredName,true);ko.utils.registerEventHandler(ownerDoc,'selectionchange',selectionChangeHandler)}ko.utils.domData.set(element,selectionChangeHandlerName,handler)}}ko.bindingHandlers['textInput']={'init':function(element,valueAccessor,allBindings){var previousElementValue=element.value,timeoutHandle,elementValueBeforeEvent;var updateModel=function(event){clearTimeout(timeoutHandle);elementValueBeforeEvent=timeoutHandle=undefined;var elementValue=element.value;if(previousElementValue!==elementValue){if(DEBUG&&event)element['_ko_textInputProcessedEvent']=event.type;previousElementValue=elementValue;ko.expressionRewriting.writeValueToProperty(valueAccessor(),allBindings,'textInput',elementValue)}};var deferUpdateModel=function(event){if(!timeoutHandle){elementValueBeforeEvent=element.value;var handler=DEBUG?updateModel.bind(element,{type:event.type}):updateModel;timeoutHandle=ko.utils.setTimeout(handler,4)}};var ieUpdateModel=ko.utils.ieVersion==9?deferUpdateModel:updateModel;var updateView=function(){var modelValue=ko.utils.unwrapObservable(valueAccessor());if(modelValue===null||modelValue===undefined){modelValue=''}if(elementValueBeforeEvent!==undefined&&modelValue===elementValueBeforeEvent){ko.utils.setTimeout(updateView,4);return}if(element.value!==modelValue){previousElementValue=modelValue;element.value=modelValue}};var onEvent=function(event,handler){ko.utils.registerEventHandler(element,event,handler)};if(DEBUG&&ko.bindingHandlers['textInput']['_forceUpdateOn']){ko.utils.arrayForEach(ko.bindingHandlers['textInput']['_forceUpdateOn'],function(eventName){if(eventName.slice(0,5)=='after'){onEvent(eventName.slice(5),deferUpdateModel)}else{onEvent(eventName,updateModel)}})}else{if(ko.utils.ieVersion<10){onEvent('propertychange',function(event){if(event.propertyName==='value'){ieUpdateModel(event)}});if(ko.utils.ieVersion==8){onEvent('keyup',updateModel);onEvent('keydown',updateModel)}if(ko.utils.ieVersion>=8){registerForSelectionChangeEvent(element,ieUpdateModel);onEvent('dragend',deferUpdateModel)}}else{onEvent('input',updateModel);if(safariVersion<5&&ko.utils.tagNameLower(element)==='textarea'){onEvent('keydown',deferUpdateModel);onEvent('paste',deferUpdateModel);onEvent('cut',deferUpdateModel)}else if(operaVersion<11){onEvent('keydown',deferUpdateModel)}else if(firefoxVersion<4){onEvent('DOMAutoComplete',updateModel);onEvent('dragdrop',updateModel);onEvent('drop',updateModel)}}}onEvent('change',updateModel);ko.computed(updateView,null,{disposeWhenNodeIsRemoved:element})}};ko.expressionRewriting.twoWayBindings['textInput']=true;ko.bindingHandlers['textinput']={'preprocess':function(value,name,addBinding){addBinding('textInput',value)}}}());ko.bindingHandlers['uniqueName']={'init':function(element,valueAccessor){if(valueAccessor()){var name='ko_unique_'+ ++ko.bindingHandlers['uniqueName'].currentIndex;ko.utils.setElementName(element,name)}}};ko.bindingHandlers['uniqueName'].currentIndex=0;ko.bindingHandlers['value']={'after':['options','foreach'],'init':function(element,valueAccessor,allBindings){if(element.tagName.toLowerCase()=='input'&&(element.type=='checkbox'||element.type=='radio')){ko.applyBindingAccessorsToNode(element,{'checkedValue':valueAccessor});return}var eventsToCatch=['change'];var requestedEventsToCatch=allBindings.get('valueUpdate');var propertyChangedFired=false;var elementValueBeforeEvent=null;if(requestedEventsToCatch){if(typeof requestedEventsToCatch=='string')requestedEventsToCatch=[requestedEventsToCatch];ko.utils.arrayPushAll(eventsToCatch,requestedEventsToCatch);eventsToCatch=ko.utils.arrayGetDistinctValues(eventsToCatch)}var valueUpdateHandler=function(){elementValueBeforeEvent=null;propertyChangedFired=false;var modelValue=valueAccessor();var elementValue=ko.selectExtensions.readValue(element);ko.expressionRewriting.writeValueToProperty(modelValue,allBindings,'value',elementValue)};var ieAutoCompleteHackNeeded=ko.utils.ieVersion&&element.tagName.toLowerCase()=='input'&&element.type=='text'&&element.autocomplete!='off'&&(!element.form||element.form.autocomplete!='off');if(ieAutoCompleteHackNeeded&&ko.utils.arrayIndexOf(eventsToCatch,'propertychange')==-1){ko.utils.registerEventHandler(element,'propertychange',function(){propertyChangedFired=true});ko.utils.registerEventHandler(element,'focus',function(){propertyChangedFired=false});ko.utils.registerEventHandler(element,'blur',function(){if(propertyChangedFired){valueUpdateHandler()}})}ko.utils.arrayForEach(eventsToCatch,function(eventName){var handler=valueUpdateHandler;if(ko.utils.stringStartsWith(eventName,'after')){handler=function(){elementValueBeforeEvent=ko.selectExtensions.readValue(element);ko.utils.setTimeout(valueUpdateHandler,0)};eventName=eventName.substring('after'.length)}ko.utils.registerEventHandler(element,eventName,handler)});var updateFromModel=function(){var newValue=ko.utils.unwrapObservable(valueAccessor());var elementValue=ko.selectExtensions.readValue(element);if(elementValueBeforeEvent!==null&&newValue===elementValueBeforeEvent){ko.utils.setTimeout(updateFromModel,0);return}var valueHasChanged=newValue!==elementValue;if(valueHasChanged){if(ko.utils.tagNameLower(element)==='select'){var allowUnset=allBindings.get('valueAllowUnset');var applyValueAction=function(){ko.selectExtensions.writeValue(element,newValue,allowUnset)};applyValueAction();if(!allowUnset&&newValue!==ko.selectExtensions.readValue(element)){ko.dependencyDetection.ignore(ko.utils.triggerEvent,null,[element,'change'])}else{ko.utils.setTimeout(applyValueAction,0)}}else{ko.selectExtensions.writeValue(element,newValue)}}};ko.computed(updateFromModel,null,{disposeWhenNodeIsRemoved:element})},'update':function(){}};ko.expressionRewriting.twoWayBindings['value']=true;ko.bindingHandlers['visible']={'update':function(element,valueAccessor){var value=ko.utils.unwrapObservable(valueAccessor());var isCurrentlyVisible=!(element.style.display=='none');if(value&&!isCurrentlyVisible)element.style.display='';else if(!value&&isCurrentlyVisible)element.style.display='none'}};makeEventHandlerShortcut('click');ko.templateEngine=function(){};ko.templateEngine.prototype['renderTemplateSource']=function(templateSource,bindingContext,options,templateDocument){throw new Error('Override renderTemplateSource')};ko.templateEngine.prototype['createJavaScriptEvaluatorBlock']=function(script){throw new Error('Override createJavaScriptEvaluatorBlock')};ko.templateEngine.prototype['makeTemplateSource']=function(template,templateDocument){if(typeof template=='string'){templateDocument=templateDocument||document;var elem=templateDocument.getElementById(template);if(!elem)throw new Error('Cannot find template with ID '+template);return new ko.templateSources.domElement(elem)}else if(template.nodeType==1||template.nodeType==8){return new ko.templateSources.anonymousTemplate(template)}else throw new Error('Unknown template type: '+template)};ko.templateEngine.prototype['renderTemplate']=function(template,bindingContext,options,templateDocument){var templateSource=this['makeTemplateSource'](template,templateDocument);return this['renderTemplateSource'](templateSource,bindingContext,options,templateDocument)};ko.templateEngine.prototype['isTemplateRewritten']=function(template,templateDocument){if(this['allowTemplateRewriting']===false)return true;return this['makeTemplateSource'](template,templateDocument)['data']('isRewritten')};ko.templateEngine.prototype['rewriteTemplate']=function(template,rewriterCallback,templateDocument){var templateSource=this['makeTemplateSource'](template,templateDocument);var rewritten=rewriterCallback(templateSource['text']());templateSource['text'](rewritten);templateSource['data']('isRewritten',true)};ko.exportSymbol('templateEngine',ko.templateEngine);ko.templateRewriting=function(){var memoizeDataBindingAttributeSyntaxRegex=/(<([a-z]+\d*)(?:\s+(?!data-bind\s*=\s*)[a-z0-9\-]+(?:=(?:\"[^\"]*\"|\'[^\']*\'|[^>]*))?)*\s+)data-bind\s*=\s*(["'])([\s\S]*?)\3/gi;var memoizeVirtualContainerBindingSyntaxRegex=/<!--\s*ko\b\s*([\s\S]*?)\s*-->/g;function validateDataBindValuesForRewriting(keyValueArray){var allValidators=ko.expressionRewriting.bindingRewriteValidators;for(var i=0;i<keyValueArray.length;i++){var key=keyValueArray[i]['key'];if(allValidators.hasOwnProperty(key)){var validator=allValidators[key];if(typeof validator==='function'){var possibleErrorMessage=validator(keyValueArray[i]['value']);if(possibleErrorMessage)throw new Error(possibleErrorMessage)}else if(!validator){throw new Error('This template engine does not support the \''+key+'\' binding within its templates')}}}}function constructMemoizedTagReplacement(dataBindAttributeValue,tagToRetain,nodeName,templateEngine){var dataBindKeyValueArray=ko.expressionRewriting.parseObjectLiteral(dataBindAttributeValue);validateDataBindValuesForRewriting(dataBindKeyValueArray);var rewrittenDataBindAttributeValue=ko.expressionRewriting.preProcessBindings(dataBindKeyValueArray,{'valueAccessors':true});var applyBindingsToNextSiblingScript='ko.__tr_ambtns(function($context,$element){return(function(){return{ '+rewrittenDataBindAttributeValue+' } })()},\''+nodeName.toLowerCase()+'\')';return templateEngine['createJavaScriptEvaluatorBlock'](applyBindingsToNextSiblingScript)+tagToRetain}return{ensureTemplateIsRewritten:function(template,templateEngine,templateDocument){if(!templateEngine['isTemplateRewritten'](template,templateDocument))templateEngine['rewriteTemplate'](template,function(htmlString){return ko.templateRewriting.memoizeBindingAttributeSyntax(htmlString,templateEngine)},templateDocument)},memoizeBindingAttributeSyntax:function(htmlString,templateEngine){return htmlString.replace(memoizeDataBindingAttributeSyntaxRegex,function(){return constructMemoizedTagReplacement(arguments[4],arguments[1],arguments[2],templateEngine)}).replace(memoizeVirtualContainerBindingSyntaxRegex,function(){return constructMemoizedTagReplacement(arguments[1],'<!-- ko -->','#comment',templateEngine)})},applyMemoizedBindingsToNextSibling:function(bindings,nodeName){return ko.memoization.memoize(function(domNode,bindingContext){var nodeToBind=domNode.nextSibling;if(nodeToBind&&nodeToBind.nodeName.toLowerCase()===nodeName){ko.applyBindingAccessorsToNode(nodeToBind,bindings,bindingContext)}})}}}();ko.exportSymbol('__tr_ambtns',ko.templateRewriting.applyMemoizedBindingsToNextSibling);(function(){ko.templateSources={};var templateScript=1,templateTextArea=2,templateTemplate=3,templateElement=4;ko.templateSources.domElement=function(element){this.domElement=element;if(element){var tagNameLower=ko.utils.tagNameLower(element);this.templateType=tagNameLower==='script'?templateScript:tagNameLower==='textarea'?templateTextArea:tagNameLower=='template'&&element.content&&element.content.nodeType===11?templateTemplate:templateElement}};ko.templateSources.domElement.prototype['text']=function(){var elemContentsProperty=this.templateType===templateScript?'text':this.templateType===templateTextArea?'value':'innerHTML';if(arguments.length==0){return this.domElement[elemContentsProperty]}else{var valueToWrite=arguments[0];if(elemContentsProperty==='innerHTML')ko.utils.setHtml(this.domElement,valueToWrite);else this.domElement[elemContentsProperty]=valueToWrite}};var dataDomDataPrefix=ko.utils.domData.nextKey()+'_';ko.templateSources.domElement.prototype['data']=function(key){if(arguments.length===1){return ko.utils.domData.get(this.domElement,dataDomDataPrefix+key)}else{ko.utils.domData.set(this.domElement,dataDomDataPrefix+key,arguments[1])}};var templatesDomDataKey=ko.utils.domData.nextKey();function getTemplateDomData(element){return ko.utils.domData.get(element,templatesDomDataKey)||{}}function setTemplateDomData(element,data){ko.utils.domData.set(element,templatesDomDataKey,data)}ko.templateSources.domElement.prototype['nodes']=function(){var element=this.domElement;if(arguments.length==0){var templateData=getTemplateDomData(element),containerData=templateData.containerData;return containerData||(this.templateType===templateTemplate?element.content:this.templateType===templateElement?element:undefined)}else{var valueToWrite=arguments[0];setTemplateDomData(element,{containerData:valueToWrite})}};ko.templateSources.anonymousTemplate=function(element){this.domElement=element};ko.templateSources.anonymousTemplate.prototype=new ko.templateSources.domElement;ko.templateSources.anonymousTemplate.prototype.constructor=ko.templateSources.anonymousTemplate;ko.templateSources.anonymousTemplate.prototype['text']=function(){if(arguments.length==0){var templateData=getTemplateDomData(this.domElement);if(templateData.textData===undefined&&templateData.containerData)templateData.textData=templateData.containerData.innerHTML;return templateData.textData}else{var valueToWrite=arguments[0];setTemplateDomData(this.domElement,{textData:valueToWrite})}};ko.exportSymbol('templateSources',ko.templateSources);ko.exportSymbol('templateSources.domElement',ko.templateSources.domElement);ko.exportSymbol('templateSources.anonymousTemplate',ko.templateSources.anonymousTemplate)}());(function(){var _templateEngine;ko.setTemplateEngine=function(templateEngine){if(templateEngine!=undefined&&!(templateEngine instanceof ko.templateEngine))throw new Error('templateEngine must inherit from ko.templateEngine');_templateEngine=templateEngine};function invokeForEachNodeInContinuousRange(firstNode,lastNode,action){var node,nextInQueue=firstNode,firstOutOfRangeNode=ko.virtualElements.nextSibling(lastNode);while(nextInQueue&&(node=nextInQueue)!==firstOutOfRangeNode){nextInQueue=ko.virtualElements.nextSibling(node);action(node,nextInQueue)}}function activateBindingsOnContinuousNodeArray(continuousNodeArray,bindingContext){if(continuousNodeArray.length){var firstNode=continuousNodeArray[0],lastNode=continuousNodeArray[continuousNodeArray.length-1],parentNode=firstNode.parentNode,provider=ko.bindingProvider['instance'],preprocessNode=provider['preprocessNode'];if(preprocessNode){invokeForEachNodeInContinuousRange(firstNode,lastNode,function(node,nextNodeInRange){var nodePreviousSibling=node.previousSibling;var newNodes=preprocessNode.call(provider,node);if(newNodes){if(node===firstNode)firstNode=newNodes[0]||nextNodeInRange;if(node===lastNode)lastNode=newNodes[newNodes.length-1]||nodePreviousSibling}});continuousNodeArray.length=0;if(!firstNode){return}if(firstNode===lastNode){continuousNodeArray.push(firstNode)}else{continuousNodeArray.push(firstNode,lastNode);ko.utils.fixUpContinuousNodeArray(continuousNodeArray,parentNode)}}invokeForEachNodeInContinuousRange(firstNode,lastNode,function(node){if(node.nodeType===1||node.nodeType===8)ko.applyBindings(bindingContext,node)});invokeForEachNodeInContinuousRange(firstNode,lastNode,function(node){if(node.nodeType===1||node.nodeType===8)ko.memoization.unmemoizeDomNodeAndDescendants(node,[bindingContext])});ko.utils.fixUpContinuousNodeArray(continuousNodeArray,parentNode)}}function getFirstNodeFromPossibleArray(nodeOrNodeArray){return nodeOrNodeArray.nodeType?nodeOrNodeArray:nodeOrNodeArray.length>0?nodeOrNodeArray[0]:null}function executeTemplate(targetNodeOrNodeArray,renderMode,template,bindingContext,options){options=options||{};var firstTargetNode=targetNodeOrNodeArray&&getFirstNodeFromPossibleArray(targetNodeOrNodeArray);var templateDocument=(firstTargetNode||template||{}).ownerDocument;var templateEngineToUse=options['templateEngine']||_templateEngine;ko.templateRewriting.ensureTemplateIsRewritten(template,templateEngineToUse,templateDocument);var renderedNodesArray=templateEngineToUse['renderTemplate'](template,bindingContext,options,templateDocument);if(typeof renderedNodesArray.length!='number'||renderedNodesArray.length>0&&typeof renderedNodesArray[0].nodeType!='number')throw new Error('Template engine must return an array of DOM nodes');var haveAddedNodesToParent=false;switch(renderMode){case'replaceChildren':ko.virtualElements.setDomNodeChildren(targetNodeOrNodeArray,renderedNodesArray);haveAddedNodesToParent=true;break;case'replaceNode':ko.utils.replaceDomNodes(targetNodeOrNodeArray,renderedNodesArray);haveAddedNodesToParent=true;break;case'ignoreTargetNode':break;default:throw new Error('Unknown renderMode: '+renderMode)}if(haveAddedNodesToParent){activateBindingsOnContinuousNodeArray(renderedNodesArray,bindingContext);if(options['afterRender'])ko.dependencyDetection.ignore(options['afterRender'],null,[renderedNodesArray,bindingContext['$data']])}return renderedNodesArray}function resolveTemplateName(template,data,context){if(ko.isObservable(template)){return template()}else if(typeof template==='function'){return template(data,context)}else{return template}}ko.renderTemplate=function(template,dataOrBindingContext,options,targetNodeOrNodeArray,renderMode){options=options||{};if((options['templateEngine']||_templateEngine)==undefined)throw new Error('Set a template engine before calling renderTemplate');renderMode=renderMode||'replaceChildren';if(targetNodeOrNodeArray){var firstTargetNode=getFirstNodeFromPossibleArray(targetNodeOrNodeArray);var whenToDispose=function(){return!firstTargetNode||!ko.utils.domNodeIsAttachedToDocument(firstTargetNode)};var activelyDisposeWhenNodeIsRemoved=firstTargetNode&&renderMode=='replaceNode'?firstTargetNode.parentNode:firstTargetNode;return ko.dependentObservable(function(){var bindingContext=dataOrBindingContext&&dataOrBindingContext instanceof ko.bindingContext?dataOrBindingContext:new ko.bindingContext(dataOrBindingContext,null,null,null,{'exportDependencies':true});var templateName=resolveTemplateName(template,bindingContext['$data'],bindingContext),renderedNodesArray=executeTemplate(targetNodeOrNodeArray,renderMode,templateName,bindingContext,options);if(renderMode=='replaceNode'){targetNodeOrNodeArray=renderedNodesArray;firstTargetNode=getFirstNodeFromPossibleArray(targetNodeOrNodeArray)}},null,{disposeWhen:whenToDispose,disposeWhenNodeIsRemoved:activelyDisposeWhenNodeIsRemoved})}else{return ko.memoization.memoize(function(domNode){ko.renderTemplate(template,dataOrBindingContext,options,domNode,'replaceNode')})}};ko.renderTemplateForEach=function(template,arrayOrObservableArray,options,targetNode,parentBindingContext){var arrayItemContext;var executeTemplateForArrayItem=function(arrayValue,index){arrayItemContext=parentBindingContext['createChildContext'](arrayValue,options['as'],function(context){context['$index']=index});var templateName=resolveTemplateName(template,arrayValue,arrayItemContext);return executeTemplate(null,'ignoreTargetNode',templateName,arrayItemContext,options)};var activateBindingsCallback=function(arrayValue,addedNodesArray,index){activateBindingsOnContinuousNodeArray(addedNodesArray,arrayItemContext);if(options['afterRender'])options['afterRender'](addedNodesArray,arrayValue);arrayItemContext=null};return ko.dependentObservable(function(){var unwrappedArray=ko.utils.unwrapObservable(arrayOrObservableArray)||[];if(typeof unwrappedArray.length=='undefined')unwrappedArray=[unwrappedArray];var filteredArray=ko.utils.arrayFilter(unwrappedArray,function(item){return options['includeDestroyed']||item===undefined||item===null||!ko.utils.unwrapObservable(item['_destroy'])});ko.dependencyDetection.ignore(ko.utils.setDomNodeChildrenFromArrayMapping,null,[targetNode,filteredArray,executeTemplateForArrayItem,options,activateBindingsCallback])},null,{disposeWhenNodeIsRemoved:targetNode})};var templateComputedDomDataKey=ko.utils.domData.nextKey();function disposeOldComputedAndStoreNewOne(element,newComputed){var oldComputed=ko.utils.domData.get(element,templateComputedDomDataKey);if(oldComputed&&typeof oldComputed.dispose=='function')oldComputed.dispose();ko.utils.domData.set(element,templateComputedDomDataKey,newComputed&&newComputed.isActive()?newComputed:undefined)}ko.bindingHandlers['template']={'init':function(element,valueAccessor){var bindingValue=ko.utils.unwrapObservable(valueAccessor());if(typeof bindingValue=='string'||bindingValue['name']){ko.virtualElements.emptyNode(element)}else if('nodes'in bindingValue){var nodes=bindingValue['nodes']||[];if(ko.isObservable(nodes)){throw new Error('The "nodes" option must be a plain, non-observable array.')}var container=ko.utils.moveCleanedNodesToContainerElement(nodes);new ko.templateSources.anonymousTemplate(element)['nodes'](container)}else{var templateNodes=ko.virtualElements.childNodes(element),container=ko.utils.moveCleanedNodesToContainerElement(templateNodes);new ko.templateSources.anonymousTemplate(element)['nodes'](container)}return{'controlsDescendantBindings':true}},'update':function(element,valueAccessor,allBindings,viewModel,bindingContext){var value=valueAccessor(),options=ko.utils.unwrapObservable(value),shouldDisplay=true,templateComputed=null,templateName;if(typeof options=='string'){templateName=value;options={}}else{templateName=options['name'];if('if'in options)shouldDisplay=ko.utils.unwrapObservable(options['if']);if(shouldDisplay&&'ifnot'in options)shouldDisplay=!ko.utils.unwrapObservable(options['ifnot'])}if('foreach'in options){var dataArray=shouldDisplay&&options['foreach']||[];templateComputed=ko.renderTemplateForEach(templateName||element,dataArray,options,element,bindingContext)}else if(!shouldDisplay){ko.virtualElements.emptyNode(element)}else{var innerBindingContext='data'in options?bindingContext.createStaticChildContext(options['data'],options['as']):bindingContext;templateComputed=ko.renderTemplate(templateName||element,innerBindingContext,options,element)}disposeOldComputedAndStoreNewOne(element,templateComputed)}};ko.expressionRewriting.bindingRewriteValidators['template']=function(bindingValue){var parsedBindingValue=ko.expressionRewriting.parseObjectLiteral(bindingValue);if(parsedBindingValue.length==1&&parsedBindingValue[0]['unknown'])return null;if(ko.expressionRewriting.keyValueArrayContainsKey(parsedBindingValue,'name'))return null;return'This template engine does not support anonymous templates nested within its templates'};ko.virtualElements.allowedBindings['template']=true}());ko.exportSymbol('setTemplateEngine',ko.setTemplateEngine);ko.exportSymbol('renderTemplate',ko.renderTemplate);ko.utils.findMovesInArrayComparison=function(left,right,limitFailedCompares){if(left.length&&right.length){var failedCompares,l,r,leftItem,rightItem;for(failedCompares=l=0;(!limitFailedCompares||failedCompares<limitFailedCompares)&&(leftItem=left[l]);++l){for(r=0;rightItem=right[r];++r){if(leftItem['value']===rightItem['value']){leftItem['moved']=rightItem['index'];rightItem['moved']=leftItem['index'];right.splice(r,1);failedCompares=r=0;break}}failedCompares+=r}}};ko.utils.compareArrays=function(){var statusNotInOld='added',statusNotInNew='deleted';function compareArrays(oldArray,newArray,options){options=typeof options==='boolean'?{'dontLimitMoves':options}:options||{};oldArray=oldArray||[];newArray=newArray||[];if(oldArray.length<newArray.length)return compareSmallArrayToBigArray(oldArray,newArray,statusNotInOld,statusNotInNew,options);else return compareSmallArrayToBigArray(newArray,oldArray,statusNotInNew,statusNotInOld,options)}function compareSmallArrayToBigArray(smlArray,bigArray,statusNotInSml,statusNotInBig,options){var myMin=Math.min,myMax=Math.max,editDistanceMatrix=[],smlIndex,smlIndexMax=smlArray.length,bigIndex,bigIndexMax=bigArray.length,compareRange=bigIndexMax-smlIndexMax||1,maxDistance=smlIndexMax+bigIndexMax+1,thisRow,lastRow,bigIndexMaxForRow,bigIndexMinForRow;for(smlIndex=0;smlIndex<=smlIndexMax;smlIndex++){lastRow=thisRow;editDistanceMatrix.push(thisRow=[]);bigIndexMaxForRow=myMin(bigIndexMax,smlIndex+compareRange);bigIndexMinForRow=myMax(0,smlIndex-1);for(bigIndex=bigIndexMinForRow;bigIndex<=bigIndexMaxForRow;bigIndex++){if(!bigIndex)thisRow[bigIndex]=smlIndex+1;else if(!smlIndex)thisRow[bigIndex]=bigIndex+1;else if(smlArray[smlIndex-1]===bigArray[bigIndex-1])thisRow[bigIndex]=lastRow[bigIndex-1];else{var northDistance=lastRow[bigIndex]||maxDistance;var westDistance=thisRow[bigIndex-1]||maxDistance;thisRow[bigIndex]=myMin(northDistance,westDistance)+1}}}var editScript=[],meMinusOne,notInSml=[],notInBig=[];for(smlIndex=smlIndexMax,bigIndex=bigIndexMax;smlIndex||bigIndex;){meMinusOne=editDistanceMatrix[smlIndex][bigIndex]-1;if(bigIndex&&meMinusOne===editDistanceMatrix[smlIndex][bigIndex-1]){notInSml.push(editScript[editScript.length]={'status':statusNotInSml,'value':bigArray[--bigIndex],'index':bigIndex})}else if(smlIndex&&meMinusOne===editDistanceMatrix[smlIndex-1][bigIndex]){notInBig.push(editScript[editScript.length]={'status':statusNotInBig,'value':smlArray[--smlIndex],'index':smlIndex})}else{--bigIndex;--smlIndex;if(!options['sparse']){editScript.push({'status':'retained','value':bigArray[bigIndex]})}}}ko.utils.findMovesInArrayComparison(notInBig,notInSml,!options['dontLimitMoves']&&smlIndexMax*10);return editScript.reverse()}return compareArrays}();ko.exportSymbol('utils.compareArrays',ko.utils.compareArrays);(function(){function mapNodeAndRefreshWhenChanged(containerNode,mapping,valueToMap,callbackAfterAddingNodes,index){var mappedNodes=[];var dependentObservable=ko.dependentObservable(function(){var newMappedNodes=mapping(valueToMap,index,ko.utils.fixUpContinuousNodeArray(mappedNodes,containerNode))||[];if(mappedNodes.length>0){ko.utils.replaceDomNodes(mappedNodes,newMappedNodes);if(callbackAfterAddingNodes)ko.dependencyDetection.ignore(callbackAfterAddingNodes,null,[valueToMap,newMappedNodes,index])}mappedNodes.length=0;ko.utils.arrayPushAll(mappedNodes,newMappedNodes)},null,{disposeWhenNodeIsRemoved:containerNode,disposeWhen:function(){return!ko.utils.anyDomNodeIsAttachedToDocument(mappedNodes)}});return{mappedNodes:mappedNodes,dependentObservable:dependentObservable.isActive()?dependentObservable:undefined}}var lastMappingResultDomDataKey=ko.utils.domData.nextKey(),deletedItemDummyValue=ko.utils.domData.nextKey();ko.utils.setDomNodeChildrenFromArrayMapping=function(domNode,array,mapping,options,callbackAfterAddingNodes){array=array||[];options=options||{};var isFirstExecution=ko.utils.domData.get(domNode,lastMappingResultDomDataKey)===undefined;var lastMappingResult=ko.utils.domData.get(domNode,lastMappingResultDomDataKey)||[];var lastArray=ko.utils.arrayMap(lastMappingResult,function(x){return x.arrayEntry});var editScript=ko.utils.compareArrays(lastArray,array,options['dontLimitMoves']);var newMappingResult=[];var lastMappingResultIndex=0;var newMappingResultIndex=0;var nodesToDelete=[];var itemsToProcess=[];var itemsForBeforeRemoveCallbacks=[];var itemsForMoveCallbacks=[];var itemsForAfterAddCallbacks=[];var mapData;function itemMovedOrRetained(editScriptIndex,oldPosition){mapData=lastMappingResult[oldPosition];if(newMappingResultIndex!==oldPosition)itemsForMoveCallbacks[editScriptIndex]=mapData;mapData.indexObservable(newMappingResultIndex++);ko.utils.fixUpContinuousNodeArray(mapData.mappedNodes,domNode);newMappingResult.push(mapData);itemsToProcess.push(mapData)}function callCallback(callback,items){if(callback){for(var i=0,n=items.length;i<n;i++){if(items[i]){ko.utils.arrayForEach(items[i].mappedNodes,function(node){callback(node,i,items[i].arrayEntry)})}}}}for(var i=0,editScriptItem,movedIndex;editScriptItem=editScript[i];i++){movedIndex=editScriptItem['moved'];switch(editScriptItem['status']){case'deleted':if(movedIndex===undefined){mapData=lastMappingResult[lastMappingResultIndex];if(mapData.dependentObservable){mapData.dependentObservable.dispose();mapData.dependentObservable=undefined}if(ko.utils.fixUpContinuousNodeArray(mapData.mappedNodes,domNode).length){if(options['beforeRemove']){newMappingResult.push(mapData);itemsToProcess.push(mapData);if(mapData.arrayEntry===deletedItemDummyValue){mapData=null}else{itemsForBeforeRemoveCallbacks[i]=mapData}}if(mapData){nodesToDelete.push.apply(nodesToDelete,mapData.mappedNodes)}}}lastMappingResultIndex++;break;case'retained':itemMovedOrRetained(i,lastMappingResultIndex++);break;case'added':if(movedIndex!==undefined){itemMovedOrRetained(i,movedIndex)}else{mapData={arrayEntry:editScriptItem['value'],indexObservable:ko.observable(newMappingResultIndex++)};newMappingResult.push(mapData);itemsToProcess.push(mapData);if(!isFirstExecution)itemsForAfterAddCallbacks[i]=mapData}break}}ko.utils.domData.set(domNode,lastMappingResultDomDataKey,newMappingResult);callCallback(options['beforeMove'],itemsForMoveCallbacks);ko.utils.arrayForEach(nodesToDelete,options['beforeRemove']?ko.cleanNode:ko.removeNode);for(var i=0,nextNode=ko.virtualElements.firstChild(domNode),lastNode,node;mapData=itemsToProcess[i];i++){if(!mapData.mappedNodes)ko.utils.extend(mapData,mapNodeAndRefreshWhenChanged(domNode,mapping,mapData.arrayEntry,callbackAfterAddingNodes,mapData.indexObservable));for(var j=0;node=mapData.mappedNodes[j];nextNode=node.nextSibling,lastNode=node,j++){if(node!==nextNode)ko.virtualElements.insertAfter(domNode,node,lastNode)}if(!mapData.initialized&&callbackAfterAddingNodes){callbackAfterAddingNodes(mapData.arrayEntry,mapData.mappedNodes,mapData.indexObservable);mapData.initialized=true}}callCallback(options['beforeRemove'],itemsForBeforeRemoveCallbacks);for(i=0;i<itemsForBeforeRemoveCallbacks.length;++i){if(itemsForBeforeRemoveCallbacks[i]){itemsForBeforeRemoveCallbacks[i].arrayEntry=deletedItemDummyValue}}callCallback(options['afterMove'],itemsForMoveCallbacks);callCallback(options['afterAdd'],itemsForAfterAddCallbacks)}}());ko.exportSymbol('utils.setDomNodeChildrenFromArrayMapping',ko.utils.setDomNodeChildrenFromArrayMapping);ko.nativeTemplateEngine=function(){this['allowTemplateRewriting']=false};ko.nativeTemplateEngine.prototype=new ko.templateEngine;ko.nativeTemplateEngine.prototype.constructor=ko.nativeTemplateEngine;ko.nativeTemplateEngine.prototype['renderTemplateSource']=function(templateSource,bindingContext,options,templateDocument){var useNodesIfAvailable=!(ko.utils.ieVersion<9),templateNodesFunc=useNodesIfAvailable?templateSource['nodes']:null,templateNodes=templateNodesFunc?templateSource['nodes']():null;if(templateNodes){return ko.utils.makeArray(templateNodes.cloneNode(true).childNodes)}else{var templateText=templateSource['text']();return ko.utils.parseHtmlFragment(templateText,templateDocument)}};ko.nativeTemplateEngine.instance=new ko.nativeTemplateEngine;ko.setTemplateEngine(ko.nativeTemplateEngine.instance);ko.exportSymbol('nativeTemplateEngine',ko.nativeTemplateEngine);(function(){ko.jqueryTmplTemplateEngine=function(){var jQueryTmplVersion=this.jQueryTmplVersion=function(){if(!jQueryInstance||!jQueryInstance['tmpl'])return 0;try{if(jQueryInstance['tmpl']['tag']['tmpl']['open'].toString().indexOf('__')>=0){return 2}}catch(ex){}return 1}();function ensureHasReferencedJQueryTemplates(){if(jQueryTmplVersion<2)throw new Error('Your version of jQuery.tmpl is too old. Please upgrade to jQuery.tmpl 1.0.0pre or later.')}function executeTemplate(compiledTemplate,data,jQueryTemplateOptions){return jQueryInstance['tmpl'](compiledTemplate,data,jQueryTemplateOptions)}this['renderTemplateSource']=function(templateSource,bindingContext,options,templateDocument){templateDocument=templateDocument||document;options=options||{};ensureHasReferencedJQueryTemplates();var precompiled=templateSource['data']('precompiled');if(!precompiled){var templateText=templateSource['text']()||'';templateText='{{ko_with $item.koBindingContext}}'+templateText+'{{/ko_with}}';precompiled=jQueryInstance['template'](null,templateText);templateSource['data']('precompiled',precompiled)}var data=[bindingContext['$data']];var jQueryTemplateOptions=jQueryInstance['extend']({'koBindingContext':bindingContext},options['templateOptions']);var resultNodes=executeTemplate(precompiled,data,jQueryTemplateOptions);resultNodes['appendTo'](templateDocument.createElement('div'));jQueryInstance['fragments']={};return resultNodes};this['createJavaScriptEvaluatorBlock']=function(script){return'{{ko_code ((function() { return '+script+' })()) }}'};this['addTemplate']=function(templateName,templateMarkup){document.write('<script type=\'text/html\' id=\''+templateName+'\'>'+templateMarkup+'<'+'/script>')};if(jQueryTmplVersion>0){jQueryInstance['tmpl']['tag']['ko_code']={open:'__.push($1 || \'\');'};jQueryInstance['tmpl']['tag']['ko_with']={open:'with($1) {',close:'} '}}};ko.jqueryTmplTemplateEngine.prototype=new ko.templateEngine;ko.jqueryTmplTemplateEngine.prototype.constructor=ko.jqueryTmplTemplateEngine;var jqueryTmplTemplateEngineInstance=new ko.jqueryTmplTemplateEngine;if(jqueryTmplTemplateEngineInstance.jQueryTmplVersion>0)ko.setTemplateEngine(jqueryTmplTemplateEngineInstance);ko.exportSymbol('jqueryTmplTemplateEngine',ko.jqueryTmplTemplateEngine)}())}))}())}())}());System.registerDynamic('3rdparty/ical.js',[],false,function($__require,$__exports,$__module){var _retrieveGlobal=System.get('@@global-helpers').prepareGlobal($__module.id,null,null);(function($__global){if(typeof module==='object'){ICAL=module.exports}else if(typeof ICAL!=='object'){this.ICAL={}}ICAL.foldLength=75;ICAL.newLineChar='\r\n';ICAL.helpers={isStrictlyNaN:function(number){return typeof number==='number'&&isNaN(number)},strictParseInt:function(string){var result=parseInt(string,10);if(ICAL.helpers.isStrictlyNaN(result)){throw new Error('Could not extract integer from "'+string+'"')}return result},formatClassType:function formatClassType(data,type){if(typeof data==='undefined'){return undefined}if(data instanceof type){return data}return new type(data)},unescapedIndexOf:function(buffer,search,pos){while((pos=buffer.indexOf(search,pos))!==-1){if(pos>0&&buffer[pos-1]==='\\'){pos+=1}else{return pos}}return-1},binsearchInsert:function(list,seekVal,cmpfunc){if(!list.length)return 0;var low=0,high=list.length-1,mid,cmpval;while(low<=high){mid=low+Math.floor((high-low)/2);cmpval=cmpfunc(seekVal,list[mid]);if(cmpval<0)high=mid-1;else if(cmpval>0)low=mid+1;else break}if(cmpval<0)return mid;else if(cmpval>0)return mid+1;else return mid},dumpn:function(){if(!ICAL.debug){return}if(typeof console!=='undefined'&&'log'in console){ICAL.helpers.dumpn=function consoleDumpn(input){;}}else{ICAL.helpers.dumpn=function geckoDumpn(input){dump(input+'\n')}}ICAL.helpers.dumpn(arguments[0])},clone:function(aSrc,aDeep){if(!aSrc||typeof aSrc!='object'){return aSrc}else if(aSrc instanceof Date){return new Date(aSrc.getTime())}else if('clone'in aSrc){return aSrc.clone()}else if(Array.isArray(aSrc)){var arr=[];for(var i=0;i<aSrc.length;i++){arr.push(aDeep?ICAL.helpers.clone(aSrc[i],true):aSrc[i])}return arr}else{var obj={};for(var name in aSrc){if(Object.prototype.hasOwnProperty.call(aSrc,name)){if(aDeep){obj[name]=ICAL.helpers.clone(aSrc[name],true)}else{obj[name]=aSrc[name]}}}return obj}},foldline:function foldline(aLine){var result='';var line=aLine||'';while(line.length){result+=ICAL.newLineChar+' '+line.substr(0,ICAL.foldLength);line=line.substr(ICAL.foldLength)}return result.substr(ICAL.newLineChar.length+1)},pad2:function pad(data){if(typeof data!=='string'){if(typeof data==='number'){data=parseInt(data)}data=String(data)}var len=data.length;switch(len){case 0:return'00';case 1:return'0'+data;default:return data}},trunc:function trunc(number){return number<0?Math.ceil(number):Math.floor(number)},inherits:function(base,child,extra){function F(){}F.prototype=base.prototype;child.prototype=new F;if(extra){ICAL.helpers.extend(extra,child.prototype)}},extend:function(source,target){for(var key in source){var descr=Object.getOwnPropertyDescriptor(source,key);if(descr&&!Object.getOwnPropertyDescriptor(target,key)){Object.defineProperty(target,key,descr)}}return target}};ICAL.design=function(){'use strict';var FROM_ICAL_NEWLINE=/\\\\|\\;|\\,|\\[Nn]/g;var TO_ICAL_NEWLINE=/\\|;|,|\n/g;var FROM_VCARD_NEWLINE=/\\\\|\\,|\\[Nn]/g;var TO_VCARD_NEWLINE=/\\|,|\n/g;function createTextType(fromNewline,toNewline){var result={matches:/.*/,fromICAL:function(aValue,structuredEscape){return replaceNewline(aValue,fromNewline,structuredEscape)},toICAL:function(aValue,structuredEscape){var regEx=toNewline;if(structuredEscape)regEx=new RegExp(regEx.source+'|'+structuredEscape);return aValue.replace(regEx,function(str){switch(str){case'\\':return'\\\\';case';':return'\\;';case',':return'\\,';case'\n':return'\\n';default:return str}})}};return result}var DEFAULT_TYPE_TEXT={defaultType:'text'};var DEFAULT_TYPE_TEXT_MULTI={defaultType:'text',multiValue:','};var DEFAULT_TYPE_TEXT_STRUCTURED={defaultType:'text',structuredValue:';'};var DEFAULT_TYPE_INTEGER={defaultType:'integer'};var DEFAULT_TYPE_DATETIME_DATE={defaultType:'date-time',allowedTypes:['date-time','date']};var DEFAULT_TYPE_DATETIME={defaultType:'date-time'};var DEFAULT_TYPE_URI={defaultType:'uri'};var DEFAULT_TYPE_UTCOFFSET={defaultType:'utc-offset'};var DEFAULT_TYPE_RECUR={defaultType:'recur'};var DEFAULT_TYPE_DATE_ANDOR_TIME={defaultType:'date-and-or-time',allowedTypes:['date-time','date','text']};function replaceNewlineReplace(string){switch(string){case'\\\\':return'\\';case'\\;':return';';case'\\,':return',';case'\\n':case'\\N':return'\n';default:return string}}function replaceNewline(value,newline,structuredEscape){if(value.indexOf('\\')===-1){return value}if(structuredEscape)newline=new RegExp(newline.source+'|\\\\'+structuredEscape);return value.replace(newline,replaceNewlineReplace)}var commonProperties={'categories':DEFAULT_TYPE_TEXT_MULTI,'url':DEFAULT_TYPE_URI,'version':DEFAULT_TYPE_TEXT,'uid':DEFAULT_TYPE_TEXT};var commonValues={'boolean':{values:['TRUE','FALSE'],fromICAL:function(aValue){switch(aValue){case'TRUE':return true;case'FALSE':return false;default:return false}},toICAL:function(aValue){if(aValue){return'TRUE'}return'FALSE'}},float:{matches:/^[+-]?\d+\.\d+$/,fromICAL:function(aValue){var parsed=parseFloat(aValue);if(ICAL.helpers.isStrictlyNaN(parsed)){return 0}return parsed},toICAL:function(aValue){return String(aValue)}},integer:{fromICAL:function(aValue){var parsed=parseInt(aValue);if(ICAL.helpers.isStrictlyNaN(parsed)){return 0}return parsed},toICAL:function(aValue){return String(aValue)}},'utc-offset':{toICAL:function(aValue){if(aValue.length<7){return aValue.substr(0,3)+aValue.substr(4,2)}else{return aValue.substr(0,3)+aValue.substr(4,2)+aValue.substr(7,2)}},fromICAL:function(aValue){if(aValue.length<6){return aValue.substr(0,3)+':'+aValue.substr(3,2)}else{return aValue.substr(0,3)+':'+aValue.substr(3,2)+':'+aValue.substr(5,2)}},decorate:function(aValue){return ICAL.UtcOffset.fromString(aValue)},undecorate:function(aValue){return aValue.toString()}}};var icalParams={'cutype':{values:['INDIVIDUAL','GROUP','RESOURCE','ROOM','UNKNOWN'],allowXName:true,allowIanaToken:true},'delegated-from':{valueType:'cal-address',multiValue:',',multiValueSeparateDQuote:true},'delegated-to':{valueType:'cal-address',multiValue:',',multiValueSeparateDQuote:true},'encoding':{values:['8BIT','BASE64']},'fbtype':{values:['FREE','BUSY','BUSY-UNAVAILABLE','BUSY-TENTATIVE'],allowXName:true,allowIanaToken:true},'member':{valueType:'cal-address',multiValue:',',multiValueSeparateDQuote:true},'partstat':{values:['NEEDS-ACTION','ACCEPTED','DECLINED','TENTATIVE','DELEGATED','COMPLETED','IN-PROCESS'],allowXName:true,allowIanaToken:true},'range':{values:['THISLANDFUTURE']},'related':{values:['START','END']},'reltype':{values:['PARENT','CHILD','SIBLING'],allowXName:true,allowIanaToken:true},'role':{values:['REQ-PARTICIPANT','CHAIR','OPT-PARTICIPANT','NON-PARTICIPANT'],allowXName:true,allowIanaToken:true},'rsvp':{values:['TRUE','FALSE']},'sent-by':{valueType:'cal-address'},'tzid':{matches:/^\//},'value':{values:['binary','boolean','cal-address','date','date-time','duration','float','integer','period','recur','text','time','uri','utc-offset'],allowXName:true,allowIanaToken:true}};var icalValues=ICAL.helpers.extend(commonValues,{text:createTextType(FROM_ICAL_NEWLINE,TO_ICAL_NEWLINE),uri:{},'binary':{decorate:function(aString){return ICAL.Binary.fromString(aString)},undecorate:function(aBinary){return aBinary.toString()}},'cal-address':{},'date':{decorate:function(aValue,aProp){return ICAL.Time.fromDateString(aValue,aProp)},undecorate:function(aValue){return aValue.toString()},fromICAL:function(aValue){return aValue.substr(0,4)+'-'+aValue.substr(4,2)+'-'+aValue.substr(6,2)},toICAL:function(aValue){if(aValue.length>11){return aValue}return aValue.substr(0,4)+aValue.substr(5,2)+aValue.substr(8,2)}},'date-time':{fromICAL:function(aValue){var result=aValue.substr(0,4)+'-'+aValue.substr(4,2)+'-'+aValue.substr(6,2)+'T'+aValue.substr(9,2)+':'+aValue.substr(11,2)+':'+aValue.substr(13,2);if(aValue[15]&&aValue[15]==='Z'){result+='Z'}return result},toICAL:function(aValue){if(aValue.length<19){return aValue}var result=aValue.substr(0,4)+aValue.substr(5,2)+aValue.substr(8,5)+aValue.substr(14,2)+aValue.substr(17,2);if(aValue[19]&&aValue[19]==='Z'){result+='Z'}return result},decorate:function(aValue,aProp){return ICAL.Time.fromDateTimeString(aValue,aProp)},undecorate:function(aValue){return aValue.toString()}},duration:{decorate:function(aValue){return ICAL.Duration.fromString(aValue)},undecorate:function(aValue){return aValue.toString()}},period:{fromICAL:function(string){var parts=string.split('/');parts[0]=icalValues['date-time'].fromICAL(parts[0]);if(!ICAL.Duration.isValueString(parts[1])){parts[1]=icalValues['date-time'].fromICAL(parts[1])}return parts},toICAL:function(parts){parts[0]=icalValues['date-time'].toICAL(parts[0]);if(!ICAL.Duration.isValueString(parts[1])){parts[1]=icalValues['date-time'].toICAL(parts[1])}return parts.join('/')},decorate:function(aValue,aProp){return ICAL.Period.fromJSON(aValue,aProp)},undecorate:function(aValue){return aValue.toJSON()}},recur:{fromICAL:function(string){return ICAL.Recur._stringToData(string,true)},toICAL:function(data){var str='';for(var k in data){if(!Object.prototype.hasOwnProperty.call(data,k)){continue}var val=data[k];if(k=='until'){if(val.length>10){val=icalValues['date-time'].toICAL(val)}else{val=icalValues.date.toICAL(val)}}else if(k=='wkst'){if(typeof val==='number'){val=ICAL.Recur.numericDayToIcalDay(val)}}else if(Array.isArray(val)){val=val.join(',')}str+=k.toUpperCase()+'='+val+';'}return str.substr(0,str.length-1)},decorate:function decorate(aValue){return ICAL.Recur.fromData(aValue)},undecorate:function(aRecur){return aRecur.toJSON()}},time:{fromICAL:function(aValue){if(aValue.length<6){return aValue}var result=aValue.substr(0,2)+':'+aValue.substr(2,2)+':'+aValue.substr(4,2);if(aValue[6]==='Z'){result+='Z'}return result},toICAL:function(aValue){if(aValue.length<8){return aValue}var result=aValue.substr(0,2)+aValue.substr(3,2)+aValue.substr(6,2);if(aValue[8]==='Z'){result+='Z'}return result}}});var icalProperties=ICAL.helpers.extend(commonProperties,{'action':DEFAULT_TYPE_TEXT,'attach':{defaultType:'uri'},'attendee':{defaultType:'cal-address'},'calscale':DEFAULT_TYPE_TEXT,'class':DEFAULT_TYPE_TEXT,'comment':DEFAULT_TYPE_TEXT,'completed':DEFAULT_TYPE_DATETIME,'contact':DEFAULT_TYPE_TEXT,'created':DEFAULT_TYPE_DATETIME,'description':DEFAULT_TYPE_TEXT,'dtend':DEFAULT_TYPE_DATETIME_DATE,'dtstamp':DEFAULT_TYPE_DATETIME,'dtstart':DEFAULT_TYPE_DATETIME_DATE,'due':DEFAULT_TYPE_DATETIME_DATE,'duration':{defaultType:'duration'},'exdate':{defaultType:'date-time',allowedTypes:['date-time','date'],multiValue:','},'exrule':DEFAULT_TYPE_RECUR,'freebusy':{defaultType:'period',multiValue:','},'geo':{defaultType:'float',structuredValue:';'},'last-modified':DEFAULT_TYPE_DATETIME,'location':DEFAULT_TYPE_TEXT,'method':DEFAULT_TYPE_TEXT,'organizer':{defaultType:'cal-address'},'percent-complete':DEFAULT_TYPE_INTEGER,'priority':DEFAULT_TYPE_INTEGER,'prodid':DEFAULT_TYPE_TEXT,'related-to':DEFAULT_TYPE_TEXT,'repeat':DEFAULT_TYPE_INTEGER,'rdate':{defaultType:'date-time',allowedTypes:['date-time','date','period'],multiValue:',',detectType:function(string){if(string.indexOf('/')!==-1){return'period'}return string.indexOf('T')===-1?'date':'date-time'}},'recurrence-id':DEFAULT_TYPE_DATETIME_DATE,'resources':DEFAULT_TYPE_TEXT_MULTI,'request-status':DEFAULT_TYPE_TEXT_STRUCTURED,'rrule':DEFAULT_TYPE_RECUR,'sequence':DEFAULT_TYPE_INTEGER,'status':DEFAULT_TYPE_TEXT,'summary':DEFAULT_TYPE_TEXT,'transp':DEFAULT_TYPE_TEXT,'trigger':{defaultType:'duration',allowedTypes:['duration','date-time']},'tzoffsetfrom':DEFAULT_TYPE_UTCOFFSET,'tzoffsetto':DEFAULT_TYPE_UTCOFFSET,'tzurl':DEFAULT_TYPE_URI,'tzid':DEFAULT_TYPE_TEXT,'tzname':DEFAULT_TYPE_TEXT});var vcardValues=ICAL.helpers.extend(commonValues,{text:createTextType(FROM_VCARD_NEWLINE,TO_VCARD_NEWLINE),uri:createTextType(FROM_VCARD_NEWLINE,TO_VCARD_NEWLINE),date:{decorate:function(aValue){return ICAL.VCardTime.fromDateAndOrTimeString(aValue,'date')},undecorate:function(aValue){return aValue.toString()},fromICAL:function(aValue){if(aValue.length==8){return icalValues.date.fromICAL(aValue)}else if(aValue[0]=='-'&&aValue.length==6){return aValue.substr(0,4)+'-'+aValue.substr(4)}else{return aValue}},toICAL:function(aValue){if(aValue.length==10){return icalValues.date.toICAL(aValue)}else if(aValue[0]=='-'&&aValue.length==7){return aValue.substr(0,4)+aValue.substr(5)}else{return aValue}}},time:{decorate:function(aValue){return ICAL.VCardTime.fromDateAndOrTimeString('T'+aValue,'time')},undecorate:function(aValue){return aValue.toString()},fromICAL:function(aValue){var splitzone=vcardValues.time._splitZone(aValue,true);var zone=splitzone[0],value=splitzone[1];if(value.length==6){value=value.substr(0,2)+':'+value.substr(2,2)+':'+value.substr(4,2)}else if(value.length==4&&value[0]!='-'){value=value.substr(0,2)+':'+value.substr(2,2)}else if(value.length==5){value=value.substr(0,3)+':'+value.substr(3,2)}if(zone.length==5&&(zone[0]=='-'||zone[0]=='+')){zone=zone.substr(0,3)+':'+zone.substr(3)}return value+zone},toICAL:function(aValue){var splitzone=vcardValues.time._splitZone(aValue);var zone=splitzone[0],value=splitzone[1];if(value.length==8){value=value.substr(0,2)+value.substr(3,2)+value.substr(6,2)}else if(value.length==5&&value[0]!='-'){value=value.substr(0,2)+value.substr(3,2)}else if(value.length==6){value=value.substr(0,3)+value.substr(4,2)}if(zone.length==6&&(zone[0]=='-'||zone[0]=='+')){zone=zone.substr(0,3)+zone.substr(4)}return value+zone},_splitZone:function(aValue,isFromIcal){var lastChar=aValue.length-1;var signChar=aValue.length-(isFromIcal?5:6);var sign=aValue[signChar];var zone,value;if(aValue[lastChar]=='Z'){zone=aValue[lastChar];value=aValue.substr(0,lastChar)}else if(aValue.length>6&&(sign=='-'||sign=='+')){zone=aValue.substr(signChar);value=aValue.substr(0,signChar)}else{zone='';value=aValue}return[zone,value]}},'date-time':{decorate:function(aValue){return ICAL.VCardTime.fromDateAndOrTimeString(aValue,'date-time')},undecorate:function(aValue){return aValue.toString()},fromICAL:function(aValue){return vcardValues['date-and-or-time'].fromICAL(aValue)},toICAL:function(aValue){return vcardValues['date-and-or-time'].toICAL(aValue)}},'date-and-or-time':{decorate:function(aValue){return ICAL.VCardTime.fromDateAndOrTimeString(aValue,'date-and-or-time')},undecorate:function(aValue){return aValue.toString()},fromICAL:function(aValue){var parts=aValue.split('T');return(parts[0]?vcardValues.date.fromICAL(parts[0]):'')+(parts[1]?'T'+vcardValues.time.fromICAL(parts[1]):'')},toICAL:function(aValue){var parts=aValue.split('T');return vcardValues.date.toICAL(parts[0])+(parts[1]?'T'+vcardValues.time.toICAL(parts[1]):'')}},timestamp:icalValues['date-time'],'language-tag':{matches:/^[a-zA-Z0-9\-]+$/}});var vcardParams={'type':{valueType:'text',multiValue:','},'value':{values:['text','uri','date','time','date-time','date-and-or-time','timestamp','boolean','integer','float','utc-offset','language-tag'],allowXName:true,allowIanaToken:true}};var vcardProperties=ICAL.helpers.extend(commonProperties,{'adr':{defaultType:'text',structuredValue:';',multiValue:','},'anniversary':DEFAULT_TYPE_DATE_ANDOR_TIME,'bday':DEFAULT_TYPE_DATE_ANDOR_TIME,'caladruri':DEFAULT_TYPE_URI,'caluri':DEFAULT_TYPE_URI,'clientpidmap':DEFAULT_TYPE_TEXT_STRUCTURED,'email':DEFAULT_TYPE_TEXT,'fburl':DEFAULT_TYPE_URI,'fn':DEFAULT_TYPE_TEXT,'gender':DEFAULT_TYPE_TEXT_STRUCTURED,'geo':DEFAULT_TYPE_URI,'impp':DEFAULT_TYPE_URI,'key':DEFAULT_TYPE_URI,'kind':DEFAULT_TYPE_TEXT,'lang':{defaultType:'language-tag'},'logo':DEFAULT_TYPE_URI,'member':DEFAULT_TYPE_URI,'n':{defaultType:'text',structuredValue:';',multiValue:','},'nickname':DEFAULT_TYPE_TEXT_MULTI,'note':DEFAULT_TYPE_TEXT,'org':{defaultType:'text',structuredValue:';'},'photo':DEFAULT_TYPE_URI,'related':DEFAULT_TYPE_URI,'rev':{defaultType:'timestamp'},'role':DEFAULT_TYPE_TEXT,'sound':DEFAULT_TYPE_URI,'source':DEFAULT_TYPE_URI,'tel':{defaultType:'uri',allowedTypes:['uri','text']},'title':DEFAULT_TYPE_TEXT,'tz':{defaultType:'text',allowedTypes:['text','utc-offset','uri']},'xml':DEFAULT_TYPE_TEXT});var vcard3Values=ICAL.helpers.extend(commonValues,{binary:icalValues.binary,date:vcardValues.date,'date-time':vcardValues['date-time'],'phone-number':{},uri:icalValues.uri,text:icalValues.text,time:icalValues.time,vcard:icalValues.text,'utc-offset':{toICAL:function(aValue){return aValue.substr(0,7)},fromICAL:function(aValue){return aValue.substr(0,7)},decorate:function(aValue){return ICAL.UtcOffset.fromString(aValue)},undecorate:function(aValue){return aValue.toString()}}});var vcard3Params={'type':{valueType:'text',multiValue:','},'value':{values:['text','uri','date','date-time','phone-number','time','boolean','integer','float','utc-offset','vcard','binary'],allowXName:true,allowIanaToken:true}};var vcard3Properties=ICAL.helpers.extend(commonProperties,{fn:DEFAULT_TYPE_TEXT,n:{defaultType:'text',structuredValue:';',multiValue:','},nickname:DEFAULT_TYPE_TEXT_MULTI,photo:{defaultType:'binary',allowedTypes:['binary','uri']},bday:{defaultType:'date-time',allowedTypes:['date-time','date'],detectType:function(string){return string.indexOf('T')===-1?'date':'date-time'}},adr:{defaultType:'text',structuredValue:';',multiValue:','},label:DEFAULT_TYPE_TEXT,tel:{defaultType:'phone-number'},email:DEFAULT_TYPE_TEXT,mailer:DEFAULT_TYPE_TEXT,tz:{defaultType:'utc-offset',allowedTypes:['utc-offset','text']},geo:{defaultType:'float',structuredValue:';'},title:DEFAULT_TYPE_TEXT,role:DEFAULT_TYPE_TEXT,logo:{defaultType:'binary',allowedTypes:['binary','uri']},agent:{defaultType:'vcard',allowedTypes:['vcard','text','uri']},org:DEFAULT_TYPE_TEXT_STRUCTURED,note:DEFAULT_TYPE_TEXT_MULTI,prodid:DEFAULT_TYPE_TEXT,rev:{defaultType:'date-time',allowedTypes:['date-time','date'],detectType:function(string){return string.indexOf('T')===-1?'date':'date-time'}},'sort-string':DEFAULT_TYPE_TEXT,sound:{defaultType:'binary',allowedTypes:['binary','uri']},class:DEFAULT_TYPE_TEXT,key:{defaultType:'binary',allowedTypes:['binary','text']}});var icalSet={value:icalValues,param:icalParams,property:icalProperties};var vcardSet={value:vcardValues,param:vcardParams,property:vcardProperties};var vcard3Set={value:vcard3Values,param:vcard3Params,property:vcard3Properties};var design={defaultSet:icalSet,defaultType:'unknown',components:{vcard:vcardSet,vcard3:vcard3Set,vevent:icalSet,vtodo:icalSet,vjournal:icalSet,valarm:icalSet,vtimezone:icalSet,daylight:icalSet,standard:icalSet},icalendar:icalSet,vcard:vcardSet,vcard3:vcard3Set,getDesignSet:function(componentName){var isInDesign=componentName&&componentName in design.components;return isInDesign?design.components[componentName]:design.defaultSet}};return design}();ICAL.stringify=function(){'use strict';var LINE_ENDING='\r\n';var DEFAULT_VALUE_TYPE='unknown';var design=ICAL.design;var helpers=ICAL.helpers;function stringify(jCal){if(typeof jCal[0]=='string'){jCal=[jCal]}var i=0;var len=jCal.length;var result='';for(;i<len;i++){result+=stringify.component(jCal[i])+LINE_ENDING}return result}stringify.component=function(component,designSet){var name=component[0].toUpperCase();var result='BEGIN:'+name+LINE_ENDING;var props=component[1];var propIdx=0;var propLen=props.length;var designSetName=component[0];if(designSetName==='vcard'&&component[1].length>0&&!(component[1][0][0]==='version'&&component[1][0][3]==='4.0')){designSetName='vcard3'}designSet=designSet||design.getDesignSet(designSetName);for(;propIdx<propLen;propIdx++){result+=stringify.property(props[propIdx],designSet)+LINE_ENDING}var comps=component[2];var compIdx=0;var compLen=comps.length;for(;compIdx<compLen;compIdx++){result+=stringify.component(comps[compIdx],designSet)+LINE_ENDING}result+='END:'+name;return result};stringify.property=function(property,designSet,noFold){var name=property[0].toUpperCase();var jsName=property[0];var params=property[1];var line=name;var paramName;for(paramName in params){var value=params[paramName];if(params.hasOwnProperty(paramName)){var multiValue=paramName in designSet.param&&designSet.param[paramName].multiValue;if(multiValue&&Array.isArray(value)){if(designSet.param[paramName].multiValueSeparateDQuote){multiValue='"'+multiValue+'"'}value=value.map(stringify._rfc6868Unescape);value=stringify.multiValue(value,multiValue,'unknown',null,designSet)}else{value=stringify._rfc6868Unescape(value)}line+=';'+paramName.toUpperCase();line+='='+stringify.propertyValue(value)}}if(property.length===3){return line+':'}var valueType=property[2];if(!designSet){designSet=design.defaultSet}var propDetails;var multiValue=false;var structuredValue=false;var isDefault=false;if(jsName in designSet.property){propDetails=designSet.property[jsName];if('multiValue'in propDetails){multiValue=propDetails.multiValue}if('structuredValue'in propDetails&&Array.isArray(property[3])){structuredValue=propDetails.structuredValue}if('defaultType'in propDetails){if(valueType===propDetails.defaultType){isDefault=true}}else{if(valueType===DEFAULT_VALUE_TYPE){isDefault=true}}}else{if(valueType===DEFAULT_VALUE_TYPE){isDefault=true}}if(!isDefault){line+=';VALUE='+valueType.toUpperCase()}line+=':';if(multiValue&&structuredValue){line+=stringify.multiValue(property[3],structuredValue,valueType,multiValue,designSet,structuredValue)}else if(multiValue){line+=stringify.multiValue(property.slice(3),multiValue,valueType,null,designSet,false)}else if(structuredValue){line+=stringify.multiValue(property[3],structuredValue,valueType,null,designSet,structuredValue)}else{line+=stringify.value(property[3],valueType,designSet,false)}return noFold?line:ICAL.helpers.foldline(line)};stringify.propertyValue=function(value){if(helpers.unescapedIndexOf(value,',')===-1&&helpers.unescapedIndexOf(value,':')===-1&&helpers.unescapedIndexOf(value,';')===-1){return value}return'"'+value+'"'};stringify.multiValue=function(values,delim,type,innerMulti,designSet,structuredValue){var result='';var len=values.length;var i=0;for(;i<len;i++){if(innerMulti&&Array.isArray(values[i])){result+=stringify.multiValue(values[i],innerMulti,type,null,designSet,structuredValue)}else{result+=stringify.value(values[i],type,designSet,structuredValue)}if(i!==len-1){result+=delim}}return result};stringify.value=function(value,type,designSet,structuredValue){if(type in designSet.value&&'toICAL'in designSet.value[type]){return designSet.value[type].toICAL(value,structuredValue)}return value};stringify._rfc6868Unescape=function(val){return val.replace(/[\n^"]/g,function(x){return RFC6868_REPLACE_MAP[x]})};var RFC6868_REPLACE_MAP={'"':'^\'','\n':'^n','^':'^^'};return stringify}();ICAL.parse=function(){'use strict';var CHAR=/[^ \t]/;var MULTIVALUE_DELIMITER=',';var VALUE_DELIMITER=':';var PARAM_DELIMITER=';';var PARAM_NAME_DELIMITER='=';var DEFAULT_VALUE_TYPE='unknown';var DEFAULT_PARAM_TYPE='text';var design=ICAL.design;var helpers=ICAL.helpers;function ParserError(message){this.message=message;this.name='ParserError';try{throw new Error}catch(e){if(e.stack){var split=e.stack.split('\n');split.shift();this.stack=split.join('\n')}}}ParserError.prototype=Error.prototype;function parser(input){var state={};var root=state.component=[];state.stack=[root];parser._eachLine(input,function(err,line){parser._handleContentLine(line,state)});if(state.stack.length>1){throw new ParserError('invalid ical body. component began but did not end')}state=null;return root.length==1?root[0]:root}parser.property=function(str,designSet){var state={component:[[],[]],designSet:designSet||design.defaultSet};parser._handleContentLine(str,state);return state.component[1][0]};parser.component=function(str){return parser(str)};parser.ParserError=ParserError;parser._handleContentLine=function(line,state){var valuePos=line.indexOf(VALUE_DELIMITER);var paramPos=line.indexOf(PARAM_DELIMITER);var lastParamIndex;var lastValuePos;var name;var value;var params={};if(paramPos!==-1&&valuePos!==-1){if(paramPos>valuePos){paramPos=-1}}var parsedParams;if(paramPos!==-1){name=line.substring(0,paramPos).toLowerCase();parsedParams=parser._parseParameters(line.substring(paramPos),0,state.designSet);if(parsedParams[2]==-1){throw new ParserError('Invalid parameters in \''+line+'\'')}params=parsedParams[0];lastParamIndex=parsedParams[1].length+parsedParams[2]+paramPos;if((lastValuePos=line.substring(lastParamIndex).indexOf(VALUE_DELIMITER))!==-1){value=line.substring(lastParamIndex+lastValuePos+1)}else{throw new ParserError('Missing parameter value in \''+line+'\'')}}else if(valuePos!==-1){name=line.substring(0,valuePos).toLowerCase();value=line.substring(valuePos+1);if(name==='begin'){var newComponent=[value.toLowerCase(),[],[]];if(state.stack.length===1){state.component.push(newComponent)}else{state.component[2].push(newComponent)}state.stack.push(state.component);state.component=newComponent;if(!state.designSet){state.designSet=design.getDesignSet(state.component[0])}return}else if(name==='end'){state.component=state.stack.pop();return}}else{throw new ParserError('invalid line (no token ";" or ":") "'+line+'"')}var valueType;var multiValue=false;var structuredValue=false;var propertyDetails;if(name in state.designSet.property){propertyDetails=state.designSet.property[name];if('multiValue'in propertyDetails){multiValue=propertyDetails.multiValue}if('structuredValue'in propertyDetails){structuredValue=propertyDetails.structuredValue}if(value&&'detectType'in propertyDetails){valueType=propertyDetails.detectType(value)}}if(!valueType){if(!('value'in params)){if(propertyDetails){valueType=propertyDetails.defaultType}else{valueType=DEFAULT_VALUE_TYPE}}else{valueType=params.value.toLowerCase()}}delete params.value;var result;if(multiValue&&structuredValue){value=parser._parseMultiValue(value,structuredValue,valueType,[],multiValue,state.designSet,structuredValue);result=[name,params,valueType,value]}else if(multiValue){result=[name,params,valueType];parser._parseMultiValue(value,multiValue,valueType,result,null,state.designSet,false)}else if(structuredValue){value=parser._parseMultiValue(value,structuredValue,valueType,[],null,state.designSet,structuredValue);result=[name,params,valueType,value]}else{value=parser._parseValue(value,valueType,state.designSet,false);result=[name,params,valueType,value]}if(state.component[0]==='vcard'&&state.component[1].length===0&&!(name==='version'&&value==='4.0')){state.designSet=design.getDesignSet('vcard3')}state.component[1].push(result)};parser._parseValue=function(value,type,designSet,structuredValue){if(type in designSet.value&&'fromICAL'in designSet.value[type]){return designSet.value[type].fromICAL(value,structuredValue)}return value};parser._parseParameters=function(line,start,designSet){var lastParam=start;var pos=0;var delim=PARAM_NAME_DELIMITER;var result={};var name,lcname;var value,valuePos=-1;var type,multiValue,mvdelim;while(pos!==false&&(pos=helpers.unescapedIndexOf(line,delim,pos+1))!==-1){name=line.substr(lastParam+1,pos-lastParam-1);if(name.length==0){throw new ParserError('Empty parameter name in \''+line+'\'')}lcname=name.toLowerCase();if(lcname in designSet.param&&designSet.param[lcname].valueType){type=designSet.param[lcname].valueType}else{type=DEFAULT_PARAM_TYPE}if(lcname in designSet.param){multiValue=designSet.param[lcname].multiValue;if(designSet.param[lcname].multiValueSeparateDQuote){mvdelim=parser._rfc6868Escape('"'+multiValue+'"')}}var nextChar=line[pos+1];if(nextChar==='"'){valuePos=pos+2;pos=helpers.unescapedIndexOf(line,'"',valuePos);if(multiValue&&pos!=-1){var extendedValue=true;while(extendedValue){if(line[pos+1]==multiValue&&line[pos+2]=='"'){pos=helpers.unescapedIndexOf(line,'"',pos+3)}else{extendedValue=false}}}if(pos===-1){throw new ParserError('invalid line (no matching double quote) "'+line+'"')}value=line.substr(valuePos,pos-valuePos);lastParam=helpers.unescapedIndexOf(line,PARAM_DELIMITER,pos);if(lastParam===-1){pos=false}}else{valuePos=pos+1;var nextPos=helpers.unescapedIndexOf(line,PARAM_DELIMITER,valuePos);var propValuePos=helpers.unescapedIndexOf(line,VALUE_DELIMITER,valuePos);if(propValuePos!==-1&&nextPos>propValuePos){nextPos=propValuePos;pos=false}else if(nextPos===-1){if(propValuePos===-1){nextPos=line.length}else{nextPos=propValuePos}pos=false}else{lastParam=nextPos;pos=nextPos}value=line.substr(valuePos,nextPos-valuePos)}value=parser._rfc6868Escape(value);if(multiValue){var delimiter=mvdelim||multiValue;result[lcname]=parser._parseMultiValue(value,delimiter,type,[],null,designSet)}else{result[lcname]=parser._parseValue(value,type,designSet)}}return[result,value,valuePos]};parser._rfc6868Escape=function(val){return val.replace(/\^['n^]/g,function(x){return RFC6868_REPLACE_MAP[x]})};var RFC6868_REPLACE_MAP={'^\'':'"','^n':'\n','^^':'^'};parser._parseMultiValue=function(buffer,delim,type,result,innerMulti,designSet,structuredValue){var pos=0;var lastPos=0;var value;if(delim.length===0){return buffer}while((pos=helpers.unescapedIndexOf(buffer,delim,lastPos))!==-1){value=buffer.substr(lastPos,pos-lastPos);if(innerMulti){value=parser._parseMultiValue(value,innerMulti,type,[],null,designSet,structuredValue)}else{value=parser._parseValue(value,type,designSet,structuredValue)}result.push(value);lastPos=pos+delim.length}value=buffer.substr(lastPos);if(innerMulti){value=parser._parseMultiValue(value,innerMulti,type,[],null,designSet,structuredValue)}else{value=parser._parseValue(value,type,designSet,structuredValue)}result.push(value);return result.length==1?result[0]:result};parser._eachLine=function(buffer,callback){var len=buffer.length;var lastPos=buffer.search(CHAR);var pos=lastPos;var line;var firstChar;var newlineOffset;do{pos=buffer.indexOf('\n',lastPos)+1;if(pos>1&&buffer[pos-2]==='\r'){newlineOffset=2}else{newlineOffset=1}if(pos===0){pos=len;newlineOffset=0}firstChar=buffer[lastPos];if(firstChar===' '||firstChar==='	'){line+=buffer.substr(lastPos+1,pos-lastPos-(newlineOffset+1))}else{if(line)callback(null,line);line=buffer.substr(lastPos,pos-lastPos-newlineOffset)}lastPos=pos}while(pos!==len);line=line.trim();if(line.length)callback(null,line)};return parser}();ICAL.Component=function(){'use strict';var PROPERTY_INDEX=1;var COMPONENT_INDEX=2;var NAME_INDEX=0;function Component(jCal,parent){if(typeof jCal==='string'){jCal=[jCal,[],[]]}this.jCal=jCal;this.parent=parent||null}Component.prototype={_hydratedPropertyCount:0,_hydratedComponentCount:0,get name(){return this.jCal[NAME_INDEX]},get _designSet(){var parentDesign=this.parent&&this.parent._designSet;return parentDesign||ICAL.design.getDesignSet(this.name)},_hydrateComponent:function(index){if(!this._components){this._components=[];this._hydratedComponentCount=0}if(this._components[index]){return this._components[index]}var comp=new Component(this.jCal[COMPONENT_INDEX][index],this);this._hydratedComponentCount++;return this._components[index]=comp},_hydrateProperty:function(index){if(!this._properties){this._properties=[];this._hydratedPropertyCount=0}if(this._properties[index]){return this._properties[index]}var prop=new ICAL.Property(this.jCal[PROPERTY_INDEX][index],this);this._hydratedPropertyCount++;return this._properties[index]=prop},getFirstSubcomponent:function(name){if(name){var i=0;var comps=this.jCal[COMPONENT_INDEX];var len=comps.length;for(;i<len;i++){if(comps[i][NAME_INDEX]===name){var result=this._hydrateComponent(i);return result}}}else{if(this.jCal[COMPONENT_INDEX].length){return this._hydrateComponent(0)}}return null},getAllSubcomponents:function(name){var jCalLen=this.jCal[COMPONENT_INDEX].length;var i=0;if(name){var comps=this.jCal[COMPONENT_INDEX];var result=[];for(;i<jCalLen;i++){if(name===comps[i][NAME_INDEX]){result.push(this._hydrateComponent(i))}}return result}else{if(!this._components||this._hydratedComponentCount!==jCalLen){for(;i<jCalLen;i++){this._hydrateComponent(i)}}return this._components||[]}},hasProperty:function(name){var props=this.jCal[PROPERTY_INDEX];var len=props.length;var i=0;for(;i<len;i++){if(props[i][NAME_INDEX]===name){return true}}return false},getFirstProperty:function(name){if(name){var i=0;var props=this.jCal[PROPERTY_INDEX];var len=props.length;for(;i<len;i++){if(props[i][NAME_INDEX]===name){var result=this._hydrateProperty(i);return result}}}else{if(this.jCal[PROPERTY_INDEX].length){return this._hydrateProperty(0)}}return null},getFirstPropertyValue:function(name){var prop=this.getFirstProperty(name);if(prop){return prop.getFirstValue()}return null},getAllProperties:function(name){var jCalLen=this.jCal[PROPERTY_INDEX].length;var i=0;if(name){var props=this.jCal[PROPERTY_INDEX];var result=[];for(;i<jCalLen;i++){if(name===props[i][NAME_INDEX]){result.push(this._hydrateProperty(i))}}return result}else{if(!this._properties||this._hydratedPropertyCount!==jCalLen){for(;i<jCalLen;i++){this._hydrateProperty(i)}}return this._properties||[]}},_removeObjectByIndex:function(jCalIndex,cache,index){cache=cache||[];if(cache[index]){var obj=cache[index];if('parent'in obj){obj.parent=null}}cache.splice(index,1);this.jCal[jCalIndex].splice(index,1)},_removeObject:function(jCalIndex,cache,nameOrObject){var i=0;var objects=this.jCal[jCalIndex];var len=objects.length;var cached=this[cache];if(typeof nameOrObject==='string'){for(;i<len;i++){if(objects[i][NAME_INDEX]===nameOrObject){this._removeObjectByIndex(jCalIndex,cached,i);return true}}}else if(cached){for(;i<len;i++){if(cached[i]&&cached[i]===nameOrObject){this._removeObjectByIndex(jCalIndex,cached,i);return true}}}return false},_removeAllObjects:function(jCalIndex,cache,name){var cached=this[cache];var objects=this.jCal[jCalIndex];var i=objects.length-1;for(;i>=0;i--){if(!name||objects[i][NAME_INDEX]===name){this._removeObjectByIndex(jCalIndex,cached,i)}}},addSubcomponent:function(component){if(!this._components){this._components=[];this._hydratedComponentCount=0}if(component.parent){component.parent.removeSubcomponent(component)}var idx=this.jCal[COMPONENT_INDEX].push(component.jCal);this._components[idx-1]=component;this._hydratedComponentCount++;component.parent=this;return component},removeSubcomponent:function(nameOrComp){var removed=this._removeObject(COMPONENT_INDEX,'_components',nameOrComp);if(removed){this._hydratedComponentCount--}return removed},removeAllSubcomponents:function(name){var removed=this._removeAllObjects(COMPONENT_INDEX,'_components',name);this._hydratedComponentCount=0;return removed},addProperty:function(property){if(!(property instanceof ICAL.Property)){throw new TypeError('must instance of ICAL.Property')}if(!this._properties){this._properties=[];this._hydratedPropertyCount=0}if(property.parent){property.parent.removeProperty(property)}var idx=this.jCal[PROPERTY_INDEX].push(property.jCal);this._properties[idx-1]=property;this._hydratedPropertyCount++;property.parent=this;return property},addPropertyWithValue:function(name,value){var prop=new ICAL.Property(name);prop.setValue(value);this.addProperty(prop);return prop},updatePropertyWithValue:function(name,value){var prop=this.getFirstProperty(name);if(prop){prop.setValue(value)}else{prop=this.addPropertyWithValue(name,value)}return prop},removeProperty:function(nameOrProp){var removed=this._removeObject(PROPERTY_INDEX,'_properties',nameOrProp);if(removed){this._hydratedPropertyCount--}return removed},removeAllProperties:function(name){var removed=this._removeAllObjects(PROPERTY_INDEX,'_properties',name);this._hydratedPropertyCount=0;return removed},toJSON:function(){return this.jCal},toString:function(){return ICAL.stringify.component(this.jCal,this._designSet)}};Component.fromString=function(str){return new Component(ICAL.parse.component(str))};return Component}();ICAL.Property=function(){'use strict';var NAME_INDEX=0;var PROP_INDEX=1;var TYPE_INDEX=2;var VALUE_INDEX=3;var design=ICAL.design;function Property(jCal,parent){this._parent=parent||null;if(typeof jCal==='string'){this.jCal=[jCal,{},design.defaultType];this.jCal[TYPE_INDEX]=this.getDefaultType()}else{this.jCal=jCal}this._updateType()}Property.prototype={get type(){return this.jCal[TYPE_INDEX]},get name(){return this.jCal[NAME_INDEX]},get parent(){return this._parent},set parent(p){var designSetChanged=!this._parent||p&&p._designSet!=this._parent._designSet;this._parent=p;if(this.type==design.defaultType&&designSetChanged){this.jCal[TYPE_INDEX]=this.getDefaultType();this._updateType()}return p},get _designSet(){return this.parent?this.parent._designSet:design.defaultSet},_updateType:function(){var designSet=this._designSet;if(this.type in designSet.value){var designType=designSet.value[this.type];if('decorate'in designSet.value[this.type]){this.isDecorated=true}else{this.isDecorated=false}if(this.name in designSet.property){this.isMultiValue='multiValue'in designSet.property[this.name];this.isStructuredValue='structuredValue'in designSet.property[this.name]}}},_hydrateValue:function(index){if(this._values&&this._values[index]){return this._values[index]}if(this.jCal.length<=VALUE_INDEX+index){return null}if(this.isDecorated){if(!this._values){this._values=[]}return this._values[index]=this._decorate(this.jCal[VALUE_INDEX+index])}else{return this.jCal[VALUE_INDEX+index]}},_decorate:function(value){return this._designSet.value[this.type].decorate(value,this)},_undecorate:function(value){return this._designSet.value[this.type].undecorate(value,this)},_setDecoratedValue:function(value,index){if(!this._values){this._values=[]}if(typeof value==='object'&&'icaltype'in value){this.jCal[VALUE_INDEX+index]=this._undecorate(value);this._values[index]=value}else{this.jCal[VALUE_INDEX+index]=value;this._values[index]=this._decorate(value)}},getParameter:function(name){if(name in this.jCal[PROP_INDEX]){return this.jCal[PROP_INDEX][name]}else{return undefined}},setParameter:function(name,value){var lcname=name.toLowerCase();if(typeof value==='string'&&lcname in this._designSet.param&&'multiValue'in this._designSet.param[lcname]){value=[value]}this.jCal[PROP_INDEX][name]=value},removeParameter:function(name){delete this.jCal[PROP_INDEX][name]},getDefaultType:function(){var name=this.jCal[NAME_INDEX];var designSet=this._designSet;if(name in designSet.property){var details=designSet.property[name];if('defaultType'in details){return details.defaultType}}return design.defaultType},resetType:function(type){this.removeAllValues();this.jCal[TYPE_INDEX]=type;this._updateType()},getFirstValue:function(){return this._hydrateValue(0)},getValues:function(){var len=this.jCal.length-VALUE_INDEX;if(len<1){return[]}var i=0;var result=[];for(;i<len;i++){result[i]=this._hydrateValue(i)}return result},removeAllValues:function(){if(this._values){this._values.length=0}this.jCal.length=3},setValues:function(values){if(!this.isMultiValue){throw new Error(this.name+': does not not support mulitValue.\n'+'override isMultiValue')}var len=values.length;var i=0;this.removeAllValues();if(len>0&&typeof values[0]==='object'&&'icaltype'in values[0]){this.resetType(values[0].icaltype)}if(this.isDecorated){for(;i<len;i++){this._setDecoratedValue(values[i],i)}}else{for(;i<len;i++){this.jCal[VALUE_INDEX+i]=values[i]}}},setValue:function(value){this.removeAllValues();if(typeof value==='object'&&'icaltype'in value){this.resetType(value.icaltype)}if(this.isDecorated){this._setDecoratedValue(value,0)}else{this.jCal[VALUE_INDEX]=value}},toJSON:function(){return this.jCal},toICALString:function(){return ICAL.stringify.property(this.jCal,this._designSet,true)}};Property.fromString=function(str,designSet){return new Property(ICAL.parse.property(str,designSet))};return Property}();ICAL.UtcOffset=function(){function UtcOffset(aData){this.fromData(aData)}UtcOffset.prototype={hours:0,minutes:0,factor:1,icaltype:'utc-offset',clone:function(){return ICAL.UtcOffset.fromSeconds(this.toSeconds())},fromData:function(aData){if(aData){for(var key in aData){if(aData.hasOwnProperty(key)){this[key]=aData[key]}}}this._normalize()},fromSeconds:function(aSeconds){var secs=Math.abs(aSeconds);this.factor=aSeconds<0?-1:1;this.hours=ICAL.helpers.trunc(secs/3600);secs-=this.hours*3600;this.minutes=ICAL.helpers.trunc(secs/60);return this},toSeconds:function(){return this.factor*(60*this.minutes+3600*this.hours)},compare:function icaltime_compare(other){var a=this.toSeconds();var b=other.toSeconds();return(a>b)-(b>a)},_normalize:function(){var secs=this.toSeconds();var factor=this.factor;while(secs<-43200){secs+=97200}while(secs>50400){secs-=97200}this.fromSeconds(secs);if(secs==0){this.factor=factor}},toICALString:function(){return ICAL.design.icalendar.value['utc-offset'].toICAL(this.toString())},toString:function toString(){return(this.factor==1?'+':'-')+ICAL.helpers.pad2(this.hours)+':'+ICAL.helpers.pad2(this.minutes)}};UtcOffset.fromString=function(aString){var options={};options.factor=aString[0]==='+'?1:-1;options.hours=ICAL.helpers.strictParseInt(aString.substr(1,2));options.minutes=ICAL.helpers.strictParseInt(aString.substr(4,2));return new ICAL.UtcOffset(options)};UtcOffset.fromSeconds=function(aSeconds){var instance=new UtcOffset;instance.fromSeconds(aSeconds);return instance};return UtcOffset}();ICAL.Binary=function(){function Binary(aValue){this.value=aValue}Binary.prototype={icaltype:'binary',decodeValue:function decodeValue(){return this._b64_decode(this.value)},setEncodedValue:function setEncodedValue(aValue){this.value=this._b64_encode(aValue)},_b64_encode:function base64_encode(data){var b64='ABCDEFGHIJKLMNOPQRSTUVWXYZ'+'abcdefghijklmnopqrstuvwxyz0123456789+/=';var o1,o2,o3,h1,h2,h3,h4,bits,i=0,ac=0,enc='',tmp_arr=[];if(!data){return data}do{o1=data.charCodeAt(i++);o2=data.charCodeAt(i++);o3=data.charCodeAt(i++);bits=o1<<16|o2<<8|o3;h1=bits>>18&63;h2=bits>>12&63;h3=bits>>6&63;h4=bits&63;tmp_arr[ac++]=b64.charAt(h1)+b64.charAt(h2)+b64.charAt(h3)+b64.charAt(h4)}while(i<data.length);enc=tmp_arr.join('');var r=data.length%3;return(r?enc.slice(0,r-3):enc)+'==='.slice(r||3)},_b64_decode:function base64_decode(data){var b64='ABCDEFGHIJKLMNOPQRSTUVWXYZ'+'abcdefghijklmnopqrstuvwxyz0123456789+/=';var o1,o2,o3,h1,h2,h3,h4,bits,i=0,ac=0,dec='',tmp_arr=[];if(!data){return data}data+='';do{h1=b64.indexOf(data.charAt(i++));h2=b64.indexOf(data.charAt(i++));h3=b64.indexOf(data.charAt(i++));h4=b64.indexOf(data.charAt(i++));bits=h1<<18|h2<<12|h3<<6|h4;o1=bits>>16&255;o2=bits>>8&255;o3=bits&255;if(h3==64){tmp_arr[ac++]=String.fromCharCode(o1)}else if(h4==64){tmp_arr[ac++]=String.fromCharCode(o1,o2)}else{tmp_arr[ac++]=String.fromCharCode(o1,o2,o3)}}while(i<data.length);dec=tmp_arr.join('');return dec},toString:function(){return this.value}};Binary.fromString=function(aString){return new Binary(aString)};return Binary}();(function(){ICAL.Period=function icalperiod(aData){this.wrappedJSObject=this;if(aData&&'start'in aData){if(aData.start&&!(aData.start instanceof ICAL.Time)){throw new TypeError('.start must be an instance of ICAL.Time')}this.start=aData.start}if(aData&&aData.end&&aData.duration){throw new Error('cannot accept both end and duration')}if(aData&&'end'in aData){if(aData.end&&!(aData.end instanceof ICAL.Time)){throw new TypeError('.end must be an instance of ICAL.Time')}this.end=aData.end}if(aData&&'duration'in aData){if(aData.duration&&!(aData.duration instanceof ICAL.Duration)){throw new TypeError('.duration must be an instance of ICAL.Duration')}this.duration=aData.duration}};ICAL.Period.prototype={start:null,end:null,duration:null,icalclass:'icalperiod',icaltype:'period',clone:function(){return ICAL.Period.fromData({start:this.start?this.start.clone():null,end:this.end?this.end.clone():null,duration:this.duration?this.duration.clone():null})},getDuration:function duration(){if(this.duration){return this.duration}else{return this.end.subtractDate(this.start)}},getEnd:function(){if(this.end){return this.end}else{var end=this.start.clone();end.addDuration(this.duration);return end}},toString:function toString(){return this.start+'/'+(this.end||this.duration)},toJSON:function(){return[this.start.toString(),(this.end||this.duration).toString()]},toICALString:function(){return this.start.toICALString()+'/'+(this.end||this.duration).toICALString()}};ICAL.Period.fromString=function fromString(str,prop){var parts=str.split('/');if(parts.length!==2){throw new Error('Invalid string value: "'+str+'" must contain a "/" char.')}var options={start:ICAL.Time.fromDateTimeString(parts[0],prop)};var end=parts[1];if(ICAL.Duration.isValueString(end)){options.duration=ICAL.Duration.fromString(end)}else{options.end=ICAL.Time.fromDateTimeString(end,prop)}return new ICAL.Period(options)};ICAL.Period.fromData=function fromData(aData){return new ICAL.Period(aData)};ICAL.Period.fromJSON=function(aData,aProp){if(ICAL.Duration.isValueString(aData[1])){return ICAL.Period.fromData({start:ICAL.Time.fromDateTimeString(aData[0],aProp),duration:ICAL.Duration.fromString(aData[1])})}else{return ICAL.Period.fromData({start:ICAL.Time.fromDateTimeString(aData[0],aProp),end:ICAL.Time.fromDateTimeString(aData[1],aProp)})}}}());(function(){var DURATION_LETTERS=/([PDWHMTS]{1,1})/;ICAL.Duration=function icalduration(data){this.wrappedJSObject=this;this.fromData(data)};ICAL.Duration.prototype={weeks:0,days:0,hours:0,minutes:0,seconds:0,isNegative:false,icalclass:'icalduration',icaltype:'duration',clone:function clone(){return ICAL.Duration.fromData(this)},toSeconds:function toSeconds(){var seconds=this.seconds+60*this.minutes+3600*this.hours+86400*this.days+7*86400*this.weeks;return this.isNegative?-seconds:seconds},fromSeconds:function fromSeconds(aSeconds){var secs=Math.abs(aSeconds);this.isNegative=aSeconds<0;this.days=ICAL.helpers.trunc(secs/86400);if(this.days%7==0){this.weeks=this.days/7;this.days=0}else{this.weeks=0}secs-=(this.days+7*this.weeks)*86400;this.hours=ICAL.helpers.trunc(secs/3600);secs-=this.hours*3600;this.minutes=ICAL.helpers.trunc(secs/60);secs-=this.minutes*60;this.seconds=secs;return this},fromData:function fromData(aData){var propsToCopy=['weeks','days','hours','minutes','seconds','isNegative'];for(var key in propsToCopy){if(!propsToCopy.hasOwnProperty(key)){continue}var prop=propsToCopy[key];if(aData&&prop in aData){this[prop]=aData[prop]}else{this[prop]=0}}},reset:function reset(){this.isNegative=false;this.weeks=0;this.days=0;this.hours=0;this.minutes=0;this.seconds=0},compare:function compare(aOther){var thisSeconds=this.toSeconds();var otherSeconds=aOther.toSeconds();return(thisSeconds>otherSeconds)-(thisSeconds<otherSeconds)},normalize:function normalize(){this.fromSeconds(this.toSeconds())},toString:function toString(){if(this.toSeconds()==0){return'PT0S'}else{var str='';if(this.isNegative)str+='-';str+='P';if(this.weeks)str+=this.weeks+'W';if(this.days)str+=this.days+'D';if(this.hours||this.minutes||this.seconds){str+='T';if(this.hours)str+=this.hours+'H';if(this.minutes)str+=this.minutes+'M';if(this.seconds)str+=this.seconds+'S'}return str}},toICALString:function(){return this.toString()}};ICAL.Duration.fromSeconds=function icalduration_from_seconds(aSeconds){return new ICAL.Duration().fromSeconds(aSeconds)};function parseDurationChunk(letter,number,object){var type;switch(letter){case'P':if(number&&number==='-'){object.isNegative=true}else{object.isNegative=false}break;case'D':type='days';break;case'W':type='weeks';break;case'H':type='hours';break;case'M':type='minutes';break;case'S':type='seconds';break;default:return 0}if(type){if(!number&&number!==0){throw new Error('invalid duration value: Missing number before "'+letter+'"')}var num=parseInt(number,10);if(ICAL.helpers.isStrictlyNaN(num)){throw new Error('invalid duration value: Invalid number "'+number+'" before "'+letter+'"')}object[type]=num}return 1}ICAL.Duration.isValueString=function(string){return string[0]==='P'||string[1]==='P'};ICAL.Duration.fromString=function icalduration_from_string(aStr){var pos=0;var dict=Object.create(null);var chunks=0;while((pos=aStr.search(DURATION_LETTERS))!==-1){var type=aStr[pos];var numeric=aStr.substr(0,pos);aStr=aStr.substr(pos+1);chunks+=parseDurationChunk(type,numeric,dict)}if(chunks<2){throw new Error('invalid duration value: Not enough duration components in "'+aStr+'"')}return new ICAL.Duration(dict)};ICAL.Duration.fromData=function icalduration_from_data(aData){return new ICAL.Duration(aData)}}());(function(){var OPTIONS=['tzid','location','tznames','latitude','longitude'];ICAL.Timezone=function icaltimezone(data){this.wrappedJSObject=this;this.fromData(data)};ICAL.Timezone.prototype={tzid:'',location:'',tznames:'',latitude:0,longitude:0,component:null,expandedUntilYear:0,icalclass:'icaltimezone',fromData:function fromData(aData){this.expandedUntilYear=0;this.changes=[];if(aData instanceof ICAL.Component){this.component=aData}else{if(aData&&'component'in aData){if(typeof aData.component=='string'){var jCal=ICAL.parse(aData.component);this.component=new ICAL.Component(jCal)}else if(aData.component instanceof ICAL.Component){this.component=aData.component}else{this.component=null}}for(var key in OPTIONS){if(OPTIONS.hasOwnProperty(key)){var prop=OPTIONS[key];if(aData&&prop in aData){this[prop]=aData[prop]}}}}if(this.component instanceof ICAL.Component&&!this.tzid){this.tzid=this.component.getFirstPropertyValue('tzid')}return this},utcOffset:function utcOffset(tt){if(this==ICAL.Timezone.utcTimezone||this==ICAL.Timezone.localTimezone){return 0}this._ensureCoverage(tt.year);if(!this.changes.length){return 0}var tt_change={year:tt.year,month:tt.month,day:tt.day,hour:tt.hour,minute:tt.minute,second:tt.second};var change_num=this._findNearbyChange(tt_change);var change_num_to_use=-1;var step=1;for(;;){var change=ICAL.helpers.clone(this.changes[change_num],true);if(change.utcOffset<change.prevUtcOffset){ICAL.Timezone.adjust_change(change,0,0,0,change.utcOffset)}else{ICAL.Timezone.adjust_change(change,0,0,0,change.prevUtcOffset)}var cmp=ICAL.Timezone._compare_change_fn(tt_change,change);if(cmp>=0){change_num_to_use=change_num}else{step=-1}if(step==-1&&change_num_to_use!=-1){break}change_num+=step;if(change_num<0){return 0}if(change_num>=this.changes.length){break}}var zone_change=this.changes[change_num_to_use];var utcOffset_change=zone_change.utcOffset-zone_change.prevUtcOffset;if(utcOffset_change<0&&change_num_to_use>0){var tmp_change=ICAL.helpers.clone(zone_change,true);ICAL.Timezone.adjust_change(tmp_change,0,0,0,tmp_change.prevUtcOffset);if(ICAL.Timezone._compare_change_fn(tt_change,tmp_change)<0){var prev_zone_change=this.changes[change_num_to_use-1];var want_daylight=false;if(zone_change.is_daylight!=want_daylight&&prev_zone_change.is_daylight==want_daylight){zone_change=prev_zone_change}}}return zone_change.utcOffset},_findNearbyChange:function icaltimezone_find_nearby_change(change){var idx=ICAL.helpers.binsearchInsert(this.changes,change,ICAL.Timezone._compare_change_fn);if(idx>=this.changes.length){return this.changes.length-1}return idx},_ensureCoverage:function(aYear){if(ICAL.Timezone._minimumExpansionYear==-1){var today=ICAL.Time.now();ICAL.Timezone._minimumExpansionYear=today.year}var changesEndYear=aYear;if(changesEndYear<ICAL.Timezone._minimumExpansionYear){changesEndYear=ICAL.Timezone._minimumExpansionYear}changesEndYear+=ICAL.Timezone.EXTRA_COVERAGE;if(changesEndYear>ICAL.Timezone.MAX_YEAR){changesEndYear=ICAL.Timezone.MAX_YEAR}if(!this.changes.length||this.expandedUntilYear<aYear){var subcomps=this.component.getAllSubcomponents();var compLen=subcomps.length;var compIdx=0;for(;compIdx<compLen;compIdx++){this._expandComponent(subcomps[compIdx],changesEndYear,this.changes)}this.changes.sort(ICAL.Timezone._compare_change_fn);this.expandedUntilYear=changesEndYear}},_expandComponent:function(aComponent,aYear,changes){if(!aComponent.hasProperty('dtstart')||!aComponent.hasProperty('tzoffsetto')||!aComponent.hasProperty('tzoffsetfrom')){return null}var dtstart=aComponent.getFirstProperty('dtstart').getFirstValue();var change;function convert_tzoffset(offset){return offset.factor*(offset.hours*3600+offset.minutes*60)}function init_changes(){var changebase={};changebase.is_daylight=aComponent.name=='daylight';changebase.utcOffset=convert_tzoffset(aComponent.getFirstProperty('tzoffsetto').getFirstValue());changebase.prevUtcOffset=convert_tzoffset(aComponent.getFirstProperty('tzoffsetfrom').getFirstValue());return changebase}if(!aComponent.hasProperty('rrule')&&!aComponent.hasProperty('rdate')){change=init_changes();change.year=dtstart.year;change.month=dtstart.month;change.day=dtstart.day;change.hour=dtstart.hour;change.minute=dtstart.minute;change.second=dtstart.second;ICAL.Timezone.adjust_change(change,0,0,0,-change.prevUtcOffset);changes.push(change)}else{var props=aComponent.getAllProperties('rdate');for(var rdatekey in props){if(!props.hasOwnProperty(rdatekey)){continue}var rdate=props[rdatekey];var time=rdate.getFirstValue();change=init_changes();change.year=time.year;change.month=time.month;change.day=time.day;if(time.isDate){change.hour=dtstart.hour;change.minute=dtstart.minute;change.second=dtstart.second;if(dtstart.zone!=ICAL.Timezone.utcTimezone){ICAL.Timezone.adjust_change(change,0,0,0,-change.prevUtcOffset)}}else{change.hour=time.hour;change.minute=time.minute;change.second=time.second;if(time.zone!=ICAL.Timezone.utcTimezone){ICAL.Timezone.adjust_change(change,0,0,0,-change.prevUtcOffset)}}changes.push(change)}var rrule=aComponent.getFirstProperty('rrule');if(rrule){rrule=rrule.getFirstValue();change=init_changes();if(rrule.until&&rrule.until.zone==ICAL.Timezone.utcTimezone){rrule.until.adjust(0,0,0,change.prevUtcOffset);rrule.until.zone=ICAL.Timezone.localTimezone}var iterator=rrule.iterator(dtstart);var occ;while(occ=iterator.next()){change=init_changes();if(occ.year>aYear||!occ){break}change.year=occ.year;change.month=occ.month;change.day=occ.day;change.hour=occ.hour;change.minute=occ.minute;change.second=occ.second;change.isDate=occ.isDate;ICAL.Timezone.adjust_change(change,0,0,0,-change.prevUtcOffset);changes.push(change)}}}return changes},toString:function toString(){return this.tznames?this.tznames:this.tzid}};ICAL.Timezone._compare_change_fn=function icaltimezone_compare_change_fn(a,b){if(a.year<b.year)return-1;else if(a.year>b.year)return 1;if(a.month<b.month)return-1;else if(a.month>b.month)return 1;if(a.day<b.day)return-1;else if(a.day>b.day)return 1;if(a.hour<b.hour)return-1;else if(a.hour>b.hour)return 1;if(a.minute<b.minute)return-1;else if(a.minute>b.minute)return 1;if(a.second<b.second)return-1;else if(a.second>b.second)return 1;return 0};ICAL.Timezone.convert_time=function icaltimezone_convert_time(tt,from_zone,to_zone){if(tt.isDate||from_zone.tzid==to_zone.tzid||from_zone==ICAL.Timezone.localTimezone||to_zone==ICAL.Timezone.localTimezone){tt.zone=to_zone;return tt}var utcOffset=from_zone.utcOffset(tt);tt.adjust(0,0,0,-utcOffset);utcOffset=to_zone.utcOffset(tt);tt.adjust(0,0,0,utcOffset);return null};ICAL.Timezone.fromData=function icaltimezone_fromData(aData){var tt=new ICAL.Timezone;return tt.fromData(aData)};ICAL.Timezone.utcTimezone=ICAL.Timezone.fromData({tzid:'UTC'});ICAL.Timezone.localTimezone=ICAL.Timezone.fromData({tzid:'floating'});ICAL.Timezone.adjust_change=function icaltimezone_adjust_change(change,days,hours,minutes,seconds){return ICAL.Time.prototype.adjust.call(change,days,hours,minutes,seconds,change)};ICAL.Timezone._minimumExpansionYear=-1;ICAL.Timezone.MAX_YEAR=2035;ICAL.Timezone.EXTRA_COVERAGE=5}());ICAL.TimezoneService=function(){var zones;var TimezoneService={reset:function(){zones=Object.create(null);var utc=ICAL.Timezone.utcTimezone;zones.Z=utc;zones.UTC=utc;zones.GMT=utc},has:function(tzid){return!!zones[tzid]},get:function(tzid){return zones[tzid]},register:function(name,timezone){if(name instanceof ICAL.Component){if(name.name==='vtimezone'){timezone=new ICAL.Timezone(name);name=timezone.tzid}}if(timezone instanceof ICAL.Timezone){zones[name]=timezone}else{throw new TypeError('timezone must be ICAL.Timezone or ICAL.Component')}},remove:function(tzid){return delete zones[tzid]}};TimezoneService.reset();return TimezoneService}();(function(){ICAL.Time=function icaltime(data,zone){this.wrappedJSObject=this;var time=this._time=Object.create(null);time.year=0;time.month=1;time.day=1;time.hour=0;time.minute=0;time.second=0;time.isDate=false;this.fromData(data,zone)};ICAL.Time._dowCache={};ICAL.Time._wnCache={};ICAL.Time.prototype={icalclass:'icaltime',_cachedUnixTime:null,get icaltype(){return this.isDate?'date':'date-time'},zone:null,_pendingNormalization:false,clone:function(){return new ICAL.Time(this._time,this.zone)},reset:function icaltime_reset(){this.fromData(ICAL.Time.epochTime);this.zone=ICAL.Timezone.utcTimezone},resetTo:function icaltime_resetTo(year,month,day,hour,minute,second,timezone){this.fromData({year:year,month:month,day:day,hour:hour,minute:minute,second:second,zone:timezone})},fromJSDate:function icaltime_fromJSDate(aDate,useUTC){if(!aDate){this.reset()}else{if(useUTC){this.zone=ICAL.Timezone.utcTimezone;this.year=aDate.getUTCFullYear();this.month=aDate.getUTCMonth()+1;this.day=aDate.getUTCDate();this.hour=aDate.getUTCHours();this.minute=aDate.getUTCMinutes();this.second=aDate.getUTCSeconds()}else{this.zone=ICAL.Timezone.localTimezone;this.year=aDate.getFullYear();this.month=aDate.getMonth()+1;this.day=aDate.getDate();this.hour=aDate.getHours();this.minute=aDate.getMinutes();this.second=aDate.getSeconds()}}this._cachedUnixTime=null;return this},fromData:function fromData(aData,aZone){if(aData){for(var key in aData){if(Object.prototype.hasOwnProperty.call(aData,key)){if(key==='icaltype')continue;this[key]=aData[key]}}}if(aZone){this.zone=aZone}if(aData&&!('isDate'in aData)){this.isDate=!('hour'in aData)}else if(aData&&'isDate'in aData){this.isDate=aData.isDate}if(aData&&'timezone'in aData){var zone=ICAL.TimezoneService.get(aData.timezone);this.zone=zone||ICAL.Timezone.localTimezone}if(aData&&'zone'in aData){this.zone=aData.zone}if(!this.zone){this.zone=ICAL.Timezone.localTimezone}this._cachedUnixTime=null;return this},dayOfWeek:function icaltime_dayOfWeek(){var dowCacheKey=(this.year<<9)+(this.month<<5)+this.day;if(dowCacheKey in ICAL.Time._dowCache){return ICAL.Time._dowCache[dowCacheKey]}var q=this.day;var m=this.month+(this.month<3?12:0);var Y=this.year-(this.month<3?1:0);var h=q+Y+ICAL.helpers.trunc((m+1)*26/10)+ICAL.helpers.trunc(Y/4);if(true){h+=ICAL.helpers.trunc(Y/100)*6+ICAL.helpers.trunc(Y/400)}else{h+=5}h=(h+6)%7+1;ICAL.Time._dowCache[dowCacheKey]=h;return h},dayOfYear:function dayOfYear(){var is_leap=ICAL.Time.isLeapYear(this.year)?1:0;var diypm=ICAL.Time.daysInYearPassedMonth;return diypm[is_leap][this.month-1]+this.day},startOfWeek:function startOfWeek(aWeekStart){var firstDow=aWeekStart||ICAL.Time.SUNDAY;var result=this.clone();result.day-=(this.dayOfWeek()+7-firstDow)%7;result.isDate=true;result.hour=0;result.minute=0;result.second=0;return result},endOfWeek:function endOfWeek(aWeekStart){var firstDow=aWeekStart||ICAL.Time.SUNDAY;var result=this.clone();result.day+=(7-this.dayOfWeek()+firstDow-ICAL.Time.SUNDAY)%7;result.isDate=true;result.hour=0;result.minute=0;result.second=0;return result},startOfMonth:function startOfMonth(){var result=this.clone();result.day=1;result.isDate=true;result.hour=0;result.minute=0;result.second=0;return result},endOfMonth:function endOfMonth(){var result=this.clone();result.day=ICAL.Time.daysInMonth(result.month,result.year);result.isDate=true;result.hour=0;result.minute=0;result.second=0;return result},startOfYear:function startOfYear(){var result=this.clone();result.day=1;result.month=1;result.isDate=true;result.hour=0;result.minute=0;result.second=0;return result},endOfYear:function endOfYear(){var result=this.clone();result.day=31;result.month=12;result.isDate=true;result.hour=0;result.minute=0;result.second=0;return result},startDoyWeek:function startDoyWeek(aFirstDayOfWeek){var firstDow=aFirstDayOfWeek||ICAL.Time.SUNDAY;var delta=this.dayOfWeek()-firstDow;if(delta<0)delta+=7;return this.dayOfYear()-delta},getDominicalLetter:function(){return ICAL.Time.getDominicalLetter(this.year)},nthWeekDay:function icaltime_nthWeekDay(aDayOfWeek,aPos){var daysInMonth=ICAL.Time.daysInMonth(this.month,this.year);var weekday;var pos=aPos;var start=0;var otherDay=this.clone();if(pos>=0){otherDay.day=1;if(pos!=0){pos--}start=otherDay.day;var startDow=otherDay.dayOfWeek();var offset=aDayOfWeek-startDow;if(offset<0)offset+=7;start+=offset;start-=aDayOfWeek;weekday=aDayOfWeek}else{otherDay.day=daysInMonth;var endDow=otherDay.dayOfWeek();pos++;weekday=endDow-aDayOfWeek;if(weekday<0){weekday+=7}weekday=daysInMonth-weekday}weekday+=pos*7;return start+weekday},isNthWeekDay:function(aDayOfWeek,aPos){var dow=this.dayOfWeek();if(aPos===0&&dow===aDayOfWeek){return true}var day=this.nthWeekDay(aDayOfWeek,aPos);if(day===this.day){return true}return false},weekNumber:function weekNumber(aWeekStart){var wnCacheKey=(this.year<<12)+(this.month<<8)+(this.day<<3)+aWeekStart;if(wnCacheKey in ICAL.Time._wnCache){return ICAL.Time._wnCache[wnCacheKey]}var week1;var dt=this.clone();dt.isDate=true;var isoyear=this.year;if(dt.month==12&&dt.day>25){week1=ICAL.Time.weekOneStarts(isoyear+1,aWeekStart);if(dt.compare(week1)<0){week1=ICAL.Time.weekOneStarts(isoyear,aWeekStart)}else{isoyear++}}else{week1=ICAL.Time.weekOneStarts(isoyear,aWeekStart);if(dt.compare(week1)<0){week1=ICAL.Time.weekOneStarts(--isoyear,aWeekStart)}}var daysBetween=dt.subtractDate(week1).toSeconds()/86400;var answer=ICAL.helpers.trunc(daysBetween/7)+1;ICAL.Time._wnCache[wnCacheKey]=answer;return answer},addDuration:function icaltime_add(aDuration){var mult=aDuration.isNegative?-1:1;var second=this.second;var minute=this.minute;var hour=this.hour;var day=this.day;second+=mult*aDuration.seconds;minute+=mult*aDuration.minutes;hour+=mult*aDuration.hours;day+=mult*aDuration.days;day+=mult*7*aDuration.weeks;this.second=second;this.minute=minute;this.hour=hour;this.day=day;this._cachedUnixTime=null},subtractDate:function icaltime_subtract(aDate){var unixTime=this.toUnixTime()+this.utcOffset();var other=aDate.toUnixTime()+aDate.utcOffset();return ICAL.Duration.fromSeconds(unixTime-other)},subtractDateTz:function icaltime_subtract_abs(aDate){var unixTime=this.toUnixTime();var other=aDate.toUnixTime();return ICAL.Duration.fromSeconds(unixTime-other)},compare:function icaltime_compare(other){var a=this.toUnixTime();var b=other.toUnixTime();if(a>b)return 1;if(b>a)return-1;return 0},compareDateOnlyTz:function icaltime_compareDateOnlyTz(other,tz){function cmp(attr){return ICAL.Time._cmp_attr(a,b,attr)}var a=this.convertToZone(tz);var b=other.convertToZone(tz);var rc=0;if((rc=cmp('year'))!=0)return rc;if((rc=cmp('month'))!=0)return rc;if((rc=cmp('day'))!=0)return rc;return rc},convertToZone:function convertToZone(zone){var copy=this.clone();var zone_equals=this.zone.tzid==zone.tzid;if(!this.isDate&&!zone_equals){ICAL.Timezone.convert_time(copy,this.zone,zone)}copy.zone=zone;return copy},utcOffset:function utc_offset(){if(this.zone==ICAL.Timezone.localTimezone||this.zone==ICAL.Timezone.utcTimezone){return 0}else{return this.zone.utcOffset(this)}},toICALString:function(){var string=this.toString();if(string.length>10){return ICAL.design.icalendar.value['date-time'].toICAL(string)}else{return ICAL.design.icalendar.value.date.toICAL(string)}},toString:function toString(){var result=this.year+'-'+ICAL.helpers.pad2(this.month)+'-'+ICAL.helpers.pad2(this.day);if(!this.isDate){result+='T'+ICAL.helpers.pad2(this.hour)+':'+ICAL.helpers.pad2(this.minute)+':'+ICAL.helpers.pad2(this.second);if(this.zone===ICAL.Timezone.utcTimezone){result+='Z'}}return result},toJSDate:function toJSDate(){if(this.zone==ICAL.Timezone.localTimezone){if(this.isDate){return new Date(this.year,this.month-1,this.day)}else{return new Date(this.year,this.month-1,this.day,this.hour,this.minute,this.second,0)}}else{return new Date(this.toUnixTime()*1000)}},_normalize:function icaltime_normalize(){var isDate=this._time.isDate;if(this._time.isDate){this._time.hour=0;this._time.minute=0;this._time.second=0}this.adjust(0,0,0,0);return this},adjust:function icaltime_adjust(aExtraDays,aExtraHours,aExtraMinutes,aExtraSeconds,aTime){var minutesOverflow,hoursOverflow,daysOverflow=0,yearsOverflow=0;var second,minute,hour,day;var daysInMonth;var time=aTime||this._time;if(!time.isDate){second=time.second+aExtraSeconds;time.second=second%60;minutesOverflow=ICAL.helpers.trunc(second/60);if(time.second<0){time.second+=60;minutesOverflow--}minute=time.minute+aExtraMinutes+minutesOverflow;time.minute=minute%60;hoursOverflow=ICAL.helpers.trunc(minute/60);if(time.minute<0){time.minute+=60;hoursOverflow--}hour=time.hour+aExtraHours+hoursOverflow;time.hour=hour%24;daysOverflow=ICAL.helpers.trunc(hour/24);if(time.hour<0){time.hour+=24;daysOverflow--}}if(time.month>12){yearsOverflow=ICAL.helpers.trunc((time.month-1)/12)}else if(time.month<1){yearsOverflow=ICAL.helpers.trunc(time.month/12)-1}time.year+=yearsOverflow;time.month-=12*yearsOverflow;day=time.day+aExtraDays+daysOverflow;if(day>0){for(;;){daysInMonth=ICAL.Time.daysInMonth(time.month,time.year);if(day<=daysInMonth){break}time.month++;if(time.month>12){time.year++;time.month=1}day-=daysInMonth}}else{while(day<=0){if(time.month==1){time.year--;time.month=12}else{time.month--}day+=ICAL.Time.daysInMonth(time.month,time.year)}}time.day=day;this._cachedUnixTime=null;return this},fromUnixTime:function fromUnixTime(seconds){this.zone=ICAL.Timezone.utcTimezone;var epoch=ICAL.Time.epochTime.clone();epoch.adjust(0,0,0,seconds);this.year=epoch.year;this.month=epoch.month;this.day=epoch.day;this.hour=epoch.hour;this.minute=epoch.minute;this.second=Math.floor(epoch.second);this._cachedUnixTime=null},toUnixTime:function toUnixTime(){if(this._cachedUnixTime!==null){return this._cachedUnixTime}var offset=this.utcOffset();var ms=Date.UTC(this.year,this.month-1,this.day,this.hour,this.minute,this.second-offset);this._cachedUnixTime=ms/1000;return this._cachedUnixTime},toJSON:function(){var copy=['year','month','day','hour','minute','second','isDate'];var result=Object.create(null);var i=0;var len=copy.length;var prop;for(;i<len;i++){prop=copy[i];result[prop]=this[prop]}if(this.zone){result.timezone=this.zone.tzid}return result}};(function setupNormalizeAttributes(){function defineAttr(attr){Object.defineProperty(ICAL.Time.prototype,attr,{get:function getTimeAttr(){if(this._pendingNormalization){this._normalize();this._pendingNormalization=false}return this._time[attr]},set:function setTimeAttr(val){this._cachedUnixTime=null;this._pendingNormalization=true;this._time[attr]=val;return val}})}if('defineProperty'in Object){defineAttr('year');defineAttr('month');defineAttr('day');defineAttr('hour');defineAttr('minute');defineAttr('second');defineAttr('isDate')}}());ICAL.Time.daysInMonth=function icaltime_daysInMonth(month,year){var _daysInMonth=[0,31,28,31,30,31,30,31,31,30,31,30,31];var days=30;if(month<1||month>12)return days;days=_daysInMonth[month];if(month==2){days+=ICAL.Time.isLeapYear(year)}return days};ICAL.Time.isLeapYear=function isLeapYear(year){if(year<=1752){return year%4==0}else{return year%4==0&&year%100!=0||year%400==0}};ICAL.Time.fromDayOfYear=function icaltime_fromDayOfYear(aDayOfYear,aYear){var year=aYear;var doy=aDayOfYear;var tt=new ICAL.Time;tt.auto_normalize=false;var is_leap=ICAL.Time.isLeapYear(year)?1:0;if(doy<1){year--;is_leap=ICAL.Time.isLeapYear(year)?1:0;doy+=ICAL.Time.daysInYearPassedMonth[is_leap][12];return ICAL.Time.fromDayOfYear(doy,year)}else if(doy>ICAL.Time.daysInYearPassedMonth[is_leap][12]){is_leap=ICAL.Time.isLeapYear(year)?1:0;doy-=ICAL.Time.daysInYearPassedMonth[is_leap][12];year++;return ICAL.Time.fromDayOfYear(doy,year)}tt.year=year;tt.isDate=true;for(var month=11;month>=0;month--){if(doy>ICAL.Time.daysInYearPassedMonth[is_leap][month]){tt.month=month+1;tt.day=doy-ICAL.Time.daysInYearPassedMonth[is_leap][month];break}}tt.auto_normalize=true;return tt};ICAL.Time.fromStringv2=function fromString(str){return new ICAL.Time({year:parseInt(str.substr(0,4),10),month:parseInt(str.substr(5,2),10),day:parseInt(str.substr(8,2),10),isDate:true})};ICAL.Time.fromDateString=function(aValue){return new ICAL.Time({year:ICAL.helpers.strictParseInt(aValue.substr(0,4)),month:ICAL.helpers.strictParseInt(aValue.substr(5,2)),day:ICAL.helpers.strictParseInt(aValue.substr(8,2)),isDate:true})};ICAL.Time.fromDateTimeString=function(aValue,prop){if(aValue.length<19){throw new Error('invalid date-time value: "'+aValue+'"')}var zone;if(aValue[19]&&aValue[19]==='Z'){zone='Z'}else if(prop){zone=prop.getParameter('tzid')}var time=new ICAL.Time({year:ICAL.helpers.strictParseInt(aValue.substr(0,4)),month:ICAL.helpers.strictParseInt(aValue.substr(5,2)),day:ICAL.helpers.strictParseInt(aValue.substr(8,2)),hour:ICAL.helpers.strictParseInt(aValue.substr(11,2)),minute:ICAL.helpers.strictParseInt(aValue.substr(14,2)),second:ICAL.helpers.strictParseInt(aValue.substr(17,2)),timezone:zone});return time};ICAL.Time.fromString=function fromString(aValue){if(aValue.length>10){return ICAL.Time.fromDateTimeString(aValue)}else{return ICAL.Time.fromDateString(aValue)}};ICAL.Time.fromJSDate=function fromJSDate(aDate,useUTC){var tt=new ICAL.Time;return tt.fromJSDate(aDate,useUTC)};ICAL.Time.fromData=function fromData(aData,aZone){var t=new ICAL.Time;return t.fromData(aData,aZone)};ICAL.Time.now=function icaltime_now(){return ICAL.Time.fromJSDate(new Date,false)};ICAL.Time.weekOneStarts=function weekOneStarts(aYear,aWeekStart){var t=ICAL.Time.fromData({year:aYear,month:1,day:1,isDate:true});var dow=t.dayOfWeek();var wkst=aWeekStart||ICAL.Time.DEFAULT_WEEK_START;if(dow>ICAL.Time.THURSDAY){t.day+=7}if(wkst>ICAL.Time.THURSDAY){t.day-=7}t.day-=dow-wkst;return t};ICAL.Time.getDominicalLetter=function(yr){var LTRS='GFEDCBA';var dom=(yr+(yr/4|0)+(yr/400|0)-(yr/100|0)-1)%7;var isLeap=ICAL.Time.isLeapYear(yr);if(isLeap){return LTRS[(dom+6)%7]+LTRS[dom]}else{return LTRS[dom]}};ICAL.Time.epochTime=ICAL.Time.fromData({year:1970,month:1,day:1,hour:0,minute:0,second:0,isDate:false,timezone:'Z'});ICAL.Time._cmp_attr=function _cmp_attr(a,b,attr){if(a[attr]>b[attr])return 1;if(a[attr]<b[attr])return-1;return 0};ICAL.Time.daysInYearPassedMonth=[[0,31,59,90,120,151,181,212,243,273,304,334,365],[0,31,60,91,121,152,182,213,244,274,305,335,366]];ICAL.Time.SUNDAY=1;ICAL.Time.MONDAY=2;ICAL.Time.TUESDAY=3;ICAL.Time.WEDNESDAY=4;ICAL.Time.THURSDAY=5;ICAL.Time.FRIDAY=6;ICAL.Time.SATURDAY=7;ICAL.Time.DEFAULT_WEEK_START=ICAL.Time.MONDAY}());(function(){ICAL.VCardTime=function(data,zone,icaltype){this.wrappedJSObject=this;var time=this._time=Object.create(null);time.year=null;time.month=null;time.day=null;time.hour=null;time.minute=null;time.second=null;this.icaltype=icaltype||'date-and-or-time';this.fromData(data,zone)};ICAL.helpers.inherits(ICAL.Time,ICAL.VCardTime,{icalclass:'vcardtime',icaltype:'date-and-or-time',zone:null,clone:function(){return new ICAL.VCardTime(this._time,this.zone,this.icaltype)},_normalize:function(){return this},utcOffset:function(){if(this.zone instanceof ICAL.UtcOffset){return this.zone.toSeconds()}else{return ICAL.Time.prototype.utcOffset.apply(this,arguments)}},toICALString:function(){return ICAL.design.vcard.value[this.icaltype].toICAL(this.toString())},toString:function toString(){var p2=ICAL.helpers.pad2;var y=this.year,m=this.month,d=this.day;var h=this.hour,mm=this.minute,s=this.second;var hasYear=y!==null,hasMonth=m!==null,hasDay=d!==null;var hasHour=h!==null,hasMinute=mm!==null,hasSecond=s!==null;var datepart=(hasYear?p2(y)+(hasMonth||hasDay?'-':''):hasMonth||hasDay?'--':'')+(hasMonth?p2(m):'')+(hasDay?'-'+p2(d):'');var timepart=(hasHour?p2(h):'-')+(hasHour&&hasMinute?':':'')+(hasMinute?p2(mm):'')+(!hasHour&&!hasMinute?'-':'')+(hasMinute&&hasSecond?':':'')+(hasSecond?p2(s):'');var zone;if(this.zone===ICAL.Timezone.utcTimezone){zone='Z'}else if(this.zone instanceof ICAL.UtcOffset){zone=this.zone.toString()}else if(this.zone===ICAL.Timezone.localTimezone){zone=''}else if(this.zone instanceof ICAL.Timezone){var offset=ICAL.UtcOffset.fromSeconds(this.zone.utcOffset(this));zone=offset.toString()}else{zone=''}switch(this.icaltype){case'time':return timepart+zone;case'date-and-or-time':case'date-time':return datepart+(timepart=='--'?'':'T'+timepart+zone);case'date':return datepart}return null}});ICAL.VCardTime.fromDateAndOrTimeString=function(aValue,aIcalType){function part(v,s,e){return v?ICAL.helpers.strictParseInt(v.substr(s,e)):null}var parts=aValue.split('T');var dt=parts[0],tmz=parts[1];var splitzone=tmz?ICAL.design.vcard.value.time._splitZone(tmz):[];var zone=splitzone[0],tm=splitzone[1];var stoi=ICAL.helpers.strictParseInt;var dtlen=dt?dt.length:0;var tmlen=tm?tm.length:0;var hasDashDate=dt&&dt[0]=='-'&&dt[1]=='-';var hasDashTime=tm&&tm[0]=='-';var o={year:hasDashDate?null:part(dt,0,4),month:hasDashDate&&(dtlen==4||dtlen==7)?part(dt,2,2):dtlen==7?part(dt,5,2):dtlen==10?part(dt,5,2):null,day:dtlen==5?part(dt,3,2):dtlen==7&&hasDashDate?part(dt,5,2):dtlen==10?part(dt,8,2):null,hour:hasDashTime?null:part(tm,0,2),minute:hasDashTime&&tmlen==3?part(tm,1,2):tmlen>4?hasDashTime?part(tm,1,2):part(tm,3,2):null,second:tmlen==4?part(tm,2,2):tmlen==6?part(tm,4,2):tmlen==8?part(tm,6,2):null};if(zone=='Z'){zone=ICAL.Timezone.utcTimezone}else if(zone&&zone[3]==':'){zone=ICAL.UtcOffset.fromString(zone)}else{zone=null}return new ICAL.VCardTime(o,zone,aIcalType)}}());(function(){var DOW_MAP={SU:ICAL.Time.SUNDAY,MO:ICAL.Time.MONDAY,TU:ICAL.Time.TUESDAY,WE:ICAL.Time.WEDNESDAY,TH:ICAL.Time.THURSDAY,FR:ICAL.Time.FRIDAY,SA:ICAL.Time.SATURDAY};var REVERSE_DOW_MAP={};for(var key in DOW_MAP){if(DOW_MAP.hasOwnProperty(key)){REVERSE_DOW_MAP[DOW_MAP[key]]=key}}var COPY_PARTS=['BYSECOND','BYMINUTE','BYHOUR','BYDAY','BYMONTHDAY','BYYEARDAY','BYWEEKNO','BYMONTH','BYSETPOS'];ICAL.Recur=function icalrecur(data){this.wrappedJSObject=this;this.parts={};if(data&&typeof data==='object'){this.fromData(data)}};ICAL.Recur.prototype={parts:null,interval:1,wkst:ICAL.Time.MONDAY,until:null,count:null,freq:null,icalclass:'icalrecur',icaltype:'recur',iterator:function(aStart){return new ICAL.RecurIterator({rule:this,dtstart:aStart})},clone:function clone(){return new ICAL.Recur(this.toJSON())},isFinite:function isfinite(){return!!(this.count||this.until)},isByCount:function isbycount(){return!!(this.count&&!this.until)},addComponent:function addPart(aType,aValue){var ucname=aType.toUpperCase();if(ucname in this.parts){this.parts[ucname].push(aValue)}else{this.parts[ucname]=[aValue]}},setComponent:function setComponent(aType,aValues){this.parts[aType.toUpperCase()]=aValues.slice()},getComponent:function getComponent(aType){var ucname=aType.toUpperCase();return ucname in this.parts?this.parts[ucname].slice():[]},getNextOccurrence:function getNextOccurrence(aStartTime,aRecurrenceId){var iter=this.iterator(aStartTime);var next,cdt;do{next=iter.next()}while(next&&next.compare(aRecurrenceId)<=0);if(next&&aRecurrenceId.zone){next.zone=aRecurrenceId.zone}return next},fromData:function(data){for(var key in data){var uckey=key.toUpperCase();if(uckey in partDesign){if(Array.isArray(data[key])){this.parts[uckey]=data[key]}else{this.parts[uckey]=[data[key]]}}else{this[key]=data[key]}}if(this.wkst&&typeof this.wkst!='number'){this.wkst=ICAL.Recur.icalDayToNumericDay(this.wkst)}if(this.until&&!(this.until instanceof ICAL.Time)){this.until=ICAL.Time.fromString(this.until)}},toJSON:function(){var res=Object.create(null);res.freq=this.freq;if(this.count){res.count=this.count}if(this.interval>1){res.interval=this.interval}for(var k in this.parts){if(!this.parts.hasOwnProperty(k)){continue}var kparts=this.parts[k];if(Array.isArray(kparts)&&kparts.length==1){res[k.toLowerCase()]=kparts[0]}else{res[k.toLowerCase()]=ICAL.helpers.clone(this.parts[k])}}if(this.until){res.until=this.until.toString()}if('wkst'in this&&this.wkst!==ICAL.Time.DEFAULT_WEEK_START){res.wkst=ICAL.Recur.numericDayToIcalDay(this.wkst)}return res},toString:function icalrecur_toString(){var str='FREQ='+this.freq;if(this.count){str+=';COUNT='+this.count}if(this.interval>1){str+=';INTERVAL='+this.interval}for(var k in this.parts){if(this.parts.hasOwnProperty(k)){str+=';'+k+'='+this.parts[k]}}if(this.until){str+=';UNTIL='+this.until.toString()}if('wkst'in this&&this.wkst!==ICAL.Time.DEFAULT_WEEK_START){str+=';WKST='+ICAL.Recur.numericDayToIcalDay(this.wkst)}return str}};function parseNumericValue(type,min,max,value){var result=value;if(value[0]==='+'){result=value.substr(1)}result=ICAL.helpers.strictParseInt(result);if(min!==undefined&&value<min){throw new Error(type+': invalid value "'+value+'" must be > '+min)}if(max!==undefined&&value>max){throw new Error(type+': invalid value "'+value+'" must be < '+min)}return result}ICAL.Recur.icalDayToNumericDay=function toNumericDay(string){return DOW_MAP[string]};ICAL.Recur.numericDayToIcalDay=function toIcalDay(num){return REVERSE_DOW_MAP[num]};var VALID_DAY_NAMES=/^(SU|MO|TU|WE|TH|FR|SA)$/;var VALID_BYDAY_PART=/^([+-])?(5[0-3]|[1-4][0-9]|[1-9])?(SU|MO|TU|WE|TH|FR|SA)$/;var ALLOWED_FREQ=['SECONDLY','MINUTELY','HOURLY','DAILY','WEEKLY','MONTHLY','YEARLY'];var optionDesign={FREQ:function(value,dict,fmtIcal){if(ALLOWED_FREQ.indexOf(value)!==-1){dict.freq=value}else{throw new Error('invalid frequency "'+value+'" expected: "'+ALLOWED_FREQ.join(', ')+'"')}},COUNT:function(value,dict,fmtIcal){dict.count=ICAL.helpers.strictParseInt(value)},INTERVAL:function(value,dict,fmtIcal){dict.interval=ICAL.helpers.strictParseInt(value);if(dict.interval<1){dict.interval=1}},UNTIL:function(value,dict,fmtIcal){if(fmtIcal){if(value.length>10){dict.until=ICAL.design.icalendar.value['date-time'].fromICAL(value)}else{dict.until=ICAL.design.icalendar.value.date.fromICAL(value)}}else{dict.until=ICAL.Time.fromString(value)}},WKST:function(value,dict,fmtIcal){if(VALID_DAY_NAMES.test(value)){dict.wkst=ICAL.Recur.icalDayToNumericDay(value)}else{throw new Error('invalid WKST value "'+value+'"')}}};var partDesign={BYSECOND:parseNumericValue.bind(this,'BYSECOND',0,60),BYMINUTE:parseNumericValue.bind(this,'BYMINUTE',0,59),BYHOUR:parseNumericValue.bind(this,'BYHOUR',0,23),BYDAY:function(value){if(VALID_BYDAY_PART.test(value)){return value}else{throw new Error('invalid BYDAY value "'+value+'"')}},BYMONTHDAY:parseNumericValue.bind(this,'BYMONTHDAY',-31,31),BYYEARDAY:parseNumericValue.bind(this,'BYYEARDAY',-366,366),BYWEEKNO:parseNumericValue.bind(this,'BYWEEKNO',-53,53),BYMONTH:parseNumericValue.bind(this,'BYMONTH',0,12),BYSETPOS:parseNumericValue.bind(this,'BYSETPOS',-366,366)};ICAL.Recur.fromString=function(string){var data=ICAL.Recur._stringToData(string,false);return new ICAL.Recur(data)};ICAL.Recur.fromData=function(aData){return new ICAL.Recur(aData)};ICAL.Recur._stringToData=function(string,fmtIcal){var dict=Object.create(null);var values=string.split(';');var len=values.length;for(var i=0;i<len;i++){var parts=values[i].split('=');var ucname=parts[0].toUpperCase();var lcname=parts[0].toLowerCase();var name=fmtIcal?lcname:ucname;var value=parts[1];if(ucname in partDesign){var partArr=value.split(',');var partArrIdx=0;var partArrLen=partArr.length;for(;partArrIdx<partArrLen;partArrIdx++){partArr[partArrIdx]=partDesign[ucname](partArr[partArrIdx])}dict[name]=partArr.length==1?partArr[0]:partArr}else if(ucname in optionDesign){optionDesign[ucname](value,dict,fmtIcal)}else{dict[lcname]=value}}return dict}}());ICAL.RecurIterator=function(){function icalrecur_iterator(options){this.fromData(options)}icalrecur_iterator.prototype={completed:false,rule:null,dtstart:null,last:null,occurrence_number:0,by_indices:null,initialized:false,by_data:null,days:null,days_index:0,fromData:function(options){this.rule=ICAL.helpers.formatClassType(options.rule,ICAL.Recur);if(!this.rule){throw new Error('iterator requires a (ICAL.Recur) rule')}this.dtstart=ICAL.helpers.formatClassType(options.dtstart,ICAL.Time);if(!this.dtstart){throw new Error('iterator requires a (ICAL.Time) dtstart')}if(options.by_data){this.by_data=options.by_data}else{this.by_data=ICAL.helpers.clone(this.rule.parts,true)}if(options.occurrence_number)this.occurrence_number=options.occurrence_number;this.days=options.days||[];if(options.last){this.last=ICAL.helpers.formatClassType(options.last,ICAL.Time)}this.by_indices=options.by_indices;if(!this.by_indices){this.by_indices={'BYSECOND':0,'BYMINUTE':0,'BYHOUR':0,'BYDAY':0,'BYMONTH':0,'BYWEEKNO':0,'BYMONTHDAY':0}}this.initialized=options.initialized||false;if(!this.initialized){this.init()}},init:function icalrecur_iterator_init(){this.initialized=true;this.last=this.dtstart.clone();var parts=this.by_data;if('BYDAY'in parts){this.sort_byday_rules(parts.BYDAY,this.rule.wkst)}if('BYYEARDAY'in parts){if('BYMONTH'in parts||'BYWEEKNO'in parts||'BYMONTHDAY'in parts||'BYDAY'in parts){throw new Error('Invalid BYYEARDAY rule')}}if('BYWEEKNO'in parts&&'BYMONTHDAY'in parts){throw new Error('BYWEEKNO does not fit to BYMONTHDAY')}if(this.rule.freq=='MONTHLY'&&('BYYEARDAY'in parts||'BYWEEKNO'in parts)){throw new Error('For MONTHLY recurrences neither BYYEARDAY nor BYWEEKNO may appear')}if(this.rule.freq=='WEEKLY'&&('BYYEARDAY'in parts||'BYMONTHDAY'in parts)){throw new Error('For WEEKLY recurrences neither BYMONTHDAY nor BYYEARDAY may appear')}if(this.rule.freq!='YEARLY'&&'BYYEARDAY'in parts){throw new Error('BYYEARDAY may only appear in YEARLY rules')}this.last.second=this.setup_defaults('BYSECOND','SECONDLY',this.dtstart.second);this.last.minute=this.setup_defaults('BYMINUTE','MINUTELY',this.dtstart.minute);this.last.hour=this.setup_defaults('BYHOUR','HOURLY',this.dtstart.hour);this.last.day=this.setup_defaults('BYMONTHDAY','DAILY',this.dtstart.day);this.last.month=this.setup_defaults('BYMONTH','MONTHLY',this.dtstart.month);if(this.rule.freq=='WEEKLY'){if('BYDAY'in parts){var bydayParts=this.ruleDayOfWeek(parts.BYDAY[0]);var pos=bydayParts[0];var dow=bydayParts[1];var wkdy=dow-this.last.dayOfWeek();if(this.last.dayOfWeek()<dow&&wkdy>=0||wkdy<0){this.last.day+=wkdy}}else{var dayName=ICAL.Recur.numericDayToIcalDay(this.dtstart.dayOfWeek());parts.BYDAY=[dayName]}}if(this.rule.freq=='YEARLY'){for(;;){this.expand_year_days(this.last.year);if(this.days.length>0){break}this.increment_year(this.rule.interval)}this._nextByYearDay()}if(this.rule.freq=='MONTHLY'&&this.has_by_data('BYDAY')){var tempLast=null;var initLast=this.last.clone();var daysInMonth=ICAL.Time.daysInMonth(this.last.month,this.last.year);for(var i in this.by_data.BYDAY){if(!this.by_data.BYDAY.hasOwnProperty(i)){continue}this.last=initLast.clone();var bydayParts=this.ruleDayOfWeek(this.by_data.BYDAY[i]);var pos=bydayParts[0];var dow=bydayParts[1];var dayOfMonth=this.last.nthWeekDay(dow,pos);if(pos>=6||pos<=-6){throw new Error('Malformed values in BYDAY part')}if(dayOfMonth>daysInMonth||dayOfMonth<=0){if(tempLast&&tempLast.month==initLast.month){continue}while(dayOfMonth>daysInMonth||dayOfMonth<=0){this.increment_month();daysInMonth=ICAL.Time.daysInMonth(this.last.month,this.last.year);dayOfMonth=this.last.nthWeekDay(dow,pos)}}this.last.day=dayOfMonth;if(!tempLast||this.last.compare(tempLast)<0){tempLast=this.last.clone()}}this.last=tempLast.clone();if(this.has_by_data('BYMONTHDAY')){this._byDayAndMonthDay(true)}if(this.last.day>daysInMonth||this.last.day==0){throw new Error('Malformed values in BYDAY part')}}else if(this.has_by_data('BYMONTHDAY')){if(this.last.day<0){var daysInMonth=ICAL.Time.daysInMonth(this.last.month,this.last.year);this.last.day=daysInMonth+this.last.day+1}}},next:function icalrecur_iterator_next(){var before=this.last?this.last.clone():null;if(this.rule.count&&this.occurrence_number>=this.rule.count||this.rule.until&&this.last.compare(this.rule.until)>0){this.completed=true;return null}if(this.occurrence_number==0&&this.last.compare(this.dtstart)>=0){this.occurrence_number++;return this.last}var valid;do{valid=1;switch(this.rule.freq){case'SECONDLY':this.next_second();break;case'MINUTELY':this.next_minute();break;case'HOURLY':this.next_hour();break;case'DAILY':this.next_day();break;case'WEEKLY':this.next_week();break;case'MONTHLY':valid=this.next_month();break;case'YEARLY':this.next_year();break;default:return null}}while(!this.check_contracting_rules()||this.last.compare(this.dtstart)<0||!valid);if(this.last.compare(before)==0){throw new Error('Same occurrence found twice, protecting '+'you from death by recursion')}if(this.rule.until&&this.last.compare(this.rule.until)>0){this.completed=true;return null}else{this.occurrence_number++;return this.last}},next_second:function next_second(){return this.next_generic('BYSECOND','SECONDLY','second','minute')},increment_second:function increment_second(inc){return this.increment_generic(inc,'second',60,'minute')},next_minute:function next_minute(){return this.next_generic('BYMINUTE','MINUTELY','minute','hour','next_second')},increment_minute:function increment_minute(inc){return this.increment_generic(inc,'minute',60,'hour')},next_hour:function next_hour(){return this.next_generic('BYHOUR','HOURLY','hour','monthday','next_minute')},increment_hour:function increment_hour(inc){this.increment_generic(inc,'hour',24,'monthday')},next_day:function next_day(){var has_by_day='BYDAY'in this.by_data;var this_freq=this.rule.freq=='DAILY';if(this.next_hour()==0){return 0}if(this_freq){this.increment_monthday(this.rule.interval)}else{this.increment_monthday(1)}return 0},next_week:function next_week(){var end_of_data=0;if(this.next_weekday_by_week()==0){return end_of_data}if(this.has_by_data('BYWEEKNO')){var idx=++this.by_indices.BYWEEKNO;if(this.by_indices.BYWEEKNO==this.by_data.BYWEEKNO.length){this.by_indices.BYWEEKNO=0;end_of_data=1}this.last.month=1;this.last.day=1;var week_no=this.by_data.BYWEEKNO[this.by_indices.BYWEEKNO];this.last.day+=7*week_no;if(end_of_data){this.increment_year(1)}}else{this.increment_monthday(7*this.rule.interval)}return end_of_data},normalizeByMonthDayRules:function(year,month,rules){var daysInMonth=ICAL.Time.daysInMonth(month,year);var newRules=[];var ruleIdx=0;var len=rules.length;var rule;for(;ruleIdx<len;ruleIdx++){rule=rules[ruleIdx];if(Math.abs(rule)>daysInMonth){continue}if(rule<0){rule=daysInMonth+(rule+1)}else if(rule===0){continue}if(newRules.indexOf(rule)===-1){newRules.push(rule)}}return newRules.sort(function(a,b){return a-b})},_byDayAndMonthDay:function(isInit){var byMonthDay;var byDay=this.by_data.BYDAY;var date;var dateIdx=0;var dateLen;var dayLen=byDay.length;var dataIsValid=0;var daysInMonth;var self=this;var lastDay=this.last.day;function initMonth(){daysInMonth=ICAL.Time.daysInMonth(self.last.month,self.last.year);byMonthDay=self.normalizeByMonthDayRules(self.last.year,self.last.month,self.by_data.BYMONTHDAY);dateLen=byMonthDay.length;while(byMonthDay[dateIdx]<=lastDay&&!(isInit&&byMonthDay[dateIdx]==lastDay)&&dateIdx<dateLen-1){dateIdx++}}function nextMonth(){lastDay=0;self.increment_month();dateIdx=0;initMonth()}initMonth();if(isInit){lastDay-=1}var monthsCounter=48;while(!dataIsValid&&monthsCounter){monthsCounter--;date=lastDay+1;if(date>daysInMonth){nextMonth();continue}var next=byMonthDay[dateIdx++];if(next>=date){lastDay=next}else{nextMonth();continue}for(var dayIdx=0;dayIdx<dayLen;dayIdx++){var parts=this.ruleDayOfWeek(byDay[dayIdx]);var pos=parts[0];var dow=parts[1];this.last.day=lastDay;if(this.last.isNthWeekDay(dow,pos)){dataIsValid=1;break}}if(!dataIsValid&&dateIdx===dateLen){nextMonth();continue}}if(monthsCounter<=0){throw new Error('Malformed values in BYDAY combined with BYMONTHDAY parts')}return dataIsValid},next_month:function next_month(){var this_freq=this.rule.freq=='MONTHLY';var data_valid=1;if(this.next_hour()==0){return data_valid}if(this.has_by_data('BYDAY')&&this.has_by_data('BYMONTHDAY')){data_valid=this._byDayAndMonthDay()}else if(this.has_by_data('BYDAY')){var daysInMonth=ICAL.Time.daysInMonth(this.last.month,this.last.year);var setpos=0;var setpos_total=0;if(this.has_by_data('BYSETPOS')){var last_day=this.last.day;for(var day=1;day<=daysInMonth;day++){this.last.day=day;if(this.is_day_in_byday(this.last)){setpos_total++;if(day<=last_day){setpos++}}}this.last.day=last_day}data_valid=0;for(var day=this.last.day+1;day<=daysInMonth;day++){this.last.day=day;if(this.is_day_in_byday(this.last)){if(!this.has_by_data('BYSETPOS')||this.check_set_position(++setpos)||this.check_set_position(setpos-setpos_total-1)){data_valid=1;break}}}if(day>daysInMonth){this.last.day=1;this.increment_month();if(this.is_day_in_byday(this.last)){if(!this.has_by_data('BYSETPOS')||this.check_set_position(1)){data_valid=1}}else{data_valid=0}}}else if(this.has_by_data('BYMONTHDAY')){this.by_indices.BYMONTHDAY++;if(this.by_indices.BYMONTHDAY>=this.by_data.BYMONTHDAY.length){this.by_indices.BYMONTHDAY=0;this.increment_month()}var daysInMonth=ICAL.Time.daysInMonth(this.last.month,this.last.year);var day=this.by_data.BYMONTHDAY[this.by_indices.BYMONTHDAY];if(day<0){day=daysInMonth+day+1}if(day>daysInMonth){this.last.day=1;data_valid=this.is_day_in_byday(this.last)}else{this.last.day=day}}else{this.increment_month();var daysInMonth=ICAL.Time.daysInMonth(this.last.month,this.last.year);if(this.by_data.BYMONTHDAY[0]>daysInMonth){data_valid=0}else{this.last.day=this.by_data.BYMONTHDAY[0]}}return data_valid},next_weekday_by_week:function next_weekday_by_week(){var end_of_data=0;if(this.next_hour()==0){return end_of_data}if(!this.has_by_data('BYDAY')){return 1}for(;;){var tt=new ICAL.Time;this.by_indices.BYDAY++;if(this.by_indices.BYDAY==Object.keys(this.by_data.BYDAY).length){this.by_indices.BYDAY=0;end_of_data=1}var coded_day=this.by_data.BYDAY[this.by_indices.BYDAY];var parts=this.ruleDayOfWeek(coded_day);var dow=parts[1];dow-=this.rule.wkst;if(dow<0){dow+=7}tt.year=this.last.year;tt.month=this.last.month;tt.day=this.last.day;var startOfWeek=tt.startDoyWeek(this.rule.wkst);if(dow+startOfWeek<1){if(!end_of_data){continue}}var next=ICAL.Time.fromDayOfYear(startOfWeek+dow,this.last.year);this.last.year=next.year;this.last.month=next.month;this.last.day=next.day;return end_of_data}},next_year:function next_year(){if(this.next_hour()==0){return 0}if(++this.days_index==this.days.length){this.days_index=0;do{this.increment_year(this.rule.interval);this.expand_year_days(this.last.year)}while(this.days.length==0)}this._nextByYearDay();return 1},_nextByYearDay:function _nextByYearDay(){var doy=this.days[this.days_index];var year=this.last.year;if(doy<1){doy+=1;year+=1}var next=ICAL.Time.fromDayOfYear(doy,year);this.last.day=next.day;this.last.month=next.month},ruleDayOfWeek:function ruleDayOfWeek(dow){var matches=dow.match(/([+-]?[0-9])?(MO|TU|WE|TH|FR|SA|SU)/);if(matches){var pos=parseInt(matches[1]||0,10);dow=ICAL.Recur.icalDayToNumericDay(matches[2]);return[pos,dow]}else{return[0,0]}},next_generic:function next_generic(aRuleType,aInterval,aDateAttr,aFollowingAttr,aPreviousIncr){var has_by_rule=aRuleType in this.by_data;var this_freq=this.rule.freq==aInterval;var end_of_data=0;if(aPreviousIncr&&this[aPreviousIncr]()==0){return end_of_data}if(has_by_rule){this.by_indices[aRuleType]++;var idx=this.by_indices[aRuleType];var dta=this.by_data[aRuleType];if(this.by_indices[aRuleType]==dta.length){this.by_indices[aRuleType]=0;end_of_data=1}this.last[aDateAttr]=dta[this.by_indices[aRuleType]]}else if(this_freq){this['increment_'+aDateAttr](this.rule.interval)}if(has_by_rule&&end_of_data&&this_freq){this['increment_'+aFollowingAttr](1)}return end_of_data},increment_monthday:function increment_monthday(inc){for(var i=0;i<inc;i++){var daysInMonth=ICAL.Time.daysInMonth(this.last.month,this.last.year);this.last.day++;if(this.last.day>daysInMonth){this.last.day-=daysInMonth;this.increment_month()}}},increment_month:function increment_month(){this.last.day=1;if(this.has_by_data('BYMONTH')){this.by_indices.BYMONTH++;if(this.by_indices.BYMONTH==this.by_data.BYMONTH.length){this.by_indices.BYMONTH=0;this.increment_year(1)}this.last.month=this.by_data.BYMONTH[this.by_indices.BYMONTH]}else{if(this.rule.freq=='MONTHLY'){this.last.month+=this.rule.interval}else{this.last.month++}this.last.month--;var years=ICAL.helpers.trunc(this.last.month/12);this.last.month%=12;this.last.month++;if(years!=0){this.increment_year(years)}}},increment_year:function increment_year(inc){this.last.year+=inc},increment_generic:function increment_generic(inc,aDateAttr,aFactor,aNextIncrement){this.last[aDateAttr]+=inc;var nextunit=ICAL.helpers.trunc(this.last[aDateAttr]/aFactor);this.last[aDateAttr]%=aFactor;if(nextunit!=0){this['increment_'+aNextIncrement](nextunit)}},has_by_data:function has_by_data(aRuleType){return aRuleType in this.rule.parts},expand_year_days:function expand_year_days(aYear){var t=new ICAL.Time;this.days=[];var parts={};var rules=['BYDAY','BYWEEKNO','BYMONTHDAY','BYMONTH','BYYEARDAY'];for(var p in rules){if(rules.hasOwnProperty(p)){var part=rules[p];if(part in this.rule.parts){parts[part]=this.rule.parts[part]}}}if('BYMONTH'in parts&&'BYWEEKNO'in parts){var valid=1;var validWeeks={};t.year=aYear;t.isDate=true;for(var monthIdx=0;monthIdx<this.by_data.BYMONTH.length;monthIdx++){var month=this.by_data.BYMONTH[monthIdx];t.month=month;t.day=1;var first_week=t.weekNumber(this.rule.wkst);t.day=ICAL.Time.daysInMonth(month,aYear);var last_week=t.weekNumber(this.rule.wkst);for(monthIdx=first_week;monthIdx<last_week;monthIdx++){validWeeks[monthIdx]=1}}for(var weekIdx=0;weekIdx<this.by_data.BYWEEKNO.length&&valid;weekIdx++){var weekno=this.by_data.BYWEEKNO[weekIdx];if(weekno<52){valid&=validWeeks[weekIdx]}else{valid=0}}if(valid){delete parts.BYMONTH}else{delete parts.BYWEEKNO}}var partCount=Object.keys(parts).length;if(partCount==0){var t1=this.dtstart.clone();t1.year=this.last.year;this.days.push(t1.dayOfYear())}else if(partCount==1&&'BYMONTH'in parts){for(var monthkey in this.by_data.BYMONTH){if(!this.by_data.BYMONTH.hasOwnProperty(monthkey)){continue}var t2=this.dtstart.clone();t2.year=aYear;t2.month=this.by_data.BYMONTH[monthkey];t2.isDate=true;this.days.push(t2.dayOfYear())}}else if(partCount==1&&'BYMONTHDAY'in parts){for(var monthdaykey in this.by_data.BYMONTHDAY){if(!this.by_data.BYMONTHDAY.hasOwnProperty(monthdaykey)){continue}var t3=this.dtstart.clone();var day_=this.by_data.BYMONTHDAY[monthdaykey];if(day_<0){var daysInMonth=ICAL.Time.daysInMonth(t3.month,aYear);day_=day_+daysInMonth+1}t3.day=day_;t3.year=aYear;t3.isDate=true;this.days.push(t3.dayOfYear())}}else if(partCount==2&&'BYMONTHDAY'in parts&&'BYMONTH'in parts){for(var monthkey in this.by_data.BYMONTH){if(!this.by_data.BYMONTH.hasOwnProperty(monthkey)){continue}var month_=this.by_data.BYMONTH[monthkey];var daysInMonth=ICAL.Time.daysInMonth(month_,aYear);for(var monthdaykey in this.by_data.BYMONTHDAY){if(!this.by_data.BYMONTHDAY.hasOwnProperty(monthdaykey)){continue}var day_=this.by_data.BYMONTHDAY[monthdaykey];if(day_<0){day_=day_+daysInMonth+1}t.day=day_;t.month=month_;t.year=aYear;t.isDate=true;this.days.push(t.dayOfYear())}}}else if(partCount==1&&'BYWEEKNO'in parts){}else if(partCount==2&&'BYWEEKNO'in parts&&'BYMONTHDAY'in parts){}else if(partCount==1&&'BYDAY'in parts){this.days=this.days.concat(this.expand_by_day(aYear))}else if(partCount==2&&'BYDAY'in parts&&'BYMONTH'in parts){for(var monthkey in this.by_data.BYMONTH){if(!this.by_data.BYMONTH.hasOwnProperty(monthkey)){continue}var month=this.by_data.BYMONTH[monthkey];var daysInMonth=ICAL.Time.daysInMonth(month,aYear);t.year=aYear;t.month=this.by_data.BYMONTH[monthkey];t.day=1;t.isDate=true;var first_dow=t.dayOfWeek();var doy_offset=t.dayOfYear()-1;t.day=daysInMonth;var last_dow=t.dayOfWeek();if(this.has_by_data('BYSETPOS')){var set_pos_counter=0;var by_month_day=[];for(var day=1;day<=daysInMonth;day++){t.day=day;if(this.is_day_in_byday(t)){by_month_day.push(day)}}for(var spIndex=0;spIndex<by_month_day.length;spIndex++){if(this.check_set_position(spIndex+1)||this.check_set_position(spIndex-by_month_day.length)){this.days.push(doy_offset+by_month_day[spIndex])}}}else{for(var daycodedkey in this.by_data.BYDAY){if(!this.by_data.BYDAY.hasOwnProperty(daycodedkey)){continue}var coded_day=this.by_data.BYDAY[daycodedkey];var bydayParts=this.ruleDayOfWeek(coded_day);var pos=bydayParts[0];var dow=bydayParts[1];var month_day;var first_matching_day=(dow+7-first_dow)%7+1;var last_matching_day=daysInMonth-(last_dow+7-dow)%7;if(pos==0){for(var day=first_matching_day;day<=daysInMonth;day+=7){this.days.push(doy_offset+day)}}else if(pos>0){month_day=first_matching_day+(pos-1)*7;if(month_day<=daysInMonth){this.days.push(doy_offset+month_day)}}else{month_day=last_matching_day+(pos+1)*7;if(month_day>0){this.days.push(doy_offset+month_day)}}}}}this.days.sort(function(a,b){return a-b})}else if(partCount==2&&'BYDAY'in parts&&'BYMONTHDAY'in parts){var expandedDays=this.expand_by_day(aYear);for(var daykey in expandedDays){if(!expandedDays.hasOwnProperty(daykey)){continue}var day=expandedDays[daykey];var tt=ICAL.Time.fromDayOfYear(day,aYear);if(this.by_data.BYMONTHDAY.indexOf(tt.day)>=0){this.days.push(day)}}}else if(partCount==3&&'BYDAY'in parts&&'BYMONTHDAY'in parts&&'BYMONTH'in parts){var expandedDays=this.expand_by_day(aYear);for(var daykey in expandedDays){if(!expandedDays.hasOwnProperty(daykey)){continue}var day=expandedDays[daykey];var tt=ICAL.Time.fromDayOfYear(day,aYear);if(this.by_data.BYMONTH.indexOf(tt.month)>=0&&this.by_data.BYMONTHDAY.indexOf(tt.day)>=0){this.days.push(day)}}}else if(partCount==2&&'BYDAY'in parts&&'BYWEEKNO'in parts){var expandedDays=this.expand_by_day(aYear);for(var daykey in expandedDays){if(!expandedDays.hasOwnProperty(daykey)){continue}var day=expandedDays[daykey];var tt=ICAL.Time.fromDayOfYear(day,aYear);var weekno=tt.weekNumber(this.rule.wkst);if(this.by_data.BYWEEKNO.indexOf(weekno)){this.days.push(day)}}}else if(partCount==3&&'BYDAY'in parts&&'BYWEEKNO'in parts&&'BYMONTHDAY'in parts){}else if(partCount==1&&'BYYEARDAY'in parts){this.days=this.days.concat(this.by_data.BYYEARDAY)}else{this.days=[]}return 0},expand_by_day:function expand_by_day(aYear){var days_list=[];var tmp=this.last.clone();tmp.year=aYear;tmp.month=1;tmp.day=1;tmp.isDate=true;var start_dow=tmp.dayOfWeek();tmp.month=12;tmp.day=31;tmp.isDate=true;var end_dow=tmp.dayOfWeek();var end_year_day=tmp.dayOfYear();for(var daykey in this.by_data.BYDAY){if(!this.by_data.BYDAY.hasOwnProperty(daykey)){continue}var day=this.by_data.BYDAY[daykey];var parts=this.ruleDayOfWeek(day);var pos=parts[0];var dow=parts[1];if(pos==0){var tmp_start_doy=(dow+7-start_dow)%7+1;for(var doy=tmp_start_doy;doy<=end_year_day;doy+=7){days_list.push(doy)}}else if(pos>0){var first;if(dow>=start_dow){first=dow-start_dow+1}else{first=dow-start_dow+8}days_list.push(first+(pos-1)*7)}else{var last;pos=-pos;if(dow<=end_dow){last=end_year_day-end_dow+dow}else{last=end_year_day-end_dow+dow-7}days_list.push(last-(pos-1)*7)}}return days_list},is_day_in_byday:function is_day_in_byday(tt){for(var daykey in this.by_data.BYDAY){if(!this.by_data.BYDAY.hasOwnProperty(daykey)){continue}var day=this.by_data.BYDAY[daykey];var parts=this.ruleDayOfWeek(day);var pos=parts[0];var dow=parts[1];var this_dow=tt.dayOfWeek();if(pos==0&&dow==this_dow||tt.nthWeekDay(dow,pos)==tt.day){return 1}}return 0},check_set_position:function check_set_position(aPos){if(this.has_by_data('BYSETPOS')){var idx=this.by_data.BYSETPOS.indexOf(aPos);return idx!==-1}return false},sort_byday_rules:function icalrecur_sort_byday_rules(aRules,aWeekStart){for(var i=0;i<aRules.length;i++){for(var j=0;j<i;j++){var one=this.ruleDayOfWeek(aRules[j])[1];var two=this.ruleDayOfWeek(aRules[i])[1];one-=aWeekStart;two-=aWeekStart;if(one<0)one+=7;if(two<0)two+=7;if(one>two){var tmp=aRules[i];aRules[i]=aRules[j];aRules[j]=tmp}}}},check_contract_restriction:function check_contract_restriction(aRuleType,v){var indexMapValue=icalrecur_iterator._indexMap[aRuleType];var ruleMapValue=icalrecur_iterator._expandMap[this.rule.freq][indexMapValue];var pass=false;if(aRuleType in this.by_data&&ruleMapValue==icalrecur_iterator.CONTRACT){var ruleType=this.by_data[aRuleType];for(var bydatakey in ruleType){if(ruleType.hasOwnProperty(bydatakey)){if(ruleType[bydatakey]==v){pass=true;break}}}}else{pass=true}return pass},check_contracting_rules:function check_contracting_rules(){var dow=this.last.dayOfWeek();var weekNo=this.last.weekNumber(this.rule.wkst);var doy=this.last.dayOfYear();return this.check_contract_restriction('BYSECOND',this.last.second)&&this.check_contract_restriction('BYMINUTE',this.last.minute)&&this.check_contract_restriction('BYHOUR',this.last.hour)&&this.check_contract_restriction('BYDAY',ICAL.Recur.numericDayToIcalDay(dow))&&this.check_contract_restriction('BYWEEKNO',weekNo)&&this.check_contract_restriction('BYMONTHDAY',this.last.day)&&this.check_contract_restriction('BYMONTH',this.last.month)&&this.check_contract_restriction('BYYEARDAY',doy)},setup_defaults:function setup_defaults(aRuleType,req,deftime){var indexMapValue=icalrecur_iterator._indexMap[aRuleType];var ruleMapValue=icalrecur_iterator._expandMap[this.rule.freq][indexMapValue];if(ruleMapValue!=icalrecur_iterator.CONTRACT){if(!(aRuleType in this.by_data)){this.by_data[aRuleType]=[deftime]}if(this.rule.freq!=req){return this.by_data[aRuleType][0]}}return deftime},toJSON:function(){var result=Object.create(null);result.initialized=this.initialized;result.rule=this.rule.toJSON();result.dtstart=this.dtstart.toJSON();result.by_data=this.by_data;result.days=this.days;result.last=this.last.toJSON();result.by_indices=this.by_indices;result.occurrence_number=this.occurrence_number;return result}};icalrecur_iterator._indexMap={'BYSECOND':0,'BYMINUTE':1,'BYHOUR':2,'BYDAY':3,'BYMONTHDAY':4,'BYYEARDAY':5,'BYWEEKNO':6,'BYMONTH':7,'BYSETPOS':8};icalrecur_iterator._expandMap={'SECONDLY':[1,1,1,1,1,1,1,1],'MINUTELY':[2,1,1,1,1,1,1,1],'HOURLY':[2,2,1,1,1,1,1,1],'DAILY':[2,2,2,1,1,1,1,1],'WEEKLY':[2,2,2,2,3,3,1,1],'MONTHLY':[2,2,2,2,2,3,3,1],'YEARLY':[2,2,2,2,2,2,2,2]};icalrecur_iterator.UNKNOWN=0;icalrecur_iterator.CONTRACT=1;icalrecur_iterator.EXPAND=2;icalrecur_iterator.ILLEGAL=3;return icalrecur_iterator}();ICAL.RecurExpansion=function(){function formatTime(item){return ICAL.helpers.formatClassType(item,ICAL.Time)}function compareTime(a,b){return a.compare(b)}function isRecurringComponent(comp){return comp.hasProperty('rdate')||comp.hasProperty('rrule')||comp.hasProperty('recurrence-id')}function RecurExpansion(options){this.ruleDates=[];this.exDates=[];this.fromData(options)}RecurExpansion.prototype={complete:false,ruleIterators:null,ruleDates:null,exDates:null,ruleDateInc:0,exDateInc:0,exDate:null,ruleDate:null,dtstart:null,last:null,fromData:function(options){var start=ICAL.helpers.formatClassType(options.dtstart,ICAL.Time);if(!start){throw new Error('.dtstart (ICAL.Time) must be given')}else{this.dtstart=start}if(options.component){this._init(options.component)}else{this.last=formatTime(options.last)||start.clone();if(!options.ruleIterators){throw new Error('.ruleIterators or .component must be given')}this.ruleIterators=options.ruleIterators.map(function(item){return ICAL.helpers.formatClassType(item,ICAL.RecurIterator)});this.ruleDateInc=options.ruleDateInc;this.exDateInc=options.exDateInc;if(options.ruleDates){this.ruleDates=options.ruleDates.map(formatTime);this.ruleDate=this.ruleDates[this.ruleDateInc]}if(options.exDates){this.exDates=options.exDates.map(formatTime);this.exDate=this.exDates[this.exDateInc]}if(typeof options.complete!=='undefined'){this.complete=options.complete}}},next:function(){var iter;var ruleOfDay;var next;var compare;var maxTries=500;var currentTry=0;while(true){if(currentTry++>maxTries){throw new Error('max tries have occured, rule may be impossible to forfill.')}next=this.ruleDate;iter=this._nextRecurrenceIter(this.last);if(!next&&!iter){this.complete=true;break}if(!next||iter&&next.compare(iter.last)>0){next=iter.last.clone();iter.next()}if(this.ruleDate===next){this._nextRuleDay()}this.last=next;if(this.exDate){compare=this.exDate.compare(this.last);if(compare<0){this._nextExDay()}if(compare===0){this._nextExDay();continue}}return this.last}},toJSON:function(){function toJSON(item){return item.toJSON()}var result=Object.create(null);result.ruleIterators=this.ruleIterators.map(toJSON);if(this.ruleDates){result.ruleDates=this.ruleDates.map(toJSON)}if(this.exDates){result.exDates=this.exDates.map(toJSON)}result.ruleDateInc=this.ruleDateInc;result.exDateInc=this.exDateInc;result.last=this.last.toJSON();result.dtstart=this.dtstart.toJSON();result.complete=this.complete;return result},_extractDates:function(component,propertyName){function handleProp(prop){idx=ICAL.helpers.binsearchInsert(result,prop,compareTime);result.splice(idx,0,prop)}var result=[];var props=component.getAllProperties(propertyName);var len=props.length;var i=0;var prop;var idx;for(;i<len;i++){props[i].getValues().forEach(handleProp)}return result},_init:function(component){this.ruleIterators=[];this.last=this.dtstart.clone();if(!isRecurringComponent(component)){this.ruleDate=this.last.clone();this.complete=true;return}if(component.hasProperty('rdate')){this.ruleDates=this._extractDates(component,'rdate');if(this.ruleDates[0]&&this.ruleDates[0].compare(this.dtstart)<0){this.ruleDateInc=0;this.last=this.ruleDates[0].clone()}else{this.ruleDateInc=ICAL.helpers.binsearchInsert(this.ruleDates,this.last,compareTime)}this.ruleDate=this.ruleDates[this.ruleDateInc]}if(component.hasProperty('rrule')){var rules=component.getAllProperties('rrule');var i=0;var len=rules.length;var rule;var iter;for(;i<len;i++){rule=rules[i].getFirstValue();iter=rule.iterator(this.dtstart);this.ruleIterators.push(iter);iter.next()}}if(component.hasProperty('exdate')){this.exDates=this._extractDates(component,'exdate');this.exDateInc=ICAL.helpers.binsearchInsert(this.exDates,this.last,compareTime);this.exDate=this.exDates[this.exDateInc]}},_nextExDay:function(){this.exDate=this.exDates[++this.exDateInc]},_nextRuleDay:function(){this.ruleDate=this.ruleDates[++this.ruleDateInc]},_nextRecurrenceIter:function(){var iters=this.ruleIterators;if(iters.length===0){return null}var len=iters.length;var iter;var iterTime;var iterIdx=0;var chosenIter;for(;iterIdx<len;iterIdx++){iter=iters[iterIdx];iterTime=iter.last;if(iter.completed){len--;if(iterIdx!==0){iterIdx--}iters.splice(iterIdx,1);continue}if(!chosenIter||chosenIter.last.compare(iterTime)>0){chosenIter=iter}}return chosenIter}};return RecurExpansion}();ICAL.Event=function(){function Event(component,options){if(!(component instanceof ICAL.Component)){options=component;component=null}if(component){this.component=component}else{this.component=new ICAL.Component('vevent')}this._rangeExceptionCache=Object.create(null);this.exceptions=Object.create(null);this.rangeExceptions=[];if(options&&options.strictExceptions){this.strictExceptions=options.strictExceptions}if(options&&options.exceptions){options.exceptions.forEach(this.relateException,this)}}Event.prototype={THISANDFUTURE:'THISANDFUTURE',exceptions:null,strictExceptions:false,relateException:function(obj){if(this.isRecurrenceException()){throw new Error('cannot relate exception to exceptions')}if(obj instanceof ICAL.Component){obj=new ICAL.Event(obj)}if(this.strictExceptions&&obj.uid!==this.uid){throw new Error('attempted to relate unrelated exception')}var id=obj.recurrenceId.toString();this.exceptions[id]=obj;if(obj.modifiesFuture()){var item=[obj.recurrenceId.toUnixTime(),id];var idx=ICAL.helpers.binsearchInsert(this.rangeExceptions,item,compareRangeException);this.rangeExceptions.splice(idx,0,item)}},modifiesFuture:function(){var range=this.component.getFirstPropertyValue('range');return range===this.THISANDFUTURE},findRangeException:function(time){if(!this.rangeExceptions.length){return null}var utc=time.toUnixTime();var idx=ICAL.helpers.binsearchInsert(this.rangeExceptions,[utc],compareRangeException);idx-=1;if(idx<0){return null}var rangeItem=this.rangeExceptions[idx];if(utc<rangeItem[0]){return null}return rangeItem[1]},getOccurrenceDetails:function(occurrence){var id=occurrence.toString();var utcId=occurrence.convertToZone(ICAL.Timezone.utcTimezone).toString();var item;var result={recurrenceId:occurrence};if(id in this.exceptions){item=result.item=this.exceptions[id];result.startDate=item.startDate;result.endDate=item.endDate;result.item=item}else if(utcId in this.exceptions){item=this.exceptions[utcId];result.startDate=item.startDate;result.endDate=item.endDate;result.item=item}else{var rangeExceptionId=this.findRangeException(occurrence);var end;if(rangeExceptionId){var exception=this.exceptions[rangeExceptionId];result.item=exception;var startDiff=this._rangeExceptionCache[rangeExceptionId];if(!startDiff){var original=exception.recurrenceId.clone();var newStart=exception.startDate.clone();original.zone=newStart.zone;startDiff=newStart.subtractDate(original);this._rangeExceptionCache[rangeExceptionId]=startDiff}var start=occurrence.clone();start.zone=exception.startDate.zone;start.addDuration(startDiff);end=start.clone();end.addDuration(exception.duration);result.startDate=start;result.endDate=end}else{end=occurrence.clone();end.addDuration(this.duration);result.endDate=end;result.startDate=occurrence;result.item=this}}return result},iterator:function(startTime){return new ICAL.RecurExpansion({component:this.component,dtstart:startTime||this.startDate})},isRecurring:function(){var comp=this.component;return comp.hasProperty('rrule')||comp.hasProperty('rdate')},isRecurrenceException:function(){return this.component.hasProperty('recurrence-id')},getRecurrenceTypes:function(){var rules=this.component.getAllProperties('rrule');var i=0;var len=rules.length;var result=Object.create(null);for(;i<len;i++){var value=rules[i].getFirstValue();result[value.freq]=true}return result},get uid(){return this._firstProp('uid')},set uid(value){this._setProp('uid',value)},get startDate(){return this._firstProp('dtstart')},set startDate(value){this._setTime('dtstart',value)},get endDate(){var endDate=this._firstProp('dtend');if(!endDate){var duration=this._firstProp('duration');endDate=this.startDate.clone();if(duration){endDate.addDuration(duration)}else if(endDate.isDate){endDate.day+=1}}return endDate},set endDate(value){this._setTime('dtend',value)},get duration(){var duration=this._firstProp('duration');if(!duration){return this.endDate.subtractDate(this.startDate)}return duration},get location(){return this._firstProp('location')},set location(value){return this._setProp('location',value)},get attendees(){return this.component.getAllProperties('attendee')},get summary(){return this._firstProp('summary')},set summary(value){this._setProp('summary',value)},get description(){return this._firstProp('description')},set description(value){this._setProp('description',value)},get organizer(){return this._firstProp('organizer')},set organizer(value){this._setProp('organizer',value)},get sequence(){return this._firstProp('sequence')},set sequence(value){this._setProp('sequence',value)},get recurrenceId(){return this._firstProp('recurrence-id')},set recurrenceId(value){this._setProp('recurrence-id',value)},_setTime:function(propName,time){var prop=this.component.getFirstProperty(propName);if(!prop){prop=new ICAL.Property(propName);this.component.addProperty(prop)}if(time.zone===ICAL.Timezone.localTimezone||time.zone===ICAL.Timezone.utcTimezone){prop.removeParameter('tzid')}else{prop.setParameter('tzid',time.zone.tzid)}prop.setValue(time)},_setProp:function(name,value){this.component.updatePropertyWithValue(name,value)},_firstProp:function(name){return this.component.getFirstPropertyValue(name)},toString:function(){return this.component.toString()}};function compareRangeException(a,b){if(a[0]>b[0])return 1;if(b[0]>a[0])return-1;return 0}return Event}();ICAL.ComponentParser=function(){function ComponentParser(options){if(typeof options==='undefined'){options={}}var key;for(key in options){if(options.hasOwnProperty(key)){this[key]=options[key]}}}ComponentParser.prototype={parseEvent:true,parseTimezone:true,oncomplete:function(){},onerror:function(err){},ontimezone:function(component){},onevent:function(component){},process:function(ical){if(typeof ical==='string'){ical=ICAL.parse(ical)}if(!(ical instanceof ICAL.Component)){ical=new ICAL.Component(ical)}var components=ical.getAllSubcomponents();var i=0;var len=components.length;var component;for(;i<len;i++){component=components[i];switch(component.name){case'vtimezone':if(this.parseTimezone){var tzid=component.getFirstPropertyValue('tzid');if(tzid){this.ontimezone(new ICAL.Timezone({tzid:tzid,component:component}))}}break;case'vevent':if(this.parseEvent){this.onevent(new ICAL.Event(component))}break;default:continue}}this.oncomplete()}};return ComponentParser}()}(this));return _retrieveGlobal()});(function(){var define=System.amdDefine;define('calendar/ical/TimeZone.js',['3rdparty/ical.js'],function(ical){var TimeZone=ical.Timezone;TimeZone.utcTimeZone=TimeZone.utcTimezone;TimeZone.localTimeZone=TimeZone.localTimezone;TimeZone.prototype.equal=function(b){return!!(this&&b&&this.toString()===b.toString())};TimeZone.prototype.isLocal=function(){return this.toString()===TimeZone.localTimeZone.toString()};return TimeZone})}());(function(){var define=System.amdDefine;define('common/localeStringComparator.js',[],function(){var compare;var locale=inter.id.replace(/_/g,'-');if(locale==='de'){locale='de-DE-u-co-phonebk'}try{compare=new Intl.Collator(locale).compare}catch(_){compare=function(a,b){return(a+'').localeCompare(b,locale)}}return compare})}());(function(){var define=System.amdDefine;define('calendar/Sort.js',['calendar/ical/TimeZone.js','common/localeStringComparator.js'],function(TimeZone,localeStringComparator){function calendarComparator(a,b){if(a.defaultCalendar()&&!b.defaultCalendar()){return-1}else if(!a.defaultCalendar()&&b.defaultCalendar()){return 1}return localeStringComparator(a.name(),b.name())}var Sort={calendars:{byDefaultThenByName:function(calendars){return calendars.sort(calendarComparator)}},eventInstances:{byStartDateThenByCalendarName:function(eventInstances){return eventInstances.sort(function(a,b){var aStartUtc=a.startDate.isDate?a.startDate.clone().convertToZone(TimeZone.utcTimeZone):a.startDate;var bStartUtc=b.startDate.isDate?b.startDate.clone().convertToZone(TimeZone.utcTimeZone):b.startDate;var c=aStartUtc.compare(bStartUtc);if(c!==0){return c}var aEndUtc=a.endDate.isDate?a.endDate.clone().convertToZone(TimeZone.utcTimeZone):a.endDate;var bEndUtc=b.endDate.isDate?b.endDate.clone().convertToZone(TimeZone.utcTimeZone):b.endDate;c=aEndUtc.compare(bEndUtc);if(c!==0){return c}var aEvent=a.event||a.eventInstance.event;var bEvent=b.event||b.eventInstance.event;return calendarComparator(aEvent.calendar,bEvent.calendar)})}}};return Sort})}());(function(){var define=System.amdDefine;define('common/ViewBehavior.js',[],function(){var ViewBehavior={installInto:function(target){if(!target.actionExecutor){throw new Error('ViewBehavior requires an action executor')}if(!target.errorHandler){throw new Error('ViewBehavior requires an error handler')}target.executeAction=function(){this.actionExecutor.enqueue.apply(this.actionExecutor,arguments)};target.handleError=function(){this.errorHandler.handleError.apply(this.errorHandler,arguments)}}};return ViewBehavior})}());(function(){var define=System.amdDefine;define('calendar/actions/UpdateExternalCalendarAction.js',['common/util.js','common/ActionBehavior.js'],function(util,ActionBehavior){function UpdateExternalCalendarAction(options){util.extend(this,util.pick(options,'calendar','data'));ActionBehavior.installInto(this)}UpdateExternalCalendarAction.prototype.name='UpdateExternalCalendarAction';UpdateExternalCalendarAction.prototype.validate=function(){};UpdateExternalCalendarAction.prototype.execute=function(context,callback){var that=this;var state=context.state;var backend=context.backend;var calendarFieldMapping={'color':'color','enabled':'enabled','displayName':'name'};var calendar=that.calendar;var calendarData={};Object.keys(calendarFieldMapping).filter(function(property){return that.data.hasOwnProperty(property)}).forEach(function(property){calendarData[property]=that.data[property]});Object.keys(calendarData).forEach(function(dataKey){var observableField=calendar[calendarFieldMapping[dataKey]];var dataValue=calendarData[dataKey];observableField(dataValue)});var preferencesDocument=state.preferences.calendar();preferencesDocument.subscribedCalendars.forEach(function(cal){if(calendar.id===cal.id){Object.keys(calendarData).forEach(function(dataKey){cal[dataKey]=calendarData[dataKey]})}});backend.savePreference(state.user(),'calendar',preferencesDocument,function(err,data){if(!err&&data._rev){preferencesDocument._rev=data._rev;state.preferences.calendar(preferencesDocument)}callback(err)})};return UpdateExternalCalendarAction})}());(function(){var define=System.amdDefine;(function(global,factory){if(typeof module==='object'&&typeof module.exports==='object'){module.exports=global.document?factory(global,true):function(w){if(!w.document){throw new Error('jQuery requires a window with a document')}return factory(w)}}else{factory(global)}}(typeof window!=='undefined'?window:this,function(window,noGlobal){var deletedIds=[];var slice=deletedIds.slice;var concat=deletedIds.concat;var push=deletedIds.push;var indexOf=deletedIds.indexOf;var class2type={};var toString=class2type.toString;var hasOwn=class2type.hasOwnProperty;var trim=''.trim;var support={};var version='1.11.0',jQuery=function(selector,context){return new jQuery.fn.init(selector,context)},rtrim=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,rmsPrefix=/^-ms-/,rdashAlpha=/-([\da-z])/gi,fcamelCase=function(all,letter){return letter.toUpperCase()};jQuery.fn=jQuery.prototype={jquery:version,constructor:jQuery,selector:'',length:0,toArray:function(){return slice.call(this)},get:function(num){return num!=null?num<0?this[num+this.length]:this[num]:slice.call(this)},pushStack:function(elems){var ret=jQuery.merge(this.constructor(),elems);ret.prevObject=this;ret.context=this.context;return ret},each:function(callback,args){return jQuery.each(this,callback,args)},map:function(callback){return this.pushStack(jQuery.map(this,function(elem,i){return callback.call(elem,i,elem)}))},slice:function(){return this.pushStack(slice.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(i){var len=this.length,j=+i+(i<0?len:0);return this.pushStack(j>=0&&j<len?[this[j]]:[])},end:function(){return this.prevObject||this.constructor(null)},push:push,sort:deletedIds.sort,splice:deletedIds.splice};jQuery.extend=jQuery.fn.extend=function(){var src,copyIsArray,copy,name,options,clone,target=arguments[0]||{},i=1,length=arguments.length,deep=false;if(typeof target==='boolean'){deep=target;target=arguments[i]||{};i++}if(typeof target!=='object'&&!jQuery.isFunction(target)){target={}}if(i===length){target=this;i--}for(;i<length;i++){if((options=arguments[i])!=null){for(name in options){src=target[name];copy=options[name];if(target===copy){continue}if(deep&&copy&&(jQuery.isPlainObject(copy)||(copyIsArray=jQuery.isArray(copy)))){if(copyIsArray){copyIsArray=false;clone=src&&jQuery.isArray(src)?src:[]}else{clone=src&&jQuery.isPlainObject(src)?src:{}}target[name]=jQuery.extend(deep,clone,copy)}else if(copy!==undefined){target[name]=copy}}}}return target};jQuery.extend({expando:'jQuery'+(version+Math.random()).replace(/\D/g,''),isReady:true,error:function(msg){throw new Error(msg)},noop:function(){},isFunction:function(obj){return jQuery.type(obj)==='function'},isArray:Array.isArray||function(obj){return jQuery.type(obj)==='array'},isWindow:function(obj){return obj!=null&&obj==obj.window},isNumeric:function(obj){return obj-parseFloat(obj)>=0},isEmptyObject:function(obj){var name;for(name in obj){return false}return true},isPlainObject:function(obj){var key;if(!obj||jQuery.type(obj)!=='object'||obj.nodeType||jQuery.isWindow(obj)){return false}try{if(obj.constructor&&!hasOwn.call(obj,'constructor')&&!hasOwn.call(obj.constructor.prototype,'isPrototypeOf')){return false}}catch(e){return false}if(support.ownLast){for(key in obj){return hasOwn.call(obj,key)}}for(key in obj){}return key===undefined||hasOwn.call(obj,key)},type:function(obj){if(obj==null){return obj+''}return typeof obj==='object'||typeof obj==='function'?class2type[toString.call(obj)]||'object':typeof obj},globalEval:function(data){if(data&&jQuery.trim(data)){(window.execScript||function(data){window['eval'].call(window,data)})(data)}},camelCase:function(string){return string.replace(rmsPrefix,'ms-').replace(rdashAlpha,fcamelCase)},nodeName:function(elem,name){return elem.nodeName&&elem.nodeName.toLowerCase()===name.toLowerCase()},each:function(obj,callback,args){var value,i=0,length=obj.length,isArray=isArraylike(obj);if(args){if(isArray){for(;i<length;i++){value=callback.apply(obj[i],args);if(value===false){break}}}else{for(i in obj){value=callback.apply(obj[i],args);if(value===false){break}}}}else{if(isArray){for(;i<length;i++){value=callback.call(obj[i],i,obj[i]);if(value===false){break}}}else{for(i in obj){value=callback.call(obj[i],i,obj[i]);if(value===false){break}}}}return obj},trim:trim&&!trim.call('﻿ ')?function(text){return text==null?'':trim.call(text)}:function(text){return text==null?'':(text+'').replace(rtrim,'')},makeArray:function(arr,results){var ret=results||[];if(arr!=null){if(isArraylike(Object(arr))){jQuery.merge(ret,typeof arr==='string'?[arr]:arr)}else{push.call(ret,arr)}}return ret},inArray:function(elem,arr,i){var len;if(arr){if(indexOf){return indexOf.call(arr,elem,i)}len=arr.length;i=i?i<0?Math.max(0,len+i):i:0;for(;i<len;i++){if(i in arr&&arr[i]===elem){return i}}}return-1},merge:function(first,second){var len=+second.length,j=0,i=first.length;while(j<len){first[i++]=second[j++]}if(len!==len){while(second[j]!==undefined){first[i++]=second[j++]}}first.length=i;return first},grep:function(elems,callback,invert){var callbackInverse,matches=[],i=0,length=elems.length,callbackExpect=!invert;for(;i<length;i++){callbackInverse=!callback(elems[i],i);if(callbackInverse!==callbackExpect){matches.push(elems[i])}}return matches},map:function(elems,callback,arg){var value,i=0,length=elems.length,isArray=isArraylike(elems),ret=[];if(isArray){for(;i<length;i++){value=callback(elems[i],i,arg);if(value!=null){ret.push(value)}}}else{for(i in elems){value=callback(elems[i],i,arg);if(value!=null){ret.push(value)}}}return concat.apply([],ret)},guid:1,proxy:function(fn,context){var args,proxy,tmp;if(typeof context==='string'){tmp=fn[context];context=fn;fn=tmp}if(!jQuery.isFunction(fn)){return undefined}args=slice.call(arguments,2);proxy=function(){return fn.apply(context||this,args.concat(slice.call(arguments)))};proxy.guid=fn.guid=fn.guid||jQuery.guid++;return proxy},now:function(){return+new Date},support:support});jQuery.each('Boolean Number String Function Array Date RegExp Object Error'.split(' '),function(i,name){class2type['[object '+name+']']=name.toLowerCase()});function isArraylike(obj){var length=obj.length,type=jQuery.type(obj);if(type==='function'||jQuery.isWindow(obj)){return false}if(obj.nodeType===1&&length){return true}return type==='array'||length===0||typeof length==='number'&&length>0&&length-1 in obj}var Sizzle=function(window){var i,support,Expr,getText,isXML,compile,outermostContext,sortInput,hasDuplicate,setDocument,document,docElem,documentIsHTML,rbuggyQSA,rbuggyMatches,matches,contains,expando='sizzle'+-new Date,preferredDoc=window.document,dirruns=0,done=0,classCache=createCache(),tokenCache=createCache(),compilerCache=createCache(),sortOrder=function(a,b){if(a===b){hasDuplicate=true}return 0},strundefined=typeof undefined,MAX_NEGATIVE=1<<31,hasOwn={}.hasOwnProperty,arr=[],pop=arr.pop,push_native=arr.push,push=arr.push,slice=arr.slice,indexOf=arr.indexOf||function(elem){var i=0,len=this.length;for(;i<len;i++){if(this[i]===elem){return i}}return-1},booleans='checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped',whitespace='[\\x20\\t\\r\\n\\f]',characterEncoding='(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+',identifier=characterEncoding.replace('w','w#'),attributes='\\['+whitespace+'*('+characterEncoding+')'+whitespace+'*(?:([*^$|!~]?=)'+whitespace+'*(?:([\'"])((?:\\\\.|[^\\\\])*?)\\3|('+identifier+')|)|)'+whitespace+'*\\]',pseudos=':('+characterEncoding+')(?:\\((([\'"])((?:\\\\.|[^\\\\])*?)\\3|((?:\\\\.|[^\\\\()[\\]]|'+attributes.replace(3,8)+')*)|.*)\\)|)',rtrim=new RegExp('^'+whitespace+'+|((?:^|[^\\\\])(?:\\\\.)*)'+whitespace+'+$','g'),rcomma=new RegExp('^'+whitespace+'*,'+whitespace+'*'),rcombinators=new RegExp('^'+whitespace+'*([>+~]|'+whitespace+')'+whitespace+'*'),rattributeQuotes=new RegExp('='+whitespace+'*([^\\]\'"]*?)'+whitespace+'*\\]','g'),rpseudo=new RegExp(pseudos),ridentifier=new RegExp('^'+identifier+'$'),matchExpr={'ID':new RegExp('^#('+characterEncoding+')'),'CLASS':new RegExp('^\\.('+characterEncoding+')'),'TAG':new RegExp('^('+characterEncoding.replace('w','w*')+')'),'ATTR':new RegExp('^'+attributes),'PSEUDO':new RegExp('^'+pseudos),'CHILD':new RegExp('^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\('+whitespace+'*(even|odd|(([+-]|)(\\d*)n|)'+whitespace+'*(?:([+-]|)'+whitespace+'*(\\d+)|))'+whitespace+'*\\)|)','i'),'bool':new RegExp('^(?:'+booleans+')$','i'),'needsContext':new RegExp('^'+whitespace+'*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\('+whitespace+'*((?:-\\d)?\\d*)'+whitespace+'*\\)|)(?=[^-]|$)','i')},rinputs=/^(?:input|select|textarea|button)$/i,rheader=/^h\d$/i,rnative=/^[^{]+\{\s*\[native \w/,rquickExpr=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,rsibling=/[+~]/,rescape=/'|\\/g,runescape=new RegExp('\\\\([\\da-f]{1,6}'+whitespace+'?|('+whitespace+')|.)','ig'),funescape=function(_,escaped,escapedWhitespace){var high='0x'+escaped-65536;return high!==high||escapedWhitespace?escaped:high<0?String.fromCharCode(high+65536):String.fromCharCode(high>>10|55296,high&1023|56320)};try{push.apply(arr=slice.call(preferredDoc.childNodes),preferredDoc.childNodes);arr[preferredDoc.childNodes.length].nodeType}catch(e){push={apply:arr.length?function(target,els){push_native.apply(target,slice.call(els))}:function(target,els){var j=target.length,i=0;while(target[j++]=els[i++]){}target.length=j-1}}}function Sizzle(selector,context,results,seed){var match,elem,m,nodeType,i,groups,old,nid,newContext,newSelector;if((context?context.ownerDocument||context:preferredDoc)!==document){setDocument(context)}context=context||document;results=results||[];if(!selector||typeof selector!=='string'){return results}if((nodeType=context.nodeType)!==1&&nodeType!==9){return[]}if(documentIsHTML&&!seed){if(match=rquickExpr.exec(selector)){if(m=match[1]){if(nodeType===9){elem=context.getElementById(m);if(elem&&elem.parentNode){if(elem.id===m){results.push(elem);return results}}else{return results}}else{if(context.ownerDocument&&(elem=context.ownerDocument.getElementById(m))&&contains(context,elem)&&elem.id===m){results.push(elem);return results}}}else if(match[2]){push.apply(results,context.getElementsByTagName(selector));return results}else if((m=match[3])&&support.getElementsByClassName&&context.getElementsByClassName){push.apply(results,context.getElementsByClassName(m));return results}}if(support.qsa&&(!rbuggyQSA||!rbuggyQSA.test(selector))){nid=old=expando;newContext=context;newSelector=nodeType===9&&selector;if(nodeType===1&&context.nodeName.toLowerCase()!=='object'){groups=tokenize(selector);if(old=context.getAttribute('id')){nid=old.replace(rescape,'\\$&')}else{context.setAttribute('id',nid)}nid='[id=\''+nid+'\'] ';i=groups.length;while(i--){groups[i]=nid+toSelector(groups[i])}newContext=rsibling.test(selector)&&testContext(context.parentNode)||context;newSelector=groups.join(',')}if(newSelector){try{push.apply(results,newContext.querySelectorAll(newSelector));return results}catch(qsaError){}finally{if(!old){context.removeAttribute('id')}}}}}return select(selector.replace(rtrim,'$1'),context,results,seed)}function createCache(){var keys=[];function cache(key,value){if(keys.push(key+' ')>Expr.cacheLength){delete cache[keys.shift()]}return cache[key+' ']=value}return cache}function markFunction(fn){fn[expando]=true;return fn}function assert(fn){var div=document.createElement('div');try{return!!fn(div)}catch(e){return false}finally{if(div.parentNode){div.parentNode.removeChild(div)}div=null}}function addHandle(attrs,handler){var arr=attrs.split('|'),i=attrs.length;while(i--){Expr.attrHandle[arr[i]]=handler}}function siblingCheck(a,b){var cur=b&&a,diff=cur&&a.nodeType===1&&b.nodeType===1&&(~b.sourceIndex||MAX_NEGATIVE)-(~a.sourceIndex||MAX_NEGATIVE);if(diff){return diff}if(cur){while(cur=cur.nextSibling){if(cur===b){return-1}}}return a?1:-1}function createInputPseudo(type){return function(elem){var name=elem.nodeName.toLowerCase();return name==='input'&&elem.type===type}}function createButtonPseudo(type){return function(elem){var name=elem.nodeName.toLowerCase();return(name==='input'||name==='button')&&elem.type===type}}function createPositionalPseudo(fn){return markFunction(function(argument){argument=+argument;return markFunction(function(seed,matches){var j,matchIndexes=fn([],seed.length,argument),i=matchIndexes.length;while(i--){if(seed[j=matchIndexes[i]]){seed[j]=!(matches[j]=seed[j])}}})})}function testContext(context){return context&&typeof context.getElementsByTagName!==strundefined&&context}support=Sizzle.support={};isXML=Sizzle.isXML=function(elem){var documentElement=elem&&(elem.ownerDocument||elem).documentElement;return documentElement?documentElement.nodeName!=='HTML':false};setDocument=Sizzle.setDocument=function(node){var hasCompare,doc=node?node.ownerDocument||node:preferredDoc,parent=doc.defaultView;if(doc===document||doc.nodeType!==9||!doc.documentElement){return document}document=doc;docElem=doc.documentElement;documentIsHTML=!isXML(doc);if(parent&&parent!==parent.top){if(parent.addEventListener){parent.addEventListener('unload',function(){setDocument()},false)}else if(parent.attachEvent){parent.attachEvent('onunload',function(){setDocument()})}}support.attributes=assert(function(div){div.className='i';return!div.getAttribute('className')});support.getElementsByTagName=assert(function(div){div.appendChild(doc.createComment(''));return!div.getElementsByTagName('*').length});support.getElementsByClassName=rnative.test(doc.getElementsByClassName)&&assert(function(div){div.innerHTML='<div class=\'a\'></div><div class=\'a i\'></div>';div.firstChild.className='i';return div.getElementsByClassName('i').length===2});support.getById=assert(function(div){docElem.appendChild(div).id=expando;return!doc.getElementsByName||!doc.getElementsByName(expando).length});if(support.getById){Expr.find['ID']=function(id,context){if(typeof context.getElementById!==strundefined&&documentIsHTML){var m=context.getElementById(id);return m&&m.parentNode?[m]:[]}};Expr.filter['ID']=function(id){var attrId=id.replace(runescape,funescape);return function(elem){return elem.getAttribute('id')===attrId}}}else{delete Expr.find['ID'];Expr.filter['ID']=function(id){var attrId=id.replace(runescape,funescape);return function(elem){var node=typeof elem.getAttributeNode!==strundefined&&elem.getAttributeNode('id');return node&&node.value===attrId}}}Expr.find['TAG']=support.getElementsByTagName?function(tag,context){if(typeof context.getElementsByTagName!==strundefined){return context.getElementsByTagName(tag)}}:function(tag,context){var elem,tmp=[],i=0,results=context.getElementsByTagName(tag);if(tag==='*'){while(elem=results[i++]){if(elem.nodeType===1){tmp.push(elem)}}return tmp}return results};Expr.find['CLASS']=support.getElementsByClassName&&function(className,context){if(typeof context.getElementsByClassName!==strundefined&&documentIsHTML){return context.getElementsByClassName(className)}};rbuggyMatches=[];rbuggyQSA=[];if(support.qsa=rnative.test(doc.querySelectorAll)){assert(function(div){div.innerHTML='<select t=\'\'><option selected=\'\'></option></select>';if(div.querySelectorAll('[t^=\'\']').length){rbuggyQSA.push('[*^$]='+whitespace+'*(?:\'\'|"")')}if(!div.querySelectorAll('[selected]').length){rbuggyQSA.push('\\['+whitespace+'*(?:value|'+booleans+')')}if(!div.querySelectorAll(':checked').length){rbuggyQSA.push(':checked')}});assert(function(div){var input=doc.createElement('input');input.setAttribute('type','hidden');div.appendChild(input).setAttribute('name','D');if(div.querySelectorAll('[name=d]').length){rbuggyQSA.push('name'+whitespace+'*[*^$|!~]?=')}if(!div.querySelectorAll(':enabled').length){rbuggyQSA.push(':enabled',':disabled')}div.querySelectorAll('*,:x');rbuggyQSA.push(',.*:')})}if(support.matchesSelector=rnative.test(matches=docElem.webkitMatchesSelector||docElem.mozMatchesSelector||docElem.oMatchesSelector||docElem.msMatchesSelector)){assert(function(div){support.disconnectedMatch=matches.call(div,'div');matches.call(div,'[s!=\'\']:x');rbuggyMatches.push('!=',pseudos)})}rbuggyQSA=rbuggyQSA.length&&new RegExp(rbuggyQSA.join('|'));rbuggyMatches=rbuggyMatches.length&&new RegExp(rbuggyMatches.join('|'));hasCompare=rnative.test(docElem.compareDocumentPosition);contains=hasCompare||rnative.test(docElem.contains)?function(a,b){var adown=a.nodeType===9?a.documentElement:a,bup=b&&b.parentNode;return a===bup||!!(bup&&bup.nodeType===1&&(adown.contains?adown.contains(bup):a.compareDocumentPosition&&a.compareDocumentPosition(bup)&16))}:function(a,b){if(b){while(b=b.parentNode){if(b===a){return true}}}return false};sortOrder=hasCompare?function(a,b){if(a===b){hasDuplicate=true;return 0}var compare=!a.compareDocumentPosition-!b.compareDocumentPosition;if(compare){return compare}compare=(a.ownerDocument||a)===(b.ownerDocument||b)?a.compareDocumentPosition(b):1;if(compare&1||!support.sortDetached&&b.compareDocumentPosition(a)===compare){if(a===doc||a.ownerDocument===preferredDoc&&contains(preferredDoc,a)){return-1}if(b===doc||b.ownerDocument===preferredDoc&&contains(preferredDoc,b)){return 1}return sortInput?indexOf.call(sortInput,a)-indexOf.call(sortInput,b):0}return compare&4?-1:1}:function(a,b){if(a===b){hasDuplicate=true;return 0}var cur,i=0,aup=a.parentNode,bup=b.parentNode,ap=[a],bp=[b];if(!aup||!bup){return a===doc?-1:b===doc?1:aup?-1:bup?1:sortInput?indexOf.call(sortInput,a)-indexOf.call(sortInput,b):0}else if(aup===bup){return siblingCheck(a,b)}cur=a;while(cur=cur.parentNode){ap.unshift(cur)}cur=b;while(cur=cur.parentNode){bp.unshift(cur)}while(ap[i]===bp[i]){i++}return i?siblingCheck(ap[i],bp[i]):ap[i]===preferredDoc?-1:bp[i]===preferredDoc?1:0};return doc};Sizzle.matches=function(expr,elements){return Sizzle(expr,null,null,elements)};Sizzle.matchesSelector=function(elem,expr){if((elem.ownerDocument||elem)!==document){setDocument(elem)}expr=expr.replace(rattributeQuotes,'=\'$1\']');if(support.matchesSelector&&documentIsHTML&&(!rbuggyMatches||!rbuggyMatches.test(expr))&&(!rbuggyQSA||!rbuggyQSA.test(expr))){try{var ret=matches.call(elem,expr);if(ret||support.disconnectedMatch||elem.document&&elem.document.nodeType!==11){return ret}}catch(e){}}return Sizzle(expr,document,null,[elem]).length>0};Sizzle.contains=function(context,elem){if((context.ownerDocument||context)!==document){setDocument(context)}return contains(context,elem)};Sizzle.attr=function(elem,name){if((elem.ownerDocument||elem)!==document){setDocument(elem)}var fn=Expr.attrHandle[name.toLowerCase()],val=fn&&hasOwn.call(Expr.attrHandle,name.toLowerCase())?fn(elem,name,!documentIsHTML):undefined;return val!==undefined?val:support.attributes||!documentIsHTML?elem.getAttribute(name):(val=elem.getAttributeNode(name))&&val.specified?val.value:null};Sizzle.error=function(msg){throw new Error('Syntax error, unrecognized expression: '+msg)};Sizzle.uniqueSort=function(results){var elem,duplicates=[],j=0,i=0;hasDuplicate=!support.detectDuplicates;sortInput=!support.sortStable&&results.slice(0);results.sort(sortOrder);if(hasDuplicate){while(elem=results[i++]){if(elem===results[i]){j=duplicates.push(i)}}while(j--){results.splice(duplicates[j],1)}}sortInput=null;return results};getText=Sizzle.getText=function(elem){var node,ret='',i=0,nodeType=elem.nodeType;if(!nodeType){while(node=elem[i++]){ret+=getText(node)}}else if(nodeType===1||nodeType===9||nodeType===11){if(typeof elem.textContent==='string'){return elem.textContent}else{for(elem=elem.firstChild;elem;elem=elem.nextSibling){ret+=getText(elem)}}}else if(nodeType===3||nodeType===4){return elem.nodeValue}return ret};Expr=Sizzle.selectors={cacheLength:50,createPseudo:markFunction,match:matchExpr,attrHandle:{},find:{},relative:{'>':{dir:'parentNode',first:true},' ':{dir:'parentNode'},'+':{dir:'previousSibling',first:true},'~':{dir:'previousSibling'}},preFilter:{'ATTR':function(match){match[1]=match[1].replace(runescape,funescape);match[3]=(match[4]||match[5]||'').replace(runescape,funescape);if(match[2]==='~='){match[3]=' '+match[3]+' '}return match.slice(0,4)},'CHILD':function(match){match[1]=match[1].toLowerCase();if(match[1].slice(0,3)==='nth'){if(!match[3]){Sizzle.error(match[0])}match[4]=+(match[4]?match[5]+(match[6]||1):2*(match[3]==='even'||match[3]==='odd'));match[5]=+(match[7]+match[8]||match[3]==='odd')}else if(match[3]){Sizzle.error(match[0])}return match},'PSEUDO':function(match){var excess,unquoted=!match[5]&&match[2];if(matchExpr['CHILD'].test(match[0])){return null}if(match[3]&&match[4]!==undefined){match[2]=match[4]}else if(unquoted&&rpseudo.test(unquoted)&&(excess=tokenize(unquoted,true))&&(excess=unquoted.indexOf(')',unquoted.length-excess)-unquoted.length)){match[0]=match[0].slice(0,excess);match[2]=unquoted.slice(0,excess)}return match.slice(0,3)}},filter:{'TAG':function(nodeNameSelector){var nodeName=nodeNameSelector.replace(runescape,funescape).toLowerCase();return nodeNameSelector==='*'?function(){return true}:function(elem){return elem.nodeName&&elem.nodeName.toLowerCase()===nodeName}},'CLASS':function(className){var pattern=classCache[className+' '];return pattern||(pattern=new RegExp('(^|'+whitespace+')'+className+'('+whitespace+'|$)'))&&classCache(className,function(elem){return pattern.test(typeof elem.className==='string'&&elem.className||typeof elem.getAttribute!==strundefined&&elem.getAttribute('class')||'')})},'ATTR':function(name,operator,check){return function(elem){var result=Sizzle.attr(elem,name);if(result==null){return operator==='!='}if(!operator){return true}result+='';return operator==='='?result===check:operator==='!='?result!==check:operator==='^='?check&&result.indexOf(check)===0:operator==='*='?check&&result.indexOf(check)>-1:operator==='$='?check&&result.slice(-check.length)===check:operator==='~='?(' '+result+' ').indexOf(check)>-1:operator==='|='?result===check||result.slice(0,check.length+1)===check+'-':false}},'CHILD':function(type,what,argument,first,last){var simple=type.slice(0,3)!=='nth',forward=type.slice(-4)!=='last',ofType=what==='of-type';return first===1&&last===0?function(elem){return!!elem.parentNode}:function(elem,context,xml){var cache,outerCache,node,diff,nodeIndex,start,dir=simple!==forward?'nextSibling':'previousSibling',parent=elem.parentNode,name=ofType&&elem.nodeName.toLowerCase(),useCache=!xml&&!ofType;if(parent){if(simple){while(dir){node=elem;while(node=node[dir]){if(ofType?node.nodeName.toLowerCase()===name:node.nodeType===1){return false}}start=dir=type==='only'&&!start&&'nextSibling'}return true}start=[forward?parent.firstChild:parent.lastChild];if(forward&&useCache){outerCache=parent[expando]||(parent[expando]={});cache=outerCache[type]||[];nodeIndex=cache[0]===dirruns&&cache[1];diff=cache[0]===dirruns&&cache[2];node=nodeIndex&&parent.childNodes[nodeIndex];while(node=++nodeIndex&&node&&node[dir]||(diff=nodeIndex=0)||start.pop()){if(node.nodeType===1&&++diff&&node===elem){outerCache[type]=[dirruns,nodeIndex,diff];break}}}else if(useCache&&(cache=(elem[expando]||(elem[expando]={}))[type])&&cache[0]===dirruns){diff=cache[1]}else{while(node=++nodeIndex&&node&&node[dir]||(diff=nodeIndex=0)||start.pop()){if((ofType?node.nodeName.toLowerCase()===name:node.nodeType===1)&&++diff){if(useCache){(node[expando]||(node[expando]={}))[type]=[dirruns,diff]}if(node===elem){break}}}}diff-=last;return diff===first||diff%first===0&&diff/first>=0}}},'PSEUDO':function(pseudo,argument){var args,fn=Expr.pseudos[pseudo]||Expr.setFilters[pseudo.toLowerCase()]||Sizzle.error('unsupported pseudo: '+pseudo);if(fn[expando]){return fn(argument)}if(fn.length>1){args=[pseudo,pseudo,'',argument];return Expr.setFilters.hasOwnProperty(pseudo.toLowerCase())?markFunction(function(seed,matches){var idx,matched=fn(seed,argument),i=matched.length;while(i--){idx=indexOf.call(seed,matched[i]);seed[idx]=!(matches[idx]=matched[i])}}):function(elem){return fn(elem,0,args)}}return fn}},pseudos:{'not':markFunction(function(selector){var input=[],results=[],matcher=compile(selector.replace(rtrim,'$1'));return matcher[expando]?markFunction(function(seed,matches,context,xml){var elem,unmatched=matcher(seed,null,xml,[]),i=seed.length;while(i--){if(elem=unmatched[i]){seed[i]=!(matches[i]=elem)}}}):function(elem,context,xml){input[0]=elem;matcher(input,null,xml,results);return!results.pop()}}),'has':markFunction(function(selector){return function(elem){return Sizzle(selector,elem).length>0}}),'contains':markFunction(function(text){return function(elem){return(elem.textContent||elem.innerText||getText(elem)).indexOf(text)>-1}}),'lang':markFunction(function(lang){if(!ridentifier.test(lang||'')){Sizzle.error('unsupported lang: '+lang)}lang=lang.replace(runescape,funescape).toLowerCase();return function(elem){var elemLang;do{if(elemLang=documentIsHTML?elem.lang:elem.getAttribute('xml:lang')||elem.getAttribute('lang')){elemLang=elemLang.toLowerCase();return elemLang===lang||elemLang.indexOf(lang+'-')===0}}while((elem=elem.parentNode)&&elem.nodeType===1);return false}}),'target':function(elem){var hash=window.location&&window.location.hash;return hash&&hash.slice(1)===elem.id},'root':function(elem){return elem===docElem},'focus':function(elem){return elem===document.activeElement&&(!document.hasFocus||document.hasFocus())&&!!(elem.type||elem.href||~elem.tabIndex)},'enabled':function(elem){return elem.disabled===false},'disabled':function(elem){return elem.disabled===true},'checked':function(elem){var nodeName=elem.nodeName.toLowerCase();return nodeName==='input'&&!!elem.checked||nodeName==='option'&&!!elem.selected},'selected':function(elem){if(elem.parentNode){elem.parentNode.selectedIndex}return elem.selected===true},'empty':function(elem){for(elem=elem.firstChild;elem;elem=elem.nextSibling){if(elem.nodeType<6){return false}}return true},'parent':function(elem){return!Expr.pseudos['empty'](elem)},'header':function(elem){return rheader.test(elem.nodeName)},'input':function(elem){return rinputs.test(elem.nodeName)},'button':function(elem){var name=elem.nodeName.toLowerCase();return name==='input'&&elem.type==='button'||name==='button'},'text':function(elem){var attr;return elem.nodeName.toLowerCase()==='input'&&elem.type==='text'&&((attr=elem.getAttribute('type'))==null||attr.toLowerCase()==='text')},'first':createPositionalPseudo(function(){return[0]}),'last':createPositionalPseudo(function(matchIndexes,length){return[length-1]}),'eq':createPositionalPseudo(function(matchIndexes,length,argument){return[argument<0?argument+length:argument]}),'even':createPositionalPseudo(function(matchIndexes,length){var i=0;for(;i<length;i+=2){matchIndexes.push(i)}return matchIndexes}),'odd':createPositionalPseudo(function(matchIndexes,length){var i=1;for(;i<length;i+=2){matchIndexes.push(i)}return matchIndexes}),'lt':createPositionalPseudo(function(matchIndexes,length,argument){var i=argument<0?argument+length:argument;for(;--i>=0;){matchIndexes.push(i)}return matchIndexes}),'gt':createPositionalPseudo(function(matchIndexes,length,argument){var i=argument<0?argument+length:argument;for(;++i<length;){matchIndexes.push(i)}return matchIndexes})}};Expr.pseudos['nth']=Expr.pseudos['eq'];for(i in{radio:true,checkbox:true,file:true,password:true,image:true}){Expr.pseudos[i]=createInputPseudo(i)}for(i in{submit:true,reset:true}){Expr.pseudos[i]=createButtonPseudo(i)}function setFilters(){}setFilters.prototype=Expr.filters=Expr.pseudos;Expr.setFilters=new setFilters;function tokenize(selector,parseOnly){var matched,match,tokens,type,soFar,groups,preFilters,cached=tokenCache[selector+' '];if(cached){return parseOnly?0:cached.slice(0)}soFar=selector;groups=[];preFilters=Expr.preFilter;while(soFar){if(!matched||(match=rcomma.exec(soFar))){if(match){soFar=soFar.slice(match[0].length)||soFar}groups.push(tokens=[])}matched=false;if(match=rcombinators.exec(soFar)){matched=match.shift();tokens.push({value:matched,type:match[0].replace(rtrim,' ')});soFar=soFar.slice(matched.length)}for(type in Expr.filter){if((match=matchExpr[type].exec(soFar))&&(!preFilters[type]||(match=preFilters[type](match)))){matched=match.shift();tokens.push({value:matched,type:type,matches:match});soFar=soFar.slice(matched.length)}}if(!matched){break}}return parseOnly?soFar.length:soFar?Sizzle.error(selector):tokenCache(selector,groups).slice(0)}function toSelector(tokens){var i=0,len=tokens.length,selector='';for(;i<len;i++){selector+=tokens[i].value}return selector}function addCombinator(matcher,combinator,base){var dir=combinator.dir,checkNonElements=base&&dir==='parentNode',doneName=done++;return combinator.first?function(elem,context,xml){while(elem=elem[dir]){if(elem.nodeType===1||checkNonElements){return matcher(elem,context,xml)}}}:function(elem,context,xml){var oldCache,outerCache,newCache=[dirruns,doneName];if(xml){while(elem=elem[dir]){if(elem.nodeType===1||checkNonElements){if(matcher(elem,context,xml)){return true}}}}else{while(elem=elem[dir]){if(elem.nodeType===1||checkNonElements){outerCache=elem[expando]||(elem[expando]={});if((oldCache=outerCache[dir])&&oldCache[0]===dirruns&&oldCache[1]===doneName){return newCache[2]=oldCache[2]}else{outerCache[dir]=newCache;if(newCache[2]=matcher(elem,context,xml)){return true}}}}}}}function elementMatcher(matchers){return matchers.length>1?function(elem,context,xml){var i=matchers.length;while(i--){if(!matchers[i](elem,context,xml)){return false}}return true}:matchers[0]}function condense(unmatched,map,filter,context,xml){var elem,newUnmatched=[],i=0,len=unmatched.length,mapped=map!=null;for(;i<len;i++){if(elem=unmatched[i]){if(!filter||filter(elem,context,xml)){newUnmatched.push(elem);if(mapped){map.push(i)}}}}return newUnmatched}function setMatcher(preFilter,selector,matcher,postFilter,postFinder,postSelector){if(postFilter&&!postFilter[expando]){postFilter=setMatcher(postFilter)}if(postFinder&&!postFinder[expando]){postFinder=setMatcher(postFinder,postSelector)}return markFunction(function(seed,results,context,xml){var temp,i,elem,preMap=[],postMap=[],preexisting=results.length,elems=seed||multipleContexts(selector||'*',context.nodeType?[context]:context,[]),matcherIn=preFilter&&(seed||!selector)?condense(elems,preMap,preFilter,context,xml):elems,matcherOut=matcher?postFinder||(seed?preFilter:preexisting||postFilter)?[]:results:matcherIn;if(matcher){matcher(matcherIn,matcherOut,context,xml)}if(postFilter){temp=condense(matcherOut,postMap);postFilter(temp,[],context,xml);i=temp.length;while(i--){if(elem=temp[i]){matcherOut[postMap[i]]=!(matcherIn[postMap[i]]=elem)}}}if(seed){if(postFinder||preFilter){if(postFinder){temp=[];i=matcherOut.length;while(i--){if(elem=matcherOut[i]){temp.push(matcherIn[i]=elem)}}postFinder(null,matcherOut=[],temp,xml)}i=matcherOut.length;while(i--){if((elem=matcherOut[i])&&(temp=postFinder?indexOf.call(seed,elem):preMap[i])>-1){seed[temp]=!(results[temp]=elem)}}}}else{matcherOut=condense(matcherOut===results?matcherOut.splice(preexisting,matcherOut.length):matcherOut);if(postFinder){postFinder(null,results,matcherOut,xml)}else{push.apply(results,matcherOut)}}})}function matcherFromTokens(tokens){var checkContext,matcher,j,len=tokens.length,leadingRelative=Expr.relative[tokens[0].type],implicitRelative=leadingRelative||Expr.relative[' '],i=leadingRelative?1:0,matchContext=addCombinator(function(elem){return elem===checkContext},implicitRelative,true),matchAnyContext=addCombinator(function(elem){return indexOf.call(checkContext,elem)>-1},implicitRelative,true),matchers=[function(elem,context,xml){return!leadingRelative&&(xml||context!==outermostContext)||((checkContext=context).nodeType?matchContext(elem,context,xml):matchAnyContext(elem,context,xml))}];for(;i<len;i++){if(matcher=Expr.relative[tokens[i].type]){matchers=[addCombinator(elementMatcher(matchers),matcher)]}else{matcher=Expr.filter[tokens[i].type].apply(null,tokens[i].matches);if(matcher[expando]){j=++i;for(;j<len;j++){if(Expr.relative[tokens[j].type]){break}}return setMatcher(i>1&&elementMatcher(matchers),i>1&&toSelector(tokens.slice(0,i-1).concat({value:tokens[i-2].type===' '?'*':''})).replace(rtrim,'$1'),matcher,i<j&&matcherFromTokens(tokens.slice(i,j)),j<len&&matcherFromTokens(tokens=tokens.slice(j)),j<len&&toSelector(tokens))}matchers.push(matcher)}}return elementMatcher(matchers)}function matcherFromGroupMatchers(elementMatchers,setMatchers){var bySet=setMatchers.length>0,byElement=elementMatchers.length>0,superMatcher=function(seed,context,xml,results,outermost){var elem,j,matcher,matchedCount=0,i='0',unmatched=seed&&[],setMatched=[],contextBackup=outermostContext,elems=seed||byElement&&Expr.find['TAG']('*',outermost),dirrunsUnique=dirruns+=contextBackup==null?1:Math.random()||0.1,len=elems.length;if(outermost){outermostContext=context!==document&&context}for(;i!==len&&(elem=elems[i])!=null;i++){if(byElement&&elem){j=0;while(matcher=elementMatchers[j++]){if(matcher(elem,context,xml)){results.push(elem);break}}if(outermost){dirruns=dirrunsUnique}}if(bySet){if(elem=!matcher&&elem){matchedCount--}if(seed){unmatched.push(elem)}}}matchedCount+=i;if(bySet&&i!==matchedCount){j=0;while(matcher=setMatchers[j++]){matcher(unmatched,setMatched,context,xml)}if(seed){if(matchedCount>0){while(i--){if(!(unmatched[i]||setMatched[i])){setMatched[i]=pop.call(results)}}}setMatched=condense(setMatched)}push.apply(results,setMatched);if(outermost&&!seed&&setMatched.length>0&&matchedCount+setMatchers.length>1){Sizzle.uniqueSort(results)}}if(outermost){dirruns=dirrunsUnique;outermostContext=contextBackup}return unmatched};return bySet?markFunction(superMatcher):superMatcher}compile=Sizzle.compile=function(selector,group){var i,setMatchers=[],elementMatchers=[],cached=compilerCache[selector+' '];if(!cached){if(!group){group=tokenize(selector)}i=group.length;while(i--){cached=matcherFromTokens(group[i]);if(cached[expando]){setMatchers.push(cached)}else{elementMatchers.push(cached)}}cached=compilerCache(selector,matcherFromGroupMatchers(elementMatchers,setMatchers))}return cached};function multipleContexts(selector,contexts,results){var i=0,len=contexts.length;for(;i<len;i++){Sizzle(selector,contexts[i],results)}return results}function select(selector,context,results,seed){var i,tokens,token,type,find,match=tokenize(selector);if(!seed){if(match.length===1){tokens=match[0]=match[0].slice(0);if(tokens.length>2&&(token=tokens[0]).type==='ID'&&support.getById&&context.nodeType===9&&documentIsHTML&&Expr.relative[tokens[1].type]){context=(Expr.find['ID'](token.matches[0].replace(runescape,funescape),context)||[])[0];if(!context){return results}selector=selector.slice(tokens.shift().value.length)}i=matchExpr['needsContext'].test(selector)?0:tokens.length;while(i--){token=tokens[i];if(Expr.relative[type=token.type]){break}if(find=Expr.find[type]){if(seed=find(token.matches[0].replace(runescape,funescape),rsibling.test(tokens[0].type)&&testContext(context.parentNode)||context)){tokens.splice(i,1);selector=seed.length&&toSelector(tokens);if(!selector){push.apply(results,seed);return results}break}}}}}compile(selector,match)(seed,context,!documentIsHTML,results,rsibling.test(selector)&&testContext(context.parentNode)||context);return results}support.sortStable=expando.split('').sort(sortOrder).join('')===expando;support.detectDuplicates=!!hasDuplicate;setDocument();support.sortDetached=assert(function(div1){return div1.compareDocumentPosition(document.createElement('div'))&1});if(!assert(function(div){div.innerHTML='<a href=\'#\'></a>';return div.firstChild.getAttribute('href')==='#'})){addHandle('type|href|height|width',function(elem,name,isXML){if(!isXML){return elem.getAttribute(name,name.toLowerCase()==='type'?1:2)}})}if(!support.attributes||!assert(function(div){div.innerHTML='<input/>';div.firstChild.setAttribute('value','');return div.firstChild.getAttribute('value')===''})){addHandle('value',function(elem,name,isXML){if(!isXML&&elem.nodeName.toLowerCase()==='input'){return elem.defaultValue}})}if(!assert(function(div){return div.getAttribute('disabled')==null})){addHandle(booleans,function(elem,name,isXML){var val;if(!isXML){return elem[name]===true?name.toLowerCase():(val=elem.getAttributeNode(name))&&val.specified?val.value:null}})}return Sizzle}(window);jQuery.find=Sizzle;jQuery.expr=Sizzle.selectors;jQuery.expr[':']=jQuery.expr.pseudos;jQuery.unique=Sizzle.uniqueSort;jQuery.text=Sizzle.getText;jQuery.isXMLDoc=Sizzle.isXML;jQuery.contains=Sizzle.contains;var rneedsContext=jQuery.expr.match.needsContext;var rsingleTag=/^<(\w+)\s*\/?>(?:<\/\1>|)$/;var risSimple=/^.[^:#\[\.,]*$/;function winnow(elements,qualifier,not){if(jQuery.isFunction(qualifier)){return jQuery.grep(elements,function(elem,i){return!!qualifier.call(elem,i,elem)!==not})}if(qualifier.nodeType){return jQuery.grep(elements,function(elem){return elem===qualifier!==not})}if(typeof qualifier==='string'){if(risSimple.test(qualifier)){return jQuery.filter(qualifier,elements,not)}qualifier=jQuery.filter(qualifier,elements)}return jQuery.grep(elements,function(elem){return jQuery.inArray(elem,qualifier)>=0!==not})}jQuery.filter=function(expr,elems,not){var elem=elems[0];if(not){expr=':not('+expr+')'}return elems.length===1&&elem.nodeType===1?jQuery.find.matchesSelector(elem,expr)?[elem]:[]:jQuery.find.matches(expr,jQuery.grep(elems,function(elem){return elem.nodeType===1}))};jQuery.fn.extend({find:function(selector){var i,ret=[],self=this,len=self.length;if(typeof selector!=='string'){return this.pushStack(jQuery(selector).filter(function(){for(i=0;i<len;i++){if(jQuery.contains(self[i],this)){return true}}}))}for(i=0;i<len;i++){jQuery.find(selector,self[i],ret)}ret=this.pushStack(len>1?jQuery.unique(ret):ret);ret.selector=this.selector?this.selector+' '+selector:selector;return ret},filter:function(selector){return this.pushStack(winnow(this,selector||[],false))},not:function(selector){return this.pushStack(winnow(this,selector||[],true))},is:function(selector){return!!winnow(this,typeof selector==='string'&&rneedsContext.test(selector)?jQuery(selector):selector||[],false).length}});var rootjQuery,document=window.document,rquickExpr=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/,init=jQuery.fn.init=function(selector,context){var match,elem;if(!selector){return this}if(typeof selector==='string'){if(selector.charAt(0)==='<'&&selector.charAt(selector.length-1)==='>'&&selector.length>=3){match=[null,selector,null]}else{match=rquickExpr.exec(selector)}if(match&&(match[1]||!context)){if(match[1]){context=context instanceof jQuery?context[0]:context;jQuery.merge(this,jQuery.parseHTML(match[1],context&&context.nodeType?context.ownerDocument||context:document,true));if(rsingleTag.test(match[1])&&jQuery.isPlainObject(context)){for(match in context){if(jQuery.isFunction(this[match])){this[match](context[match])}else{this.attr(match,context[match])}}}return this}else{elem=document.getElementById(match[2]);if(elem&&elem.parentNode){if(elem.id!==match[2]){return rootjQuery.find(selector)}this.length=1;this[0]=elem}this.context=document;this.selector=selector;return this}}else if(!context||context.jquery){return(context||rootjQuery).find(selector)}else{return this.constructor(context).find(selector)}}else if(selector.nodeType){this.context=this[0]=selector;this.length=1;return this}else if(jQuery.isFunction(selector)){return typeof rootjQuery.ready!=='undefined'?rootjQuery.ready(selector):selector(jQuery)}if(selector.selector!==undefined){this.selector=selector.selector;this.context=selector.context}return jQuery.makeArray(selector,this)};init.prototype=jQuery.fn;rootjQuery=jQuery(document);var rparentsprev=/^(?:parents|prev(?:Until|All))/,guaranteedUnique={children:true,contents:true,next:true,prev:true};jQuery.extend({dir:function(elem,dir,until){var matched=[],cur=elem[dir];while(cur&&cur.nodeType!==9&&(until===undefined||cur.nodeType!==1||!jQuery(cur).is(until))){if(cur.nodeType===1){matched.push(cur)}cur=cur[dir]}return matched},sibling:function(n,elem){var r=[];for(;n;n=n.nextSibling){if(n.nodeType===1&&n!==elem){r.push(n)}}return r}});jQuery.fn.extend({has:function(target){var i,targets=jQuery(target,this),len=targets.length;return this.filter(function(){for(i=0;i<len;i++){if(jQuery.contains(this,targets[i])){return true}}})},closest:function(selectors,context){var cur,i=0,l=this.length,matched=[],pos=rneedsContext.test(selectors)||typeof selectors!=='string'?jQuery(selectors,context||this.context):0;for(;i<l;i++){for(cur=this[i];cur&&cur!==context;cur=cur.parentNode){if(cur.nodeType<11&&(pos?pos.index(cur)>-1:cur.nodeType===1&&jQuery.find.matchesSelector(cur,selectors))){matched.push(cur);break}}}return this.pushStack(matched.length>1?jQuery.unique(matched):matched)},index:function(elem){if(!elem){return this[0]&&this[0].parentNode?this.first().prevAll().length:-1}if(typeof elem==='string'){return jQuery.inArray(this[0],jQuery(elem))}return jQuery.inArray(elem.jquery?elem[0]:elem,this)},add:function(selector,context){return this.pushStack(jQuery.unique(jQuery.merge(this.get(),jQuery(selector,context))))},addBack:function(selector){return this.add(selector==null?this.prevObject:this.prevObject.filter(selector))}});function sibling(cur,dir){do{cur=cur[dir]}while(cur&&cur.nodeType!==1);return cur}jQuery.each({parent:function(elem){var parent=elem.parentNode;return parent&&parent.nodeType!==11?parent:null},parents:function(elem){return jQuery.dir(elem,'parentNode')},parentsUntil:function(elem,i,until){return jQuery.dir(elem,'parentNode',until)},next:function(elem){return sibling(elem,'nextSibling')},prev:function(elem){return sibling(elem,'previousSibling')},nextAll:function(elem){return jQuery.dir(elem,'nextSibling')},prevAll:function(elem){return jQuery.dir(elem,'previousSibling')},nextUntil:function(elem,i,until){return jQuery.dir(elem,'nextSibling',until)},prevUntil:function(elem,i,until){return jQuery.dir(elem,'previousSibling',until)},siblings:function(elem){return jQuery.sibling((elem.parentNode||{}).firstChild,elem)},children:function(elem){return jQuery.sibling(elem.firstChild)},contents:function(elem){return jQuery.nodeName(elem,'iframe')?elem.contentDocument||elem.contentWindow.document:jQuery.merge([],elem.childNodes)}},function(name,fn){jQuery.fn[name]=function(until,selector){var ret=jQuery.map(this,fn,until);if(name.slice(-5)!=='Until'){selector=until}if(selector&&typeof selector==='string'){ret=jQuery.filter(selector,ret)}if(this.length>1){if(!guaranteedUnique[name]){ret=jQuery.unique(ret)}if(rparentsprev.test(name)){ret=ret.reverse()}}return this.pushStack(ret)}});var rnotwhite=/\S+/g;var optionsCache={};function createOptions(options){var object=optionsCache[options]={};jQuery.each(options.match(rnotwhite)||[],function(_,flag){object[flag]=true});return object}jQuery.Callbacks=function(options){options=typeof options==='string'?optionsCache[options]||createOptions(options):jQuery.extend({},options);var firing,memory,fired,firingLength,firingIndex,firingStart,list=[],stack=!options.once&&[],fire=function(data){memory=options.memory&&data;fired=true;firingIndex=firingStart||0;firingStart=0;firingLength=list.length;firing=true;for(;list&&firingIndex<firingLength;firingIndex++){if(list[firingIndex].apply(data[0],data[1])===false&&options.stopOnFalse){memory=false;break}}firing=false;if(list){if(stack){if(stack.length){fire(stack.shift())}}else if(memory){list=[]}else{self.disable()}}},self={add:function(){if(list){var start=list.length;(function add(args){jQuery.each(args,function(_,arg){var type=jQuery.type(arg);if(type==='function'){if(!options.unique||!self.has(arg)){list.push(arg)}}else if(arg&&arg.length&&type!=='string'){add(arg)}})}(arguments));if(firing){firingLength=list.length}else if(memory){firingStart=start;fire(memory)}}return this},remove:function(){if(list){jQuery.each(arguments,function(_,arg){var index;while((index=jQuery.inArray(arg,list,index))>-1){list.splice(index,1);if(firing){if(index<=firingLength){firingLength--}if(index<=firingIndex){firingIndex--}}}})}return this},has:function(fn){return fn?jQuery.inArray(fn,list)>-1:!!(list&&list.length)},empty:function(){list=[];firingLength=0;return this},disable:function(){list=stack=memory=undefined;return this},disabled:function(){return!list},lock:function(){stack=undefined;if(!memory){self.disable()}return this},locked:function(){return!stack},fireWith:function(context,args){if(list&&(!fired||stack)){args=args||[];args=[context,args.slice?args.slice():args];if(firing){stack.push(args)}else{fire(args)}}return this},fire:function(){self.fireWith(this,arguments);return this},fired:function(){return!!fired}};return self};jQuery.extend({Deferred:function(func){var tuples=[['resolve','done',jQuery.Callbacks('once memory'),'resolved'],['reject','fail',jQuery.Callbacks('once memory'),'rejected'],['notify','progress',jQuery.Callbacks('memory')]],state='pending',promise={state:function(){return state},always:function(){deferred.done(arguments).fail(arguments);return this},then:function(){var fns=arguments;return jQuery.Deferred(function(newDefer){jQuery.each(tuples,function(i,tuple){var fn=jQuery.isFunction(fns[i])&&fns[i];deferred[tuple[1]](function(){var returned=fn&&fn.apply(this,arguments);if(returned&&jQuery.isFunction(returned.promise)){returned.promise().done(newDefer.resolve).fail(newDefer.reject).progress(newDefer.notify)}else{newDefer[tuple[0]+'With'](this===promise?newDefer.promise():this,fn?[returned]:arguments)}})});fns=null}).promise()},promise:function(obj){return obj!=null?jQuery.extend(obj,promise):promise}},deferred={};promise.pipe=promise.then;jQuery.each(tuples,function(i,tuple){var list=tuple[2],stateString=tuple[3];promise[tuple[1]]=list.add;if(stateString){list.add(function(){state=stateString},tuples[i^1][2].disable,tuples[2][2].lock)}deferred[tuple[0]]=function(){deferred[tuple[0]+'With'](this===deferred?promise:this,arguments);return this};deferred[tuple[0]+'With']=list.fireWith});promise.promise(deferred);if(func){func.call(deferred,deferred)}return deferred},when:function(subordinate){var i=0,resolveValues=slice.call(arguments),length=resolveValues.length,remaining=length!==1||subordinate&&jQuery.isFunction(subordinate.promise)?length:0,deferred=remaining===1?subordinate:jQuery.Deferred(),updateFunc=function(i,contexts,values){return function(value){contexts[i]=this;values[i]=arguments.length>1?slice.call(arguments):value;if(values===progressValues){deferred.notifyWith(contexts,values)}else if(!--remaining){deferred.resolveWith(contexts,values)}}},progressValues,progressContexts,resolveContexts;if(length>1){progressValues=new Array(length);progressContexts=new Array(length);resolveContexts=new Array(length);for(;i<length;i++){if(resolveValues[i]&&jQuery.isFunction(resolveValues[i].promise)){resolveValues[i].promise().done(updateFunc(i,resolveContexts,resolveValues)).fail(deferred.reject).progress(updateFunc(i,progressContexts,progressValues))}else{--remaining}}}if(!remaining){deferred.resolveWith(resolveContexts,resolveValues)}return deferred.promise()}});var readyList;jQuery.fn.ready=function(fn){jQuery.ready.promise().done(fn);return this};jQuery.extend({isReady:false,readyWait:1,holdReady:function(hold){if(hold){jQuery.readyWait++}else{jQuery.ready(true)}},ready:function(wait){if(wait===true?--jQuery.readyWait:jQuery.isReady){return}if(!document.body){return setTimeout(jQuery.ready)}jQuery.isReady=true;if(wait!==true&&--jQuery.readyWait>0){return}readyList.resolveWith(document,[jQuery]);if(jQuery.fn.trigger){jQuery(document).trigger('ready').off('ready')}}});function detach(){if(document.addEventListener){document.removeEventListener('DOMContentLoaded',completed,false);window.removeEventListener('load',completed,false)}else{document.detachEvent('onreadystatechange',completed);window.detachEvent('onload',completed)}}function completed(){if(document.addEventListener||event.type==='load'||document.readyState==='complete'){detach();jQuery.ready()}}jQuery.ready.promise=function(obj){if(!readyList){readyList=jQuery.Deferred();if(document.readyState==='complete'){setTimeout(jQuery.ready)}else if(document.addEventListener){document.addEventListener('DOMContentLoaded',completed,false);window.addEventListener('load',completed,false)}else{document.attachEvent('onreadystatechange',completed);window.attachEvent('onload',completed);var top=false;try{top=window.frameElement==null&&document.documentElement}catch(e){}if(top&&top.doScroll){(function doScrollCheck(){if(!jQuery.isReady){try{top.doScroll('left')}catch(e){return setTimeout(doScrollCheck,50)}detach();jQuery.ready()}}())}}}return readyList.promise(obj)};var strundefined=typeof undefined;var i;for(i in jQuery(support)){break}support.ownLast=i!=='0';support.inlineBlockNeedsLayout=false;jQuery(function(){var container,div,body=document.getElementsByTagName('body')[0];if(!body){return}container=document.createElement('div');container.style.cssText='border:0;width:0;height:0;position:absolute;top:0;left:-9999px;margin-top:1px';div=document.createElement('div');body.appendChild(container).appendChild(div);if(typeof div.style.zoom!==strundefined){div.style.cssText='border:0;margin:0;width:1px;padding:1px;display:inline;zoom:1';if(support.inlineBlockNeedsLayout=div.offsetWidth===3){body.style.zoom=1}}body.removeChild(container);container=div=null});(function(){var div=document.createElement('div');if(support.deleteExpando==null){support.deleteExpando=true;try{delete div.test}catch(e){support.deleteExpando=false}}div=null}());jQuery.acceptData=function(elem){var noData=jQuery.noData[(elem.nodeName+' ').toLowerCase()],nodeType=+elem.nodeType||1;return nodeType!==1&&nodeType!==9?false:!noData||noData!==true&&elem.getAttribute('classid')===noData};var rbrace=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,rmultiDash=/([A-Z])/g;function dataAttr(elem,key,data){if(data===undefined&&elem.nodeType===1){var name='data-'+key.replace(rmultiDash,'-$1').toLowerCase();data=elem.getAttribute(name);if(typeof data==='string'){try{data=data==='true'?true:data==='false'?false:data==='null'?null:+data+''===data?+data:rbrace.test(data)?jQuery.parseJSON(data):data}catch(e){}jQuery.data(elem,key,data)}else{data=undefined}}return data}function isEmptyDataObject(obj){var name;for(name in obj){if(name==='data'&&jQuery.isEmptyObject(obj[name])){continue}if(name!=='toJSON'){return false}}return true}function internalData(elem,name,data,pvt){if(!jQuery.acceptData(elem)){return}var ret,thisCache,internalKey=jQuery.expando,isNode=elem.nodeType,cache=isNode?jQuery.cache:elem,id=isNode?elem[internalKey]:elem[internalKey]&&internalKey;if((!id||!cache[id]||!pvt&&!cache[id].data)&&data===undefined&&typeof name==='string'){return}if(!id){if(isNode){id=elem[internalKey]=deletedIds.pop()||jQuery.guid++}else{id=internalKey}}if(!cache[id]){cache[id]=isNode?{}:{toJSON:jQuery.noop}}if(typeof name==='object'||typeof name==='function'){if(pvt){cache[id]=jQuery.extend(cache[id],name)}else{cache[id].data=jQuery.extend(cache[id].data,name)}}thisCache=cache[id];if(!pvt){if(!thisCache.data){thisCache.data={}}thisCache=thisCache.data}if(data!==undefined){thisCache[jQuery.camelCase(name)]=data}if(typeof name==='string'){ret=thisCache[name];if(ret==null){ret=thisCache[jQuery.camelCase(name)]}}else{ret=thisCache}return ret}function internalRemoveData(elem,name,pvt){if(!jQuery.acceptData(elem)){return}var thisCache,i,isNode=elem.nodeType,cache=isNode?jQuery.cache:elem,id=isNode?elem[jQuery.expando]:jQuery.expando;if(!cache[id]){return}if(name){thisCache=pvt?cache[id]:cache[id].data;if(thisCache){if(!jQuery.isArray(name)){if(name in thisCache){name=[name]}else{name=jQuery.camelCase(name);if(name in thisCache){name=[name]}else{name=name.split(' ')}}}else{name=name.concat(jQuery.map(name,jQuery.camelCase))}i=name.length;while(i--){delete thisCache[name[i]]}if(pvt?!isEmptyDataObject(thisCache):!jQuery.isEmptyObject(thisCache)){return}}}if(!pvt){delete cache[id].data;if(!isEmptyDataObject(cache[id])){return}}if(isNode){jQuery.cleanData([elem],true)}else if(support.deleteExpando||cache!=cache.window){delete cache[id]}else{cache[id]=null}}jQuery.extend({cache:{},noData:{'applet ':true,'embed ':true,'object ':'clsid:D27CDB6E-AE6D-11cf-96B8-444553540000'},hasData:function(elem){elem=elem.nodeType?jQuery.cache[elem[jQuery.expando]]:elem[jQuery.expando];return!!elem&&!isEmptyDataObject(elem)},data:function(elem,name,data){return internalData(elem,name,data)},removeData:function(elem,name){return internalRemoveData(elem,name)},_data:function(elem,name,data){return internalData(elem,name,data,true)},_removeData:function(elem,name){return internalRemoveData(elem,name,true)}});jQuery.fn.extend({data:function(key,value){var i,name,data,elem=this[0],attrs=elem&&elem.attributes;if(key===undefined){if(this.length){data=jQuery.data(elem);if(elem.nodeType===1&&!jQuery._data(elem,'parsedAttrs')){i=attrs.length;while(i--){name=attrs[i].name;if(name.indexOf('data-')===0){name=jQuery.camelCase(name.slice(5));dataAttr(elem,name,data[name])}}jQuery._data(elem,'parsedAttrs',true)}}return data}if(typeof key==='object'){return this.each(function(){jQuery.data(this,key)})}return arguments.length>1?this.each(function(){jQuery.data(this,key,value)}):elem?dataAttr(elem,key,jQuery.data(elem,key)):undefined},removeData:function(key){return this.each(function(){jQuery.removeData(this,key)})}});jQuery.extend({queue:function(elem,type,data){var queue;if(elem){type=(type||'fx')+'queue';queue=jQuery._data(elem,type);if(data){if(!queue||jQuery.isArray(data)){queue=jQuery._data(elem,type,jQuery.makeArray(data))}else{queue.push(data)}}return queue||[]}},dequeue:function(elem,type){type=type||'fx';var queue=jQuery.queue(elem,type),startLength=queue.length,fn=queue.shift(),hooks=jQuery._queueHooks(elem,type),next=function(){jQuery.dequeue(elem,type)};if(fn==='inprogress'){fn=queue.shift();startLength--}if(fn){if(type==='fx'){queue.unshift('inprogress')}delete hooks.stop;fn.call(elem,next,hooks)}if(!startLength&&hooks){hooks.empty.fire()}},_queueHooks:function(elem,type){var key=type+'queueHooks';return jQuery._data(elem,key)||jQuery._data(elem,key,{empty:jQuery.Callbacks('once memory').add(function(){jQuery._removeData(elem,type+'queue');jQuery._removeData(elem,key)})})}});jQuery.fn.extend({queue:function(type,data){var setter=2;if(typeof type!=='string'){data=type;type='fx';setter--}if(arguments.length<setter){return jQuery.queue(this[0],type)}return data===undefined?this:this.each(function(){var queue=jQuery.queue(this,type,data);jQuery._queueHooks(this,type);if(type==='fx'&&queue[0]!=='inprogress'){jQuery.dequeue(this,type)}})},dequeue:function(type){return this.each(function(){jQuery.dequeue(this,type)})},clearQueue:function(type){return this.queue(type||'fx',[])},promise:function(type,obj){var tmp,count=1,defer=jQuery.Deferred(),elements=this,i=this.length,resolve=function(){if(!--count){defer.resolveWith(elements,[elements])}};if(typeof type!=='string'){obj=type;type=undefined}type=type||'fx';while(i--){tmp=jQuery._data(elements[i],type+'queueHooks');if(tmp&&tmp.empty){count++;tmp.empty.add(resolve)}}resolve();return defer.promise(obj)}});var pnum=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source;var cssExpand=['Top','Right','Bottom','Left'];var isHidden=function(elem,el){elem=el||elem;return jQuery.css(elem,'display')==='none'||!jQuery.contains(elem.ownerDocument,elem)};var access=jQuery.access=function(elems,fn,key,value,chainable,emptyGet,raw){var i=0,length=elems.length,bulk=key==null;if(jQuery.type(key)==='object'){chainable=true;for(i in key){jQuery.access(elems,fn,i,key[i],true,emptyGet,raw)}}else if(value!==undefined){chainable=true;if(!jQuery.isFunction(value)){raw=true}if(bulk){if(raw){fn.call(elems,value);fn=null}else{bulk=fn;fn=function(elem,key,value){return bulk.call(jQuery(elem),value)}}}if(fn){for(;i<length;i++){fn(elems[i],key,raw?value:value.call(elems[i],i,fn(elems[i],key)))}}}return chainable?elems:bulk?fn.call(elems):length?fn(elems[0],key):emptyGet};var rcheckableType=/^(?:checkbox|radio)$/i;(function(){var fragment=document.createDocumentFragment(),div=document.createElement('div'),input=document.createElement('input');div.setAttribute('className','t');div.innerHTML='  <link/><table></table><a href=\'/a\'>a</a>';support.leadingWhitespace=div.firstChild.nodeType===3;support.tbody=!div.getElementsByTagName('tbody').length;support.htmlSerialize=!!div.getElementsByTagName('link').length;support.html5Clone=document.createElement('nav').cloneNode(true).outerHTML!=='<:nav></:nav>';input.type='checkbox';input.checked=true;fragment.appendChild(input);support.appendChecked=input.checked;div.innerHTML='<textarea>x</textarea>';support.noCloneChecked=!!div.cloneNode(true).lastChild.defaultValue;fragment.appendChild(div);div.innerHTML='<input type=\'radio\' checked=\'checked\' name=\'t\'/>';support.checkClone=div.cloneNode(true).cloneNode(true).lastChild.checked;support.noCloneEvent=true;if(div.attachEvent){div.attachEvent('onclick',function(){support.noCloneEvent=false});div.cloneNode(true).click()}if(support.deleteExpando==null){support.deleteExpando=true;try{delete div.test}catch(e){support.deleteExpando=false}}fragment=div=input=null}());(function(){var i,eventName,div=document.createElement('div');for(i in{submit:true,change:true,focusin:true}){eventName='on'+i;if(!(support[i+'Bubbles']=eventName in window)){div.setAttribute(eventName,'t');support[i+'Bubbles']=div.attributes[eventName].expando===false}}div=null}());var rformElems=/^(?:input|select|textarea)$/i,rkeyEvent=/^key/,rmouseEvent=/^(?:mouse|contextmenu)|click/,rfocusMorph=/^(?:focusinfocus|focusoutblur)$/,rtypenamespace=/^([^.]*)(?:\.(.+)|)$/;function returnTrue(){return true}function returnFalse(){return false}function safeActiveElement(){try{return document.activeElement}catch(err){}}jQuery.event={global:{},add:function(elem,types,handler,data,selector){var tmp,events,t,handleObjIn,special,eventHandle,handleObj,handlers,type,namespaces,origType,elemData=jQuery._data(elem);if(!elemData){return}if(handler.handler){handleObjIn=handler;handler=handleObjIn.handler;selector=handleObjIn.selector}if(!handler.guid){handler.guid=jQuery.guid++}if(!(events=elemData.events)){events=elemData.events={}}if(!(eventHandle=elemData.handle)){eventHandle=elemData.handle=function(e){return typeof jQuery!==strundefined&&(!e||jQuery.event.triggered!==e.type)?jQuery.event.dispatch.apply(eventHandle.elem,arguments):undefined};eventHandle.elem=elem}types=(types||'').match(rnotwhite)||[''];t=types.length;while(t--){tmp=rtypenamespace.exec(types[t])||[];type=origType=tmp[1];namespaces=(tmp[2]||'').split('.').sort();if(!type){continue}special=jQuery.event.special[type]||{};type=(selector?special.delegateType:special.bindType)||type;special=jQuery.event.special[type]||{};handleObj=jQuery.extend({type:type,origType:origType,data:data,handler:handler,guid:handler.guid,selector:selector,needsContext:selector&&jQuery.expr.match.needsContext.test(selector),namespace:namespaces.join('.')},handleObjIn);if(!(handlers=events[type])){handlers=events[type]=[];handlers.delegateCount=0;if(!special.setup||special.setup.call(elem,data,namespaces,eventHandle)===false){if(elem.addEventListener){elem.addEventListener(type,eventHandle,false)}else if(elem.attachEvent){elem.attachEvent('on'+type,eventHandle)}}}if(special.add){special.add.call(elem,handleObj);if(!handleObj.handler.guid){handleObj.handler.guid=handler.guid}}if(selector){handlers.splice(handlers.delegateCount++,0,handleObj)}else{handlers.push(handleObj)}jQuery.event.global[type]=true}elem=null},remove:function(elem,types,handler,selector,mappedTypes){var j,handleObj,tmp,origCount,t,events,special,handlers,type,namespaces,origType,elemData=jQuery.hasData(elem)&&jQuery._data(elem);if(!elemData||!(events=elemData.events)){return}types=(types||'').match(rnotwhite)||[''];t=types.length;while(t--){tmp=rtypenamespace.exec(types[t])||[];type=origType=tmp[1];namespaces=(tmp[2]||'').split('.').sort();if(!type){for(type in events){jQuery.event.remove(elem,type+types[t],handler,selector,true)}continue}special=jQuery.event.special[type]||{};type=(selector?special.delegateType:special.bindType)||type;handlers=events[type]||[];tmp=tmp[2]&&new RegExp('(^|\\.)'+namespaces.join('\\.(?:.*\\.|)')+'(\\.|$)');origCount=j=handlers.length;while(j--){handleObj=handlers[j];if((mappedTypes||origType===handleObj.origType)&&(!handler||handler.guid===handleObj.guid)&&(!tmp||tmp.test(handleObj.namespace))&&(!selector||selector===handleObj.selector||selector==='**'&&handleObj.selector)){handlers.splice(j,1);if(handleObj.selector){handlers.delegateCount--}if(special.remove){special.remove.call(elem,handleObj)}}}if(origCount&&!handlers.length){if(!special.teardown||special.teardown.call(elem,namespaces,elemData.handle)===false){jQuery.removeEvent(elem,type,elemData.handle)}delete events[type]}}if(jQuery.isEmptyObject(events)){delete elemData.handle;jQuery._removeData(elem,'events')}},trigger:function(event,data,elem,onlyHandlers){var handle,ontype,cur,bubbleType,special,tmp,i,eventPath=[elem||document],type=hasOwn.call(event,'type')?event.type:event,namespaces=hasOwn.call(event,'namespace')?event.namespace.split('.'):[];cur=tmp=elem=elem||document;if(elem.nodeType===3||elem.nodeType===8){return}if(rfocusMorph.test(type+jQuery.event.triggered)){return}if(type.indexOf('.')>=0){namespaces=type.split('.');type=namespaces.shift();namespaces.sort()}ontype=type.indexOf(':')<0&&'on'+type;event=event[jQuery.expando]?event:new jQuery.Event(type,typeof event==='object'&&event);event.isTrigger=onlyHandlers?2:3;event.namespace=namespaces.join('.');event.namespace_re=event.namespace?new RegExp('(^|\\.)'+namespaces.join('\\.(?:.*\\.|)')+'(\\.|$)'):null;event.result=undefined;if(!event.target){event.target=elem}data=data==null?[event]:jQuery.makeArray(data,[event]);special=jQuery.event.special[type]||{};if(!onlyHandlers&&special.trigger&&special.trigger.apply(elem,data)===false){return}if(!onlyHandlers&&!special.noBubble&&!jQuery.isWindow(elem)){bubbleType=special.delegateType||type;if(!rfocusMorph.test(bubbleType+type)){cur=cur.parentNode}for(;cur;cur=cur.parentNode){eventPath.push(cur);tmp=cur}if(tmp===(elem.ownerDocument||document)){eventPath.push(tmp.defaultView||tmp.parentWindow||window)}}i=0;while((cur=eventPath[i++])&&!event.isPropagationStopped()){event.type=i>1?bubbleType:special.bindType||type;handle=(jQuery._data(cur,'events')||{})[event.type]&&jQuery._data(cur,'handle');if(handle){handle.apply(cur,data)}handle=ontype&&cur[ontype];if(handle&&handle.apply&&jQuery.acceptData(cur)){event.result=handle.apply(cur,data);if(event.result===false){event.preventDefault()}}}event.type=type;if(!onlyHandlers&&!event.isDefaultPrevented()){if((!special._default||special._default.apply(eventPath.pop(),data)===false)&&jQuery.acceptData(elem)){if(ontype&&elem[type]&&!jQuery.isWindow(elem)){tmp=elem[ontype];if(tmp){elem[ontype]=null}jQuery.event.triggered=type;try{elem[type]()}catch(e){}jQuery.event.triggered=undefined;if(tmp){elem[ontype]=tmp}}}}return event.result},dispatch:function(event){event=jQuery.event.fix(event);var i,ret,handleObj,matched,j,handlerQueue=[],args=slice.call(arguments),handlers=(jQuery._data(this,'events')||{})[event.type]||[],special=jQuery.event.special[event.type]||{};args[0]=event;event.delegateTarget=this;if(special.preDispatch&&special.preDispatch.call(this,event)===false){return}handlerQueue=jQuery.event.handlers.call(this,event,handlers);i=0;while((matched=handlerQueue[i++])&&!event.isPropagationStopped()){event.currentTarget=matched.elem;j=0;while((handleObj=matched.handlers[j++])&&!event.isImmediatePropagationStopped()){if(!event.namespace_re||event.namespace_re.test(handleObj.namespace)){event.handleObj=handleObj;event.data=handleObj.data;ret=((jQuery.event.special[handleObj.origType]||{}).handle||handleObj.handler).apply(matched.elem,args);if(ret!==undefined){if((event.result=ret)===false){event.preventDefault();event.stopPropagation()}}}}}if(special.postDispatch){special.postDispatch.call(this,event)}return event.result},handlers:function(event,handlers){var sel,handleObj,matches,i,handlerQueue=[],delegateCount=handlers.delegateCount,cur=event.target;if(delegateCount&&cur.nodeType&&(!event.button||event.type!=='click')){for(;cur!=this;cur=cur.parentNode||this){if(cur.nodeType===1&&(cur.disabled!==true||event.type!=='click')){matches=[];for(i=0;i<delegateCount;i++){handleObj=handlers[i];sel=handleObj.selector+' ';if(matches[sel]===undefined){matches[sel]=handleObj.needsContext?jQuery(sel,this).index(cur)>=0:jQuery.find(sel,this,null,[cur]).length}if(matches[sel]){matches.push(handleObj)}}if(matches.length){handlerQueue.push({elem:cur,handlers:matches})}}}}if(delegateCount<handlers.length){handlerQueue.push({elem:this,handlers:handlers.slice(delegateCount)})}return handlerQueue},fix:function(event){if(event[jQuery.expando]){return event}var i,prop,copy,type=event.type,originalEvent=event,fixHook=this.fixHooks[type];if(!fixHook){this.fixHooks[type]=fixHook=rmouseEvent.test(type)?this.mouseHooks:rkeyEvent.test(type)?this.keyHooks:{}}copy=fixHook.props?this.props.concat(fixHook.props):this.props;event=new jQuery.Event(originalEvent);i=copy.length;while(i--){prop=copy[i];event[prop]=originalEvent[prop]}if(!event.target){event.target=originalEvent.srcElement||document}if(event.target.nodeType===3){event.target=event.target.parentNode}event.metaKey=!!event.metaKey;return fixHook.filter?fixHook.filter(event,originalEvent):event},props:'altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which'.split(' '),fixHooks:{},keyHooks:{props:'char charCode key keyCode'.split(' '),filter:function(event,original){if(event.which==null){event.which=original.charCode!=null?original.charCode:original.keyCode}return event}},mouseHooks:{props:'button buttons clientX clientY fromElement offsetX offsetY pageX pageY screenX screenY toElement'.split(' '),filter:function(event,original){var body,eventDoc,doc,button=original.button,fromElement=original.fromElement;if(event.pageX==null&&original.clientX!=null){eventDoc=event.target.ownerDocument||document;doc=eventDoc.documentElement;body=eventDoc.body;event.pageX=original.clientX+(doc&&doc.scrollLeft||body&&body.scrollLeft||0)-(doc&&doc.clientLeft||body&&body.clientLeft||0);event.pageY=original.clientY+(doc&&doc.scrollTop||body&&body.scrollTop||0)-(doc&&doc.clientTop||body&&body.clientTop||0)}if(!event.relatedTarget&&fromElement){event.relatedTarget=fromElement===event.target?original.toElement:fromElement}if(!event.which&&button!==undefined){event.which=button&1?1:button&2?3:button&4?2:0}return event}},special:{load:{noBubble:true},focus:{trigger:function(){if(this!==safeActiveElement()&&this.focus){try{this.focus();return false}catch(e){}}},delegateType:'focusin'},blur:{trigger:function(){if(this===safeActiveElement()&&this.blur){this.blur();return false}},delegateType:'focusout'},click:{trigger:function(){if(jQuery.nodeName(this,'input')&&this.type==='checkbox'&&this.click){this.click();return false}},_default:function(event){return jQuery.nodeName(event.target,'a')}},beforeunload:{postDispatch:function(event){if(event.result!==undefined){event.originalEvent.returnValue=event.result}}}},simulate:function(type,elem,event,bubble){var e=jQuery.extend(new jQuery.Event,event,{type:type,isSimulated:true,originalEvent:{}});if(bubble){jQuery.event.trigger(e,null,elem)}else{jQuery.event.dispatch.call(elem,e)}if(e.isDefaultPrevented()){event.preventDefault()}}};jQuery.removeEvent=document.removeEventListener?function(elem,type,handle){if(elem.removeEventListener){elem.removeEventListener(type,handle,false)}}:function(elem,type,handle){var name='on'+type;if(elem.detachEvent){if(typeof elem[name]===strundefined){elem[name]=null}elem.detachEvent(name,handle)}};jQuery.Event=function(src,props){if(!(this instanceof jQuery.Event)){return new jQuery.Event(src,props)}if(src&&src.type){this.originalEvent=src;this.type=src.type;this.isDefaultPrevented=src.defaultPrevented||src.defaultPrevented===undefined&&(src.returnValue===false||src.getPreventDefault&&src.getPreventDefault())?returnTrue:returnFalse}else{this.type=src}if(props){jQuery.extend(this,props)}this.timeStamp=src&&src.timeStamp||jQuery.now();this[jQuery.expando]=true};jQuery.Event.prototype={isDefaultPrevented:returnFalse,isPropagationStopped:returnFalse,isImmediatePropagationStopped:returnFalse,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=returnTrue;if(!e){return}if(e.preventDefault){e.preventDefault()}else{e.returnValue=false}},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=returnTrue;if(!e){return}if(e.stopPropagation){e.stopPropagation()}e.cancelBubble=true},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=returnTrue;this.stopPropagation()}};jQuery.each({mouseenter:'mouseover',mouseleave:'mouseout'},function(orig,fix){jQuery.event.special[orig]={delegateType:fix,bindType:fix,handle:function(event){var ret,target=this,related=event.relatedTarget,handleObj=event.handleObj;if(!related||related!==target&&!jQuery.contains(target,related)){event.type=handleObj.origType;ret=handleObj.handler.apply(this,arguments);event.type=fix}return ret}}});if(!support.submitBubbles){jQuery.event.special.submit={setup:function(){if(jQuery.nodeName(this,'form')){return false}jQuery.event.add(this,'click._submit keypress._submit',function(e){var elem=e.target,form=jQuery.nodeName(elem,'input')||jQuery.nodeName(elem,'button')?elem.form:undefined;if(form&&!jQuery._data(form,'submitBubbles')){jQuery.event.add(form,'submit._submit',function(event){event._submit_bubble=true});jQuery._data(form,'submitBubbles',true)}})},postDispatch:function(event){if(event._submit_bubble){delete event._submit_bubble;if(this.parentNode&&!event.isTrigger){jQuery.event.simulate('submit',this.parentNode,event,true)}}},teardown:function(){if(jQuery.nodeName(this,'form')){return false}jQuery.event.remove(this,'._submit')}}}if(!support.changeBubbles){jQuery.event.special.change={setup:function(){if(rformElems.test(this.nodeName)){if(this.type==='checkbox'||this.type==='radio'){jQuery.event.add(this,'propertychange._change',function(event){if(event.originalEvent.propertyName==='checked'){this._just_changed=true}});jQuery.event.add(this,'click._change',function(event){if(this._just_changed&&!event.isTrigger){this._just_changed=false}jQuery.event.simulate('change',this,event,true)})}return false}jQuery.event.add(this,'beforeactivate._change',function(e){var elem=e.target;if(rformElems.test(elem.nodeName)&&!jQuery._data(elem,'changeBubbles')){jQuery.event.add(elem,'change._change',function(event){if(this.parentNode&&!event.isSimulated&&!event.isTrigger){jQuery.event.simulate('change',this.parentNode,event,true)}});jQuery._data(elem,'changeBubbles',true)}})},handle:function(event){var elem=event.target;if(this!==elem||event.isSimulated||event.isTrigger||elem.type!=='radio'&&elem.type!=='checkbox'){return event.handleObj.handler.apply(this,arguments)}},teardown:function(){jQuery.event.remove(this,'._change');return!rformElems.test(this.nodeName)}}}if(!support.focusinBubbles){jQuery.each({focus:'focusin',blur:'focusout'},function(orig,fix){var handler=function(event){jQuery.event.simulate(fix,event.target,jQuery.event.fix(event),true)};jQuery.event.special[fix]={setup:function(){var doc=this.ownerDocument||this,attaches=jQuery._data(doc,fix);if(!attaches){doc.addEventListener(orig,handler,true)}jQuery._data(doc,fix,(attaches||0)+1)},teardown:function(){var doc=this.ownerDocument||this,attaches=jQuery._data(doc,fix)-1;if(!attaches){doc.removeEventListener(orig,handler,true);jQuery._removeData(doc,fix)}else{jQuery._data(doc,fix,attaches)}}}})}jQuery.fn.extend({on:function(types,selector,data,fn,one){var type,origFn;if(typeof types==='object'){if(typeof selector!=='string'){data=data||selector;selector=undefined}for(type in types){this.on(type,selector,data,types[type],one)}return this}if(data==null&&fn==null){fn=selector;data=selector=undefined}else if(fn==null){if(typeof selector==='string'){fn=data;data=undefined}else{fn=data;data=selector;selector=undefined}}if(fn===false){fn=returnFalse}else if(!fn){return this}if(one===1){origFn=fn;fn=function(event){jQuery().off(event);return origFn.apply(this,arguments)};fn.guid=origFn.guid||(origFn.guid=jQuery.guid++)}return this.each(function(){jQuery.event.add(this,types,fn,data,selector)})},one:function(types,selector,data,fn){return this.on(types,selector,data,fn,1)},off:function(types,selector,fn){var handleObj,type;if(types&&types.preventDefault&&types.handleObj){handleObj=types.handleObj;jQuery(types.delegateTarget).off(handleObj.namespace?handleObj.origType+'.'+handleObj.namespace:handleObj.origType,handleObj.selector,handleObj.handler);return this}if(typeof types==='object'){for(type in types){this.off(type,selector,types[type])}return this}if(selector===false||typeof selector==='function'){fn=selector;selector=undefined}if(fn===false){fn=returnFalse}return this.each(function(){jQuery.event.remove(this,types,fn,selector)})},trigger:function(type,data){return this.each(function(){jQuery.event.trigger(type,data,this)})},triggerHandler:function(type,data){var elem=this[0];if(elem){return jQuery.event.trigger(type,data,elem,true)}}});function createSafeFragment(document){var list=nodeNames.split('|'),safeFrag=document.createDocumentFragment();if(safeFrag.createElement){while(list.length){safeFrag.createElement(list.pop())}}return safeFrag}var nodeNames='abbr|article|aside|audio|bdi|canvas|data|datalist|details|figcaption|figure|footer|'+'header|hgroup|mark|meter|nav|output|progress|section|summary|time|video',rinlinejQuery=/ jQuery\d+="(?:null|\d+)"/g,rnoshimcache=new RegExp('<(?:'+nodeNames+')[\\s/>]','i'),rleadingWhitespace=/^\s+/,rxhtmlTag=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,rtagName=/<([\w:]+)/,rtbody=/<tbody/i,rhtml=/<|&#?\w+;/,rnoInnerhtml=/<(?:script|style|link)/i,rchecked=/checked\s*(?:[^=]|=\s*.checked.)/i,rscriptType=/^$|\/(?:java|ecma)script/i,rscriptTypeMasked=/^true\/(.*)/,rcleanScript=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,wrapMap={option:[1,'<select multiple=\'multiple\'>','</select>'],legend:[1,'<fieldset>','</fieldset>'],area:[1,'<map>','</map>'],param:[1,'<object>','</object>'],thead:[1,'<table>','</table>'],tr:[2,'<table><tbody>','</tbody></table>'],col:[2,'<table><tbody></tbody><colgroup>','</colgroup></table>'],td:[3,'<table><tbody><tr>','</tr></tbody></table>'],_default:support.htmlSerialize?[0,'','']:[1,'X<div>','</div>']},safeFragment=createSafeFragment(document),fragmentDiv=safeFragment.appendChild(document.createElement('div'));wrapMap.optgroup=wrapMap.option;wrapMap.tbody=wrapMap.tfoot=wrapMap.colgroup=wrapMap.caption=wrapMap.thead;wrapMap.th=wrapMap.td;function getAll(context,tag){var elems,elem,i=0,found=typeof context.getElementsByTagName!==strundefined?context.getElementsByTagName(tag||'*'):typeof context.querySelectorAll!==strundefined?context.querySelectorAll(tag||'*'):undefined;if(!found){for(found=[],elems=context.childNodes||context;(elem=elems[i])!=null;i++){if(!tag||jQuery.nodeName(elem,tag)){found.push(elem)}else{jQuery.merge(found,getAll(elem,tag))}}}return tag===undefined||tag&&jQuery.nodeName(context,tag)?jQuery.merge([context],found):found}function fixDefaultChecked(elem){if(rcheckableType.test(elem.type)){elem.defaultChecked=elem.checked}}function manipulationTarget(elem,content){return jQuery.nodeName(elem,'table')&&jQuery.nodeName(content.nodeType!==11?content:content.firstChild,'tr')?elem.getElementsByTagName('tbody')[0]||elem.appendChild(elem.ownerDocument.createElement('tbody')):elem}function disableScript(elem){elem.type=(jQuery.find.attr(elem,'type')!==null)+'/'+elem.type;return elem}function restoreScript(elem){var match=rscriptTypeMasked.exec(elem.type);if(match){elem.type=match[1]}else{elem.removeAttribute('type')}return elem}function setGlobalEval(elems,refElements){var elem,i=0;for(;(elem=elems[i])!=null;i++){jQuery._data(elem,'globalEval',!refElements||jQuery._data(refElements[i],'globalEval'))}}function cloneCopyEvent(src,dest){if(dest.nodeType!==1||!jQuery.hasData(src)){return}var type,i,l,oldData=jQuery._data(src),curData=jQuery._data(dest,oldData),events=oldData.events;if(events){delete curData.handle;curData.events={};for(type in events){for(i=0,l=events[type].length;i<l;i++){jQuery.event.add(dest,type,events[type][i])}}}if(curData.data){curData.data=jQuery.extend({},curData.data)}}function fixCloneNodeIssues(src,dest){var nodeName,e,data;if(dest.nodeType!==1){return}nodeName=dest.nodeName.toLowerCase();if(!support.noCloneEvent&&dest[jQuery.expando]){data=jQuery._data(dest);for(e in data.events){jQuery.removeEvent(dest,e,data.handle)}dest.removeAttribute(jQuery.expando)}if(nodeName==='script'&&dest.text!==src.text){disableScript(dest).text=src.text;restoreScript(dest)}else if(nodeName==='object'){if(dest.parentNode){dest.outerHTML=src.outerHTML}if(support.html5Clone&&(src.innerHTML&&!jQuery.trim(dest.innerHTML))){dest.innerHTML=src.innerHTML}}else if(nodeName==='input'&&rcheckableType.test(src.type)){dest.defaultChecked=dest.checked=src.checked;if(dest.value!==src.value){dest.value=src.value}}else if(nodeName==='option'){dest.defaultSelected=dest.selected=src.defaultSelected}else if(nodeName==='input'||nodeName==='textarea'){dest.defaultValue=src.defaultValue}}jQuery.extend({clone:function(elem,dataAndEvents,deepDataAndEvents){var destElements,node,clone,i,srcElements,inPage=jQuery.contains(elem.ownerDocument,elem);if(support.html5Clone||jQuery.isXMLDoc(elem)||!rnoshimcache.test('<'+elem.nodeName+'>')){clone=elem.cloneNode(true)}else{fragmentDiv.innerHTML=elem.outerHTML;fragmentDiv.removeChild(clone=fragmentDiv.firstChild)}if((!support.noCloneEvent||!support.noCloneChecked)&&(elem.nodeType===1||elem.nodeType===11)&&!jQuery.isXMLDoc(elem)){destElements=getAll(clone);srcElements=getAll(elem);for(i=0;(node=srcElements[i])!=null;++i){if(destElements[i]){fixCloneNodeIssues(node,destElements[i])}}}if(dataAndEvents){if(deepDataAndEvents){srcElements=srcElements||getAll(elem);destElements=destElements||getAll(clone);for(i=0;(node=srcElements[i])!=null;i++){cloneCopyEvent(node,destElements[i])}}else{cloneCopyEvent(elem,clone)}}destElements=getAll(clone,'script');if(destElements.length>0){setGlobalEval(destElements,!inPage&&getAll(elem,'script'))}destElements=srcElements=node=null;return clone},buildFragment:function(elems,context,scripts,selection){var j,elem,contains,tmp,tag,tbody,wrap,l=elems.length,safe=createSafeFragment(context),nodes=[],i=0;for(;i<l;i++){elem=elems[i];if(elem||elem===0){if(jQuery.type(elem)==='object'){jQuery.merge(nodes,elem.nodeType?[elem]:elem)}else if(!rhtml.test(elem)){nodes.push(context.createTextNode(elem))}else{tmp=tmp||safe.appendChild(context.createElement('div'));tag=(rtagName.exec(elem)||['',''])[1].toLowerCase();wrap=wrapMap[tag]||wrapMap._default;tmp.innerHTML=wrap[1]+elem.replace(rxhtmlTag,'<$1></$2>')+wrap[2];j=wrap[0];while(j--){tmp=tmp.lastChild}if(!support.leadingWhitespace&&rleadingWhitespace.test(elem)){nodes.push(context.createTextNode(rleadingWhitespace.exec(elem)[0]))}if(!support.tbody){elem=tag==='table'&&!rtbody.test(elem)?tmp.firstChild:wrap[1]==='<table>'&&!rtbody.test(elem)?tmp:0;j=elem&&elem.childNodes.length;while(j--){if(jQuery.nodeName(tbody=elem.childNodes[j],'tbody')&&!tbody.childNodes.length){elem.removeChild(tbody)}}}jQuery.merge(nodes,tmp.childNodes);tmp.textContent='';while(tmp.firstChild){tmp.removeChild(tmp.firstChild)}tmp=safe.lastChild}}}if(tmp){safe.removeChild(tmp)}if(!support.appendChecked){jQuery.grep(getAll(nodes,'input'),fixDefaultChecked)}i=0;while(elem=nodes[i++]){if(selection&&jQuery.inArray(elem,selection)!==-1){continue}contains=jQuery.contains(elem.ownerDocument,elem);tmp=getAll(safe.appendChild(elem),'script');if(contains){setGlobalEval(tmp)}if(scripts){j=0;while(elem=tmp[j++]){if(rscriptType.test(elem.type||'')){scripts.push(elem)}}}}tmp=null;return safe},cleanData:function(elems,acceptData){var elem,type,id,data,i=0,internalKey=jQuery.expando,cache=jQuery.cache,deleteExpando=support.deleteExpando,special=jQuery.event.special;for(;(elem=elems[i])!=null;i++){if(acceptData||jQuery.acceptData(elem)){id=elem[internalKey];data=id&&cache[id];if(data){if(data.events){for(type in data.events){if(special[type]){jQuery.event.remove(elem,type)}else{jQuery.removeEvent(elem,type,data.handle)}}}if(cache[id]){delete cache[id];if(deleteExpando){delete elem[internalKey]}else if(typeof elem.removeAttribute!==strundefined){elem.removeAttribute(internalKey)}else{elem[internalKey]=null}deletedIds.push(id)}}}}}});jQuery.fn.extend({text:function(value){return access(this,function(value){return value===undefined?jQuery.text(this):this.empty().append((this[0]&&this[0].ownerDocument||document).createTextNode(value))},null,value,arguments.length)},append:function(){return this.domManip(arguments,function(elem){if(this.nodeType===1||this.nodeType===11||this.nodeType===9){var target=manipulationTarget(this,elem);target.appendChild(elem)}})},prepend:function(){return this.domManip(arguments,function(elem){if(this.nodeType===1||this.nodeType===11||this.nodeType===9){var target=manipulationTarget(this,elem);target.insertBefore(elem,target.firstChild)}})},before:function(){return this.domManip(arguments,function(elem){if(this.parentNode){this.parentNode.insertBefore(elem,this)}})},after:function(){return this.domManip(arguments,function(elem){if(this.parentNode){this.parentNode.insertBefore(elem,this.nextSibling)}})},remove:function(selector,keepData){var elem,elems=selector?jQuery.filter(selector,this):this,i=0;for(;(elem=elems[i])!=null;i++){if(!keepData&&elem.nodeType===1){jQuery.cleanData(getAll(elem))}if(elem.parentNode){if(keepData&&jQuery.contains(elem.ownerDocument,elem)){setGlobalEval(getAll(elem,'script'))}elem.parentNode.removeChild(elem)}}return this},empty:function(){var elem,i=0;for(;(elem=this[i])!=null;i++){if(elem.nodeType===1){jQuery.cleanData(getAll(elem,false))}while(elem.firstChild){elem.removeChild(elem.firstChild)}if(elem.options&&jQuery.nodeName(elem,'select')){elem.options.length=0}}return this},clone:function(dataAndEvents,deepDataAndEvents){dataAndEvents=dataAndEvents==null?false:dataAndEvents;deepDataAndEvents=deepDataAndEvents==null?dataAndEvents:deepDataAndEvents;return this.map(function(){return jQuery.clone(this,dataAndEvents,deepDataAndEvents)})},html:function(value){return access(this,function(value){var elem=this[0]||{},i=0,l=this.length;if(value===undefined){return elem.nodeType===1?elem.innerHTML.replace(rinlinejQuery,''):undefined}if(typeof value==='string'&&!rnoInnerhtml.test(value)&&(support.htmlSerialize||!rnoshimcache.test(value))&&(support.leadingWhitespace||!rleadingWhitespace.test(value))&&!wrapMap[(rtagName.exec(value)||['',''])[1].toLowerCase()]){value=value.replace(rxhtmlTag,'<$1></$2>');try{for(;i<l;i++){elem=this[i]||{};if(elem.nodeType===1){jQuery.cleanData(getAll(elem,false));elem.innerHTML=value}}elem=0}catch(e){}}if(elem){this.empty().append(value)}},null,value,arguments.length)},replaceWith:function(){var arg=arguments[0];this.domManip(arguments,function(elem){arg=this.parentNode;jQuery.cleanData(getAll(this));if(arg){arg.replaceChild(elem,this)}});return arg&&(arg.length||arg.nodeType)?this:this.remove()},detach:function(selector){return this.remove(selector,true)},domManip:function(args,callback){args=concat.apply([],args);var first,node,hasScripts,scripts,doc,fragment,i=0,l=this.length,set=this,iNoClone=l-1,value=args[0],isFunction=jQuery.isFunction(value);if(isFunction||l>1&&typeof value==='string'&&!support.checkClone&&rchecked.test(value)){return this.each(function(index){var self=set.eq(index);if(isFunction){args[0]=value.call(this,index,self.html())}self.domManip(args,callback)})}if(l){fragment=jQuery.buildFragment(args,this[0].ownerDocument,false,this);first=fragment.firstChild;if(fragment.childNodes.length===1){fragment=first}if(first){scripts=jQuery.map(getAll(fragment,'script'),disableScript);hasScripts=scripts.length;for(;i<l;i++){node=fragment;if(i!==iNoClone){node=jQuery.clone(node,true,true);if(hasScripts){jQuery.merge(scripts,getAll(node,'script'))}}callback.call(this[i],node,i)}if(hasScripts){doc=scripts[scripts.length-1].ownerDocument;jQuery.map(scripts,restoreScript);for(i=0;i<hasScripts;i++){node=scripts[i];if(rscriptType.test(node.type||'')&&!jQuery._data(node,'globalEval')&&jQuery.contains(doc,node)){if(node.src){if(jQuery._evalUrl){jQuery._evalUrl(node.src)}}else{jQuery.globalEval((node.text||node.textContent||node.innerHTML||'').replace(rcleanScript,''))}}}}fragment=first=null}}return this}});jQuery.each({appendTo:'append',prependTo:'prepend',insertBefore:'before',insertAfter:'after',replaceAll:'replaceWith'},function(name,original){jQuery.fn[name]=function(selector){var elems,i=0,ret=[],insert=jQuery(selector),last=insert.length-1;for(;i<=last;i++){elems=i===last?this:this.clone(true);jQuery(insert[i])[original](elems);push.apply(ret,elems.get())}return this.pushStack(ret)}});var iframe,elemdisplay={};function actualDisplay(name,doc){var elem=jQuery(doc.createElement(name)).appendTo(doc.body),display=window.getDefaultComputedStyle?window.getDefaultComputedStyle(elem[0]).display:jQuery.css(elem[0],'display');elem.detach();return display}function defaultDisplay(nodeName){var doc=document,display=elemdisplay[nodeName];if(!display){display=actualDisplay(nodeName,doc);if(display==='none'||!display){iframe=(iframe||jQuery('<iframe frameborder=\'0\' width=\'0\' height=\'0\'/>')).appendTo(doc.documentElement);doc=(iframe[0].contentWindow||iframe[0].contentDocument).document;doc.write();doc.close();display=actualDisplay(nodeName,doc);iframe.detach()}elemdisplay[nodeName]=display}return display}(function(){var a,shrinkWrapBlocksVal,div=document.createElement('div'),divReset='-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;'+'display:block;padding:0;margin:0;border:0';div.innerHTML='  <link/><table></table><a href=\'/a\'>a</a><input type=\'checkbox\'/>';a=div.getElementsByTagName('a')[0];a.style.cssText='float:left;opacity:.5';support.opacity=/^0.5/.test(a.style.opacity);support.cssFloat=!!a.style.cssFloat;div.style.backgroundClip='content-box';div.cloneNode(true).style.backgroundClip='';support.clearCloneStyle=div.style.backgroundClip==='content-box';a=div=null;support.shrinkWrapBlocks=function(){var body,container,div,containerStyles;if(shrinkWrapBlocksVal==null){body=document.getElementsByTagName('body')[0];if(!body){return}containerStyles='border:0;width:0;height:0;position:absolute;top:0;left:-9999px';container=document.createElement('div');div=document.createElement('div');body.appendChild(container).appendChild(div);shrinkWrapBlocksVal=false;if(typeof div.style.zoom!==strundefined){div.style.cssText=divReset+';width:1px;padding:1px;zoom:1';div.innerHTML='<div></div>';div.firstChild.style.width='5px';shrinkWrapBlocksVal=div.offsetWidth!==3}body.removeChild(container);body=container=div=null}return shrinkWrapBlocksVal}}());var rmargin=/^margin/;var rnumnonpx=new RegExp('^('+pnum+')(?!px)[a-z%]+$','i');var getStyles,curCSS,rposition=/^(top|right|bottom|left)$/;if(window.getComputedStyle){getStyles=function(elem){return elem.ownerDocument.defaultView.getComputedStyle(elem,null)};curCSS=function(elem,name,computed){var width,minWidth,maxWidth,ret,style=elem.style;computed=computed||getStyles(elem);ret=computed?computed.getPropertyValue(name)||computed[name]:undefined;if(computed){if(ret===''&&!jQuery.contains(elem.ownerDocument,elem)){ret=jQuery.style(elem,name)}if(rnumnonpx.test(ret)&&rmargin.test(name)){width=style.width;minWidth=style.minWidth;maxWidth=style.maxWidth;style.minWidth=style.maxWidth=style.width=ret;ret=computed.width;style.width=width;style.minWidth=minWidth;style.maxWidth=maxWidth}}return ret===undefined?ret:ret+''}}else if(document.documentElement.currentStyle){getStyles=function(elem){return elem.currentStyle};curCSS=function(elem,name,computed){var left,rs,rsLeft,ret,style=elem.style;computed=computed||getStyles(elem);ret=computed?computed[name]:undefined;if(ret==null&&style&&style[name]){ret=style[name]}if(rnumnonpx.test(ret)&&!rposition.test(name)){left=style.left;rs=elem.runtimeStyle;rsLeft=rs&&rs.left;if(rsLeft){rs.left=elem.currentStyle.left}style.left=name==='fontSize'?'1em':ret;ret=style.pixelLeft+'px';style.left=left;if(rsLeft){rs.left=rsLeft}}return ret===undefined?ret:ret+''||'auto'}}function addGetHookIf(conditionFn,hookFn){return{get:function(){var condition=conditionFn();if(condition==null){return}if(condition){delete this.get;return}return(this.get=hookFn).apply(this,arguments)}}}(function(){var a,reliableHiddenOffsetsVal,boxSizingVal,boxSizingReliableVal,pixelPositionVal,reliableMarginRightVal,div=document.createElement('div'),containerStyles='border:0;width:0;height:0;position:absolute;top:0;left:-9999px',divReset='-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box;'+'display:block;padding:0;margin:0;border:0';div.innerHTML='  <link/><table></table><a href=\'/a\'>a</a><input type=\'checkbox\'/>';a=div.getElementsByTagName('a')[0];a.style.cssText='float:left;opacity:.5';support.opacity=/^0.5/.test(a.style.opacity);support.cssFloat=!!a.style.cssFloat;div.style.backgroundClip='content-box';div.cloneNode(true).style.backgroundClip='';support.clearCloneStyle=div.style.backgroundClip==='content-box';a=div=null;jQuery.extend(support,{reliableHiddenOffsets:function(){if(reliableHiddenOffsetsVal!=null){return reliableHiddenOffsetsVal}var container,tds,isSupported,div=document.createElement('div'),body=document.getElementsByTagName('body')[0];if(!body){return}div.setAttribute('className','t');div.innerHTML='  <link/><table></table><a href=\'/a\'>a</a><input type=\'checkbox\'/>';container=document.createElement('div');container.style.cssText=containerStyles;body.appendChild(container).appendChild(div);div.innerHTML='<table><tr><td></td><td>t</td></tr></table>';tds=div.getElementsByTagName('td');tds[0].style.cssText='padding:0;margin:0;border:0;display:none';isSupported=tds[0].offsetHeight===0;tds[0].style.display='';tds[1].style.display='none';reliableHiddenOffsetsVal=isSupported&&tds[0].offsetHeight===0;body.removeChild(container);div=body=null;return reliableHiddenOffsetsVal},boxSizing:function(){if(boxSizingVal==null){computeStyleTests()}return boxSizingVal},boxSizingReliable:function(){if(boxSizingReliableVal==null){computeStyleTests()}return boxSizingReliableVal},pixelPosition:function(){if(pixelPositionVal==null){computeStyleTests()}return pixelPositionVal},reliableMarginRight:function(){var body,container,div,marginDiv;if(reliableMarginRightVal==null&&window.getComputedStyle){body=document.getElementsByTagName('body')[0];if(!body){return}container=document.createElement('div');div=document.createElement('div');container.style.cssText=containerStyles;body.appendChild(container).appendChild(div);marginDiv=div.appendChild(document.createElement('div'));marginDiv.style.cssText=div.style.cssText=divReset;marginDiv.style.marginRight=marginDiv.style.width='0';div.style.width='1px';reliableMarginRightVal=!parseFloat((window.getComputedStyle(marginDiv,null)||{}).marginRight);body.removeChild(container)}return reliableMarginRightVal}});function computeStyleTests(){var container,div,body=document.getElementsByTagName('body')[0];if(!body){return}container=document.createElement('div');div=document.createElement('div');container.style.cssText=containerStyles;body.appendChild(container).appendChild(div);div.style.cssText='-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;'+'position:absolute;display:block;padding:1px;border:1px;width:4px;'+'margin-top:1%;top:1%';jQuery.swap(body,body.style.zoom!=null?{zoom:1}:{},function(){boxSizingVal=div.offsetWidth===4});boxSizingReliableVal=true;pixelPositionVal=false;reliableMarginRightVal=true;if(window.getComputedStyle){pixelPositionVal=(window.getComputedStyle(div,null)||{}).top!=='1%';boxSizingReliableVal=(window.getComputedStyle(div,null)||{width:'4px'}).width==='4px'}body.removeChild(container);div=body=null}}());jQuery.swap=function(elem,options,callback,args){var ret,name,old={};for(name in options){old[name]=elem.style[name];elem.style[name]=options[name]}ret=callback.apply(elem,args||[]);for(name in options){elem.style[name]=old[name]}return ret};var ralpha=/alpha\([^)]*\)/i,ropacity=/opacity\s*=\s*([^)]*)/,rdisplayswap=/^(none|table(?!-c[ea]).+)/,rnumsplit=new RegExp('^('+pnum+')(.*)$','i'),rrelNum=new RegExp('^([+-])=('+pnum+')','i'),cssShow={position:'absolute',visibility:'hidden',display:'block'},cssNormalTransform={letterSpacing:0,fontWeight:400},cssPrefixes=['Webkit','O','Moz','ms'];function vendorPropName(style,name){if(name in style){return name}var capName=name.charAt(0).toUpperCase()+name.slice(1),origName=name,i=cssPrefixes.length;while(i--){name=cssPrefixes[i]+capName;if(name in style){return name}}return origName}function showHide(elements,show){var display,elem,hidden,values=[],index=0,length=elements.length;for(;index<length;index++){elem=elements[index];if(!elem.style){continue}values[index]=jQuery._data(elem,'olddisplay');display=elem.style.display;if(show){if(!values[index]&&display==='none'){elem.style.display=''}if(elem.style.display===''&&isHidden(elem)){values[index]=jQuery._data(elem,'olddisplay',defaultDisplay(elem.nodeName))}}else{if(!values[index]){hidden=isHidden(elem);if(display&&display!=='none'||!hidden){jQuery._data(elem,'olddisplay',hidden?display:jQuery.css(elem,'display'))}}}}for(index=0;index<length;index++){elem=elements[index];if(!elem.style){continue}if(!show||elem.style.display==='none'||elem.style.display===''){elem.style.display=show?values[index]||'':'none'}}return elements}function setPositiveNumber(elem,value,subtract){var matches=rnumsplit.exec(value);return matches?Math.max(0,matches[1]-(subtract||0))+(matches[2]||'px'):value}function augmentWidthOrHeight(elem,name,extra,isBorderBox,styles){var i=extra===(isBorderBox?'border':'content')?4:name==='width'?1:0,val=0;for(;i<4;i+=2){if(extra==='margin'){val+=jQuery.css(elem,extra+cssExpand[i],true,styles)}if(isBorderBox){if(extra==='content'){val-=jQuery.css(elem,'padding'+cssExpand[i],true,styles)}if(extra!=='margin'){val-=jQuery.css(elem,'border'+cssExpand[i]+'Width',true,styles)}}else{val+=jQuery.css(elem,'padding'+cssExpand[i],true,styles);if(extra!=='padding'){val+=jQuery.css(elem,'border'+cssExpand[i]+'Width',true,styles)}}}return val}function getWidthOrHeight(elem,name,extra){var valueIsBorderBox=true,val=name==='width'?elem.offsetWidth:elem.offsetHeight,styles=getStyles(elem),isBorderBox=support.boxSizing()&&jQuery.css(elem,'boxSizing',false,styles)==='border-box';if(val<=0||val==null){val=curCSS(elem,name,styles);if(val<0||val==null){val=elem.style[name]}if(rnumnonpx.test(val)){return val}valueIsBorderBox=isBorderBox&&(support.boxSizingReliable()||val===elem.style[name]);val=parseFloat(val)||0}return val+augmentWidthOrHeight(elem,name,extra||(isBorderBox?'border':'content'),valueIsBorderBox,styles)+'px'}jQuery.extend({cssHooks:{opacity:{get:function(elem,computed){if(computed){var ret=curCSS(elem,'opacity');return ret===''?'1':ret}}}},cssNumber:{'columnCount':true,'fillOpacity':true,'fontWeight':true,'lineHeight':true,'opacity':true,'order':true,'orphans':true,'widows':true,'zIndex':true,'zoom':true},cssProps:{'float':support.cssFloat?'cssFloat':'styleFloat'},style:function(elem,name,value,extra){if(!elem||elem.nodeType===3||elem.nodeType===8||!elem.style){return}var ret,type,hooks,origName=jQuery.camelCase(name),style=elem.style;name=jQuery.cssProps[origName]||(jQuery.cssProps[origName]=vendorPropName(style,origName));hooks=jQuery.cssHooks[name]||jQuery.cssHooks[origName];if(value!==undefined){type=typeof value;if(type==='string'&&(ret=rrelNum.exec(value))){value=(ret[1]+1)*ret[2]+parseFloat(jQuery.css(elem,name));type='number'}if(value==null||value!==value){return}if(type==='number'&&!jQuery.cssNumber[origName]){value+='px'}if(!support.clearCloneStyle&&value===''&&name.indexOf('background')===0){style[name]='inherit'}if(!hooks||!('set'in hooks)||(value=hooks.set(elem,value,extra))!==undefined){try{style[name]='';style[name]=value}catch(e){}}}else{if(hooks&&'get'in hooks&&(ret=hooks.get(elem,false,extra))!==undefined){return ret}return style[name]}},css:function(elem,name,extra,styles){var num,val,hooks,origName=jQuery.camelCase(name);name=jQuery.cssProps[origName]||(jQuery.cssProps[origName]=vendorPropName(elem.style,origName));hooks=jQuery.cssHooks[name]||jQuery.cssHooks[origName];if(hooks&&'get'in hooks){val=hooks.get(elem,true,extra)}if(val===undefined){val=curCSS(elem,name,styles)}if(val==='normal'&&name in cssNormalTransform){val=cssNormalTransform[name]}if(extra===''||extra){num=parseFloat(val);return extra===true||jQuery.isNumeric(num)?num||0:val}return val}});jQuery.each(['height','width'],function(i,name){jQuery.cssHooks[name]={get:function(elem,computed,extra){if(computed){return elem.offsetWidth===0&&rdisplayswap.test(jQuery.css(elem,'display'))?jQuery.swap(elem,cssShow,function(){return getWidthOrHeight(elem,name,extra)}):getWidthOrHeight(elem,name,extra)}},set:function(elem,value,extra){var styles=extra&&getStyles(elem);return setPositiveNumber(elem,value,extra?augmentWidthOrHeight(elem,name,extra,support.boxSizing()&&jQuery.css(elem,'boxSizing',false,styles)==='border-box',styles):0)}}});if(!support.opacity){jQuery.cssHooks.opacity={get:function(elem,computed){return ropacity.test((computed&&elem.currentStyle?elem.currentStyle.filter:elem.style.filter)||'')?0.01*parseFloat(RegExp.$1)+'':computed?'1':''},set:function(elem,value){var style=elem.style,currentStyle=elem.currentStyle,opacity=jQuery.isNumeric(value)?'alpha(opacity='+value*100+')':'',filter=currentStyle&&currentStyle.filter||style.filter||'';style.zoom=1;if((value>=1||value==='')&&jQuery.trim(filter.replace(ralpha,''))===''&&style.removeAttribute){style.removeAttribute('filter');if(value===''||currentStyle&&!currentStyle.filter){return}}style.filter=ralpha.test(filter)?filter.replace(ralpha,opacity):filter+' '+opacity}}}jQuery.cssHooks.marginRight=addGetHookIf(support.reliableMarginRight,function(elem,computed){if(computed){return jQuery.swap(elem,{'display':'inline-block'},curCSS,[elem,'marginRight'])}});jQuery.each({margin:'',padding:'',border:'Width'},function(prefix,suffix){jQuery.cssHooks[prefix+suffix]={expand:function(value){var i=0,expanded={},parts=typeof value==='string'?value.split(' '):[value];for(;i<4;i++){expanded[prefix+cssExpand[i]+suffix]=parts[i]||parts[i-2]||parts[0]}return expanded}};if(!rmargin.test(prefix)){jQuery.cssHooks[prefix+suffix].set=setPositiveNumber}});jQuery.fn.extend({css:function(name,value){return access(this,function(elem,name,value){var styles,len,map={},i=0;if(jQuery.isArray(name)){styles=getStyles(elem);len=name.length;for(;i<len;i++){map[name[i]]=jQuery.css(elem,name[i],false,styles)}return map}return value!==undefined?jQuery.style(elem,name,value):jQuery.css(elem,name)},name,value,arguments.length>1)},show:function(){return showHide(this,true)},hide:function(){return showHide(this)},toggle:function(state){if(typeof state==='boolean'){return state?this.show():this.hide()}return this.each(function(){if(isHidden(this)){jQuery(this).show()}else{jQuery(this).hide()}})}});function Tween(elem,options,prop,end,easing){return new Tween.prototype.init(elem,options,prop,end,easing)}jQuery.Tween=Tween;Tween.prototype={constructor:Tween,init:function(elem,options,prop,end,easing,unit){this.elem=elem;this.prop=prop;this.easing=easing||'swing';this.options=options;this.start=this.now=this.cur();this.end=end;this.unit=unit||(jQuery.cssNumber[prop]?'':'px')},cur:function(){var hooks=Tween.propHooks[this.prop];return hooks&&hooks.get?hooks.get(this):Tween.propHooks._default.get(this)},run:function(percent){var eased,hooks=Tween.propHooks[this.prop];if(this.options.duration){this.pos=eased=jQuery.easing[this.easing](percent,this.options.duration*percent,0,1,this.options.duration)}else{this.pos=eased=percent}this.now=(this.end-this.start)*eased+this.start;if(this.options.step){this.options.step.call(this.elem,this.now,this)}if(hooks&&hooks.set){hooks.set(this)}else{Tween.propHooks._default.set(this)}return this}};Tween.prototype.init.prototype=Tween.prototype;Tween.propHooks={_default:{get:function(tween){var result;if(tween.elem[tween.prop]!=null&&(!tween.elem.style||tween.elem.style[tween.prop]==null)){return tween.elem[tween.prop]}result=jQuery.css(tween.elem,tween.prop,'');return!result||result==='auto'?0:result},set:function(tween){if(jQuery.fx.step[tween.prop]){jQuery.fx.step[tween.prop](tween)}else if(tween.elem.style&&(tween.elem.style[jQuery.cssProps[tween.prop]]!=null||jQuery.cssHooks[tween.prop])){jQuery.style(tween.elem,tween.prop,tween.now+tween.unit)}else{tween.elem[tween.prop]=tween.now}}}};Tween.propHooks.scrollTop=Tween.propHooks.scrollLeft={set:function(tween){if(tween.elem.nodeType&&tween.elem.parentNode){tween.elem[tween.prop]=tween.now}}};jQuery.easing={linear:function(p){return p},swing:function(p){return 0.5-Math.cos(p*Math.PI)/2}};jQuery.fx=Tween.prototype.init;jQuery.fx.step={};var fxNow,timerId,rfxtypes=/^(?:toggle|show|hide)$/,rfxnum=new RegExp('^(?:([+-])=|)('+pnum+')([a-z%]*)$','i'),rrun=/queueHooks$/,animationPrefilters=[defaultPrefilter],tweeners={'*':[function(prop,value){var tween=this.createTween(prop,value),target=tween.cur(),parts=rfxnum.exec(value),unit=parts&&parts[3]||(jQuery.cssNumber[prop]?'':'px'),start=(jQuery.cssNumber[prop]||unit!=='px'&&+target)&&rfxnum.exec(jQuery.css(tween.elem,prop)),scale=1,maxIterations=20;if(start&&start[3]!==unit){unit=unit||start[3];parts=parts||[];start=+target||1;do{scale=scale||'.5';start=start/scale;jQuery.style(tween.elem,prop,start+unit)}while(scale!==(scale=tween.cur()/target)&&scale!==1&&--maxIterations)}if(parts){start=tween.start=+start||+target||0;tween.unit=unit;tween.end=parts[1]?start+(parts[1]+1)*parts[2]:+parts[2]}return tween}]};function createFxNow(){setTimeout(function(){fxNow=undefined});return fxNow=jQuery.now()}function genFx(type,includeWidth){var which,attrs={height:type},i=0;includeWidth=includeWidth?1:0;for(;i<4;i+=2-includeWidth){which=cssExpand[i];attrs['margin'+which]=attrs['padding'+which]=type}if(includeWidth){attrs.opacity=attrs.width=type}return attrs}function createTween(value,prop,animation){var tween,collection=(tweeners[prop]||[]).concat(tweeners['*']),index=0,length=collection.length;for(;index<length;index++){if(tween=collection[index].call(animation,prop,value)){return tween}}}function defaultPrefilter(elem,props,opts){var prop,value,toggle,tween,hooks,oldfire,display,dDisplay,anim=this,orig={},style=elem.style,hidden=elem.nodeType&&isHidden(elem),dataShow=jQuery._data(elem,'fxshow');if(!opts.queue){hooks=jQuery._queueHooks(elem,'fx');if(hooks.unqueued==null){hooks.unqueued=0;oldfire=hooks.empty.fire;hooks.empty.fire=function(){if(!hooks.unqueued){oldfire()}}}hooks.unqueued++;anim.always(function(){anim.always(function(){hooks.unqueued--;if(!jQuery.queue(elem,'fx').length){hooks.empty.fire()}})})}if(elem.nodeType===1&&('height'in props||'width'in props)){opts.overflow=[style.overflow,style.overflowX,style.overflowY];display=jQuery.css(elem,'display');dDisplay=defaultDisplay(elem.nodeName);if(display==='none'){display=dDisplay}if(display==='inline'&&jQuery.css(elem,'float')==='none'){if(!support.inlineBlockNeedsLayout||dDisplay==='inline'){style.display='inline-block'}else{style.zoom=1}}}if(opts.overflow){style.overflow='hidden';if(!support.shrinkWrapBlocks()){anim.always(function(){style.overflow=opts.overflow[0];style.overflowX=opts.overflow[1];style.overflowY=opts.overflow[2]})}}for(prop in props){value=props[prop];if(rfxtypes.exec(value)){delete props[prop];toggle=toggle||value==='toggle';if(value===(hidden?'hide':'show')){if(value==='show'&&dataShow&&dataShow[prop]!==undefined){hidden=true}else{continue}}orig[prop]=dataShow&&dataShow[prop]||jQuery.style(elem,prop)}}if(!jQuery.isEmptyObject(orig)){if(dataShow){if('hidden'in dataShow){hidden=dataShow.hidden}}else{dataShow=jQuery._data(elem,'fxshow',{})}if(toggle){dataShow.hidden=!hidden}if(hidden){jQuery(elem).show()}else{anim.done(function(){jQuery(elem).hide()})}anim.done(function(){var prop;jQuery._removeData(elem,'fxshow');for(prop in orig){jQuery.style(elem,prop,orig[prop])}});for(prop in orig){tween=createTween(hidden?dataShow[prop]:0,prop,anim);if(!(prop in dataShow)){dataShow[prop]=tween.start;if(hidden){tween.end=tween.start;tween.start=prop==='width'||prop==='height'?1:0}}}}}function propFilter(props,specialEasing){var index,name,easing,value,hooks;for(index in props){name=jQuery.camelCase(index);easing=specialEasing[name];value=props[index];if(jQuery.isArray(value)){easing=value[1];value=props[index]=value[0]}if(index!==name){props[name]=value;delete props[index]}hooks=jQuery.cssHooks[name];if(hooks&&'expand'in hooks){value=hooks.expand(value);delete props[name];for(index in value){if(!(index in props)){props[index]=value[index];specialEasing[index]=easing}}}else{specialEasing[name]=easing}}}function Animation(elem,properties,options){var result,stopped,index=0,length=animationPrefilters.length,deferred=jQuery.Deferred().always(function(){delete tick.elem}),tick=function(){if(stopped){return false}var currentTime=fxNow||createFxNow(),remaining=Math.max(0,animation.startTime+animation.duration-currentTime),temp=remaining/animation.duration||0,percent=1-temp,index=0,length=animation.tweens.length;for(;index<length;index++){animation.tweens[index].run(percent)}deferred.notifyWith(elem,[animation,percent,remaining]);if(percent<1&&length){return remaining}else{deferred.resolveWith(elem,[animation]);return false}},animation=deferred.promise({elem:elem,props:jQuery.extend({},properties),opts:jQuery.extend(true,{specialEasing:{}},options),originalProperties:properties,originalOptions:options,startTime:fxNow||createFxNow(),duration:options.duration,tweens:[],createTween:function(prop,end){var tween=jQuery.Tween(elem,animation.opts,prop,end,animation.opts.specialEasing[prop]||animation.opts.easing);animation.tweens.push(tween);return tween},stop:function(gotoEnd){var index=0,length=gotoEnd?animation.tweens.length:0;if(stopped){return this}stopped=true;for(;index<length;index++){animation.tweens[index].run(1)}if(gotoEnd){deferred.resolveWith(elem,[animation,gotoEnd])}else{deferred.rejectWith(elem,[animation,gotoEnd])}return this}}),props=animation.props;propFilter(props,animation.opts.specialEasing);for(;index<length;index++){result=animationPrefilters[index].call(animation,elem,props,animation.opts);if(result){return result}}jQuery.map(props,createTween,animation);if(jQuery.isFunction(animation.opts.start)){animation.opts.start.call(elem,animation)}jQuery.fx.timer(jQuery.extend(tick,{elem:elem,anim:animation,queue:animation.opts.queue}));return animation.progress(animation.opts.progress).done(animation.opts.done,animation.opts.complete).fail(animation.opts.fail).always(animation.opts.always)}jQuery.Animation=jQuery.extend(Animation,{tweener:function(props,callback){if(jQuery.isFunction(props)){callback=props;props=['*']}else{props=props.split(' ')}var prop,index=0,length=props.length;for(;index<length;index++){prop=props[index];tweeners[prop]=tweeners[prop]||[];tweeners[prop].unshift(callback)}},prefilter:function(callback,prepend){if(prepend){animationPrefilters.unshift(callback)}else{animationPrefilters.push(callback)}}});jQuery.speed=function(speed,easing,fn){var opt=speed&&typeof speed==='object'?jQuery.extend({},speed):{complete:fn||!fn&&easing||jQuery.isFunction(speed)&&speed,duration:speed,easing:fn&&easing||easing&&!jQuery.isFunction(easing)&&easing};opt.duration=jQuery.fx.off?0:typeof opt.duration==='number'?opt.duration:opt.duration in jQuery.fx.speeds?jQuery.fx.speeds[opt.duration]:jQuery.fx.speeds._default;if(opt.queue==null||opt.queue===true){opt.queue='fx'}opt.old=opt.complete;opt.complete=function(){if(jQuery.isFunction(opt.old)){opt.old.call(this)}if(opt.queue){jQuery.dequeue(this,opt.queue)}};return opt};jQuery.fn.extend({fadeTo:function(speed,to,easing,callback){return this.filter(isHidden).css('opacity',0).show().end().animate({opacity:to},speed,easing,callback)},animate:function(prop,speed,easing,callback){var empty=jQuery.isEmptyObject(prop),optall=jQuery.speed(speed,easing,callback),doAnimation=function(){var anim=Animation(this,jQuery.extend({},prop),optall);if(empty||jQuery._data(this,'finish')){anim.stop(true)}};doAnimation.finish=doAnimation;return empty||optall.queue===false?this.each(doAnimation):this.queue(optall.queue,doAnimation)},stop:function(type,clearQueue,gotoEnd){var stopQueue=function(hooks){var stop=hooks.stop;delete hooks.stop;stop(gotoEnd)};if(typeof type!=='string'){gotoEnd=clearQueue;clearQueue=type;type=undefined}if(clearQueue&&type!==false){this.queue(type||'fx',[])}return this.each(function(){var dequeue=true,index=type!=null&&type+'queueHooks',timers=jQuery.timers,data=jQuery._data(this);if(index){if(data[index]&&data[index].stop){stopQueue(data[index])}}else{for(index in data){if(data[index]&&data[index].stop&&rrun.test(index)){stopQueue(data[index])}}}for(index=timers.length;index--;){if(timers[index].elem===this&&(type==null||timers[index].queue===type)){timers[index].anim.stop(gotoEnd);dequeue=false;timers.splice(index,1)}}if(dequeue||!gotoEnd){jQuery.dequeue(this,type)}})},finish:function(type){if(type!==false){type=type||'fx'}return this.each(function(){var index,data=jQuery._data(this),queue=data[type+'queue'],hooks=data[type+'queueHooks'],timers=jQuery.timers,length=queue?queue.length:0;data.finish=true;jQuery.queue(this,type,[]);if(hooks&&hooks.stop){hooks.stop.call(this,true)}for(index=timers.length;index--;){if(timers[index].elem===this&&timers[index].queue===type){timers[index].anim.stop(true);timers.splice(index,1)}}for(index=0;index<length;index++){if(queue[index]&&queue[index].finish){queue[index].finish.call(this)}}delete data.finish})}});jQuery.each(['toggle','show','hide'],function(i,name){var cssFn=jQuery.fn[name];jQuery.fn[name]=function(speed,easing,callback){return speed==null||typeof speed==='boolean'?cssFn.apply(this,arguments):this.animate(genFx(name,true),speed,easing,callback)}});jQuery.each({slideDown:genFx('show'),slideUp:genFx('hide'),slideToggle:genFx('toggle'),fadeIn:{opacity:'show'},fadeOut:{opacity:'hide'},fadeToggle:{opacity:'toggle'}},function(name,props){jQuery.fn[name]=function(speed,easing,callback){return this.animate(props,speed,easing,callback)}});jQuery.timers=[];jQuery.fx.tick=function(){var timer,timers=jQuery.timers,i=0;fxNow=jQuery.now();for(;i<timers.length;i++){timer=timers[i];if(!timer()&&timers[i]===timer){timers.splice(i--,1)}}if(!timers.length){jQuery.fx.stop()}fxNow=undefined};jQuery.fx.timer=function(timer){jQuery.timers.push(timer);if(timer()){jQuery.fx.start()}else{jQuery.timers.pop()}};jQuery.fx.interval=13;jQuery.fx.start=function(){if(!timerId){timerId=setInterval(jQuery.fx.tick,jQuery.fx.interval)}};jQuery.fx.stop=function(){clearInterval(timerId);timerId=null};jQuery.fx.speeds={slow:600,fast:200,_default:400};jQuery.fn.delay=function(time,type){time=jQuery.fx?jQuery.fx.speeds[time]||time:time;type=type||'fx';return this.queue(type,function(next,hooks){var timeout=setTimeout(next,time);hooks.stop=function(){clearTimeout(timeout)}})};(function(){var a,input,select,opt,div=document.createElement('div');div.setAttribute('className','t');div.innerHTML='  <link/><table></table><a href=\'/a\'>a</a><input type=\'checkbox\'/>';a=div.getElementsByTagName('a')[0];select=document.createElement('select');opt=select.appendChild(document.createElement('option'));input=div.getElementsByTagName('input')[0];a.style.cssText='top:1px';support.getSetAttribute=div.className!=='t';support.style=/top/.test(a.getAttribute('style'));support.hrefNormalized=a.getAttribute('href')==='/a';support.checkOn=!!input.value;support.optSelected=opt.selected;support.enctype=!!document.createElement('form').enctype;select.disabled=true;support.optDisabled=!opt.disabled;input=document.createElement('input');input.setAttribute('value','');support.input=input.getAttribute('value')==='';input.value='t';input.setAttribute('type','radio');support.radioValue=input.value==='t';a=input=select=opt=div=null}());var rreturn=/\r/g;jQuery.fn.extend({val:function(value){var hooks,ret,isFunction,elem=this[0];if(!arguments.length){if(elem){hooks=jQuery.valHooks[elem.type]||jQuery.valHooks[elem.nodeName.toLowerCase()];if(hooks&&'get'in hooks&&(ret=hooks.get(elem,'value'))!==undefined){return ret}ret=elem.value;return typeof ret==='string'?ret.replace(rreturn,''):ret==null?'':ret}return}isFunction=jQuery.isFunction(value);return this.each(function(i){var val;if(this.nodeType!==1){return}if(isFunction){val=value.call(this,i,jQuery(this).val())}else{val=value}if(val==null){val=''}else if(typeof val==='number'){val+=''}else if(jQuery.isArray(val)){val=jQuery.map(val,function(value){return value==null?'':value+''})}hooks=jQuery.valHooks[this.type]||jQuery.valHooks[this.nodeName.toLowerCase()];if(!hooks||!('set'in hooks)||hooks.set(this,val,'value')===undefined){this.value=val}})}});jQuery.extend({valHooks:{option:{get:function(elem){var val=jQuery.find.attr(elem,'value');return val!=null?val:jQuery.text(elem)}},select:{get:function(elem){var value,option,options=elem.options,index=elem.selectedIndex,one=elem.type==='select-one'||index<0,values=one?null:[],max=one?index+1:options.length,i=index<0?max:one?index:0;for(;i<max;i++){option=options[i];if((option.selected||i===index)&&(support.optDisabled?!option.disabled:option.getAttribute('disabled')===null)&&(!option.parentNode.disabled||!jQuery.nodeName(option.parentNode,'optgroup'))){value=jQuery(option).val();if(one){return value}values.push(value)}}return values},set:function(elem,value){var optionSet,option,options=elem.options,values=jQuery.makeArray(value),i=options.length;while(i--){option=options[i];if(jQuery.inArray(jQuery.valHooks.option.get(option),values)>=0){try{option.selected=optionSet=true}catch(_){option.scrollHeight}}else{option.selected=false}}if(!optionSet){elem.selectedIndex=-1}return options}}}});jQuery.each(['radio','checkbox'],function(){jQuery.valHooks[this]={set:function(elem,value){if(jQuery.isArray(value)){return elem.checked=jQuery.inArray(jQuery(elem).val(),value)>=0}}};if(!support.checkOn){jQuery.valHooks[this].get=function(elem){return elem.getAttribute('value')===null?'on':elem.value}}});var nodeHook,boolHook,attrHandle=jQuery.expr.attrHandle,ruseDefault=/^(?:checked|selected)$/i,getSetAttribute=support.getSetAttribute,getSetInput=support.input;jQuery.fn.extend({attr:function(name,value){return access(this,jQuery.attr,name,value,arguments.length>1)},removeAttr:function(name){return this.each(function(){jQuery.removeAttr(this,name)})}});jQuery.extend({attr:function(elem,name,value){var hooks,ret,nType=elem.nodeType;if(!elem||nType===3||nType===8||nType===2){return}if(typeof elem.getAttribute===strundefined){return jQuery.prop(elem,name,value)}if(nType!==1||!jQuery.isXMLDoc(elem)){name=name.toLowerCase();hooks=jQuery.attrHooks[name]||(jQuery.expr.match.bool.test(name)?boolHook:nodeHook)}if(value!==undefined){if(value===null){jQuery.removeAttr(elem,name)}else if(hooks&&'set'in hooks&&(ret=hooks.set(elem,value,name))!==undefined){return ret}else{elem.setAttribute(name,value+'');return value}}else if(hooks&&'get'in hooks&&(ret=hooks.get(elem,name))!==null){return ret}else{ret=jQuery.find.attr(elem,name);return ret==null?undefined:ret}},removeAttr:function(elem,value){var name,propName,i=0,attrNames=value&&value.match(rnotwhite);if(attrNames&&elem.nodeType===1){while(name=attrNames[i++]){propName=jQuery.propFix[name]||name;if(jQuery.expr.match.bool.test(name)){if(getSetInput&&getSetAttribute||!ruseDefault.test(name)){elem[propName]=false}else{elem[jQuery.camelCase('default-'+name)]=elem[propName]=false}}else{jQuery.attr(elem,name,'')}elem.removeAttribute(getSetAttribute?name:propName)}}},attrHooks:{type:{set:function(elem,value){if(!support.radioValue&&value==='radio'&&jQuery.nodeName(elem,'input')){var val=elem.value;elem.setAttribute('type',value);if(val){elem.value=val}return value}}}}});boolHook={set:function(elem,value,name){if(value===false){jQuery.removeAttr(elem,name)}else if(getSetInput&&getSetAttribute||!ruseDefault.test(name)){elem.setAttribute(!getSetAttribute&&jQuery.propFix[name]||name,name)}else{elem[jQuery.camelCase('default-'+name)]=elem[name]=true}return name}};jQuery.each(jQuery.expr.match.bool.source.match(/\w+/g),function(i,name){var getter=attrHandle[name]||jQuery.find.attr;attrHandle[name]=getSetInput&&getSetAttribute||!ruseDefault.test(name)?function(elem,name,isXML){var ret,handle;if(!isXML){handle=attrHandle[name];attrHandle[name]=ret;ret=getter(elem,name,isXML)!=null?name.toLowerCase():null;attrHandle[name]=handle}return ret}:function(elem,name,isXML){if(!isXML){return elem[jQuery.camelCase('default-'+name)]?name.toLowerCase():null}}});if(!getSetInput||!getSetAttribute){jQuery.attrHooks.value={set:function(elem,value,name){if(jQuery.nodeName(elem,'input')){elem.defaultValue=value}else{return nodeHook&&nodeHook.set(elem,value,name)}}}}if(!getSetAttribute){nodeHook={set:function(elem,value,name){var ret=elem.getAttributeNode(name);if(!ret){elem.setAttributeNode(ret=elem.ownerDocument.createAttribute(name))}ret.value=value+='';if(name==='value'||value===elem.getAttribute(name)){return value}}};attrHandle.id=attrHandle.name=attrHandle.coords=function(elem,name,isXML){var ret;if(!isXML){return(ret=elem.getAttributeNode(name))&&ret.value!==''?ret.value:null}};jQuery.valHooks.button={get:function(elem,name){var ret=elem.getAttributeNode(name);if(ret&&ret.specified){return ret.value}},set:nodeHook.set};jQuery.attrHooks.contenteditable={set:function(elem,value,name){nodeHook.set(elem,value===''?false:value,name)}};jQuery.each(['width','height'],function(i,name){jQuery.attrHooks[name]={set:function(elem,value){if(value===''){elem.setAttribute(name,'auto');return value}}}})}if(!support.style){jQuery.attrHooks.style={get:function(elem){return elem.style.cssText||undefined},set:function(elem,value){return elem.style.cssText=value+''}}}var rfocusable=/^(?:input|select|textarea|button|object)$/i,rclickable=/^(?:a|area)$/i;jQuery.fn.extend({prop:function(name,value){return access(this,jQuery.prop,name,value,arguments.length>1)},removeProp:function(name){name=jQuery.propFix[name]||name;return this.each(function(){try{this[name]=undefined;delete this[name]}catch(e){}})}});jQuery.extend({propFix:{'for':'htmlFor','class':'className'},prop:function(elem,name,value){var ret,hooks,notxml,nType=elem.nodeType;if(!elem||nType===3||nType===8||nType===2){return}notxml=nType!==1||!jQuery.isXMLDoc(elem);if(notxml){name=jQuery.propFix[name]||name;hooks=jQuery.propHooks[name]}if(value!==undefined){return hooks&&'set'in hooks&&(ret=hooks.set(elem,value,name))!==undefined?ret:elem[name]=value}else{return hooks&&'get'in hooks&&(ret=hooks.get(elem,name))!==null?ret:elem[name]}},propHooks:{tabIndex:{get:function(elem){var tabindex=jQuery.find.attr(elem,'tabindex');return tabindex?parseInt(tabindex,10):rfocusable.test(elem.nodeName)||rclickable.test(elem.nodeName)&&elem.href?0:-1}}}});if(!support.hrefNormalized){jQuery.each(['href','src'],function(i,name){jQuery.propHooks[name]={get:function(elem){return elem.getAttribute(name,4)}}})}if(!support.optSelected){jQuery.propHooks.selected={get:function(elem){var parent=elem.parentNode;if(parent){parent.selectedIndex;if(parent.parentNode){parent.parentNode.selectedIndex}}return null}}}jQuery.each(['tabIndex','readOnly','maxLength','cellSpacing','cellPadding','rowSpan','colSpan','useMap','frameBorder','contentEditable'],function(){jQuery.propFix[this.toLowerCase()]=this});if(!support.enctype){jQuery.propFix.enctype='encoding'}var rclass=/[\t\r\n\f]/g;jQuery.fn.extend({addClass:function(value){var classes,elem,cur,clazz,j,finalValue,i=0,len=this.length,proceed=typeof value==='string'&&value;if(jQuery.isFunction(value)){return this.each(function(j){jQuery(this).addClass(value.call(this,j,this.className))})}if(proceed){classes=(value||'').match(rnotwhite)||[];for(;i<len;i++){elem=this[i];cur=elem.nodeType===1&&(elem.className?(' '+elem.className+' ').replace(rclass,' '):' ');if(cur){j=0;while(clazz=classes[j++]){if(cur.indexOf(' '+clazz+' ')<0){cur+=clazz+' '}}finalValue=jQuery.trim(cur);if(elem.className!==finalValue){elem.className=finalValue}}}}return this},removeClass:function(value){var classes,elem,cur,clazz,j,finalValue,i=0,len=this.length,proceed=arguments.length===0||typeof value==='string'&&value;if(jQuery.isFunction(value)){return this.each(function(j){jQuery(this).removeClass(value.call(this,j,this.className))})}if(proceed){classes=(value||'').match(rnotwhite)||[];for(;i<len;i++){elem=this[i];cur=elem.nodeType===1&&(elem.className?(' '+elem.className+' ').replace(rclass,' '):'');if(cur){j=0;while(clazz=classes[j++]){while(cur.indexOf(' '+clazz+' ')>=0){cur=cur.replace(' '+clazz+' ',' ')}}finalValue=value?jQuery.trim(cur):'';if(elem.className!==finalValue){elem.className=finalValue}}}}return this},toggleClass:function(value,stateVal){var type=typeof value;if(typeof stateVal==='boolean'&&type==='string'){return stateVal?this.addClass(value):this.removeClass(value)}if(jQuery.isFunction(value)){return this.each(function(i){jQuery(this).toggleClass(value.call(this,i,this.className,stateVal),stateVal)})}return this.each(function(){if(type==='string'){var className,i=0,self=jQuery(this),classNames=value.match(rnotwhite)||[];while(className=classNames[i++]){if(self.hasClass(className)){self.removeClass(className)}else{self.addClass(className)}}}else if(type===strundefined||type==='boolean'){if(this.className){jQuery._data(this,'__className__',this.className)}this.className=this.className||value===false?'':jQuery._data(this,'__className__')||''}})},hasClass:function(selector){var className=' '+selector+' ',i=0,l=this.length;for(;i<l;i++){if(this[i].nodeType===1&&(' '+this[i].className+' ').replace(rclass,' ').indexOf(className)>=0){return true}}return false}});jQuery.each(('blur focus focusin focusout load resize scroll unload click dblclick '+'mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave '+'change select submit keydown keypress keyup error contextmenu').split(' '),function(i,name){jQuery.fn[name]=function(data,fn){return arguments.length>0?this.on(name,null,data,fn):this.trigger(name)}});jQuery.fn.extend({hover:function(fnOver,fnOut){return this.mouseenter(fnOver).mouseleave(fnOut||fnOver)},bind:function(types,data,fn){return this.on(types,null,data,fn)},unbind:function(types,fn){return this.off(types,null,fn)},delegate:function(selector,types,data,fn){return this.on(types,selector,data,fn)},undelegate:function(selector,types,fn){return arguments.length===1?this.off(selector,'**'):this.off(types,selector||'**',fn)}});var nonce=jQuery.now();var rquery=/\?/;var rvalidtokens=/(,)|(\[|{)|(}|])|"(?:[^"\\\r\n]|\\["\\\/bfnrt]|\\u[\da-fA-F]{4})*"\s*:?|true|false|null|-?(?!0\d)\d+(?:\.\d+|)(?:[eE][+-]?\d+|)/g;jQuery.parseJSON=function(data){if(window.JSON&&window.JSON.parse){return window.JSON.parse(data+'')}var requireNonComma,depth=null,str=jQuery.trim(data+'');return str&&!jQuery.trim(str.replace(rvalidtokens,function(token,comma,open,close){if(requireNonComma&&comma){depth=0}if(depth===0){return token}requireNonComma=open||comma;depth+=!close-!open;return''}))?Function('return '+str)():jQuery.error('Invalid JSON: '+data)};jQuery.parseXML=function(data){var xml,tmp;if(!data||typeof data!=='string'){return null}try{if(window.DOMParser){tmp=new DOMParser;xml=tmp.parseFromString(data,'text/xml')}else{xml=new ActiveXObject('Microsoft.XMLDOM');xml.async='false';xml.loadXML(data)}}catch(e){xml=undefined}if(!xml||!xml.documentElement||xml.getElementsByTagName('parsererror').length){jQuery.error('Invalid XML: '+data)}return xml};var ajaxLocParts,ajaxLocation,rhash=/#.*$/,rts=/([?&])_=[^&]*/,rheaders=/^(.*?):[ \t]*([^\r\n]*)\r?$/mg,rlocalProtocol=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,rnoContent=/^(?:GET|HEAD)$/,rprotocol=/^\/\//,rurl=/^([\w.+-]+:)(?:\/\/(?:[^\/?#]*@|)([^\/?#:]*)(?::(\d+)|)|)/,prefilters={},transports={},allTypes='*/'.concat('*');try{ajaxLocation=location.href}catch(e){ajaxLocation=document.createElement('a');ajaxLocation.href='';ajaxLocation=ajaxLocation.href}ajaxLocParts=rurl.exec(ajaxLocation.toLowerCase())||[];function addToPrefiltersOrTransports(structure){return function(dataTypeExpression,func){if(typeof dataTypeExpression!=='string'){func=dataTypeExpression;dataTypeExpression='*'}var dataType,i=0,dataTypes=dataTypeExpression.toLowerCase().match(rnotwhite)||[];if(jQuery.isFunction(func)){while(dataType=dataTypes[i++]){if(dataType.charAt(0)==='+'){dataType=dataType.slice(1)||'*';(structure[dataType]=structure[dataType]||[]).unshift(func)}else{(structure[dataType]=structure[dataType]||[]).push(func)}}}}}function inspectPrefiltersOrTransports(structure,options,originalOptions,jqXHR){var inspected={},seekingTransport=structure===transports;function inspect(dataType){var selected;inspected[dataType]=true;jQuery.each(structure[dataType]||[],function(_,prefilterOrFactory){var dataTypeOrTransport=prefilterOrFactory(options,originalOptions,jqXHR);if(typeof dataTypeOrTransport==='string'&&!seekingTransport&&!inspected[dataTypeOrTransport]){options.dataTypes.unshift(dataTypeOrTransport);inspect(dataTypeOrTransport);return false}else if(seekingTransport){return!(selected=dataTypeOrTransport)}});return selected}return inspect(options.dataTypes[0])||!inspected['*']&&inspect('*')}function ajaxExtend(target,src){var deep,key,flatOptions=jQuery.ajaxSettings.flatOptions||{};for(key in src){if(src[key]!==undefined){(flatOptions[key]?target:deep||(deep={}))[key]=src[key]}}if(deep){jQuery.extend(true,target,deep)}return target}function ajaxHandleResponses(s,jqXHR,responses){var firstDataType,ct,finalDataType,type,contents=s.contents,dataTypes=s.dataTypes;while(dataTypes[0]==='*'){dataTypes.shift();if(ct===undefined){ct=s.mimeType||jqXHR.getResponseHeader('Content-Type')}}if(ct){for(type in contents){if(contents[type]&&contents[type].test(ct)){dataTypes.unshift(type);break}}}if(dataTypes[0]in responses){finalDataType=dataTypes[0]}else{for(type in responses){if(!dataTypes[0]||s.converters[type+' '+dataTypes[0]]){finalDataType=type;break}if(!firstDataType){firstDataType=type}}finalDataType=finalDataType||firstDataType}if(finalDataType){if(finalDataType!==dataTypes[0]){dataTypes.unshift(finalDataType)}return responses[finalDataType]}}function ajaxConvert(s,response,jqXHR,isSuccess){var conv2,current,conv,tmp,prev,converters={},dataTypes=s.dataTypes.slice();if(dataTypes[1]){for(conv in s.converters){converters[conv.toLowerCase()]=s.converters[conv]}}current=dataTypes.shift();while(current){if(s.responseFields[current]){jqXHR[s.responseFields[current]]=response}if(!prev&&isSuccess&&s.dataFilter){response=s.dataFilter(response,s.dataType)}prev=current;current=dataTypes.shift();if(current){if(current==='*'){current=prev}else if(prev!=='*'&&prev!==current){conv=converters[prev+' '+current]||converters['* '+current];if(!conv){for(conv2 in converters){tmp=conv2.split(' ');if(tmp[1]===current){conv=converters[prev+' '+tmp[0]]||converters['* '+tmp[0]];if(conv){if(conv===true){conv=converters[conv2]}else if(converters[conv2]!==true){current=tmp[0];dataTypes.unshift(tmp[1])}break}}}}if(conv!==true){if(conv&&s['throws']){response=conv(response)}else{try{response=conv(response)}catch(e){return{state:'parsererror',error:conv?e:'No conversion from '+prev+' to '+current}}}}}}}return{state:'success',data:response}}jQuery.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:ajaxLocation,type:'GET',isLocal:rlocalProtocol.test(ajaxLocParts[1]),global:true,processData:true,async:true,contentType:'application/x-www-form-urlencoded; charset=UTF-8',accepts:{'*':allTypes,text:'text/plain',html:'text/html',xml:'application/xml, text/xml',json:'application/json, text/javascript'},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:'responseXML',text:'responseText',json:'responseJSON'},converters:{'* text':String,'text html':true,'text json':jQuery.parseJSON,'text xml':jQuery.parseXML},flatOptions:{url:true,context:true}},ajaxSetup:function(target,settings){return settings?ajaxExtend(ajaxExtend(target,jQuery.ajaxSettings),settings):ajaxExtend(jQuery.ajaxSettings,target)},ajaxPrefilter:addToPrefiltersOrTransports(prefilters),ajaxTransport:addToPrefiltersOrTransports(transports),ajax:function(url,options){if(typeof url==='object'){options=url;url=undefined}options=options||{};var parts,i,cacheURL,responseHeadersString,timeoutTimer,fireGlobals,transport,responseHeaders,s=jQuery.ajaxSetup({},options),callbackContext=s.context||s,globalEventContext=s.context&&(callbackContext.nodeType||callbackContext.jquery)?jQuery(callbackContext):jQuery.event,deferred=jQuery.Deferred(),completeDeferred=jQuery.Callbacks('once memory'),statusCode=s.statusCode||{},requestHeaders={},requestHeadersNames={},state=0,strAbort='canceled',jqXHR={readyState:0,getResponseHeader:function(key){var match;if(state===2){if(!responseHeaders){responseHeaders={};while(match=rheaders.exec(responseHeadersString)){responseHeaders[match[1].toLowerCase()]=match[2]}}match=responseHeaders[key.toLowerCase()]}return match==null?null:match},getAllResponseHeaders:function(){return state===2?responseHeadersString:null},setRequestHeader:function(name,value){var lname=name.toLowerCase();if(!state){name=requestHeadersNames[lname]=requestHeadersNames[lname]||name;requestHeaders[name]=value}return this},overrideMimeType:function(type){if(!state){s.mimeType=type}return this},statusCode:function(map){var code;if(map){if(state<2){for(code in map){statusCode[code]=[statusCode[code],map[code]]}}else{jqXHR.always(map[jqXHR.status])}}return this},abort:function(statusText){var finalText=statusText||strAbort;if(transport){transport.abort(finalText)}done(0,finalText);return this}};deferred.promise(jqXHR).complete=completeDeferred.add;jqXHR.success=jqXHR.done;jqXHR.error=jqXHR.fail;s.url=((url||s.url||ajaxLocation)+'').replace(rhash,'').replace(rprotocol,ajaxLocParts[1]+'//');s.type=options.method||options.type||s.method||s.type;s.dataTypes=jQuery.trim(s.dataType||'*').toLowerCase().match(rnotwhite)||[''];if(s.crossDomain==null){parts=rurl.exec(s.url.toLowerCase());s.crossDomain=!!(parts&&(parts[1]!==ajaxLocParts[1]||parts[2]!==ajaxLocParts[2]||(parts[3]||(parts[1]==='http:'?'80':'443'))!==(ajaxLocParts[3]||(ajaxLocParts[1]==='http:'?'80':'443'))))}if(s.data&&s.processData&&typeof s.data!=='string'){s.data=jQuery.param(s.data,s.traditional)}inspectPrefiltersOrTransports(prefilters,s,options,jqXHR);if(state===2){return jqXHR}fireGlobals=s.global;if(fireGlobals&&jQuery.active++===0){jQuery.event.trigger('ajaxStart')}s.type=s.type.toUpperCase();s.hasContent=!rnoContent.test(s.type);cacheURL=s.url;if(!s.hasContent){if(s.data){cacheURL=s.url+=(rquery.test(cacheURL)?'&':'?')+s.data;delete s.data}if(s.cache===false){s.url=rts.test(cacheURL)?cacheURL.replace(rts,'$1_='+nonce++):cacheURL+(rquery.test(cacheURL)?'&':'?')+'_='+nonce++}}if(s.ifModified){if(jQuery.lastModified[cacheURL]){jqXHR.setRequestHeader('If-Modified-Since',jQuery.lastModified[cacheURL])}if(jQuery.etag[cacheURL]){jqXHR.setRequestHeader('If-None-Match',jQuery.etag[cacheURL])}}if(s.data&&s.hasContent&&s.contentType!==false||options.contentType){jqXHR.setRequestHeader('Content-Type',s.contentType)}jqXHR.setRequestHeader('Accept',s.dataTypes[0]&&s.accepts[s.dataTypes[0]]?s.accepts[s.dataTypes[0]]+(s.dataTypes[0]!=='*'?', '+allTypes+'; q=0.01':''):s.accepts['*']);for(i in s.headers){jqXHR.setRequestHeader(i,s.headers[i])}if(s.beforeSend&&(s.beforeSend.call(callbackContext,jqXHR,s)===false||state===2)){return jqXHR.abort()}strAbort='abort';for(i in{success:1,error:1,complete:1}){jqXHR[i](s[i])}transport=inspectPrefiltersOrTransports(transports,s,options,jqXHR);if(!transport){done(-1,'No Transport')}else{jqXHR.readyState=1;if(fireGlobals){globalEventContext.trigger('ajaxSend',[jqXHR,s])}if(s.async&&s.timeout>0){timeoutTimer=setTimeout(function(){jqXHR.abort('timeout')},s.timeout)}try{state=1;transport.send(requestHeaders,done)}catch(e){if(state<2){done(-1,e)}else{throw e}}}function done(status,nativeStatusText,responses,headers){var isSuccess,success,error,response,modified,statusText=nativeStatusText;if(state===2){return}state=2;if(timeoutTimer){clearTimeout(timeoutTimer)}transport=undefined;responseHeadersString=headers||'';jqXHR.readyState=status>0?4:0;isSuccess=status>=200&&status<300||status===304;if(responses){response=ajaxHandleResponses(s,jqXHR,responses)}response=ajaxConvert(s,response,jqXHR,isSuccess);if(isSuccess){if(s.ifModified){modified=jqXHR.getResponseHeader('Last-Modified');if(modified){jQuery.lastModified[cacheURL]=modified}modified=jqXHR.getResponseHeader('etag');if(modified){jQuery.etag[cacheURL]=modified}}if(status===204||s.type==='HEAD'){statusText='nocontent'}else if(status===304){statusText='notmodified'}else{statusText=response.state;success=response.data;error=response.error;isSuccess=!error}}else{error=statusText;if(status||!statusText){statusText='error';if(status<0){status=0}}}jqXHR.status=status;jqXHR.statusText=(nativeStatusText||statusText)+'';if(isSuccess){deferred.resolveWith(callbackContext,[success,statusText,jqXHR])}else{deferred.rejectWith(callbackContext,[jqXHR,statusText,error])}jqXHR.statusCode(statusCode);statusCode=undefined;if(fireGlobals){globalEventContext.trigger(isSuccess?'ajaxSuccess':'ajaxError',[jqXHR,s,isSuccess?success:error])}completeDeferred.fireWith(callbackContext,[jqXHR,statusText]);if(fireGlobals){globalEventContext.trigger('ajaxComplete',[jqXHR,s]);if(!--jQuery.active){jQuery.event.trigger('ajaxStop')}}}return jqXHR},getJSON:function(url,data,callback){return jQuery.get(url,data,callback,'json')},getScript:function(url,callback){return jQuery.get(url,undefined,callback,'script')}});jQuery.each(['get','post'],function(i,method){jQuery[method]=function(url,data,callback,type){if(jQuery.isFunction(data)){type=type||callback;callback=data;data=undefined}return jQuery.ajax({url:url,type:method,dataType:type,data:data,success:callback})}});jQuery.each(['ajaxStart','ajaxStop','ajaxComplete','ajaxError','ajaxSuccess','ajaxSend'],function(i,type){jQuery.fn[type]=function(fn){return this.on(type,fn)}});jQuery._evalUrl=function(url){return jQuery.ajax({url:url,type:'GET',dataType:'script',async:false,global:false,'throws':true})};jQuery.fn.extend({wrapAll:function(html){if(jQuery.isFunction(html)){return this.each(function(i){jQuery(this).wrapAll(html.call(this,i))})}if(this[0]){var wrap=jQuery(html,this[0].ownerDocument).eq(0).clone(true);if(this[0].parentNode){wrap.insertBefore(this[0])}wrap.map(function(){var elem=this;while(elem.firstChild&&elem.firstChild.nodeType===1){elem=elem.firstChild}return elem}).append(this)}return this},wrapInner:function(html){if(jQuery.isFunction(html)){return this.each(function(i){jQuery(this).wrapInner(html.call(this,i))})}return this.each(function(){var self=jQuery(this),contents=self.contents();if(contents.length){contents.wrapAll(html)}else{self.append(html)}})},wrap:function(html){var isFunction=jQuery.isFunction(html);return this.each(function(i){jQuery(this).wrapAll(isFunction?html.call(this,i):html)})},unwrap:function(){return this.parent().each(function(){if(!jQuery.nodeName(this,'body')){jQuery(this).replaceWith(this.childNodes)}}).end()}});jQuery.expr.filters.hidden=function(elem){return elem.offsetWidth<=0&&elem.offsetHeight<=0||!support.reliableHiddenOffsets()&&(elem.style&&elem.style.display||jQuery.css(elem,'display'))==='none'};jQuery.expr.filters.visible=function(elem){return!jQuery.expr.filters.hidden(elem)};var r20=/%20/g,rbracket=/\[\]$/,rCRLF=/\r?\n/g,rsubmitterTypes=/^(?:submit|button|image|reset|file)$/i,rsubmittable=/^(?:input|select|textarea|keygen)/i;function buildParams(prefix,obj,traditional,add){var name;if(jQuery.isArray(obj)){jQuery.each(obj,function(i,v){if(traditional||rbracket.test(prefix)){add(prefix,v)}else{buildParams(prefix+'['+(typeof v==='object'?i:'')+']',v,traditional,add)}})}else if(!traditional&&jQuery.type(obj)==='object'){for(name in obj){buildParams(prefix+'['+name+']',obj[name],traditional,add)}}else{add(prefix,obj)}}jQuery.param=function(a,traditional){var prefix,s=[],add=function(key,value){value=jQuery.isFunction(value)?value():value==null?'':value;s[s.length]=encodeURIComponent(key)+'='+encodeURIComponent(value)};if(traditional===undefined){traditional=jQuery.ajaxSettings&&jQuery.ajaxSettings.traditional}if(jQuery.isArray(a)||a.jquery&&!jQuery.isPlainObject(a)){jQuery.each(a,function(){add(this.name,this.value)})}else{for(prefix in a){buildParams(prefix,a[prefix],traditional,add)}}return s.join('&').replace(r20,'+')};jQuery.fn.extend({serialize:function(){return jQuery.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var elements=jQuery.prop(this,'elements');return elements?jQuery.makeArray(elements):this}).filter(function(){var type=this.type;return this.name&&!jQuery(this).is(':disabled')&&rsubmittable.test(this.nodeName)&&!rsubmitterTypes.test(type)&&(this.checked||!rcheckableType.test(type))}).map(function(i,elem){var val=jQuery(this).val();return val==null?null:jQuery.isArray(val)?jQuery.map(val,function(val){return{name:elem.name,value:val.replace(rCRLF,'\r\n')}}):{name:elem.name,value:val.replace(rCRLF,'\r\n')}}).get()}});jQuery.ajaxSettings.xhr=window.ActiveXObject!==undefined?function(){return!this.isLocal&&/^(get|post|head|put|delete|options)$/i.test(this.type)&&createStandardXHR()||createActiveXHR()}:createStandardXHR;var xhrId=0,xhrCallbacks={},xhrSupported=jQuery.ajaxSettings.xhr();if(window.ActiveXObject){jQuery(window).on('unload',function(){for(var key in xhrCallbacks){xhrCallbacks[key](undefined,true)}})}support.cors=!!xhrSupported&&'withCredentials'in xhrSupported;xhrSupported=support.ajax=!!xhrSupported;if(xhrSupported){jQuery.ajaxTransport(function(options){if(!options.crossDomain||support.cors){var callback;return{send:function(headers,complete){var i,xhr=options.xhr(),id=++xhrId;xhr.open(options.type,options.url,options.async,options.username,options.password);if(options.xhrFields){for(i in options.xhrFields){xhr[i]=options.xhrFields[i]}}if(options.mimeType&&xhr.overrideMimeType){xhr.overrideMimeType(options.mimeType)}if(!options.crossDomain&&!headers['X-Requested-With']){headers['X-Requested-With']='XMLHttpRequest'}for(i in headers){if(headers[i]!==undefined){xhr.setRequestHeader(i,headers[i]+'')}}xhr.send(options.hasContent&&options.data||null);callback=function(_,isAbort){var status,statusText,responses;if(callback&&(isAbort||xhr.readyState===4)){delete xhrCallbacks[id];callback=undefined;xhr.onreadystatechange=jQuery.noop;if(isAbort){if(xhr.readyState!==4){xhr.abort()}}else{responses={};status=xhr.status;if(typeof xhr.responseText==='string'){responses.text=xhr.responseText}try{statusText=xhr.statusText}catch(e){statusText=''}if(!status&&options.isLocal&&!options.crossDomain){status=responses.text?200:404}else if(status===1223){status=204}}}if(responses){complete(status,statusText,responses,xhr.getAllResponseHeaders())}};if(!options.async){callback()}else if(xhr.readyState===4){setTimeout(callback)}else{xhr.onreadystatechange=xhrCallbacks[id]=callback}},abort:function(){if(callback){callback(undefined,true)}}}}})}function createStandardXHR(){try{return new window.XMLHttpRequest}catch(e){}}function createActiveXHR(){try{return new window.ActiveXObject('Microsoft.XMLHTTP')}catch(e){}}jQuery.ajaxSetup({accepts:{script:'text/javascript, application/javascript, application/ecmascript, application/x-ecmascript'},contents:{script:/(?:java|ecma)script/},converters:{'text script':function(text){jQuery.globalEval(text);return text}}});jQuery.ajaxPrefilter('script',function(s){if(s.cache===undefined){s.cache=false}if(s.crossDomain){s.type='GET';s.global=false}});jQuery.ajaxTransport('script',function(s){if(s.crossDomain){var script,head=document.head||jQuery('head')[0]||document.documentElement;return{send:function(_,callback){script=document.createElement('script');script.async=true;if(s.scriptCharset){script.charset=s.scriptCharset}script.src=s.url;script.onload=script.onreadystatechange=function(_,isAbort){if(isAbort||!script.readyState||/loaded|complete/.test(script.readyState)){script.onload=script.onreadystatechange=null;if(script.parentNode){script.parentNode.removeChild(script)}script=null;if(!isAbort){callback(200,'success')}}};head.insertBefore(script,head.firstChild)},abort:function(){if(script){script.onload(undefined,true)}}}}});var oldCallbacks=[],rjsonp=/(=)\?(?=&|$)|\?\?/;jQuery.ajaxSetup({jsonp:'callback',jsonpCallback:function(){var callback=oldCallbacks.pop()||jQuery.expando+'_'+nonce++;this[callback]=true;return callback}});jQuery.ajaxPrefilter('json jsonp',function(s,originalSettings,jqXHR){var callbackName,overwritten,responseContainer,jsonProp=s.jsonp!==false&&(rjsonp.test(s.url)?'url':typeof s.data==='string'&&!(s.contentType||'').indexOf('application/x-www-form-urlencoded')&&rjsonp.test(s.data)&&'data');if(jsonProp||s.dataTypes[0]==='jsonp'){callbackName=s.jsonpCallback=jQuery.isFunction(s.jsonpCallback)?s.jsonpCallback():s.jsonpCallback;if(jsonProp){s[jsonProp]=s[jsonProp].replace(rjsonp,'$1'+callbackName)}else if(s.jsonp!==false){s.url+=(rquery.test(s.url)?'&':'?')+s.jsonp+'='+callbackName}s.converters['script json']=function(){if(!responseContainer){jQuery.error(callbackName+' was not called')}return responseContainer[0]};s.dataTypes[0]='json';overwritten=window[callbackName];window[callbackName]=function(){responseContainer=arguments};jqXHR.always(function(){window[callbackName]=overwritten;if(s[callbackName]){s.jsonpCallback=originalSettings.jsonpCallback;oldCallbacks.push(callbackName)}if(responseContainer&&jQuery.isFunction(overwritten)){overwritten(responseContainer[0])}responseContainer=overwritten=undefined});return'script'}});jQuery.parseHTML=function(data,context,keepScripts){if(!data||typeof data!=='string'){return null}if(typeof context==='boolean'){keepScripts=context;context=false}context=context||document;var parsed=rsingleTag.exec(data),scripts=!keepScripts&&[];if(parsed){return[context.createElement(parsed[1])]}parsed=jQuery.buildFragment([data],context,scripts);if(scripts&&scripts.length){jQuery(scripts).remove()}return jQuery.merge([],parsed.childNodes)};var _load=jQuery.fn.load;jQuery.fn.load=function(url,params,callback){if(typeof url!=='string'&&_load){return _load.apply(this,arguments)}var selector,response,type,self=this,off=url.indexOf(' ');if(off>=0){selector=url.slice(off,url.length);url=url.slice(0,off)}if(jQuery.isFunction(params)){callback=params;params=undefined}else if(params&&typeof params==='object'){type='POST'}if(self.length>0){jQuery.ajax({url:url,type:type,dataType:'html',data:params}).done(function(responseText){response=arguments;self.html(selector?jQuery('<div>').append(jQuery.parseHTML(responseText)).find(selector):responseText)}).complete(callback&&function(jqXHR,status){self.each(callback,response||[jqXHR.responseText,status,jqXHR])})}return this};jQuery.expr.filters.animated=function(elem){return jQuery.grep(jQuery.timers,function(fn){return elem===fn.elem}).length};var docElem=window.document.documentElement;function getWindow(elem){return jQuery.isWindow(elem)?elem:elem.nodeType===9?elem.defaultView||elem.parentWindow:false}jQuery.offset={setOffset:function(elem,options,i){var curPosition,curLeft,curCSSTop,curTop,curOffset,curCSSLeft,calculatePosition,position=jQuery.css(elem,'position'),curElem=jQuery(elem),props={};if(position==='static'){elem.style.position='relative'}curOffset=curElem.offset();curCSSTop=jQuery.css(elem,'top');curCSSLeft=jQuery.css(elem,'left');calculatePosition=(position==='absolute'||position==='fixed')&&jQuery.inArray('auto',[curCSSTop,curCSSLeft])>-1;if(calculatePosition){curPosition=curElem.position();curTop=curPosition.top;curLeft=curPosition.left}else{curTop=parseFloat(curCSSTop)||0;curLeft=parseFloat(curCSSLeft)||0}if(jQuery.isFunction(options)){options=options.call(elem,i,curOffset)}if(options.top!=null){props.top=options.top-curOffset.top+curTop}if(options.left!=null){props.left=options.left-curOffset.left+curLeft}if('using'in options){options.using.call(elem,props)}else{curElem.css(props)}}};jQuery.fn.extend({offset:function(options){if(arguments.length){return options===undefined?this:this.each(function(i){jQuery.offset.setOffset(this,options,i)})}var docElem,win,box={top:0,left:0},elem=this[0],doc=elem&&elem.ownerDocument;if(!doc){return}docElem=doc.documentElement;if(!jQuery.contains(docElem,elem)){return box}if(typeof elem.getBoundingClientRect!==strundefined){box=elem.getBoundingClientRect()}win=getWindow(doc);return{top:box.top+(win.pageYOffset||docElem.scrollTop)-(docElem.clientTop||0),left:box.left+(win.pageXOffset||docElem.scrollLeft)-(docElem.clientLeft||0)}},position:function(){if(!this[0]){return}var offsetParent,offset,parentOffset={top:0,left:0},elem=this[0];if(jQuery.css(elem,'position')==='fixed'){offset=elem.getBoundingClientRect()}else{offsetParent=this.offsetParent();offset=this.offset();if(!jQuery.nodeName(offsetParent[0],'html')){parentOffset=offsetParent.offset()}parentOffset.top+=jQuery.css(offsetParent[0],'borderTopWidth',true);parentOffset.left+=jQuery.css(offsetParent[0],'borderLeftWidth',true)}return{top:offset.top-parentOffset.top-jQuery.css(elem,'marginTop',true),left:offset.left-parentOffset.left-jQuery.css(elem,'marginLeft',true)}},offsetParent:function(){return this.map(function(){var offsetParent=this.offsetParent||docElem;while(offsetParent&&(!jQuery.nodeName(offsetParent,'html')&&jQuery.css(offsetParent,'position')==='static')){offsetParent=offsetParent.offsetParent}return offsetParent||docElem})}});jQuery.each({scrollLeft:'pageXOffset',scrollTop:'pageYOffset'},function(method,prop){var top=/Y/.test(prop);jQuery.fn[method]=function(val){return access(this,function(elem,method,val){var win=getWindow(elem);if(val===undefined){return win?prop in win?win[prop]:win.document.documentElement[method]:elem[method]}if(win){win.scrollTo(!top?val:jQuery(win).scrollLeft(),top?val:jQuery(win).scrollTop())}else{elem[method]=val}},method,val,arguments.length,null)}});jQuery.each(['top','left'],function(i,prop){jQuery.cssHooks[prop]=addGetHookIf(support.pixelPosition,function(elem,computed){if(computed){computed=curCSS(elem,prop);return rnumnonpx.test(computed)?jQuery(elem).position()[prop]+'px':computed}})});jQuery.each({Height:'height',Width:'width'},function(name,type){jQuery.each({padding:'inner'+name,content:type,'':'outer'+name},function(defaultExtra,funcName){jQuery.fn[funcName]=function(margin,value){var chainable=arguments.length&&(defaultExtra||typeof margin!=='boolean'),extra=defaultExtra||(margin===true||value===true?'margin':'border');return access(this,function(elem,type,value){var doc;if(jQuery.isWindow(elem)){return elem.document.documentElement['client'+name]}if(elem.nodeType===9){doc=elem.documentElement;return Math.max(elem.body['scroll'+name],doc['scroll'+name],elem.body['offset'+name],doc['offset'+name],doc['client'+name])}return value===undefined?jQuery.css(elem,type,extra):jQuery.style(elem,type,value,extra)},type,chainable?margin:undefined,chainable,null)}})});jQuery.fn.size=function(){return this.length};jQuery.fn.andSelf=jQuery.fn.addBack;if(typeof define==='function'&&define.amd){define('node_modules/jquery/dist/jquery.js',[],function(){return jQuery})&&define('jquery',['node_modules/jquery/dist/jquery.js'],function(m){return m})}var _jQuery=window.jQuery,_$=window.$;jQuery.noConflict=function(deep){if(window.$===jQuery){window.$=_$}if(deep&&window.jQuery===jQuery){window.jQuery=_jQuery}return jQuery};if(typeof noGlobal===strundefined){window.jQuery=window.$=jQuery}return jQuery}))}());(function(){var define=System.amdDefine;define('common/util.js',['node_modules/jquery/dist/jquery.js'],function($){var util={};util.escapeRegExp=function(str){return str.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,'\\$&')};util.htmlEncode=function(text){return text.replace(/[&<>"'`]/g,function(chr){return'&#'+chr.charCodeAt(0)+';'})};util.leftPad=function(str,length,padChar){str=String(str);while(str.length<length){str=(padChar||' ')+str}return str};util.trimArray=function(arr,trimEmptyStringsToo){return arr.filter(function(item){return item!==undefined&&(!trimEmptyStringsToo||item!=='')})};util.arrayRemove=function(arr,elementsToRemove){return arr.filter(function(element){return elementsToRemove.indexOf(element)<0})};util.getUniqueName=function(list,name){var clashes=list.map(function(item){var m=0;if(item===name){return 0}else{m=/(.*)(?:-(\d+))/.exec(item);if(m&&m[1]===name){return m[2]}else{return-1}}}),num=-1;if(clashes.length!==0){num=Math.max.apply(null,clashes);if(num!==-1){return name+'-'+(num+1)}}return name};util.contains=function(text,query,ignoreCase){if(!text){return false}if(query&&ignoreCase){text=text.toLowerCase();query=query.toLowerCase()}return text.indexOf(query)!==-1};util.entries=function(dictionary){return Object.keys(dictionary).map(function(key){return{key:key,value:dictionary[key]}})};util.unique=function(list,selector){var seen={};return list.filter(function(value){var key=selector?selector(value):value;if(seen[key]){return false}else{seen[key]=true;return true}})};util.decodePairs=function(text,allowDuplicates){text=text||'';var entries=text.split('&');var result={};entries.forEach(function(entry){var pair=entry.split('=');if(allowDuplicates){var values=result[decodeURIComponent(pair[0])]=result[decodeURIComponent(pair[0])]||[];values.push(decodeURIComponent(pair[1]))}else{result[decodeURIComponent(pair[0])]=decodeURIComponent(pair[1])}});return result};util.encodePairs=function(hash){return util.entries(hash).map(function(entry){return encodeURIComponent(entry.key)+'='+encodeURIComponent(entry.value)}).join('&')};util.createUrlQueryPart=function(hash){return Object.keys(hash).length?'?'+util.encodePairs(hash):''};util.getQueryParameters=function(){var query=window.location.search.substring(1);return util.decodePairs(query)};util.bySortKeyComparator=function(a,b){var aSortKey=a.sortKey(),bSortKey=b.sortKey();return!aSortKey?!bSortKey?0:1:!bSortKey?-1:aSortKey<bSortKey?-1:aSortKey>bSortKey?1:0};var CHARS='0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz'.split('');util.uuid=function(len,radix){var chars=CHARS,uuid=[],i,r;radix=radix||chars.length;if(len){for(i=0;i<len;i+=1){uuid[i]=chars[0|Math.random()*radix]}}else{uuid[8]=uuid[13]=uuid[18]=uuid[23]='-';uuid[14]='4';for(i=0;i<36;i+=1){if(!uuid[i]){r=0|Math.random()*16;uuid[i]=chars[i===19?r&3|8:r]}}}return uuid.join('')};util.byFileComparator=function(obj1,obj2){if(obj1.justAdded!==obj2.justAdded){return obj1.justAdded?1:-1}if(obj1.displayName>obj2.displayName){return 1}if(obj1.displayName<obj2.displayName){return-1}if(obj1.size>obj2.size){return-1}if(obj1.size<obj2.size){return 1}return 0};var folderTranslations=TR('common.FolderName',{'INBOX':'Inbox','INBOX.Drafts':'Drafts','INBOX.Trash':'Trash','INBOX.Sent':'Sent','INBOX.Spam':'Spam'});util.translatedFolderName=function(folderId){if(folderId){return folderTranslations[folderId]||folderId.split(/\./).pop()}return''};util.unAbsolutizeApiLinks=function(html){var $html=$('<div>'+html+'</div>'),origin=location.origin||location.protocol+'//'+location.host;$('img[src^="'+origin+'"]',$html).each(function(){var $img=$(this);$img.attr('src',$img.attr('src').replace(origin+'/api/','/api/'))});return $html.html()};util.pick=function(obj,keys){var copy={};if(obj){if(!Array.isArray(keys)){var args=Array.prototype.slice.call(arguments,1);keys=[].concat(args)}keys.forEach(function(key){copy[key]=obj[key]})}return copy};util.omit=function(obj,keys){var copy={};if(obj){if(!Array.isArray(keys)){var args=Array.prototype.slice.call(arguments,1);keys=[].concat(args)}var keyIndex=util.uniqueIndexBy(keys);Object.keys(obj).filter(function(key){return!(key in keyIndex)}).forEach(function(key){copy[key]=obj[key]})}return copy};util.extend=function(obj){var args=Array.prototype.slice.call(arguments,1);args.forEach(function(source){if(source){for(var prop in source){obj[prop]=source[prop]}}});return obj};util.defaults=function(obj){var args=Array.prototype.slice.call(arguments,1);args.forEach(function(source){if(source){for(var prop in source){if(obj[prop]===undefined){obj[prop]=source[prop]}}}});return obj};util.indexBy=function(list,selector){return list.reduce(function(result,item){var property=item;if(selector){property=typeof selector==='string'?item[selector]:selector(item)}var indexed=property in result;if(!indexed){result[property]=[]}result[property].push(item);return result},{})};util.uniqueIndexBy=function(list,selector){var index=util.indexBy(list,selector);Object.keys(index).forEach(function(key){index[key]=index[key][0]});return index};util.textToHtml=function(text){return text.replace(/\r?\n/g,'<br>\n')};util.hasModifierKey=function(e){return e.ctrlKey||e.shiftKey||e.metaKey};util.compareStrings=function(x,y,ignoreCase){x=x||'';y=y||'';if(ignoreCase){x=x.toLowerCase();y=y.toLowerCase()}if(x<y){return-1}if(x>y){return 1}if(x===y){return 0}};util.range=function(length,startIndex,stepSize){startIndex=startIndex||0;stepSize=stepSize||1;return Array.apply(null,new Array(length)).map(function(_,i){return i*stepSize+startIndex})};util.takeWhile=function(list,predicate){var result=[];list.every(function(item){if(predicate(item)){result.push(item);return true}else{return false}});return result};util.composerOptionsFromMailto=function(mailto){mailto=mailto.replace(/^mailto:/,'');var options={to:mailto.replace(/\?.*$/,'')},paramArray=mailto.match(/^.*\?((?:(?:[^=& ]+=[^&]+)&)*(?:[^=& ]+=[^&]+))$/),params;if(paramArray){params=paramArray[1].split(/&/);params.forEach(function(param){var parts=param.split(/\=/);if(parts[0]==='to'){options.to+=','+decodeURIComponent(parts[1])}else{options[parts[0]]=decodeURIComponent(parts[1])}})}return options};util.isFileAnImage=function(file){var val=/^image\/(?:gif|png|x-png|tiff|jpeg|pjpeg|jpg)$/.test(file.type);return val};util.arrayEquals=function(a,b,itemComparer){if(a===b){return true}if(!a&&!b){return true}if(!a||!b){return false}if(a.length!==b.length){return false}itemComparer=itemComparer||function(aItem,bItem){return aItem===bItem};for(var i=0;i<a.length;i+=1){if(!itemComparer(a[i],b[i])){return false}}return true};util.firstUp=function(text){if(!text){return text}return text[0].toUpperCase()+text.slice(1)};function flattenTo(arr,result){arr.forEach(function(item){if(Array.isArray(item)){flattenTo(item,result)}else{result.push(item)}})}util.flatten=function(arr){var result=[];flattenTo(arr,result);return result};util.distinguishFileFromDirectory=function(inFiles,cb){var reader,fileReadDone,checkFile,files=[],directories=[];fileReadDone=function(){if(files.length+directories.length===inFiles.length){cb(files,directories)}};checkFile=function(file){reader=new FileReader;reader.onload=function(){files.push(file);fileReadDone()};reader.onerror=function(){directories.push(file);fileReadDone()};reader.readAsArrayBuffer(file)};for(var i=0;i<inFiles.length;i+=1){checkFile(inFiles[i])}};return util})}());(function(){var define=System.amdDefine;(function(root,factory){if(typeof exports==='object'){module.exports=factory()}else if(typeof define==='function'&&define.amd){define('3rdparty/action-executor/ActionNotReadyError.js',[],factory)}else{root.com=root.com||{};root.com.one=root.com.one||{};root.com.one.ActionNotReadyError=factory()}}(this,function(){function ActionNotReadyError(){}ActionNotReadyError.prototype=new Error;return ActionNotReadyError}))}());(function(){var define=System.amdDefine;define('common/ActionBehavior.js',['3rdparty/action-executor/ActionNotReadyError.js'],function(ActionNotReadyError){var ActionBehavior={installInto:function(target){if(!target.models){target.models=function(){return[]}}if(!target.validate){target.validate=function(){}}var models;function updateBusyFlags(value){[].concat(models).forEach(function(model){return model.busy(value)})}target.setBusyFlags=function(){updateBusyFlags(true)};target.removeBusyFlags=function(){updateBusyFlags(false)};function modelsReady(){return![].concat(models).some(function(model){return model.busy()})}var execute=target.execute;target.execute=function(context,cb){this.context=context;this.validate(context);models=this.models(context);if(!modelsReady()){cb(new ActionNotReadyError)}else{execute.call(this,context,function(){cb.apply(null,arguments)})}}}};return ActionBehavior})}());(function(){var define=System.amdDefine;define('calendar/actions/UpdateCalendarAction.js',['common/util.js','common/ActionBehavior.js'],function(util,ActionBehavior){function UpdateCalendarAction(options){util.extend(this,util.pick(options,'calendar','data'));ActionBehavior.installInto(this)}UpdateCalendarAction.prototype.name='UpdateCalendarAction';UpdateCalendarAction.prototype.validate=function(){};UpdateCalendarAction.prototype.execute=function(context,callback){var that=this;var state=context.state;var backend=context.backend;var dialogToServerMapping={'color':'color','enabled':'enabled','default':'default','displayName':'name'};var serverToModelMapping={'color':'color','enabled':'enabled','default':'defaultCalendar','name':'name'};var calendar=that.calendar;var data={};Object.keys(dialogToServerMapping).filter(function(property){return that.data.hasOwnProperty(property)}).forEach(function(property){data[dialogToServerMapping[property]]=that.data[property]});state.calendars.all().filter(function(cal){return cal.id!==calendar.id&&data.default}).forEach(function(cal){cal.defaultCalendar(false)});Object.keys(data).forEach(function(dataKey){var observableField=calendar[serverToModelMapping[dataKey]];var dataValue=data[dataKey];observableField(dataValue)});backend.saveCalendar(state.user(),calendar.id,data,function(err,data){callback(err)})};return UpdateCalendarAction})}());(function(){var define=System.amdDefine;define('webmail/components/calendarListDropDown/CalendarListDropDownViewModel.js',['node_modules/jquery/dist/jquery.js','node_modules/knockout/build/output/knockout-latest.debug.js','calendar/Sort.js','common/ViewBehavior.js','calendar/actions/UpdateExternalCalendarAction.js','calendar/actions/UpdateCalendarAction.js'],function($,ko,Sort,ViewBehavior,UpdateExternalCalendarAction,UpdateCalendarAction){function CalendarListDropDownViewModel(options){var that=this;that.state=options.state;that.actionExecutor=options.actionExecutor;that.errorHandler=options.errorHandler;ViewBehavior.installInto(that);var calendars=that.state.calendars;that.calendars=ko.pureComputed(function(){calendars.version();return Sort.calendars.byDefaultThenByName(calendars.all())});that.defaultCalendar=ko.pureComputed(function(){calendars.version();return calendars.getDefault()||{}});that.numberOfEnabledCalendars=ko.pureComputed(function(){calendars.version();return calendars.all().filter(function(calendar){return calendar.enabled()}).length});that.isCalendarListOpen=ko.observable(false);that.closeCalendarList=function(){that.isCalendarListOpen(false)};that.numberOfCalendars=ko.pureComputed(function(){calendars.version();return calendars.all().length});function toggleEnabledCalendar(cal){var calendar=calendars.get(cal.id);calendar.enabled(!calendar.enabled());var action;if(cal.extern){action=new UpdateExternalCalendarAction({calendar:calendar,data:{enabled:calendar.enabled()}})}else{action=new UpdateCalendarAction({calendar:calendar,data:{enabled:calendar.enabled()}})}that.executeAction(action,function(err,data){if(err){that.handleError(err)}})}that.selectCalendar=function(calendar,e){toggleEnabledCalendar(calendar)}}return CalendarListDropDownViewModel})}());System.registerDynamic('webmail/components/calendarListDropDown/calendarListDropDown.ko!3rdparty/systemjs-plugin-ko-tpl.js',[],true,function($__require,exports,module){var define,global=this||self,GLOBAL=global;module.exports=function injectTemplate(tpl){var s=document.createElement('script');s.id=tpl.id;s.innerHTML=window.TR?TR.HTML(tpl.content):tpl.content;s.type='text/html';document.head.appendChild(s)}({'id':'calendarListDropDown','content':'<div class="dropdown-input calendar-list-dropdown dropdown-toggle" data-bind="dropdownTemplate: { template: \'calendarListItemTemplate\', if: defaultCalendar(), closeOnClickInPopup: false, openState: isCalendarListOpen }">\n    <button data-bind="css: { checked: defaultCalendar().enabled }, style: { backgroundColor: defaultCalendar().darkBackgroundColor }" class="calendar-checkbox" tabindex="-1"></button>\n    <span class="content" data-bind="text: defaultCalendar().name, attr: { \'data-title\': defaultCalendar().name }"></span>\n    <span class="enabled-status" data-i18n="webmail.slideIn.EnabledCalendars">(<span data-bind="text: numberOfEnabledCalendars">0</span> of <span data-bind="text: numberOfCalendars">0</span> enabled)</span>\n    <span class="caret"></span>\n</div>\n\n<script type="text/html" id="calendarListItemTemplate">\n    <div class="calendar-list-dropdown">\n        <ul class="popupDropdown dropdown-list" data-bind="foreach: calendars">\n            <li class="dropdown-item calendar-dropdown-item calendar-list-item" data-bind="click: $parent.selectCalendar">\n                <button data-bind="css: { checked: enabled }, style: { backgroundColor: darkBackgroundColor }" class="calendar-checkbox"></button>\n                <span class="calendar-name" data-bind="text: name"></span>\n            </li>\n        </ul>\n        <div class="button-container">\n            <button class="one-button-style--primary list-button-ok" data-bind="click: closeCalendarList" data-i18n="webmail.slideIn.CalendarListOk">OK</button>\n        </div>\n    </div>\n</script>\n'});return module.exports});(function(){var define=System.amdDefine;define('webmail/components/calendarListDropDown/calendarListDropDown.js',['node_modules/knockout/build/output/knockout-latest.debug.js','webmail/components/calendarListDropDown/CalendarListDropDownViewModel.js','webmail/components/calendarListDropDown/calendarListDropDown.ko!3rdparty/systemjs-plugin-ko-tpl.js'],function(ko,CalendarListDropDownViewModel){ko.components.register('one-calendar-list-drop-down',{template:{element:'calendarListDropDown'},viewModel:{createViewModel:function(params){return new CalendarListDropDownViewModel(params)}}})})}());System.registerDynamic('webmail/components/calendarSlideIn/calendarSlideIn.ko',[],true,function($__require,exports,module){var define,global=this||self,GLOBAL=global;module.exports=function injectTemplate(tpl){var s=document.createElement('script');s.id=tpl.id;s.innerHTML=window.TR?TR.HTML(tpl.content):tpl.content;s.type='text/html';document.head.appendChild(s)}({'id':'calendarSlideIn','content':'<div class="layout slide-in" data-bind="css: { visible: open, animating: animating }">\n    <div class="slide-in-overlay" data-bind="click: toggleSlideIn"></div>\n    <div class="layout right slide-in-container">\n        <button class="slide-in-toggle" data-bind="click: toggleSlideIn">\n            <span>\n                <span data-bind="formatDate: { value: now, formatId: \'MMMd\' }"></span><br />\n                <span data-bind="formatDate: { value: now, formatId: \'y\' }"></span>\n            </span>\n        </button>\n\n        <div class="agenda-container agenda">\n            <div data-bind="template: \'agenda\'"></div>\n        </div>\n\n        <div class="event-dialog-container edit-dialog event-dialog">\n            <!-- ko if: eventModel -->\n            <div data-bind="with: eventDialog">\n                <div data-bind="template: \'eventDialog\'"></div>\n            </div>\n            <!-- /ko -->\n        </div>\n    </div>\n</div>\n'});return module.exports});System.registerDynamic('calendar/agenda/agenda.ko',[],true,function($__require,exports,module){var define,global=this||self,GLOBAL=global;module.exports=function injectTemplate(tpl){var s=document.createElement('script');s.id=tpl.id;s.innerHTML=window.TR?TR.HTML(tpl.content):tpl.content;s.type='text/html';document.head.appendChild(s)}({'id':'agenda','content':'<div class="agenda-tab" data-bind="with: agendaView">\n    <div class="agenda-header">\n        <div class="headline-container">\n            <h2 class="agenda-label">\n                <span data-i18n="calendar.Agenda">Agenda</span>\n                <span class="agenda-range-label" data-i18n="">\n                    <span data-i18n="">(</span>\n                    <span data-bind="formatDate: { value: startDate, format: \'EEEE\' }"></span>\n                    <span data-bind="formatDate: { value: startDate, formatId: \'Md\' } "></span>\n                    &nbsp;-&nbsp;\n                    <span data-bind="formatDate: { value: lastAgendaDay, formatId: \'Md\' } "></span>\n                    <span data-i18n="">)</span>\n                </span>\n            </h2>\n            <div class="agenda-header-right" data-bind="visible: showCalendarLink">\n                <a href="/calendar" data-i18n="calendar.agenda.GoToCalendar" data-bind="click: goToCalendar">Go to calendar</a>\n            </div>\n        </div>\n        <div data-bind="visible: slideIn" class="calendar-list">\n            <one-calendar-list-drop-down\n                params="state: state,\n                        actionExecutor: actionExecutor,\n                        errorHandler: errorHandler">\n            </one-calendar-list-drop-down>\n        </div>\n    </div>\n    <div class="agenda-days" data-bind="css: { \'slide-in-agenda\': slideIn }">\n        <ul data-bind="foreach: days">\n            <li class="agenda-day">\n                <h3 class="agenda-date-label" data-i18n="">\n                    <span class="day" data-bind="formatDate: { value: date, format: \'dd\' } "></span>\n                    <span class="month" data-bind="formatDate: { value: date, format: \'MMMM\' }"></span>\n                    &nbsp;-&nbsp;\n                    <span class="week-day" data-bind="formatDate: { value: date, format: \'EEEE\' }"></span>\n                </h3>\n                <ul class="agenda-events" data-bind="foreach: eventInstances">\n                    <li class="agenda-item" data-bind="style: { color: eventInstance.event.calendar.color }, eventDialog: { eventInstance: eventInstance, position: $root.embedded() ? \'right\' : \'left\' }">\n                        <div class="agenda-item-date" data-i18n="">\n                            <!-- ko if: allDay -->\n                            <span data-i18n="calendar.AllDay">All day</span>\n                            <!-- /ko -->\n                            <!-- ko ifnot: allDay -->\n                            <span data-bind="formatDate: { value: startDate.convertToZone($root.state.timeZone()), formatId: \'shortTime\' }"></span>&nbsp;-&nbsp;<span data-bind="formatDate: { value: endDate.convertToZone($root.state.timeZone()), formatId: \'shortTime\' }"></span>\n                            <!-- /ko -->\n                        </div>\n                        <div class="agenda-item-summary" data-bind="text: eventInstance.summary"></div>\n                    </li>\n                </ul>\n            </li>\n        </ul>\n        <!-- ko if: canLoadMore() && !slideIn -->\n        <button class="agenda-load-more" data-bind="click: loadMore" data-i18n="calendar.LoadMore">Load more</button>\n        <!-- /ko -->\n    </div>\n    <!-- ko if: canLoadMore() && slideIn -->\n    <div class="agenda-load-more-container">\n        <button class="agenda-load-more" data-bind="click: loadMore" data-i18n="calendar.LoadMore">Load more</button>\n    </div>\n    <!-- /ko -->\n</div>\n'});return module.exports});System.registerDynamic('calendar/dialogs/event/recurrenceOptions.ko',[],true,function($__require,exports,module){var define,global=this||self,GLOBAL=global;module.exports=function injectTemplate(tpl){var s=document.createElement('script');s.id=tpl.id;s.innerHTML=window.TR?TR.HTML(tpl.content):tpl.content;s.type='text/html';document.head.appendChild(s)}({'id':'recurrenceOptions','content':'<div class="controls-row frequency-selector">\n    <div class="small recurrence-label fixed">\n        <span data-i18n="calendar.Recurrence.Frequency">Frequency:</span>\n    </div>\n    <div class="stretch">\n        <div class="select-wrapper">\n            <select data-bind="options: frequencyOptions,\n                               optionsText: \'text\',\n                               value: selectedFrequency">\n            </select>\n        </div>\n    </div>\n</div>\n<div class="controls-row recurrence-interval">\n    <div class="small recurrence-label fixed">\n        <span data-i18n="calendar.Recurrence.RepeatsEvery">Repeats every:</span>\n    </div>\n    <div class="stretch">\n        <input type="number" min="1" max="30" data-bind="value: interval, event: {keydown: detectKeyCode}">\n        <span class="repeat-interval" data-bind="text: intervalDescription"></span>\n    </div>\n</div>\n<div class="controls-row repeat-on column-layout limit" data-bind="visible: frequency() !== \'YEARLY\'">\n    <label data-bind="click: weekdaysOnlyClick, visible: frequency() === \'DAILY\'">\n        <button data-bind="checkbox: isWeekdaysOnly,\n                           attr: { tabindex: frequency() === \'DAILY\' ? 1 : -1 }">\n        </button>\n        <span class="checkbox-label weekdays-only" data-i18n="calendar.Recurrence.WeekdaysOnly">Weekdays only</span>\n    </label>\n    <div class="small recurrence-label" data-bind="visible: frequency() === \'WEEKLY\' || frequency() === \'MONTHLY\'">\n        <span data-i18n="calendar.Recurrence.RepeatOn">Repeat on:</span>\n    </div>\n    <div class="stretch" data-bind="foreach: daysOfWeekInOrder, visible: frequency() === \'WEEKLY\'">\n        <div class="day-of-week-container">\n            <label data-bind="click: labelClick">\n                <button data-bind="checkbox: selected,\n                                   value: id,\n                                   attr: { tabindex: $parent.frequency() === \'WEEKLY\' ? 1 : -1 },\n                                   disable: disabled">\n                </button>\n                <span class="checkbox-label day-of-week-label" data-bind="text: text, css: { \'disabled\': disabled }"></span>\n            </label>\n        </div>\n    </div>\n    <div data-bind="foreach: monthlyRepetitionOptions, visible: frequency() === \'MONTHLY\'">\n        <div data-bind="visible: show" class="monthly-repetition-container">\n            <label class="radio">\n                <input type="radio" name="monthlyRepetition" data-bind="checked: $parent.monthlyRepetition,\n                                  attr: {\n                                      id: value,\n                                      tabindex: $parent.frequency() === \'MONTHLY\' && show ? 1 : -1\n                                  },\n                                  value: value">\n                <span class="label checkbox-label" data-bind="text: text, click: $parent.monthlyRepetitionLabel"></span>\n            </label>\n        </div>\n    </div>\n</div>\n<div class="controls-row column-layout limit">\n    <div class="small recurrence-label">\n        <span data-i18n="calendar.Recurrence.EndRepeat">End repeat:</span>\n    </div>\n    <div class="stretch limitation">\n        <div class="limitation-row">\n            <label class="radio">\n                <input type="radio" data-bind="attr: { name: \'limitation\' }, value: \'forever\', checked: limit">\n                <span class="label" data-i18n="calendar.Recurrence.LimitationsForever">Never ends</span>\n            </label>\n        </div>\n        <div class="limitation-row">\n            <label class="stretch radio">\n                <input type="radio" data-bind="attr: { name: \'limitation\' }, value: \'count\', checked: limit">\n                <span class="label" data-i18n="calendar.Recurrence.LimitationOccurrences">Occurrences: </span>\n            </label>\n            <div class="limitation-input small">\n                <input type="number" min="1" data-bind="value: count, event: {keydown: detectKeyCode}, enable: limit() === \'count\'">\n            </div>\n        </div>\n        <div class="limitation-row">\n            <label class="small radio">\n                <input type="radio" data-bind="attr: { name: \'limitation\' }, value: \'until\', checked: limit">\n                <span class="label" data-i18n="calendar.Recurrence.LimitationEnds">Ends:</span>\n            </label>\n            <div class="stretch" data-bind="css: { \'empty-placeholder\': !until() }">\n                <!-- ko if: until() -->\n                <one-date-selector params="date: until, disabled: limit() !== \'until\'">\n                </one-date-selector>\n                <!-- /ko -->\n                <!-- ko ifnot: until() -->\n                <input type="text" tabindex="-1" disabled="true">\n                <!-- /ko -->\n            </div>\n        </div>\n    </div>\n</div>\n<div class="controls-row recur-description">\n    <div class="small label">\n        <span data-i18n="calendar.RecurrenceDescriptionColon">Description:</span>\n    </div>\n    <div class="stretch recurrence-description">\n        <span data-bind="text: recurrenceDescription"></span>\n    </div>\n</div>\n'});return module.exports});System.registerDynamic('calendar/dialogs/event/eventDialog.ko',[],true,function($__require,exports,module){var define,global=this||self,GLOBAL=global;module.exports=function injectTemplate(tpl){var s=document.createElement('script');s.id=tpl.id;s.innerHTML=window.TR?TR.HTML(tpl.content):tpl.content;s.type='text/html';document.head.appendChild(s)}({'id':'eventDialog','content':'<div class="speech-bubble">\n    <div class="speech-bubble-arrow"></div>\n    <div class="form-horizontal main" data-bind="css: view">\n        <div class="dialog-view dialog-main event-dialog-main" data-bind="css: { \'readonly\': isReadonly}">\n            <one-dialog-header params="close: discard, context: $data, tabindex: view() === \'main\' ? 1 : -1, back: isSlideIn && discard">\n                <div class="dropdown-wrapper">\n                    <!-- ko if: isReadonly -->\n                    <div class="dropdown-input calendar-container">\n                        <button data-bind="css: { checked: false }, style: { backgroundColor: calendar().darkBackgroundColor }" class="calendar-checkbox" tabindex="-1"></button>\n                        <span class="content" data-bind="text: calendar().name, attr: { \'data-title\': calendar().name }"></span>\n                    </div>\n                    <!-- /ko -->\n                    <!-- ko ifnot: isReadonly -->\n                    <div class="dropdown-input dropdown-toggle" data-bind="dropdownTemplate: { template: \'calendarSelectorTemplate\' }">\n                        <button data-bind="css: { checked: false }, style: { backgroundColor: calendar().darkBackgroundColor }" class="calendar-checkbox" tabindex="-1"></button>\n                        <span class="content" data-bind="text: calendar().name, attr: { \'data-title\': calendar().name }"></span>\n                        <span class="caret"></span>\n                    </div>\n                    <!-- /ko -->\n                </div>\n            </one-dialog-header>\n            <div class="dialog-rows">\n                <div class="controls-row">\n                    <in-place-editor params="value: summary,\n                                             placeholder: TR(\'calendar.Summary\', \'Subject\'),\n                                             disabled: isReadonly,\n                                             focused: summaryFocused,\n                                             tabindex: view() === \'main\' ? 1 : -1"\n                                     class="summary main">\n                    </in-place-editor>\n                </div>\n                <!-- ko if: isReadonly() && description() || !isReadonly() -->\n                <div class="controls-row">\n                    <in-place-editor params="value: description,\n                                             isMultiline: true,\n                                             placeholder: TR(\'calendar.Description\', \'Description\'),\n                                             disabled: isReadonly,\n                                             tabindex: view() === \'main\' ? 1 : -1">\n                    </in-place-editor>\n                </div>\n                <!-- /ko -->\n\n                <!-- ko if: isReadonly() && location() || !isReadonly() -->\n                <div class="controls-row location-input">\n                    <in-place-editor params="value: location,\n                                             placeholder: TR(\'calendar.Location\', \'Location\'),\n                                             disabled: isReadonly,\n                                             tabindex: view() === \'main\' ? 1 : -1"\n                                     class="location">\n                    </in-place-editor>\n                    <a class="map-link" tabindex="-1" data-bind="visible: location, attr: { href: locationUrl }" target="_blank" data-i18n="calendar.LocationMapLink">map</a>\n                </div>\n                <!-- /ko -->\n                <!-- ko ifnot: isReadonly() -->\n                <div class="controls-row vertically-centered">\n                    <button data-bind="checkbox: allDayEvent, disable: isReadonly, attr: { tabindex: view() === \'main\' ? 1 : -1 }"></button>\n                    <span class="checkbox-label" data-i18n="calendar.AllDayEvent" data-bind="click: isReadonly() ? null : toggleAllDay">All day event</span>\n                </div>\n                <!-- /ko -->\n\n                <div class="controls-row">\n                    <table class="time-selection">\n                        <tr class="time-selection--from">\n                            <td>\n                                <label data-i18n="calendar.FromColon">Starts:</label>\n                            </td>\n                            <td class="date-selector">\n                                <one-date-selector params="date: startDate, disabled: isReadonly, tabindex: view() === \'main\' ? 1 : -1"></one-date-selector>\n                            </td>\n                            <td class="time-selector" data-bind="visible: !allDayEvent()">\n                                <one-time-selector params="date: startDate, disabled: isReadonly() || allDayEvent(), tabindex: view() === \'main\' ? 1 : -1"></one-time-selector>\n                            </td>\n                        </tr>\n                        <tr data-bind="visible: startDate.isNotValid">\n                            <td data-bind="attr: { colspan: allDayEvent() ? 2 : 3 }">\n                                <label class="validation-warning" data-i18n="calendar.InvalidDate">This is not a valid date.</label>\n                            </td>\n                        </tr>\n                        <tr class="time-selection--to">\n                            <td>\n                                <label data-i18n="calendar.ToColon">Ends:</label>\n                            </td>\n                            <td class="date-selector">\n                                <one-date-selector params="date: endDate, disabled: isReadonly, tabindex: view() === \'main\' ? 1 : -1"></one-date-selector>\n                            </td>\n                            <td class="time-selector" data-bind="visible: !allDayEvent()">\n                                <one-time-selector params="date: endDate, disabled: isReadonly() || allDayEvent(), tabindex: view() === \'main\' ? 1 : -1"></one-time-selector>\n                            </td>\n                        </tr>\n                        <tr data-bind="visible: endDate.isNotValid">\n                            <td data-bind="attr: { colspan: allDayEvent() ? 2 : 3 }">\n                                <label class="validation-warning" data-i18n="calendar.InvalidDate">This is not a valid date.</label>\n                            </td>\n                        </tr>\n                    </table>\n                </div>\n                <div class="controls-row">\n                    <div class="recurrence-controls-container">\n                        <div class="recurrence-toggle">\n                            <!-- ko ifnot: isReadonly() -->\n                            <button data-bind="checkbox: repeats, attr: { tabindex: view() === \'main\' ? 1 : -1 }"></button>\n                            <!-- /ko -->\n                            <span class="checkbox-label" data-i18n="calendar.RepeatsColon" data-bind="click: isReadonly() ? null : toggleRecurrence">Repeats:</span>\n                        </div>\n                        <div class="recurrence-description">\n                            <span data-bind="text: recurrenceDescription, attr: { \'data-title\': rruleTooltip }"></span>\n                        </div>\n                        <!-- ko if: repeats() && !isReadonly() && !tooComplex() -->\n                        <div class="recurrence-edit">\n                            <a href="javascript:void(0);" tabindex="-1" data-bind="click: showRecurrence" data-i18n="calendar.EditRecurrenceLink">Edit</a>\n                        </div>\n                        <!-- /ko -->\n                        <!-- ko if: repeats() && !isReadonly() && tooComplex() -->\n                        <div class="recurrence-edit">\n                            <a href="javascript:void(0);" tabindex="-1" data-bind="click: deleteRecurrence" data-i18n="calendar.Delete">Delete</a>\n                        </div>\n                        <!-- /ko -->\n                    </div>\n                </div>\n                <!-- ko if: isSlideIn && repeats() && !isReadonly() -->\n                <div class="recurrence-options-rows" data-bind="template: { name: \'recurrenceOptions\', if: isSlideIn }"></div>\n                <!-- /ko -->\n            </div>\n            <div class="buttons" data-bind="visible: !$root.embedded() && !isReadonly()">\n                <button class="call-to-action"\n                        data-bind="click: remove,\n                                   visible: isDeletable,\n                                   enable: isDeletable,\n                                   attr: { tabindex: view() === \'main\' ? 1 : -1 }"\n                        data-i18n="calendar.Delete">Delete</button>\n                <button class="call-to-action main-call-to-action"\n                        data-bind="click: save,\n                                   enable: isSavable,\n                                   attr: { tabindex: view() === \'main\' ? 1 : -1 }"\n                        data-i18n="calendar.Save">Save</button>\n            </div>\n        </div>\n        <div class="dialog-view dialog-scope-selector">\n            <one-dialog-header params="back: back, close: discard, tabindex: view() === \'scope-selector\' ? 1 : -1">\n                <span class=\'label-recurring\' data-i18n="calendar.ChangeRecurringEvent">Change recurring event</span>\n            </one-dialog-header>\n            <a href="#" tabindex="0" class="first-focus ignore-tab"></a>\n            <div class="absolute-centered scope-buttons" data-bind="foreach: scopes">\n                <div class="controls-row">\n                    <button class="call-to-action" data-bind="click: selectScope, text: label, attr: { tabindex: $parent.view() === \'scope-selector\' ? 1 : -1 }"></button>\n                </div>\n            </div>\n        </div>\n        <div class="dialog-view dialog-recurrence">\n            <one-dialog-header params="close: discard, back: back, tabindex: view() === \'recurrence\' ? 1 : -1">\n                <span data-i18n="calendar.RecurrenceTitle">Repeat</span>\n            </one-dialog-header>\n            <a href="#" tabindex="0" class="first-focus ignore-tab"></a>\n            <!-- ko notif: isSlideIn -->\n            <div class="recurrence-options-rows" data-bind="template: { name: \'recurrenceOptions\', if: !isSlideIn }"></div>\n            <!-- /ko -->\n            <div class="buttons layout bottom">\n                <button class="call-to-action main-call-to-action"\n                        data-bind="click: back,\n                                   attr: { tabindex: view() === \'recurrence\' ? 1 : -1 }"\n                        data-i18n="calendar.OkButton">Ok</button>\n            </div>\n        </div>\n    </div>\n</div>\n<div class="layout loading-overlay" data-bind="visible: isProcessing"><div></div></div>\n\n<script type="text/html" id="calendarSelectorTemplate">\n    <ul class="popupDropdown dropdown-list" data-bind="foreach: calendars">\n        <li class="dropdown-item calendar-dropdown-item" data-bind="click: $parent.selectCalendar">\n            <button data-bind="css: { checked: false }, style: { backgroundColor: darkBackgroundColor }" class="calendar-checkbox"></button>\n            <span data-bind="text: name"></span>\n        </li>\n    </ul>\n</script>\n'});return module.exports});(function(){var define=System.amdDefine;define('webmail/components/calendarSlideIn/calendarSlideIn.js',['node_modules/knockout/build/output/knockout-latest.debug.js','webmail/components/calendarSlideIn/CalendarSlideInViewModel.js','3rdparty/knockout.formatDate.js','theme/binding/knockout.checkbox.js','webmail/components/calendarListDropDown/calendarListDropDown.js','webmail/components/calendarSlideIn/calendarSlideIn.ko','calendar/agenda/agenda.ko','calendar/dialogs/event/recurrenceOptions.ko','calendar/dialogs/event/eventDialog.ko'],function(ko,CalendarSlideInViewModel){ko.components.register('one-calendar-slide-in',{template:{element:'calendarSlideIn'},viewModel:{createViewModel:function(params,dom){return new CalendarSlideInViewModel(params,dom.element)}}})})}());(function(){var define=System.amdDefine;define('webmail/Application.js',['locale','#{environment|default}.cjson','node_modules/jquery/dist/jquery.js','node_modules/knockout/build/output/knockout-latest.debug.js','common/Backend.js','webmail/PageNavigator.js','webmail/composer/Composer.js','webmail/model/State.js','common/model/Folder.js','3rdparty/action-executor/ActionExecutor.js','3rdparty/actionInterceptor.js','3rdparty/retryTracker.js','common/shouldRetryActionOnError.js','webmail/model/Mail.js','webmail/model/Layout.js','webmail/mailView/MailView.js','webmail/composer/MailSent.js','webmail/composer/SendingMail.js','webmail/mailTabs/MailTabs.js','webmail/folderList/FolderListView.js','webmail/mailList/MailListView.js','webmail/CacheManager.js','webmail/actions/RefreshFoldersAction.js','webmail/actions/LoadMailsAction.js','webmail/actions/GetMailInfoAction.js','common/actions/LoadPreferencesAction.js','webmail/actions/LoadContactsAction.js','contacts/actions/SaveContactAction.js','common/util.js','common/KeyHandler.js','webmail/WebmailErrorHandler.js','common/TraceLogging.js','3rdparty/LocalStorage.js','welcome/model/WelcomeView.js','eas/model/EASView.js','theme/LoadingScreen.js','node_modules/@one.com/tracking-analytics/lib/tracking.js','3rdparty/signals.js','3rdparty/mario.js','common/LocaleSwitcher.js','3rdparty/version-tracking/Version.js','3rdparty/version-tracking/VersionTracker.js','3rdparty/version-tracking/VersionUpgradeTimer.js','common/AppCourier.js','3rdparty/page.js','common/heartbeat.js','common/actions/NotifyRecentEmailsAction.js','common/actions/SavePreferencesAction.js','calendar/actions/GetTimeZoneAction.js','calendar/actions/LoadCalendarsAction.js','calendar/actions/LoadExternalCalendarsAction.js','calendar/ical/Duration.js','common/EASAdministrationView.js','webmail/components/calendarSlideIn/calendarSlideIn.js'],function(currentLocaleId,currentConfig,$,ko,Backend,PageNavigator,Composer,State,Folder,ActionExecutor,actionInterceptor,retryTracker,shouldRetryActionOnError,Mail,Layout,MailView,MailSent,SendingMail,MailTabs,FolderListView,MailListView,CacheManager,RefreshFoldersAction,LoadMailsAction,GetMailInfoAction,LoadPreferencesAction,LoadContactsAction,SaveContactAction,util,getKeyHandler,WebmailErrorHandler,TraceLogging,LocalStorage,WelcomeView,EASView,LoadingScreen,tracking,signals,mario,LocaleSwitcher,Version,VersionTracker,VersionUpgradeTimer,AppCourier,page,heartbeat,NotifyRecentEmailsAction,SavePreferencesAction,GetTimeZoneAction,LoadCalendarsAction,LoadExternalCalendarsAction,Duration,EASAdministrationView){function Application(touch){var that=this,trackedVersions={},versionUpgradeTimer=new VersionUpgradeTimer;that.currentLocaleId=currentLocaleId.default||currentLocaleId;that.errorHandler=WebmailErrorHandler.create(this);that.heartbeat=heartbeat();that.backend=new Backend;that.localeSwitcher=new LocaleSwitcher(currentConfig.i18n.supportedLocaleIds);that.errormsg=ko.observable(null);that.folderTimer=0;that.state=new State;that.state.isTouch=touch;that.notification=that.state.notification;that.state.user(null);that.cacheManager=new CacheManager(that.state);that.isComposerView=ko.observable(false);that.isMailView=ko.observable(false);that.isMailListView=ko.observable(false);that.pageNavigator=new PageNavigator({user:that.state.user});that.dirtyCheckTimeout=null;that.isComposerBottomBarVisible=ko.observable(false);that.calendarQuickLookEnabled=ko.pureComputed(function(){var oldAuthRecentlyChangedPassword=that.backend.oldAuthRecentlyChangedPassword;var standalone=that.state.standalone;var mailSettings=that.state.preferences.mail();var calendarQuickLook=mailSettings&&mailSettings.hasOwnProperty('calendarQuickLook')?mailSettings.calendarQuickLook:true;return!that.state.isTouch&&!oldAuthRecentlyChangedPassword&&!standalone&&calendarQuickLook});that.embedded=ko.observable(false);that.readyForSending=function(){return that.mailListView.showComposer.readyForSending()};function showingDirtyPage(){var page=that.mailListView&&that.mailListView.page();return page&&!page.failed&&page.dirty}function showingDirtyFolders(){return that.state.folders.dirty}function isSearchActive(){var query=that.mailListView.searchInputValue().trim();if(query===''){return true}return false}function trackVersions(){var serverVersion=Version.serverVersion();if(!(serverVersion in trackedVersions)){tracking.track('versions',serverVersion,Version.clientVersion());trackedVersions[serverVersion]=serverVersion}}Version.updatePriority.subscribe(function(updatePriority){if(updatePriority>0){trackVersions();switch(updatePriority){case 3:if(that.layout.contentPanel.viewModel instanceof Composer){that.layout.contentPanel.viewModel.saveChanges({},function(){that.backend.redirectToUpgradePage()})}else{that.backend.redirectToUpgradePage()}break;case 2:case 1:versionUpgradeTimer.start();break}}});trackVersions();VersionTracker.start();that.actionExecutor=new ActionExecutor({context:{state:that.state,backend:that.backend},interceptor:function(action,args,next){actionInterceptor(action,args,next);if(!action.silent){versionUpgradeTimer.restartIdleTimer()}},onEmptyQueue:function(){versionUpgradeTimer.upgradeIfReady();that.cacheManager.cleanup();clearTimeout(that.dirtyCheckTimeout);var page=that.mailListView&&that.mailListView.page();var search=that.mailListView&&that.mailListView.search();if(showingDirtyFolders()){that.folderListView.refreshFolders(true)}else if(showingDirtyPage()){if(isSearchActive()){that.mailListView.loadMails(true)}else{if(page.index<search.pageCount()&&page.mails().length<search.pageLength||page.index===search.pageCount()&&page.mails().length<search.length()%search.pageLength){that.mailListView.loadOnlyMissingMails(true)}}}else if(search.pageCount()<page.index){that.pageNavigator.show(that.mailListView.folder().id(),search.pageCount(),null,that.mailListView.getOptions())}},onStatusChange:function(task,status,err){one.crashLogger.log(task.action.name+' '+status);retryTracker(task,status,err);if(status==='running'&&that.mailListView.shownComposer()){that.mailListView.shownComposer().saveToLocalStorage()}if(status==='done'&&(showingDirtyPage()||showingDirtyFolders())){clearTimeout(that.dirtyCheckTimeout);that.dirtyCheckTimeout=setTimeout(function(){if(showingDirtyFolders()){that.folderListView.refreshFolders(true)}else if(showingDirtyPage()){that.mailListView.loadMails(true)}},400)}},shouldRetryOnError:shouldRetryActionOnError});that.easAdministrationView=new EASAdministrationView({state:that.state,backend:this.backend});that.welcome=new WelcomeView(that.state,that.actionExecutor,that.errorHandler);that.eas=new EASView(that.state,that.backend,that.actionExecutor);if(that.state.isTouch){that.state.signals.queueMailForSending.add(function(){that.mailListView.deselectAll();var mailSent=new MailSent(that.mailListView);that.setContentPanel(mailSent);setTimeout(function(){if(that.layout.contentPanel.viewModel===mailSent){that.mailListView.viewMail(null)}},2000)})}else{that.state.signals.sendingMail.add(function(){that.mailListView.deselectAll();var sendingMail=new SendingMail;that.setContentPanel(sendingMail)});that.state.signals.queueMailForSending.add(function(composer){if(that.layout.contentPanel.viewModel instanceof SendingMail){that.mailListView.deselectAll();var mailSent=new MailSent;that.setContentPanel(mailSent);setTimeout(function(){if(that.layout.contentPanel.viewModel===mailSent){that.mailListView.viewMail(null)}},2000)}});that.state.signals.queueMailForSendingFailed.add(function(composer){if(that.layout.contentPanel.viewModel instanceof SendingMail){if(composer){that.mailTabs.showComposer.dispatch(composer)}else{that.mailListView.viewMail(null)}}})}that.state.signals.mailDisappeared.add(function(uid,folder){var activeMail=that.mailListView.selected();if(activeMail&&activeMail.uid===uid&&activeMail.folder().id()===folder.id()){that.mailListView.viewMail(null)}});that.state.folders.signals.folderEmptied.add(function(folder){that.mailListView.searchFolder({query:''});that.mailListView.searchInputValue('');var selectedFolder=that.folderListView.selected();var selectedFolderEmptied=[].concat(folder,folder.allChildren()).some(function(f){return selectedFolder===f});if(selectedFolderEmptied){that.mailListView.viewMail(null);that.mailListView.page().mailUids([]);that.mailListView.search().length(0);that.mailListView.gotoPage(1)}});that.user=that.state.user;that.group='mail';that.application='webmail';that.layout=new Layout(that.state);that.layout.contentPanel.template.subscribe(function(){if(that.layout.contentPanel.template()==='view'){that.isMailView(true);that.isComposerView(false);that.isMailListView(false);that.isComposerBottomBarVisible(false)}if(that.layout.contentPanel.template()==='composer'){that.isComposerView(true);that.isMailView(false);that.isMailListView(false)}if(that.layout.contentPanel.template()==='selection'){that.isMailListView(true);that.isComposerView(false);that.isMailView(false)}});var viewOptions={state:that.state,layout:that.layout,pageNavigator:that.pageNavigator,actionExecutor:that.actionExecutor,errorHandler:that.errorHandler};this.folderListView=new FolderListView(viewOptions);this.mailListView=new MailListView(util.extend({parentView:this.folderListView},viewOptions));this.folderListView.childView=this.mailListView;this.mailTabs=new MailTabs(that.state);this.mailListView.mailTabs=this.mailTabs;that.loadingPlaceholderHeight=ko.computed(function(){var page=that.mailListView.page();var pageLength=page&&page.length()||0;var shownMails=page&&page.mails().length||0;var itemHeight=that.layout.wideList()?40:54;var loadingPlaceholderHeight=itemHeight*(pageLength-shownMails);that.layout.dimensions.view.height();var currentListHeight=$('.mailList').height();return Math.min(currentListHeight,Math.max(loadingPlaceholderHeight,itemHeight))+'px'});that.showFolderMenu=ko.observable(false);that.showKeyShortcuts=ko.observable(false);that.state.signals.closeErrorMessage.add(function(){if(that.errormsg()){that.errormsg(null)}});that.activeMails=ko.computed(function(){if(that.mailListView.selected()&&(that.layout.isStackView()&&that.layout.stackView.isContentPanelVisible()||that.layout.isSplitView()&&that.layout.contentPanel.template()==='view')){return[that.mailListView.selected()]}else if(that.layout.isStackView()&&that.layout.stackView.isListPanelVisible()||that.layout.isSplitView()&&that.mailListView.selection().length>0){return that.mailListView.selection()}return[]});that.activeMails.subscribe(function(newValue){if(that.errormsg()){that.state.signals.closeErrorMessage.dispatch()}});that.documentTitle=ko.computed(function(){var inbox=that.state.folders.inbox;var title=TR('mail.DocumentTitle','Webmail');if(inbox&&inbox.indicator()>0){title+=' ('+inbox.indicator()+')'}return title});that.isInitialized=ko.observable(false);[function(){if(that.mailTabs){return that.mailTabs.composersSending()>0&&TR('composer.PendingMails','You have mails that are not finished sending. '+'If you leave the page, the mails will not be sent.')}},function(){if(that.mailTabs){return that.mailTabs.composersFailedSending()>0&&TR('composer.UnsendMails','You have mails that could not be sent. '+'If you leave the page, the mails will not be sent.')}},function(){if(that.mailTabs){return that.mailTabs.composersFailedSaving()>0&&TR('composer.UnsendDrafts','You have drafts that could not be saved. '+'If you leave the page, your changes will be lost.')}},function(){return that.actionExecutor.queue.some(function(task){return task.action.isBlocking})},function(){return that.layout.contentPanel.viewModel&&that.layout.contentPanel.viewModel.hasChanges&&that.layout.contentPanel.viewModel.hasChanges()&&TR('composer.onBeforeUnload','There are changes to the email you are writing')}].forEach(function(condition){that.backend.beforeUnloadConditions.push(condition)});that.mailSelectionLength=ko.computed(function(){return that.mailListView.selection().length});that.unsentMails=ko.observableArray([]);that.unsentMails.subscribe(function(){that.state.folders.sent.unsentCount(that.unsentMails().length)});that.hasUnsentMails=ko.pureComputed(function(){return that.unsentMails().filter(function(mail){return mail.folder().isSentFolder()}).length>0});function addMailsToUnsent(mails){mails.forEach(function(mail){if(mail.failedSending()&&that.unsentMails.indexOf(mail)===-1){mail.incrementReferences();that.unsentMails.push(mail)}})}function removeMailsFromUnsent(mails){var removedValues=that.unsentMails.removeAll(mails);removedValues.forEach(function(removed){removed.decrementReferences()})}that.state.signals.mailDisappeared.add(function(uid,folder){var removedValues=that.unsentMails.remove(function(mail){return mail.uid===uid&&mail.folder()===folder});removedValues.forEach(function(removed){removed.decrementReferences()})});that.state.signals.mailSent.add(function(mail){removeMailsFromUnsent([mail])});that.state.signals.movingMails.add(function(mails,source,destination){if(destination.supportResending()){var failedMails=mails.filter(function(mail){return mail.submitPending()});failedMails.forEach(function(mail){mail.failedSending(true)});addMailsToUnsent(failedMails)}else{removeMailsFromUnsent(mails)}});that.state.signals.sendingMailFailed.add(function(mail){addMailsToUnsent([mail])});that.state.signals.addNewContact.add(function(contactModel,stubData){that.actionExecutor.enqueue(new SaveContactAction({contact:contactModel,tags:[]}),function(err){stubData.id=contactModel.id;that.state.contacts.all.push(stubData);that.state.notification(null);if(err){that.handleError(err)}else{that.state.notification(null)}})});that.newMail=function(){that.isComposerBottomBarVisible(false);var options=that.mailListView.getOptions();options.compose='new';delete options.folder;that.pageNavigator.show(that.mailListView.folder().id(),that.mailListView.page().index,that.mailListView.getMailUID(),options);setTimeout(function(){$('#to').focus()},1)}}Application.prototype.setupRouting=function(){var that=this;this.easAdministrationView.loadData();this.easAdministrationView.init(this.eas.init.bind(this.eas));page('*',function(context,next){context.query=context.querystring?util.decodePairs(context.querystring):{};next()});page('/',function(context){if(context.hash){var hash=context.hash.replace(/^\//,'');if(/successUrl|loginUrl|username/.test(hash)){hash=''}page.redirect('/'+hash)}else{that.pageNavigator.redirect('INBOX',1)}});page('/:user/',function(context,next){if(context.params.user.replace(' ','+')===that.user()){that.pageNavigator.redirect('INBOX',1)}else{next()}});page('/:user/(.*)',function(context,next){var user=context.params.user.replace(' ','+');if(user===that.user()){if('login'in context.query){that.pageNavigator.removeLoginFlag()}else{next()}}else if(/@/.test(context.params.user)){if(context.query.login){that.pageNavigator.redirect('INBOX',1)}else{setTimeout(that.backend.logout.bind(that.backend),10)}}else{page.stop();location.assign(context.path)}});page('/:user/:folder/',function(context){that.pageNavigator.redirect(context.params.folder,1,null,context.query)});page('/:user/:folder/:page/(.*)',function(context,next){that.mailListView.selected.pause();var showAfterLoad=that.pageNavigator.showAfterLoad;var folder=that.state.folders.getById(context.params.folder);that.mailListView.saveSelection();that.mailListView.folder(folder);if(that.folderListView.selected()!==folder){that.folderListView.selected(folder)}var oldPage=that.mailListView.page();that.mailListView.routePage(context.params.page,context.query);function loadComposer(){var oldComposer;if(that.mailListView.shownComposer()){oldComposer=that.mailListView.shownComposer()}if(context.query.compose==='new'){if(AppCourier.awaits()){that.composeMail(AppCourier.arrive())}else{if(oldComposer&&!oldComposer.draftBeingEdited()){next();return}else{that.composeMail(context.query)}}}else{var draftFolder=that.state.folders.getById(context.query.folder);if(draftFolder){var oldDraft=oldComposer&&oldComposer.draftBeingEdited();var uid=parseInt(context.query.compose,10);if(oldDraft&&oldDraft.uid===uid&&oldDraft.folder()===draftFolder){next();return}that.retrieveAndViewMail({folder:draftFolder,uid:uid})}}if(oldComposer&&oldComposer.hasChanges()){oldComposer.saveMail()}next()}if(oldPage===that.mailListView.page()){that.mailListView.restoreSelection();if(context.query.compose){loadComposer()}else{next()}}else{that.mailListView.loadMails(false,function(){switch(showAfterLoad){case'first':that.mailListView.viewFirstMail();break;case'last':that.mailListView.viewLastMail();break;default:that.mailListView.restoreSelection();if(context.query.compose){loadComposer()}else{next()}}})}});page('/:user/:folder/:page/',function(context){if(!context.query.compose){that.mailListView.viewMail(null)}that.mailListView.pathUID=null;setTimeout(function(){that.mailListView.selected.resume()},0)});page('/:user/:folder/:page/:uid',function(context){that.mailListView.pathUID=context.params.uid;if(!context.query.compose){var retrieve={folder:that.mailListView.folder(),uid:parseInt(context.params.uid,10)};if(context.query.part){retrieve.partId=context.query.part}if(context.query.standalone){that.state.standalone=true;retrieve.standalone=true}else{retrieve.silent=true}that.retrieveAndViewMail(retrieve)}setTimeout(function(){that.mailListView.selected.resume()},0)});page()};Application.prototype.toggleBottomBar=function(){var activeElement=document.activeElement;activeElement.blur();var bottomBarVisible=this.isComposerBottomBarVisible();this.isComposerBottomBarVisible(!bottomBarVisible);if(this.isComposerBottomBarVisible()===true){window.scrollTo(0,document.body.scrollHeight)}};Application.prototype.executeAction=function(action,cb){this.actionExecutor.enqueue(action,cb)};Application.prototype.setupSidebar=function(element){var that=this;var $element=$(element);$element.on('mouseenter',function(){that.layout.sidebar.enter()});$element.on('mouseleave',function(){that.layout.sidebar.leave()})};Application.prototype.setupMailTabs=function(){var that=this;this.mailTabs.showComposer.add(function(composer){var uid,options;that.mailListView.oldMailUID=that.mailListView.getMailUID();var selectedFolder=that.mailListView.folder();if(composer instanceof Composer){var draftBeingEdited=composer.draftBeingEdited();options=that.mailListView.getOptions();if(draftBeingEdited&&selectedFolder===draftBeingEdited.folder()){delete options.compose;delete options.folder;that.pageNavigator.show(selectedFolder.id(),that.mailListView.page().index,draftBeingEdited.uid,options)}else{if(draftBeingEdited){options.compose=draftBeingEdited.uid;options.folder=draftBeingEdited.folder().id()}else{options.compose='new';options.restore=true}that.pageNavigator.show(selectedFolder.id(),that.mailListView.page().index,that.mailListView.getMailUID(),options)}}else{uid=composer.uid;var folder;if(composer.folder){folder=that.state.folders.list().filter(function(f){return f.id()===composer.folder.id&&f.uidvalidity()===composer.folder.uidValidity})[0]}folder=folder||that.state.folders.drafts;options=that.mailListView.getOptions();if(selectedFolder===folder){delete options.compose;delete options.folder;that.pageNavigator.show(folder.id(),that.mailListView.page().index,uid,options)}else{options.compose=uid;options.folder=folder.id();that.pageNavigator.show(selectedFolder.id(),that.mailListView.page().index,that.mailListView.getMailUID(),options)}}});this.mailTabs.closeComposer.add(function(composer){if(that.layout.contentPanel.viewModel===composer){that.closeComposer(composer)}})};Application.prototype.closeComposer=function(composer){var list=this.mailListView;if(composer.draftBeingEdited()&&list.folder()===composer.draftBeingEdited().folder()){this.pageNavigator.show(list.folder().id(),list.page().index,null,list.getOptions())}else{var options=list.getOptions();delete options.compose;delete options.folder;var uid;if(list.folder().isDraftFolder()){uid=null}else{uid=list.selected()&&list.selected().uid}this.pageNavigator.show(list.folder().id(),list.page().index,uid,options)}};Application.prototype.retrieveAndViewMail=function(options,done){var that=this;that.executeAction(new GetMailInfoAction(options),function(err,mail){if(err&&!options.silent){that.handleError(err)}that.mailListView.viewMail(mail,!!options.standalone);if(!mail){var list=that.mailListView;that.pageNavigator.redirect(list.folder().id(),list.page().index,null,list.getOptions())}if(done instanceof Function){done()}})};Application.prototype.setupUIPreferences=function(){var that=this;var layout=that.layout;var localStorage=that.localStorage;var splitView=layout.splitView;splitView.position.vertical(parseInt(localStorage.getItem('vertical-splitter-position'),10)||splitView.position.vertical());splitView.position.horizontal(parseInt(localStorage.getItem('horizontal-splitter-position'),10)||splitView.position.horizontal());splitView.position.vertical.subscribe(function(position){localStorage.setItem('vertical-splitter-position',position)});splitView.position.horizontal.subscribe(function(position){localStorage.setItem('horizontal-splitter-position',position)});layout.selectedLayout(localStorage.getItem('ui-layout')||layout.currentLayout());layout.selectedLayout.subscribe(function(layout){localStorage.setItem('ui-layout',layout)});var isHorizontal;if(localStorage.getItem('split-direction')){if(localStorage.getItem('split-direction')==='horizontal'){isHorizontal=true}else{isHorizontal=false}}else{isHorizontal=layout.splitView.horizontal()}layout.splitView.horizontal(isHorizontal);layout.splitView.horizontal.subscribe(function(horizontal){localStorage.setItem('split-direction',horizontal?'horizontal':'vertical')})};Application.prototype.localStorageForMailTabs=function(){var that=this;var localStorage=that.localStorage;var activeDrafts=JSON.parse(localStorage.getItem('active-drafts'))||[];this.mailTabs.replaceAll(activeDrafts);this.mailTabs.tabsChanged.add(function(){localStorage.setItem('active-drafts',JSON.stringify(that.mailTabs.toJS()))})};Application.prototype.afterLogin=function(){var that=this,authentication=that.backend.getAuthenticationData();var localStorage=new LocalStorage(authentication.user);that.localStorage=localStorage.subStorage('webmail');that.localStorageCommon=localStorage.subStorage('common');that.setupUIPreferences();that.backend.getTtl(function(err,ttl){var ttlAcquiredAt=Date.now();if(!err&&typeof ttl==='number'){setInterval(function(){that.backend.getTtl(function(err,_ttl){if(!err&&typeof _ttl==='number'){ttlAcquiredAt=Date.now();ttl=_ttl}})},10*60*1000);function waitForPendingActionsAndLogOut(){that.backend.queue.awaitAll(function(){setTimeout(function(){that.backend.refreshLogin()},0)})}function checkTtl(){if(typeof ttl==='number'){var timeSinceTtlAcquired=Date.now()-ttlAcquiredAt;if(ttl-timeSinceTtlAcquired<5*60*1000){if(that.isComposerShown()){var composer=that.mailListView.shownComposer();composer.editor.getToolbar().editor.getDocument().body.contentEditable=false;composer.saveMail({disableInternalErrorHandling:true},function(err){waitForPendingActionsAndLogOut()})}else{waitForPendingActionsAndLogOut()}}}}checkTtl();setInterval(checkTtl,60000)}});if(!that.state.isTouch){that.setupMailTabs()}that.state.user(authentication.user);that.executeAction(new LoadPreferencesAction,function(err){if(err){that.handleError(err,{'404, 502, 503':function(){this.showWarning(TR('settings.SettingsUnavailable','We cannot currently retrieve your settings and signature. You can still send and receive mail.'))}})}else{that.state.signals.preferencesLoaded.dispatch();that.welcome.showIfNecessary()}if(!that.state.isTouch){that.registerKeys()}that.loadContacts();that.state.folders.loading(true);that.folderListView.childView.showConfirmationDialog=ko.observable(false);that.executeAction(new RefreshFoldersAction({silent:true}),function(err){that.state.folders.loading(false);if(err){that.mailListView.loading(false);that.handleError(err)}else{that.setupCollapsePreferences();if(!err&&!that.state.isTouch){that.localStorageForMailTabs()}var standalone=window.location.href.match(/standalone=true/);if(!standalone){var unsentMailPage=that.state.folders.sent.search({pageLength:1000,viewFilter:'$SubmitPending'}).firstPage();that.executeAction(new LoadMailsAction({page:unsentMailPage}),function(err){if(!err){var numberOfUnsentMails=unsentMailPage.mails().length;if(numberOfUnsentMails>0){that.showWarning(inter.trQuantity(TR('mail.YouHaveUnsentMails',{one:'You have a mail that could not be sent. You can resend it from the Sent folder.',other:'You have {0} mails that could not be sent. You can resend them from the Sent folder.'}),numberOfUnsentMails))}unsentMailPage.mails().forEach(function(mail){mail.incrementReferences();mail.failedSending(true);that.unsentMails.push(mail)})}})}that.setupRouting()}});that.folderTimer=window.setInterval(function(){var search=that.mailListView.search();var currentFolder=that.folderListView.selected();function refreshFolders(){if(search&&search.viewFilter==='ALL'){that.folderListView.refreshFolders(true)}}if(!that.state.folders.inbox.uidvalidity()||currentFolder===that.state.folders.inbox&&!document.hidden||(that.state.preferences.mail()||{}).showNotifications===false||mario.touch||!('Notification'in window)){refreshFolders()}else{that.executeAction(new NotifyRecentEmailsAction({application:that.application}),function(err){if(err){return that.handleError(err)}refreshFolders()})}},5*60*1000);if(!that.state.standalone){LoadingScreen.hide()}var mailPreferences=that.state.preferences.mail();if(mailPreferences&&'Notification'in window&&!mario.touch){var showNotifications=mailPreferences.showNotifications;if(showNotifications!==false){window.Notification.requestPermission(function(permission){if(permission==='denied'){that.state.preferences.mail().showNotifications=false}else if(permission==='granted'&&typeof showNotification==='undefined'){that.state.preferences.mail().showNotifications=true}if(showNotifications!==that.state.preferences.mail().showNotifications){that.executeAction(new SavePreferencesAction({page:'mail'},function(err){that.handleError(err)}))}})}}var globalPreferences=that.state.preferences.global();var tzid;if(globalPreferences&&globalPreferences.timeZone){tzid=globalPreferences.timeZone}else{tzid='Europe/London'}that.executeAction(new GetTimeZoneAction({tzid:tzid}),function(err,timeZone){if(err){return that.handleError(err)}that.state.timeZone(timeZone);that.isInitialized(true)});if(that.calendarQuickLookEnabled()){that.executeAction(new LoadCalendarsAction({startDate:that.state.now(),endDate:that.state.now().clone().addDuration(Duration.fromString('P7D'))}),function(err){that.handleError(err)});that.executeAction(new LoadExternalCalendarsAction,function(err){that.handleError(err)})}})};Application.prototype.registerKeys=function(){var keyhandler=getKeyHandler();var that=this;keyhandler.register('composer','mod+return',function(){that.layout.contentPanel.viewModel.sendMail();tracking.track('composer','send mail','key combo');return false});keyhandler.globalize('mod+return');keyhandler.globalize('tab');keyhandler.register('.',function(){that.showKeyShortcuts(!that.showKeyShortcuts())});keyhandler.register(['sidebar','listPanel','mailView'],'c',function(){that.composeMail({});tracking.track('navigation','compose mail','key combo');return false});this.folderListView.registerKeys();this.mailListView.registerKeys();MailView.registerKeys();Composer.registerKeys();var composerDomainDispose=function(){switch(that.layout.contentPanel.template()){case'composer':keyhandler.removeDomain('composer');break;case'view':keyhandler.removeDomain('mailView');break}};that.layout.currentLayout.subscribe(composerDomainDispose,null,'beforeChange');that.layout.contentPanel.template.subscribe(composerDomainDispose,null,'beforeChange');keyhandler.setDefaultDomain('listPanel')};Application.prototype.getKeybindingLegend=function(){var that=this;var mod=(mario.macos?'⌘':TR('mail.keys.Ctrl','Ctrl'))+' + ';var shift=TR('mail.keys.Shift','Shift')+' + ';var header=TR('mail.keys.KeyboardShortcuts','Keyboard shortcuts');return{header:header,enabled:true,close:function(){that.showKeyShortcuts(false)},composeKeys:[{key:mod+TR('mail.keys.Enter','Enter'),effect:TR('mail.SendMail','Send mail')}],listKeys:[{key:mod+'P',effect:TR('mail.mailView.Print','Print')},{key:'C',effect:TR('mail.keys.Compose','Compose new mail')},{key:TR('mail.keys.OOrEnter','O or Enter'),effect:TR('mail.keys.OpenMail','Open')},{key:TR('mail.keys.Space','Space'),effect:TR('mail.keys.MarkMail','Mark mail')},{key:'U',effect:TR('mail.keys.ToggleReadUnread','Toggle read/unread')},{key:'S',effect:TR('mail.keys.StarMessage','Star a message')},{key:'R',effect:TR('mail.mailView.Reply','Reply')},{key:shift+'R',effect:TR('mail.mailView.ReplyAll','Reply all')},{key:'F',effect:TR('mail.mailView.Forward','Forward')},{key:'M',effect:TR('mail.Move','Move')},{key:'.',effect:TR('mail.keys.ShowShortcuts','Show shortcut list')},{key:'J',effect:TR('mail.keys.NextMail','Go to next mail')},{key:'K',effect:TR('mail.keys.PreviousMail','Go to previous mail')},{key:mod+TR('mail.keys.Backspace','Backspace'),effect:TR('mail.Delete','Delete')}]}};Application.prototype.setupCollapsePreferences=function(){var that=this;var collapsedFolders=ko.computed(function(){return that.state.folders.list().filter(function(folder){return folder.collapsed()})});collapsedFolders.subscribe(function(folders){that.localStorage.setJSON('collapsed-folders',folders.map(function(folder){return folder.id()}))})};Application.prototype.expandIfCollapsed=function(){if(!this.layout.sidebar.collapsed()){return}this.layout.sidebar.expand()};Application.prototype.logout=function(ref,e){if(e&&e.type){return this.backend.logout(true)}return this.backend.logout()};Application.prototype.isComposerShown=function(){return this.layout.contentPanel.viewModel instanceof Composer};Application.prototype.clearView=function(){if(this.mailListView.shownMailView()){this.mailListView.shownMailView().clearView()};this.isMailView(false)};Application.prototype.resend=function(){var that=this;that.mailListView.shownMailView().resend()};Application.prototype.dragMailsStart=function(data){if(this.mailListView.moveToFolder.openState()===true||this.mailListView.arePopupDialogsOpen()===true){this.mailListView.moveToFolder.openState(false);this.mailListView.shouldBeOpened(false)}this.layout.sidebar.autoClosingEnabled(false);data.selection=this.mailListView.selection();data.selection.forEach(function(mail){mail.dragging(true)})};Application.prototype.dragMailsEnd=function(data){data.selection.forEach(function(mail){mail.dragging(false)});this.layout.sidebar.autoClosingEnabled(true)};Application.prototype.newFromMailto=function(mailtoUrl){var prevQuery=this.mailListView.getOptions();var additionalParams=Object.keys(prevQuery).map(function(param){return param+'='+encodeURIComponent(prevQuery[param])}).join('&');if(additionalParams){additionalParams='&'+additionalParams}var options=util.composerOptionsFromMailto(decodeURIComponent(mailtoUrl));AppCourier.depart('/'+this.user()+'/'+this.mailListView.folder().id()+'/'+this.mailListView.page().index+'/?compose=new'+additionalParams,options)};Application.prototype.sendMail=function(){var that=this;var composer=that.mailListView.shownComposer();composer.sendMail()};Application.prototype.composeMail=function(options){var that=this;if(that._newComposer){return}that._newComposer=true;setTimeout(function(){that._newComposer=false},10);$('.touch .content-panel').addClass('dont-animate');setTimeout(function(){$('.touch .content-panel').removeClass('dont-animate')},100);var composer=Composer.compose(that.state,that.errorHandler,that.actionExecutor,options);if(options.restore){if(options.compose==='new'){var mailTab=that.mailTabs.findUnsavedTab();if(mailTab){composer=mailTab.composer()}}composer.restoreFromLocalStorage()}that.mailTabs.add(composer);that.mailListView.shownComposer(composer);that.setContentPanel(composer,function(){that.state.signals.composerOpened.dispatch(composer)})};Application.prototype.setContentPanel=function(viewModel,done){this.mailListView.setContentPanel(viewModel,done)};Application.prototype.getFocused=function(){return this.mailListView.focused()};Application.prototype.setFocused=function(mail){this.mailListView.focused(mail)};Application.prototype.loadContacts=function(){var that=this;this.executeAction(new LoadContactsAction,function(err){if(err){that.handleError(err,{'0, 502, 503':function(){this.showWarning(TR('mail.ContactsUnavailable','There might be an issue with retrieving your contacts for the auto-completion feature. You will still be able to send and receive mail. Sorry for the inconvenience.'))}})}})};Application.prototype.selectFolder=function(folder){this.folderListView.selected(folder)};Application.prototype.loadFolders=function(callback){this.folderListView.refreshFolders(true,callback)};Application.prototype.load=function(){var that=this;if(that.backend.migrateLangCookie()){return}LoadingScreen.show();if(that.redirectIfNotAuthenticated()){return}that.afterLogin()};Application.prototype.redirectIfNotAuthenticated=function(){return this.backend.redirectIfNotAuthenticated()};Application.prototype.handleError=function(err,handlers){this.errorHandler.handleError(err,handlers)};Application.prototype.showError=function(message){this.errormsg(util.htmlEncode(message));tracking.track('errors shown to users','showError')};Application.prototype.showWarning=function(message){this.errormsg({message:util.htmlEncode(message),level:'warning',dismissable:true});tracking.track('warnings shown to users','showWarning')};Application.prototype.hideAddressBar=function(){if(!window.navigator.standalone&&mario.iphone){if(mario.safari&&parseInt(mario.osversion,10)<7){$('.application').css('bottom','-60px')}window.scrollTo(0,0)}};TraceLogging.injectTracing(Application);return Application})}());(function(){var define=System.amdDefine;(function(root,factory){if(typeof exports==='object'){module.exports=factory()}else if(typeof define==='function'&&define.amd){define('node_modules/@one.com/tracking-analytics/lib/tracking.js',[],factory)}else{root.com=root.com||{};root.com.one=root.com.one||{};root.com.one.tracking=factory()}}(this,function(){var tracking={options:{randomSeed:Math.random(),sampleLimit:{}}};function extend(obj1,obj2){for(var prop in obj2){if(obj2.hasOwnProperty(prop)){obj1[prop]=obj2[prop]}}return obj1}function sendEventToAppEventCollector(tag,input){var url=CONFIG.appEventCollector.url;var app=CONFIG.appEventCollector.app;var env=CONFIG.appEventCollector.env;if(!url||!app||!env){return}url=url.replace(/\/$/,'');var body=extend({},input);body=extend(body,{app:app,env:env});if(body.category==='errors'||body.category==='errors shown to users'){var user=typeof one==='object'&&one&&one.application&&one.application.user;if(user){if(typeof user==='function'){user=user()}body.user=user}}var clientVersion=document.documentElement.getAttribute('data-version');if(clientVersion){body.clientVersion=clientVersion}var xhr=new XMLHttpRequest;xhr.open('POST',url+'/event/'+tag);xhr.withCredentials=true;var payload;if(typeof FormData==='function'){payload=new FormData;Object.keys(body).forEach(function(key){if(typeof body[key]!=='undefined'){payload.append(key,body[key])}})}else{xhr.setRequestHeader('Content-Type','application/json;charset=utf-8');payload=JSON.stringify(body)}xhr.send(payload)}tracking.sendGoogleAnalyticsEventToAppEventCollector=function(event){return sendEventToAppEventCollector('trackevent',{eventtype:event[0],category:event[1],action:event[2],opt_label:event[3],opt_value:event[4],'opt_noninteraction':event[5]})};tracking.sendUniversalGoogleAnaytics=function(category,action,label,value,optInteraction){if(!label){ga('send','event',category,action);return}if(!optInteraction){optInteraction={'nonInteraction':true}}if(value&&!isNaN(value)){ga('send','event',category,action,label,value,optInteraction)}else{ga('send','event',category,action,label,optInteraction)}};tracking.sendHeartbeat=function(){sendEventToAppEventCollector('heartbeat',{eventtype:'heartbeat'})};tracking.shouldSendToGoogle=function(event){if(!Array.isArray(event)||event[0]!=='_trackEvent'){return false}var categoryWhitelist;try{categoryWhitelist=CONFIG.trackingAnalytics.googleAnalyticsCategoryWhitelist}catch(e){categoryWhitelist=[]}return categoryWhitelist.some(function(allowedEvent){var allowedEventRegex=new RegExp(allowedEvent);return allowedEventRegex.test(event[1])})};tracking.sendGoogleAnalytics=function(event){if(window._gaq&&tracking.shouldSendToGoogle(event)){_gaq.push(event);return}if(window.ga&&tracking.shouldSendToGoogle(event)){var eventsForGa=event.slice(1);tracking.sendUniversalGoogleAnaytics.apply(null,eventsForGa)}};tracking.sendEvent=function(event){tracking.sendGoogleAnalytics(event);tracking.sendGoogleAnalyticsEventToAppEventCollector(event)};tracking.track=function(category,action,opt_label,opt_value,opt_noninteraction){var sampleLimitPercentage=tracking.options.sampleLimit[category];if(sampleLimitPercentage&&sampleLimitPercentage<tracking.options.randomSeed){return}var event=['_trackEvent',category,action,opt_label,opt_value,opt_noninteraction];var indexOfFirstUndefined=event.indexOf(undefined);if(indexOfFirstUndefined!==-1){event=event.slice(0,indexOfFirstUndefined)}tracking.sendEvent(event)};tracking.limitSampling=function(category,percentage){tracking.options.sampleLimit[category]=percentage};return tracking}))}());System.registerDynamic('webmail/webmail.js',['webmail.#{locale|default}.i18n','inter/#{locale|default}.js','#{environment|default}.cjson','3rdparty/crashreporter/crashLogger.js','3rdparty/crashreporter/crashReporter.js','node_modules/stacktrace-gps/stacktrace-gps.js','node_modules/stackframe/stackframe.js','node_modules/error-stack-parser/error-stack-parser.js','node_modules/tracekit/tracekit.js','3rdparty/knockout.observableSortedArray.js','3rdparty/knockout.placeholderPolyfill.js','3rdparty/knockout.autocomplete.js','3rdparty/knockout.dragdrop.js','3rdparty/knockout.dropdown.js','3rdparty/knockout.autoExpand.js','3rdparty/knockout.selectOnFocus.js','3rdparty/knockout.splitView.js','3rdparty/knockout.transition.js','theme/theme.js','3rdparty/knockout.separator.js','3rdparty/knockout.selection.js','common/bindings/onKeyEnter.js','3rdparty/knockout.onKeyUp.js','common/bindings/knockout.events.js','3rdparty/knockout-lightbox/knockout-lightbox.js','3rdparty/tracking-analytics/knockout.track.js','common/bindings/fadeSlideVisible.js','3rdparty/knockout.activateFileInput.js','3rdparty/knockout.afterRender.js','3rdparty/knockout.beforeRemove.js','3rdparty/knockout.formatDate.js','theme/binding/errormsg.js','theme/binding/notification.js','common/bindings/knockout.highlightText.js','3rdparty/knockout.popupTemplate.js','common/bindings/knockout.dropdownTemplate.js','common/bindings/knockout.animate.js','common/frontendCrashTracking.js','webmail/view/application.ko','webmail/mailList/listPanel.ko','webmail/view/contentPanel.ko','webmail/mailTabs/mailTabs.ko','webmail/moveToFolder/moveToFolder.ko','webmail/mailList/mailListToolbar.ko','webmail/mailList/mailListSelectionBar.ko','webmail/mailList/mailListItem.ko','webmail/mailList/selection.ko','webmail/view/sidebar.ko','webmail/folderList/folderList.ko','webmail/folderList/folderListItem.ko','webmail/folderList/folderListItemDropdown.ko','onebar/onebar.ko','webmail/view/toolbar.ko','webmail/view/keybindings.ko','webmail/mailView/view.ko','webmail/mailView/contactCard.ko','webmail/mailView/unsubscribeDialog.ko','webmail/composer/composer.ko','webmail/composer/recipient-input.ko','webmail/composer/attachmentView.ko','webmail/composer/mailSent.ko','webmail/composer/sendingMail.ko','webmail/view/mailPart/mailPartInlineImage.ko','webmail/view/mailPart/mailPartText.ko','webmail/view/mailPart/mailPartTooBig.ko','3rdparty/one-theme/scaffolding.less','3rdparty/one-theme/3rdparty/bootstrap/less/type.less','3rdparty/one-theme/forms.less','3rdparty/one-theme/alerts.less','3rdparty/one-theme/tooltip.less','3rdparty/shinybox/shinybox.css','3rdparty/one-theme/onebar.less','onebar/onebar.less','3rdparty/one-theme/list.less','3rdparty/one-theme/toolbar.less','3rdparty/one-theme/buttons.less','3rdparty/one-theme/dropdowns.less','3rdparty/one-theme/sidebar.less','3rdparty/one-theme/rte.less','3rdparty/knockout-sequence-dialog/sequenceDialog.less','3rdparty/knockout-confirmation-dialog/confirmationDialog.less','3rdparty/knockout-toolbar/toolbar.less','theme/less/errormsg.less','theme/less/notification.less','theme/less/loadingScreen.less','theme/less/toolbar.less','theme/less/icons.less','theme/less/forms.less','theme/less/buttons.less','theme/less/dragdrop.less','theme/less/popup-dropdown.less','theme/less/dialog.less','theme/less/errorDialog.less','theme/less/knockout.autocomplete.less','theme/less/loading-overlay.less','theme/less/knockout.splitView.less','theme/less/contacts.less','theme/less/sidebar.less','theme/less/theme.less','webmail/webmail.less','webmail/mailList/searchHighlight.less','webmail/mailList/mailList.less','webmail/folderList/folderList.less','webmail/composer/composer.less','webmail/mailView/view.less','webmail/mailTabs/mailTabs.less','webmail/moveToFolder/moveToFolder.less','components/pagination/pagination.less','components/cardStack/cardStack.less','components/inPlaceEditor/inPlaceEditor.less','calendar/view/general.less','calendar/agenda/agenda.less','calendar/dialogs/dialogs.less','calendar/dialogs/event/eventDialog.less','calendar/components/dateInput/dateInput.less','calendar/components/dateSelector/dateSelector.less','calendar/components/timeSelector/timeSelector.less','calendar/components/dialogHeader/dialogHeader.less','calendar/components/miniCalendar/miniCalendar.less','webmail/components/calendarSlideIn/calendarSlideIn.less','webmail/components/calendarListDropDown/calendarListDropDown.less','eas/view/eas-dialog.less','eas/view/eas-dialog.ko','node_modules/jquery/dist/jquery.js','node_modules/knockout/build/output/knockout-latest.debug.js','webmail/Application.js','node_modules/@one.com/tracking-analytics/lib/tracking.js'],true,function($__require,exports,module){var define,global=this||self,GLOBAL=global;window.one=window.one||{};window.TR=$__require('webmail.#{locale|default}.i18n');window.inter=$__require('inter/#{locale|default}.js');window.CONFIG=$__require('#{environment|default}.cjson');$__require('3rdparty/crashreporter/crashLogger.js');$__require('3rdparty/crashreporter/crashReporter.js');var StackTraceGps=$__require('node_modules/stacktrace-gps/stacktrace-gps.js');var StackFrame=$__require('node_modules/stackframe/stackframe.js');var errorStackParser=$__require('node_modules/error-stack-parser/error-stack-parser.js');$__require('node_modules/tracekit/tracekit.js').report.subscribe(function(err){var frames;if(err&&typeof err.stack==='string'){frames=errorStackParser.parse(err)}else if(Array.isArray(err.stack)){frames=err.stack.map(function(traceKitStackFrame){return new StackFrame({functionName:traceKitStackFrame.func,args:traceKitStackFrame.args,fileName:traceKitStackFrame.url,lineNumber:traceKitStackFrame.line,columnNumber:traceKitStackFrame.column})})}if(frames){var stackTraceGps=new StackTraceGps({ajax:function ajax(url){return new Promise(function(resolve,reject){var req=new XMLHttpRequest;req.open('get',url);if(/\.js(?:$|\?)/.test(url)&&!/\/systemjs\/dist\/system.js$/.test(url)){req.setRequestHeader('accept','application/x-es-module')}req.onerror=reject;req.onreadystatechange=function onreadystatechange(){if(req.readyState===4){if(req.status>=200&&req.status<300){resolve(req.responseText)}else{reject(new Error('HTTP status: '+req.status+' retrieving '+url))}}};req.send()})}});Promise.all(frames.map(function(stackFrame){return stackTraceGps.getMappedLocation(stackFrame).then(undefined,function(stackTraceGpsErr){var errorMessage='Error mapping '+stackFrame.toString()+': '+(stackTraceGpsErr.stack||stackTraceGpsErr);(err.sourceMappedStackError=err.sourceMappedStackError||[]).push(errorMessage);return stackFrame})})).then(function(stackFrames){err.sourceMappedStack=stackFrames.map(String).join('\n');one.crashReporter.sendReportFromTraceKit(err)})}else{one.crashReporter.sendReportFromTraceKit(err)}});$__require('3rdparty/knockout.observableSortedArray.js');$__require('3rdparty/knockout.placeholderPolyfill.js');$__require('3rdparty/knockout.autocomplete.js');$__require('3rdparty/knockout.dragdrop.js');$__require('3rdparty/knockout.dropdown.js');$__require('3rdparty/knockout.autoExpand.js');$__require('3rdparty/knockout.selectOnFocus.js');$__require('3rdparty/knockout.splitView.js');$__require('3rdparty/knockout.transition.js');$__require('theme/theme.js');$__require('3rdparty/knockout.separator.js');$__require('3rdparty/knockout.selection.js');$__require('common/bindings/onKeyEnter.js');$__require('3rdparty/knockout.onKeyUp.js');$__require('common/bindings/knockout.events.js');$__require('3rdparty/knockout-lightbox/knockout-lightbox.js');$__require('3rdparty/tracking-analytics/knockout.track.js');$__require('common/bindings/fadeSlideVisible.js');$__require('3rdparty/knockout.activateFileInput.js');$__require('3rdparty/knockout.afterRender.js');$__require('3rdparty/knockout.beforeRemove.js');$__require('3rdparty/knockout.formatDate.js');$__require('theme/binding/errormsg.js');$__require('theme/binding/notification.js');$__require('common/bindings/knockout.highlightText.js');$__require('3rdparty/knockout.popupTemplate.js');$__require('common/bindings/knockout.dropdownTemplate.js');$__require('common/bindings/knockout.animate.js');$__require('common/frontendCrashTracking.js');$__require('webmail/view/application.ko');$__require('webmail/mailList/listPanel.ko');$__require('webmail/view/contentPanel.ko');$__require('webmail/mailTabs/mailTabs.ko');$__require('webmail/moveToFolder/moveToFolder.ko');$__require('webmail/mailList/mailListToolbar.ko');$__require('webmail/mailList/mailListSelectionBar.ko');$__require('webmail/mailList/mailListItem.ko');$__require('webmail/mailList/selection.ko');$__require('webmail/view/sidebar.ko');$__require('webmail/folderList/folderList.ko');$__require('webmail/folderList/folderListItem.ko');$__require('webmail/folderList/folderListItemDropdown.ko');$__require('onebar/onebar.ko');$__require('webmail/view/toolbar.ko');$__require('webmail/view/keybindings.ko');$__require('webmail/mailView/view.ko');$__require('webmail/mailView/contactCard.ko');$__require('webmail/mailView/unsubscribeDialog.ko');$__require('webmail/composer/composer.ko');$__require('webmail/composer/recipient-input.ko');$__require('webmail/composer/attachmentView.ko');$__require('webmail/composer/mailSent.ko');$__require('webmail/composer/sendingMail.ko');$__require('webmail/view/mailPart/mailPartInlineImage.ko');$__require('webmail/view/mailPart/mailPartText.ko');$__require('webmail/view/mailPart/mailPartTooBig.ko');$__require('3rdparty/one-theme/scaffolding.less');$__require('3rdparty/one-theme/3rdparty/bootstrap/less/type.less');$__require('3rdparty/one-theme/forms.less');$__require('3rdparty/one-theme/alerts.less');$__require('3rdparty/one-theme/tooltip.less');$__require('3rdparty/shinybox/shinybox.css');$__require('3rdparty/one-theme/onebar.less');$__require('onebar/onebar.less');$__require('3rdparty/one-theme/list.less');$__require('3rdparty/one-theme/toolbar.less');$__require('3rdparty/one-theme/buttons.less');$__require('3rdparty/one-theme/dropdowns.less');$__require('3rdparty/one-theme/sidebar.less');$__require('3rdparty/one-theme/rte.less');$__require('3rdparty/knockout-sequence-dialog/sequenceDialog.less');$__require('3rdparty/knockout-confirmation-dialog/confirmationDialog.less');$__require('3rdparty/knockout-toolbar/toolbar.less');$__require('theme/less/errormsg.less');$__require('theme/less/notification.less');$__require('theme/less/loadingScreen.less');$__require('theme/less/toolbar.less');$__require('theme/less/icons.less');$__require('theme/less/forms.less');$__require('theme/less/buttons.less');$__require('theme/less/dragdrop.less');$__require('theme/less/popup-dropdown.less');$__require('theme/less/dialog.less');$__require('theme/less/errorDialog.less');$__require('theme/less/knockout.autocomplete.less');$__require('theme/less/loading-overlay.less');$__require('theme/less/knockout.splitView.less');$__require('theme/less/contacts.less');$__require('theme/less/sidebar.less');$__require('theme/less/theme.less');$__require('webmail/webmail.less');$__require('webmail/mailList/searchHighlight.less');$__require('webmail/mailList/mailList.less');$__require('webmail/folderList/folderList.less');$__require('webmail/composer/composer.less');$__require('webmail/mailView/view.less');$__require('webmail/mailTabs/mailTabs.less');$__require('webmail/moveToFolder/moveToFolder.less');$__require('components/pagination/pagination.less');$__require('components/cardStack/cardStack.less');$__require('components/inPlaceEditor/inPlaceEditor.less');$__require('calendar/view/general.less');$__require('calendar/agenda/agenda.less');$__require('calendar/dialogs/dialogs.less');$__require('calendar/dialogs/event/eventDialog.less');$__require('calendar/components/dateInput/dateInput.less');$__require('calendar/components/dateSelector/dateSelector.less');$__require('calendar/components/timeSelector/timeSelector.less');$__require('calendar/components/dialogHeader/dialogHeader.less');$__require('calendar/components/miniCalendar/miniCalendar.less');$__require('webmail/components/calendarSlideIn/calendarSlideIn.less');$__require('webmail/components/calendarListDropDown/calendarListDropDown.less');$__require('eas/view/eas-dialog.less');$__require('eas/view/eas-dialog.ko');var $=$__require('node_modules/jquery/dist/jquery.js');var ko=$__require('node_modules/knockout/build/output/knockout-latest.debug.js');var Application=$__require('webmail/Application.js');var tracking=$__require('node_modules/@one.com/tracking-analytics/lib/tracking.js');(function(){var application=one.application=new Application(false);if(application.redirectIfNotAuthenticated()){return}$(function(){var body=$('body');var standaloneView=/\?(.*&)?standalone=true/.test(window.location.href);if(standaloneView){$('html').addClass('standalone')}function handleMailtoLink(mailtoURL){application.newFromMailto(mailtoURL)}function catchMailtoClick(e){if(e){if(e.target.href&&/^mailto:/.test(e.target.href)){handleMailtoLink(e.target.href);e.preventDefault()}}}function updateBodyClasses(){body.toggleClass('small-toolbar',body.width()<1300);body.toggleClass('very-small-width',body.width()<900);body.toggleClass('small-width',body.width()<1366)}function resizeApp(){updateBodyClasses()}ko.applyBindings(application,$('html')[0]);$(window).resize(resizeApp);resizeApp();body.click(catchMailtoClick);application.load();tracking.track('initialize','desktop');application.state.standalone=!!standaloneView})}());return module.exports})//# sourceMappingURL=https://mail-static.cdn-one.com/bundle-27984.js.f97e92bb6d.map
